<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html><head><meta http-equiv="Content-Type" content="text/html;charset=iso-8859-1">
<title>libgimpprint API Reference: src/main/mxml-search.c Source File</title>
<link href="doxygen.css" rel="stylesheet" type="text/css">
</head><body>
<!-- Generated by Doxygen 1.3.6 -->
<div class="qindex"><a class="qindex" href="index.html">Main&nbsp;Page</a> | <a class="qindex" href="modules.html">Modules</a> | <a class="qindex" href="classes.html">Alphabetical&nbsp;List</a> | <a class="qindex" href="annotated.html">Data&nbsp;Structures</a> | <a class="qindex" href="files.html">File&nbsp;List</a> | <a class="qindex" href="functions.html">Data&nbsp;Fields</a> | <a class="qindex" href="globals.html">Globals</a> | <a class="qindex" href="pages.html">Related&nbsp;Pages</a></div>
<h1>src/main/mxml-search.c</h1><a href="mxml-search_8c.html">Go to the documentation of this file.</a><div class="fragment"><pre>00001 <span class="comment">/*</span>
00002 <span class="comment"> * "$Id: mxml-search_8c-source.html,v 1.1.1.2 2004/12/22 23:49:05 jlovell Exp $"</span>
00003 <span class="comment"> *</span>
00004 <span class="comment"> * Search/navigation functions for mini-XML, a small XML-like file</span>
00005 <span class="comment"> * parsing library.</span>
00006 <span class="comment"> *</span>
00007 <span class="comment"> * Copyright 2003 by Michael Sweet.</span>
00008 <span class="comment"> *</span>
00009 <span class="comment"> * This program is free software; you can redistribute it and/or</span>
00010 <span class="comment"> * modify it under the terms of the GNU Library General Public</span>
00011 <span class="comment"> * License as published by the Free Software Foundation; either</span>
00012 <span class="comment"> * version 2, or (at your option) any later version.</span>
00013 <span class="comment"> *</span>
00014 <span class="comment"> * This program is distributed in the hope that it will be useful,</span>
00015 <span class="comment"> * but WITHOUT ANY WARRANTY; without even the implied warranty of</span>
00016 <span class="comment"> * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the</span>
00017 <span class="comment"> * GNU General Public License for more details.</span>
00018 <span class="comment"> *</span>
00019 <span class="comment"> * Contents:</span>
00020 <span class="comment"> *</span>
00021 <span class="comment"> *   stp_mxmlFindElement() - Find the named element.</span>
00022 <span class="comment"> *   stp_mxmlWalkNext()    - Walk to the next logical node in the tree.</span>
00023 <span class="comment"> *   stp_mxmlWalkPrev()    - Walk to the previous logical node in the tree.</span>
00024 <span class="comment"> */</span>
00025 
00026 <span class="comment">/*</span>
00027 <span class="comment"> * Include necessary headers...</span>
00028 <span class="comment"> */</span>
00029 
00030 <span class="preprocessor">#include &lt;<a class="code" href="mxml_8h.html">gimp-print/mxml.h</a>&gt;</span>
00031 <span class="preprocessor">#include "config.h"</span>
00032 
00033 
00034 <span class="comment">/*</span>
00035 <span class="comment"> * 'stp_mxmlFindElement()' - Find the named element.</span>
00036 <span class="comment"> *</span>
00037 <span class="comment"> * The search is constrained by the name, attribute name, and value; any</span>
00038 <span class="comment"> * NULL names or values are treated as wildcards, so different kinds of</span>
00039 <span class="comment"> * searches can be implemented by looking for all elements of a given name</span>
00040 <span class="comment"> * or all elements with a specific attribute. The descend argument determines</span>
00041 <span class="comment"> * whether the search descends into child nodes; normally you will use</span>
00042 <span class="comment"> * STP_MXML_DESCEND_FIRST for the initial search and STP_MXML_NO_DESCEND to find</span>
00043 <span class="comment"> * additional direct descendents of the node. The top node argument</span>
00044 <span class="comment"> * constrains the search to a particular node's children.</span>
00045 <span class="comment"> */</span>
00046 
00047 <a class="code" href="structstp__mxml__node__s.html">stp_mxml_node_t</a> *                               <span class="comment">/* O - Element node or NULL */</span>
<a name="l00048"></a><a class="code" href="mxml-search_8c.html#a0">00048</a> <a class="code" href="mxml-search_8c.html#a0">stp_mxmlFindElement</a>(<a class="code" href="structstp__mxml__node__s.html">stp_mxml_node_t</a> *node,      <span class="comment">/* I - Current node */</span>
00049                 <a class="code" href="structstp__mxml__node__s.html">stp_mxml_node_t</a> *top,   <span class="comment">/* I - Top node */</span>
00050                 <span class="keyword">const</span> <span class="keywordtype">char</span>  *name,      <span class="comment">/* I - Element name or NULL for any */</span>
00051                 <span class="keyword">const</span> <span class="keywordtype">char</span>  *attr,      <span class="comment">/* I - Attribute name, or NULL for none */</span>
00052                 <span class="keyword">const</span> <span class="keywordtype">char</span>  *value,     <span class="comment">/* I - Attribute value, or NULL for any */</span>
00053                 <span class="keywordtype">int</span>         descend)    <span class="comment">/* I - Descend into tree - STP_MXML_DESCEND, STP_MXML_NO_DESCEND, or STP_MXML_DESCEND_FIRST */</span>
00054 {
00055   <span class="keyword">const</span> <span class="keywordtype">char</span>    *temp;                  <span class="comment">/* Current attribute value */</span>
00056 
00057 
00058  <span class="comment">/*</span>
00059 <span class="comment">  * Range check input...</span>
00060 <span class="comment">  */</span>
00061 
00062   <span class="keywordflow">if</span> (!node || !top || (!attr &amp;&amp; value))
00063     <span class="keywordflow">return</span> (NULL);
00064 
00065  <span class="comment">/*</span>
00066 <span class="comment">  * Start with the next node...</span>
00067 <span class="comment">  */</span>
00068 
00069   node = <a class="code" href="mxml-search_8c.html#a1">stp_mxmlWalkNext</a>(node, top, descend);
00070 
00071  <span class="comment">/*</span>
00072 <span class="comment">  * Loop until we find a matching element...</span>
00073 <span class="comment">  */</span>
00074 
00075   <span class="keywordflow">while</span> (node != NULL)
00076   {
00077    <span class="comment">/*</span>
00078 <span class="comment">    * See if this node matches...</span>
00079 <span class="comment">    */</span>
00080 
00081     <span class="keywordflow">if</span> (node-&gt;<a class="code" href="structstp__mxml__node__s.html#o0">type</a> == <a class="code" href="mxml_8h.html#a43a20">STP_MXML_ELEMENT</a> &amp;&amp;
00082         node-&gt;<a class="code" href="structstp__mxml__node__s.html#o6">value</a>.<a class="code" href="unionstp__mxml__value__u.html#o0">element</a>.<a class="code" href="structstp__mxml__value__s.html#o0">name</a> &amp;&amp;
00083         (!name || !strcmp(node-&gt;<a class="code" href="structstp__mxml__node__s.html#o6">value</a>.<a class="code" href="unionstp__mxml__value__u.html#o0">element</a>.<a class="code" href="structstp__mxml__value__s.html#o0">name</a>, name)))
00084     {
00085      <span class="comment">/*</span>
00086 <span class="comment">      * See if we need to check for an attribute...</span>
00087 <span class="comment">      */</span>
00088 
00089       <span class="keywordflow">if</span> (!attr)
00090         <span class="keywordflow">return</span> (node);                  <span class="comment">/* No attribute search, return it... */</span>
00091 
00092      <span class="comment">/*</span>
00093 <span class="comment">      * Check for the attribute...</span>
00094 <span class="comment">      */</span>
00095 
00096       <span class="keywordflow">if</span> ((temp = <a class="code" href="mxml-attr_8c.html#a0">stp_mxmlElementGetAttr</a>(node, attr)) != NULL)
00097       {
00098        <span class="comment">/*</span>
00099 <span class="comment">        * OK, we have the attribute, does it match?</span>
00100 <span class="comment">        */</span>
00101 
00102         <span class="keywordflow">if</span> (!value || !strcmp(value, temp))
00103           <span class="keywordflow">return</span> (node);                <span class="comment">/* Yes, return it... */</span>
00104       }
00105     }
00106 
00107    <span class="comment">/*</span>
00108 <span class="comment">    * No match, move on to the next node...</span>
00109 <span class="comment">    */</span>
00110 
00111     <span class="keywordflow">if</span> (descend == <a class="code" href="mxml_8h.html#a4">STP_MXML_DESCEND</a>)
00112       node = <a class="code" href="mxml-search_8c.html#a1">stp_mxmlWalkNext</a>(node, top, <a class="code" href="mxml_8h.html#a4">STP_MXML_DESCEND</a>);
00113     <span class="keywordflow">else</span>
00114       node = node-&gt;<a class="code" href="structstp__mxml__node__s.html#o1">next</a>;
00115   }
00116 
00117   <span class="keywordflow">return</span> (NULL);
00118 }
00119 
00120 
00121 <span class="comment">/*</span>
00122 <span class="comment"> * 'stp_mxmlWalkNext()' - Walk to the next logical node in the tree.</span>
00123 <span class="comment"> *</span>
00124 <span class="comment"> * The descend argument controls whether the first child is considered</span>
00125 <span class="comment"> * to be the next node. The top node argument constrains the walk to</span>
00126 <span class="comment"> * the node's children.</span>
00127 <span class="comment"> */</span>
00128 
00129 <a class="code" href="structstp__mxml__node__s.html">stp_mxml_node_t</a> *                               <span class="comment">/* O - Next node or NULL */</span>
<a name="l00130"></a><a class="code" href="mxml-search_8c.html#a1">00130</a> <a class="code" href="mxml-search_8c.html#a1">stp_mxmlWalkNext</a>(<a class="code" href="structstp__mxml__node__s.html">stp_mxml_node_t</a> *node,         <span class="comment">/* I - Current node */</span>
00131              <a class="code" href="structstp__mxml__node__s.html">stp_mxml_node_t</a> *top,              <span class="comment">/* I - Top node */</span>
00132              <span class="keywordtype">int</span>         descend)       <span class="comment">/* I - Descend into tree - STP_MXML_DESCEND, STP_MXML_NO_DESCEND, or STP_MXML_DESCEND_FIRST */</span>
00133 {
00134   <span class="keywordflow">if</span> (!node)
00135     <span class="keywordflow">return</span> (NULL);
00136   <span class="keywordflow">else</span> <span class="keywordflow">if</span> (node-&gt;<a class="code" href="structstp__mxml__node__s.html#o4">child</a> &amp;&amp; descend)
00137     <span class="keywordflow">return</span> (node-&gt;<a class="code" href="structstp__mxml__node__s.html#o4">child</a>);
00138   <span class="keywordflow">else</span> <span class="keywordflow">if</span> (node-&gt;<a class="code" href="structstp__mxml__node__s.html#o1">next</a>)
00139     <span class="keywordflow">return</span> (node-&gt;<a class="code" href="structstp__mxml__node__s.html#o1">next</a>);
00140   <span class="keywordflow">else</span> <span class="keywordflow">if</span> (node-&gt;<a class="code" href="structstp__mxml__node__s.html#o3">parent</a> &amp;&amp; node-&gt;<a class="code" href="structstp__mxml__node__s.html#o3">parent</a> != top)
00141   {
00142     node = node-&gt;<a class="code" href="structstp__mxml__node__s.html#o3">parent</a>;
00143 
00144     <span class="keywordflow">while</span> (!node-&gt;<a class="code" href="structstp__mxml__node__s.html#o1">next</a>)
00145       <span class="keywordflow">if</span> (node-&gt;<a class="code" href="structstp__mxml__node__s.html#o3">parent</a> == top || !node-&gt;<a class="code" href="structstp__mxml__node__s.html#o3">parent</a>)
00146         <span class="keywordflow">return</span> (NULL);
00147       <span class="keywordflow">else</span>
00148         node = node-&gt;<a class="code" href="structstp__mxml__node__s.html#o3">parent</a>;
00149 
00150     <span class="keywordflow">return</span> (node-&gt;<a class="code" href="structstp__mxml__node__s.html#o1">next</a>);
00151   }
00152   <span class="keywordflow">else</span>
00153     <span class="keywordflow">return</span> (NULL);
00154 }
00155 
00156 
00157 <span class="comment">/*</span>
00158 <span class="comment"> * 'stp_mxmlWalkPrev()' - Walk to the previous logical node in the tree.</span>
00159 <span class="comment"> *</span>
00160 <span class="comment"> * The descend argument controls whether the previous node's last child</span>
00161 <span class="comment"> * is considered to be the previous node. The top node argument constrains</span>
00162 <span class="comment"> * the walk to the node's children.</span>
00163 <span class="comment"> */</span>
00164 
00165 <a class="code" href="structstp__mxml__node__s.html">stp_mxml_node_t</a> *                               <span class="comment">/* O - Previous node or NULL */</span>
<a name="l00166"></a><a class="code" href="mxml-search_8c.html#a2">00166</a> <a class="code" href="mxml-search_8c.html#a2">stp_mxmlWalkPrev</a>(<a class="code" href="structstp__mxml__node__s.html">stp_mxml_node_t</a> *node,         <span class="comment">/* I - Current node */</span>
00167              <a class="code" href="structstp__mxml__node__s.html">stp_mxml_node_t</a> *top,              <span class="comment">/* I - Top node */</span>
00168              <span class="keywordtype">int</span>         descend)       <span class="comment">/* I - Descend into tree - STP_MXML_DESCEND, STP_MXML_NO_DESCEND, or STP_MXML_DESCEND_FIRST */</span>
00169 {
00170   <span class="keywordflow">if</span> (!node)
00171     <span class="keywordflow">return</span> (NULL);
00172   <span class="keywordflow">else</span> <span class="keywordflow">if</span> (node-&gt;<a class="code" href="structstp__mxml__node__s.html#o2">prev</a>)
00173   {
00174     <span class="keywordflow">if</span> (node-&gt;<a class="code" href="structstp__mxml__node__s.html#o2">prev</a>-&gt;<a class="code" href="structstp__mxml__node__s.html#o5">last_child</a> &amp;&amp; descend)
00175     {
00176      <span class="comment">/*</span>
00177 <span class="comment">      * Find the last child under the previous node...</span>
00178 <span class="comment">      */</span>
00179 
00180       node = node-&gt;<a class="code" href="structstp__mxml__node__s.html#o2">prev</a>-&gt;<a class="code" href="structstp__mxml__node__s.html#o5">last_child</a>;
00181 
00182       <span class="keywordflow">while</span> (node-&gt;<a class="code" href="structstp__mxml__node__s.html#o5">last_child</a>)
00183         node = node-&gt;<a class="code" href="structstp__mxml__node__s.html#o5">last_child</a>;
00184 
00185       <span class="keywordflow">return</span> (node);
00186     }
00187     <span class="keywordflow">else</span>
00188       <span class="keywordflow">return</span> (node-&gt;<a class="code" href="structstp__mxml__node__s.html#o2">prev</a>);
00189   }
00190   <span class="keywordflow">else</span> <span class="keywordflow">if</span> (node-&gt;<a class="code" href="structstp__mxml__node__s.html#o3">parent</a> != top)
00191     <span class="keywordflow">return</span> (node-&gt;<a class="code" href="structstp__mxml__node__s.html#o3">parent</a>);
00192   <span class="keywordflow">else</span>
00193     <span class="keywordflow">return</span> (NULL);
00194 }
00195 
00196 
00197 <span class="comment">/*</span>
00198 <span class="comment"> * End of "$Id: mxml-search_8c-source.html,v 1.1.1.2 2004/12/22 23:49:05 jlovell Exp $".</span>
00199 <span class="comment"> */</span>
</pre></div><hr size="1"><address style="align: right;"><small>Generated on Wed Aug 25 07:56:14 2004 for libgimpprint API Reference by
<a href="http://www.doxygen.org/index.html">
<img src="doxygen.png" alt="doxygen" align="middle" border=0 > </a>1.3.6 </small></address>
</body>
</html>
