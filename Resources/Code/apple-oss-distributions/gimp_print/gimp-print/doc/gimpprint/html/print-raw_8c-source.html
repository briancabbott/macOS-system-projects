<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html><head><meta http-equiv="Content-Type" content="text/html;charset=iso-8859-1">
<title>libgimpprint API Reference: src/main/print-raw.c Source File</title>
<link href="doxygen.css" rel="stylesheet" type="text/css">
</head><body>
<!-- Generated by Doxygen 1.3.6 -->
<div class="qindex"><a class="qindex" href="index.html">Main&nbsp;Page</a> | <a class="qindex" href="modules.html">Modules</a> | <a class="qindex" href="classes.html">Alphabetical&nbsp;List</a> | <a class="qindex" href="annotated.html">Data&nbsp;Structures</a> | <a class="qindex" href="files.html">File&nbsp;List</a> | <a class="qindex" href="functions.html">Data&nbsp;Fields</a> | <a class="qindex" href="globals.html">Globals</a> | <a class="qindex" href="pages.html">Related&nbsp;Pages</a></div>
<h1>src/main/print-raw.c</h1><a href="print-raw_8c.html">Go to the documentation of this file.</a><div class="fragment"><pre>00001 <span class="comment">/*</span>
00002 <span class="comment"> * "$Id: print-raw_8c-source.html,v 1.1.1.2 2004/12/22 23:49:09 jlovell Exp $"</span>
00003 <span class="comment"> *</span>
00004 <span class="comment"> *   Print plug-in RAW driver for the GIMP.</span>
00005 <span class="comment"> *</span>
00006 <span class="comment"> *   Copyright 1997-2000 Michael Sweet (mike@easysw.com) and</span>
00007 <span class="comment"> *      Robert Krawitz (rlk@alum.mit.edu)</span>
00008 <span class="comment"> *</span>
00009 <span class="comment"> *   This program is free software; you can redistribute it and/or modify it</span>
00010 <span class="comment"> *   under the terms of the GNU General Public License as published by the Free</span>
00011 <span class="comment"> *   Software Foundation; either version 2 of the License, or (at your option)</span>
00012 <span class="comment"> *   any later version.</span>
00013 <span class="comment"> *</span>
00014 <span class="comment"> *   This program is distributed in the hope that it will be useful, but</span>
00015 <span class="comment"> *   WITHOUT ANY WARRANTY; without even the implied warranty of MERCHANTABILITY</span>
00016 <span class="comment"> *   or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU General Public License</span>
00017 <span class="comment"> *   for more details.</span>
00018 <span class="comment"> *</span>
00019 <span class="comment"> *   You should have received a copy of the GNU General Public License</span>
00020 <span class="comment"> *   along with this program; if not, write to the Free Software</span>
00021 <span class="comment"> *   Foundation, Inc., 59 Temple Place - Suite 330, Boston, MA 02111-1307, USA.</span>
00022 <span class="comment"> */</span>
00023 
00024 <span class="comment">/*</span>
00025 <span class="comment"> * This file must include only standard C header files.  The core code must</span>
00026 <span class="comment"> * compile on generic platforms that don't support glib, gimp, gtk, etc.</span>
00027 <span class="comment"> */</span>
00028 
00029 <span class="preprocessor">#ifdef HAVE_CONFIG_H</span>
00030 <span class="preprocessor"></span><span class="preprocessor">#include &lt;config.h&gt;</span>
00031 <span class="preprocessor">#endif</span>
00032 <span class="preprocessor"></span><span class="preprocessor">#include &lt;<a class="code" href="gimp-print_8h.html">gimp-print/gimp-print.h</a>&gt;</span>
00033 <span class="preprocessor">#include "<a class="code" href="gimp-print-internal_8h.html">gimp-print-internal.h</a>"</span>
00034 <span class="preprocessor">#include &lt;<a class="code" href="gimp-print-intl-internal_8h.html">gimp-print/gimp-print-intl-internal.h</a>&gt;</span>
00035 <span class="preprocessor">#include &lt;string.h&gt;</span>
00036 <span class="preprocessor">#include &lt;stdio.h&gt;</span>
00037 
00038 <span class="preprocessor">#ifdef __GNUC__</span>
00039 <span class="preprocessor"></span><span class="preprocessor">#define inline __inline__</span>
00040 <span class="preprocessor"></span><span class="preprocessor">#endif</span>
00041 <span class="preprocessor"></span>
00042 <span class="keyword">typedef</span> <span class="keyword">struct</span>
00043 <span class="keyword"></span>{
<a name="l00044"></a><a class="code" href="structink__t.html#o4">00044</a>   <span class="keyword">const</span> <span class="keywordtype">char</span> *output_type;
<a name="l00045"></a><a class="code" href="structink__t.html#o1">00045</a>   <span class="keywordtype">int</span> output_channels;
<a name="l00046"></a><a class="code" href="structink__t.html#o5">00046</a>   <span class="keywordtype">int</span> rotate_channels;
<a name="l00047"></a><a class="code" href="structink__t.html#o6">00047</a>   <span class="keyword">const</span> <span class="keywordtype">char</span> *name;
00048 } <a class="code" href="structink__t.html">ink_t</a>;
00049 
<a name="l00050"></a><a class="code" href="structraw__printer.html">00050</a> <span class="keyword">typedef</span> <span class="keyword">struct </span><a class="code" href="structraw__printer.html">raw_printer</a>
00051 {
<a name="l00052"></a><a class="code" href="structraw__printer.html#o0">00052</a>   <span class="keywordtype">int</span> <a class="code" href="structraw__printer.html#o0">output_bits</a>;
00053 } <a class="code" href="structraw__printer.html">raw_printer_t</a>;
00054 
<a name="l00055"></a><a class="code" href="print-raw_8c.html#a3">00055</a> <span class="keyword">static</span> <span class="keyword">const</span> <a class="code" href="structraw__printer.html">raw_printer_t</a> <a class="code" href="print-raw_8c.html#a3">raw_model_capabilities</a>[] =
00056 {
00057   {
00058     16
00059   },
00060   {
00061     8
00062   },
00063 };
00064 
<a name="l00065"></a><a class="code" href="print-raw_8c.html#a4">00065</a> <span class="keyword">static</span> <span class="keyword">const</span> <a class="code" href="structink__t.html">ink_t</a> inks[] =
00066 {
00067   { <span class="stringliteral">"RGB"</span>, 3, 0, <span class="stringliteral">"RGB"</span> },
00068   { <span class="stringliteral">"CMY"</span>, 3, 0, <span class="stringliteral">"CMY"</span> },
00069   { <span class="stringliteral">"KCMY"</span>, 4, 1, <span class="stringliteral">"CMYK"</span> },
00070   { <span class="stringliteral">"KCMY"</span>, 4, 0, <span class="stringliteral">"KCMY"</span> },
00071   { <span class="stringliteral">"Whitescale"</span>, 1, 0, <span class="stringliteral">"RGBGray"</span> },
00072   { <span class="stringliteral">"Grayscale"</span>, 1, 0, <span class="stringliteral">"CMYGray"</span> },
00073 };
00074 
<a name="l00075"></a><a class="code" href="print-raw_8c.html#a5">00075</a> <span class="keyword">static</span> <span class="keyword">const</span> <span class="keywordtype">int</span> <a class="code" href="print-raw_8c.html#a5">ink_count</a> = <span class="keyword">sizeof</span>(inks) / <span class="keyword">sizeof</span>(<a class="code" href="structink__t.html">ink_t</a>);
00076 
<a name="l00077"></a><a class="code" href="print-raw_8c.html#a6">00077</a> <span class="keyword">static</span> <span class="keyword">const</span> <a class="code" href="structstp__parameter__t.html">stp_parameter_t</a> <a class="code" href="print-raw_8c.html#a6">the_parameters</a>[] =
00078 {
00079   {
00080     <span class="stringliteral">"InkType"</span>, <a class="code" href="group__intl__internal.html#ga6">N_</a>(<span class="stringliteral">"Ink Type"</span>), <a class="code" href="group__intl__internal.html#ga6">N_</a>(<span class="stringliteral">"Advanced Printer Setup"</span>),
00081     <a class="code" href="group__intl__internal.html#ga6">N_</a>(<span class="stringliteral">"Type of ink in the printer"</span>),
00082     <a class="code" href="group__vars.html#gga132a7">STP_PARAMETER_TYPE_STRING_LIST</a>, <a class="code" href="group__vars.html#gga133a17">STP_PARAMETER_CLASS_FEATURE</a>,
00083     <a class="code" href="group__vars.html#gga134a21">STP_PARAMETER_LEVEL_BASIC</a>, 1, 1, -1, 1, 0
00084   },
00085   {
00086     <span class="stringliteral">"PrintingMode"</span>, <a class="code" href="group__intl__internal.html#ga6">N_</a>(<span class="stringliteral">"Printing Mode"</span>), <a class="code" href="group__intl__internal.html#ga6">N_</a>(<span class="stringliteral">"Core Parameter"</span>),
00087     <a class="code" href="group__intl__internal.html#ga6">N_</a>(<span class="stringliteral">"Printing Output Mode"</span>),
00088     <a class="code" href="group__vars.html#gga132a7">STP_PARAMETER_TYPE_STRING_LIST</a>, <a class="code" href="group__vars.html#gga133a19">STP_PARAMETER_CLASS_CORE</a>,
00089     <a class="code" href="group__vars.html#gga134a21">STP_PARAMETER_LEVEL_BASIC</a>, 1, 1, -1, 1, 0
00090   },
00091 };
00092 
<a name="l00093"></a><a class="code" href="print-raw_8c.html#a7">00093</a> <span class="keyword">static</span> <span class="keyword">const</span> <span class="keywordtype">int</span> <a class="code" href="print-raw_8c.html#a7">the_parameter_count</a> =
00094 <span class="keyword">sizeof</span>(<a class="code" href="print-raw_8c.html#a6">the_parameters</a>) / <span class="keyword">sizeof</span>(<span class="keyword">const</span> <a class="code" href="structstp__parameter__t.html">stp_parameter_t</a>);
00095 
00096 <span class="keyword">static</span> <a class="code" href="group__vars.html#ga1">stp_parameter_list_t</a>
<a name="l00097"></a><a class="code" href="print-raw_8c.html#a12">00097</a> <a class="code" href="print-raw_8c.html#a12">raw_list_parameters</a>(<span class="keyword">const</span> <a class="code" href="structstp__vars.html">stp_vars_t</a> *v)
00098 {
00099   <a class="code" href="group__vars.html#ga1">stp_parameter_list_t</a> *ret = <a class="code" href="group__vars.html#ga43">stp_parameter_list_create</a>();
00100   <span class="keywordtype">int</span> i;
00101   <span class="keywordflow">for</span> (i = 0; i &lt; <a class="code" href="print-raw_8c.html#a7">the_parameter_count</a>; i++)
00102     <a class="code" href="group__vars.html#ga82">stp_parameter_list_add_param</a>(ret, &amp;(<a class="code" href="print-raw_8c.html#a6">the_parameters</a>[i]));
00103   <span class="keywordflow">return</span> ret;
00104 }
00105 
00106 <span class="keyword">static</span> <span class="keywordtype">void</span>
<a name="l00107"></a><a class="code" href="print-raw_8c.html#a13">00107</a> <a class="code" href="print-raw_8c.html#a13">raw_parameters</a>(<span class="keyword">const</span> <a class="code" href="structstp__vars.html">stp_vars_t</a> *v, <span class="keyword">const</span> <span class="keywordtype">char</span> *name,
00108                <a class="code" href="structstp__parameter__t.html">stp_parameter_t</a> *description)
00109 {
00110   <span class="keywordtype">int</span>           i;
00111   description-&gt;<a class="code" href="structstp__parameter__t.html#o4">p_type</a> = <a class="code" href="group__vars.html#gga132a16">STP_PARAMETER_TYPE_INVALID</a>;
00112   <span class="keywordflow">if</span> (name == NULL)
00113     <span class="keywordflow">return</span>;
00114 
00115   description-&gt;<a class="code" href="structstp__parameter__t.html#o26">deflt</a>.str = NULL;
00116   <span class="keywordflow">for</span> (i = 0; i &lt; <a class="code" href="print-raw_8c.html#a7">the_parameter_count</a>; i++)
00117     <span class="keywordflow">if</span> (strcmp(name, <a class="code" href="print-raw_8c.html#a6">the_parameters</a>[i].name) == 0)
00118       {
00119         <a class="code" href="group__vars.html#ga75">stp_fill_parameter_settings</a>(description, &amp;(<a class="code" href="print-raw_8c.html#a6">the_parameters</a>[i]));
00120         <span class="keywordflow">break</span>;
00121       }
00122   <span class="keywordflow">if</span> (strcmp(name, <span class="stringliteral">"InkType"</span>) == 0)
00123     {
00124       description-&gt;<a class="code" href="structstp__parameter__t.html#o18">bounds</a>.str = <a class="code" href="string-list_8h.html#a1">stp_string_list_create</a>();
00125       <span class="keywordflow">for</span> (i = 0; i &lt; <a class="code" href="print-raw_8c.html#a5">ink_count</a>; i++)
00126         <a class="code" href="string-list_8c.html#a11">stp_string_list_add_string</a>(description-&gt;<a class="code" href="structstp__parameter__t.html#o18">bounds</a>.str,
00127                                   inks[i].<a class="code" href="structink__t.html#o2">name</a>, inks[i].<a class="code" href="structink__t.html#o2">name</a>);
00128       description-&gt;<a class="code" href="structstp__parameter__t.html#o26">deflt</a>.str =
00129         <a class="code" href="string-list_8c.html#a6">stp_string_list_param</a>(description-&gt;<a class="code" href="structstp__parameter__t.html#o18">bounds</a>.str, 0)-&gt;<a class="code" href="structstp__param__string__t.html#o0">name</a>;
00130     }
00131   <span class="keywordflow">else</span> <span class="keywordflow">if</span> (strcmp(name, <span class="stringliteral">"PrintingMode"</span>) == 0)
00132     {
00133       description-&gt;<a class="code" href="structstp__parameter__t.html#o18">bounds</a>.str = <a class="code" href="string-list_8h.html#a1">stp_string_list_create</a>();
00134       <a class="code" href="string-list_8h.html#a7">stp_string_list_add_string</a>
00135         (description-&gt;<a class="code" href="structstp__parameter__t.html#o18">bounds</a>.str, <span class="stringliteral">"Color"</span>, <a class="code" href="group__intl__internal.html#ga5">_</a>(<span class="stringliteral">"Color"</span>));
00136       <a class="code" href="string-list_8h.html#a7">stp_string_list_add_string</a>
00137         (description-&gt;<a class="code" href="structstp__parameter__t.html#o18">bounds</a>.str, <span class="stringliteral">"BW"</span>, <a class="code" href="group__intl__internal.html#ga5">_</a>(<span class="stringliteral">"Black and White"</span>));
00138       description-&gt;<a class="code" href="structstp__parameter__t.html#o26">deflt</a>.str =
00139         <a class="code" href="string-list_8c.html#a6">stp_string_list_param</a>(description-&gt;<a class="code" href="structstp__parameter__t.html#o18">bounds</a>.str, 0)-&gt;<a class="code" href="structstp__param__string__t.html#o0">name</a>;
00140     }
00141   <span class="keywordflow">else</span>
00142     description-&gt;<a class="code" href="structstp__parameter__t.html#o8">is_active</a> = 0;
00143 }
00144 
00145 <span class="comment">/*</span>
00146 <span class="comment"> * 'escp2_imageable_area()' - Return the imageable area of the page.</span>
00147 <span class="comment"> */</span>
00148 
00149 <span class="keyword">static</span> <span class="keywordtype">void</span>
<a name="l00150"></a><a class="code" href="print-raw_8c.html#a14">00150</a> <a class="code" href="print-raw_8c.html#a14">raw_imageable_area</a>(<span class="keyword">const</span> <a class="code" href="structstp__vars.html">stp_vars_t</a> *v,
00151                    <span class="keywordtype">int</span>  *left,
00152                    <span class="keywordtype">int</span>  *right,
00153                    <span class="keywordtype">int</span>  *bottom,
00154                    <span class="keywordtype">int</span>  *top)
00155 {
00156   *left = 0;
00157   *top = 0;
00158   *right = <a class="code" href="group__vars.html#ga26">stp_get_page_width</a>(v);
00159   *bottom = <a class="code" href="group__vars.html#ga28">stp_get_page_height</a>(v);
00160 }
00161 
00162 <span class="keyword">static</span> <span class="keywordtype">void</span>
<a name="l00163"></a><a class="code" href="print-raw_8c.html#a15">00163</a> <a class="code" href="print-raw_8c.html#a15">raw_limit</a>(<span class="keyword">const</span> <a class="code" href="structstp__vars.html">stp_vars_t</a> *v,                  <span class="comment">/* I */</span>
00164             <span class="keywordtype">int</span> *width, <span class="keywordtype">int</span> *height,
00165             <span class="keywordtype">int</span> *min_width, <span class="keywordtype">int</span> *min_height)
00166 {
00167   *width = 65535;
00168   *height = 65535;
00169   *min_width = 1;
00170   *min_height = 1;
00171 }
00172 
00173 <span class="keyword">static</span> <span class="keywordtype">void</span>
<a name="l00174"></a><a class="code" href="print-raw_8c.html#a16">00174</a> <a class="code" href="print-raw_8c.html#a16">raw_describe_resolution</a>(<span class="keyword">const</span> <a class="code" href="structstp__vars.html">stp_vars_t</a> *v, <span class="keywordtype">int</span> *x, <span class="keywordtype">int</span> *y)
00175 {
00176   *x = 72;
00177   *y = 72;
00178 }
00179 
00180 <span class="keyword">static</span> <span class="keyword">const</span> <span class="keywordtype">char</span> *
<a name="l00181"></a><a class="code" href="print-raw_8c.html#a17">00181</a> <a class="code" href="print-raw_8c.html#a17">raw_describe_output</a>(<span class="keyword">const</span> <a class="code" href="structstp__vars.html">stp_vars_t</a> *v)
00182 {
00183   <span class="keyword">const</span> <span class="keywordtype">char</span> *ink_type = <a class="code" href="group__vars.html#ga36">stp_get_string_parameter</a>(v, <span class="stringliteral">"InkType"</span>);
00184   <span class="keywordflow">if</span> (ink_type)
00185     {
00186       <span class="keywordtype">int</span> i;
00187       <span class="keywordflow">for</span> (i = 0; i &lt; <a class="code" href="print-raw_8c.html#a5">ink_count</a>; i++)
00188         <span class="keywordflow">if</span> (strcmp(ink_type, inks[i].name) == 0)
00189             <span class="keywordflow">return</span> inks[i].<a class="code" href="structink__t.html#o0">output_type</a>;
00190     }
00191   <span class="keywordflow">return</span> <span class="stringliteral">"RGB"</span>;
00192 }
00193 
00194 <span class="comment">/*</span>
00195 <span class="comment"> * 'escp2_print()' - Print an image to an EPSON printer.</span>
00196 <span class="comment"> */</span>
00197 <span class="keyword">static</span> <span class="keywordtype">int</span>
<a name="l00198"></a><a class="code" href="print-raw_8c.html#a18">00198</a> <a class="code" href="print-raw_8c.html#a18">raw_print</a>(<span class="keyword">const</span> <a class="code" href="structstp__vars.html">stp_vars_t</a> *v, <a class="code" href="structstp__image.html">stp_image_t</a> *image)
00199 {
00200   <span class="keywordtype">int</span>           model = <a class="code" href="group__printer.html#ga23">stp_get_model_id</a>(v);
00201   <span class="keywordtype">int</span> width = <a class="code" href="group__vars.html#ga26">stp_get_page_width</a>(v);
00202   <span class="keywordtype">int</span> height = <a class="code" href="group__vars.html#ga28">stp_get_page_height</a>(v);
00203   <span class="keywordtype">int</span>           i, j;
00204   <span class="keywordtype">int</span>           y;              <span class="comment">/* Looping vars */</span>
00205   <a class="code" href="structstp__vars.html">stp_vars_t</a>    *nv = <a class="code" href="group__vars.html#ga78">stp_vars_create_copy</a>(v);
00206   <span class="keywordtype">int</span> out_channels;
00207   <span class="keywordtype">unsigned</span> <span class="keywordtype">short</span> *final_out = NULL;
00208   <span class="keywordtype">int</span>           status = 1;
00209   <span class="keywordtype">int</span> bytes_per_channel = <a class="code" href="print-raw_8c.html#a3">raw_model_capabilities</a>[model].<a class="code" href="structraw__printer.html#o0">output_bits</a> / 8;
00210   <span class="keywordtype">int</span> ink_channels = 1;
00211   <span class="keywordtype">int</span> rotate_output = 0;
00212   <span class="keyword">const</span> <span class="keywordtype">char</span> *ink_type = <a class="code" href="group__vars.html#ga36">stp_get_string_parameter</a>(nv, <span class="stringliteral">"InkType"</span>);
00213 
00214   <a class="code" href="group__util.html#ga77">stp_prune_inactive_options</a>(nv);
00215   <span class="keywordflow">if</span> (!<a class="code" href="group__vars.html#ga34">stp_verify</a>(nv))
00216     {
00217       <a class="code" href="print-util_8c.html#a18">stp_eprintf</a>(nv, <a class="code" href="group__intl__internal.html#ga5">_</a>(<span class="stringliteral">"Print options not verified; cannot print.\n"</span>));
00218       <a class="code" href="group__vars.html#ga26">stp_vars_destroy</a>(nv);
00219       <span class="keywordflow">return</span> 0;
00220     }
00221   <span class="keywordflow">if</span> (width != <a class="code" href="group__image.html#ga2">stp_image_width</a>(image) || height != <a class="code" href="group__image.html#ga3">stp_image_height</a>(image))
00222     {
00223       <a class="code" href="print-util_8c.html#a18">stp_eprintf</a>(nv, <a class="code" href="group__intl__internal.html#ga5">_</a>(<span class="stringliteral">"Image dimensions must match paper dimensions"</span>));
00224       <a class="code" href="group__vars.html#ga26">stp_vars_destroy</a>(nv);
00225       <span class="keywordflow">return</span> 0;
00226     }
00227   <span class="keywordflow">if</span> (ink_type)
00228     {
00229       <span class="keywordflow">for</span> (i = 0; i &lt; <a class="code" href="print-raw_8c.html#a5">ink_count</a>; i++)
00230         <span class="keywordflow">if</span> (strcmp(ink_type, inks[i].name) == 0)
00231           {
00232             <a class="code" href="group__vars.html#ga32">stp_set_string_parameter</a>(nv, <span class="stringliteral">"STPIOutputType"</span>, inks[i].output_type);
00233             ink_channels = inks[i].<a class="code" href="structink__t.html#o1">output_channels</a>;
00234             rotate_output = inks[i].<a class="code" href="structink__t.html#o5">rotate_channels</a>;
00235             <span class="keywordflow">break</span>;
00236           }
00237     }
00238 
00239   <a class="code" href="group__vars.html#ga67">stp_set_float_parameter</a>(nv, <span class="stringliteral">"Density"</span>, 1.0);
00240   <a class="code" href="channel_8c.html#a2">stp_channel_reset</a>(nv);
00241   <span class="keywordflow">for</span> (i = 0; i &lt; ink_channels; i++)
00242     <a class="code" href="channel_8c.html#a6">stp_channel_add</a>(nv, i, 0, 1.0);
00243 
00244   <span class="keywordflow">if</span> (bytes_per_channel == 1)
00245     out_channels = <a class="code" href="group__color.html#ga13">stp_color_init</a>(nv, image, 256);
00246   <span class="keywordflow">else</span>
00247     out_channels = <a class="code" href="group__color.html#ga13">stp_color_init</a>(nv, image, 65536);
00248 
00249   <span class="keywordflow">if</span> (out_channels != ink_channels &amp;&amp; out_channels != 1 &amp;&amp; ink_channels != 1)
00250     {
00251       <a class="code" href="print-util_8c.html#a18">stp_eprintf</a>(nv, <span class="stringliteral">"Internal error!  Output channels or input channels must be 1\n"</span>);
00252       <a class="code" href="group__vars.html#ga26">stp_vars_destroy</a>(nv);
00253       <span class="keywordflow">return</span> 0;
00254     }
00255 
00256   <span class="keywordflow">if</span> (out_channels != ink_channels)
00257     final_out = <a class="code" href="group__util.html#ga28">stp_malloc</a>(width * ink_channels * 2);
00258 
00259   <span class="keywordflow">for</span> (y = 0; y &lt; height; y++)
00260     {
00261       <span class="keywordtype">unsigned</span> <span class="keywordtype">short</span> *out;
00262       <span class="keywordtype">unsigned</span> <span class="keywordtype">short</span> *real_out;
00263       <span class="keywordtype">unsigned</span> zero_mask;
00264       <span class="keywordflow">if</span> (<a class="code" href="group__color.html#ga14">stp_color_get_row</a>(nv, image, y, &amp;zero_mask))
00265         {
00266           status = 2;
00267           <span class="keywordflow">break</span>;
00268         }
00269       out = <a class="code" href="channel_8c.html#a20">stp_channel_get_input</a>(nv);
00270       real_out = out;
00271       <span class="keywordflow">if</span> (rotate_output)
00272         {
00273           <span class="keywordtype">unsigned</span> <span class="keywordtype">short</span> *tmp_out = real_out;
00274           <span class="keywordflow">for</span> (i = 0; i &lt; width; i++)
00275             {
00276               <span class="keywordtype">unsigned</span> <span class="keywordtype">short</span> tmp = tmp_out[0];
00277               <span class="keywordflow">for</span> (j = 0; j &lt; ink_channels - 1; j++)
00278                 tmp_out[j] = tmp_out[j + 1];
00279               tmp_out[ink_channels - 1] = tmp;
00280               tmp_out += ink_channels;
00281             }
00282         }
00283       <span class="keywordflow">if</span> (out_channels != ink_channels)
00284         {
00285           real_out = final_out;
00286           <span class="keywordflow">if</span> (out_channels &lt; ink_channels)
00287             {
00288               <span class="keywordflow">for</span> (i = 0; i &lt; width; i++)
00289                 {
00290                   <span class="keywordflow">for</span> (j = 0; j &lt; ink_channels; j++)
00291                     final_out[i * ink_channels + j] = out[i];
00292                 }
00293             }
00294           <span class="keywordflow">else</span>
00295             {
00296               <span class="keywordflow">for</span> (i = 0; i &lt; width; i++)
00297                 {
00298                   <span class="keywordtype">int</span> avg = 0;
00299                   <span class="keywordflow">for</span> (j = 0; j &lt; out_channels; j++)
00300                     avg += out[i * out_channels + j];
00301                   final_out[i] = avg / out_channels;
00302                 }
00303             }
00304         }
00305       <span class="keywordflow">if</span> (bytes_per_channel == 1)
00306         {
00307           <span class="keywordtype">unsigned</span> <span class="keywordtype">char</span> *char_out = (<span class="keywordtype">unsigned</span> <span class="keywordtype">char</span> *) real_out;
00308           <span class="keywordflow">for</span> (i = 0; i &lt; width * ink_channels; i++)
00309             char_out[i] = real_out[i] / 257;
00310         }
00311       <a class="code" href="group__util.html#ga10">stp_zfwrite</a>((<span class="keywordtype">char</span> *) real_out,
00312                   width * ink_channels * bytes_per_channel, 1, nv);
00313     }
00314   <a class="code" href="group__image.html#ga6">stp_image_conclude</a>(image);
00315   <span class="keywordflow">if</span> (final_out)
00316     <a class="code" href="group__util.html#ga31">stp_free</a>(final_out);
00317   <a class="code" href="group__vars.html#ga26">stp_vars_destroy</a>(nv);
00318   <span class="keywordflow">return</span> status;
00319 }
00320 
<a name="l00321"></a><a class="code" href="print-raw_8c.html#a8">00321</a> <span class="keyword">static</span> <span class="keyword">const</span> <a class="code" href="structstp__printfuncs__t.html">stp_printfuncs_t</a> <a class="code" href="print-raw_8c.html#a8">print_raw_printfuncs</a> =
00322 {
00323   <a class="code" href="print-raw_8c.html#a12">raw_list_parameters</a>,
00324   <a class="code" href="print-raw_8c.html#a13">raw_parameters</a>,
00325   <a class="code" href="group__papersize.html#ga4">stp_default_media_size</a>,
00326   <a class="code" href="print-raw_8c.html#a14">raw_imageable_area</a>,
00327   <a class="code" href="print-raw_8c.html#a15">raw_limit</a>,
00328   <a class="code" href="print-raw_8c.html#a18">raw_print</a>,
00329   <a class="code" href="print-raw_8c.html#a16">raw_describe_resolution</a>,
00330   <a class="code" href="print-raw_8c.html#a17">raw_describe_output</a>,
00331   <a class="code" href="group__printer.html#ga19">stp_verify_printer_params</a>,
00332   NULL,
00333   NULL
00334 };
00335 
00336 
00337 
00338 
<a name="l00339"></a><a class="code" href="print-raw_8c.html#a9">00339</a> <span class="keyword">static</span> <a class="code" href="structstp__family.html">stp_family_t</a> <a class="code" href="print-raw_8c.html#a9">print_raw_module_data</a> =
00340   {
00341     &amp;<a class="code" href="print-raw_8c.html#a8">print_raw_printfuncs</a>,
00342     NULL
00343   };
00344 
00345 
00346 <span class="keyword">static</span> <span class="keywordtype">int</span>
<a name="l00347"></a><a class="code" href="print-raw_8c.html#a19">00347</a> <a class="code" href="print-raw_8c.html#a19">print_raw_module_init</a>(<span class="keywordtype">void</span>)
00348 {
00349   <span class="keywordflow">return</span> <a class="code" href="group__printer.html#ga46">stp_family_register</a>(<a class="code" href="print-raw_8c.html#a9">print_raw_module_data</a>.<a class="code" href="structstp__family.html#o1">printer_list</a>);
00350 }
00351 
00352 
00353 <span class="keyword">static</span> <span class="keywordtype">int</span>
<a name="l00354"></a><a class="code" href="print-raw_8c.html#a20">00354</a> <a class="code" href="print-raw_8c.html#a20">print_raw_module_exit</a>(<span class="keywordtype">void</span>)
00355 {
00356   <span class="keywordflow">return</span> <a class="code" href="group__printer.html#ga47">stp_family_unregister</a>(<a class="code" href="print-raw_8c.html#a9">print_raw_module_data</a>.<a class="code" href="structstp__family.html#o1">printer_list</a>);
00357 }
00358 
00359 
00360 <span class="comment">/* Module header */</span>
<a name="l00361"></a><a class="code" href="print-raw_8c.html#a0">00361</a> <span class="preprocessor">#define stp_module_version print_raw_LTX_stp_module_version</span>
<a name="l00362"></a><a class="code" href="print-raw_8c.html#a1">00362</a> <span class="preprocessor"></span><span class="preprocessor">#define stp_module_data print_raw_LTX_stp_module_data</span>
00363 <span class="preprocessor"></span>
<a name="l00364"></a><a class="code" href="print-raw_8c.html#a10">00364</a> <a class="code" href="structstp__module__version.html">stp_module_version_t</a> <a class="code" href="structstp__module__version.html">stp_module_version</a> = {0, 0};
00365 
<a name="l00366"></a><a class="code" href="print-raw_8c.html#a11">00366</a> <a class="code" href="structstp__module.html">stp_module_t</a> <a class="code" href="print-canon_8c.html#a45">stp_module_data</a> =
00367   {
00368     <span class="stringliteral">"raw"</span>,
00369     VERSION,
00370     <span class="stringliteral">"RAW family driver"</span>,
00371     <a class="code" href="module_8h.html#a13a4">STP_MODULE_CLASS_FAMILY</a>,
00372     NULL,
00373     <a class="code" href="print-raw_8c.html#a19">print_raw_module_init</a>,
00374     <a class="code" href="print-raw_8c.html#a20">print_raw_module_exit</a>,
00375     (<span class="keywordtype">void</span> *) &amp;<a class="code" href="print-raw_8c.html#a9">print_raw_module_data</a>
00376   };
</pre></div><hr size="1"><address style="align: right;"><small>Generated on Wed Aug 25 07:56:14 2004 for libgimpprint API Reference by
<a href="http://www.doxygen.org/index.html">
<img src="doxygen.png" alt="doxygen" align="middle" border=0 > </a>1.3.6 </small></address>
</body>
</html>
