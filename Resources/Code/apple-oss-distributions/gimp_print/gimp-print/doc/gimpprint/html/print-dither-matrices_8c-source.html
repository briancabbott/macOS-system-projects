<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html><head><meta http-equiv="Content-Type" content="text/html;charset=iso-8859-1">
<title>libgimpprint API Reference: src/main/print-dither-matrices.c Source File</title>
<link href="doxygen.css" rel="stylesheet" type="text/css">
</head><body>
<!-- Generated by Doxygen 1.3.6 -->
<div class="qindex"><a class="qindex" href="index.html">Main&nbsp;Page</a> | <a class="qindex" href="modules.html">Modules</a> | <a class="qindex" href="classes.html">Alphabetical&nbsp;List</a> | <a class="qindex" href="annotated.html">Data&nbsp;Structures</a> | <a class="qindex" href="files.html">File&nbsp;List</a> | <a class="qindex" href="functions.html">Data&nbsp;Fields</a> | <a class="qindex" href="globals.html">Globals</a> | <a class="qindex" href="pages.html">Related&nbsp;Pages</a></div>
<h1>src/main/print-dither-matrices.c</h1><a href="print-dither-matrices_8c.html">Go to the documentation of this file.</a><div class="fragment"><pre>00001 <span class="comment">/*</span>
00002 <span class="comment"> * "$Id: print-dither-matrices_8c-source.html,v 1.1.1.2 2004/12/22 23:49:06 jlovell Exp $"</span>
00003 <span class="comment"> *</span>
00004 <span class="comment"> *   Print plug-in driver utility functions for the GIMP.</span>
00005 <span class="comment"> *</span>
00006 <span class="comment"> *   Copyright 2001 Robert Krawitz (rlk@alum.mit.edu)</span>
00007 <span class="comment"> *</span>
00008 <span class="comment"> *   This program is free software; you can redistribute it and/or modify it</span>
00009 <span class="comment"> *   under the terms of the GNU General Public License as published by the Free</span>
00010 <span class="comment"> *   Software Foundation; either version 2 of the License, or (at your option)</span>
00011 <span class="comment"> *   any later version.</span>
00012 <span class="comment"> *</span>
00013 <span class="comment"> *   This program is distributed in the hope that it will be useful, but</span>
00014 <span class="comment"> *   WITHOUT ANY WARRANTY; without even the implied warranty of MERCHANTABILITY</span>
00015 <span class="comment"> *   or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU General Public License</span>
00016 <span class="comment"> *   for more details.</span>
00017 <span class="comment"> *</span>
00018 <span class="comment"> *   You should have received a copy of the GNU General Public License</span>
00019 <span class="comment"> *   along with this program; if not, write to the Free Software</span>
00020 <span class="comment"> *   Foundation, Inc., 59 Temple Place - Suite 330, Boston, MA 02111-1307, USA.</span>
00021 <span class="comment"> *</span>
00022 <span class="comment"> * Revision History:</span>
00023 <span class="comment"> *</span>
00024 <span class="comment"> *   See ChangeLog</span>
00025 <span class="comment"> */</span>
00026 
00027 <span class="preprocessor">#ifdef HAVE_CONFIG_H</span>
00028 <span class="preprocessor"></span><span class="preprocessor">#include &lt;config.h&gt;</span>
00029 <span class="preprocessor">#endif</span>
00030 <span class="preprocessor"></span><span class="preprocessor">#include &lt;<a class="code" href="gimp-print_8h.html">gimp-print/gimp-print.h</a>&gt;</span>
00031 <span class="preprocessor">#include "<a class="code" href="gimp-print-internal_8h.html">gimp-print-internal.h</a>"</span>
00032 <span class="preprocessor">#include &lt;math.h&gt;</span>
00033 <span class="preprocessor">#include &lt;string.h&gt;</span>
00034 <span class="preprocessor">#include &lt;stdlib.h&gt;</span>
00035 <span class="preprocessor">#include &lt;stdio.h&gt;</span>
00036 <span class="preprocessor">#include &lt;assert.h&gt;</span>
00037 <span class="preprocessor">#include "<a class="code" href="dither-impl_8h.html">dither-impl.h</a>"</span>
00038 
00039 <span class="preprocessor">#ifdef __GNUC__</span>
00040 <span class="preprocessor"></span><span class="preprocessor">#define inline __inline__</span>
00041 <span class="preprocessor"></span><span class="preprocessor">#endif</span>
00042 <span class="preprocessor"></span>
00043 
00044 <span class="keyword">static</span> <span class="keywordtype">unsigned</span>
<a name="l00045"></a><a class="code" href="print-dither-matrices_8c.html#a2">00045</a> <a class="code" href="print-weave_8c.html#a5">gcd</a>(<span class="keywordtype">unsigned</span> a, <span class="keywordtype">unsigned</span> b)
00046 {
00047   <span class="keywordtype">unsigned</span> tmp;
00048   <span class="keywordflow">if</span> (b &gt; a)
00049     {
00050       tmp = a;
00051       a = b;
00052       b = tmp;
00053     }
00054   <span class="keywordflow">while</span> (1)
00055     {
00056       tmp = a % b;
00057       <span class="keywordflow">if</span> (tmp == 0)
00058         <span class="keywordflow">return</span> b;
00059       a = b;
00060       b = tmp;
00061     }
00062 }
00063 
00064 <span class="keyword">static</span> <span class="keyword">inline</span> <span class="keywordtype">int</span>
<a name="l00065"></a><a class="code" href="print-dither-matrices_8c.html#a3">00065</a> <a class="code" href="print-dither-matrices_8c.html#a3">calc_ordered_point</a>(<span class="keywordtype">unsigned</span> x, <span class="keywordtype">unsigned</span> y, <span class="keywordtype">int</span> steps, <span class="keywordtype">int</span> multiplier,
00066                    <span class="keywordtype">int</span> size, <span class="keyword">const</span> <span class="keywordtype">unsigned</span> *map)
00067 {
00068   <span class="keywordtype">int</span> i, j;
00069   <span class="keywordtype">unsigned</span> retval = 0;
00070   <span class="keywordtype">int</span> divisor = 1;
00071   <span class="keywordtype">int</span> div1;
00072   <span class="keywordflow">for</span> (i = 0; i &lt; steps; i++)
00073     {
00074       <span class="keywordtype">int</span> xa = (x / divisor) % size;
00075       <span class="keywordtype">int</span> ya = (y / divisor) % size;
00076       <span class="keywordtype">unsigned</span> base;
00077       base = map[ya + (xa * size)];
00078       div1 = 1;
00079       <span class="keywordflow">for</span> (j = i; j &lt; steps - 1; j++)
00080         div1 *= size * size;
00081       retval += base * div1;
00082       divisor *= size;
00083     }
00084   <span class="keywordflow">return</span> retval * multiplier;
00085 }
00086 
00087 <span class="keyword">static</span> <span class="keywordtype">int</span>
<a name="l00088"></a><a class="code" href="print-dither-matrices_8c.html#a4">00088</a> <a class="code" href="print-dither-matrices_8c.html#a4">is_po2</a>(size_t i)
00089 {
00090   <span class="keywordflow">if</span> (i == 0)
00091     <span class="keywordflow">return</span> 0;
00092   <span class="keywordflow">return</span> (((i &amp; (i - 1)) == 0) ? 1 : 0);
00093 }
00094 
00095 <span class="keywordtype">void</span>
<a name="l00096"></a><a class="code" href="print-dither-matrices_8c.html#a5">00096</a> <a class="code" href="print-dither-matrices_8c.html#a5">stp_dither_matrix_iterated_init</a>(<a class="code" href="structdither__matrix__impl.html">stp_dither_matrix_impl_t</a> *mat, size_t size,
00097                                 size_t expt, <span class="keyword">const</span> <span class="keywordtype">unsigned</span> *array)
00098 {
00099   <span class="keywordtype">int</span> i;
00100   <span class="keywordtype">int</span> x, y;
00101   mat-&gt;<a class="code" href="structdither__matrix__impl.html#o0">base</a> = size;
00102   mat-&gt;<a class="code" href="structdither__matrix__impl.html#o1">exp</a> = expt;
00103   mat-&gt;<a class="code" href="structdither__matrix__impl.html#o2">x_size</a> = 1;
00104   <span class="keywordflow">for</span> (i = 0; i &lt; expt; i++)
00105     mat-&gt;<a class="code" href="structdither__matrix__impl.html#o2">x_size</a> *= mat-&gt;<a class="code" href="structdither__matrix__impl.html#o0">base</a>;
00106   mat-&gt;<a class="code" href="structdither__matrix__impl.html#o3">y_size</a> = mat-&gt;<a class="code" href="structdither__matrix__impl.html#o2">x_size</a>;
00107   mat-&gt;<a class="code" href="structdither__matrix__impl.html#o4">total_size</a> = mat-&gt;<a class="code" href="structdither__matrix__impl.html#o2">x_size</a> * mat-&gt;<a class="code" href="structdither__matrix__impl.html#o3">y_size</a>;
00108   mat-&gt;<a class="code" href="structdither__matrix__impl.html#o14">matrix</a> = <a class="code" href="group__util.html#ga28">stp_malloc</a>(<span class="keyword">sizeof</span>(<span class="keywordtype">unsigned</span>) * mat-&gt;<a class="code" href="structdither__matrix__impl.html#o2">x_size</a> * mat-&gt;<a class="code" href="structdither__matrix__impl.html#o3">y_size</a>);
00109   <span class="keywordflow">for</span> (x = 0; x &lt; mat-&gt;<a class="code" href="structdither__matrix__impl.html#o2">x_size</a>; x++)
00110     <span class="keywordflow">for</span> (y = 0; y &lt; mat-&gt;<a class="code" href="structdither__matrix__impl.html#o3">y_size</a>; y++)
00111       {
00112         mat-&gt;<a class="code" href="structdither__matrix__impl.html#o14">matrix</a>[x + y * mat-&gt;<a class="code" href="structdither__matrix__impl.html#o2">x_size</a>] =
00113           <a class="code" href="print-dither-matrices_8c.html#a3">calc_ordered_point</a>(x, y, mat-&gt;<a class="code" href="structdither__matrix__impl.html#o1">exp</a>, 1, mat-&gt;<a class="code" href="structdither__matrix__impl.html#o0">base</a>, array);
00114         mat-&gt;<a class="code" href="structdither__matrix__impl.html#o14">matrix</a>[x + y * mat-&gt;<a class="code" href="structdither__matrix__impl.html#o2">x_size</a>] =
00115           (<span class="keywordtype">double</span>) mat-&gt;<a class="code" href="structdither__matrix__impl.html#o14">matrix</a>[x + y * mat-&gt;<a class="code" href="structdither__matrix__impl.html#o2">x_size</a>] * 65536.0 /
00116           (<span class="keywordtype">double</span>) (mat-&gt;<a class="code" href="structdither__matrix__impl.html#o2">x_size</a> * mat-&gt;<a class="code" href="structdither__matrix__impl.html#o3">y_size</a>);
00117       }
00118   mat-&gt;<a class="code" href="structdither__matrix__impl.html#o5">last_x</a> = mat-&gt;<a class="code" href="structdither__matrix__impl.html#o6">last_x_mod</a> = 0;
00119   mat-&gt;<a class="code" href="structdither__matrix__impl.html#o7">last_y</a> = mat-&gt;<a class="code" href="structdither__matrix__impl.html#o8">last_y_mod</a> = 0;
00120   mat-&gt;<a class="code" href="structdither__matrix__impl.html#o9">index</a> = 0;
00121   mat-&gt;<a class="code" href="structdither__matrix__impl.html#o10">i_own</a> = 1;
00122   <span class="keywordflow">if</span> (<a class="code" href="print-dither-matrices_8c.html#a4">is_po2</a>(mat-&gt;<a class="code" href="structdither__matrix__impl.html#o2">x_size</a>))
00123     mat-&gt;<a class="code" href="structdither__matrix__impl.html#o13">fast_mask</a> = mat-&gt;<a class="code" href="structdither__matrix__impl.html#o2">x_size</a> - 1;
00124   <span class="keywordflow">else</span>
00125     mat-&gt;<a class="code" href="structdither__matrix__impl.html#o13">fast_mask</a> = 0;
00126 }
00127 
<a name="l00128"></a><a class="code" href="print-dither-matrices_8c.html#a0">00128</a> <span class="preprocessor">#define MATRIX_POINT(m, x, y, x_size, y_size) \</span>
00129 <span class="preprocessor">  ((m)[(((x) + (x_size)) % (x_size)) + ((x_size) * (((y) + (y_size)) % (y_size)))])</span>
00130 <span class="preprocessor"></span>
00131 <span class="keywordtype">void</span>
<a name="l00132"></a><a class="code" href="print-dither-matrices_8c.html#a6">00132</a> <a class="code" href="print-dither-matrices_8c.html#a6">stp_dither_matrix_shear</a>(<a class="code" href="structdither__matrix__impl.html">stp_dither_matrix_impl_t</a> *mat, <span class="keywordtype">int</span> x_shear, <span class="keywordtype">int</span> y_shear)
00133 {
00134   <span class="keywordtype">int</span> i;
00135   <span class="keywordtype">int</span> j;
00136   <span class="keywordtype">int</span> *tmp = <a class="code" href="group__util.html#ga28">stp_malloc</a>(mat-&gt;<a class="code" href="structdither__matrix__impl.html#o2">x_size</a> * mat-&gt;<a class="code" href="structdither__matrix__impl.html#o3">y_size</a> * <span class="keyword">sizeof</span>(<span class="keywordtype">int</span>));
00137   <span class="keywordflow">for</span> (i = 0; i &lt; mat-&gt;<a class="code" href="structdither__matrix__impl.html#o2">x_size</a>; i++)
00138     <span class="keywordflow">for</span> (j = 0; j &lt; mat-&gt;<a class="code" href="structdither__matrix__impl.html#o3">y_size</a>; j++)
00139       <a class="code" href="print-dither-matrices_8c.html#a0">MATRIX_POINT</a>(tmp, i, j, mat-&gt;<a class="code" href="structdither__matrix__impl.html#o2">x_size</a>, mat-&gt;<a class="code" href="structdither__matrix__impl.html#o3">y_size</a>) =
00140         <a class="code" href="print-dither-matrices_8c.html#a0">MATRIX_POINT</a>(mat-&gt;<a class="code" href="structdither__matrix__impl.html#o14">matrix</a>, i, j * (x_shear + 1), mat-&gt;<a class="code" href="structdither__matrix__impl.html#o2">x_size</a>,
00141                     mat-&gt;<a class="code" href="structdither__matrix__impl.html#o3">y_size</a>);
00142   <span class="keywordflow">for</span> (i = 0; i &lt; mat-&gt;<a class="code" href="structdither__matrix__impl.html#o2">x_size</a>; i++)
00143     <span class="keywordflow">for</span> (j = 0; j &lt; mat-&gt;<a class="code" href="structdither__matrix__impl.html#o3">y_size</a>; j++)
00144       <a class="code" href="print-dither-matrices_8c.html#a0">MATRIX_POINT</a>(mat-&gt;<a class="code" href="structdither__matrix__impl.html#o14">matrix</a>, i, j, mat-&gt;<a class="code" href="structdither__matrix__impl.html#o2">x_size</a>, mat-&gt;<a class="code" href="structdither__matrix__impl.html#o3">y_size</a>) =
00145         <a class="code" href="print-dither-matrices_8c.html#a0">MATRIX_POINT</a>(tmp, i * (y_shear + 1), j, mat-&gt;<a class="code" href="structdither__matrix__impl.html#o2">x_size</a>, mat-&gt;<a class="code" href="structdither__matrix__impl.html#o3">y_size</a>);
00146   <a class="code" href="group__util.html#ga31">stp_free</a>(tmp);
00147 }
00148 
00149 <span class="keywordtype">int</span>
<a name="l00150"></a><a class="code" href="print-dither-matrices_8c.html#a7">00150</a> <a class="code" href="print-dither-matrices_8c.html#a7">stp_dither_matrix_validate_array</a>(<span class="keyword">const</span> <a class="code" href="structstp__array.html">stp_array_t</a> *array)
00151 {
00152   <span class="keywordtype">double</span> low, high;
00153   <span class="keyword">const</span> <a class="code" href="structstp__sequence.html">stp_sequence_t</a> *seq = <a class="code" href="group__array.html#ga13">stp_array_get_sequence</a>(array);
00154   <a class="code" href="group__sequence.html#ga12">stp_sequence_get_bounds</a>(seq, &amp;low, &amp;high);
00155   <span class="keywordflow">if</span> (low &lt; 0 || high &gt; 65535)
00156     <span class="keywordflow">return</span> 0;
00157   <span class="keywordflow">return</span> 1;
00158 }
00159 
00160 
00161 <span class="keywordtype">void</span>
<a name="l00162"></a><a class="code" href="print-dither-matrices_8c.html#a8">00162</a> <a class="code" href="print-dither-matrices_8c.html#a8">stp_dither_matrix_init_from_dither_array</a>(<a class="code" href="structdither__matrix__impl.html">stp_dither_matrix_impl_t</a> *mat,
00163                                          <span class="keyword">const</span> <a class="code" href="structstp__array.html">stp_array_t</a> *array,
00164                                          <span class="keywordtype">int</span> transpose)
00165 {
00166   <span class="keywordtype">int</span> x, y;
00167   size_t count;
00168   <span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">short</span> *vec;
00169   <span class="keywordtype">int</span> x_size, y_size;
00170   <span class="keyword">const</span> <a class="code" href="structstp__sequence.html">stp_sequence_t</a> *seq = <a class="code" href="group__array.html#ga13">stp_array_get_sequence</a>(array);
00171   <a class="code" href="group__array.html#ga8">stp_array_get_size</a>(array, &amp;x_size, &amp;y_size);
00172 
00173   vec = <a class="code" href="group__sequence.html#ga28">stp_sequence_get_ushort_data</a>(seq, &amp;count);
00174   mat-&gt;<a class="code" href="structdither__matrix__impl.html#o0">base</a> = x_size;;
00175   mat-&gt;<a class="code" href="structdither__matrix__impl.html#o1">exp</a> = 1;
00176   mat-&gt;<a class="code" href="structdither__matrix__impl.html#o2">x_size</a> = x_size;
00177   mat-&gt;<a class="code" href="structdither__matrix__impl.html#o3">y_size</a> = y_size;
00178   mat-&gt;<a class="code" href="structdither__matrix__impl.html#o4">total_size</a> = mat-&gt;<a class="code" href="structdither__matrix__impl.html#o2">x_size</a> * mat-&gt;<a class="code" href="structdither__matrix__impl.html#o3">y_size</a>;
00179   mat-&gt;<a class="code" href="structdither__matrix__impl.html#o14">matrix</a> = <a class="code" href="group__util.html#ga28">stp_malloc</a>(<span class="keyword">sizeof</span>(<span class="keywordtype">unsigned</span>) * mat-&gt;<a class="code" href="structdither__matrix__impl.html#o2">x_size</a> * mat-&gt;<a class="code" href="structdither__matrix__impl.html#o3">y_size</a>);
00180   <span class="keywordflow">for</span> (x = 0; x &lt; mat-&gt;<a class="code" href="structdither__matrix__impl.html#o2">x_size</a>; x++)
00181     <span class="keywordflow">for</span> (y = 0; y &lt; mat-&gt;<a class="code" href="structdither__matrix__impl.html#o3">y_size</a>; y++)
00182       {
00183         <span class="keywordflow">if</span> (transpose)
00184           mat-&gt;<a class="code" href="structdither__matrix__impl.html#o14">matrix</a>[x + y * mat-&gt;<a class="code" href="structdither__matrix__impl.html#o2">x_size</a>] = vec[y + x * mat-&gt;<a class="code" href="structdither__matrix__impl.html#o3">y_size</a>];
00185         <span class="keywordflow">else</span>
00186           mat-&gt;<a class="code" href="structdither__matrix__impl.html#o14">matrix</a>[x + y * mat-&gt;<a class="code" href="structdither__matrix__impl.html#o2">x_size</a>] = vec[x + y * mat-&gt;<a class="code" href="structdither__matrix__impl.html#o2">x_size</a>];
00187       }
00188   mat-&gt;<a class="code" href="structdither__matrix__impl.html#o5">last_x</a> = mat-&gt;<a class="code" href="structdither__matrix__impl.html#o6">last_x_mod</a> = 0;
00189   mat-&gt;<a class="code" href="structdither__matrix__impl.html#o7">last_y</a> = mat-&gt;<a class="code" href="structdither__matrix__impl.html#o8">last_y_mod</a> = 0;
00190   mat-&gt;<a class="code" href="structdither__matrix__impl.html#o9">index</a> = 0;
00191   mat-&gt;<a class="code" href="structdither__matrix__impl.html#o10">i_own</a> = 1;
00192   <span class="keywordflow">if</span> (<a class="code" href="print-dither-matrices_8c.html#a4">is_po2</a>(mat-&gt;<a class="code" href="structdither__matrix__impl.html#o2">x_size</a>))
00193     mat-&gt;<a class="code" href="structdither__matrix__impl.html#o13">fast_mask</a> = mat-&gt;<a class="code" href="structdither__matrix__impl.html#o2">x_size</a> - 1;
00194   <span class="keywordflow">else</span>
00195     mat-&gt;<a class="code" href="structdither__matrix__impl.html#o13">fast_mask</a> = 0;
00196 }
00197 
00198 
00199 <span class="keywordtype">void</span>
<a name="l00200"></a><a class="code" href="print-dither-matrices_8c.html#a9">00200</a> <a class="code" href="print-dither-matrices_8c.html#a9">stp_dither_matrix_init</a>(<a class="code" href="structdither__matrix__impl.html">stp_dither_matrix_impl_t</a> *mat, <span class="keywordtype">int</span> x_size, <span class="keywordtype">int</span> y_size,
00201                        <span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> *array, <span class="keywordtype">int</span> transpose, <span class="keywordtype">int</span> prescaled)
00202 {
00203   <span class="keywordtype">int</span> x, y;
00204   mat-&gt;<a class="code" href="structdither__matrix__impl.html#o0">base</a> = x_size;
00205   mat-&gt;<a class="code" href="structdither__matrix__impl.html#o1">exp</a> = 1;
00206   mat-&gt;<a class="code" href="structdither__matrix__impl.html#o2">x_size</a> = x_size;
00207   mat-&gt;<a class="code" href="structdither__matrix__impl.html#o3">y_size</a> = y_size;
00208   mat-&gt;<a class="code" href="structdither__matrix__impl.html#o4">total_size</a> = mat-&gt;<a class="code" href="structdither__matrix__impl.html#o2">x_size</a> * mat-&gt;<a class="code" href="structdither__matrix__impl.html#o3">y_size</a>;
00209   mat-&gt;<a class="code" href="structdither__matrix__impl.html#o14">matrix</a> = <a class="code" href="group__util.html#ga28">stp_malloc</a>(<span class="keyword">sizeof</span>(<span class="keywordtype">unsigned</span>) * mat-&gt;<a class="code" href="structdither__matrix__impl.html#o2">x_size</a> * mat-&gt;<a class="code" href="structdither__matrix__impl.html#o3">y_size</a>);
00210   <span class="keywordflow">for</span> (x = 0; x &lt; mat-&gt;<a class="code" href="structdither__matrix__impl.html#o2">x_size</a>; x++)
00211     <span class="keywordflow">for</span> (y = 0; y &lt; mat-&gt;<a class="code" href="structdither__matrix__impl.html#o3">y_size</a>; y++)
00212       {
00213         <span class="keywordflow">if</span> (transpose)
00214           mat-&gt;<a class="code" href="structdither__matrix__impl.html#o14">matrix</a>[x + y * mat-&gt;<a class="code" href="structdither__matrix__impl.html#o2">x_size</a>] = array[y + x * mat-&gt;<a class="code" href="structdither__matrix__impl.html#o3">y_size</a>];
00215         <span class="keywordflow">else</span>
00216           mat-&gt;<a class="code" href="structdither__matrix__impl.html#o14">matrix</a>[x + y * mat-&gt;<a class="code" href="structdither__matrix__impl.html#o2">x_size</a>] = array[x + y * mat-&gt;<a class="code" href="structdither__matrix__impl.html#o2">x_size</a>];
00217         <span class="keywordflow">if</span> (!prescaled)
00218           mat-&gt;<a class="code" href="structdither__matrix__impl.html#o14">matrix</a>[x + y * mat-&gt;<a class="code" href="structdither__matrix__impl.html#o2">x_size</a>] =
00219             (<span class="keywordtype">double</span>) mat-&gt;<a class="code" href="structdither__matrix__impl.html#o14">matrix</a>[x + y * mat-&gt;<a class="code" href="structdither__matrix__impl.html#o2">x_size</a>] * 65536.0 /
00220             (<span class="keywordtype">double</span>) (mat-&gt;<a class="code" href="structdither__matrix__impl.html#o2">x_size</a> * mat-&gt;<a class="code" href="structdither__matrix__impl.html#o3">y_size</a>);
00221       }
00222   mat-&gt;<a class="code" href="structdither__matrix__impl.html#o5">last_x</a> = mat-&gt;<a class="code" href="structdither__matrix__impl.html#o6">last_x_mod</a> = 0;
00223   mat-&gt;<a class="code" href="structdither__matrix__impl.html#o7">last_y</a> = mat-&gt;<a class="code" href="structdither__matrix__impl.html#o8">last_y_mod</a> = 0;
00224   mat-&gt;<a class="code" href="structdither__matrix__impl.html#o9">index</a> = 0;
00225   mat-&gt;<a class="code" href="structdither__matrix__impl.html#o10">i_own</a> = 1;
00226   <span class="keywordflow">if</span> (<a class="code" href="print-dither-matrices_8c.html#a4">is_po2</a>(mat-&gt;<a class="code" href="structdither__matrix__impl.html#o2">x_size</a>))
00227     mat-&gt;<a class="code" href="structdither__matrix__impl.html#o13">fast_mask</a> = mat-&gt;<a class="code" href="structdither__matrix__impl.html#o2">x_size</a> - 1;
00228   <span class="keywordflow">else</span>
00229     mat-&gt;<a class="code" href="structdither__matrix__impl.html#o13">fast_mask</a> = 0;
00230 }
00231 
00232 <span class="keywordtype">void</span>
<a name="l00233"></a><a class="code" href="print-dither-matrices_8c.html#a10">00233</a> <a class="code" href="print-dither-matrices_8c.html#a10">stp_dither_matrix_init_short</a>(<a class="code" href="structdither__matrix__impl.html">stp_dither_matrix_impl_t</a> *mat, <span class="keywordtype">int</span> x_size, <span class="keywordtype">int</span> y_size,
00234                              <span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">short</span> *array, <span class="keywordtype">int</span> transpose,
00235                              <span class="keywordtype">int</span> prescaled)
00236 {
00237   <span class="keywordtype">int</span> x, y;
00238   mat-&gt;<a class="code" href="structdither__matrix__impl.html#o0">base</a> = x_size;
00239   mat-&gt;<a class="code" href="structdither__matrix__impl.html#o1">exp</a> = 1;
00240   mat-&gt;<a class="code" href="structdither__matrix__impl.html#o2">x_size</a> = x_size;
00241   mat-&gt;<a class="code" href="structdither__matrix__impl.html#o3">y_size</a> = y_size;
00242   mat-&gt;<a class="code" href="structdither__matrix__impl.html#o4">total_size</a> = mat-&gt;<a class="code" href="structdither__matrix__impl.html#o2">x_size</a> * mat-&gt;<a class="code" href="structdither__matrix__impl.html#o3">y_size</a>;
00243   mat-&gt;<a class="code" href="structdither__matrix__impl.html#o14">matrix</a> = <a class="code" href="group__util.html#ga28">stp_malloc</a>(<span class="keyword">sizeof</span>(<span class="keywordtype">unsigned</span>) * mat-&gt;<a class="code" href="structdither__matrix__impl.html#o2">x_size</a> * mat-&gt;<a class="code" href="structdither__matrix__impl.html#o3">y_size</a>);
00244   <span class="keywordflow">for</span> (x = 0; x &lt; mat-&gt;<a class="code" href="structdither__matrix__impl.html#o2">x_size</a>; x++)
00245     <span class="keywordflow">for</span> (y = 0; y &lt; mat-&gt;<a class="code" href="structdither__matrix__impl.html#o3">y_size</a>; y++)
00246       {
00247         <span class="keywordflow">if</span> (transpose)
00248           mat-&gt;<a class="code" href="structdither__matrix__impl.html#o14">matrix</a>[x + y * mat-&gt;<a class="code" href="structdither__matrix__impl.html#o2">x_size</a>] = array[y + x * mat-&gt;<a class="code" href="structdither__matrix__impl.html#o3">y_size</a>];
00249         <span class="keywordflow">else</span>
00250           mat-&gt;<a class="code" href="structdither__matrix__impl.html#o14">matrix</a>[x + y * mat-&gt;<a class="code" href="structdither__matrix__impl.html#o2">x_size</a>] = array[x + y * mat-&gt;<a class="code" href="structdither__matrix__impl.html#o2">x_size</a>];
00251         <span class="keywordflow">if</span> (!prescaled)
00252           mat-&gt;<a class="code" href="structdither__matrix__impl.html#o14">matrix</a>[x + y * mat-&gt;<a class="code" href="structdither__matrix__impl.html#o2">x_size</a>] =
00253             (<span class="keywordtype">double</span>) mat-&gt;<a class="code" href="structdither__matrix__impl.html#o14">matrix</a>[x + y * mat-&gt;<a class="code" href="structdither__matrix__impl.html#o2">x_size</a>] * 65536.0 /
00254             (<span class="keywordtype">double</span>) (mat-&gt;<a class="code" href="structdither__matrix__impl.html#o2">x_size</a> * mat-&gt;<a class="code" href="structdither__matrix__impl.html#o3">y_size</a>);
00255       }
00256   mat-&gt;<a class="code" href="structdither__matrix__impl.html#o5">last_x</a> = mat-&gt;<a class="code" href="structdither__matrix__impl.html#o6">last_x_mod</a> = 0;
00257   mat-&gt;<a class="code" href="structdither__matrix__impl.html#o7">last_y</a> = mat-&gt;<a class="code" href="structdither__matrix__impl.html#o8">last_y_mod</a> = 0;
00258   mat-&gt;<a class="code" href="structdither__matrix__impl.html#o9">index</a> = 0;
00259   mat-&gt;<a class="code" href="structdither__matrix__impl.html#o10">i_own</a> = 1;
00260   <span class="keywordflow">if</span> (<a class="code" href="print-dither-matrices_8c.html#a4">is_po2</a>(mat-&gt;<a class="code" href="structdither__matrix__impl.html#o2">x_size</a>))
00261     mat-&gt;<a class="code" href="structdither__matrix__impl.html#o13">fast_mask</a> = mat-&gt;<a class="code" href="structdither__matrix__impl.html#o2">x_size</a> - 1;
00262   <span class="keywordflow">else</span>
00263     mat-&gt;<a class="code" href="structdither__matrix__impl.html#o13">fast_mask</a> = 0;
00264 }
00265 
00266 <span class="keywordtype">void</span>
<a name="l00267"></a><a class="code" href="print-dither-matrices_8c.html#a11">00267</a> <a class="code" href="print-dither-matrices_8c.html#a11">stp_dither_matrix_destroy</a>(<a class="code" href="structdither__matrix__impl.html">stp_dither_matrix_impl_t</a> *mat)
00268 {
00269   <span class="keywordflow">if</span> (mat-&gt;<a class="code" href="structdither__matrix__impl.html#o10">i_own</a> &amp;&amp; mat-&gt;<a class="code" href="structdither__matrix__impl.html#o14">matrix</a>)
00270     <a class="code" href="group__util.html#ga31">stp_free</a>(mat-&gt;<a class="code" href="structdither__matrix__impl.html#o14">matrix</a>);
00271   mat-&gt;<a class="code" href="structdither__matrix__impl.html#o14">matrix</a> = NULL;
00272   mat-&gt;<a class="code" href="structdither__matrix__impl.html#o0">base</a> = 0;
00273   mat-&gt;<a class="code" href="structdither__matrix__impl.html#o1">exp</a> = 0;
00274   mat-&gt;<a class="code" href="structdither__matrix__impl.html#o2">x_size</a> = 0;
00275   mat-&gt;<a class="code" href="structdither__matrix__impl.html#o3">y_size</a> = 0;
00276   mat-&gt;<a class="code" href="structdither__matrix__impl.html#o4">total_size</a> = 0;
00277   mat-&gt;<a class="code" href="structdither__matrix__impl.html#o10">i_own</a> = 0;
00278 }
00279 
00280 <span class="keywordtype">void</span>
<a name="l00281"></a><a class="code" href="print-dither-matrices_8c.html#a12">00281</a> <a class="code" href="print-dither-matrices_8c.html#a12">stp_dither_matrix_clone</a>(<span class="keyword">const</span> <a class="code" href="structdither__matrix__impl.html">stp_dither_matrix_impl_t</a> *src, <a class="code" href="structdither__matrix__impl.html">stp_dither_matrix_impl_t</a> *dest,
00282                         <span class="keywordtype">int</span> x_offset, <span class="keywordtype">int</span> y_offset)
00283 {
00284   dest-&gt;<a class="code" href="structdither__matrix__impl.html#o0">base</a> = src-&gt;<a class="code" href="structdither__matrix__impl.html#o0">base</a>;
00285   dest-&gt;<a class="code" href="structdither__matrix__impl.html#o1">exp</a> = src-&gt;<a class="code" href="structdither__matrix__impl.html#o1">exp</a>;
00286   dest-&gt;<a class="code" href="structdither__matrix__impl.html#o2">x_size</a> = src-&gt;<a class="code" href="structdither__matrix__impl.html#o2">x_size</a>;
00287   dest-&gt;<a class="code" href="structdither__matrix__impl.html#o3">y_size</a> = src-&gt;<a class="code" href="structdither__matrix__impl.html#o3">y_size</a>;
00288   dest-&gt;<a class="code" href="structdither__matrix__impl.html#o4">total_size</a> = src-&gt;<a class="code" href="structdither__matrix__impl.html#o4">total_size</a>;
00289   dest-&gt;<a class="code" href="structdither__matrix__impl.html#o14">matrix</a> = src-&gt;<a class="code" href="structdither__matrix__impl.html#o14">matrix</a>;
00290   dest-&gt;<a class="code" href="structdither__matrix__impl.html#o11">x_offset</a> = x_offset;
00291   dest-&gt;<a class="code" href="structdither__matrix__impl.html#o12">y_offset</a> = y_offset;
00292   dest-&gt;<a class="code" href="structdither__matrix__impl.html#o5">last_x</a> = 0;
00293   dest-&gt;<a class="code" href="structdither__matrix__impl.html#o6">last_x_mod</a> = dest-&gt;<a class="code" href="structdither__matrix__impl.html#o11">x_offset</a> % dest-&gt;<a class="code" href="structdither__matrix__impl.html#o2">x_size</a>;
00294   dest-&gt;<a class="code" href="structdither__matrix__impl.html#o7">last_y</a> = 0;
00295   dest-&gt;<a class="code" href="structdither__matrix__impl.html#o8">last_y_mod</a> = dest-&gt;<a class="code" href="structdither__matrix__impl.html#o2">x_size</a> * (dest-&gt;<a class="code" href="structdither__matrix__impl.html#o12">y_offset</a> % dest-&gt;<a class="code" href="structdither__matrix__impl.html#o3">y_size</a>);
00296   dest-&gt;<a class="code" href="structdither__matrix__impl.html#o9">index</a> = dest-&gt;<a class="code" href="structdither__matrix__impl.html#o6">last_x_mod</a> + dest-&gt;<a class="code" href="structdither__matrix__impl.html#o8">last_y_mod</a>;
00297   dest-&gt;<a class="code" href="structdither__matrix__impl.html#o13">fast_mask</a> = src-&gt;<a class="code" href="structdither__matrix__impl.html#o13">fast_mask</a>;
00298   dest-&gt;<a class="code" href="structdither__matrix__impl.html#o10">i_own</a> = 0;
00299 }
00300 
00301 <span class="keywordtype">void</span>
<a name="l00302"></a><a class="code" href="print-dither-matrices_8c.html#a13">00302</a> <a class="code" href="print-dither-matrices_8c.html#a13">stp_dither_matrix_copy</a>(<span class="keyword">const</span> <a class="code" href="structdither__matrix__impl.html">stp_dither_matrix_impl_t</a> *src, <a class="code" href="structdither__matrix__impl.html">stp_dither_matrix_impl_t</a> *dest)
00303 {
00304   <span class="keywordtype">int</span> x;
00305   dest-&gt;<a class="code" href="structdither__matrix__impl.html#o0">base</a> = src-&gt;<a class="code" href="structdither__matrix__impl.html#o0">base</a>;
00306   dest-&gt;<a class="code" href="structdither__matrix__impl.html#o1">exp</a> = src-&gt;<a class="code" href="structdither__matrix__impl.html#o1">exp</a>;
00307   dest-&gt;<a class="code" href="structdither__matrix__impl.html#o2">x_size</a> = src-&gt;<a class="code" href="structdither__matrix__impl.html#o2">x_size</a>;
00308   dest-&gt;<a class="code" href="structdither__matrix__impl.html#o3">y_size</a> = src-&gt;<a class="code" href="structdither__matrix__impl.html#o3">y_size</a>;
00309   dest-&gt;<a class="code" href="structdither__matrix__impl.html#o4">total_size</a> = src-&gt;<a class="code" href="structdither__matrix__impl.html#o4">total_size</a>;
00310   dest-&gt;<a class="code" href="structdither__matrix__impl.html#o14">matrix</a> = <a class="code" href="group__util.html#ga28">stp_malloc</a>(<span class="keyword">sizeof</span>(<span class="keywordtype">unsigned</span>) * dest-&gt;<a class="code" href="structdither__matrix__impl.html#o2">x_size</a> * dest-&gt;<a class="code" href="structdither__matrix__impl.html#o3">y_size</a>);
00311   <span class="keywordflow">for</span> (x = 0; x &lt; dest-&gt;<a class="code" href="structdither__matrix__impl.html#o2">x_size</a> * dest-&gt;<a class="code" href="structdither__matrix__impl.html#o3">y_size</a>; x++)
00312     dest-&gt;<a class="code" href="structdither__matrix__impl.html#o14">matrix</a>[x] = src-&gt;<a class="code" href="structdither__matrix__impl.html#o14">matrix</a>[x];
00313   dest-&gt;<a class="code" href="structdither__matrix__impl.html#o11">x_offset</a> = 0;
00314   dest-&gt;<a class="code" href="structdither__matrix__impl.html#o12">y_offset</a> = 0;
00315   dest-&gt;<a class="code" href="structdither__matrix__impl.html#o5">last_x</a> = 0;
00316   dest-&gt;<a class="code" href="structdither__matrix__impl.html#o6">last_x_mod</a> = 0;
00317   dest-&gt;<a class="code" href="structdither__matrix__impl.html#o7">last_y</a> = 0;
00318   dest-&gt;<a class="code" href="structdither__matrix__impl.html#o8">last_y_mod</a> = 0;
00319   dest-&gt;<a class="code" href="structdither__matrix__impl.html#o9">index</a> = 0;
00320   dest-&gt;<a class="code" href="structdither__matrix__impl.html#o13">fast_mask</a> = src-&gt;<a class="code" href="structdither__matrix__impl.html#o13">fast_mask</a>;
00321   dest-&gt;<a class="code" href="structdither__matrix__impl.html#o10">i_own</a> = 1;
00322 }
00323 
00324 <span class="keywordtype">void</span>
<a name="l00325"></a><a class="code" href="print-dither-matrices_8c.html#a14">00325</a> <a class="code" href="print-dither-matrices_8c.html#a14">stp_dither_matrix_scale_exponentially</a>(<a class="code" href="structdither__matrix__impl.html">stp_dither_matrix_impl_t</a> *mat, <span class="keywordtype">double</span> exponent)
00326 {
00327   <span class="keywordtype">int</span> i;
00328   <span class="keywordtype">int</span> mat_size = mat-&gt;<a class="code" href="structdither__matrix__impl.html#o2">x_size</a> * mat-&gt;<a class="code" href="structdither__matrix__impl.html#o3">y_size</a>;
00329   <span class="keywordflow">for</span> (i = 0; i &lt; mat_size; i++)
00330     {
00331       <span class="keywordtype">double</span> dd = mat-&gt;<a class="code" href="structdither__matrix__impl.html#o14">matrix</a>[i] / 65535.0;
00332       dd = pow(dd, exponent);
00333       mat-&gt;<a class="code" href="structdither__matrix__impl.html#o14">matrix</a>[i] = 65535 * dd;
00334     }
00335 }
00336 
00337 <span class="keywordtype">void</span>
<a name="l00338"></a><a class="code" href="print-dither-matrices_8c.html#a15">00338</a> <a class="code" href="print-dither-matrices_8c.html#a15">stp_dither_matrix_set_row</a>(<a class="code" href="structdither__matrix__impl.html">stp_dither_matrix_impl_t</a> *mat, <span class="keywordtype">int</span> y)
00339 {
00340   mat-&gt;<a class="code" href="structdither__matrix__impl.html#o7">last_y</a> = y;
00341   mat-&gt;<a class="code" href="structdither__matrix__impl.html#o8">last_y_mod</a> = mat-&gt;<a class="code" href="structdither__matrix__impl.html#o2">x_size</a> * ((y + mat-&gt;<a class="code" href="structdither__matrix__impl.html#o12">y_offset</a>) % mat-&gt;<a class="code" href="structdither__matrix__impl.html#o3">y_size</a>);
00342   mat-&gt;<a class="code" href="structdither__matrix__impl.html#o9">index</a> = mat-&gt;<a class="code" href="structdither__matrix__impl.html#o6">last_x_mod</a> + mat-&gt;<a class="code" href="structdither__matrix__impl.html#o8">last_y_mod</a>;
00343 }
00344 
00345 <span class="keyword">static</span> <span class="keywordtype">void</span>
<a name="l00346"></a><a class="code" href="print-dither-matrices_8c.html#a16">00346</a> <a class="code" href="print-dither-matrices_8c.html#a16">preinit_matrix</a>(<a class="code" href="structstp__vars.html">stp_vars_t</a> *v)
00347 {
00348   <a class="code" href="structdither.html">stpi_dither_t</a> *d = (<a class="code" href="structdither.html">stpi_dither_t</a> *) <a class="code" href="group__vars.html#ga20">stp_get_component_data</a>(v, <span class="stringliteral">"Dither"</span>);
00349   <span class="keywordtype">int</span> i;
00350   <span class="keywordflow">for</span> (i = 0; i &lt; <a class="code" href="dither-impl_8h.html#a17">CHANNEL_COUNT</a>(d); i++)
00351     <a class="code" href="print-dither-matrices_8c.html#a11">stp_dither_matrix_destroy</a>(&amp;(<a class="code" href="dither-impl_8h.html#a16">CHANNEL</a>(d, i).dithermat));
00352   <a class="code" href="print-dither-matrices_8c.html#a11">stp_dither_matrix_destroy</a>(&amp;(d-&gt;<a class="code" href="structdither.html#o16">dither_matrix</a>));
00353 }
00354 
00355 <span class="keyword">static</span> <span class="keywordtype">void</span>
<a name="l00356"></a><a class="code" href="print-dither-matrices_8c.html#a17">00356</a> <a class="code" href="print-dither-matrices_8c.html#a17">postinit_matrix</a>(<a class="code" href="structstp__vars.html">stp_vars_t</a> *v, <span class="keywordtype">int</span> x_shear, <span class="keywordtype">int</span> y_shear)
00357 {
00358   <a class="code" href="structdither.html">stpi_dither_t</a> *d = (<a class="code" href="structdither.html">stpi_dither_t</a> *) <a class="code" href="group__vars.html#ga20">stp_get_component_data</a>(v, <span class="stringliteral">"Dither"</span>);
00359   <span class="keywordtype">unsigned</span> rc = 1 + (<span class="keywordtype">unsigned</span>) ceil(sqrt(<a class="code" href="dither-impl_8h.html#a17">CHANNEL_COUNT</a>(d)));
00360   <span class="keywordtype">int</span> i, j;
00361   <span class="keywordtype">int</span> color = 0;
00362   <span class="keywordtype">unsigned</span> x_n = d-&gt;<a class="code" href="structdither.html#o16">dither_matrix</a>.<a class="code" href="structdither__matrix__impl.html#o2">x_size</a> / rc;
00363   <span class="keywordtype">unsigned</span> y_n = d-&gt;<a class="code" href="structdither.html#o16">dither_matrix</a>.<a class="code" href="structdither__matrix__impl.html#o3">y_size</a> / rc;
00364   <span class="keywordflow">if</span> (x_shear || y_shear)
00365     <a class="code" href="print-dither-matrices_8c.html#a6">stp_dither_matrix_shear</a>(&amp;(d-&gt;<a class="code" href="structdither.html#o16">dither_matrix</a>), x_shear, y_shear);
00366   <span class="keywordflow">for</span> (i = 0; i &lt; rc; i++)
00367     <span class="keywordflow">for</span> (j = 0; j &lt; rc; j++)
00368       <span class="keywordflow">if</span> (color &lt; <a class="code" href="dither-impl_8h.html#a17">CHANNEL_COUNT</a>(d))
00369         {
00370           <a class="code" href="print-dither-matrices_8c.html#a12">stp_dither_matrix_clone</a>(&amp;(d-&gt;<a class="code" href="structdither.html#o16">dither_matrix</a>),
00371                                   &amp;(<a class="code" href="dither-impl_8h.html#a16">CHANNEL</a>(d, color).dithermat),
00372                                   x_n * i, y_n * j);
00373           color++;
00374         }
00375   <a class="code" href="print-dither-matrices_8c.html#a21">stp_dither_set_transition</a>(v, d-&gt;<a class="code" href="structdither.html#o8">transition</a>);
00376 }
00377 
00378 <span class="keywordtype">void</span>
<a name="l00379"></a><a class="code" href="print-dither-matrices_8c.html#a18">00379</a> <a class="code" href="print-dither-matrices_8c.html#a18">stp_dither_set_iterated_matrix</a>(<a class="code" href="structstp__vars.html">stp_vars_t</a> *v, size_t edge, size_t iterations,
00380                                <span class="keyword">const</span> <span class="keywordtype">unsigned</span> *data, <span class="keywordtype">int</span> prescaled,
00381                                <span class="keywordtype">int</span> x_shear, <span class="keywordtype">int</span> y_shear)
00382 {
00383   <a class="code" href="structdither.html">stpi_dither_t</a> *d = (<a class="code" href="structdither.html">stpi_dither_t</a> *) <a class="code" href="group__vars.html#ga20">stp_get_component_data</a>(v, <span class="stringliteral">"Dither"</span>);
00384   <a class="code" href="print-dither-matrices_8c.html#a16">preinit_matrix</a>(v);
00385   <a class="code" href="print-dither-matrices_8c.html#a5">stp_dither_matrix_iterated_init</a>(&amp;(d-&gt;<a class="code" href="structdither.html#o16">dither_matrix</a>), edge, iterations, data);
00386   <a class="code" href="print-dither-matrices_8c.html#a17">postinit_matrix</a>(v, x_shear, y_shear);
00387 }
00388 
00389 <span class="keywordtype">void</span>
<a name="l00390"></a><a class="code" href="print-dither-matrices_8c.html#a19">00390</a> <a class="code" href="print-dither-matrices_8c.html#a19">stp_dither_set_matrix</a>(<a class="code" href="structstp__vars.html">stp_vars_t</a> *v, <span class="keyword">const</span> <a class="code" href="structstp__dither__matrix__generic.html">stp_dither_matrix_generic_t</a> *matrix,
00391                       <span class="keywordtype">int</span> transposed, <span class="keywordtype">int</span> x_shear, <span class="keywordtype">int</span> y_shear)
00392 {
00393   <a class="code" href="structdither.html">stpi_dither_t</a> *d = (<a class="code" href="structdither.html">stpi_dither_t</a> *) <a class="code" href="group__vars.html#ga20">stp_get_component_data</a>(v, <span class="stringliteral">"Dither"</span>);
00394   <span class="keywordtype">int</span> x = transposed ? matrix-&gt;<a class="code" href="structstp__dither__matrix__generic.html#o1">y</a> : matrix-&gt;<a class="code" href="structstp__dither__matrix__generic.html#o0">x</a>;
00395   <span class="keywordtype">int</span> y = transposed ? matrix-&gt;<a class="code" href="structstp__dither__matrix__generic.html#o0">x</a> : matrix-&gt;<a class="code" href="structstp__dither__matrix__generic.html#o1">y</a>;
00396   <a class="code" href="print-dither-matrices_8c.html#a16">preinit_matrix</a>(v);
00397   <span class="keywordflow">if</span> (matrix-&gt;<a class="code" href="structstp__dither__matrix__generic.html#o2">bytes</a> == 2)
00398     <a class="code" href="print-dither-matrices_8c.html#a10">stp_dither_matrix_init_short</a>(&amp;(d-&gt;<a class="code" href="structdither.html#o16">dither_matrix</a>), x, y,
00399                                  (<span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">short</span> *) matrix-&gt;<a class="code" href="structstp__dither__matrix__generic.html#o4">data</a>,
00400                                  transposed, matrix-&gt;<a class="code" href="structstp__dither__matrix__generic.html#o3">prescaled</a>);
00401   <span class="keywordflow">else</span> <span class="keywordflow">if</span> (matrix-&gt;<a class="code" href="structstp__dither__matrix__generic.html#o2">bytes</a> == 4)
00402     <a class="code" href="print-dither-matrices_8c.html#a9">stp_dither_matrix_init</a>(&amp;(d-&gt;<a class="code" href="structdither.html#o16">dither_matrix</a>), x, y,
00403                            (<span class="keyword">const</span> <span class="keywordtype">unsigned</span> *)matrix-&gt;<a class="code" href="structstp__dither__matrix__generic.html#o4">data</a>,
00404                            transposed, matrix-&gt;<a class="code" href="structstp__dither__matrix__generic.html#o3">prescaled</a>);
00405   <a class="code" href="print-dither-matrices_8c.html#a17">postinit_matrix</a>(v, x_shear, y_shear);
00406 }
00407 
00408 <span class="keywordtype">void</span>
<a name="l00409"></a><a class="code" href="print-dither-matrices_8c.html#a20">00409</a> <a class="code" href="print-dither-matrices_8c.html#a20">stp_dither_set_matrix_from_dither_array</a>(<a class="code" href="structstp__vars.html">stp_vars_t</a> *v,
00410                                         <span class="keyword">const</span> <a class="code" href="structstp__array.html">stp_array_t</a> *array,
00411                                         <span class="keywordtype">int</span> transpose)
00412 {
00413   <a class="code" href="structdither.html">stpi_dither_t</a> *d = (<a class="code" href="structdither.html">stpi_dither_t</a> *) <a class="code" href="group__vars.html#ga20">stp_get_component_data</a>(v, <span class="stringliteral">"Dither"</span>);
00414   <a class="code" href="print-dither-matrices_8c.html#a16">preinit_matrix</a>(v);
00415   <a class="code" href="print-dither-matrices_8c.html#a8">stp_dither_matrix_init_from_dither_array</a>(&amp;(d-&gt;<a class="code" href="structdither.html#o16">dither_matrix</a>), array, transpose);
00416   <a class="code" href="print-dither-matrices_8c.html#a17">postinit_matrix</a>(v, 0, 0);
00417 }
00418 
00419 <span class="keywordtype">void</span>
<a name="l00420"></a><a class="code" href="print-dither-matrices_8c.html#a21">00420</a> <a class="code" href="print-dither-matrices_8c.html#a21">stp_dither_set_transition</a>(<a class="code" href="structstp__vars.html">stp_vars_t</a> *v, <span class="keywordtype">double</span> exponent)
00421 {
00422   <a class="code" href="structdither.html">stpi_dither_t</a> *d = (<a class="code" href="structdither.html">stpi_dither_t</a> *) <a class="code" href="group__vars.html#ga20">stp_get_component_data</a>(v, <span class="stringliteral">"Dither"</span>);
00423   <span class="keywordtype">unsigned</span> rc = 1 + (<span class="keywordtype">unsigned</span>) ceil(sqrt(<a class="code" href="dither-impl_8h.html#a17">CHANNEL_COUNT</a>(d)));
00424   <span class="keywordtype">int</span> i, j;
00425   <span class="keywordtype">int</span> color = 0;
00426   <span class="keywordtype">unsigned</span> x_n = d-&gt;<a class="code" href="structdither.html#o16">dither_matrix</a>.<a class="code" href="structdither__matrix__impl.html#o2">x_size</a> / rc;
00427   <span class="keywordtype">unsigned</span> y_n = d-&gt;<a class="code" href="structdither.html#o16">dither_matrix</a>.<a class="code" href="structdither__matrix__impl.html#o3">y_size</a> / rc;
00428   <span class="keywordflow">for</span> (i = 0; i &lt; <a class="code" href="dither-impl_8h.html#a17">CHANNEL_COUNT</a>(d); i++)
00429     <a class="code" href="print-dither-matrices_8c.html#a11">stp_dither_matrix_destroy</a>(&amp;(<a class="code" href="dither-impl_8h.html#a16">CHANNEL</a>(d, i).pick));
00430   <a class="code" href="print-dither-matrices_8c.html#a11">stp_dither_matrix_destroy</a>(&amp;(d-&gt;<a class="code" href="structdither.html#o17">transition_matrix</a>));
00431   <a class="code" href="print-dither-matrices_8c.html#a13">stp_dither_matrix_copy</a>(&amp;(d-&gt;<a class="code" href="structdither.html#o16">dither_matrix</a>), &amp;(d-&gt;<a class="code" href="structdither.html#o17">transition_matrix</a>));
00432   d-&gt;<a class="code" href="structdither.html#o8">transition</a> = exponent;
00433   <span class="keywordflow">if</span> (exponent &lt; .999 || exponent &gt; 1.001)
00434     <a class="code" href="print-dither-matrices_8c.html#a14">stp_dither_matrix_scale_exponentially</a>(&amp;(d-&gt;<a class="code" href="structdither.html#o17">transition_matrix</a>), exponent);
00435   <span class="keywordflow">for</span> (i = 0; i &lt; rc; i++)
00436     <span class="keywordflow">for</span> (j = 0; j &lt; rc; j++)
00437       <span class="keywordflow">if</span> (color &lt; <a class="code" href="dither-impl_8h.html#a17">CHANNEL_COUNT</a>(d))
00438         {
00439           <a class="code" href="print-dither-matrices_8c.html#a12">stp_dither_matrix_clone</a>(&amp;(d-&gt;<a class="code" href="structdither.html#o16">dither_matrix</a>),
00440                                   &amp;(<a class="code" href="dither-impl_8h.html#a16">CHANNEL</a>(d, color).pick),
00441                                   x_n * i, y_n * j);
00442           color++;
00443         }
00444 }
00445 
<a name="l00446"></a><a class="code" href="print-dither-matrices_8c.html#a1">00446</a> <span class="keyword">static</span> <a class="code" href="structstp__list.html">stp_list_t</a> *<a class="code" href="print-dither-matrices_8c.html#a1">dither_matrix_cache</a> = NULL;
00447 
<a name="l00448"></a><a class="code" href="structstp__xml__dither__cache__t.html">00448</a> <span class="keyword">typedef</span> <span class="keyword">struct</span>
00449 <span class="keyword"></span>{
<a name="l00450"></a><a class="code" href="structstp__xml__dither__cache__t.html#o0">00450</a>   <span class="keywordtype">int</span> x;
<a name="l00451"></a><a class="code" href="structstp__xml__dither__cache__t.html#o1">00451</a>   <span class="keywordtype">int</span> y;
<a name="l00452"></a><a class="code" href="structstp__xml__dither__cache__t.html#o2">00452</a>   <span class="keyword">const</span> <span class="keywordtype">char</span> *filename;
<a name="l00453"></a><a class="code" href="structstp__xml__dither__cache__t.html#o3">00453</a>   <span class="keyword">const</span> <a class="code" href="structstp__array.html">stp_array_t</a> *dither_array;
00454 } <a class="code" href="structstp__xml__dither__cache__t.html">stp_xml_dither_cache_t</a>;
00455 
00456 <span class="keyword">static</span> <a class="code" href="structstp__xml__dither__cache__t.html">stp_xml_dither_cache_t</a> *
<a name="l00457"></a><a class="code" href="print-dither-matrices_8c.html#a22">00457</a> <a class="code" href="print-dither-matrices_8c.html#a22">stp_xml_dither_cache_get</a>(<span class="keywordtype">int</span> x, <span class="keywordtype">int</span> y)
00458 {
00459   <a class="code" href="structstp__list__item.html">stp_list_item_t</a> *ln;
00460 
00461   <a class="code" href="print-util_8c.html#a24">stp_deprintf</a>(<a class="code" href="group__util.html#ga47">STP_DBG_XML</a>,
00462                <span class="stringliteral">"stp_xml_dither_cache_get: lookup %dx%d... "</span>, x, y);
00463   <span class="keywordflow">if</span> (!<a class="code" href="print-dither-matrices_8c.html#a1">dither_matrix_cache</a>)
00464     {
00465       <a class="code" href="print-util_8c.html#a24">stp_deprintf</a>(<a class="code" href="group__util.html#ga47">STP_DBG_XML</a>, <span class="stringliteral">"cache does not exist\n"</span>);
00466       <span class="keywordflow">return</span> NULL;
00467     }
00468 
00469   ln = <a class="code" href="print-list_8c.html#a12">stp_list_get_start</a>(<a class="code" href="print-dither-matrices_8c.html#a1">dither_matrix_cache</a>);
00470 
00471   <span class="keywordflow">while</span> (ln)
00472     {
00473       <span class="keywordflow">if</span> (((<a class="code" href="structstp__xml__dither__cache__t.html">stp_xml_dither_cache_t</a> *) <a class="code" href="print-list_8c.html#a33">stp_list_item_get_data</a>(ln))-&gt;x == x &amp;&amp;
00474           ((<a class="code" href="structstp__xml__dither__cache__t.html">stp_xml_dither_cache_t</a> *) <a class="code" href="print-list_8c.html#a33">stp_list_item_get_data</a>(ln))-&gt;y == y)
00475         {
00476 
00477           <a class="code" href="print-util_8c.html#a24">stp_deprintf</a>(<a class="code" href="group__util.html#ga47">STP_DBG_XML</a>, <span class="stringliteral">"found\n"</span>);
00478 
00479           <span class="keywordflow">return</span> ((<a class="code" href="structstp__xml__dither__cache__t.html">stp_xml_dither_cache_t</a> *) <a class="code" href="print-list_8c.html#a33">stp_list_item_get_data</a>(ln));
00480         }
00481       ln = <a class="code" href="print-list_8c.html#a32">stp_list_item_next</a>(ln);
00482     }
00483   <a class="code" href="print-util_8c.html#a24">stp_deprintf</a>(<a class="code" href="group__util.html#ga47">STP_DBG_XML</a>, <span class="stringliteral">"missing\n"</span>);
00484 
00485   <span class="keywordflow">return</span> NULL;
00486 }
00487 
00488 <span class="keyword">static</span> <span class="keywordtype">void</span>
<a name="l00489"></a><a class="code" href="print-dither-matrices_8c.html#a23">00489</a> <a class="code" href="print-dither-matrices_8c.html#a23">stp_xml_dither_cache_set</a>(<span class="keywordtype">int</span> x, <span class="keywordtype">int</span> y, <span class="keyword">const</span> <span class="keywordtype">char</span> *filename)
00490 {
00491   <a class="code" href="structstp__xml__dither__cache__t.html">stp_xml_dither_cache_t</a> *cacheval;
00492 
00493   <a class="code" href="print-weave_8c.html#a1">assert</a>(x &amp;&amp; y &amp;&amp; filename);
00494 
00495   <a class="code" href="xml_8h.html#a10">stp_xml_init</a>();
00496 
00497   <span class="keywordflow">if</span> (<a class="code" href="print-dither-matrices_8c.html#a1">dither_matrix_cache</a> == NULL)
00498     <a class="code" href="print-dither-matrices_8c.html#a1">dither_matrix_cache</a> = <a class="code" href="list_8h.html#a7">stp_list_create</a>();
00499 
00500   <span class="keywordflow">if</span> (<a class="code" href="print-dither-matrices_8c.html#a22">stp_xml_dither_cache_get</a>(x, y))
00501       <span class="comment">/* Already cached for this x and y aspect */</span>
00502     <span class="keywordflow">return</span>;
00503 
00504   cacheval = <a class="code" href="group__util.html#ga28">stp_malloc</a>(<span class="keyword">sizeof</span>(<a class="code" href="structstp__xml__dither__cache__t.html">stp_xml_dither_cache_t</a>));
00505   cacheval-&gt;<a class="code" href="structstp__xml__dither__cache__t.html#o0">x</a> = x;
00506   cacheval-&gt;<a class="code" href="structstp__xml__dither__cache__t.html#o1">y</a> = y;
00507   cacheval-&gt;<a class="code" href="structstp__xml__dither__cache__t.html#o2">filename</a> = <a class="code" href="group__util.html#ga35">stp_strdup</a>(filename);
00508   cacheval-&gt;<a class="code" href="structstp__xml__dither__cache__t.html#o3">dither_array</a> = NULL;
00509 
00510   <a class="code" href="print-list_8c.html#a29">stp_list_item_create</a>(<a class="code" href="print-dither-matrices_8c.html#a1">dither_matrix_cache</a>, NULL, (<span class="keywordtype">void</span> *) cacheval);
00511 
00512   <a class="code" href="print-util_8c.html#a24">stp_deprintf</a>(<a class="code" href="group__util.html#ga47">STP_DBG_XML</a>, <span class="stringliteral">"stp_xml_dither_cache_set: added %dx%d\n"</span>, x, y);
00513 
00514   <a class="code" href="xml_8h.html#a11">stp_xml_exit</a>();
00515 
00516   <span class="keywordflow">return</span>;
00517 }
00518 
00519 <span class="comment">/*</span>
00520 <span class="comment"> * Parse the &lt;dither-matrix&gt; node.</span>
00521 <span class="comment"> */</span>
00522 <span class="keyword">static</span> <span class="keywordtype">int</span>
<a name="l00523"></a><a class="code" href="print-dither-matrices_8c.html#a24">00523</a> <a class="code" href="print-dither-matrices_8c.html#a24">stp_xml_process_dither_matrix</a>(<a class="code" href="structstp__mxml__node__s.html">stp_mxml_node_t</a> *dm,     <span class="comment">/* The dither matrix node */</span>
00524                                <span class="keyword">const</span> <span class="keywordtype">char</span> *file)  <span class="comment">/* Source file */</span>
00525                                
00526 {
00527   <span class="keyword">const</span> <span class="keywordtype">char</span> *value;
00528   <span class="keywordtype">int</span> x = -1;
00529   <span class="keywordtype">int</span> y = -1;
00530 
00531   value = <a class="code" href="mxml-attr_8c.html#a0">stp_mxmlElementGetAttr</a>(dm, <span class="stringliteral">"x-aspect"</span>);
00532   x = <a class="code" href="xml_8c.html#a21">stp_xmlstrtol</a>(value);
00533 
00534   value = <a class="code" href="mxml-attr_8c.html#a0">stp_mxmlElementGetAttr</a>(dm, <span class="stringliteral">"y-aspect"</span>);
00535   y = <a class="code" href="xml_8c.html#a21">stp_xmlstrtol</a>(value);
00536 
00537   <a class="code" href="print-util_8c.html#a24">stp_deprintf</a>(<a class="code" href="group__util.html#ga47">STP_DBG_XML</a>,
00538                <span class="stringliteral">"stp_xml_process_dither_matrix: x=%d, y=%d\n"</span>, x, y);
00539 
00540   <a class="code" href="print-dither-matrices_8c.html#a23">stp_xml_dither_cache_set</a>(x, y, file);
00541   <span class="keywordflow">return</span> 1;
00542 }
00543 
00544 <span class="keyword">static</span> <a class="code" href="structstp__array.html">stp_array_t</a> *
<a name="l00545"></a><a class="code" href="print-dither-matrices_8c.html#a25">00545</a> <a class="code" href="print-dither-matrices_8c.html#a25">stpi_dither_array_create_from_xmltree</a>(<a class="code" href="structstp__mxml__node__s.html">stp_mxml_node_t</a> *dm) <span class="comment">/* Dither matrix node */</span>
00546 {
00547   <span class="keyword">const</span> <span class="keywordtype">char</span> *stmp;
00548   <a class="code" href="structstp__mxml__node__s.html">stp_mxml_node_t</a> *child;
00549   <span class="keywordtype">int</span> x_aspect, y_aspect; <span class="comment">/* Dither matrix size */</span>
00550 
00551   <span class="comment">/* Get x-size */</span>
00552   stmp = <a class="code" href="mxml-attr_8c.html#a0">stp_mxmlElementGetAttr</a>(dm, <span class="stringliteral">"x-aspect"</span>);
00553   <span class="keywordflow">if</span> (stmp)
00554     {
00555       x_aspect = (<span class="keywordtype">int</span>) <a class="code" href="xml_8c.html#a22">stp_xmlstrtoul</a>(stmp);
00556     }
00557   <span class="keywordflow">else</span>
00558     {
00559       <a class="code" href="print-util_8c.html#a20">stp_erprintf</a>(<span class="stringliteral">"stpi_dither_array_create_from_xmltree: \"x-aspect\" missing\n"</span>);
00560       <span class="keywordflow">goto</span> error;
00561     }
00562   <span class="comment">/* Get y-size */</span>
00563   stmp = <a class="code" href="mxml-attr_8c.html#a0">stp_mxmlElementGetAttr</a>(dm, <span class="stringliteral">"y-aspect"</span>);
00564   <span class="keywordflow">if</span> (stmp)
00565     {
00566       y_aspect = (<span class="keywordtype">int</span>) <a class="code" href="xml_8c.html#a22">stp_xmlstrtoul</a>(stmp);
00567     }
00568   <span class="keywordflow">else</span>
00569     {
00570       <a class="code" href="print-util_8c.html#a20">stp_erprintf</a>(<span class="stringliteral">"stpi_dither_array_create_from_xmltree: \"y-aspect\" missing\n"</span>);
00571       <span class="keywordflow">goto</span> error;
00572     }
00573 
00574   <span class="comment">/* Now read in the array */</span>
00575   child = <a class="code" href="mxml-search_8c.html#a0">stp_mxmlFindElement</a>(dm, dm, <span class="stringliteral">"array"</span>, NULL, NULL, <a class="code" href="mxml_8h.html#a4">STP_MXML_DESCEND</a>);
00576   <span class="keywordflow">if</span> (child)
00577     <span class="keywordflow">return</span> <a class="code" href="array_8c.html#a14">stp_array_create_from_xmltree</a>(child);
00578   <span class="keywordflow">else</span>
00579     <a class="code" href="print-util_8c.html#a20">stp_erprintf</a>(<span class="stringliteral">"stpi_dither_array_create_from_xmltree: cannot find root\n"</span>);
00580  error:
00581   <span class="keywordflow">return</span> NULL;
00582 }
00583 
00584 <span class="keyword">static</span> <a class="code" href="structstp__array.html">stp_array_t</a> *
<a name="l00585"></a><a class="code" href="print-dither-matrices_8c.html#a26">00585</a> <a class="code" href="print-dither-matrices_8c.html#a26">xml_doc_get_dither_array</a>(<a class="code" href="structstp__mxml__node__s.html">stp_mxml_node_t</a> *doc)
00586 {
00587   <a class="code" href="structstp__mxml__node__s.html">stp_mxml_node_t</a> *cur;
00588   <a class="code" href="structstp__mxml__node__s.html">stp_mxml_node_t</a> *xmlseq;
00589 
00590   <span class="keywordflow">if</span> (doc == NULL )
00591     {
00592       fprintf(stderr,<span class="stringliteral">"xml_doc_get_dither_array: XML file not parsed successfully.\n"</span>);
00593       <span class="keywordflow">return</span> NULL;
00594     }
00595 
00596   cur = doc-&gt;<a class="code" href="structstp__mxml__node__s.html#o4">child</a>;
00597 
00598   <span class="keywordflow">if</span> (cur == NULL)
00599     {
00600       fprintf(stderr,<span class="stringliteral">"xml_doc_get_dither_array: empty document\n"</span>);
00601       <span class="keywordflow">return</span> NULL;
00602     }
00603 
00604   xmlseq = <a class="code" href="xml_8c.html#a24">stp_xml_get_node</a>(cur, <span class="stringliteral">"gimp-print"</span>, <span class="stringliteral">"dither-matrix"</span>, NULL);
00605   <span class="keywordflow">if</span> (xmlseq == NULL )
00606     {
00607       fprintf(stderr,<span class="stringliteral">"xml-doc-get-dither-array: XML file is not a dither matrix.\n"</span>);
00608       <span class="keywordflow">return</span> NULL;
00609     }
00610 
00611   <span class="keywordflow">return</span> <a class="code" href="print-dither-matrices_8c.html#a25">stpi_dither_array_create_from_xmltree</a>(xmlseq);
00612 }
00613 
00614 <span class="keyword">static</span> <a class="code" href="structstp__array.html">stp_array_t</a> *
<a name="l00615"></a><a class="code" href="print-dither-matrices_8c.html#a27">00615</a> <a class="code" href="print-dither-matrices_8c.html#a27">stpi_dither_array_create_from_file</a>(<span class="keyword">const</span> <span class="keywordtype">char</span>* file)
00616 {
00617   <a class="code" href="structstp__mxml__node__s.html">stp_mxml_node_t</a> *doc;
00618   <a class="code" href="structstp__array.html">stp_array_t</a> *ret = NULL;
00619 
00620   FILE *fp = fopen(file, <span class="stringliteral">"r"</span>);
00621   <span class="keywordflow">if</span> (!fp)
00622     {
00623       <a class="code" href="print-util_8c.html#a20">stp_erprintf</a>(<span class="stringliteral">"stp_curve_create_from_file: unable to open %s: %s\n"</span>,
00624                    file, strerror(errno));
00625       <span class="keywordflow">return</span> NULL;
00626     }
00627 
00628   <a class="code" href="xml_8h.html#a10">stp_xml_init</a>();
00629 
00630   <a class="code" href="print-util_8c.html#a24">stp_deprintf</a>(<a class="code" href="group__util.html#ga47">STP_DBG_XML</a>,
00631                <span class="stringliteral">"stpi_dither_array_create_from_file: reading `%s'...\n"</span>, file);
00632 
00633   doc = <a class="code" href="mxml-file_8c.html#a10">stp_mxmlLoadFile</a>(NULL, fp, <a class="code" href="mxml_8h.html#a2">STP_MXML_NO_CALLBACK</a>);
00634   (<span class="keywordtype">void</span>) fclose(fp);
00635 
00636   <span class="keywordflow">if</span> (doc)
00637     {
00638       ret = <a class="code" href="print-dither-matrices_8c.html#a26">xml_doc_get_dither_array</a>(doc);
00639       <a class="code" href="mxml-node_8c.html#a2">stp_mxmlDelete</a>(doc);
00640     }
00641 
00642   <a class="code" href="xml_8h.html#a11">stp_xml_exit</a>();
00643 
00644   <span class="keywordflow">return</span> ret;
00645 }
00646 
00647 <span class="keyword">static</span> <a class="code" href="structstp__array.html">stp_array_t</a> *
<a name="l00648"></a><a class="code" href="print-dither-matrices_8c.html#a28">00648</a> <a class="code" href="print-dither-matrices_8c.html#a28">stp_xml_get_dither_array</a>(<span class="keywordtype">int</span> x, <span class="keywordtype">int</span> y)
00649 {
00650   <a class="code" href="structstp__xml__dither__cache__t.html">stp_xml_dither_cache_t</a> *cachedval;
00651   <a class="code" href="structstp__array.html">stp_array_t</a> *ret;
00652 
00653   cachedval = <a class="code" href="print-dither-matrices_8c.html#a22">stp_xml_dither_cache_get</a>(x, y);
00654 
00655   <span class="keywordflow">if</span> (cachedval &amp;&amp; cachedval-&gt;<a class="code" href="structstp__xml__dither__cache__t.html#o3">dither_array</a>)
00656     <span class="keywordflow">return</span> <a class="code" href="group__array.html#ga6">stp_array_create_copy</a>(cachedval-&gt;<a class="code" href="structstp__xml__dither__cache__t.html#o3">dither_array</a>);
00657 
00658   <span class="keywordflow">if</span> (!cachedval)
00659     {
00660       <span class="keywordtype">char</span> buf[1024];
00661       (<span class="keywordtype">void</span>) sprintf(buf, <span class="stringliteral">"dither-matrix-%dx%d.xml"</span>, x, y);
00662       <a class="code" href="xml_8c.html#a18">stp_xml_parse_file_named</a>(buf);
00663       cachedval = <a class="code" href="print-dither-matrices_8c.html#a22">stp_xml_dither_cache_get</a>(x, y);
00664       <span class="keywordflow">if</span> (cachedval == NULL || cachedval-&gt;<a class="code" href="structstp__xml__dither__cache__t.html#o2">filename</a> == NULL)
00665         {
00666           <span class="keywordflow">return</span> NULL;
00667         }
00668     }
00669 
00670   ret = <a class="code" href="print-dither-matrices_8c.html#a27">stpi_dither_array_create_from_file</a>(cachedval-&gt;<a class="code" href="structstp__xml__dither__cache__t.html#o2">filename</a>);
00671 
00672   cachedval-&gt;<a class="code" href="structstp__xml__dither__cache__t.html#o3">dither_array</a> = ret;
00673   <span class="keywordflow">return</span> <a class="code" href="group__array.html#ga6">stp_array_create_copy</a>(ret);
00674 }
00675 
00676 <span class="keywordtype">void</span>
<a name="l00677"></a><a class="code" href="group__util__internal.html#ga1">00677</a> <a class="code" href="group__util__internal.html#ga29">stpi_init_dither</a>(<span class="keywordtype">void</span>)
00678 {
00679   <a class="code" href="xml_8c.html#a10">stp_register_xml_parser</a>(<span class="stringliteral">"dither-matrix"</span>, <a class="code" href="print-dither-matrices_8c.html#a24">stp_xml_process_dither_matrix</a>);
00680 }
00681 
00682 <a class="code" href="structstp__array.html">stp_array_t</a> *
<a name="l00683"></a><a class="code" href="print-dither-matrices_8c.html#a30">00683</a> <a class="code" href="print-dither-matrices_8c.html#a30">stp_find_standard_dither_array</a>(<span class="keywordtype">int</span> x_aspect, <span class="keywordtype">int</span> y_aspect)
00684 {
00685   <a class="code" href="structstp__array.html">stp_array_t</a> *answer;
00686   <span class="keywordtype">int</span> divisor = <a class="code" href="print-weave_8c.html#a5">gcd</a>(x_aspect, y_aspect);
00687 
00688   x_aspect /= divisor;
00689   y_aspect /= divisor;
00690 
00691   <span class="keywordflow">if</span> (x_aspect == 3)            <span class="comment">/* We don't have x3 matrices */</span>
00692     x_aspect += 1;              <span class="comment">/* so cheat */</span>
00693   <span class="keywordflow">if</span> (y_aspect == 3)
00694     y_aspect += 1;
00695   
00696   divisor = <a class="code" href="print-weave_8c.html#a5">gcd</a>(x_aspect, y_aspect);
00697   x_aspect /= divisor;
00698   y_aspect /= divisor;
00699 
00700   answer = <a class="code" href="print-dither-matrices_8c.html#a28">stp_xml_get_dither_array</a>(x_aspect, y_aspect);
00701   <span class="keywordflow">if</span> (answer)
00702     <span class="keywordflow">return</span> answer;
00703   answer = <a class="code" href="print-dither-matrices_8c.html#a28">stp_xml_get_dither_array</a>(y_aspect, x_aspect);
00704   <span class="keywordflow">if</span> (answer)
00705     <span class="keywordflow">return</span> answer;
00706   <span class="keywordflow">return</span> NULL;
00707 }
</pre></div><hr size="1"><address style="align: right;"><small>Generated on Wed Aug 25 07:56:14 2004 for libgimpprint API Reference by
<a href="http://www.doxygen.org/index.html">
<img src="doxygen.png" alt="doxygen" align="middle" border=0 > </a>1.3.6 </small></address>
</body>
</html>
