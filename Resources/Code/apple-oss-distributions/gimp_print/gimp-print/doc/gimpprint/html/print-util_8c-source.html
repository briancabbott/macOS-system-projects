<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html><head><meta http-equiv="Content-Type" content="text/html;charset=iso-8859-1">
<title>libgimpprint API Reference: src/main/print-util.c Source File</title>
<link href="doxygen.css" rel="stylesheet" type="text/css">
</head><body>
<!-- Generated by Doxygen 1.3.6 -->
<div class="qindex"><a class="qindex" href="index.html">Main&nbsp;Page</a> | <a class="qindex" href="modules.html">Modules</a> | <a class="qindex" href="classes.html">Alphabetical&nbsp;List</a> | <a class="qindex" href="annotated.html">Data&nbsp;Structures</a> | <a class="qindex" href="files.html">File&nbsp;List</a> | <a class="qindex" href="functions.html">Data&nbsp;Fields</a> | <a class="qindex" href="globals.html">Globals</a> | <a class="qindex" href="pages.html">Related&nbsp;Pages</a></div>
<h1>src/main/print-util.c</h1><a href="print-util_8c.html">Go to the documentation of this file.</a><div class="fragment"><pre>00001 <span class="comment">/*</span>
00002 <span class="comment"> * "$Id: print-util_8c-source.html,v 1.1.1.2 2004/12/22 23:49:10 jlovell Exp $"</span>
00003 <span class="comment"> *</span>
00004 <span class="comment"> *   Print plug-in driver utility functions for the GIMP.</span>
00005 <span class="comment"> *</span>
00006 <span class="comment"> *   Copyright 1997-2000 Michael Sweet (mike@easysw.com) and</span>
00007 <span class="comment"> *      Robert Krawitz (rlk@alum.mit.edu)</span>
00008 <span class="comment"> *</span>
00009 <span class="comment"> *   This program is free software; you can redistribute it and/or modify it</span>
00010 <span class="comment"> *   under the terms of the GNU General Public License as published by the Free</span>
00011 <span class="comment"> *   Software Foundation; either version 2 of the License, or (at your option)</span>
00012 <span class="comment"> *   any later version.</span>
00013 <span class="comment"> *</span>
00014 <span class="comment"> *   This program is distributed in the hope that it will be useful, but</span>
00015 <span class="comment"> *   WITHOUT ANY WARRANTY; without even the implied warranty of MERCHANTABILITY</span>
00016 <span class="comment"> *   or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU General Public License</span>
00017 <span class="comment"> *   for more details.</span>
00018 <span class="comment"> *</span>
00019 <span class="comment"> *   You should have received a copy of the GNU General Public License</span>
00020 <span class="comment"> *   along with this program; if not, write to the Free Software</span>
00021 <span class="comment"> *   Foundation, Inc., 59 Temple Place - Suite 330, Boston, MA 02111-1307, USA.</span>
00022 <span class="comment"> */</span>
00023 
00024 <span class="comment">/*</span>
00025 <span class="comment"> * This file must include only standard C header files.  The core code must</span>
00026 <span class="comment"> * compile on generic platforms that don't support glib, gimp, gtk, etc.</span>
00027 <span class="comment"> */</span>
00028 
00029 <span class="preprocessor">#ifdef HAVE_CONFIG_H</span>
00030 <span class="preprocessor"></span><span class="preprocessor">#include &lt;config.h&gt;</span>
00031 <span class="preprocessor">#endif</span>
00032 <span class="preprocessor"></span><span class="preprocessor">#include &lt;<a class="code" href="gimp-print_8h.html">gimp-print/gimp-print.h</a>&gt;</span>
00033 <span class="preprocessor">#include "<a class="code" href="gimp-print-internal_8h.html">gimp-print-internal.h</a>"</span>
00034 <span class="preprocessor">#include &lt;<a class="code" href="gimp-print-intl-internal_8h.html">gimp-print/gimp-print-intl-internal.h</a>&gt;</span>
00035 <span class="preprocessor">#include &lt;math.h&gt;</span>
00036 <span class="preprocessor">#include &lt;limits.h&gt;</span>
00037 <span class="preprocessor">#if defined(HAVE_VARARGS_H) &amp;&amp; !defined(HAVE_STDARG_H)</span>
00038 <span class="preprocessor"></span><span class="preprocessor">#include &lt;varargs.h&gt;</span>
00039 <span class="preprocessor">#else</span>
00040 <span class="preprocessor"></span><span class="preprocessor">#include &lt;stdarg.h&gt;</span>
00041 <span class="preprocessor">#endif</span>
00042 <span class="preprocessor"></span><span class="preprocessor">#include &lt;string.h&gt;</span>
00043 <span class="preprocessor">#include &lt;stdio.h&gt;</span>
00044 <span class="preprocessor">#include &lt;stdlib.h&gt;</span>
00045 <span class="preprocessor">#include &lt;sys/types.h&gt;</span>
00046 <span class="preprocessor">#include &lt;sys/stat.h&gt;</span>
00047 <span class="preprocessor">#include &lt;unistd.h&gt;</span>
00048 <span class="preprocessor">#include "<a class="code" href="generic-options_8h.html">generic-options.h</a>"</span>
00049 
<a name="l00050"></a><a class="code" href="print-util_8c.html#a0">00050</a> <span class="preprocessor">#define FMIN(a, b) ((a) &lt; (b) ? (a) : (b))</span>
00051 <span class="preprocessor"></span>
<a name="l00052"></a><a class="code" href="structdebug__msgbuf__t.html">00052</a> <span class="keyword">typedef</span> <span class="keyword">struct</span>
00053 <span class="keyword"></span>{
<a name="l00054"></a><a class="code" href="structdebug__msgbuf__t.html#o0">00054</a>   <a class="code" href="group__vars.html#ga3">stp_outfunc_t</a> ofunc;
<a name="l00055"></a><a class="code" href="structdebug__msgbuf__t.html#o1">00055</a>   <span class="keywordtype">void</span> *odata;
<a name="l00056"></a><a class="code" href="structdebug__msgbuf__t.html#o2">00056</a>   <span class="keywordtype">char</span> *data;
<a name="l00057"></a><a class="code" href="structdebug__msgbuf__t.html#o3">00057</a>   size_t bytes;
00058 } <a class="code" href="structdebug__msgbuf__t.html">debug_msgbuf_t</a>;
00059 
00060 <span class="comment">/*</span>
00061 <span class="comment"> * We cannot avoid use of the (non-ANSI) vsnprintf here; ANSI does</span>
00062 <span class="comment"> * not provide a safe, length-limited sprintf function.</span>
00063 <span class="comment"> */</span>
00064 
<a name="l00065"></a><a class="code" href="print-util_8c.html#a1">00065</a> <span class="preprocessor">#define STPI_VASPRINTF(result, bytes, format)                           \</span>
00066 <span class="preprocessor">{                                                                       \</span>
00067 <span class="preprocessor">  int current_allocation = 64;                                          \</span>
00068 <span class="preprocessor">  result = stp_malloc(current_allocation);                              \</span>
00069 <span class="preprocessor">  while (1)                                                             \</span>
00070 <span class="preprocessor">    {                                                                   \</span>
00071 <span class="preprocessor">      va_list args;                                                     \</span>
00072 <span class="preprocessor">      va_start(args, format);                                           \</span>
00073 <span class="preprocessor">      bytes = vsnprintf(result, current_allocation, format, args);      \</span>
00074 <span class="preprocessor">      va_end(args);                                                     \</span>
00075 <span class="preprocessor">      if (bytes &gt;= 0 &amp;&amp; bytes &lt; current_allocation)                     \</span>
00076 <span class="preprocessor">        break;                                                          \</span>
00077 <span class="preprocessor">      else                                                              \</span>
00078 <span class="preprocessor">        {                                                               \</span>
00079 <span class="preprocessor">          stp_free (result);                                            \</span>
00080 <span class="preprocessor">          if (bytes &lt; 0)                                                \</span>
00081 <span class="preprocessor">            current_allocation *= 2;                                    \</span>
00082 <span class="preprocessor">          else                                                          \</span>
00083 <span class="preprocessor">            current_allocation = bytes + 1;                             \</span>
00084 <span class="preprocessor">          result = stp_malloc(current_allocation);                      \</span>
00085 <span class="preprocessor">        }                                                               \</span>
00086 <span class="preprocessor">    }                                                                   \</span>
00087 <span class="preprocessor">}</span>
00088 <span class="preprocessor"></span>
00089 <span class="keywordtype">void</span>
<a name="l00090"></a><a class="code" href="print-util_8c.html#a7">00090</a> <a class="code" href="print-util_8c.html#a7">stp_zprintf</a>(<span class="keyword">const</span> <a class="code" href="structstp__vars.html">stp_vars_t</a> *v, <span class="keyword">const</span> <span class="keywordtype">char</span> *format, ...)
00091 {
00092   <span class="keywordtype">char</span> *result;
00093   <span class="keywordtype">int</span> bytes;
00094   <a class="code" href="print-util_8c.html#a1">STPI_VASPRINTF</a>(result, bytes, format);
00095   (<a class="code" href="group__vars.html#ga30">stp_get_outfunc</a>(v))((<span class="keywordtype">void</span> *)(<a class="code" href="group__vars.html#ga34">stp_get_outdata</a>(v)), result, bytes);
00096   <a class="code" href="group__util.html#ga31">stp_free</a>(result);
00097 }
00098 
00099 <span class="keywordtype">void</span>
<a name="l00100"></a><a class="code" href="print-util_8c.html#a8">00100</a> <a class="code" href="print-util_8c.html#a8">stp_asprintf</a>(<span class="keywordtype">char</span> **strp, <span class="keyword">const</span> <span class="keywordtype">char</span> *format, ...)
00101 {
00102   <span class="keywordtype">char</span> *result;
00103   <span class="keywordtype">int</span> bytes;
00104   <a class="code" href="print-util_8c.html#a1">STPI_VASPRINTF</a>(result, bytes, format);
00105   *strp = result;
00106 }
00107 
00108 <span class="keywordtype">void</span>
<a name="l00109"></a><a class="code" href="print-util_8c.html#a9">00109</a> <a class="code" href="print-util_8c.html#a9">stp_catprintf</a>(<span class="keywordtype">char</span> **strp, <span class="keyword">const</span> <span class="keywordtype">char</span> *format, ...)
00110 {
00111   <span class="keywordtype">char</span> *result1;
00112   <span class="keywordtype">char</span> *result2;
00113   <span class="keywordtype">int</span> bytes;
00114   <a class="code" href="print-util_8c.html#a1">STPI_VASPRINTF</a>(result1, bytes, format);
00115   <a class="code" href="print-util_8c.html#a8">stp_asprintf</a>(&amp;result2, <span class="stringliteral">"%s%s"</span>, *strp, result1);
00116   <a class="code" href="group__util.html#ga31">stp_free</a>(result1);
00117   *strp = result2;
00118 }
00119 
00120 
00121 <span class="keywordtype">void</span>
<a name="l00122"></a><a class="code" href="group__util.html#ga10">00122</a> <a class="code" href="group__util.html#ga10">stp_zfwrite</a>(<span class="keyword">const</span> <span class="keywordtype">char</span> *buf, size_t bytes, size_t nitems, <span class="keyword">const</span> <a class="code" href="structstp__vars.html">stp_vars_t</a> *v)
00123 {
00124   (<a class="code" href="group__vars.html#ga30">stp_get_outfunc</a>(v))((<span class="keywordtype">void</span> *)(<a class="code" href="group__vars.html#ga34">stp_get_outdata</a>(v)), buf, bytes * nitems);
00125 }
00126 
00127 <span class="keywordtype">void</span>
<a name="l00128"></a><a class="code" href="group__util.html#ga11">00128</a> <a class="code" href="group__util.html#ga11">stp_putc</a>(<span class="keywordtype">int</span> ch, <span class="keyword">const</span> <a class="code" href="structstp__vars.html">stp_vars_t</a> *v)
00129 {
00130   <span class="keywordtype">unsigned</span> <span class="keywordtype">char</span> a = (<span class="keywordtype">unsigned</span> <span class="keywordtype">char</span>) ch;
00131   (<a class="code" href="group__vars.html#ga30">stp_get_outfunc</a>(v))((<span class="keywordtype">void</span> *)(<a class="code" href="group__vars.html#ga34">stp_get_outdata</a>(v)), (<span class="keywordtype">char</span> *) &amp;a, 1);
00132 }
00133 
<a name="l00134"></a><a class="code" href="print-util_8c.html#a2">00134</a> <span class="preprocessor">#define BYTE(expr, byteno) (((expr) &gt;&gt; (8 * byteno)) &amp; 0xff)</span>
00135 <span class="preprocessor"></span>
00136 <span class="keywordtype">void</span>
<a name="l00137"></a><a class="code" href="group__util.html#ga12">00137</a> <a class="code" href="group__util.html#ga12">stp_put16_le</a>(<span class="keywordtype">unsigned</span> <span class="keywordtype">short</span> sh, <span class="keyword">const</span> <a class="code" href="structstp__vars.html">stp_vars_t</a> *v)
00138 {
00139   <a class="code" href="group__util.html#ga11">stp_putc</a>(<a class="code" href="print-util_8c.html#a2">BYTE</a>(sh, 0), v);
00140   <a class="code" href="group__util.html#ga11">stp_putc</a>(<a class="code" href="print-util_8c.html#a2">BYTE</a>(sh, 1), v);
00141 }
00142 
00143 <span class="keywordtype">void</span>
<a name="l00144"></a><a class="code" href="group__util.html#ga13">00144</a> <a class="code" href="group__util.html#ga13">stp_put16_be</a>(<span class="keywordtype">unsigned</span> <span class="keywordtype">short</span> sh, <span class="keyword">const</span> <a class="code" href="structstp__vars.html">stp_vars_t</a> *v)
00145 {
00146   <a class="code" href="group__util.html#ga11">stp_putc</a>(<a class="code" href="print-util_8c.html#a2">BYTE</a>(sh, 1), v);
00147   <a class="code" href="group__util.html#ga11">stp_putc</a>(<a class="code" href="print-util_8c.html#a2">BYTE</a>(sh, 0), v);
00148 }
00149 
00150 <span class="keywordtype">void</span>
<a name="l00151"></a><a class="code" href="group__util.html#ga14">00151</a> <a class="code" href="group__util.html#ga14">stp_put32_le</a>(<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> in, <span class="keyword">const</span> <a class="code" href="structstp__vars.html">stp_vars_t</a> *v)
00152 {
00153   <a class="code" href="group__util.html#ga11">stp_putc</a>(<a class="code" href="print-util_8c.html#a2">BYTE</a>(in, 0), v);
00154   <a class="code" href="group__util.html#ga11">stp_putc</a>(<a class="code" href="print-util_8c.html#a2">BYTE</a>(in, 1), v);
00155   <a class="code" href="group__util.html#ga11">stp_putc</a>(<a class="code" href="print-util_8c.html#a2">BYTE</a>(in, 2), v);
00156   <a class="code" href="group__util.html#ga11">stp_putc</a>(<a class="code" href="print-util_8c.html#a2">BYTE</a>(in, 3), v);
00157 }
00158 
00159 <span class="keywordtype">void</span>
<a name="l00160"></a><a class="code" href="group__util.html#ga15">00160</a> <a class="code" href="group__util.html#ga15">stp_put32_be</a>(<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> in, <span class="keyword">const</span> <a class="code" href="structstp__vars.html">stp_vars_t</a> *v)
00161 {
00162   <a class="code" href="group__util.html#ga11">stp_putc</a>(<a class="code" href="print-util_8c.html#a2">BYTE</a>(in, 3), v);
00163   <a class="code" href="group__util.html#ga11">stp_putc</a>(<a class="code" href="print-util_8c.html#a2">BYTE</a>(in, 2), v);
00164   <a class="code" href="group__util.html#ga11">stp_putc</a>(<a class="code" href="print-util_8c.html#a2">BYTE</a>(in, 1), v);
00165   <a class="code" href="group__util.html#ga11">stp_putc</a>(<a class="code" href="print-util_8c.html#a2">BYTE</a>(in, 0), v);
00166 }
00167 
00168 <span class="keywordtype">void</span>
<a name="l00169"></a><a class="code" href="group__util.html#ga16">00169</a> <a class="code" href="group__util.html#ga16">stp_puts</a>(<span class="keyword">const</span> <span class="keywordtype">char</span> *s, <span class="keyword">const</span> <a class="code" href="structstp__vars.html">stp_vars_t</a> *v)
00170 {
00171   (<a class="code" href="group__vars.html#ga30">stp_get_outfunc</a>(v))((<span class="keywordtype">void</span> *)(<a class="code" href="group__vars.html#ga34">stp_get_outdata</a>(v)), s, strlen(s));
00172 }
00173 
00174 <span class="keywordtype">void</span>
<a name="l00175"></a><a class="code" href="group__util.html#ga17">00175</a> <a class="code" href="group__util.html#ga17">stp_send_command</a>(<span class="keyword">const</span> <a class="code" href="structstp__vars.html">stp_vars_t</a> *v, <span class="keyword">const</span> <span class="keywordtype">char</span> *command,
00176                  <span class="keyword">const</span> <span class="keywordtype">char</span> *format, ...)
00177 {
00178   <span class="keywordtype">int</span> i = 0;
00179   <span class="keywordtype">char</span> fchar;
00180   <span class="keyword">const</span> <span class="keywordtype">char</span> *out_str;
00181   <span class="keywordtype">unsigned</span> <span class="keywordtype">short</span> byte_count = 0;
00182   va_list args;
00183 
00184   <span class="keywordflow">if</span> (strlen(format) &gt; 0)
00185     {
00186       va_start(args, format);
00187       <span class="keywordflow">for</span> (i = 0; i &lt; strlen(format); i++)
00188         {
00189           <span class="keywordflow">switch</span> (format[i])
00190             {
00191             <span class="keywordflow">case</span> <span class="charliteral">'a'</span>:
00192             <span class="keywordflow">case</span> <span class="charliteral">'b'</span>:
00193             <span class="keywordflow">case</span> <span class="charliteral">'B'</span>:
00194             <span class="keywordflow">case</span> <span class="charliteral">'d'</span>:
00195             <span class="keywordflow">case</span> <span class="charliteral">'D'</span>:
00196               <span class="keywordflow">break</span>;
00197             <span class="keywordflow">case</span> <span class="charliteral">'c'</span>:
00198               (<span class="keywordtype">void</span>) va_arg(args, <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span>);
00199               byte_count += 1;
00200               <span class="keywordflow">break</span>;
00201             <span class="keywordflow">case</span> <span class="charliteral">'h'</span>:
00202             <span class="keywordflow">case</span> <span class="charliteral">'H'</span>:
00203               (<span class="keywordtype">void</span>) va_arg(args, <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span>);
00204               byte_count += 2;
00205               <span class="keywordflow">break</span>;
00206             <span class="keywordflow">case</span> <span class="charliteral">'l'</span>:
00207             <span class="keywordflow">case</span> <span class="charliteral">'L'</span>:
00208               (<span class="keywordtype">void</span>) va_arg(args, <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span>);
00209               byte_count += 4;
00210               <span class="keywordflow">break</span>;
00211             <span class="keywordflow">case</span> <span class="charliteral">'s'</span>:
00212               out_str = va_arg(args, <span class="keyword">const</span> <span class="keywordtype">char</span> *);
00213               byte_count += strlen(out_str);
00214               <span class="keywordflow">break</span>;
00215             }
00216         }
00217       va_end(args);
00218     }
00219 
00220   <a class="code" href="group__util.html#ga16">stp_puts</a>(command, v);
00221 
00222   va_start(args, format);
00223   <span class="keywordflow">while</span> ((fchar = format[0]) != <span class="charliteral">'\0'</span>)
00224     {
00225       <span class="keywordflow">switch</span> (fchar)
00226         {
00227         <span class="keywordflow">case</span> <span class="charliteral">'a'</span>:
00228           <a class="code" href="group__util.html#ga11">stp_putc</a>(byte_count, v);
00229           <span class="keywordflow">break</span>;
00230         <span class="keywordflow">case</span> <span class="charliteral">'b'</span>:
00231           <a class="code" href="group__util.html#ga12">stp_put16_le</a>(byte_count, v);
00232           <span class="keywordflow">break</span>;
00233         <span class="keywordflow">case</span> <span class="charliteral">'B'</span>:
00234           <a class="code" href="group__util.html#ga13">stp_put16_be</a>(byte_count, v);
00235           <span class="keywordflow">break</span>;
00236         <span class="keywordflow">case</span> <span class="charliteral">'d'</span>:
00237           <a class="code" href="group__util.html#ga14">stp_put32_le</a>(byte_count, v);
00238           <span class="keywordflow">break</span>;
00239         <span class="keywordflow">case</span> <span class="charliteral">'D'</span>:
00240           <a class="code" href="group__util.html#ga15">stp_put32_be</a>(byte_count, v);
00241           <span class="keywordflow">break</span>;
00242         <span class="keywordflow">case</span> <span class="charliteral">'c'</span>:
00243           <a class="code" href="group__util.html#ga11">stp_putc</a>(va_arg(args, <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span>), v);
00244           <span class="keywordflow">break</span>;
00245         <span class="keywordflow">case</span> <span class="charliteral">'h'</span>:
00246           <a class="code" href="group__util.html#ga12">stp_put16_le</a>(va_arg(args, <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span>), v);
00247           <span class="keywordflow">break</span>;
00248         <span class="keywordflow">case</span> <span class="charliteral">'H'</span>:
00249           <a class="code" href="group__util.html#ga13">stp_put16_be</a>(va_arg(args, <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span>), v);
00250           <span class="keywordflow">break</span>;
00251         <span class="keywordflow">case</span> <span class="charliteral">'l'</span>:
00252           <a class="code" href="group__util.html#ga14">stp_put32_le</a>(va_arg(args, <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span>), v);
00253           <span class="keywordflow">break</span>;
00254         <span class="keywordflow">case</span> <span class="charliteral">'L'</span>:
00255           <a class="code" href="group__util.html#ga15">stp_put32_be</a>(va_arg(args, <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span>), v);
00256           <span class="keywordflow">break</span>;
00257         <span class="keywordflow">case</span> <span class="charliteral">'s'</span>:
00258           <a class="code" href="group__util.html#ga16">stp_puts</a>(va_arg(args, <span class="keyword">const</span> <span class="keywordtype">char</span> *), v);
00259           <span class="keywordflow">break</span>;
00260         }
00261       format++;
00262     }
00263   va_end(args);
00264 }
00265 
00266 <span class="keywordtype">void</span>
<a name="l00267"></a><a class="code" href="print-util_8c.html#a18">00267</a> <a class="code" href="print-util_8c.html#a18">stp_eprintf</a>(<span class="keyword">const</span> <a class="code" href="structstp__vars.html">stp_vars_t</a> *v, <span class="keyword">const</span> <span class="keywordtype">char</span> *format, ...)
00268 {
00269   <span class="keywordtype">int</span> bytes;
00270   <span class="keywordflow">if</span> (<a class="code" href="group__vars.html#ga32">stp_get_errfunc</a>(v))
00271     {
00272       <span class="keywordtype">char</span> *result;
00273       <a class="code" href="print-util_8c.html#a1">STPI_VASPRINTF</a>(result, bytes, format);
00274       (<a class="code" href="group__vars.html#ga32">stp_get_errfunc</a>(v))((<span class="keywordtype">void</span> *)(<a class="code" href="group__vars.html#ga36">stp_get_errdata</a>(v)), result, bytes);
00275       <a class="code" href="group__util.html#ga31">stp_free</a>(result);
00276     }
00277   <span class="keywordflow">else</span>
00278     {
00279       va_list args;
00280       va_start(args, format);
00281       vfprintf(stderr, format, args);
00282       va_end(args);
00283     }
00284 }
00285 
00286 <span class="keywordtype">void</span>
<a name="l00287"></a><a class="code" href="group__util.html#ga19">00287</a> <a class="code" href="group__util.html#ga19">stp_erputc</a>(<span class="keywordtype">int</span> ch)
00288 {
00289   putc(ch, stderr);
00290 }
00291 
00292 <span class="keywordtype">void</span>
<a name="l00293"></a><a class="code" href="print-util_8c.html#a20">00293</a> <a class="code" href="print-util_8c.html#a20">stp_erprintf</a>(<span class="keyword">const</span> <span class="keywordtype">char</span> *format, ...)
00294 {
00295   va_list args;
00296   va_start(args, format);
00297   vfprintf(stderr, format, args);
00298   va_end(args);
00299 }
00300 
<a name="l00301"></a><a class="code" href="print-util_8c.html#a3">00301</a> <span class="keyword">static</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">long</span> <a class="code" href="print-util_8c.html#a3">stpi_debug_level</a> = 0;
00302 
00303 <span class="keyword">static</span> <span class="keywordtype">void</span>
<a name="l00304"></a><a class="code" href="print-util_8c.html#a21">00304</a> <a class="code" href="print-util_8c.html#a21">stpi_init_debug</a>(<span class="keywordtype">void</span>)
00305 {
00306   <span class="keyword">static</span> <span class="keywordtype">int</span> debug_initialized = 0;
00307   <span class="keywordflow">if</span> (!debug_initialized)
00308     {
00309       <span class="keyword">const</span> <span class="keywordtype">char</span> *dval = getenv(<span class="stringliteral">"STP_DEBUG"</span>);
00310       debug_initialized = 1;
00311       <span class="keywordflow">if</span> (dval)
00312         {
00313           <a class="code" href="print-util_8c.html#a3">stpi_debug_level</a> = strtoul(dval, 0, 0);
00314           <a class="code" href="print-util_8c.html#a20">stp_erprintf</a>(<span class="stringliteral">"Gimp-Print %s %s\n"</span>, VERSION, RELEASE_DATE);
00315         }
00316     }
00317 }
00318 
00319 <span class="keywordtype">unsigned</span> <span class="keywordtype">long</span>
<a name="l00320"></a><a class="code" href="group__util.html#ga22">00320</a> <a class="code" href="group__util.html#ga19">stp_get_debug_level</a>(<span class="keywordtype">void</span>)
00321 {
00322   <a class="code" href="print-util_8c.html#a21">stpi_init_debug</a>();
00323   <span class="keywordflow">return</span> <a class="code" href="print-util_8c.html#a3">stpi_debug_level</a>;
00324 }
00325 
00326 <span class="keywordtype">void</span>
<a name="l00327"></a><a class="code" href="print-util_8c.html#a23">00327</a> <a class="code" href="print-util_8c.html#a23">stp_dprintf</a>(<span class="keywordtype">unsigned</span> <span class="keywordtype">long</span> level, <span class="keyword">const</span> <a class="code" href="structstp__vars.html">stp_vars_t</a> *v, <span class="keyword">const</span> <span class="keywordtype">char</span> *format, ...)
00328 {
00329   <span class="keywordtype">int</span> bytes;
00330   <a class="code" href="print-util_8c.html#a21">stpi_init_debug</a>();
00331   <span class="keywordflow">if</span> ((level &amp; <a class="code" href="print-util_8c.html#a3">stpi_debug_level</a>) &amp;&amp; <a class="code" href="group__vars.html#ga32">stp_get_errfunc</a>(v))
00332     {
00333       <span class="keywordtype">char</span> *result;
00334       <a class="code" href="print-util_8c.html#a1">STPI_VASPRINTF</a>(result, bytes, format);
00335       (<a class="code" href="group__vars.html#ga32">stp_get_errfunc</a>(v))((<span class="keywordtype">void</span> *)(<a class="code" href="group__vars.html#ga36">stp_get_errdata</a>(v)), result, bytes);
00336       <a class="code" href="group__util.html#ga31">stp_free</a>(result);
00337     }
00338 }
00339 
00340 <span class="keywordtype">void</span>
<a name="l00341"></a><a class="code" href="print-util_8c.html#a24">00341</a> <a class="code" href="print-util_8c.html#a24">stp_deprintf</a>(<span class="keywordtype">unsigned</span> <span class="keywordtype">long</span> level, <span class="keyword">const</span> <span class="keywordtype">char</span> *format, ...)
00342 {
00343   va_list args;
00344   va_start(args, format);
00345   <a class="code" href="print-util_8c.html#a21">stpi_init_debug</a>();
00346   <span class="keywordflow">if</span> (level &amp; <a class="code" href="print-util_8c.html#a3">stpi_debug_level</a>)
00347     vfprintf(stderr, format, args);
00348   va_end(args);
00349 }
00350 
00351 <span class="keyword">static</span> <span class="keywordtype">void</span>
<a name="l00352"></a><a class="code" href="print-util_8c.html#a25">00352</a> <a class="code" href="printers_8c.html#a44">fill_buffer_writefunc</a>(<span class="keywordtype">void</span> *priv, <span class="keyword">const</span> <span class="keywordtype">char</span> *buffer, size_t bytes)
00353 {
00354   <a class="code" href="structdebug__msgbuf__t.html">debug_msgbuf_t</a> *msgbuf = (<a class="code" href="structdebug__msgbuf__t.html">debug_msgbuf_t</a> *) priv;
00355   <span class="keywordflow">if</span> (msgbuf-&gt;<a class="code" href="structdebug__msgbuf__t.html#o3">bytes</a> == 0)
00356     msgbuf-&gt;<a class="code" href="structdebug__msgbuf__t.html#o2">data</a> = <a class="code" href="group__util.html#ga28">stp_malloc</a>(bytes + 1);
00357   <span class="keywordflow">else</span>
00358     msgbuf-&gt;<a class="code" href="structdebug__msgbuf__t.html#o2">data</a> = <a class="code" href="group__util.html#ga30">stp_realloc</a>(msgbuf-&gt;<a class="code" href="structdebug__msgbuf__t.html#o2">data</a>, msgbuf-&gt;<a class="code" href="structdebug__msgbuf__t.html#o3">bytes</a> + bytes + 1);
00359   memcpy(msgbuf-&gt;<a class="code" href="structdebug__msgbuf__t.html#o2">data</a> + msgbuf-&gt;<a class="code" href="structdebug__msgbuf__t.html#o3">bytes</a>, buffer, bytes);
00360   msgbuf-&gt;<a class="code" href="structdebug__msgbuf__t.html#o3">bytes</a> += bytes;
00361   msgbuf-&gt;<a class="code" href="structdebug__msgbuf__t.html#o2">data</a>[msgbuf-&gt;<a class="code" href="structdebug__msgbuf__t.html#o3">bytes</a>] = <span class="charliteral">'\0'</span>;
00362 }
00363 
00364 <span class="keywordtype">void</span>
<a name="l00365"></a><a class="code" href="group__util.html#ga26">00365</a> <a class="code" href="group__util.html#ga26">stp_init_debug_messages</a>(<a class="code" href="structstp__vars.html">stp_vars_t</a> *v)
00366 {
00367   <span class="keywordtype">int</span> verified_flag = <a class="code" href="group__vars.html#ga28">stp_get_verified</a>(v);
00368   <a class="code" href="structdebug__msgbuf__t.html">debug_msgbuf_t</a> *msgbuf = <a class="code" href="group__util.html#ga28">stp_malloc</a>(<span class="keyword">sizeof</span>(<a class="code" href="structdebug__msgbuf__t.html">debug_msgbuf_t</a>));
00369   msgbuf-&gt;<a class="code" href="structdebug__msgbuf__t.html#o0">ofunc</a> = <a class="code" href="group__vars.html#ga32">stp_get_errfunc</a>(v);
00370   msgbuf-&gt;<a class="code" href="structdebug__msgbuf__t.html#o1">odata</a> = <a class="code" href="group__vars.html#ga36">stp_get_errdata</a>(v);
00371   msgbuf-&gt;<a class="code" href="structdebug__msgbuf__t.html#o2">data</a> = NULL;
00372   msgbuf-&gt;<a class="code" href="structdebug__msgbuf__t.html#o3">bytes</a> = 0;
00373   <a class="code" href="group__vars.html#ga31">stp_set_errfunc</a>((<a class="code" href="structstp__vars.html">stp_vars_t</a> *) v, <a class="code" href="print-util_8c.html#a25">fill_buffer_writefunc</a>);
00374   <a class="code" href="group__vars.html#ga35">stp_set_errdata</a>((<a class="code" href="structstp__vars.html">stp_vars_t</a> *) v, msgbuf);
00375   <a class="code" href="group__vars.html#ga27">stp_set_verified</a>((<a class="code" href="structstp__vars.html">stp_vars_t</a> *) v, verified_flag);
00376 }
00377 
00378 <span class="keywordtype">void</span>
<a name="l00379"></a><a class="code" href="group__util.html#ga27">00379</a> <a class="code" href="group__util.html#ga27">stp_flush_debug_messages</a>(<a class="code" href="structstp__vars.html">stp_vars_t</a> *v)
00380 {
00381   <span class="keywordtype">int</span> verified_flag = <a class="code" href="group__vars.html#ga28">stp_get_verified</a>(v);
00382   <a class="code" href="structdebug__msgbuf__t.html">debug_msgbuf_t</a> *msgbuf = (<a class="code" href="structdebug__msgbuf__t.html">debug_msgbuf_t</a> *)<a class="code" href="group__vars.html#ga36">stp_get_errdata</a>(v);
00383   <a class="code" href="group__vars.html#ga31">stp_set_errfunc</a>((<a class="code" href="structstp__vars.html">stp_vars_t</a> *) v, msgbuf-&gt;<a class="code" href="structdebug__msgbuf__t.html#o0">ofunc</a>);
00384   <a class="code" href="group__vars.html#ga35">stp_set_errdata</a>((<a class="code" href="structstp__vars.html">stp_vars_t</a> *) v, msgbuf-&gt;<a class="code" href="structdebug__msgbuf__t.html#o1">odata</a>);
00385   <a class="code" href="group__vars.html#ga27">stp_set_verified</a>((<a class="code" href="structstp__vars.html">stp_vars_t</a> *) v, verified_flag);
00386   <span class="keywordflow">if</span> (msgbuf-&gt;<a class="code" href="structdebug__msgbuf__t.html#o3">bytes</a> &gt; 0)
00387     {
00388       <a class="code" href="print-util_8c.html#a18">stp_eprintf</a>(v, <span class="stringliteral">"%s"</span>, msgbuf-&gt;<a class="code" href="structdebug__msgbuf__t.html#o2">data</a>);
00389       <a class="code" href="group__util.html#ga31">stp_free</a>(msgbuf-&gt;<a class="code" href="structdebug__msgbuf__t.html#o2">data</a>);
00390     }
00391   <a class="code" href="group__util.html#ga31">stp_free</a>(msgbuf);
00392 }
00393 
00394 <span class="comment">/* pointers to the allocation functions to use, which may be set by</span>
00395 <span class="comment">   client applications */</span>
<a name="l00396"></a><a class="code" href="print-util_8c.html#a4">00396</a> <span class="keywordtype">void</span> *(*stp_malloc_func)(size_t size) = malloc;
<a name="l00397"></a><a class="code" href="print-util_8c.html#a5">00397</a> <span class="keywordtype">void</span> *(*stpi_realloc_func)(<span class="keywordtype">void</span> *ptr, size_t size) = realloc;
<a name="l00398"></a><a class="code" href="print-util_8c.html#a6">00398</a> void (*stpi_free_func)(<span class="keywordtype">void</span> *ptr) = free;
00399 
00400 <span class="keywordtype">void</span> *
<a name="l00401"></a><a class="code" href="group__util.html#ga28">00401</a> <a class="code" href="group__util.html#ga28">stp_malloc</a> (size_t size)
00402 {
00403   <span class="keyword">register</span> <span class="keywordtype">void</span> *memptr = NULL;
00404 
00405   <span class="keywordflow">if</span> ((memptr = <a class="code" href="print-util_8c.html#a4">stp_malloc_func</a> (size)) == NULL)
00406     {
00407       fputs(<span class="stringliteral">"Virtual memory exhausted.\n"</span>, stderr);
00408       <a class="code" href="group__util.html#ga3">stp_abort</a>();
00409     }
00410   <span class="keywordflow">return</span> (memptr);
00411 }
00412 
00413 <span class="keywordtype">void</span> *
<a name="l00414"></a><a class="code" href="group__util.html#ga29">00414</a> <a class="code" href="group__util.html#ga29">stp_zalloc</a> (size_t size)
00415 {
00416   <span class="keyword">register</span> <span class="keywordtype">void</span> *memptr = <a class="code" href="group__util.html#ga28">stp_malloc</a>(size);
00417   (<span class="keywordtype">void</span>) memset(memptr, 0, size);
00418   <span class="keywordflow">return</span> (memptr);
00419 }
00420 
00421 <span class="keywordtype">void</span> *
<a name="l00422"></a><a class="code" href="group__util.html#ga30">00422</a> <a class="code" href="group__util.html#ga30">stp_realloc</a> (<span class="keywordtype">void</span> *ptr, size_t size)
00423 {
00424   <span class="keyword">register</span> <span class="keywordtype">void</span> *memptr = NULL;
00425 
00426   <span class="keywordflow">if</span> (size &gt; 0 &amp;&amp; ((memptr = <a class="code" href="print-util_8c.html#a5">stpi_realloc_func</a> (ptr, size)) == NULL))
00427     {
00428       fputs(<span class="stringliteral">"Virtual memory exhausted.\n"</span>, stderr);
00429       <a class="code" href="group__util.html#ga3">stp_abort</a>();
00430     }
00431   <span class="keywordflow">return</span> (memptr);
00432 }
00433 
00434 <span class="keywordtype">void</span>
<a name="l00435"></a><a class="code" href="group__util.html#ga31">00435</a> <a class="code" href="group__util.html#ga31">stp_free</a>(<span class="keywordtype">void</span> *ptr)
00436 {
00437   <a class="code" href="print-util_8c.html#a6">stpi_free_func</a>(ptr);
00438 }
00439 
00440 <span class="keywordtype">int</span>
<a name="l00441"></a><a class="code" href="group__util.html#ga32">00441</a> <a class="code" href="group__util.html#ga0">stp_init</a>(<span class="keywordtype">void</span>)
00442 {
00443   <span class="keyword">static</span> <span class="keywordtype">int</span> stpi_is_initialised = 0;
00444   <span class="keywordflow">if</span> (!stpi_is_initialised)
00445     {
00446       <span class="comment">/* Things that are only initialised once */</span>
00447       <span class="comment">/* Set up gettext */</span>
00448 <span class="preprocessor">#ifdef ENABLE_NLS</span>
00449 <span class="preprocessor"></span>      setlocale (LC_ALL, <span class="stringliteral">""</span>);
00450       <a class="code" href="group__intl__internal.html#ga4">bindtextdomain</a> (PACKAGE, PACKAGE_LOCALE_DIR);
00451 <span class="preprocessor">#endif</span>
00452 <span class="preprocessor"></span>      <a class="code" href="print-util_8c.html#a21">stpi_init_debug</a>();
00453       <a class="code" href="xml_8h.html#a14">stp_xml_preinit</a>();
00454       <a class="code" href="group__util__internal.html#ga51">stpi_init_printer</a>();
00455       <a class="code" href="group__util__internal.html#ga16">stpi_init_paper</a>();
00456       <a class="code" href="group__util__internal.html#ga29">stpi_init_dither</a>();
00457       <span class="comment">/* Load modules */</span>
00458       <span class="keywordflow">if</span> (<a class="code" href="module_8h.html#a7">stp_module_load</a>())
00459         <span class="keywordflow">return</span> 1;
00460       <span class="comment">/* Load XML data */</span>
00461       <span class="keywordflow">if</span> (<a class="code" href="xml_8h.html#a5">stp_xml_init_defaults</a>())
00462         <span class="keywordflow">return</span> 1;
00463       <span class="comment">/* Initialise modules */</span>
00464       <span class="keywordflow">if</span> (<a class="code" href="module_8h.html#a10">stp_module_init</a>())
00465         <span class="keywordflow">return</span> 1;
00466       <span class="comment">/* Set up defaults for core parameters */</span>
00467       <a class="code" href="group__printer.html#ga22">stp_initialize_printer_defaults</a>();
00468     }
00469 
00470   stpi_is_initialised = 1;
00471   <span class="keywordflow">return</span> 0;
00472 }
00473 
00474 size_t
<a name="l00475"></a><a class="code" href="group__util.html#ga33">00475</a> <a class="code" href="group__util.html#ga33">stp_strlen</a>(<span class="keyword">const</span> <span class="keywordtype">char</span> *s)
00476 {
00477   <span class="keywordflow">return</span> strlen(s);
00478 }
00479 
00480 <span class="keywordtype">char</span> *
<a name="l00481"></a><a class="code" href="group__util.html#ga34">00481</a> <a class="code" href="group__util.html#ga34">stp_strndup</a>(<span class="keyword">const</span> <span class="keywordtype">char</span> *s, <span class="keywordtype">int</span> n)
00482 {
00483   <span class="keywordtype">char</span> *ret;
00484   <span class="keywordflow">if</span> (!s || n &lt; 0)
00485     {
00486       ret = <a class="code" href="group__util.html#ga28">stp_malloc</a>(1);
00487       ret[0] = 0;
00488       <span class="keywordflow">return</span> ret;
00489     }
00490   <span class="keywordflow">else</span>
00491     {
00492       ret = <a class="code" href="group__util.html#ga28">stp_malloc</a>(n + 1);
00493       memcpy(ret, s, n);
00494       ret[n] = 0;
00495       <span class="keywordflow">return</span> ret;
00496     }
00497 }
00498 
00499 <span class="keywordtype">char</span> *
<a name="l00500"></a><a class="code" href="group__util.html#ga35">00500</a> <a class="code" href="group__util.html#ga35">stp_strdup</a>(<span class="keyword">const</span> <span class="keywordtype">char</span> *s)
00501 {
00502   <span class="keywordtype">char</span> *ret;
00503   <span class="keywordflow">if</span> (!s)
00504     {
00505       ret = <a class="code" href="group__util.html#ga28">stp_malloc</a>(1);
00506       ret[0] = <span class="charliteral">'\0'</span>;
00507       <span class="keywordflow">return</span> ret;
00508     }
00509   <span class="keywordflow">else</span>
00510     <span class="keywordflow">return</span> <a class="code" href="group__util.html#ga34">stp_strndup</a>(s, <a class="code" href="group__util.html#ga33">stp_strlen</a>(s));
00511 }
00512 
00513 <span class="keyword">const</span> <span class="keywordtype">char</span> *
<a name="l00514"></a><a class="code" href="group__util.html#ga36">00514</a> <a class="code" href="group__util.html#ga36">stp_set_output_codeset</a>(<span class="keyword">const</span> <span class="keywordtype">char</span> *codeset)
00515 {
00516 <span class="preprocessor">#ifdef ENABLE_NLS</span>
00517 <span class="preprocessor"></span>  <span class="keywordflow">return</span> (<span class="keyword">const</span> <span class="keywordtype">char</span> *)(bind_textdomain_codeset(PACKAGE, codeset));
00518 <span class="preprocessor">#else</span>
00519 <span class="preprocessor"></span>  <span class="keywordflow">return</span> <span class="stringliteral">"US-ASCII"</span>;
00520 <span class="preprocessor">#endif</span>
00521 <span class="preprocessor"></span>}
00522 
00523 <a class="code" href="structstp__curve.html">stp_curve_t</a> *
<a name="l00524"></a><a class="code" href="group__util.html#ga37">00524</a> <a class="code" href="group__util.html#ga37">stp_read_and_compose_curves</a>(<span class="keyword">const</span> <span class="keywordtype">char</span> *s1, <span class="keyword">const</span> <span class="keywordtype">char</span> *s2,
00525                             stp_curve_compose_t comp,
00526                             size_t piecewise_point_count)
00527 {
00528   <a class="code" href="structstp__curve.html">stp_curve_t</a> *ret = NULL;
00529   <a class="code" href="structstp__curve.html">stp_curve_t</a> *t1 = NULL;
00530   <a class="code" href="structstp__curve.html">stp_curve_t</a> *t2 = NULL;
00531   <span class="keywordflow">if</span> (s1)
00532     t1 = <a class="code" href="group__curve.html#ga66">stp_curve_create_from_string</a>(s1);
00533   <span class="keywordflow">if</span> (s2)
00534     t2 = <a class="code" href="group__curve.html#ga66">stp_curve_create_from_string</a>(s2);
00535   <span class="keywordflow">if</span> (t1 &amp;&amp; t2)
00536     {
00537       <span class="keywordflow">if</span> (<a class="code" href="group__curve.html#ga30">stp_curve_is_piecewise</a>(t1) &amp;&amp; <a class="code" href="group__curve.html#ga30">stp_curve_is_piecewise</a>(t2))
00538         {
00539           <a class="code" href="group__curve.html#ga51">stp_curve_resample</a>(t1, piecewise_point_count);
00540           <a class="code" href="group__curve.html#ga51">stp_curve_resample</a>(t2, piecewise_point_count);
00541         }
00542       <a class="code" href="group__curve.html#ga56">stp_curve_compose</a>(&amp;ret, t1, t2, comp, -1);
00543     }
00544   <span class="keywordflow">if</span> (ret)
00545     {
00546       <a class="code" href="group__curve.html#ga22">stp_curve_destroy</a>(t1);
00547       <a class="code" href="group__curve.html#ga22">stp_curve_destroy</a>(t2);
00548       <span class="keywordflow">return</span> ret;
00549     }
00550   <span class="keywordflow">else</span> <span class="keywordflow">if</span> (t1)
00551     {
00552       <a class="code" href="group__curve.html#ga22">stp_curve_destroy</a>(t2);
00553       <span class="keywordflow">return</span> t1;
00554     }
00555   <span class="keywordflow">else</span>
00556     <span class="keywordflow">return</span> t2;
00557 }
00558 
00559 <span class="keywordtype">void</span>
<a name="l00560"></a><a class="code" href="group__vars.html#ga38">00560</a> <a class="code" href="group__vars.html#ga38">stp_merge_printvars</a>(<a class="code" href="structstp__vars.html">stp_vars_t</a> *user, <span class="keyword">const</span> <a class="code" href="structstp__vars.html">stp_vars_t</a> *print)
00561 {
00562   <span class="keywordtype">int</span> i;
00563   <a class="code" href="group__vars.html#ga1">stp_parameter_list_t</a> params = <a class="code" href="group__vars.html#ga39">stp_get_parameter_list</a>(print);
00564   <span class="keywordtype">int</span> count = <a class="code" href="group__vars.html#ga86">stp_parameter_list_count</a>(params);
00565   <span class="keywordflow">for</span> (i = 0; i &lt; count; i++)
00566     {
00567       <span class="keyword">const</span> <a class="code" href="structstp__parameter__t.html">stp_parameter_t</a> *p = <a class="code" href="group__vars.html#ga88">stp_parameter_list_param</a>(params, i);
00568       <span class="keywordflow">if</span> (p-&gt;<a class="code" href="structstp__parameter__t.html#o4">p_type</a> == <a class="code" href="group__vars.html#gga132a10">STP_PARAMETER_TYPE_DOUBLE</a> &amp;&amp;
00569           p-&gt;<a class="code" href="structstp__parameter__t.html#o5">p_class</a> == <a class="code" href="group__vars.html#gga133a18">STP_PARAMETER_CLASS_OUTPUT</a> &amp;&amp;
00570           <a class="code" href="group__vars.html#ga102">stp_check_float_parameter</a>(print, p-&gt;<a class="code" href="structstp__parameter__t.html#o0">name</a>, <a class="code" href="group__vars.html#gga135a31">STP_PARAMETER_DEFAULTED</a>))
00571         {
00572           <a class="code" href="structstp__parameter__t.html">stp_parameter_t</a> desc;
00573           <span class="keywordtype">double</span> prnval = <a class="code" href="group__vars.html#ga70">stp_get_float_parameter</a>(print, p-&gt;<a class="code" href="structstp__parameter__t.html#o0">name</a>);
00574           <span class="keywordtype">double</span> usrval;
00575           <a class="code" href="group__vars.html#ga83">stp_describe_parameter</a>(print, p-&gt;<a class="code" href="structstp__parameter__t.html#o0">name</a>, &amp;desc);
00576           <span class="keywordflow">if</span> (<a class="code" href="group__vars.html#ga102">stp_check_float_parameter</a>(user, p-&gt;<a class="code" href="structstp__parameter__t.html#o0">name</a>, <a class="code" href="group__vars.html#gga135a32">STP_PARAMETER_ACTIVE</a>))
00577             usrval = <a class="code" href="group__vars.html#ga70">stp_get_float_parameter</a>(user, p-&gt;<a class="code" href="structstp__parameter__t.html#o0">name</a>);
00578           <span class="keywordflow">else</span>
00579             usrval = desc.<a class="code" href="structstp__parameter__t.html#o26">deflt</a>.dbl;
00580           <span class="keywordflow">if</span> (strcmp(p-&gt;<a class="code" href="structstp__parameter__t.html#o0">name</a>, <span class="stringliteral">"Gamma"</span>) == 0)
00581             usrval /= prnval;
00582           <span class="keywordflow">else</span>
00583             usrval *= prnval;
00584           <span class="keywordflow">if</span> (usrval &lt; desc.<a class="code" href="structstp__parameter__t.html#o18">bounds</a>.dbl.lower)
00585             usrval = desc.<a class="code" href="structstp__parameter__t.html#o18">bounds</a>.dbl.lower;
00586           <span class="keywordflow">else</span> <span class="keywordflow">if</span> (usrval &gt; desc.<a class="code" href="structstp__parameter__t.html#o18">bounds</a>.dbl.upper)
00587             usrval = desc.<a class="code" href="structstp__parameter__t.html#o18">bounds</a>.dbl.upper;
00588           <span class="keywordflow">if</span> (!<a class="code" href="group__vars.html#ga102">stp_check_float_parameter</a>(user, p-&gt;<a class="code" href="structstp__parameter__t.html#o0">name</a>, <a class="code" href="group__vars.html#gga135a32">STP_PARAMETER_ACTIVE</a>))
00589             {
00590               <a class="code" href="group__vars.html#ga69">stp_clear_float_parameter</a>(user, p-&gt;<a class="code" href="structstp__parameter__t.html#o0">name</a>);
00591               <a class="code" href="group__vars.html#ga68">stp_set_default_float_parameter</a>(user, p-&gt;<a class="code" href="structstp__parameter__t.html#o0">name</a>, usrval);
00592             }
00593           <span class="keywordflow">else</span>
00594             <a class="code" href="group__vars.html#ga67">stp_set_float_parameter</a>(user, p-&gt;<a class="code" href="structstp__parameter__t.html#o0">name</a>, usrval);
00595           <a class="code" href="group__vars.html#ga84">stp_parameter_description_destroy</a>(&amp;desc);
00596         }
00597     }
00598   <a class="code" href="group__vars.html#ga89">stp_parameter_list_destroy</a>(params);
00599 }
00600 
00601 <a class="code" href="group__vars.html#ga1">stp_parameter_list_t</a>
<a name="l00602"></a><a class="code" href="group__vars.html#ga39">00602</a> <a class="code" href="group__vars.html#ga39">stp_get_parameter_list</a>(<span class="keyword">const</span> <a class="code" href="structstp__vars.html">stp_vars_t</a> *v)
00603 {
00604   <a class="code" href="group__vars.html#ga1">stp_parameter_list_t</a> ret = <a class="code" href="group__vars.html#ga43">stp_parameter_list_create</a>();
00605   <a class="code" href="group__vars.html#ga1">stp_parameter_list_t</a> tmp_list;
00606 
00607   tmp_list = <a class="code" href="group__printer.html#ga24">stp_printer_list_parameters</a>(v);
00608   <a class="code" href="group__vars.html#ga91">stp_parameter_list_append</a>(ret, tmp_list);
00609   <a class="code" href="group__vars.html#ga89">stp_parameter_list_destroy</a>(tmp_list);
00610 
00611   tmp_list = <a class="code" href="group__color.html#ga15">stp_color_list_parameters</a>(v);
00612   <a class="code" href="group__vars.html#ga91">stp_parameter_list_append</a>(ret, tmp_list);
00613   <a class="code" href="group__vars.html#ga89">stp_parameter_list_destroy</a>(tmp_list);
00614 
00615   tmp_list = <a class="code" href="dither-main_8c.html#a6">stp_dither_list_parameters</a>(v);
00616   <a class="code" href="group__vars.html#ga91">stp_parameter_list_append</a>(ret, tmp_list);
00617   <a class="code" href="group__vars.html#ga89">stp_parameter_list_destroy</a>(tmp_list);
00618 
00619   tmp_list = <a class="code" href="generic-options_8h.html#a9">stp_list_generic_parameters</a>(v);
00620   <a class="code" href="group__vars.html#ga91">stp_parameter_list_append</a>(ret, tmp_list);
00621   <a class="code" href="group__vars.html#ga89">stp_parameter_list_destroy</a>(tmp_list);
00622 
00623   <span class="keywordflow">return</span> ret;
00624 }
00625 
00626 <span class="keywordtype">void</span>
<a name="l00627"></a><a class="code" href="group__util.html#ga40">00627</a> <a class="code" href="group__util.html#ga3">stp_abort</a>(<span class="keywordtype">void</span>)
00628 {
00629   abort();
00630 }
</pre></div><hr size="1"><address style="align: right;"><small>Generated on Wed Aug 25 07:56:14 2004 for libgimpprint API Reference by
<a href="http://www.doxygen.org/index.html">
<img src="doxygen.png" alt="doxygen" align="middle" border=0 > </a>1.3.6 </small></address>
</body>
</html>
