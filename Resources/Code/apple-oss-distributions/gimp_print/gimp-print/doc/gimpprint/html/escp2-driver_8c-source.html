<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html><head><meta http-equiv="Content-Type" content="text/html;charset=iso-8859-1">
<title>libgimpprint API Reference: src/main/escp2-driver.c Source File</title>
<link href="doxygen.css" rel="stylesheet" type="text/css">
</head><body>
<!-- Generated by Doxygen 1.3.6 -->
<div class="qindex"><a class="qindex" href="index.html">Main&nbsp;Page</a> | <a class="qindex" href="modules.html">Modules</a> | <a class="qindex" href="classes.html">Alphabetical&nbsp;List</a> | <a class="qindex" href="annotated.html">Data&nbsp;Structures</a> | <a class="qindex" href="files.html">File&nbsp;List</a> | <a class="qindex" href="functions.html">Data&nbsp;Fields</a> | <a class="qindex" href="globals.html">Globals</a> | <a class="qindex" href="pages.html">Related&nbsp;Pages</a></div>
<h1>src/main/escp2-driver.c</h1><a href="escp2-driver_8c.html">Go to the documentation of this file.</a><div class="fragment"><pre>00001 <span class="comment">/*</span>
00002 <span class="comment"> * "$Id: escp2-driver_8c-source.html,v 1.1.1.2 2004/12/22 23:49:00 jlovell Exp $"</span>
00003 <span class="comment"> *</span>
00004 <span class="comment"> *   Print plug-in EPSON ESC/P2 driver for the GIMP.</span>
00005 <span class="comment"> *</span>
00006 <span class="comment"> *   Copyright 1997-2000 Michael Sweet (mike@easysw.com) and</span>
00007 <span class="comment"> *      Robert Krawitz (rlk@alum.mit.edu)</span>
00008 <span class="comment"> *</span>
00009 <span class="comment"> *   This program is free software; you can redistribute it and/or modify it</span>
00010 <span class="comment"> *   under the terms of the GNU General Public License as published by the Free</span>
00011 <span class="comment"> *   Software Foundation; either version 2 of the License, or (at your option)</span>
00012 <span class="comment"> *   any later version.</span>
00013 <span class="comment"> *</span>
00014 <span class="comment"> *   This program is distributed in the hope that it will be useful, but</span>
00015 <span class="comment"> *   WITHOUT ANY WARRANTY; without even the implied warranty of MERCHANTABILITY</span>
00016 <span class="comment"> *   or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU General Public License</span>
00017 <span class="comment"> *   for more details.</span>
00018 <span class="comment"> *</span>
00019 <span class="comment"> *   You should have received a copy of the GNU General Public License</span>
00020 <span class="comment"> *   along with this program; if not, write to the Free Software</span>
00021 <span class="comment"> *   Foundation, Inc., 59 Temple Place - Suite 330, Boston, MA 02111-1307, USA.</span>
00022 <span class="comment"> */</span>
00023 
00024 <span class="comment">/*</span>
00025 <span class="comment"> * This file must include only standard C header files.  The core code must</span>
00026 <span class="comment"> * compile on generic platforms that don't support glib, gimp, gtk, etc.</span>
00027 <span class="comment"> */</span>
00028 
00029 <span class="preprocessor">#ifdef HAVE_CONFIG_H</span>
00030 <span class="preprocessor"></span><span class="preprocessor">#include &lt;config.h&gt;</span>
00031 <span class="preprocessor">#endif</span>
00032 <span class="preprocessor"></span><span class="preprocessor">#include &lt;<a class="code" href="gimp-print_8h.html">gimp-print/gimp-print.h</a>&gt;</span>
00033 <span class="preprocessor">#include &lt;<a class="code" href="gimp-print-intl-internal_8h.html">gimp-print/gimp-print-intl-internal.h</a>&gt;</span>
00034 <span class="preprocessor">#include "<a class="code" href="gimp-print-internal_8h.html">gimp-print-internal.h</a>"</span>
00035 <span class="preprocessor">#include &lt;string.h&gt;</span>
00036 <span class="preprocessor">#include "<a class="code" href="print-escp2_8h.html">print-escp2.h</a>"</span>
00037 
00038 <span class="preprocessor">#ifdef __GNUC__</span>
00039 <span class="preprocessor"></span><span class="preprocessor">#define inline __inline__</span>
00040 <span class="preprocessor"></span><span class="preprocessor">#endif</span>
00041 <span class="preprocessor"></span>
00042 <span class="keyword">static</span> <a class="code" href="structescp2__privdata__t.html">escp2_privdata_t</a> *
<a name="l00043"></a><a class="code" href="escp2-driver_8c.html#a0">00043</a> <a class="code" href="print-escp2_8c.html#a27">get_privdata</a>(<a class="code" href="structstp__vars.html">stp_vars_t</a> *v)
00044 {
00045   <span class="keywordflow">return</span> (<a class="code" href="structescp2__privdata__t.html">escp2_privdata_t</a> *) <a class="code" href="group__vars.html#ga20">stp_get_component_data</a>(v, <span class="stringliteral">"Driver"</span>);
00046 }
00047 
00048 <span class="keyword">static</span> <span class="keywordtype">void</span>
<a name="l00049"></a><a class="code" href="escp2-driver_8c.html#a1">00049</a> <a class="code" href="escp2-driver_8c.html#a1">escp2_reset_printer</a>(<a class="code" href="structstp__vars.html">stp_vars_t</a> *v)
00050 {
00051   <a class="code" href="structescp2__privdata__t.html">escp2_privdata_t</a> *pd = <a class="code" href="print-escp2_8c.html#a27">get_privdata</a>(v);
00052   <span class="comment">/*</span>
00053 <span class="comment">   * Magic initialization string that's needed to take printer out of</span>
00054 <span class="comment">   * packet mode.</span>
00055 <span class="comment">   */</span>
00056   <span class="keywordflow">if</span> (pd-&gt;<a class="code" href="structescp2__privdata__t.html#o28">init_sequence</a>)
00057     <a class="code" href="group__util.html#ga10">stp_zfwrite</a>(pd-&gt;<a class="code" href="structescp2__privdata__t.html#o28">init_sequence</a>-&gt;<a class="code" href="structstp__raw__t.html#o1">data</a>, pd-&gt;<a class="code" href="structescp2__privdata__t.html#o28">init_sequence</a>-&gt;<a class="code" href="structstp__raw__t.html#o0">bytes</a>, 1, v);
00058 
00059   <a class="code" href="group__util.html#ga17">stp_send_command</a>(v, <span class="stringliteral">"\033@"</span>, <span class="stringliteral">""</span>);
00060 }
00061 
00062 <span class="keyword">static</span> <span class="keywordtype">void</span>
<a name="l00063"></a><a class="code" href="escp2-driver_8c.html#a2">00063</a> <a class="code" href="escp2-driver_8c.html#a2">print_remote_param</a>(<a class="code" href="structstp__vars.html">stp_vars_t</a> *v, <span class="keyword">const</span> <span class="keywordtype">char</span> *param, <span class="keyword">const</span> <span class="keywordtype">char</span> *value)
00064 {
00065   <a class="code" href="group__util.html#ga17">stp_send_command</a>(v, <span class="stringliteral">"\033(R"</span>, <span class="stringliteral">"bcscs"</span>, <span class="charliteral">'\0'</span>, param, <span class="charliteral">':'</span>,
00066                     value ? value : <span class="stringliteral">"NULL"</span>);
00067   <a class="code" href="group__util.html#ga17">stp_send_command</a>(v, <span class="stringliteral">"\033"</span>, <span class="stringliteral">"ccc"</span>, 0, 0, 0);
00068 }
00069 
00070 <span class="keyword">static</span> <span class="keywordtype">void</span>
<a name="l00071"></a><a class="code" href="escp2-driver_8c.html#a3">00071</a> <a class="code" href="escp2-driver_8c.html#a3">print_remote_int_param</a>(<a class="code" href="structstp__vars.html">stp_vars_t</a> *v, <span class="keyword">const</span> <span class="keywordtype">char</span> *param, <span class="keywordtype">int</span> value)
00072 {
00073   <span class="keywordtype">char</span> buf[64];
00074   (<span class="keywordtype">void</span>) snprintf(buf, 64, <span class="stringliteral">"%d"</span>, value);
00075   <a class="code" href="escp2-driver_8c.html#a2">print_remote_param</a>(v, param, buf);
00076 }
00077 
00078 <span class="keyword">static</span> <span class="keywordtype">void</span>
<a name="l00079"></a><a class="code" href="escp2-driver_8c.html#a4">00079</a> <a class="code" href="escp2-driver_8c.html#a4">print_remote_float_param</a>(<a class="code" href="structstp__vars.html">stp_vars_t</a> *v, <span class="keyword">const</span> <span class="keywordtype">char</span> *param, <span class="keywordtype">double</span> value)
00080 {
00081   <span class="keywordtype">char</span> buf[64];
00082   (<span class="keywordtype">void</span>) snprintf(buf, 64, <span class="stringliteral">"%f"</span>, value);
00083   <a class="code" href="escp2-driver_8c.html#a2">print_remote_param</a>(v, param, buf);
00084 }
00085 
00086 <span class="keyword">static</span> <span class="keywordtype">void</span>
<a name="l00087"></a><a class="code" href="escp2-driver_8c.html#a5">00087</a> <a class="code" href="escp2-driver_8c.html#a5">print_debug_params</a>(<a class="code" href="structstp__vars.html">stp_vars_t</a> *v)
00088 {
00089   <a class="code" href="structescp2__privdata__t.html">escp2_privdata_t</a> *pd = <a class="code" href="print-escp2_8c.html#a27">get_privdata</a>(v);
00090   <a class="code" href="group__vars.html#ga1">stp_parameter_list_t</a> params = <a class="code" href="group__vars.html#ga39">stp_get_parameter_list</a>(v);
00091   <span class="keywordtype">int</span> count = <a class="code" href="group__vars.html#ga86">stp_parameter_list_count</a>(params);
00092   <span class="keywordtype">int</span> i;
00093   <a class="code" href="escp2-driver_8c.html#a2">print_remote_param</a>(v, <span class="stringliteral">"Package"</span>, PACKAGE);
00094   <a class="code" href="escp2-driver_8c.html#a2">print_remote_param</a>(v, <span class="stringliteral">"Version"</span>, VERSION);
00095   <a class="code" href="escp2-driver_8c.html#a2">print_remote_param</a>(v, <span class="stringliteral">"Release Date"</span>, RELEASE_DATE);
00096   <a class="code" href="escp2-driver_8c.html#a2">print_remote_param</a>(v, <span class="stringliteral">"Driver"</span>, <a class="code" href="group__vars.html#ga13">stp_get_driver</a>(v));
00097   <a class="code" href="escp2-driver_8c.html#a3">print_remote_int_param</a>(v, <span class="stringliteral">"Left"</span>, <a class="code" href="group__vars.html#ga18">stp_get_left</a>(v));
00098   <a class="code" href="escp2-driver_8c.html#a3">print_remote_int_param</a>(v, <span class="stringliteral">"Top"</span>, <a class="code" href="group__vars.html#ga20">stp_get_top</a>(v));
00099   <a class="code" href="escp2-driver_8c.html#a3">print_remote_int_param</a>(v, <span class="stringliteral">"Page Width"</span>, <a class="code" href="group__vars.html#ga26">stp_get_page_width</a>(v));
00100   <a class="code" href="escp2-driver_8c.html#a3">print_remote_int_param</a>(v, <span class="stringliteral">"Page Height"</span>, <a class="code" href="group__vars.html#ga28">stp_get_page_height</a>(v));
00101   <a class="code" href="escp2-driver_8c.html#a3">print_remote_int_param</a>(v, <span class="stringliteral">"Model"</span>, <a class="code" href="group__printer.html#ga23">stp_get_model_id</a>(v));
00102   <a class="code" href="escp2-driver_8c.html#a3">print_remote_int_param</a>(v, <span class="stringliteral">"Ydpi"</span>, pd-&gt;<a class="code" href="structescp2__privdata__t.html#o42">res</a>-&gt;<a class="code" href="structres__t.html#o3">vres</a>);
00103   <a class="code" href="escp2-driver_8c.html#a3">print_remote_int_param</a>(v, <span class="stringliteral">"Xdpi"</span>, pd-&gt;<a class="code" href="structescp2__privdata__t.html#o42">res</a>-&gt;<a class="code" href="structres__t.html#o2">hres</a>);
00104   <a class="code" href="escp2-driver_8c.html#a3">print_remote_int_param</a>(v, <span class="stringliteral">"Use_softweave"</span>, pd-&gt;<a class="code" href="structescp2__privdata__t.html#o42">res</a>-&gt;<a class="code" href="structres__t.html#o6">softweave</a>);
00105   <a class="code" href="escp2-driver_8c.html#a3">print_remote_int_param</a>(v, <span class="stringliteral">"Use_printer_weave"</span>, pd-&gt;<a class="code" href="structescp2__privdata__t.html#o42">res</a>-&gt;<a class="code" href="structres__t.html#o7">printer_weave</a>);
00106   <a class="code" href="escp2-driver_8c.html#a3">print_remote_int_param</a>(v, <span class="stringliteral">"Use_printer_weave"</span>, pd-&gt;<a class="code" href="structescp2__privdata__t.html#o44">use_printer_weave</a>);
00107   <a class="code" href="escp2-driver_8c.html#a3">print_remote_int_param</a>(v, <span class="stringliteral">"Page_left"</span>, pd-&gt;<a class="code" href="structescp2__privdata__t.html#o45">page_left</a>);
00108   <a class="code" href="escp2-driver_8c.html#a3">print_remote_int_param</a>(v, <span class="stringliteral">"Page_right"</span>, pd-&gt;<a class="code" href="structescp2__privdata__t.html#o46">page_right</a>);
00109   <a class="code" href="escp2-driver_8c.html#a3">print_remote_int_param</a>(v, <span class="stringliteral">"Page_top"</span>, pd-&gt;<a class="code" href="structescp2__privdata__t.html#o47">page_top</a>);
00110   <a class="code" href="escp2-driver_8c.html#a3">print_remote_int_param</a>(v, <span class="stringliteral">"Page_bottom"</span>, pd-&gt;<a class="code" href="structescp2__privdata__t.html#o48">page_bottom</a>);
00111   <a class="code" href="escp2-driver_8c.html#a3">print_remote_int_param</a>(v, <span class="stringliteral">"Page_width"</span>, pd-&gt;<a class="code" href="structescp2__privdata__t.html#o49">page_width</a>);
00112   <a class="code" href="escp2-driver_8c.html#a3">print_remote_int_param</a>(v, <span class="stringliteral">"Page_height"</span>, pd-&gt;<a class="code" href="structescp2__privdata__t.html#o50">page_height</a>);
00113   <a class="code" href="escp2-driver_8c.html#a3">print_remote_int_param</a>(v, <span class="stringliteral">"Page_true_height"</span>, pd-&gt;<a class="code" href="structescp2__privdata__t.html#o51">page_true_height</a>);
00114   <a class="code" href="escp2-driver_8c.html#a3">print_remote_int_param</a>(v, <span class="stringliteral">"Image_left"</span>, pd-&gt;<a class="code" href="structescp2__privdata__t.html#o59">image_left</a>);
00115   <a class="code" href="escp2-driver_8c.html#a3">print_remote_int_param</a>(v, <span class="stringliteral">"Image_top"</span>, pd-&gt;<a class="code" href="structescp2__privdata__t.html#o58">image_top</a>);
00116   <a class="code" href="escp2-driver_8c.html#a3">print_remote_int_param</a>(v, <span class="stringliteral">"Image_width"</span>, pd-&gt;<a class="code" href="structescp2__privdata__t.html#o57">image_width</a>);
00117   <a class="code" href="escp2-driver_8c.html#a3">print_remote_int_param</a>(v, <span class="stringliteral">"Image_height"</span>, pd-&gt;<a class="code" href="structescp2__privdata__t.html#o56">image_height</a>);
00118   <a class="code" href="escp2-driver_8c.html#a3">print_remote_int_param</a>(v, <span class="stringliteral">"Image_scaled_width"</span>, pd-&gt;<a class="code" href="structescp2__privdata__t.html#o60">image_scaled_width</a>);
00119   <a class="code" href="escp2-driver_8c.html#a3">print_remote_int_param</a>(v, <span class="stringliteral">"Image_scaled_height"</span>, pd-&gt;<a class="code" href="structescp2__privdata__t.html#o62">image_scaled_height</a>);
00120   <a class="code" href="escp2-driver_8c.html#a3">print_remote_int_param</a>(v, <span class="stringliteral">"Image_printed_width"</span>, pd-&gt;<a class="code" href="structescp2__privdata__t.html#o61">image_printed_width</a>);
00121   <a class="code" href="escp2-driver_8c.html#a3">print_remote_int_param</a>(v, <span class="stringliteral">"Image_printed_height"</span>, pd-&gt;<a class="code" href="structescp2__privdata__t.html#o63">image_printed_height</a>);
00122   <a class="code" href="escp2-driver_8c.html#a3">print_remote_int_param</a>(v, <span class="stringliteral">"Image_left_position"</span>, pd-&gt;<a class="code" href="structescp2__privdata__t.html#o64">image_left_position</a>);
00123   <a class="code" href="escp2-driver_8c.html#a3">print_remote_int_param</a>(v, <span class="stringliteral">"Nozzles"</span>, pd-&gt;<a class="code" href="structescp2__privdata__t.html#o0">nozzles</a>);
00124   <a class="code" href="escp2-driver_8c.html#a3">print_remote_int_param</a>(v, <span class="stringliteral">"Nozzle_separation"</span>, pd-&gt;<a class="code" href="structescp2__privdata__t.html#o2">nozzle_separation</a>);
00125   <a class="code" href="escp2-driver_8c.html#a3">print_remote_int_param</a>(v, <span class="stringliteral">"Horizontal_passes"</span>, pd-&gt;<a class="code" href="structescp2__privdata__t.html#o40">horizontal_passes</a>);
00126   <a class="code" href="escp2-driver_8c.html#a3">print_remote_int_param</a>(v, <span class="stringliteral">"Vertical_passes"</span>, pd-&gt;<a class="code" href="structescp2__privdata__t.html#o42">res</a>-&gt;<a class="code" href="structres__t.html#o8">vertical_passes</a>);
00127   <a class="code" href="escp2-driver_8c.html#a3">print_remote_int_param</a>(v, <span class="stringliteral">"Physical_xdpi"</span>, pd-&gt;<a class="code" href="structescp2__privdata__t.html#o41">physical_xdpi</a>);
00128   <a class="code" href="escp2-driver_8c.html#a3">print_remote_int_param</a>(v, <span class="stringliteral">"Page_management_units"</span>, pd-&gt;<a class="code" href="structescp2__privdata__t.html#o5">page_management_units</a>);
00129   <a class="code" href="escp2-driver_8c.html#a3">print_remote_int_param</a>(v, <span class="stringliteral">"Vertical_units"</span>, pd-&gt;<a class="code" href="structescp2__privdata__t.html#o6">vertical_units</a>);
00130   <a class="code" href="escp2-driver_8c.html#a3">print_remote_int_param</a>(v, <span class="stringliteral">"Horizontal_units"</span>, pd-&gt;<a class="code" href="structescp2__privdata__t.html#o7">horizontal_units</a>);
00131   <a class="code" href="escp2-driver_8c.html#a3">print_remote_int_param</a>(v, <span class="stringliteral">"Micro_units"</span>, pd-&gt;<a class="code" href="structescp2__privdata__t.html#o8">micro_units</a>);
00132   <a class="code" href="escp2-driver_8c.html#a3">print_remote_int_param</a>(v, <span class="stringliteral">"Unit_scale"</span>, pd-&gt;<a class="code" href="structescp2__privdata__t.html#o9">unit_scale</a>);
00133   <a class="code" href="escp2-driver_8c.html#a3">print_remote_int_param</a>(v, <span class="stringliteral">"Zero_advance"</span>, pd-&gt;<a class="code" href="structescp2__privdata__t.html#o10">send_zero_pass_advance</a>);
00134   <a class="code" href="escp2-driver_8c.html#a3">print_remote_int_param</a>(v, <span class="stringliteral">"Bits"</span>, pd-&gt;<a class="code" href="structescp2__privdata__t.html#o11">bitwidth</a>);
00135   <a class="code" href="escp2-driver_8c.html#a3">print_remote_int_param</a>(v, <span class="stringliteral">"Resid"</span>, pd-&gt;<a class="code" href="structescp2__privdata__t.html#o13">ink_resid</a>);
00136   <a class="code" href="escp2-driver_8c.html#a3">print_remote_int_param</a>(v, <span class="stringliteral">"Drop Size"</span>, pd-&gt;<a class="code" href="structescp2__privdata__t.html#o12">drop_size</a>);
00137   <a class="code" href="escp2-driver_8c.html#a3">print_remote_int_param</a>(v, <span class="stringliteral">"Initial_vertical_offset"</span>, pd-&gt;<a class="code" href="structescp2__privdata__t.html#o66">initial_vertical_offset</a>);
00138   <a class="code" href="escp2-driver_8c.html#a3">print_remote_int_param</a>(v, <span class="stringliteral">"Channels_in_use"</span>, pd-&gt;<a class="code" href="structescp2__privdata__t.html#o17">channels_in_use</a>);
00139   <a class="code" href="escp2-driver_8c.html#a3">print_remote_int_param</a>(v, <span class="stringliteral">"Logical_channels"</span>, pd-&gt;<a class="code" href="structescp2__privdata__t.html#o15">logical_channels</a>);
00140   <a class="code" href="escp2-driver_8c.html#a3">print_remote_int_param</a>(v, <span class="stringliteral">"Physical_channels"</span>, pd-&gt;<a class="code" href="structescp2__privdata__t.html#o16">physical_channels</a>);
00141   <a class="code" href="escp2-driver_8c.html#a3">print_remote_int_param</a>(v, <span class="stringliteral">"Use_black_parameters"</span>, pd-&gt;<a class="code" href="structescp2__privdata__t.html#o20">use_black_parameters</a>);
00142   <a class="code" href="escp2-driver_8c.html#a3">print_remote_int_param</a>(v, <span class="stringliteral">"Use_fast_360"</span>, pd-&gt;<a class="code" href="structescp2__privdata__t.html#o21">use_fast_360</a>);
00143   <a class="code" href="escp2-driver_8c.html#a3">print_remote_int_param</a>(v, <span class="stringliteral">"Command_set"</span>, pd-&gt;<a class="code" href="structescp2__privdata__t.html#o30">command_set</a>);
00144   <a class="code" href="escp2-driver_8c.html#a3">print_remote_int_param</a>(v, <span class="stringliteral">"Variable_dots"</span>, pd-&gt;<a class="code" href="structescp2__privdata__t.html#o31">variable_dots</a>);
00145   <a class="code" href="escp2-driver_8c.html#a3">print_remote_int_param</a>(v, <span class="stringliteral">"Has_vacuum"</span>, pd-&gt;<a class="code" href="structescp2__privdata__t.html#o32">has_vacuum</a>);
00146   <a class="code" href="escp2-driver_8c.html#a3">print_remote_int_param</a>(v, <span class="stringliteral">"Has_graymode"</span>, pd-&gt;<a class="code" href="structescp2__privdata__t.html#o33">has_graymode</a>);
00147   <a class="code" href="escp2-driver_8c.html#a3">print_remote_int_param</a>(v, <span class="stringliteral">"Base_separation"</span>, pd-&gt;<a class="code" href="structescp2__privdata__t.html#o34">base_separation</a>);
00148   <a class="code" href="escp2-driver_8c.html#a3">print_remote_int_param</a>(v, <span class="stringliteral">"Resolution_scale"</span>, pd-&gt;<a class="code" href="structescp2__privdata__t.html#o35">resolution_scale</a>);
00149   <a class="code" href="escp2-driver_8c.html#a3">print_remote_int_param</a>(v, <span class="stringliteral">"Printing_resolution"</span>, pd-&gt;<a class="code" href="structescp2__privdata__t.html#o36">printing_resolution</a>);
00150   <a class="code" href="escp2-driver_8c.html#a3">print_remote_int_param</a>(v, <span class="stringliteral">"Separation_rows"</span>, pd-&gt;<a class="code" href="structescp2__privdata__t.html#o37">separation_rows</a>);
00151   <a class="code" href="escp2-driver_8c.html#a3">print_remote_int_param</a>(v, <span class="stringliteral">"Pseudo_separation_rows"</span>, pd-&gt;<a class="code" href="structescp2__privdata__t.html#o38">pseudo_separation_rows</a>);
00152   <a class="code" href="escp2-driver_8c.html#a3">print_remote_int_param</a>(v, <span class="stringliteral">"Extra_720dpi_separation"</span>, pd-&gt;<a class="code" href="structescp2__privdata__t.html#o39">extra_720dpi_separation</a>);
00153   <a class="code" href="escp2-driver_8c.html#a2">print_remote_param</a>(v, <span class="stringliteral">"Ink name"</span>, pd-&gt;<a class="code" href="structescp2__privdata__t.html#o14">inkname</a>-&gt;<a class="code" href="structescp2__inkname__t.html#o0">name</a>);
00154   <a class="code" href="escp2-driver_8c.html#a3">print_remote_int_param</a>(v, <span class="stringliteral">"  channels"</span>, pd-&gt;<a class="code" href="structescp2__privdata__t.html#o14">inkname</a>-&gt;<a class="code" href="structescp2__inkname__t.html#o3">channel_set</a>-&gt;<a class="code" href="structchannel__set__t.html#o2">channel_count</a>);
00155   <a class="code" href="escp2-driver_8c.html#a3">print_remote_int_param</a>(v, <span class="stringliteral">"  inkset"</span>, pd-&gt;<a class="code" href="structescp2__privdata__t.html#o14">inkname</a>-&gt;<a class="code" href="structescp2__inkname__t.html#o2">inkset</a>);
00156   <span class="keywordflow">for</span> (i = 0; i &lt; count; i++)
00157     {
00158       <span class="keyword">const</span> <a class="code" href="structstp__parameter__t.html">stp_parameter_t</a> *p = <a class="code" href="group__vars.html#ga88">stp_parameter_list_param</a>(params, i);
00159       <span class="keywordflow">switch</span> (p-&gt;<a class="code" href="structstp__parameter__t.html#o4">p_type</a>)
00160         {
00161         <span class="keywordflow">case</span> <a class="code" href="group__vars.html#gga132a10">STP_PARAMETER_TYPE_DOUBLE</a>:
00162           <span class="keywordflow">if</span> (<a class="code" href="group__vars.html#ga102">stp_check_float_parameter</a>(v, p-&gt;<a class="code" href="structstp__parameter__t.html#o0">name</a>, <a class="code" href="group__vars.html#gga135a31">STP_PARAMETER_DEFAULTED</a>))
00163             <a class="code" href="escp2-driver_8c.html#a4">print_remote_float_param</a>(v, p-&gt;<a class="code" href="structstp__parameter__t.html#o0">name</a>,
00164                                      <a class="code" href="group__vars.html#ga75">stp_get_float_parameter</a>(v, p-&gt;<a class="code" href="structstp__parameter__t.html#o0">name</a>));
00165           <span class="keywordflow">break</span>;
00166         <span class="keywordflow">case</span> <a class="code" href="group__vars.html#gga132a8">STP_PARAMETER_TYPE_INT</a>:
00167           <span class="keywordflow">if</span> (<a class="code" href="group__vars.html#ga103">stp_check_int_parameter</a>(v, p-&gt;<a class="code" href="structstp__parameter__t.html#o0">name</a>, <a class="code" href="group__vars.html#gga135a31">STP_PARAMETER_DEFAULTED</a>))
00168             <a class="code" href="escp2-driver_8c.html#a3">print_remote_int_param</a>(v, p-&gt;<a class="code" href="structstp__parameter__t.html#o0">name</a>,
00169                                    <a class="code" href="group__vars.html#ga76">stp_get_int_parameter</a>(v, p-&gt;<a class="code" href="structstp__parameter__t.html#o0">name</a>));
00170           <span class="keywordflow">break</span>;
00171         <span class="keywordflow">case</span> <a class="code" href="group__vars.html#gga132a15">STP_PARAMETER_TYPE_DIMENSION</a>:
00172           <span class="keywordflow">if</span> (<a class="code" href="group__vars.html#ga104">stp_check_dimension_parameter</a>(v, p-&gt;<a class="code" href="structstp__parameter__t.html#o0">name</a>, <a class="code" href="group__vars.html#gga135a31">STP_PARAMETER_DEFAULTED</a>))
00173             <a class="code" href="escp2-driver_8c.html#a3">print_remote_int_param</a>(v, p-&gt;<a class="code" href="structstp__parameter__t.html#o0">name</a>,
00174                                    <a class="code" href="group__vars.html#ga77">stp_get_dimension_parameter</a>(v, p-&gt;<a class="code" href="structstp__parameter__t.html#o0">name</a>));
00175           <span class="keywordflow">break</span>;
00176         <span class="keywordflow">case</span> <a class="code" href="group__vars.html#gga132a9">STP_PARAMETER_TYPE_BOOLEAN</a>:
00177           <span class="keywordflow">if</span> (<a class="code" href="group__vars.html#ga105">stp_check_boolean_parameter</a>(v, p-&gt;<a class="code" href="structstp__parameter__t.html#o0">name</a>, <a class="code" href="group__vars.html#gga135a31">STP_PARAMETER_DEFAULTED</a>))
00178             <a class="code" href="escp2-driver_8c.html#a3">print_remote_int_param</a>(v, p-&gt;<a class="code" href="structstp__parameter__t.html#o0">name</a>,
00179                                    <a class="code" href="group__vars.html#ga78">stp_get_boolean_parameter</a>(v, p-&gt;<a class="code" href="structstp__parameter__t.html#o0">name</a>));
00180           <span class="keywordflow">break</span>;
00181         <span class="keywordflow">case</span> <a class="code" href="group__vars.html#gga132a7">STP_PARAMETER_TYPE_STRING_LIST</a>:
00182           <span class="keywordflow">if</span> (<a class="code" href="group__vars.html#ga100">stp_check_string_parameter</a>(v, p-&gt;<a class="code" href="structstp__parameter__t.html#o0">name</a>, <a class="code" href="group__vars.html#gga135a31">STP_PARAMETER_DEFAULTED</a>))
00183             <a class="code" href="escp2-driver_8c.html#a2">print_remote_param</a>(v, p-&gt;<a class="code" href="structstp__parameter__t.html#o0">name</a>,
00184                                <a class="code" href="group__vars.html#ga73">stp_get_string_parameter</a>(v, p-&gt;<a class="code" href="structstp__parameter__t.html#o0">name</a>));
00185           <span class="keywordflow">break</span>;
00186         <span class="keywordflow">case</span> <a class="code" href="group__vars.html#gga132a11">STP_PARAMETER_TYPE_CURVE</a>:
00187           <span class="keywordflow">if</span> (<a class="code" href="group__vars.html#ga106">stp_check_curve_parameter</a>(v, p-&gt;<a class="code" href="structstp__parameter__t.html#o0">name</a>, <a class="code" href="group__vars.html#gga135a31">STP_PARAMETER_DEFAULTED</a>))
00188             {
00189               <span class="keywordtype">char</span> *curve =
00190                 <a class="code" href="group__curve.html#ga62">stp_curve_write_string</a>(<a class="code" href="group__vars.html#ga50">stp_get_curve_parameter</a>(v, p-&gt;<a class="code" href="structstp__parameter__t.html#o0">name</a>));
00191               <a class="code" href="escp2-driver_8c.html#a2">print_remote_param</a>(v, p-&gt;<a class="code" href="structstp__parameter__t.html#o0">name</a>, curve);
00192               <a class="code" href="group__util.html#ga31">stp_free</a>(curve);
00193             }
00194           <span class="keywordflow">break</span>;
00195         <span class="keywordflow">default</span>:
00196           <span class="keywordflow">break</span>;
00197         }
00198     }
00199   <a class="code" href="group__vars.html#ga89">stp_parameter_list_destroy</a>(params);
00200   <a class="code" href="group__util.html#ga17">stp_send_command</a>(v, <span class="stringliteral">"\033"</span>, <span class="stringliteral">"ccc"</span>, 0, 0, 0);
00201 }
00202 
00203 <span class="keyword">static</span> <span class="keywordtype">void</span>
<a name="l00204"></a><a class="code" href="escp2-driver_8c.html#a6">00204</a> <a class="code" href="escp2-driver_8c.html#a6">escp2_set_remote_sequence</a>(<a class="code" href="structstp__vars.html">stp_vars_t</a> *v)
00205 {
00206   <span class="comment">/* Magic remote mode commands, whatever they do */</span>
00207   <a class="code" href="structescp2__privdata__t.html">escp2_privdata_t</a> *pd = <a class="code" href="print-escp2_8c.html#a27">get_privdata</a>(v);
00208 
00209   <span class="keywordflow">if</span> (<a class="code" href="group__util.html#ga19">stp_get_debug_level</a>() &amp; <a class="code" href="group__util.html#ga41">STP_DBG_MARK_FILE</a>)
00210     <a class="code" href="escp2-driver_8c.html#a5">print_debug_params</a>(v);
00211   <span class="keywordflow">if</span> (pd-&gt;<a class="code" href="structescp2__privdata__t.html#o22">advanced_command_set</a> || pd-&gt;<a class="code" href="structescp2__privdata__t.html#o24">input_slot</a>)
00212     {
00213       <span class="keywordtype">int</span> feed_sequence = 0;
00214       <span class="comment">/* Enter remote mode */</span>
00215       <a class="code" href="group__util.html#ga17">stp_send_command</a>(v, <span class="stringliteral">"\033(R"</span>, <span class="stringliteral">"bcs"</span>, 0, <span class="stringliteral">"REMOTE1"</span>);
00216       <span class="keywordflow">if</span> (pd-&gt;<a class="code" href="structescp2__privdata__t.html#o30">command_set</a> == <a class="code" href="print-escp2_8h.html#a21">MODEL_COMMAND_PRO</a>)
00217         {
00218           <span class="keywordflow">if</span> (pd-&gt;<a class="code" href="structescp2__privdata__t.html#o25">paper_type</a>)
00219             {
00220               <a class="code" href="group__util.html#ga17">stp_send_command</a>(v, <span class="stringliteral">"PH"</span>, <span class="stringliteral">"bcc"</span>, 0,
00221                                pd-&gt;<a class="code" href="structescp2__privdata__t.html#o25">paper_type</a>-&gt;<a class="code" href="structpaper__t.html#o16">paper_thickness</a>);
00222               <span class="keywordflow">if</span> (pd-&gt;<a class="code" href="structescp2__privdata__t.html#o32">has_vacuum</a>)
00223                 <a class="code" href="group__util.html#ga17">stp_send_command</a>(v, <span class="stringliteral">"SN"</span>, <span class="stringliteral">"bccc"</span>, 0, 5,
00224                                  pd-&gt;<a class="code" href="structescp2__privdata__t.html#o25">paper_type</a>-&gt;<a class="code" href="structpaper__t.html#o15">vacuum_intensity</a>);
00225               <a class="code" href="group__util.html#ga17">stp_send_command</a>(v, <span class="stringliteral">"SN"</span>, <span class="stringliteral">"bccc"</span>, 0, 4,
00226                                pd-&gt;<a class="code" href="structescp2__privdata__t.html#o25">paper_type</a>-&gt;<a class="code" href="structpaper__t.html#o14">feed_adjustment</a>);
00227             }
00228         }
00229       <span class="keywordflow">else</span> <span class="keywordflow">if</span> (pd-&gt;<a class="code" href="structescp2__privdata__t.html#o22">advanced_command_set</a>)
00230         {
00231           <span class="keywordflow">if</span> (pd-&gt;<a class="code" href="structescp2__privdata__t.html#o25">paper_type</a>)
00232             feed_sequence = pd-&gt;<a class="code" href="structescp2__privdata__t.html#o25">paper_type</a>-&gt;<a class="code" href="structpaper__t.html#o12">paper_feed_sequence</a>;
00233           <span class="comment">/* Function unknown */</span>
00234           <a class="code" href="group__util.html#ga17">stp_send_command</a>(v, <span class="stringliteral">"PM"</span>, <span class="stringliteral">"bh"</span>, 0);
00235           <span class="comment">/* Set mechanism sequence */</span>
00236           <a class="code" href="group__util.html#ga17">stp_send_command</a>(v, <span class="stringliteral">"SN"</span>, <span class="stringliteral">"bccc"</span>, 0, 0, feed_sequence);
00237           <span class="keywordflow">if</span> (<a class="code" href="group__vars.html#ga62">stp_get_boolean_parameter</a>(v, <span class="stringliteral">"FullBleed"</span>))
00238             <a class="code" href="group__util.html#ga17">stp_send_command</a>(v, <span class="stringliteral">"FP"</span>, <span class="stringliteral">"bch"</span>, 0, 0xffb0);
00239         }
00240       <span class="keywordflow">if</span> (pd-&gt;<a class="code" href="structescp2__privdata__t.html#o24">input_slot</a>)
00241         {
00242           <span class="keywordtype">int</span> divisor = pd-&gt;<a class="code" href="structescp2__privdata__t.html#o34">base_separation</a> / 360;
00243           <span class="keywordtype">int</span> height = pd-&gt;<a class="code" href="structescp2__privdata__t.html#o51">page_true_height</a> * 5 / divisor;
00244           <span class="keywordflow">if</span> (pd-&gt;<a class="code" href="structescp2__privdata__t.html#o24">input_slot</a>-&gt;<a class="code" href="structinput__slot__t.html#o5">init_sequence</a>.<a class="code" href="structstp__raw__t.html#o0">bytes</a>)
00245             <a class="code" href="group__util.html#ga10">stp_zfwrite</a>(pd-&gt;<a class="code" href="structescp2__privdata__t.html#o24">input_slot</a>-&gt;<a class="code" href="structinput__slot__t.html#o5">init_sequence</a>.<a class="code" href="structstp__raw__t.html#o1">data</a>,
00246                         pd-&gt;<a class="code" href="structescp2__privdata__t.html#o24">input_slot</a>-&gt;<a class="code" href="structinput__slot__t.html#o5">init_sequence</a>.<a class="code" href="structstp__raw__t.html#o0">bytes</a>, 1, v);
00247           <span class="keywordflow">switch</span> (pd-&gt;<a class="code" href="structescp2__privdata__t.html#o24">input_slot</a>-&gt;<a class="code" href="structinput__slot__t.html#o4">roll_feed_cut_flags</a>)
00248             {
00249             <span class="keywordflow">case</span> <a class="code" href="print-escp2_8h.html#a14">ROLL_FEED_CUT_ALL</a>:
00250               <a class="code" href="group__util.html#ga17">stp_send_command</a>(v, <span class="stringliteral">"JS"</span>, <span class="stringliteral">"bh"</span>, 0);
00251               <a class="code" href="group__util.html#ga17">stp_send_command</a>(v, <span class="stringliteral">"CO"</span>, <span class="stringliteral">"bccccl"</span>, 0, 0, 1, 0, 0);
00252               <a class="code" href="group__util.html#ga17">stp_send_command</a>(v, <span class="stringliteral">"CO"</span>, <span class="stringliteral">"bccccl"</span>, 0, 0, 0, 0, height);
00253               <span class="keywordflow">break</span>;
00254             <span class="keywordflow">case</span> <a class="code" href="print-escp2_8h.html#a15">ROLL_FEED_CUT_LAST</a>:
00255               <a class="code" href="group__util.html#ga17">stp_send_command</a>(v, <span class="stringliteral">"CO"</span>, <span class="stringliteral">"bccccl"</span>, 0, 0, 1, 0, 0);
00256               <a class="code" href="group__util.html#ga17">stp_send_command</a>(v, <span class="stringliteral">"CO"</span>, <span class="stringliteral">"bccccl"</span>, 0, 0, 2, 0, height);
00257               <span class="keywordflow">break</span>;
00258             <span class="keywordflow">default</span>:
00259               <span class="keywordflow">break</span>;
00260             }
00261         }
00262 
00263       <span class="comment">/* Exit remote mode */</span>
00264 
00265       <a class="code" href="group__util.html#ga17">stp_send_command</a>(v, <span class="stringliteral">"\033"</span>, <span class="stringliteral">"ccc"</span>, 0, 0, 0);
00266     }
00267 }
00268 
00269 <span class="keyword">static</span> <span class="keywordtype">void</span>
<a name="l00270"></a><a class="code" href="escp2-driver_8c.html#a7">00270</a> <a class="code" href="escp2-driver_8c.html#a7">escp2_set_graphics_mode</a>(<a class="code" href="structstp__vars.html">stp_vars_t</a> *v)
00271 {
00272   <a class="code" href="group__util.html#ga17">stp_send_command</a>(v, <span class="stringliteral">"\033(G"</span>, <span class="stringliteral">"bc"</span>, 1);
00273 }
00274 
00275 <span class="keyword">static</span> <span class="keywordtype">void</span>
<a name="l00276"></a><a class="code" href="escp2-driver_8c.html#a8">00276</a> <a class="code" href="escp2-driver_8c.html#a8">escp2_set_resolution</a>(<a class="code" href="structstp__vars.html">stp_vars_t</a> *v)
00277 {
00278   <a class="code" href="structescp2__privdata__t.html">escp2_privdata_t</a> *pd = <a class="code" href="print-escp2_8c.html#a27">get_privdata</a>(v);
00279   <span class="keywordflow">if</span> (pd-&gt;<a class="code" href="structescp2__privdata__t.html#o23">use_extended_commands</a>)
00280     <a class="code" href="group__util.html#ga17">stp_send_command</a>(v, <span class="stringliteral">"\033(U"</span>, <span class="stringliteral">"bccch"</span>,
00281                      pd-&gt;<a class="code" href="structescp2__privdata__t.html#o9">unit_scale</a> / pd-&gt;<a class="code" href="structescp2__privdata__t.html#o5">page_management_units</a>,
00282                      pd-&gt;<a class="code" href="structescp2__privdata__t.html#o9">unit_scale</a> / pd-&gt;<a class="code" href="structescp2__privdata__t.html#o6">vertical_units</a>,
00283                      pd-&gt;<a class="code" href="structescp2__privdata__t.html#o9">unit_scale</a> / pd-&gt;<a class="code" href="structescp2__privdata__t.html#o7">horizontal_units</a>,
00284                      pd-&gt;<a class="code" href="structescp2__privdata__t.html#o9">unit_scale</a>);
00285   <span class="keywordflow">else</span>
00286     <a class="code" href="group__util.html#ga17">stp_send_command</a>(v, <span class="stringliteral">"\033(U"</span>, <span class="stringliteral">"bc"</span>,
00287                      pd-&gt;<a class="code" href="structescp2__privdata__t.html#o9">unit_scale</a> / pd-&gt;<a class="code" href="structescp2__privdata__t.html#o5">page_management_units</a>);
00288 }
00289 
00290 <span class="keyword">static</span> <span class="keywordtype">void</span>
<a name="l00291"></a><a class="code" href="escp2-driver_8c.html#a9">00291</a> <a class="code" href="escp2-driver_8c.html#a9">escp2_set_color</a>(<a class="code" href="structstp__vars.html">stp_vars_t</a> *v)
00292 {
00293   <a class="code" href="structescp2__privdata__t.html">escp2_privdata_t</a> *pd = <a class="code" href="print-escp2_8c.html#a27">get_privdata</a>(v);
00294   <span class="keywordflow">if</span> (pd-&gt;<a class="code" href="structescp2__privdata__t.html#o21">use_fast_360</a>)
00295     <a class="code" href="group__util.html#ga17">stp_send_command</a>(v, <span class="stringliteral">"\033(K"</span>, <span class="stringliteral">"bcc"</span>, 0, 3);
00296   <span class="keywordflow">else</span> <span class="keywordflow">if</span> (pd-&gt;<a class="code" href="structescp2__privdata__t.html#o33">has_graymode</a>)
00297     <a class="code" href="group__util.html#ga17">stp_send_command</a>(v, <span class="stringliteral">"\033(K"</span>, <span class="stringliteral">"bcc"</span>, 0,
00298                      (pd-&gt;<a class="code" href="structescp2__privdata__t.html#o20">use_black_parameters</a> ? 1 : 2));
00299 }
00300 
00301 <span class="keyword">static</span> <span class="keywordtype">void</span>
<a name="l00302"></a><a class="code" href="escp2-driver_8c.html#a10">00302</a> <a class="code" href="escp2-driver_8c.html#a10">escp2_set_printer_weave</a>(<a class="code" href="structstp__vars.html">stp_vars_t</a> *v)
00303 {
00304   <a class="code" href="structescp2__privdata__t.html">escp2_privdata_t</a> *pd = <a class="code" href="print-escp2_8c.html#a27">get_privdata</a>(v);
00305   <span class="keywordtype">int</span> printer_weave_parm = 0;
00306   <span class="keywordflow">if</span> (pd-&gt;<a class="code" href="structescp2__privdata__t.html#o43">printer_weave</a>)
00307     printer_weave_parm = pd-&gt;<a class="code" href="structescp2__privdata__t.html#o43">printer_weave</a>-&gt;<a class="code" href="structprinter__weave__t.html#o2">value</a>;
00308   <span class="keywordflow">else</span> <span class="keywordflow">if</span> (pd-&gt;<a class="code" href="structescp2__privdata__t.html#o42">res</a>-&gt;<a class="code" href="structres__t.html#o7">printer_weave</a>)
00309     printer_weave_parm = pd-&gt;<a class="code" href="structescp2__privdata__t.html#o42">res</a>-&gt;<a class="code" href="structres__t.html#o7">printer_weave</a>;
00310   <a class="code" href="group__util.html#ga17">stp_send_command</a>(v, <span class="stringliteral">"\033(i"</span>, <span class="stringliteral">"bc"</span>, printer_weave_parm);
00311 }
00312 
00313 <span class="keyword">static</span> <span class="keywordtype">void</span>
<a name="l00314"></a><a class="code" href="escp2-driver_8c.html#a11">00314</a> <a class="code" href="escp2-driver_8c.html#a11">escp2_set_printhead_speed</a>(<a class="code" href="structstp__vars.html">stp_vars_t</a> *v)
00315 {
00316   <a class="code" href="structescp2__privdata__t.html">escp2_privdata_t</a> *pd = <a class="code" href="print-escp2_8c.html#a27">get_privdata</a>(v);
00317   <span class="keyword">const</span> <span class="keywordtype">char</span> *direction = <a class="code" href="group__vars.html#ga36">stp_get_string_parameter</a>(v, <span class="stringliteral">"PrintingDirection"</span>);
00318   <span class="keywordtype">int</span> unidirectional;
00319   <span class="keywordflow">if</span> (direction &amp;&amp; strcmp(direction, <span class="stringliteral">"Unidirectional"</span>) == 0)
00320     unidirectional = 1;
00321   <span class="keywordflow">else</span> <span class="keywordflow">if</span> (direction &amp;&amp; strcmp(direction, <span class="stringliteral">"Bidirectional"</span>) == 0)
00322     unidirectional = 0;
00323   <span class="keywordflow">else</span> <span class="keywordflow">if</span> (pd-&gt;<a class="code" href="structescp2__privdata__t.html#o42">res</a>-&gt;<a class="code" href="structres__t.html#o2">hres</a> &gt;= 720 &amp;&amp; pd-&gt;<a class="code" href="structescp2__privdata__t.html#o42">res</a>-&gt;<a class="code" href="structres__t.html#o3">vres</a> &gt;= 720)
00324     unidirectional = 1;
00325   <span class="keywordflow">else</span>
00326     unidirectional = 0;
00327   <span class="keywordflow">if</span> (unidirectional)
00328     {
00329       <a class="code" href="group__util.html#ga17">stp_send_command</a>(v, <span class="stringliteral">"\033U"</span>, <span class="stringliteral">"c"</span>, 1);
00330       <span class="keywordflow">if</span> (pd-&gt;<a class="code" href="structescp2__privdata__t.html#o42">res</a>-&gt;<a class="code" href="structres__t.html#o2">hres</a> &gt; pd-&gt;<a class="code" href="structescp2__privdata__t.html#o36">printing_resolution</a>)
00331         <a class="code" href="group__util.html#ga17">stp_send_command</a>(v, <span class="stringliteral">"\033(s"</span>, <span class="stringliteral">"bc"</span>, 2);
00332     }
00333   <span class="keywordflow">else</span>
00334     <a class="code" href="group__util.html#ga17">stp_send_command</a>(v, <span class="stringliteral">"\033U"</span>, <span class="stringliteral">"c"</span>, 0);
00335 }
00336 
00337 <span class="keyword">static</span> <span class="keywordtype">void</span>
<a name="l00338"></a><a class="code" href="escp2-driver_8c.html#a12">00338</a> <a class="code" href="escp2-driver_8c.html#a12">escp2_set_dot_size</a>(<a class="code" href="structstp__vars.html">stp_vars_t</a> *v)
00339 {
00340   <a class="code" href="structescp2__privdata__t.html">escp2_privdata_t</a> *pd = <a class="code" href="print-escp2_8c.html#a27">get_privdata</a>(v);
00341   <span class="comment">/* Dot size */</span>
00342   <span class="keywordflow">if</span> (pd-&gt;<a class="code" href="structescp2__privdata__t.html#o12">drop_size</a> &gt;= 0)
00343     <a class="code" href="group__util.html#ga17">stp_send_command</a>(v, <span class="stringliteral">"\033(e"</span>, <span class="stringliteral">"bcc"</span>, 0, pd-&gt;<a class="code" href="structescp2__privdata__t.html#o12">drop_size</a>);
00344 }
00345 
00346 <span class="keyword">static</span> <span class="keywordtype">void</span>
<a name="l00347"></a><a class="code" href="escp2-driver_8c.html#a13">00347</a> <a class="code" href="escp2-driver_8c.html#a13">escp2_set_page_height</a>(<a class="code" href="structstp__vars.html">stp_vars_t</a> *v)
00348 {
00349   <a class="code" href="structescp2__privdata__t.html">escp2_privdata_t</a> *pd = <a class="code" href="print-escp2_8c.html#a27">get_privdata</a>(v);
00350   <span class="keywordtype">int</span> l = pd-&gt;<a class="code" href="structescp2__privdata__t.html#o5">page_management_units</a> * pd-&gt;<a class="code" href="structescp2__privdata__t.html#o51">page_true_height</a> / 72;
00351   <span class="keywordflow">if</span> (pd-&gt;<a class="code" href="structescp2__privdata__t.html#o23">use_extended_commands</a>)
00352     <a class="code" href="group__util.html#ga17">stp_send_command</a>(v, <span class="stringliteral">"\033(C"</span>, <span class="stringliteral">"bl"</span>, l);
00353   <span class="keywordflow">else</span>
00354     <a class="code" href="group__util.html#ga17">stp_send_command</a>(v, <span class="stringliteral">"\033(C"</span>, <span class="stringliteral">"bh"</span>, l);
00355 }
00356 
00357 <span class="keyword">static</span> <span class="keywordtype">void</span>
<a name="l00358"></a><a class="code" href="escp2-driver_8c.html#a14">00358</a> <a class="code" href="escp2-driver_8c.html#a14">escp2_set_margins</a>(<a class="code" href="structstp__vars.html">stp_vars_t</a> *v)
00359 {
00360   <a class="code" href="structescp2__privdata__t.html">escp2_privdata_t</a> *pd = <a class="code" href="print-escp2_8c.html#a27">get_privdata</a>(v);
00361   <span class="keywordtype">int</span> bot = pd-&gt;<a class="code" href="structescp2__privdata__t.html#o5">page_management_units</a> * pd-&gt;<a class="code" href="structescp2__privdata__t.html#o48">page_bottom</a> / 72;
00362   <span class="keywordtype">int</span> top = pd-&gt;<a class="code" href="structescp2__privdata__t.html#o5">page_management_units</a> * pd-&gt;<a class="code" href="structescp2__privdata__t.html#o47">page_top</a> / 72;
00363 
00364   top += pd-&gt;<a class="code" href="structescp2__privdata__t.html#o66">initial_vertical_offset</a>;
00365   <span class="keywordflow">if</span> (pd-&gt;<a class="code" href="structescp2__privdata__t.html#o23">use_extended_commands</a> &amp;&amp;
00366       (pd-&gt;<a class="code" href="structescp2__privdata__t.html#o30">command_set</a> == <a class="code" href="print-escp2_8h.html#a20">MODEL_COMMAND_2000</a> ||
00367        pd-&gt;<a class="code" href="structescp2__privdata__t.html#o30">command_set</a> == <a class="code" href="print-escp2_8h.html#a21">MODEL_COMMAND_PRO</a>))
00368     <a class="code" href="group__util.html#ga17">stp_send_command</a>(v, <span class="stringliteral">"\033(c"</span>, <span class="stringliteral">"bll"</span>, top, bot);
00369   <span class="keywordflow">else</span>
00370     <a class="code" href="group__util.html#ga17">stp_send_command</a>(v, <span class="stringliteral">"\033(c"</span>, <span class="stringliteral">"bhh"</span>, top, bot);
00371 }
00372 
00373 <span class="keyword">static</span> <span class="keywordtype">void</span>
<a name="l00374"></a><a class="code" href="escp2-driver_8c.html#a15">00374</a> <a class="code" href="escp2-driver_8c.html#a15">escp2_set_form_factor</a>(<a class="code" href="structstp__vars.html">stp_vars_t</a> *v)
00375 {
00376   <a class="code" href="structescp2__privdata__t.html">escp2_privdata_t</a> *pd = <a class="code" href="print-escp2_8c.html#a27">get_privdata</a>(v);
00377   <span class="keywordflow">if</span> (pd-&gt;<a class="code" href="structescp2__privdata__t.html#o22">advanced_command_set</a>)
00378     {
00379       <span class="keywordtype">int</span> w = pd-&gt;<a class="code" href="structescp2__privdata__t.html#o49">page_width</a> * pd-&gt;<a class="code" href="structescp2__privdata__t.html#o5">page_management_units</a> / 72;
00380       <span class="keywordtype">int</span> h = pd-&gt;<a class="code" href="structescp2__privdata__t.html#o51">page_true_height</a> * pd-&gt;<a class="code" href="structescp2__privdata__t.html#o5">page_management_units</a> / 72;
00381 
00382       <span class="keywordflow">if</span> (<a class="code" href="group__vars.html#ga62">stp_get_boolean_parameter</a>(v, <span class="stringliteral">"FullBleed"</span>))
00383         <span class="comment">/* Make the page 160/360" wider for full bleed printing. */</span>
00384         <span class="comment">/* Per the Epson manual, the margin should be expanded by 80/360" */</span>
00385         <span class="comment">/* so we need to do this on the left and the right */</span>
00386         w += 320 * pd-&gt;<a class="code" href="structescp2__privdata__t.html#o5">page_management_units</a> / 720;
00387 
00388       <a class="code" href="group__util.html#ga17">stp_send_command</a>(v, <span class="stringliteral">"\033(S"</span>, <span class="stringliteral">"bll"</span>, w, h);
00389     }
00390 }
00391 
00392 <span class="keyword">static</span> <span class="keywordtype">void</span>
<a name="l00393"></a><a class="code" href="escp2-driver_8c.html#a16">00393</a> <a class="code" href="escp2-driver_8c.html#a16">escp2_set_printhead_resolution</a>(<a class="code" href="structstp__vars.html">stp_vars_t</a> *v)
00394 {
00395   <a class="code" href="structescp2__privdata__t.html">escp2_privdata_t</a> *pd = <a class="code" href="print-escp2_8c.html#a27">get_privdata</a>(v);
00396   <span class="keywordflow">if</span> (pd-&gt;<a class="code" href="structescp2__privdata__t.html#o23">use_extended_commands</a>)
00397     {
00398       <span class="keywordtype">int</span> xres;
00399       <span class="keywordtype">int</span> yres = pd-&gt;<a class="code" href="structescp2__privdata__t.html#o35">resolution_scale</a>;
00400 
00401       xres = pd-&gt;<a class="code" href="structescp2__privdata__t.html#o35">resolution_scale</a> / pd-&gt;<a class="code" href="structescp2__privdata__t.html#o41">physical_xdpi</a>;
00402 
00403       <span class="keywordflow">if</span> (pd-&gt;<a class="code" href="structescp2__privdata__t.html#o30">command_set</a> == <a class="code" href="print-escp2_8h.html#a21">MODEL_COMMAND_PRO</a> &amp;&amp; !pd-&gt;<a class="code" href="structescp2__privdata__t.html#o42">res</a>-&gt;<a class="code" href="structres__t.html#o6">softweave</a>)
00404         yres = yres /  pd-&gt;<a class="code" href="structescp2__privdata__t.html#o42">res</a>-&gt;<a class="code" href="structres__t.html#o3">vres</a>;
00405       <span class="keywordflow">else</span>
00406         yres = yres * pd-&gt;<a class="code" href="structescp2__privdata__t.html#o2">nozzle_separation</a> / pd-&gt;<a class="code" href="structescp2__privdata__t.html#o34">base_separation</a>;
00407 
00408       <span class="comment">/* Magic resolution cookie */</span>
00409       <a class="code" href="group__util.html#ga17">stp_send_command</a>(v, <span class="stringliteral">"\033(D"</span>, <span class="stringliteral">"bhcc"</span>, pd-&gt;<a class="code" href="structescp2__privdata__t.html#o35">resolution_scale</a>, yres, xres);
00410     }
00411 }
00412 
00413 <span class="keyword">static</span> <span class="keywordtype">void</span>
<a name="l00414"></a><a class="code" href="escp2-driver_8c.html#a17">00414</a> <a class="code" href="escp2-driver_8c.html#a17">set_vertical_position</a>(<a class="code" href="structstp__vars.html">stp_vars_t</a> *v, <a class="code" href="structstp__pass__t.html">stp_pass_t</a> *pass)
00415 {
00416   <a class="code" href="structescp2__privdata__t.html">escp2_privdata_t</a> *pd = <a class="code" href="print-escp2_8c.html#a27">get_privdata</a>(v);
00417   <span class="keywordtype">int</span> advance = pass-&gt;<a class="code" href="structstp__pass__t.html#o2">logicalpassstart</a> - pd-&gt;<a class="code" href="structescp2__privdata__t.html#o69">last_pass_offset</a> -
00418     (pd-&gt;<a class="code" href="structescp2__privdata__t.html#o37">separation_rows</a> - 1);
00419   advance = advance * pd-&gt;<a class="code" href="structescp2__privdata__t.html#o6">vertical_units</a> / pd-&gt;<a class="code" href="structescp2__privdata__t.html#o42">res</a>-&gt;<a class="code" href="structres__t.html#o3">vres</a>;
00420   <span class="keywordflow">if</span> (pass-&gt;<a class="code" href="structstp__pass__t.html#o2">logicalpassstart</a> &gt; pd-&gt;<a class="code" href="structescp2__privdata__t.html#o69">last_pass_offset</a> ||
00421       (pd-&gt;<a class="code" href="structescp2__privdata__t.html#o10">send_zero_pass_advance</a> &amp;&amp; pass-&gt;<a class="code" href="structstp__pass__t.html#o0">pass</a> &gt; pd-&gt;<a class="code" href="structescp2__privdata__t.html#o70">last_pass</a>) ||
00422       pd-&gt;<a class="code" href="structescp2__privdata__t.html#o67">printing_initial_vertical_offset</a> != 0)
00423     {
00424       advance += pd-&gt;<a class="code" href="structescp2__privdata__t.html#o67">printing_initial_vertical_offset</a>;
00425       pd-&gt;<a class="code" href="structescp2__privdata__t.html#o67">printing_initial_vertical_offset</a> = 0;
00426       <span class="keywordflow">if</span> (pd-&gt;<a class="code" href="structescp2__privdata__t.html#o23">use_extended_commands</a>)
00427         <a class="code" href="group__util.html#ga17">stp_send_command</a>(v, <span class="stringliteral">"\033(v"</span>, <span class="stringliteral">"bl"</span>, advance);
00428       <span class="keywordflow">else</span>
00429         <a class="code" href="group__util.html#ga17">stp_send_command</a>(v, <span class="stringliteral">"\033(v"</span>, <span class="stringliteral">"bh"</span>, advance);
00430       pd-&gt;<a class="code" href="structescp2__privdata__t.html#o69">last_pass_offset</a> = pass-&gt;<a class="code" href="structstp__pass__t.html#o2">logicalpassstart</a>;
00431       pd-&gt;<a class="code" href="structescp2__privdata__t.html#o70">last_pass</a> = pass-&gt;<a class="code" href="structstp__pass__t.html#o0">pass</a>;
00432     }
00433 }
00434 
00435 <span class="keyword">static</span> <span class="keywordtype">void</span>
<a name="l00436"></a><a class="code" href="escp2-driver_8c.html#a18">00436</a> <a class="code" href="escp2-driver_8c.html#a18">set_color</a>(<a class="code" href="structstp__vars.html">stp_vars_t</a> *v, <a class="code" href="structstp__pass__t.html">stp_pass_t</a> *pass, <span class="keywordtype">int</span> color)
00437 {
00438   <a class="code" href="structescp2__privdata__t.html">escp2_privdata_t</a> *pd = <a class="code" href="print-escp2_8c.html#a27">get_privdata</a>(v);
00439   <span class="keywordflow">if</span> (pd-&gt;<a class="code" href="structescp2__privdata__t.html#o68">last_color</a> != color &amp;&amp; ! pd-&gt;<a class="code" href="structescp2__privdata__t.html#o23">use_extended_commands</a>)
00440     {
00441       <span class="keywordtype">int</span> ncolor = pd-&gt;<a class="code" href="structescp2__privdata__t.html#o19">channels</a>[color]-&gt;<a class="code" href="structphysical__subchannel__t.html#o0">color</a>;
00442       <span class="keywordtype">int</span> subchannel = pd-&gt;<a class="code" href="structescp2__privdata__t.html#o19">channels</a>[color]-&gt;<a class="code" href="structphysical__subchannel__t.html#o1">subchannel</a>;
00443       <span class="keywordflow">if</span> (subchannel &gt;= 0)
00444         <a class="code" href="group__util.html#ga17">stp_send_command</a>(v, <span class="stringliteral">"\033(r"</span>, <span class="stringliteral">"bcc"</span>, subchannel, ncolor);
00445       <span class="keywordflow">else</span>
00446         <a class="code" href="group__util.html#ga17">stp_send_command</a>(v, <span class="stringliteral">"\033r"</span>, <span class="stringliteral">"c"</span>, ncolor);
00447       pd-&gt;<a class="code" href="structescp2__privdata__t.html#o68">last_color</a> = color;
00448     }
00449 }
00450 
00451 <span class="keyword">static</span> <span class="keywordtype">void</span>
<a name="l00452"></a><a class="code" href="escp2-driver_8c.html#a19">00452</a> <a class="code" href="escp2-driver_8c.html#a19">set_horizontal_position</a>(<a class="code" href="structstp__vars.html">stp_vars_t</a> *v, <a class="code" href="structstp__pass__t.html">stp_pass_t</a> *pass, <span class="keywordtype">int</span> vertical_subpass)
00453 {
00454   <a class="code" href="structescp2__privdata__t.html">escp2_privdata_t</a> *pd = <a class="code" href="print-escp2_8c.html#a27">get_privdata</a>(v);
00455   <span class="keywordtype">int</span> microoffset = (vertical_subpass &amp; (pd-&gt;<a class="code" href="structescp2__privdata__t.html#o40">horizontal_passes</a> - 1)) *
00456     pd-&gt;<a class="code" href="structescp2__privdata__t.html#o60">image_scaled_width</a> / pd-&gt;<a class="code" href="structescp2__privdata__t.html#o61">image_printed_width</a>;
00457   <span class="keywordtype">int</span> pos = pd-&gt;<a class="code" href="structescp2__privdata__t.html#o64">image_left_position</a> + microoffset;
00458 
00459   <span class="keywordflow">if</span> (pos != 0)
00460     {
00461       <span class="comment">/* Note hard-coded 1440 -- from Epson manuals */</span>
00462       <span class="keywordflow">if</span> (pd-&gt;<a class="code" href="structescp2__privdata__t.html#o30">command_set</a> == <a class="code" href="print-escp2_8h.html#a21">MODEL_COMMAND_PRO</a> || pd-&gt;<a class="code" href="structescp2__privdata__t.html#o31">variable_dots</a>)
00463         <a class="code" href="group__util.html#ga17">stp_send_command</a>(v, <span class="stringliteral">"\033($"</span>, <span class="stringliteral">"bl"</span>, pos);
00464       <span class="keywordflow">else</span> <span class="keywordflow">if</span> (pd-&gt;<a class="code" href="structescp2__privdata__t.html#o22">advanced_command_set</a> || pd-&gt;<a class="code" href="structescp2__privdata__t.html#o42">res</a>-&gt;<a class="code" href="structres__t.html#o2">hres</a> &gt; 720)
00465         <a class="code" href="group__util.html#ga17">stp_send_command</a>(v, <span class="stringliteral">"\033(\\"</span>, <span class="stringliteral">"bhh"</span>, pd-&gt;<a class="code" href="structescp2__privdata__t.html#o8">micro_units</a>, pos);
00466       <span class="keywordflow">else</span>
00467         <a class="code" href="group__util.html#ga17">stp_send_command</a>(v, <span class="stringliteral">"\033\\"</span>, <span class="stringliteral">"h"</span>, pos);
00468     }
00469 }
00470 
00471 <span class="keyword">static</span> <span class="keywordtype">void</span>
<a name="l00472"></a><a class="code" href="escp2-driver_8c.html#a20">00472</a> <a class="code" href="escp2-driver_8c.html#a20">send_print_command</a>(<a class="code" href="structstp__vars.html">stp_vars_t</a> *v, <a class="code" href="structstp__pass__t.html">stp_pass_t</a> *pass, <span class="keywordtype">int</span> color, <span class="keywordtype">int</span> nlines)
00473 {
00474   <a class="code" href="structescp2__privdata__t.html">escp2_privdata_t</a> *pd = <a class="code" href="print-escp2_8c.html#a27">get_privdata</a>(v);
00475   <span class="keywordtype">int</span> lwidth = (pd-&gt;<a class="code" href="structescp2__privdata__t.html#o61">image_printed_width</a> + (pd-&gt;<a class="code" href="structescp2__privdata__t.html#o40">horizontal_passes</a> - 1)) /
00476     pd-&gt;<a class="code" href="structescp2__privdata__t.html#o40">horizontal_passes</a>;
00477   <span class="keywordflow">if</span> (pd-&gt;<a class="code" href="structescp2__privdata__t.html#o30">command_set</a> == <a class="code" href="print-escp2_8h.html#a21">MODEL_COMMAND_PRO</a> || pd-&gt;<a class="code" href="structescp2__privdata__t.html#o31">variable_dots</a>)
00478     {
00479       <span class="keywordtype">int</span> ncolor = pd-&gt;<a class="code" href="structescp2__privdata__t.html#o19">channels</a>[color]-&gt;<a class="code" href="structphysical__subchannel__t.html#o0">color</a>;
00480       <span class="keywordtype">int</span> subchannel = pd-&gt;<a class="code" href="structescp2__privdata__t.html#o19">channels</a>[color]-&gt;<a class="code" href="structphysical__subchannel__t.html#o1">subchannel</a>;
00481       <span class="keywordtype">int</span> nwidth = pd-&gt;<a class="code" href="structescp2__privdata__t.html#o11">bitwidth</a> * ((lwidth + 7) / 8);
00482       <span class="keywordflow">if</span> (subchannel &gt;= 0)
00483         ncolor |= (subchannel &lt;&lt; 4);
00484       <a class="code" href="group__util.html#ga17">stp_send_command</a>(v, <span class="stringliteral">"\033i"</span>, <span class="stringliteral">"ccchh"</span>, ncolor, <a class="code" href="print-escp2_8h.html#a52">COMPRESSION</a>,
00485                        pd-&gt;<a class="code" href="structescp2__privdata__t.html#o11">bitwidth</a>, nwidth, nlines);
00486     }
00487   <span class="keywordflow">else</span>
00488     {
00489       <span class="keywordtype">int</span> ygap = 3600 / pd-&gt;<a class="code" href="structescp2__privdata__t.html#o6">vertical_units</a>;
00490       <span class="keywordtype">int</span> xgap = 3600 / pd-&gt;<a class="code" href="structescp2__privdata__t.html#o41">physical_xdpi</a>;
00491       <span class="keywordflow">if</span> (pd-&gt;<a class="code" href="structescp2__privdata__t.html#o0">nozzles</a> == 1)
00492         {
00493           <span class="keywordflow">if</span> (pd-&gt;<a class="code" href="structescp2__privdata__t.html#o6">vertical_units</a> == 720 &amp;&amp; pd-&gt;<a class="code" href="structescp2__privdata__t.html#o39">extra_720dpi_separation</a>)
00494             ygap *= pd-&gt;<a class="code" href="structescp2__privdata__t.html#o39">extra_720dpi_separation</a>;
00495         }
00496       <span class="keywordflow">else</span> <span class="keywordflow">if</span> (pd-&gt;<a class="code" href="structescp2__privdata__t.html#o39">extra_720dpi_separation</a>)
00497         ygap *= pd-&gt;<a class="code" href="structescp2__privdata__t.html#o39">extra_720dpi_separation</a>;
00498       <span class="keywordflow">else</span> <span class="keywordflow">if</span> (pd-&gt;<a class="code" href="structescp2__privdata__t.html#o38">pseudo_separation_rows</a> &gt; 0)
00499         ygap *= pd-&gt;<a class="code" href="structescp2__privdata__t.html#o38">pseudo_separation_rows</a>;
00500       <span class="keywordflow">else</span>
00501         ygap *= pd-&gt;<a class="code" href="structescp2__privdata__t.html#o37">separation_rows</a>;
00502       <a class="code" href="group__util.html#ga17">stp_send_command</a>(v, <span class="stringliteral">"\033."</span>, <span class="stringliteral">"cccch"</span>, <a class="code" href="print-escp2_8h.html#a52">COMPRESSION</a>, ygap, xgap, nlines,
00503                        lwidth);
00504     }
00505 }
00506 
00507 <span class="keyword">static</span> <span class="keywordtype">void</span>
<a name="l00508"></a><a class="code" href="escp2-driver_8c.html#a21">00508</a> <a class="code" href="escp2-driver_8c.html#a21">send_extra_data</a>(<a class="code" href="structstp__vars.html">stp_vars_t</a> *v, <span class="keywordtype">int</span> extralines)
00509 {
00510   <a class="code" href="structescp2__privdata__t.html">escp2_privdata_t</a> *pd = <a class="code" href="print-escp2_8c.html#a27">get_privdata</a>(v);
00511   <span class="keywordtype">int</span> lwidth = (pd-&gt;<a class="code" href="structescp2__privdata__t.html#o61">image_printed_width</a> + (pd-&gt;<a class="code" href="structescp2__privdata__t.html#o40">horizontal_passes</a> - 1)) /
00512     pd-&gt;<a class="code" href="structescp2__privdata__t.html#o40">horizontal_passes</a>;
00513 <span class="preprocessor">#if TEST_UNCOMPRESSED</span>
00514 <span class="preprocessor"></span>  <span class="keywordtype">int</span> i;
00515   <span class="keywordflow">for</span> (i = 0; i &lt; pd-&gt;<a class="code" href="structescp2__privdata__t.html#o11">bitwidth</a> * (lwidth + 7) / 8; i++)
00516     <a class="code" href="group__util.html#ga11">stp_putc</a>(0, v);
00517 <span class="preprocessor">#else  </span><span class="comment">/* !TEST_UNCOMPRESSED */</span>
00518   <span class="keywordtype">int</span> k, l;
00519   <span class="keywordtype">int</span> bytes_to_fill = pd-&gt;<a class="code" href="structescp2__privdata__t.html#o11">bitwidth</a> * ((lwidth + 7) / 8);
00520   <span class="keywordtype">int</span> full_blocks = bytes_to_fill / 128;
00521   <span class="keywordtype">int</span> leftover = bytes_to_fill % 128;
00522   <span class="keywordtype">int</span> total_bytes = extralines * (full_blocks + 1) * 2;
00523   <span class="keywordtype">unsigned</span> <span class="keywordtype">char</span> *buf = <a class="code" href="group__util.html#ga28">stp_malloc</a>(total_bytes);
00524   total_bytes = 0;
00525   <span class="keywordflow">for</span> (k = 0; k &lt; extralines; k++)
00526     {
00527       <span class="keywordflow">for</span> (l = 0; l &lt; full_blocks; l++)
00528         {
00529           buf[total_bytes++] = 129;
00530           buf[total_bytes++] = 0;
00531         }
00532       <span class="keywordflow">if</span> (leftover == 1)
00533         {
00534           buf[total_bytes++] = 1;
00535           buf[total_bytes++] = 0;
00536         }
00537       <span class="keywordflow">else</span> <span class="keywordflow">if</span> (leftover &gt; 0)
00538         {
00539           buf[total_bytes++] = 257 - leftover;
00540           buf[total_bytes++] = 0;
00541         }
00542     }
00543   <a class="code" href="group__util.html#ga10">stp_zfwrite</a>((<span class="keyword">const</span> <span class="keywordtype">char</span> *) buf, total_bytes, 1, v);
00544   <a class="code" href="group__util.html#ga31">stp_free</a>(buf);
00545 <span class="preprocessor">#endif </span><span class="comment">/* TEST_UNCOMPRESSED */</span>
00546 }
00547 
00548 <span class="keywordtype">void</span>
<a name="l00549"></a><a class="code" href="print-escp2_8h.html#a151">00549</a> <a class="code" href="print-escp2_8h.html#a151">stpi_escp2_init_printer</a>(<a class="code" href="structstp__vars.html">stp_vars_t</a> *v)
00550 {
00551   <a class="code" href="escp2-driver_8c.html#a1">escp2_reset_printer</a>(v);
00552   <a class="code" href="escp2-driver_8c.html#a6">escp2_set_remote_sequence</a>(v);
00553   <a class="code" href="escp2-driver_8c.html#a7">escp2_set_graphics_mode</a>(v);
00554   <a class="code" href="escp2-driver_8c.html#a8">escp2_set_resolution</a>(v);
00555   <a class="code" href="escp2-driver_8c.html#a9">escp2_set_color</a>(v);
00556   <a class="code" href="escp2-driver_8c.html#a10">escp2_set_printer_weave</a>(v);
00557   <a class="code" href="escp2-driver_8c.html#a11">escp2_set_printhead_speed</a>(v);
00558   <a class="code" href="escp2-driver_8c.html#a12">escp2_set_dot_size</a>(v);
00559   <a class="code" href="escp2-driver_8c.html#a16">escp2_set_printhead_resolution</a>(v);
00560   <a class="code" href="escp2-driver_8c.html#a13">escp2_set_page_height</a>(v);
00561   <a class="code" href="escp2-driver_8c.html#a14">escp2_set_margins</a>(v);
00562   <a class="code" href="escp2-driver_8c.html#a15">escp2_set_form_factor</a>(v);
00563 }
00564 
00565 <span class="keywordtype">void</span>
<a name="l00566"></a><a class="code" href="print-escp2_8h.html#a152">00566</a> <a class="code" href="print-escp2_8h.html#a152">stpi_escp2_deinit_printer</a>(<a class="code" href="structstp__vars.html">stp_vars_t</a> *v)
00567 {
00568   <a class="code" href="structescp2__privdata__t.html">escp2_privdata_t</a> *pd = <a class="code" href="print-escp2_8c.html#a27">get_privdata</a>(v);
00569   <a class="code" href="group__util.html#ga16">stp_puts</a>(<span class="stringliteral">"\033@"</span>, v); <span class="comment">/* ESC/P2 reset */</span>
00570   <span class="keywordflow">if</span> (pd-&gt;<a class="code" href="structescp2__privdata__t.html#o22">advanced_command_set</a> || pd-&gt;<a class="code" href="structescp2__privdata__t.html#o24">input_slot</a>)
00571     {
00572       <a class="code" href="group__util.html#ga17">stp_send_command</a>(v, <span class="stringliteral">"\033(R"</span>, <span class="stringliteral">"bcs"</span>, 0, <span class="stringliteral">"REMOTE1"</span>);
00573       <span class="keywordflow">if</span> (pd-&gt;<a class="code" href="structescp2__privdata__t.html#o24">input_slot</a> &amp;&amp; pd-&gt;<a class="code" href="structescp2__privdata__t.html#o24">input_slot</a>-&gt;<a class="code" href="structinput__slot__t.html#o6">deinit_sequence</a>.<a class="code" href="structstp__raw__t.html#o0">bytes</a>)
00574         <a class="code" href="group__util.html#ga10">stp_zfwrite</a>(pd-&gt;<a class="code" href="structescp2__privdata__t.html#o24">input_slot</a>-&gt;<a class="code" href="structinput__slot__t.html#o6">deinit_sequence</a>.<a class="code" href="structstp__raw__t.html#o1">data</a>,
00575                     pd-&gt;<a class="code" href="structescp2__privdata__t.html#o24">input_slot</a>-&gt;<a class="code" href="structinput__slot__t.html#o6">deinit_sequence</a>.<a class="code" href="structstp__raw__t.html#o0">bytes</a>, 1, v);
00576       <span class="comment">/* Load settings from NVRAM */</span>
00577       <a class="code" href="group__util.html#ga17">stp_send_command</a>(v, <span class="stringliteral">"LD"</span>, <span class="stringliteral">"b"</span>);
00578 
00579       <span class="comment">/* Magic deinit sequence reported by Simone Falsini */</span>
00580       <span class="keywordflow">if</span> (pd-&gt;<a class="code" href="structescp2__privdata__t.html#o29">deinit_sequence</a>)
00581         <a class="code" href="group__util.html#ga10">stp_zfwrite</a>(pd-&gt;<a class="code" href="structescp2__privdata__t.html#o29">deinit_sequence</a>-&gt;<a class="code" href="structstp__raw__t.html#o1">data</a>, pd-&gt;<a class="code" href="structescp2__privdata__t.html#o29">deinit_sequence</a>-&gt;<a class="code" href="structstp__raw__t.html#o0">bytes</a>,
00582                     1, v);
00583       <span class="comment">/* Exit remote mode */</span>
00584       <a class="code" href="group__util.html#ga17">stp_send_command</a>(v, <span class="stringliteral">"\033"</span>, <span class="stringliteral">"ccc"</span>, 0, 0, 0);
00585     }
00586 }
00587 
00588 <span class="keywordtype">void</span>
<a name="l00589"></a><a class="code" href="print-escp2_8h.html#a153">00589</a> <a class="code" href="print-escp2_8h.html#a153">stpi_escp2_flush_pass</a>(<a class="code" href="structstp__vars.html">stp_vars_t</a> *v, <span class="keywordtype">int</span> passno, <span class="keywordtype">int</span> vertical_subpass)
00590 {
00591   <span class="keywordtype">int</span> j;
00592   <a class="code" href="structescp2__privdata__t.html">escp2_privdata_t</a> *pd = <a class="code" href="print-escp2_8c.html#a27">get_privdata</a>(v);
00593   <a class="code" href="structstp__lineoff__t.html">stp_lineoff_t</a> *lineoffs = <a class="code" href="print-weave_8c.html#a32">stp_get_lineoffsets_by_pass</a>(v, passno);
00594   <a class="code" href="structstp__lineactive__t.html">stp_lineactive_t</a> *lineactive = <a class="code" href="print-weave_8c.html#a33">stp_get_lineactive_by_pass</a>(v, passno);
00595   <span class="keyword">const</span> <a class="code" href="structstp__linebufs__t.html">stp_linebufs_t</a> *bufs = <a class="code" href="print-weave_8c.html#a35">stp_get_linebases_by_pass</a>(v, passno);
00596   <a class="code" href="structstp__pass__t.html">stp_pass_t</a> *pass = <a class="code" href="print-weave_8c.html#a36">stp_get_pass_by_pass</a>(v, passno);
00597   <a class="code" href="structstp__linecount__t.html">stp_linecount_t</a> *linecount = <a class="code" href="print-weave_8c.html#a34">stp_get_linecount_by_pass</a>(v, passno);
00598   <span class="keywordtype">int</span> minlines = pd-&gt;<a class="code" href="structescp2__privdata__t.html#o1">min_nozzles</a>;
00599 
00600   <span class="keywordflow">for</span> (j = 0; j &lt; pd-&gt;<a class="code" href="structescp2__privdata__t.html#o17">channels_in_use</a>; j++)
00601     {
00602       <span class="keywordflow">if</span> (lineactive[0].<a class="code" href="structstp__lineactive__t.html#o1">v</a>[j] &gt; 0)
00603         {
00604           <span class="keywordtype">int</span> nlines = linecount[0].<a class="code" href="structstp__linecount__t.html#o1">v</a>[j];
00605           <span class="keywordtype">int</span> extralines = 0;
00606           <span class="keywordflow">if</span> (nlines &lt; minlines)
00607             {
00608               extralines = minlines - nlines;
00609               nlines = minlines;
00610             }
00611           <a class="code" href="escp2-driver_8c.html#a17">set_vertical_position</a>(v, pass);
00612           <a class="code" href="escp2-driver_8c.html#a18">set_color</a>(v, pass, j);
00613           <a class="code" href="escp2-driver_8c.html#a19">set_horizontal_position</a>(v, pass, vertical_subpass);
00614           <a class="code" href="escp2-driver_8c.html#a20">send_print_command</a>(v, pass, j, nlines);
00615 
00616           <span class="comment">/*</span>
00617 <span class="comment">           * Send the data</span>
00618 <span class="comment">           */</span>
00619           <a class="code" href="group__util.html#ga10">stp_zfwrite</a>((<span class="keyword">const</span> <span class="keywordtype">char</span> *)bufs[0].v[j], lineoffs[0].v[j], 1, v);
00620           <span class="keywordflow">if</span> (extralines)
00621             <a class="code" href="escp2-driver_8c.html#a21">send_extra_data</a>(v, extralines);
00622           <a class="code" href="group__util.html#ga17">stp_send_command</a>(v, <span class="stringliteral">"\r"</span>, <span class="stringliteral">""</span>);
00623           pd-&gt;<a class="code" href="structescp2__privdata__t.html#o65">printed_something</a> = 1;
00624         }
00625       lineoffs[0].<a class="code" href="structstp__lineoff__t.html#o1">v</a>[j] = 0;
00626       linecount[0].<a class="code" href="structstp__linecount__t.html#o1">v</a>[j] = 0;
00627     }
00628 }
00629 
00630 <span class="keywordtype">void</span>
<a name="l00631"></a><a class="code" href="print-escp2_8h.html#a154">00631</a> <a class="code" href="print-escp2_8h.html#a154">stpi_escp2_terminate_page</a>(<a class="code" href="structstp__vars.html">stp_vars_t</a> *v)
00632 {
00633   <a class="code" href="structescp2__privdata__t.html">escp2_privdata_t</a> *pd = <a class="code" href="print-escp2_8c.html#a27">get_privdata</a>(v);
00634   <span class="keywordflow">if</span> (!pd-&gt;<a class="code" href="structescp2__privdata__t.html#o24">input_slot</a> ||
00635       pd-&gt;<a class="code" href="structescp2__privdata__t.html#o24">input_slot</a>-&gt;<a class="code" href="structinput__slot__t.html#o4">roll_feed_cut_flags</a> != <a class="code" href="print-escp2_8h.html#a16">ROLL_FEED_DONT_EJECT</a>)
00636     {
00637       <span class="keywordflow">if</span> (!pd-&gt;<a class="code" href="structescp2__privdata__t.html#o65">printed_something</a>)
00638         <a class="code" href="group__util.html#ga17">stp_send_command</a>(v, <span class="stringliteral">"\n"</span>, <span class="stringliteral">""</span>);
00639       <a class="code" href="group__util.html#ga17">stp_send_command</a>(v, <span class="stringliteral">"\f"</span>, <span class="stringliteral">""</span>);    <span class="comment">/* Eject page */</span>
00640     }
00641 }
</pre></div><hr size="1"><address style="align: right;"><small>Generated on Wed Aug 25 07:56:13 2004 for libgimpprint API Reference by
<a href="http://www.doxygen.org/index.html">
<img src="doxygen.png" alt="doxygen" align="middle" border=0 > </a>1.3.6 </small></address>
</body>
</html>
