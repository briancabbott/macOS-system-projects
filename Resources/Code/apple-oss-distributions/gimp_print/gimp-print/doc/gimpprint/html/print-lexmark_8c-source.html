<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html><head><meta http-equiv="Content-Type" content="text/html;charset=iso-8859-1">
<title>libgimpprint API Reference: src/main/print-lexmark.c Source File</title>
<link href="doxygen.css" rel="stylesheet" type="text/css">
</head><body>
<!-- Generated by Doxygen 1.3.6 -->
<div class="qindex"><a class="qindex" href="index.html">Main&nbsp;Page</a> | <a class="qindex" href="modules.html">Modules</a> | <a class="qindex" href="classes.html">Alphabetical&nbsp;List</a> | <a class="qindex" href="annotated.html">Data&nbsp;Structures</a> | <a class="qindex" href="files.html">File&nbsp;List</a> | <a class="qindex" href="functions.html">Data&nbsp;Fields</a> | <a class="qindex" href="globals.html">Globals</a> | <a class="qindex" href="pages.html">Related&nbsp;Pages</a></div>
<h1>src/main/print-lexmark.c</h1><a href="print-lexmark_8c.html">Go to the documentation of this file.</a><div class="fragment"><pre>00001 <span class="comment">/*</span>
00002 <span class="comment"> * "$Id: print-lexmark_8c-source.html,v 1.1.1.2 2004/12/22 23:49:08 jlovell Exp $"</span>
00003 <span class="comment"> *</span>
00004 <span class="comment"> *   Print plug-in Lexmark driver for the GIMP.</span>
00005 <span class="comment"> *</span>
00006 <span class="comment"> *   Copyright 2000 Richard Wisenoecker (richard.wisenoecker@gmx.at) and</span>
00007 <span class="comment"> *      Alwin Stolk (p.a.stolk@tmx.nl)</span>
00008 <span class="comment"> *</span>
00009 <span class="comment"> *   The plug-in is based on the code of the CANON BJL plugin for the GIMP</span>
00010 <span class="comment"> *   of Michael Sweet (mike@easysw.com) and Robert Krawitz (rlk@alum.mit.edu).</span>
00011 <span class="comment"> *</span>
00012 <span class="comment"> *</span>
00013 <span class="comment"> *   This program is free software; you can redistribute it and/or modify it</span>
00014 <span class="comment"> *   under the terms of the GNU General Public License as published by the Free</span>
00015 <span class="comment"> *   Software Foundation; either version 2 of the License, or (at your option)</span>
00016 <span class="comment"> *   any later version.</span>
00017 <span class="comment"> *</span>
00018 <span class="comment"> *   This program is distributed in the hope that it will be useful, but</span>
00019 <span class="comment"> *   WITHOUT ANY WARRANTY; without even the implied warranty of MERCHANTABILITY</span>
00020 <span class="comment"> *   or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU General Public License</span>
00021 <span class="comment"> *   for more details.</span>
00022 <span class="comment"> *</span>
00023 <span class="comment"> *   You should have received a copy of the GNU General Public License</span>
00024 <span class="comment"> *   along with this program; if not, write to the Free Software</span>
00025 <span class="comment"> *   Foundation, Inc., 59 Temple Place - Suite 330, Boston, MA 02111-1307, USA.</span>
00026 <span class="comment"> */</span>
00027 
00028 <span class="comment">/*</span>
00029 <span class="comment"> * This file must include only standard C header files.  The core code must</span>
00030 <span class="comment"> * compile on generic platforms that don't support glib, gimp, gtk, etc.</span>
00031 <span class="comment"> */</span>
00032 
00033 <span class="comment">/*</span>
00034 <span class="comment"> * !!! IMPORTANT !!!  Some short information: Border and page offsets</span>
00035 <span class="comment"> * are defined in 1/72 DPI. This mean, that the parameter defined at</span>
00036 <span class="comment"> * lexmark_cap_t which defines positions are in 1/72 DPI. At</span>
00037 <span class="comment"> * lexmark_print the unit will be changed dependent on the printer,</span>
00038 <span class="comment"> * according to the value defined at lexmark_cap_t.x_raster_res and</span>
00039 <span class="comment"> * lexmark_cap_t.y_raster_res. These two parameters are specifing the</span>
00040 <span class="comment"> * resolution used for positioning the printer head (it is not the</span>
00041 <span class="comment"> * resolution used for printing!).</span>
00042 <span class="comment"> */</span>
00043 
00044 <span class="comment">/* TODO-LIST</span>
00045 <span class="comment"> *</span>
00046 <span class="comment"> *   * implement the left border</span>
00047 <span class="comment"> *</span>
00048 <span class="comment"> */</span>
00049 
00050 <span class="comment">/*#define DEBUG 1*/</span>
<a name="l00051"></a><a class="code" href="print-lexmark_8c.html#a0">00051</a> <span class="preprocessor">#define USEEPSEWAVE 1</span>
00052 <span class="preprocessor"></span>
00053 <span class="preprocessor">#ifdef __GNUC__</span>
00054 <span class="preprocessor"></span><span class="preprocessor">#define inline __inline__</span>
00055 <span class="preprocessor"></span><span class="preprocessor">#endif</span>
00056 <span class="preprocessor"></span>
00057 <span class="preprocessor">#ifdef HAVE_CONFIG_H</span>
00058 <span class="preprocessor"></span><span class="preprocessor">#include &lt;config.h&gt;</span>
00059 <span class="preprocessor">#endif</span>
00060 <span class="preprocessor"></span><span class="preprocessor">#include &lt;<a class="code" href="gimp-print_8h.html">gimp-print/gimp-print.h</a>&gt;</span>
00061 <span class="preprocessor">#include &lt;<a class="code" href="gimp-print-intl-internal_8h.html">gimp-print/gimp-print-intl-internal.h</a>&gt;</span>
00062 <span class="preprocessor">#include "<a class="code" href="gimp-print-internal_8h.html">gimp-print-internal.h</a>"</span>
00063 <span class="preprocessor">#include &lt;string.h&gt;</span>
00064 <span class="preprocessor">#ifdef DEBUG</span>
00065 <span class="preprocessor"></span><span class="preprocessor">#include &lt;stdio.h&gt;</span>
00066 <span class="preprocessor">#endif</span>
00067 <span class="preprocessor"></span>
<a name="l00068"></a><a class="code" href="print-lexmark_8c.html#a1">00068</a> <span class="preprocessor">#define STP_ECOLOR_LC 4</span>
<a name="l00069"></a><a class="code" href="print-lexmark_8c.html#a2">00069</a> <span class="preprocessor"></span><span class="preprocessor">#define STP_ECOLOR_LM 5</span>
<a name="l00070"></a><a class="code" href="print-lexmark_8c.html#a3">00070</a> <span class="preprocessor"></span><span class="preprocessor">#define STP_ECOLOR_LY 6</span>
00071 <span class="preprocessor"></span>
<a name="l00072"></a><a class="code" href="print-lexmark_8c.html#a4">00072</a> <span class="preprocessor">#define false 0</span>
<a name="l00073"></a><a class="code" href="print-lexmark_8c.html#a5">00073</a> <span class="preprocessor"></span><span class="preprocessor">#define true  1</span>
00074 <span class="preprocessor"></span>
<a name="l00075"></a><a class="code" href="print-lexmark_8c.html#a6">00075</a> <span class="preprocessor">#define max(a, b) ((a &gt; b) ? (a) : (b))</span>
<a name="l00076"></a><a class="code" href="print-lexmark_8c.html#a7">00076</a> <span class="preprocessor"></span><span class="preprocessor">#define INCH(x)         (72 * x)</span>
00077 <span class="preprocessor"></span>
<a name="l00078"></a><a class="code" href="print-lexmark_8c.html#a79">00078</a> <span class="keyword">static</span> <span class="keyword">const</span> <a class="code" href="structstp__dotsize.html">stp_dotsize_t</a> <a class="code" href="print-lexmark_8c.html#a79">single_dotsize</a>[] =
00079 {
00080   { 0x1, 1.0 }
00081 };
00082 
<a name="l00083"></a><a class="code" href="print-lexmark_8c.html#a80">00083</a> <span class="keyword">static</span> <span class="keyword">const</span> <a class="code" href="structstp__shade.html">stp_shade_t</a> <a class="code" href="print-lexmark_8c.html#a80">photo_dither_shades</a>[] =
00084 {
00085   { 1.0000, 1, <a class="code" href="print-lexmark_8c.html#a79">single_dotsize</a> },
00086   { 0.3333, 1, <a class="code" href="print-lexmark_8c.html#a79">single_dotsize</a> },
00087 };
00088 
00089 
<a name="l00090"></a><a class="code" href="print-lexmark_8c.html#a152">00090</a> <span class="keyword">typedef</span> <span class="keyword">enum</span> <a class="code" href="print-lexmark_8c.html#a81">Lex_model</a> { <a class="code" href="print-lexmark_8c.html#a152a115">m_lex7500</a>,   <a class="code" href="print-lexmark_8c.html#a152a116">m_z52</a>=10052, <a class="code" href="print-lexmark_8c.html#a152a117">m_z42</a>=10042, <a class="code" href="print-lexmark_8c.html#a152a118">m_3200</a>=3200 } <a class="code" href="print-lexmark_8c.html#a81">Lex_model</a>;
00091 
<a name="l00092"></a><a class="code" href="print-lexmark_8c.html#a8">00092</a> <span class="preprocessor">#define NCHANNELS (7)</span>
00093 <span class="preprocessor"></span>
<a name="l00094"></a><a class="code" href="unionlexmark__lineoff__t.html">00094</a> <span class="keyword">typedef</span> <span class="keyword">union </span>{                 <span class="comment">/* Offsets from the start of each line */</span>
<a name="l00095"></a><a class="code" href="unionlexmark__lineoff__t.html#o0">00095</a>   <span class="keywordtype">unsigned</span> <span class="keywordtype">long</span> v[<a class="code" href="print-lexmark_8c.html#a8">NCHANNELS</a>];           <span class="comment">/* (really pass) */</span>
00096   <span class="keyword">struct </span>{     <span class="comment">/* IMPORTANT: order corresponds to STP_ECOLOR_* */</span>
<a name="l00097"></a><a class="code" href="unionlexmark__lineoff__t.html#o1">00097</a>     <span class="keywordtype">unsigned</span> <span class="keywordtype">long</span> k;
<a name="l00098"></a><a class="code" href="unionlexmark__lineoff__t.html#o2">00098</a>     <span class="keywordtype">unsigned</span> <span class="keywordtype">long</span> c;
<a name="l00099"></a><a class="code" href="unionlexmark__lineoff__t.html#o3">00099</a>     <span class="keywordtype">unsigned</span> <span class="keywordtype">long</span> m;
<a name="l00100"></a><a class="code" href="unionlexmark__lineoff__t.html#o4">00100</a>     <span class="keywordtype">unsigned</span> <span class="keywordtype">long</span> y;
<a name="l00101"></a><a class="code" href="unionlexmark__lineoff__t.html#o5">00101</a>     <span class="keywordtype">unsigned</span> <span class="keywordtype">long</span> C;
<a name="l00102"></a><a class="code" href="unionlexmark__lineoff__t.html#o6">00102</a>     <span class="keywordtype">unsigned</span> <span class="keywordtype">long</span> M;
<a name="l00103"></a><a class="code" href="unionlexmark__lineoff__t.html#o7">00103</a>     <span class="keywordtype">unsigned</span> <span class="keywordtype">long</span> Y;
00104   } p;
00105 } <a class="code" href="unionlexmark__lineoff__t.html">lexmark_lineoff_t</a>;
00106 
<a name="l00107"></a><a class="code" href="unionlexmark__linebufs__t.html">00107</a> <span class="keyword">typedef</span> <span class="keyword">union </span>{                 <span class="comment">/* Base pointers for each pass */</span>
<a name="l00108"></a><a class="code" href="unionlexmark__linebufs__t.html#o0">00108</a>   <span class="keywordtype">unsigned</span> <span class="keywordtype">char</span> *v[<a class="code" href="print-lexmark_8c.html#a8">NCHANNELS</a>];
00109   <span class="keyword">struct </span>{     <span class="comment">/* IMPORTANT: order corresponds to STP_ECOLOR_* */</span>
<a name="l00110"></a><a class="code" href="unionlexmark__linebufs__t.html#o1">00110</a>     <span class="keywordtype">unsigned</span> <span class="keywordtype">char</span> *k;
<a name="l00111"></a><a class="code" href="unionlexmark__linebufs__t.html#o2">00111</a>     <span class="keywordtype">unsigned</span> <span class="keywordtype">char</span> *c;
<a name="l00112"></a><a class="code" href="unionlexmark__linebufs__t.html#o3">00112</a>     <span class="keywordtype">unsigned</span> <span class="keywordtype">char</span> *m;
<a name="l00113"></a><a class="code" href="unionlexmark__linebufs__t.html#o4">00113</a>     <span class="keywordtype">unsigned</span> <span class="keywordtype">char</span> *y;
<a name="l00114"></a><a class="code" href="unionlexmark__linebufs__t.html#o5">00114</a>     <span class="keywordtype">unsigned</span> <span class="keywordtype">char</span> *C;
<a name="l00115"></a><a class="code" href="unionlexmark__linebufs__t.html#o6">00115</a>     <span class="keywordtype">unsigned</span> <span class="keywordtype">char</span> *M;
<a name="l00116"></a><a class="code" href="unionlexmark__linebufs__t.html#o7">00116</a>     <span class="keywordtype">unsigned</span> <span class="keywordtype">char</span> *Y;
00117   } p;
00118 } <a class="code" href="unionlexmark__linebufs__t.html">lexmark_linebufs_t</a>;
00119 
00120 
00121 
00122 <span class="preprocessor">#ifdef DEBUG</span>
00123 <span class="preprocessor"></span><span class="keyword">typedef</span> <span class="keyword">struct </span>testdata {
00124   FILE *ifile;
00125   <span class="keywordtype">int</span> x, y, cols, deep;
00126   <span class="keywordtype">char</span> colchar[16];
00127   <span class="keywordtype">char</span> *input_line;
00128 } <a class="code" href="classtestdata.html">testdata</a>;
00129 
00130 <span class="keyword">const</span> <a class="code" href="structstp__vars.html">stp_vars_t</a> **dbgfileprn;
00131 <span class="keywordtype">int</span>  lex_show_lcount, lex_show_length;
00132 
00133 <span class="keyword">const</span> <a class="code" href="structstp__vars.html">stp_vars_t</a> *lex_open_tmp_file();
00134 <span class="keyword">const</span> <a class="code" href="structstp__vars.html">stp_vars_t</a> *lex_write_tmp_file(<span class="keyword">const</span> <a class="code" href="structstp__vars.html">stp_vars_t</a> *ofile, <span class="keywordtype">void</span> *data,<span class="keywordtype">int</span> length);
00135 <span class="keyword">static</span> <span class="keywordtype">void</span> testprint(<a class="code" href="classtestdata.html">testdata</a> *td);
00136 <span class="keyword">static</span> <span class="keywordtype">void</span> readtestprintline(<a class="code" href="classtestdata.html">testdata</a> *td, <a class="code" href="unionlexmark__linebufs__t.html">lexmark_linebufs_t</a> *linebufs);
00137 <span class="preprocessor">#endif</span>
00138 <span class="preprocessor"></span>
00139 <span class="keyword">static</span> <span class="keywordtype">void</span>
00140 <a class="code" href="print-lexmark_8c.html#a119">flush_pass</a>(<a class="code" href="structstp__vars.html">stp_vars_t</a> *v, <span class="keywordtype">int</span> passno, <span class="keywordtype">int</span> vertical_subpass);
00141 
00142 <span class="comment">/*** resolution specific parameters */</span>
<a name="l00143"></a><a class="code" href="print-lexmark_8c.html#a9">00143</a> <span class="preprocessor">#define DPI300   0</span>
<a name="l00144"></a><a class="code" href="print-lexmark_8c.html#a10">00144</a> <span class="preprocessor"></span><span class="preprocessor">#define DPI600   1</span>
<a name="l00145"></a><a class="code" href="print-lexmark_8c.html#a11">00145</a> <span class="preprocessor"></span><span class="preprocessor">#define DPI1200  2</span>
<a name="l00146"></a><a class="code" href="print-lexmark_8c.html#a12">00146</a> <span class="preprocessor"></span><span class="preprocessor">#define DPI2400  3</span>
<a name="l00147"></a><a class="code" href="print-lexmark_8c.html#a13">00147</a> <span class="preprocessor"></span><span class="preprocessor">#define DPItest  4</span>
00148 <span class="preprocessor"></span>
<a name="l00149"></a><a class="code" href="print-lexmark_8c.html#a14">00149</a> <span class="preprocessor">#define V_NOZZLE_MASK 0x3</span>
<a name="l00150"></a><a class="code" href="print-lexmark_8c.html#a15">00150</a> <span class="preprocessor"></span><span class="preprocessor">#define H_NOZZLE_MASK 0xc</span>
<a name="l00151"></a><a class="code" href="print-lexmark_8c.html#a16">00151</a> <span class="preprocessor"></span><span class="preprocessor">#define NOZZLE_MASK   0xf</span>
00152 <span class="preprocessor"></span>
<a name="l00153"></a><a class="code" href="print-lexmark_8c.html#a17">00153</a> <span class="preprocessor">#define PRINT_MODE_300   0x100</span>
<a name="l00154"></a><a class="code" href="print-lexmark_8c.html#a18">00154</a> <span class="preprocessor"></span><span class="preprocessor">#define PRINT_MODE_600   0x200</span>
<a name="l00155"></a><a class="code" href="print-lexmark_8c.html#a19">00155</a> <span class="preprocessor"></span><span class="preprocessor">#define PRINT_MODE_1200  0x300</span>
<a name="l00156"></a><a class="code" href="print-lexmark_8c.html#a20">00156</a> <span class="preprocessor"></span><span class="preprocessor">#define PRINT_MODE_2400  0x400</span>
00157 <span class="preprocessor"></span>
<a name="l00158"></a><a class="code" href="print-lexmark_8c.html#a21">00158</a> <span class="preprocessor">#define COLOR_MODE_K      0x1000</span>
<a name="l00159"></a><a class="code" href="print-lexmark_8c.html#a22">00159</a> <span class="preprocessor"></span><span class="preprocessor">#define COLOR_MODE_C      0x2000</span>
<a name="l00160"></a><a class="code" href="print-lexmark_8c.html#a23">00160</a> <span class="preprocessor"></span><span class="preprocessor">#define COLOR_MODE_Y      0x4000</span>
<a name="l00161"></a><a class="code" href="print-lexmark_8c.html#a24">00161</a> <span class="preprocessor"></span><span class="preprocessor">#define COLOR_MODE_M      0x8000</span>
<a name="l00162"></a><a class="code" href="print-lexmark_8c.html#a25">00162</a> <span class="preprocessor"></span><span class="preprocessor">#define COLOR_MODE_LC    0x10000</span>
<a name="l00163"></a><a class="code" href="print-lexmark_8c.html#a26">00163</a> <span class="preprocessor"></span><span class="preprocessor">#define COLOR_MODE_LY    0x20000</span>
<a name="l00164"></a><a class="code" href="print-lexmark_8c.html#a27">00164</a> <span class="preprocessor"></span><span class="preprocessor">#define COLOR_MODE_LM    0x40000</span>
<a name="l00165"></a><a class="code" href="print-lexmark_8c.html#a28">00165</a> <span class="preprocessor"></span><span class="preprocessor">#define COLOR_MODE_CMYK   (COLOR_MODE_C | COLOR_MODE_M | COLOR_MODE_Y | COLOR_MODE_K)</span>
<a name="l00166"></a><a class="code" href="print-lexmark_8c.html#a29">00166</a> <span class="preprocessor"></span><span class="preprocessor">#define COLOR_MODE_CMY    (COLOR_MODE_C | COLOR_MODE_M | COLOR_MODE_Y)</span>
<a name="l00167"></a><a class="code" href="print-lexmark_8c.html#a30">00167</a> <span class="preprocessor"></span><span class="preprocessor">#define COLOR_MODE_CcMcYK (COLOR_MODE_C | COLOR_MODE_LC | COLOR_MODE_M | COLOR_MODE_LM | COLOR_MODE_Y | COLOR_MODE_K)</span>
<a name="l00168"></a><a class="code" href="print-lexmark_8c.html#a31">00168</a> <span class="preprocessor"></span><span class="preprocessor">#define COLOR_MODE_CcMcY  (COLOR_MODE_C | COLOR_MODE_LC | COLOR_MODE_M | COLOR_MODE_LM | COLOR_MODE_Y)</span>
00169 <span class="preprocessor"></span>
<a name="l00170"></a><a class="code" href="print-lexmark_8c.html#a32">00170</a> <span class="preprocessor">#define COLOR_MODE_MASK  0x7f000</span>
<a name="l00171"></a><a class="code" href="print-lexmark_8c.html#a33">00171</a> <span class="preprocessor"></span><span class="preprocessor">#define PRINT_MODE_MASK    0xf00</span>
<a name="l00172"></a><a class="code" href="print-lexmark_8c.html#a34">00172</a> <span class="preprocessor"></span><span class="preprocessor">#define COLOR_MODE_PHOTO (COLOR_MODE_LC | COLOR_MODE_LM)</span>
00173 <span class="preprocessor"></span>
<a name="l00174"></a><a class="code" href="print-lexmark_8c.html#a35">00174</a> <span class="preprocessor">#define BWR      0</span>
<a name="l00175"></a><a class="code" href="print-lexmark_8c.html#a36">00175</a> <span class="preprocessor"></span><span class="preprocessor">#define BWL      1</span>
<a name="l00176"></a><a class="code" href="print-lexmark_8c.html#a37">00176</a> <span class="preprocessor"></span><span class="preprocessor">#define CR       2</span>
<a name="l00177"></a><a class="code" href="print-lexmark_8c.html#a38">00177</a> <span class="preprocessor"></span><span class="preprocessor">#define CL       3</span>
00178 <span class="preprocessor"></span>
00179 
<a name="l00180"></a><a class="code" href="print-lexmark_8c.html#a82">00180</a> <span class="keyword">static</span> <span class="keyword">const</span> <span class="keywordtype">char</span> <a class="code" href="print-lexmark_8c.html#a82">standard_sat_adjustment</a>[] =
00181 <span class="stringliteral">"&lt;?xml version=\"1.0\" encoding=\"UTF-8\"?&gt;\n"</span>
00182 <span class="stringliteral">"&lt;gimp-print&gt;\n"</span>
00183 <span class="stringliteral">"&lt;curve wrap=\"wrap\" type=\"linear\" gamma=\"0\"&gt;\n"</span>
00184 <span class="stringliteral">"&lt;sequence count=\"48\" lower-bound=\"0\" upper-bound=\"4\"&gt;\n"</span>
00185 <span class="comment">/* C */</span>  <span class="stringliteral">"1.00 1.00 1.00 1.00 1.00 1.00 1.00 1.00 "</span>  <span class="comment">/* B */</span>
00186 <span class="comment">/* B */</span>  <span class="stringliteral">"1.00 1.00 1.00 1.00 1.00 1.00 1.00 1.00 "</span>  <span class="comment">/* M */</span>
00187 <span class="comment">/* M */</span>  <span class="stringliteral">"1.00 0.95 0.90 0.90 0.90 0.90 0.90 0.90 "</span>  <span class="comment">/* R */</span>
00188 <span class="comment">/* R */</span>  <span class="stringliteral">"0.90 0.95 0.95 1.00 1.00 1.00 1.00 1.00 "</span>  <span class="comment">/* Y */</span>
00189 <span class="comment">/* Y */</span>  <span class="stringliteral">"1.00 1.00 1.00 1.00 1.00 1.00 1.00 1.00 "</span>  <span class="comment">/* G */</span>
00190 <span class="comment">/* G */</span>  <span class="stringliteral">"1.00 1.00 1.00 1.00 1.00 1.00 1.00 1.00 "</span>  <span class="comment">/* C */</span>
00191 <span class="stringliteral">"&lt;/sequence&gt;\n"</span>
00192 <span class="stringliteral">"&lt;/curve&gt;\n"</span>
00193 <span class="stringliteral">"&lt;/gimp-print&gt;\n"</span>;
00194 
<a name="l00195"></a><a class="code" href="print-lexmark_8c.html#a83">00195</a> <span class="keyword">static</span> <span class="keyword">const</span> <span class="keywordtype">char</span> <a class="code" href="print-lexmark_8c.html#a83">standard_lum_adjustment</a>[] =
00196 <span class="stringliteral">"&lt;?xml version=\"1.0\" encoding=\"UTF-8\"?&gt;\n"</span>
00197 <span class="stringliteral">"&lt;gimp-print&gt;\n"</span>
00198 <span class="stringliteral">"&lt;curve wrap=\"wrap\" type=\"linear\" gamma=\"0\"&gt;\n"</span>
00199 <span class="stringliteral">"&lt;sequence count=\"48\" lower-bound=\"0\" upper-bound=\"4\"&gt;\n"</span>
00200 <span class="comment">/* C */</span>  <span class="stringliteral">"0.50 0.52 0.56 0.60 0.66 0.71 0.74 0.77 "</span>  <span class="comment">/* B */</span>
00201 <span class="comment">/* B */</span>  <span class="stringliteral">"0.81 0.79 0.74 0.68 0.70 0.74 0.77 0.82 "</span>  <span class="comment">/* M */</span>
00202 <span class="comment">/* M */</span>  <span class="stringliteral">"0.88 0.93 0.95 0.97 0.97 0.96 0.95 0.95 "</span>  <span class="comment">/* R */</span>
00203 <span class="comment">/* R */</span>  <span class="stringliteral">"0.95 0.96 0.97 0.98 0.99 1.00 1.00 1.00 "</span>  <span class="comment">/* Y */</span>
00204 <span class="comment">/* Y */</span>  <span class="stringliteral">"1.00 0.97 0.94 0.92 0.90 0.88 0.85 0.79 "</span>  <span class="comment">/* G */</span>
00205 <span class="comment">/* G */</span>  <span class="stringliteral">"0.69 0.64 0.58 0.54 0.54 0.54 0.53 0.51 "</span>  <span class="comment">/* C */</span>
00206 <span class="stringliteral">"&lt;/sequence&gt;\n"</span>
00207 <span class="stringliteral">"&lt;/curve&gt;\n"</span>
00208 <span class="stringliteral">"&lt;/gimp-print&gt;\n"</span>;
00209 
<a name="l00210"></a><a class="code" href="print-lexmark_8c.html#a84">00210</a> <span class="keyword">static</span> <span class="keyword">const</span> <span class="keywordtype">char</span> <a class="code" href="print-lexmark_8c.html#a84">standard_hue_adjustment</a>[] =
00211 <span class="stringliteral">"&lt;?xml version=\"1.0\" encoding=\"UTF-8\"?&gt;\n"</span>
00212 <span class="stringliteral">"&lt;gimp-print&gt;\n"</span>
00213 <span class="stringliteral">"&lt;curve wrap=\"wrap\" type=\"linear\" gamma=\"0\"&gt;\n"</span>
00214 <span class="stringliteral">"&lt;sequence count=\"48\" lower-bound=\"-6\" upper-bound=\"6\"&gt;\n"</span>
00215 <span class="comment">/* C */</span>  <span class="stringliteral">"0.00 0.06 0.10 0.10 0.06 -.01 -.09 -.17 "</span>  <span class="comment">/* B */</span>
00216 <span class="comment">/* B */</span>  <span class="stringliteral">"-.25 -.33 -.38 -.38 -.36 -.34 -.34 -.34 "</span>  <span class="comment">/* M */</span>
00217 <span class="comment">/* M */</span>  <span class="stringliteral">"-.34 -.34 -.36 -.40 -.50 -.40 -.30 -.20 "</span>  <span class="comment">/* R */</span>
00218 <span class="comment">/* R */</span>  <span class="stringliteral">"-.12 -.07 -.04 -.02 0.00 0.00 0.00 0.00 "</span>  <span class="comment">/* Y */</span>
00219 <span class="comment">/* Y */</span>  <span class="stringliteral">"0.00 0.00 0.00 -.05 -.10 -.15 -.22 -.24 "</span>  <span class="comment">/* G */</span>
00220 <span class="comment">/* G */</span>  <span class="stringliteral">"-.26 -.30 -.33 -.28 -.25 -.20 -.13 -.06 "</span>  <span class="comment">/* C */</span>
00221 <span class="stringliteral">"&lt;/sequence&gt;\n"</span>
00222 <span class="stringliteral">"&lt;/curve&gt;\n"</span>
00223 <span class="stringliteral">"&lt;/gimp-print&gt;\n"</span>;
00224 
00225 
00226 <span class="comment">/* Codes for possible ink-tank combinations.</span>
00227 <span class="comment"> * Each combo is represented by the colors that can be used with</span>
00228 <span class="comment"> * the installed ink-tank(s)</span>
00229 <span class="comment"> * Combinations of the codes represent the combinations allowed for a model</span>
00230 <span class="comment"> */</span>
<a name="l00231"></a><a class="code" href="print-lexmark_8c.html#a39">00231</a> <span class="preprocessor">#define LEXMARK_INK_K           1</span>
<a name="l00232"></a><a class="code" href="print-lexmark_8c.html#a40">00232</a> <span class="preprocessor"></span><span class="preprocessor">#define LEXMARK_INK_CMY         2</span>
<a name="l00233"></a><a class="code" href="print-lexmark_8c.html#a41">00233</a> <span class="preprocessor"></span><span class="preprocessor">#define LEXMARK_INK_CMYK        4</span>
<a name="l00234"></a><a class="code" href="print-lexmark_8c.html#a42">00234</a> <span class="preprocessor"></span><span class="preprocessor">#define LEXMARK_INK_CcMmYK      8</span>
<a name="l00235"></a><a class="code" href="print-lexmark_8c.html#a43">00235</a> <span class="preprocessor"></span><span class="preprocessor">#define LEXMARK_INK_CcMmYy     16</span>
<a name="l00236"></a><a class="code" href="print-lexmark_8c.html#a44">00236</a> <span class="preprocessor"></span><span class="preprocessor">#define LEXMARK_INK_CcMmYyK    32</span>
00237 <span class="preprocessor"></span>
<a name="l00238"></a><a class="code" href="print-lexmark_8c.html#a45">00238</a> <span class="preprocessor">#define LEXMARK_INK_BLACK_MASK (LEXMARK_INK_K|LEXMARK_INK_CMYK|\</span>
00239 <span class="preprocessor">                              LEXMARK_INK_CcMmYK|LEXMARK_INK_CcMmYyK)</span>
00240 <span class="preprocessor"></span>
<a name="l00241"></a><a class="code" href="print-lexmark_8c.html#a46">00241</a> <span class="preprocessor">#define LEXMARK_INK_PHOTO_MASK (LEXMARK_INK_CcMmYy|LEXMARK_INK_CcMmYK|\</span>
00242 <span class="preprocessor">                              LEXMARK_INK_CcMmYyK)</span>
00243 <span class="preprocessor"></span>
00244 <span class="comment">/* document feeding */</span>
<a name="l00245"></a><a class="code" href="print-lexmark_8c.html#a47">00245</a> <span class="preprocessor">#define LEXMARK_SLOT_ASF1    1</span>
<a name="l00246"></a><a class="code" href="print-lexmark_8c.html#a48">00246</a> <span class="preprocessor"></span><span class="preprocessor">#define LEXMARK_SLOT_ASF2    2</span>
<a name="l00247"></a><a class="code" href="print-lexmark_8c.html#a49">00247</a> <span class="preprocessor"></span><span class="preprocessor">#define LEXMARK_SLOT_MAN1    4</span>
<a name="l00248"></a><a class="code" href="print-lexmark_8c.html#a50">00248</a> <span class="preprocessor"></span><span class="preprocessor">#define LEXMARK_SLOT_MAN2    8</span>
00249 <span class="preprocessor"></span>
00250 <span class="comment">/* model peculiarities */</span>
<a name="l00251"></a><a class="code" href="print-lexmark_8c.html#a51">00251</a> <span class="preprocessor">#define LEXMARK_CAP_DMT       1&lt;&lt;0    </span><span class="comment">/* Drop Modulation Technology */</span>
00252 <span class="preprocessor">#define LEXMARK_CAP_MSB_FIRST 1&lt;&lt;1    </span><span class="comment">/* how to send data           */</span>
<a name="l00253"></a><a class="code" href="print-lexmark_8c.html#a52">00253</a> <span class="preprocessor">#define LEXMARK_CAP_CMD61     1&lt;&lt;2    </span><span class="comment">/* uses command #0x61         */</span>
00254 <span class="preprocessor">#define LEXMARK_CAP_CMD6d     1&lt;&lt;3    </span><span class="comment">/* uses command #0x6d         */</span>
<a name="l00255"></a><a class="code" href="print-lexmark_8c.html#a53">00255</a> <span class="preprocessor">#define LEXMARK_CAP_CMD70     1&lt;&lt;4    </span><span class="comment">/* uses command #0x70         */</span>
00256 <span class="preprocessor">#define LEXMARK_CAP_CMD72     1&lt;&lt;5    </span><span class="comment">/* uses command #0x72         */</span>
<a name="l00257"></a><a class="code" href="print-lexmark_8c.html#a54">00257</a> 
00258 
<a name="l00259"></a><a class="code" href="print-lexmark_8c.html#a55">00259</a> <span class="keyword">static</span> <span class="keyword">const</span> <span class="keywordtype">int</span> <a class="code" href="print-lexmark_8c.html#a85">lr_shift_color</a>[10] = { 9, 18, 2*18 }; <span class="comment">/* vertical distance between ever 2nd  inkjet (related to resolution) */</span>
00260 <span class="keyword">static</span> <span class="keyword">const</span> <span class="keywordtype">int</span> <a class="code" href="print-lexmark_8c.html#a86">lr_shift_black</a>[10] = { 9, 18, 2*18 }; <span class="comment">/* vertical distance between ever 2nd  inkjet (related to resolution) */</span>
<a name="l00261"></a><a class="code" href="print-lexmark_8c.html#a56">00261</a> 
00262 <span class="keyword">static</span> <span class="keyword">const</span> <a class="code" href="structstp__parameter__t.html">stp_parameter_t</a> <a class="code" href="print-lexmark_8c.html#a87">the_parameters</a>[] =
00263 {
00264   {
<a name="l00265"></a><a class="code" href="print-lexmark_8c.html#a85">00265</a>     <span class="stringliteral">"PageSize"</span>, <a class="code" href="group__intl__internal.html#ga6">N_</a>(<span class="stringliteral">"Page Size"</span>), <a class="code" href="group__intl__internal.html#ga6">N_</a>(<span class="stringliteral">"Basic Printer Setup"</span>),
<a name="l00266"></a><a class="code" href="print-lexmark_8c.html#a86">00266</a>     <a class="code" href="group__intl__internal.html#ga6">N_</a>(<span class="stringliteral">"Size of the paper being printed to"</span>),
00267     <a class="code" href="group__vars.html#gga132a7">STP_PARAMETER_TYPE_STRING_LIST</a>, <a class="code" href="group__vars.html#gga133a19">STP_PARAMETER_CLASS_CORE</a>,
<a name="l00268"></a><a class="code" href="print-lexmark_8c.html#a87">00268</a>     <a class="code" href="group__vars.html#gga134a21">STP_PARAMETER_LEVEL_BASIC</a>, 1, 1, -1, 1, 0
00269   },
00270   {
00271     <span class="stringliteral">"MediaType"</span>, <a class="code" href="group__intl__internal.html#ga6">N_</a>(<span class="stringliteral">"Media Type"</span>), <a class="code" href="group__intl__internal.html#ga6">N_</a>(<span class="stringliteral">"Basic Printer Setup"</span>),
00272     <a class="code" href="group__intl__internal.html#ga6">N_</a>(<span class="stringliteral">"Type of media (plain paper, photo paper, etc.)"</span>),
00273     <a class="code" href="group__vars.html#gga132a7">STP_PARAMETER_TYPE_STRING_LIST</a>, <a class="code" href="group__vars.html#gga133a17">STP_PARAMETER_CLASS_FEATURE</a>,
00274     <a class="code" href="group__vars.html#gga134a21">STP_PARAMETER_LEVEL_BASIC</a>, 1, 1, -1, 1, 0
00275   },
00276   {
00277     <span class="stringliteral">"InputSlot"</span>, <a class="code" href="group__intl__internal.html#ga6">N_</a>(<span class="stringliteral">"Media Source"</span>), <a class="code" href="group__intl__internal.html#ga6">N_</a>(<span class="stringliteral">"Basic Printer Setup"</span>),
00278     <a class="code" href="group__intl__internal.html#ga6">N_</a>(<span class="stringliteral">"Source (input slot) of the media"</span>),
00279     <a class="code" href="group__vars.html#gga132a7">STP_PARAMETER_TYPE_STRING_LIST</a>, <a class="code" href="group__vars.html#gga133a17">STP_PARAMETER_CLASS_FEATURE</a>,
00280     <a class="code" href="group__vars.html#gga134a21">STP_PARAMETER_LEVEL_BASIC</a>, 1, 1, -1, 1, 0
00281   },
00282   {
00283     <span class="stringliteral">"Resolution"</span>, <a class="code" href="group__intl__internal.html#ga6">N_</a>(<span class="stringliteral">"Resolution"</span>), <a class="code" href="group__intl__internal.html#ga6">N_</a>(<span class="stringliteral">"Basic Printer Setup"</span>),
00284     <a class="code" href="group__intl__internal.html#ga6">N_</a>(<span class="stringliteral">"Resolution and quality of the print"</span>),
00285     <a class="code" href="group__vars.html#gga132a7">STP_PARAMETER_TYPE_STRING_LIST</a>, <a class="code" href="group__vars.html#gga133a17">STP_PARAMETER_CLASS_FEATURE</a>,
00286     <a class="code" href="group__vars.html#gga134a21">STP_PARAMETER_LEVEL_BASIC</a>, 1, 1, -1, 1, 0
00287   },
00288   {
00289     <span class="stringliteral">"InkType"</span>, <a class="code" href="group__intl__internal.html#ga6">N_</a>(<span class="stringliteral">"Ink Type"</span>), <a class="code" href="group__intl__internal.html#ga6">N_</a>(<span class="stringliteral">"Advanced Printer Setup"</span>),
00290     <a class="code" href="group__intl__internal.html#ga6">N_</a>(<span class="stringliteral">"Type of ink in the printer"</span>),
00291     <a class="code" href="group__vars.html#gga132a7">STP_PARAMETER_TYPE_STRING_LIST</a>, <a class="code" href="group__vars.html#gga133a17">STP_PARAMETER_CLASS_FEATURE</a>,
00292     <a class="code" href="group__vars.html#gga134a21">STP_PARAMETER_LEVEL_BASIC</a>, 1, 1, -1, 1, 0
00293   },
00294   {
00295     <span class="stringliteral">"InkChannels"</span>, <a class="code" href="group__intl__internal.html#ga6">N_</a>(<span class="stringliteral">"Ink Channels"</span>), <a class="code" href="group__intl__internal.html#ga6">N_</a>(<span class="stringliteral">"Advanced Printer Functionality"</span>),
00296     <a class="code" href="group__intl__internal.html#ga6">N_</a>(<span class="stringliteral">"Ink Channels"</span>),
00297     <a class="code" href="group__vars.html#gga132a8">STP_PARAMETER_TYPE_INT</a>, <a class="code" href="group__vars.html#gga133a17">STP_PARAMETER_CLASS_FEATURE</a>,
00298     <a class="code" href="group__vars.html#gga134a27">STP_PARAMETER_LEVEL_INTERNAL</a>, 0, 0, -1, 0, 0
00299   },
00300   {
00301     <span class="stringliteral">"PrintingMode"</span>, <a class="code" href="group__intl__internal.html#ga6">N_</a>(<span class="stringliteral">"Printing Mode"</span>), <a class="code" href="group__intl__internal.html#ga6">N_</a>(<span class="stringliteral">"Core Parameter"</span>),
00302     <a class="code" href="group__intl__internal.html#ga6">N_</a>(<span class="stringliteral">"Printing Output Mode"</span>),
00303     <a class="code" href="group__vars.html#gga132a7">STP_PARAMETER_TYPE_STRING_LIST</a>, <a class="code" href="group__vars.html#gga133a19">STP_PARAMETER_CLASS_CORE</a>,
00304     <a class="code" href="group__vars.html#gga134a21">STP_PARAMETER_LEVEL_BASIC</a>, 1, 1, -1, 1, 0
00305   },
00306 };
00307 
00308 <span class="keyword">static</span> <span class="keyword">const</span> <span class="keywordtype">int</span> <a class="code" href="print-lexmark_8c.html#a88">the_parameter_count</a> =
00309 <span class="keyword">sizeof</span>(<a class="code" href="print-lexmark_8c.html#a87">the_parameters</a>) / <span class="keyword">sizeof</span>(<span class="keyword">const</span> <a class="code" href="structstp__parameter__t.html">stp_parameter_t</a>);
00310 
00311 <span class="keyword">typedef</span> <span class="keyword">struct</span>
00312 <span class="keyword"></span>{
00313   <span class="keyword">const</span> <a class="code" href="structstp__parameter__t.html">stp_parameter_t</a> param;
<a name="l00314"></a><a class="code" href="print-lexmark_8c.html#a88">00314</a>   <span class="keywordtype">double</span> min;
00315   <span class="keywordtype">double</span> <a class="code" href="print-lexmark_8c.html#a6">max</a>;
00316   <span class="keywordtype">double</span> defval;
00317   <span class="keywordtype">int</span> color_only;
00318 } <a class="code" href="structfloat__param__t.html">float_param_t</a>;
00319 
00320 <span class="keyword">static</span> <span class="keyword">const</span> <a class="code" href="structfloat__param__t.html">float_param_t</a> <a class="code" href="print-lexmark_8c.html#a89">float_parameters</a>[] =
00321 {
00322   {
00323     {
00324       <span class="stringliteral">"CyanDensity"</span>, <a class="code" href="group__intl__internal.html#ga6">N_</a>(<span class="stringliteral">"Cyan Balance"</span>), <a class="code" href="group__intl__internal.html#ga6">N_</a>(<span class="stringliteral">"Output Level Adjustment"</span>),
00325       <a class="code" href="group__intl__internal.html#ga6">N_</a>(<span class="stringliteral">"Adjust the cyan balance"</span>),
<a name="l00326"></a><a class="code" href="print-lexmark_8c.html#a89">00326</a>       <a class="code" href="group__vars.html#gga132a10">STP_PARAMETER_TYPE_DOUBLE</a>, <a class="code" href="group__vars.html#gga133a18">STP_PARAMETER_CLASS_OUTPUT</a>,
00327       <a class="code" href="group__vars.html#gga134a22">STP_PARAMETER_LEVEL_ADVANCED</a>, 0, 1, 1, 1, 0
00328     }, 0.0, 2.0, 1.0, 1
00329   },
00330   {
00331     {
00332       <span class="stringliteral">"MagentaDensity"</span>, <a class="code" href="group__intl__internal.html#ga6">N_</a>(<span class="stringliteral">"Magenta Balance"</span>), <a class="code" href="group__intl__internal.html#ga6">N_</a>(<span class="stringliteral">"Output Level Adjustment"</span>),
00333       <a class="code" href="group__intl__internal.html#ga6">N_</a>(<span class="stringliteral">"Adjust the magenta balance"</span>),
00334       <a class="code" href="group__vars.html#gga132a10">STP_PARAMETER_TYPE_DOUBLE</a>, <a class="code" href="group__vars.html#gga133a18">STP_PARAMETER_CLASS_OUTPUT</a>,
00335       <a class="code" href="group__vars.html#gga134a22">STP_PARAMETER_LEVEL_ADVANCED</a>, 0, 1, 2, 1, 0
00336     }, 0.0, 2.0, 1.0, 1
00337   },
00338   {
00339     {
00340       <span class="stringliteral">"YellowDensity"</span>, <a class="code" href="group__intl__internal.html#ga6">N_</a>(<span class="stringliteral">"Yellow Balance"</span>), <a class="code" href="group__intl__internal.html#ga6">N_</a>(<span class="stringliteral">"Output Level Adjustment"</span>),
00341       <a class="code" href="group__intl__internal.html#ga6">N_</a>(<span class="stringliteral">"Adjust the yellow balance"</span>),
00342       <a class="code" href="group__vars.html#gga132a10">STP_PARAMETER_TYPE_DOUBLE</a>, <a class="code" href="group__vars.html#gga133a18">STP_PARAMETER_CLASS_OUTPUT</a>,
00343       <a class="code" href="group__vars.html#gga134a22">STP_PARAMETER_LEVEL_ADVANCED</a>, 0, 1, 3, 1, 0
00344     }, 0.0, 2.0, 1.0, 1
00345   },
00346   {
00347     {
00348       <span class="stringliteral">"BlackDensity"</span>, <a class="code" href="group__intl__internal.html#ga6">N_</a>(<span class="stringliteral">"Black Balance"</span>), <a class="code" href="group__intl__internal.html#ga6">N_</a>(<span class="stringliteral">"Output Level Adjustment"</span>),
00349       <a class="code" href="group__intl__internal.html#ga6">N_</a>(<span class="stringliteral">"Adjust the black balance"</span>),
00350       <a class="code" href="group__vars.html#gga132a10">STP_PARAMETER_TYPE_DOUBLE</a>, <a class="code" href="group__vars.html#gga133a18">STP_PARAMETER_CLASS_OUTPUT</a>,
00351       <a class="code" href="group__vars.html#gga134a22">STP_PARAMETER_LEVEL_ADVANCED</a>, 0, 1, 0, 1, 0
00352     }, 0.0, 2.0, 1.0, 1
00353   },
00354   {
00355     {
00356       <span class="stringliteral">"LightCyanTransition"</span>, <a class="code" href="group__intl__internal.html#ga6">N_</a>(<span class="stringliteral">"Light Cyan Transition"</span>), <a class="code" href="group__intl__internal.html#ga6">N_</a>(<span class="stringliteral">"Advanced Ink Adjustment"</span>),
00357       <a class="code" href="group__intl__internal.html#ga6">N_</a>(<span class="stringliteral">"Light Cyan Transition"</span>),
00358       <a class="code" href="group__vars.html#gga132a10">STP_PARAMETER_TYPE_DOUBLE</a>, <a class="code" href="group__vars.html#gga133a18">STP_PARAMETER_CLASS_OUTPUT</a>,
00359       <a class="code" href="group__vars.html#gga134a26">STP_PARAMETER_LEVEL_ADVANCED4</a>, 0, 1, -1, 1, 0
00360     }, 0.0, 5.0, 1.0, 1
00361   },
00362   {
00363     {
00364       <span class="stringliteral">"LightMagentaTransition"</span>, <a class="code" href="group__intl__internal.html#ga6">N_</a>(<span class="stringliteral">"Light Magenta Transition"</span>), <a class="code" href="group__intl__internal.html#ga6">N_</a>(<span class="stringliteral">"Advanced Ink Adjustment"</span>),
00365       <a class="code" href="group__intl__internal.html#ga6">N_</a>(<span class="stringliteral">"Light Magenta Transition"</span>),
00366       <a class="code" href="group__vars.html#gga132a10">STP_PARAMETER_TYPE_DOUBLE</a>, <a class="code" href="group__vars.html#gga133a18">STP_PARAMETER_CLASS_OUTPUT</a>,
00367       <a class="code" href="group__vars.html#gga134a26">STP_PARAMETER_LEVEL_ADVANCED4</a>, 0, 1, -1, 1, 0
00368     }, 0.0, 5.0, 1.0, 1
00369   },
00370 };    
00371 
00372 <span class="keyword">static</span> <span class="keyword">const</span> <span class="keywordtype">int</span> <a class="code" href="print-lexmark_8c.html#a90">float_parameter_count</a> =
00373 <span class="keyword">sizeof</span>(<a class="code" href="print-lexmark_8c.html#a89">float_parameters</a>) / <span class="keyword">sizeof</span>(<span class="keyword">const</span> <a class="code" href="structfloat__param__t.html">float_param_t</a>);
00374 
00375 <span class="comment">/* returns the offset of the first jet when printing in the other direction */</span>
00376 <span class="keyword">static</span> <span class="keywordtype">int</span> <a class="code" href="print-lexmark_8c.html#a120">get_lr_shift</a>(<span class="keywordtype">int</span> mode)
00377 {
<a name="l00378"></a><a class="code" href="print-lexmark_8c.html#a90">00378</a> 
00379   <span class="keyword">const</span> <span class="keywordtype">int</span> *ptr_lr_shift;
00380 
00381       <span class="comment">/* K could only be present if black is printed only. */</span>
<a name="l00382"></a><a class="code" href="print-lexmark_8c.html#a120">00382</a>   <span class="keywordflow">if</span>((mode &amp; <a class="code" href="print-lexmark_8c.html#a21">COLOR_MODE_K</a>) == (mode &amp; <a class="code" href="print-lexmark_8c.html#a32">COLOR_MODE_MASK</a>)) {
00383     ptr_lr_shift = <a class="code" href="print-lexmark_8c.html#a86">lr_shift_black</a>;
00384   } <span class="keywordflow">else</span> {
00385     ptr_lr_shift = <a class="code" href="print-lexmark_8c.html#a85">lr_shift_color</a>;
00386   }
00387 
00388       <span class="keywordflow">switch</span>(mode &amp; <a class="code" href="print-lexmark_8c.html#a33">PRINT_MODE_MASK</a>)    {
00389         <span class="keywordflow">case</span> <a class="code" href="print-lexmark_8c.html#a17">PRINT_MODE_300</a>:
00390           <span class="keywordflow">return</span> ptr_lr_shift[0];
00391           <span class="keywordflow">break</span>;
00392         <span class="keywordflow">case</span> <a class="code" href="print-lexmark_8c.html#a18">PRINT_MODE_600</a>:
00393           <span class="keywordflow">return</span> ptr_lr_shift[1];
00394           <span class="keywordflow">break</span>;
00395         <span class="keywordflow">case</span> <a class="code" href="print-lexmark_8c.html#a19">PRINT_MODE_1200</a>:
00396           <span class="keywordflow">return</span> ptr_lr_shift[2];
00397           <span class="keywordflow">break</span>;
00398         <span class="keywordflow">case</span> <a class="code" href="print-lexmark_8c.html#a20">PRINT_MODE_2400</a>:
00399           <span class="keywordflow">return</span> ptr_lr_shift[2];
00400           <span class="keywordflow">break</span>;
00401       }
00402       <span class="keywordflow">return</span> 0;
00403 }
00404 
00405 
00406 <span class="comment">/*</span>
00407 <span class="comment"> * head offsets for z52:</span>
00408 <span class="comment"> *</span>
00409 <span class="comment"> *      black       black          color         photo</span>
00410 <span class="comment"> *    cartridge   cartridge      cartridge     cartridge</span>
00411 <span class="comment"> *      mode I     mode II</span>
00412 <span class="comment"> *</span>
00413 <span class="comment"> *              v                 +-----+ --    +-----+ ---</span>
00414 <span class="comment"> * --- +-----+ ---             v  |     | ^     |     |  ^</span>
00415 <span class="comment"> *  ^  |     | --- +-----+ --- -- |  C  | 64    | LC  |  |</span>
00416 <span class="comment"> *  |  |     |  ^  |     |  ^  40 |     | v  v  |     |  |</span>
00417 <span class="comment"> *  |  |     |     |     |  |  -- +-----+ -- -- +-----+  |</span>
00418 <span class="comment"> *  |  |     |     |     |  |  ^             28          |</span>
00419 <span class="comment"> *  |  |     |     |     |  |     +-----+ -- -- +-----+  |</span>
00420 <span class="comment"> *     |     |     |     |  |     |     | ^  ^  |     |  |</span>
00421 <span class="comment"> * 208 |  K  |     |  K  | 192    |  M  | 64    | LM  | 240</span>
00422 <span class="comment"> *     |     |     |     |  |     |     | v  v  |     |  |</span>
00423 <span class="comment"> *  |  |     |     |     |  |     +-----+ -- -- +-----+  |</span>
00424 <span class="comment"> *  |  |     |     |     |  |  v             28          |</span>
00425 <span class="comment"> *  |  |     |     |     |  |  -- +-----+ -- -- +-----+  |</span>
00426 <span class="comment"> *  |  |     |     |     |  v  40 |     | ^  ^  |     |  |</span>
00427 <span class="comment"> *  v  |     |     +-----+ --- -- |  Y  | 64    |  K  |  |</span>
00428 <span class="comment"> * --- +-----+                 ^  |     | v     |     |  v</span>
00429 <span class="comment"> *                                +-----+ --    +-----+ ---</span>
00430 <span class="comment"> *</span>
00431 <span class="comment"> */</span>
00432 
00433 <span class="keyword">static</span> <span class="keyword">const</span> <span class="keywordtype">int</span> <a class="code" href="print-lexmark_8c.html#a91">head_offset_cmyk</a>[] =
00434 {70, 368, 184, 0, 368, 184, 0};  <span class="comment">/* k, m, c, y, M, C, Y */</span>
00435 <span class="comment">/* the head_offset_cmy is needed because the dithering code is going into troubles if there is an offset different from 0 for the unused black color */</span>
00436 <span class="keyword">static</span> <span class="keyword">const</span> <span class="keywordtype">int</span> <a class="code" href="print-lexmark_8c.html#a92">head_offset_cmy</a>[] =
00437 {0, 368, 184, 0, 368, 184, 0};  <span class="comment">/* k, m, c, y, M, C, Y */</span>
00438 <span class="keyword">static</span> <span class="keyword">const</span> <span class="keywordtype">int</span> <a class="code" href="print-lexmark_8c.html#a93">head_offset_cCmMyk</a>[] =
<a name="l00439"></a><a class="code" href="print-lexmark_8c.html#a91">00439</a> {0, 368, 184, 0, 368, 184, 0};  <span class="comment">/* k, m, c, y, M, C, Y */</span>
00440 
00441 
<a name="l00442"></a><a class="code" href="print-lexmark_8c.html#a92">00442</a> 
00443 
<a name="l00444"></a><a class="code" href="print-lexmark_8c.html#a93">00444</a> <span class="comment">/**************************************************************************/</span>
00445 <span class="comment">/**** Data structures which are describing printer specific parameters ****/</span>
00446 
00447 <span class="comment">/* resolution specific parameters (substructure of lexmark_cap_t) */</span>
00448 <span class="keyword">typedef</span> <span class="keyword">struct </span>{
00449   <span class="keyword">const</span> <span class="keywordtype">char</span> *name;
00450   <span class="keyword">const</span> <span class="keywordtype">char</span> *text;
00451   <span class="keywordtype">int</span> hres;
00452   <span class="keywordtype">int</span> vres;
00453   <span class="keywordtype">int</span> softweave;
<a name="l00454"></a><a class="code" href="structlexmark__res__t.html">00454</a>   <span class="keywordtype">int</span> vertical_passes;
<a name="l00455"></a><a class="code" href="structlexmark__res__t.html#o0">00455</a>   <span class="keywordtype">int</span> vertical_oversample;
<a name="l00456"></a><a class="code" href="structlexmark__res__t.html#o1">00456</a>   <span class="keywordtype">int</span> unidirectional;      <span class="comment">/* print bi/unidirectional */</span>
<a name="l00457"></a><a class="code" href="structlexmark__res__t.html#o2">00457</a>   <span class="keywordtype">int</span> resid;               <span class="comment">/* resolution id */</span>
<a name="l00458"></a><a class="code" href="structlexmark__res__t.html#o3">00458</a> } <a class="code" href="structlexmark__res__t.html">lexmark_res_t</a>;
<a name="l00459"></a><a class="code" href="structlexmark__res__t.html#o4">00459</a> 
<a name="l00460"></a><a class="code" href="structlexmark__res__t.html#o5">00460</a> <span class="preprocessor">#define LEXM_RES_COUNT 30</span>
<a name="l00461"></a><a class="code" href="structlexmark__res__t.html#o6">00461</a> <span class="preprocessor"></span><span class="keyword">typedef</span> <a class="code" href="structlexmark__res__t.html">lexmark_res_t</a> <a class="code" href="structlexmark__res__t.html">lexmark_res_t_array</a>[<a class="code" href="print-lexmark_8c.html#a57">LEXM_RES_COUNT</a>];
<a name="l00462"></a><a class="code" href="structlexmark__res__t.html#o7">00462</a> 
<a name="l00463"></a><a class="code" href="structlexmark__res__t.html#o8">00463</a> 
00464 <span class="comment">/* ink type parameters (substructure of lexmark_cap_t) */</span>
00465 <span class="keyword">typedef</span> <span class="keyword">struct </span>{
<a name="l00466"></a><a class="code" href="print-lexmark_8c.html#a57">00466</a>   <span class="keywordtype">int</span> ncolors;
<a name="l00467"></a><a class="code" href="print-lexmark_8c.html#a94">00467</a>   <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> used_colors; <span class="comment">/* specifies the head colors to be used (e.g. COLOR_MODE_K */</span>
00468   <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> pass_length; <span class="comment">/* avaliable jets for one color */</span>
00469   <span class="keywordtype">int</span> v_top_head_offset;    <span class="comment">/* offset from top, wehere the first jet will be found */</span>
00470   <span class="keywordtype">int</span> h_catridge_offset;    <span class="comment">/* horizontal offset of cartridges */</span>
<a name="l00471"></a><a class="code" href="structlexmark__inkparam__t.html">00471</a>   <span class="keywordtype">int</span> h_direction_offset;   <span class="comment">/* Offset when printing in the other direction */</span>
<a name="l00472"></a><a class="code" href="structlexmark__inkparam__t.html#o0">00472</a>   <span class="keyword">const</span> <span class="keywordtype">int</span> *head_offset;   <span class="comment">/* specifies the offset of head colors */</span>
<a name="l00473"></a><a class="code" href="structlexmark__inkparam__t.html#o1">00473</a> } <a class="code" href="structlexmark__inkparam__t.html">lexmark_inkparam_t</a>;
<a name="l00474"></a><a class="code" href="structlexmark__inkparam__t.html#o2">00474</a> 
<a name="l00475"></a><a class="code" href="structlexmark__inkparam__t.html#o3">00475</a> <span class="keyword">typedef</span> <span class="keyword">struct</span>
<a name="l00476"></a><a class="code" href="structlexmark__inkparam__t.html#o4">00476</a> <span class="keyword"></span>{
<a name="l00477"></a><a class="code" href="structlexmark__inkparam__t.html#o5">00477</a>   <span class="keyword">const</span> <span class="keywordtype">char</span> *name;
<a name="l00478"></a><a class="code" href="structlexmark__inkparam__t.html#o6">00478</a>   <span class="keyword">const</span> <span class="keywordtype">char</span> *text;
00479   <a class="code" href="structlexmark__inkparam__t.html">lexmark_inkparam_t</a> ink_parameter[2];
00480 } <a class="code" href="structlexmark__inkname__t.html">lexmark_inkname_t</a>;
<a name="l00481"></a><a class="code" href="structlexmark__inkname__t.html">00481</a> 
00482 
<a name="l00483"></a><a class="code" href="structlexmark__inkname__t.html#o0">00483</a> <span class="comment">/* main structure which describes all printer specific parameters */</span>
<a name="l00484"></a><a class="code" href="structlexmark__inkname__t.html#o1">00484</a> <span class="keyword">typedef</span> <span class="keyword">struct </span>{
<a name="l00485"></a><a class="code" href="structlexmark__inkname__t.html#o2">00485</a>   <a class="code" href="print-lexmark_8c.html#a81">Lex_model</a> model;    <span class="comment">/* printer model */</span>
00486   <span class="keywordtype">int</span> max_paper_width;  <span class="comment">/* maximum printable paper size in 1/72 inch */</span>
00487   <span class="keywordtype">int</span> max_paper_height;
00488   <span class="keywordtype">int</span> min_paper_width;  <span class="comment">/* Maximum paper width, in points */</span>
00489   <span class="keywordtype">int</span> min_paper_height; <span class="comment">/* Maximum paper height, in points */</span>
<a name="l00490"></a><a class="code" href="structlexmark__cap__t.html">00490</a>   <span class="keywordtype">int</span> max_xdpi;
<a name="l00491"></a><a class="code" href="structlexmark__cap__t.html#o0">00491</a>   <span class="keywordtype">int</span> max_ydpi;
<a name="l00492"></a><a class="code" href="structlexmark__cap__t.html#o1">00492</a>   <span class="keywordtype">int</span> max_quality;
<a name="l00493"></a><a class="code" href="structlexmark__cap__t.html#o2">00493</a>   <span class="keywordtype">int</span> border_left;    <span class="comment">/* unit is 72 DPI */</span>
<a name="l00494"></a><a class="code" href="structlexmark__cap__t.html#o3">00494</a>   <span class="keywordtype">int</span> border_right;
<a name="l00495"></a><a class="code" href="structlexmark__cap__t.html#o4">00495</a>   <span class="keywordtype">int</span> border_top;
<a name="l00496"></a><a class="code" href="structlexmark__cap__t.html#o5">00496</a>   <span class="keywordtype">int</span> border_bottom;
<a name="l00497"></a><a class="code" href="structlexmark__cap__t.html#o6">00497</a>   <span class="keywordtype">int</span> inks;           <span class="comment">/* installable cartridges (LEXMARK_INK_*) */</span>
<a name="l00498"></a><a class="code" href="structlexmark__cap__t.html#o7">00498</a>   <span class="keywordtype">int</span> slots;          <span class="comment">/* available paperslots */</span>
<a name="l00499"></a><a class="code" href="structlexmark__cap__t.html#o8">00499</a>   <span class="keywordtype">int</span> features;       <span class="comment">/* special bjl settings */</span>
<a name="l00500"></a><a class="code" href="structlexmark__cap__t.html#o9">00500</a>   <span class="comment">/*** printer internal parameters ***/</span>
<a name="l00501"></a><a class="code" href="structlexmark__cap__t.html#o10">00501</a>   <span class="comment">/* the unit of the following parameters is identical with max phys unit of the printer */</span>
<a name="l00502"></a><a class="code" href="structlexmark__cap__t.html#o11">00502</a>   <span class="keywordtype">int</span> offset_left_border;      <span class="comment">/* Offset to the left paper border (== border_left=0) */</span>
<a name="l00503"></a><a class="code" href="structlexmark__cap__t.html#o12">00503</a>   <span class="keywordtype">int</span> offset_top_border;       <span class="comment">/* Offset to the top paper border (== border_top=0) */</span>
<a name="l00504"></a><a class="code" href="structlexmark__cap__t.html#o13">00504</a>   <span class="keywordtype">int</span> x_raster_res;            <span class="comment">/* horizontal resolution for positioning of the printer head in DPI */</span>
<a name="l00505"></a><a class="code" href="structlexmark__cap__t.html#o14">00505</a>   <span class="keywordtype">int</span> y_raster_res;            <span class="comment">/* vertical   resolution for positioning of the printer head in DPI */</span>
00506   <span class="keyword">const</span> <a class="code" href="print-lexmark_8c.html#a94">lexmark_res_t_array</a> *res_parameters; <span class="comment">/* resolution specific parameters; last entry has resid = -1 */</span>
00507   <span class="keyword">const</span> <a class="code" href="structlexmark__inkname__t.html">lexmark_inkname_t</a> *ink_types;  <span class="comment">/* type of supported inks */</span>
<a name="l00508"></a><a class="code" href="structlexmark__cap__t.html#o15">00508</a>   <span class="keyword">const</span> <span class="keywordtype">char</span> *lum_adjustment;
<a name="l00509"></a><a class="code" href="structlexmark__cap__t.html#o16">00509</a>   <span class="keyword">const</span> <span class="keywordtype">char</span> *hue_adjustment;
<a name="l00510"></a><a class="code" href="structlexmark__cap__t.html#o17">00510</a>   <span class="keyword">const</span> <span class="keywordtype">char</span> *sat_adjustment;
<a name="l00511"></a><a class="code" href="structlexmark__cap__t.html#o18">00511</a> } <a class="code" href="structlexmark__cap__t.html">lexmark_cap_t</a>;
<a name="l00512"></a><a class="code" href="structlexmark__cap__t.html#o19">00512</a> 
<a name="l00513"></a><a class="code" href="structlexmark__cap__t.html#o20">00513</a> 
<a name="l00514"></a><a class="code" href="structlexmark__cap__t.html#o21">00514</a> <span class="comment">/*****************************************************************/</span>
<a name="l00515"></a><a class="code" href="structlexmark__cap__t.html#o22">00515</a> <span class="comment">/**** initialize printer specific data structures ****/</span>
<a name="l00516"></a><a class="code" href="structlexmark__cap__t.html#o23">00516</a> 
00517 <span class="comment">/*</span>
00518 <span class="comment"> * z52 specific parameters</span>
00519 <span class="comment"> */</span>
00520 <span class="preprocessor">#define LX_Z52_300_DPI  1</span>
00521 <span class="preprocessor"></span><span class="preprocessor">#define LX_Z52_600_DPI  3</span>
00522 <span class="preprocessor"></span><span class="preprocessor">#define LX_Z52_1200_DPI 4</span>
00523 <span class="preprocessor"></span><span class="preprocessor">#define LX_Z52_2400_DPI 5</span>
00524 <span class="preprocessor"></span>
00525 <span class="preprocessor">#define LX_Z52_COLOR_PRINT 0</span>
<a name="l00526"></a><a class="code" href="print-lexmark_8c.html#a58">00526</a> <span class="preprocessor"></span><span class="preprocessor">#define LX_Z52_BLACK_PRINT 1</span>
<a name="l00527"></a><a class="code" href="print-lexmark_8c.html#a59">00527</a> <span class="preprocessor"></span>
<a name="l00528"></a><a class="code" href="print-lexmark_8c.html#a60">00528</a> <span class="preprocessor">#define LX_PSHIFT                   0x13</span>
<a name="l00529"></a><a class="code" href="print-lexmark_8c.html#a61">00529</a> <span class="preprocessor"></span><span class="preprocessor">#define LX_Z52_COLOR_MODE_POS       0x9</span>
00530 <span class="preprocessor"></span><span class="preprocessor">#define LX_Z52_RESOLUTION_POS       0x7</span>
<a name="l00531"></a><a class="code" href="print-lexmark_8c.html#a62">00531</a> <span class="preprocessor"></span><span class="preprocessor">#define LX_Z52_PRINT_DIRECTION_POS  0x8</span>
<a name="l00532"></a><a class="code" href="print-lexmark_8c.html#a63">00532</a> <span class="preprocessor"></span>
00533 <span class="comment">/*static const int IDX_Z52ID =2;*/</span>
<a name="l00534"></a><a class="code" href="print-lexmark_8c.html#a64">00534</a> <span class="keyword">static</span> <span class="keyword">const</span> <span class="keywordtype">int</span> <a class="code" href="print-lexmark_8c.html#a95">IDX_SEQLEN</a>=3;
<a name="l00535"></a><a class="code" href="print-lexmark_8c.html#a65">00535</a> 
<a name="l00536"></a><a class="code" href="print-lexmark_8c.html#a66">00536</a> <span class="comment">/*</span>
<a name="l00537"></a><a class="code" href="print-lexmark_8c.html#a67">00537</a> <span class="comment">   head:</span>
00538 <span class="comment">     1 .. black,</span>
00539 <span class="comment">     0 .. color</span>
<a name="l00540"></a><a class="code" href="print-lexmark_8c.html#a95">00540</a> <span class="comment"></span>
00541 <span class="comment">   resolution:</span>
00542 <span class="comment">     1 .. 300 dpi (for black ?)</span>
00543 <span class="comment">     2 .. like 1</span>
00544 <span class="comment">     3 .. 600 dpi (color&amp;black)</span>
00545 <span class="comment">     4 .. 1200 dpi</span>
00546 <span class="comment">     5 .. ? like 1</span>
00547 <span class="comment">*/</span>
00548 
00549 <span class="preprocessor">#define LXM_Z52_HEADERSIZE 34</span>
00550 <span class="preprocessor"></span><span class="keyword">static</span> <span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">char</span> <a class="code" href="print-lexmark_8c.html#a96">outbufHeader_z52</a>[<a class="code" href="print-lexmark_8c.html#a68">LXM_Z52_HEADERSIZE</a>]=
00551 {
00552   0x1B,0x2A,0x24,0x00,0x00,0xFF,0xFF,         <span class="comment">/* number of packets ----     vvvvvvvvv */</span>
00553   0x01,0x01,0x01,0x1a,0x03,0x01,              <span class="comment">/* 0x7-0xc: resolution, direction, head */</span>
00554   0x03,0x60,                                  <span class="comment">/* 0xd-0xe HE */</span>
<a name="l00555"></a><a class="code" href="print-lexmark_8c.html#a68">00555</a>   0x04,0xe0,                                  <span class="comment">/* 0xf-0x10  HS vertical pos */</span>
<a name="l00556"></a><a class="code" href="print-lexmark_8c.html#a96">00556</a>   0x19,0x5c,                                  <span class="comment">/* 0x11-0x12 */</span>
00557   0x0,0x0,                                    <span class="comment">/* 0x13-0x14  VO between packges*/</span>
00558   0x0,0x80,                                   <span class="comment">/* 0x15-0x16 */</span>
00559   0x0,0x0,0x0,0x0,0x1,0x2,0x0,0x0,0x0,0x0,0x0 <span class="comment">/* 0x17-0x21 */</span>
00560 };
00561 
00562 <span class="preprocessor">#define LXM_Z42_HEADERSIZE 34</span>
00563 <span class="preprocessor"></span><span class="keyword">static</span> <span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">char</span> <a class="code" href="print-lexmark_8c.html#a97">outbufHeader_z42</a>[<a class="code" href="print-lexmark_8c.html#a69">LXM_Z42_HEADERSIZE</a>]=
00564 {
00565   0x1B,0x2A,0x24,0x00,0x00,0x00,0x00,
00566   0x01,0x01,0x01,0x18,0x00,0x01,0x00,
00567   0x00,0x00,0x00,0x00,0x00,0x00,0x00,
<a name="l00568"></a><a class="code" href="print-lexmark_8c.html#a69">00568</a>   0x00,0x00,0x00,0x00,0x00,0x00,0x00,
<a name="l00569"></a><a class="code" href="print-lexmark_8c.html#a97">00569</a>   0x00,0x00,0x00,0x00,0x00,0x00
00570 };
00571 
00572 
00573 <span class="keyword">static</span> <span class="keyword">const</span> <a class="code" href="print-lexmark_8c.html#a94">lexmark_res_t_array</a> <a class="code" href="print-lexmark_8c.html#a98">lexmark_reslist_z52</a> =  <span class="comment">/* LEXM_RES_COUNT entries are allowed !! */</span>
00574 {
00575   <span class="comment">/*     name                                                    hres vres softw v_pass overs unidir resid */</span>
00576   { <span class="stringliteral">"300x600dpi"</span>,     <a class="code" href="group__intl__internal.html#ga6">N_</a> (<span class="stringliteral">"300 DPI x 600 DPI"</span>),                  300,  600,  0,    1,    1,    0,    <a class="code" href="print-lexmark_8c.html#a9">DPI300</a> },
00577   { <span class="stringliteral">"600dpi"</span>,         <a class="code" href="group__intl__internal.html#ga6">N_</a> (<span class="stringliteral">"600 DPI"</span>),                            600,  600,  0,    1,    1,    0,    <a class="code" href="print-lexmark_8c.html#a10">DPI600</a> },
00578   { <span class="stringliteral">"600hq"</span>,          <a class="code" href="group__intl__internal.html#ga6">N_</a> (<span class="stringliteral">"600 DPI high quality"</span>),               600,  600,  1,    4,    1,    0,    <a class="code" href="print-lexmark_8c.html#a10">DPI600</a> },
<a name="l00579"></a><a class="code" href="print-lexmark_8c.html#a98">00579</a>   { <span class="stringliteral">"600uni"</span>,         <a class="code" href="group__intl__internal.html#ga6">N_</a> (<span class="stringliteral">"600 DPI Unidirectional"</span>),             600,  600,  0,    1,    1,    1,    <a class="code" href="print-lexmark_8c.html#a10">DPI600</a> },
00580   { <span class="stringliteral">"1200dpi"</span>,        <a class="code" href="group__intl__internal.html#ga6">N_</a> (<span class="stringliteral">"1200 DPI"</span>),                          1200, 1200,  1,    1,    1,    0,    <a class="code" href="print-lexmark_8c.html#a11">DPI1200</a>},
00581   { <span class="stringliteral">"1200hq"</span>,         <a class="code" href="group__intl__internal.html#ga6">N_</a> (<span class="stringliteral">"1200 DPI high quality"</span>),             1200, 1200,  1,    1,    1,    0,    <a class="code" href="print-lexmark_8c.html#a9">DPI300</a> },
00582   { <span class="stringliteral">"1200hq2"</span>,        <a class="code" href="group__intl__internal.html#ga6">N_</a> (<span class="stringliteral">"1200 DPI highest quality"</span>),          1200, 1200,  1,    1,    1,    0,    <a class="code" href="print-lexmark_8c.html#a10">DPI600</a> },
00583   { <span class="stringliteral">"1200uni"</span>,        <a class="code" href="group__intl__internal.html#ga6">N_</a> (<span class="stringliteral">"1200 DPI  Unidirectional"</span>),          1200, 1200,  0,    1,    1,    1,    <a class="code" href="print-lexmark_8c.html#a11">DPI1200</a>},
00584   { <span class="stringliteral">"2400x1200dpi"</span>,   <a class="code" href="group__intl__internal.html#ga6">N_</a> (<span class="stringliteral">"2400 DPI x 1200 DPI"</span>),               2400, 1200,  1,    1,    1,    0,    <a class="code" href="print-lexmark_8c.html#a11">DPI1200</a>},
00585   { <span class="stringliteral">"2400x1200hq"</span>,    <a class="code" href="group__intl__internal.html#ga6">N_</a> (<span class="stringliteral">"2400 DPI x 1200 DPI high quality"</span>),  2400, 1200,  1,    1,    1,    0,    <a class="code" href="print-lexmark_8c.html#a10">DPI600</a> },
00586   { <span class="stringliteral">"2400x1200hq2"</span>,   <a class="code" href="group__intl__internal.html#ga6">N_</a> (<span class="stringliteral">"2400 DPI x 1200 DPI highest quality"</span>),2400, 1200,  1,    1,    1,    0,    <a class="code" href="print-lexmark_8c.html#a9">DPI300</a>},
00587 <span class="preprocessor">#ifdef DEBUG</span>
00588 <span class="preprocessor"></span>  { <span class="stringliteral">"testprint"</span>,      <a class="code" href="group__intl__internal.html#ga6">N_</a> (<span class="stringliteral">"test print"</span>),                        1200, 1200,  1,    1,    1,    0,    <a class="code" href="print-lexmark_8c.html#a13">DPItest</a>},
00589 <span class="preprocessor">#endif</span>
00590 <span class="preprocessor"></span>  { <span class="stringliteral">""</span>,                 <span class="stringliteral">""</span>, 0, 0, 0, 0, 0, -1 }
00591 };
00592 
00593 
00594 <span class="keyword">static</span> <span class="keyword">const</span> <a class="code" href="structlexmark__inkname__t.html">lexmark_inkname_t</a> <a class="code" href="print-lexmark_8c.html#a99">ink_types_z52</a>[] =
00595 {
00596   <span class="comment">/*   output_type   ncolors used_colors   pass_length  v_top_head_offset</span>
00597 <span class="comment">   *                                                        h_catridge_offset</span>
00598 <span class="comment">   *                                                           h_direction_offset</span>
00599 <span class="comment">   *                                                               head_offset */</span>
<a name="l00600"></a><a class="code" href="print-lexmark_8c.html#a99">00600</a>   { <span class="stringliteral">"CMYK"</span>,     <a class="code" href="group__intl__internal.html#ga6">N_</a>(<span class="stringliteral">"Four Color Standard"</span>),
00601     {{ 1, <a class="code" href="print-lexmark_8c.html#a21">COLOR_MODE_K</a>,        208, 324, 0, 10, <a class="code" href="print-lexmark_8c.html#a91">head_offset_cmyk</a> },
00602      { 4, <a class="code" href="print-lexmark_8c.html#a28">COLOR_MODE_CMYK</a>,   192/3,   0, 0, 10, <a class="code" href="print-lexmark_8c.html#a91">head_offset_cmyk</a> }}},
00603   { <span class="stringliteral">"RGB"</span>,      <a class="code" href="group__intl__internal.html#ga6">N_</a>(<span class="stringliteral">"Three Color Composite"</span>),
00604     {{ 1, <a class="code" href="print-lexmark_8c.html#a21">COLOR_MODE_K</a>,        208, 324, 0, 10, <a class="code" href="print-lexmark_8c.html#a91">head_offset_cmyk</a> },  <span class="comment">/* we ignor CMY, use black */</span>
00605      { 4, <a class="code" href="print-lexmark_8c.html#a29">COLOR_MODE_CMY</a>,    192/3,   0, 0, 10, <a class="code" href="print-lexmark_8c.html#a92">head_offset_cmy</a> }}},
00606   { <span class="stringliteral">"PhotoCMYK"</span>, <a class="code" href="group__intl__internal.html#ga6">N_</a>(<span class="stringliteral">"Six Color Photo"</span>),
00607     {{ 1, <a class="code" href="print-lexmark_8c.html#a21">COLOR_MODE_K</a>,      192/3,   0, 0, 10, <a class="code" href="print-lexmark_8c.html#a93">head_offset_cCmMyk</a> },
00608      { 6, <a class="code" href="print-lexmark_8c.html#a30">COLOR_MODE_CcMcYK</a>, 192/3,   0, 0, 10, <a class="code" href="print-lexmark_8c.html#a93">head_offset_cCmMyk</a> }}},
00609   { <span class="stringliteral">"PhotoCMY"</span>, <a class="code" href="group__intl__internal.html#ga6">N_</a>(<span class="stringliteral">"Five Color Photo Composite"</span>),
00610     {{ 1, <a class="code" href="print-lexmark_8c.html#a21">COLOR_MODE_K</a>,        208, 324, 0, 10, <a class="code" href="print-lexmark_8c.html#a93">head_offset_cCmMyk</a> },
00611      { 5, <a class="code" href="print-lexmark_8c.html#a31">COLOR_MODE_CcMcY</a>,  192/3,   0, 0, 10, <a class="code" href="print-lexmark_8c.html#a93">head_offset_cCmMyk</a> }}}, <span class="comment">/* we ignor CMY, use black */</span>
00612   { <span class="stringliteral">"Gray"</span>,     <a class="code" href="group__intl__internal.html#ga6">N_</a>(<span class="stringliteral">"Black"</span>),
00613     {{ 1, <a class="code" href="print-lexmark_8c.html#a21">COLOR_MODE_K</a>,        208, 324, 0, 10, <a class="code" href="print-lexmark_8c.html#a91">head_offset_cmyk</a> },
00614      { 1, <a class="code" href="print-lexmark_8c.html#a21">COLOR_MODE_K</a>,        208, 324, 0, 10, <a class="code" href="print-lexmark_8c.html#a91">head_offset_cmyk</a> }}},
00615   { NULL, NULL }
00616 };
00617 
00618 
00619 
00620 <span class="comment">/*</span>
00621 <span class="comment"> * 3200 sepecific stuff</span>
00622 <span class="comment"> */</span>
00623 <span class="preprocessor">#define LXM3200_LEFTOFFS 6254</span>
00624 <span class="preprocessor"></span><span class="preprocessor">#define LXM3200_RIGHTOFFS (LXM3200_LEFTOFFS-2120)</span>
00625 <span class="preprocessor"></span>
00626 <span class="keyword">static</span> <span class="keywordtype">int</span> <a class="code" href="print-lexmark_8c.html#a100">lxm3200_headpos</a> = 0;
00627 <span class="keyword">static</span> <span class="keywordtype">int</span> <a class="code" href="print-lexmark_8c.html#a101">lxm3200_linetoeject</a> = 0;
00628 
<a name="l00629"></a><a class="code" href="print-lexmark_8c.html#a70">00629</a> <span class="preprocessor">#define LXM_3200_HEADERSIZE 24</span>
<a name="l00630"></a><a class="code" href="print-lexmark_8c.html#a71">00630</a> <span class="preprocessor"></span><span class="keyword">static</span> <span class="keyword">const</span> <span class="keywordtype">char</span> <a class="code" href="print-lexmark_8c.html#a102">outbufHeader_3200</a>[<a class="code" href="print-lexmark_8c.html#a72">LXM_3200_HEADERSIZE</a>] =
00631 {
<a name="l00632"></a><a class="code" href="print-lexmark_8c.html#a100">00632</a>   0x1b, 0x40, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
<a name="l00633"></a><a class="code" href="print-lexmark_8c.html#a101">00633</a>   0x1b, 0x42, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
00634   0x1b, 0x43, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00
<a name="l00635"></a><a class="code" href="print-lexmark_8c.html#a72">00635</a> };
<a name="l00636"></a><a class="code" href="print-lexmark_8c.html#a102">00636</a> 
00637 <span class="keyword">static</span> <span class="keyword">inline</span> <span class="keywordtype">int</span>
00638 <a class="code" href="print-lexmark_8c.html#a121">lexmark_calc_3200_checksum</a>(<span class="keywordtype">unsigned</span> <span class="keywordtype">char</span> *data)
00639 {
00640   <span class="keywordtype">int</span> ck, i;
00641 
00642   ck = 0;
00643   <span class="keywordflow">for</span>(i=1; i&lt;7; i++)ck += data[i];
<a name="l00644"></a><a class="code" href="print-lexmark_8c.html#a121">00644</a> 
00645   <span class="keywordflow">return</span>(ck &amp; 255);
00646 }
00647 
00648 
00649 <span class="keyword">static</span> <span class="keyword">const</span> <a class="code" href="print-lexmark_8c.html#a94">lexmark_res_t_array</a> <a class="code" href="print-lexmark_8c.html#a103">lexmark_reslist_3200</a> =   <span class="comment">/* LEXM_RES_COUNT entries are allowed !! */</span>
00650 {
00651   <span class="comment">/*     name                                                    hres vres softw v_pass overs unidir resid */</span>
00652   { <span class="stringliteral">"300x600dpi"</span>,     <a class="code" href="group__intl__internal.html#ga6">N_</a> (<span class="stringliteral">"300 DPI x 600 DPI"</span>),                  300,  600,  0,    1,    1,    0,    <a class="code" href="print-lexmark_8c.html#a9">DPI300</a> },
00653   { <span class="stringliteral">"600dpi"</span>,         <a class="code" href="group__intl__internal.html#ga6">N_</a> (<span class="stringliteral">"600 DPI"</span>),                            600,  600,  0,    1,    1,    0,    <a class="code" href="print-lexmark_8c.html#a10">DPI600</a> },
00654   { <span class="stringliteral">"600hq"</span>,          <a class="code" href="group__intl__internal.html#ga6">N_</a> (<span class="stringliteral">"600 DPI high quality"</span>),               600,  600,  1,    4,    1,    0,    <a class="code" href="print-lexmark_8c.html#a10">DPI600</a> },
<a name="l00655"></a><a class="code" href="print-lexmark_8c.html#a103">00655</a>   { <span class="stringliteral">"600uni"</span>,         <a class="code" href="group__intl__internal.html#ga6">N_</a> (<span class="stringliteral">"600 DPI Unidirectional"</span>),             600,  600,  0,    1,    1,    1,    <a class="code" href="print-lexmark_8c.html#a10">DPI600</a> },
00656   { <span class="stringliteral">"1200dpi"</span>,        <a class="code" href="group__intl__internal.html#ga6">N_</a> (<span class="stringliteral">"1200 DPI"</span>),                          1200, 1200,  1,    1,    1,    0,    <a class="code" href="print-lexmark_8c.html#a11">DPI1200</a>},
00657   { <span class="stringliteral">"1200hq"</span>,         <a class="code" href="group__intl__internal.html#ga6">N_</a> (<span class="stringliteral">"1200 DPI high quality"</span>),             1200, 1200,  1,    1,    1,    0,    <a class="code" href="print-lexmark_8c.html#a9">DPI300</a> },
00658   { <span class="stringliteral">"1200hq2"</span>,        <a class="code" href="group__intl__internal.html#ga6">N_</a> (<span class="stringliteral">"1200 DPI highest quality"</span>),          1200, 1200,  1,    1,    1,    0,    <a class="code" href="print-lexmark_8c.html#a10">DPI600</a> },
00659   { <span class="stringliteral">"1200uni"</span>,        <a class="code" href="group__intl__internal.html#ga6">N_</a> (<span class="stringliteral">"1200 DPI  Unidirectional"</span>),          1200, 1200,  0,    1,    1,    1,    <a class="code" href="print-lexmark_8c.html#a11">DPI1200</a>},
00660   { <span class="stringliteral">""</span>,                 <span class="stringliteral">""</span>, 0, 0, 0, 0, 0, -1 }
00661 };
00662 
00663 
00664 <span class="keyword">static</span> <span class="keyword">const</span> <a class="code" href="structlexmark__inkname__t.html">lexmark_inkname_t</a> <a class="code" href="print-lexmark_8c.html#a104">ink_types_3200</a>[] =
00665 {
00666   <span class="comment">/*   output_type   ncolors used_colors   pass_length  v_top_head_offset</span>
00667 <span class="comment">   *                                                        h_catridge_offset</span>
00668 <span class="comment">   *                                                           h_direction_offset</span>
00669 <span class="comment">   *                                                               head_offset */</span>
<a name="l00670"></a><a class="code" href="print-lexmark_8c.html#a104">00670</a>   { <span class="stringliteral">"CMYK"</span>,     <a class="code" href="group__intl__internal.html#ga6">N_</a>(<span class="stringliteral">"Four Color Standard"</span>),
00671     {{ 1, <a class="code" href="print-lexmark_8c.html#a21">COLOR_MODE_K</a>,        208,  20, 0, 12, <a class="code" href="print-lexmark_8c.html#a91">head_offset_cmyk</a> },
00672      { 4, <a class="code" href="print-lexmark_8c.html#a28">COLOR_MODE_CMYK</a>,   192/3,   0, 0, 12, <a class="code" href="print-lexmark_8c.html#a91">head_offset_cmyk</a> }}},
00673   { <span class="stringliteral">"RGB"</span>,      <a class="code" href="group__intl__internal.html#ga6">N_</a>(<span class="stringliteral">"Three Color Composite"</span>),
00674     {{ 1, <a class="code" href="print-lexmark_8c.html#a21">COLOR_MODE_K</a>,        208,  20, 0, 12, <a class="code" href="print-lexmark_8c.html#a91">head_offset_cmyk</a> },  <span class="comment">/* we ignor CMY, use black */</span>
00675      { 4, <a class="code" href="print-lexmark_8c.html#a29">COLOR_MODE_CMY</a>,    192/3,   0, 0, 12, <a class="code" href="print-lexmark_8c.html#a92">head_offset_cmy</a> }}},
00676   { <span class="stringliteral">"PhotoCMYK"</span>, <a class="code" href="group__intl__internal.html#ga6">N_</a>(<span class="stringliteral">"Six Color Photo"</span>),
00677     {{ 1, <a class="code" href="print-lexmark_8c.html#a21">COLOR_MODE_K</a>,      192/3,   0, 0, 12, <a class="code" href="print-lexmark_8c.html#a93">head_offset_cCmMyk</a> },
00678      { 6, <a class="code" href="print-lexmark_8c.html#a30">COLOR_MODE_CcMcYK</a>, 192/3,   0, 0, 12, <a class="code" href="print-lexmark_8c.html#a93">head_offset_cCmMyk</a> }}},
00679   { <span class="stringliteral">"PhotoCMY"</span>, <a class="code" href="group__intl__internal.html#ga6">N_</a>(<span class="stringliteral">"Five Color Photo Composite"</span>),
00680     {{ 1, <a class="code" href="print-lexmark_8c.html#a21">COLOR_MODE_K</a>,        208,  20, 0, 12, <a class="code" href="print-lexmark_8c.html#a93">head_offset_cCmMyk</a> }, <span class="comment">/* we ignor CMY, use black */</span>
00681      { 5, <a class="code" href="print-lexmark_8c.html#a31">COLOR_MODE_CcMcY</a>,  192/3,   0, 0, 12, <a class="code" href="print-lexmark_8c.html#a93">head_offset_cCmMyk</a> }}},
00682   { NULL, NULL }
00683 };
00684 
00685 
00686 
00687 
00688 
00689 <span class="comment">/* main structure */</span>
00690 <span class="keyword">static</span> <span class="keyword">const</span> <a class="code" href="structlexmark__cap__t.html">lexmark_cap_t</a> <a class="code" href="print-lexmark_8c.html#a105">lexmark_model_capabilities</a>[] =
00691 {
00692   <span class="comment">/* default settings for unkown models */</span>
00693 
00694   {   (<a class="code" href="print-lexmark_8c.html#a81">Lex_model</a>)-1, 8*72,11*72,180,180,20,20,20,20, <a class="code" href="print-lexmark_8c.html#a39">LEXMARK_INK_K</a>, <a class="code" href="print-lexmark_8c.html#a47">LEXMARK_SLOT_ASF1</a>, 0 },
00695 
<a name="l00696"></a><a class="code" href="print-lexmark_8c.html#a105">00696</a>   <span class="comment">/* tested models */</span>
00697 
00698   { <span class="comment">/* Lexmark z52 */</span>
00699     <a class="code" href="print-lexmark_8c.html#a152a116">m_z52</a>,
00700     618, 936,         <span class="comment">/* max paper size */</span><span class="comment">/* 8.58" x 13 " */</span>
00701     <a class="code" href="print-escp2-data_8c.html#a0">INCH</a>(2), <a class="code" href="print-escp2-data_8c.html#a0">INCH</a>(4), <span class="comment">/* min paper size */</span>
00702     2400, 1200, 2, <span class="comment">/* max resolution */</span>
00703     0, 0, 5, 15, <span class="comment">/* 15 36 border l,r,t,b    unit is 1/72 DPI */</span>
00704     <a class="code" href="print-lexmark_8c.html#a40">LEXMARK_INK_CMY</a> | <a class="code" href="print-lexmark_8c.html#a41">LEXMARK_INK_CMYK</a> | <a class="code" href="print-lexmark_8c.html#a42">LEXMARK_INK_CcMmYK</a>,
00705     <a class="code" href="print-lexmark_8c.html#a47">LEXMARK_SLOT_ASF1</a> | <a class="code" href="print-lexmark_8c.html#a49">LEXMARK_SLOT_MAN1</a>,
00706     <a class="code" href="print-lexmark_8c.html#a51">LEXMARK_CAP_DMT</a>,
00707     <span class="comment">/*** printer internal parameters ***/</span>
00708     20,        <span class="comment">/* real left paper border */</span>
00709     123,       <span class="comment">/* real top paper border */</span>
00710     2400,      <span class="comment">/* horizontal resolution of 2400 dpi for positioning */</span>
00711     1200,      <span class="comment">/* use a vertical resolution of 1200 dpi for positioning */</span>
00712     &amp;<a class="code" href="print-lexmark_8c.html#a98">lexmark_reslist_z52</a>,  <span class="comment">/* resolution specific parameters of z52 */</span>
00713     <a class="code" href="print-lexmark_8c.html#a99">ink_types_z52</a>,  <span class="comment">/* supported inks */</span>
00714     <a class="code" href="print-lexmark_8c.html#a83">standard_lum_adjustment</a>, <a class="code" href="print-lexmark_8c.html#a84">standard_hue_adjustment</a>, <a class="code" href="print-lexmark_8c.html#a82">standard_sat_adjustment</a>
00715   },
00716   { <span class="comment">/* Lexmark z42 */</span>
00717     <a class="code" href="print-lexmark_8c.html#a152a117">m_z42</a>,
00718     618, 936,         <span class="comment">/* max paper size */</span><span class="comment">/* 8.58" x 13 " */</span>
00719     <a class="code" href="print-escp2-data_8c.html#a0">INCH</a>(2), <a class="code" href="print-escp2-data_8c.html#a0">INCH</a>(4), <span class="comment">/* min paper size */</span>
00720     2400, 1200, 2, <span class="comment">/* max resolution */</span>
00721     0, 0, 5, 41, <span class="comment">/* border l,r,t,b    unit is 1/72 DPI */</span>
00722     <a class="code" href="print-lexmark_8c.html#a40">LEXMARK_INK_CMY</a> | <a class="code" href="print-lexmark_8c.html#a41">LEXMARK_INK_CMYK</a> | <a class="code" href="print-lexmark_8c.html#a42">LEXMARK_INK_CcMmYK</a>,
00723     <a class="code" href="print-lexmark_8c.html#a47">LEXMARK_SLOT_ASF1</a> | <a class="code" href="print-lexmark_8c.html#a49">LEXMARK_SLOT_MAN1</a>,
00724     <a class="code" href="print-lexmark_8c.html#a51">LEXMARK_CAP_DMT</a>,
00725     <span class="comment">/*** printer internal parameters ***/</span>
00726     20,        <span class="comment">/* real left paper border */</span>
00727     123,       <span class="comment">/* real top paper border */</span>
00728     2400,      <span class="comment">/* horizontal resolution of 2400 dpi for positioning */</span>
00729     1200,      <span class="comment">/* use a vertical resolution of 1200 dpi for positioning */</span>
00730     &amp;<a class="code" href="print-lexmark_8c.html#a98">lexmark_reslist_z52</a>,  <span class="comment">/* resolution specific parameters of z52 */</span>
00731     <a class="code" href="print-lexmark_8c.html#a99">ink_types_z52</a>,  <span class="comment">/* supported inks */</span>
00732     <a class="code" href="print-lexmark_8c.html#a83">standard_lum_adjustment</a>, <a class="code" href="print-lexmark_8c.html#a84">standard_hue_adjustment</a>, <a class="code" href="print-lexmark_8c.html#a82">standard_sat_adjustment</a>
00733   },
00734   { <span class="comment">/* Lexmark 3200 */</span>
00735     <a class="code" href="print-lexmark_8c.html#a152a118">m_3200</a>,
00736     618, 936,      <span class="comment">/* 8.58" x 13 " */</span>
00737     <a class="code" href="print-escp2-data_8c.html#a0">INCH</a>(2), <a class="code" href="print-escp2-data_8c.html#a0">INCH</a>(4), <span class="comment">/* min paper size */</span>
00738     1200, 1200, 2,
00739     11, 9, 10, 18,
00740     <a class="code" href="print-lexmark_8c.html#a41">LEXMARK_INK_CMYK</a> | <a class="code" href="print-lexmark_8c.html#a42">LEXMARK_INK_CcMmYK</a>,
00741     <a class="code" href="print-lexmark_8c.html#a47">LEXMARK_SLOT_ASF1</a> | <a class="code" href="print-lexmark_8c.html#a49">LEXMARK_SLOT_MAN1</a>,
00742     <a class="code" href="print-lexmark_8c.html#a51">LEXMARK_CAP_DMT</a>,
00743     <span class="comment">/*** printer internal parameters ***/</span>
00744     0,         <span class="comment">/* real left paper border */</span>
00745     300,       <span class="comment">/* real top paper border */</span>
00746     1200,      <span class="comment">/* horizontal resolution of ?? dpi for positioning */</span>
00747     1200,      <span class="comment">/* use a vertical resolution of 1200 dpi for positioning */</span>
00748     &amp;<a class="code" href="print-lexmark_8c.html#a103">lexmark_reslist_3200</a>,  <span class="comment">/* resolution specific parameters of 3200 */</span>
00749     <a class="code" href="print-lexmark_8c.html#a104">ink_types_3200</a>,  <span class="comment">/* supported inks */</span>
00750     <a class="code" href="print-lexmark_8c.html#a83">standard_lum_adjustment</a>, <a class="code" href="print-lexmark_8c.html#a84">standard_hue_adjustment</a>, <a class="code" href="print-lexmark_8c.html#a82">standard_sat_adjustment</a>
00751   },
00752   { <span class="comment">/*  */</span>
00753     <a class="code" href="print-lexmark_8c.html#a152a115">m_lex7500</a>,
00754     618, 936,      <span class="comment">/* 8.58" x 13 " */</span>
00755     <a class="code" href="print-escp2-data_8c.html#a0">INCH</a>(2), <a class="code" href="print-escp2-data_8c.html#a0">INCH</a>(4), <span class="comment">/* min paper size */</span>
00756     2400, 1200, 2,
00757     11, 9, 10, 18,
00758     <a class="code" href="print-lexmark_8c.html#a40">LEXMARK_INK_CMY</a> | <a class="code" href="print-lexmark_8c.html#a41">LEXMARK_INK_CMYK</a> | <a class="code" href="print-lexmark_8c.html#a42">LEXMARK_INK_CcMmYK</a>,
00759     <a class="code" href="print-lexmark_8c.html#a47">LEXMARK_SLOT_ASF1</a> | <a class="code" href="print-lexmark_8c.html#a49">LEXMARK_SLOT_MAN1</a>,
00760     <a class="code" href="print-lexmark_8c.html#a51">LEXMARK_CAP_DMT</a>,
00761     <span class="comment">/*** printer internal parameters ***/</span>
00762     0,         <span class="comment">/* real left paper border */</span>
00763     300,       <span class="comment">/* real top paper border */</span>
00764     1200,      <span class="comment">/* horizontal resolutio of ??? dpi for positioning */</span>
00765     1200,      <span class="comment">/* use a vertical resolution of 1200 dpi for positioning */</span>
00766     &amp;<a class="code" href="print-lexmark_8c.html#a103">lexmark_reslist_3200</a>,  <span class="comment">/* resolution specific parameters of ?? */</span>
00767     <a class="code" href="print-lexmark_8c.html#a104">ink_types_3200</a>,  <span class="comment">/* supported inks */</span>
00768     <a class="code" href="print-lexmark_8c.html#a83">standard_lum_adjustment</a>, <a class="code" href="print-lexmark_8c.html#a84">standard_hue_adjustment</a>, <a class="code" href="print-lexmark_8c.html#a82">standard_sat_adjustment</a>
00769   },
00770 };
00771 
00772 
00773 
00774 
00775 
00776 <span class="keyword">typedef</span> <span class="keyword">struct </span><a class="code" href="structlexm__privdata__weave.html">lexm_privdata_weave</a> {
00777   <span class="keyword">const</span> <a class="code" href="structlexmark__inkparam__t.html">lexmark_inkparam_t</a> *<a class="code" href="structlexm__privdata__weave.html#o0">ink_parameter</a>;
00778   <span class="keywordtype">int</span>           <a class="code" href="structlexm__privdata__weave.html#o1">bidirectional</a>; <span class="comment">/* tells us if we are allowed to print bidirectional */</span>
00779   <span class="keywordtype">int</span>           <a class="code" href="structlexm__privdata__weave.html#o2">direction</a>;     <span class="comment">/* stores the last direction or print head */</span>
00780   <span class="keywordtype">int</span>           <a class="code" href="structlexm__privdata__weave.html#o3">hoffset</a>;
00781   <span class="keywordtype">int</span> <a class="code" href="structlexm__privdata__weave.html#o4">model</a>;
<a name="l00782"></a><a class="code" href="structlexm__privdata__weave.html">00782</a>   <span class="keywordtype">int</span> width;
<a name="l00783"></a><a class="code" href="structlexm__privdata__weave.html#o0">00783</a>   <span class="keywordtype">int</span> ydpi;
<a name="l00784"></a><a class="code" href="structlexm__privdata__weave.html#o1">00784</a>   <span class="keywordtype">int</span> xdpi;
<a name="l00785"></a><a class="code" href="structlexm__privdata__weave.html#o2">00785</a>   <span class="keywordtype">int</span> physical_xdpi;
<a name="l00786"></a><a class="code" href="structlexm__privdata__weave.html#o3">00786</a>   <span class="keywordtype">int</span> last_pass_offset;
<a name="l00787"></a><a class="code" href="structlexm__privdata__weave.html#o4">00787</a>   <span class="keywordtype">int</span> <a class="code" href="structlexm__privdata__weave.html#o10">jets</a>;
<a name="l00788"></a><a class="code" href="structlexm__privdata__weave.html#o5">00788</a>   <span class="keywordtype">int</span> bitwidth;
<a name="l00789"></a><a class="code" href="structlexm__privdata__weave.html#o6">00789</a>   <span class="keywordtype">int</span> ncolors;
<a name="l00790"></a><a class="code" href="structlexm__privdata__weave.html#o7">00790</a>   <span class="keywordtype">int</span> <a class="code" href="structlexm__privdata__weave.html#o13">horizontal_weave</a>;
<a name="l00791"></a><a class="code" href="structlexm__privdata__weave.html#o8">00791</a>   <span class="keywordtype">unsigned</span> <span class="keywordtype">char</span> *<a class="code" href="structlexm__privdata__weave.html#o14">outbuf</a>;
<a name="l00792"></a><a class="code" href="structlexm__privdata__weave.html#o9">00792</a> } <a class="code" href="structlexm__privdata__weave.html">lexm_privdata_weave</a>;
<a name="l00793"></a><a class="code" href="structlexm__privdata__weave.html#o10">00793</a> 
<a name="l00794"></a><a class="code" href="structlexm__privdata__weave.html#o11">00794</a> 
<a name="l00795"></a><a class="code" href="structlexm__privdata__weave.html#o12">00795</a> <span class="comment">/*</span>
<a name="l00796"></a><a class="code" href="structlexm__privdata__weave.html#o13">00796</a> <span class="comment"> * internal functions</span>
<a name="l00797"></a><a class="code" href="structlexm__privdata__weave.html#o14">00797</a> <span class="comment"> */</span>
00798 <span class="keyword">static</span> <span class="keywordtype">int</span> <a class="code" href="print-lexmark_8c.html#a122">model_to_index</a>(<span class="keywordtype">int</span> model)
00799 {
00800   <span class="keywordtype">int</span> i;
00801   <span class="keywordtype">int</span> models= <span class="keyword">sizeof</span>(<a class="code" href="print-lexmark_8c.html#a105">lexmark_model_capabilities</a>) / <span class="keyword">sizeof</span>(<a class="code" href="structlexmark__cap__t.html">lexmark_cap_t</a>);
00802   <span class="keywordflow">for</span> (i=0; i&lt;models; i++) {
00803     <span class="keywordflow">if</span> (<a class="code" href="print-lexmark_8c.html#a105">lexmark_model_capabilities</a>[i].<a class="code" href="structlexmark__cap__t.html#o0">model</a> == model) {
<a name="l00804"></a><a class="code" href="print-lexmark_8c.html#a122">00804</a>       <span class="keywordflow">return</span> i;
00805     }
00806   }
00807   <span class="keywordflow">return</span> -1;
00808 }
00809 
00810 
00811 <span class="keyword">static</span> <span class="keyword">const</span> <a class="code" href="structlexmark__cap__t.html">lexmark_cap_t</a> *
00812 <a class="code" href="print-lexmark_8c.html#a123">lexmark_get_model_capabilities</a>(<span class="keywordtype">int</span> model)
00813 {
00814   <span class="keywordtype">int</span> i = <a class="code" href="print-lexmark_8c.html#a122">model_to_index</a>(model);
00815 
00816   <span class="keywordflow">if</span> (i != -1) {
00817     <span class="keywordflow">return</span> &amp;(<a class="code" href="print-lexmark_8c.html#a105">lexmark_model_capabilities</a>[i]);
<a name="l00818"></a><a class="code" href="print-lexmark_8c.html#a123">00818</a>   }
00819 <span class="preprocessor">#ifdef DEBUG</span>
00820 <span class="preprocessor"></span>  <a class="code" href="print-util_8c.html#a20">stp_erprintf</a>(<span class="stringliteral">"lexmark: model %d not found in capabilities list.\n"</span>,model);
00821 <span class="preprocessor">#endif</span>
00822 <span class="preprocessor"></span>  <span class="keywordflow">return</span> &amp;(<a class="code" href="print-lexmark_8c.html#a105">lexmark_model_capabilities</a>[0]);
00823 }
00824 
00825 
00826 
00827 <span class="keyword">typedef</span> <span class="keyword">struct</span>
00828 <span class="keyword"></span>{
00829   <span class="keyword">const</span> <span class="keywordtype">char</span> *name;
00830   <span class="keyword">const</span> <span class="keywordtype">char</span> *text;
00831   <span class="keywordtype">int</span> paper_feed_sequence;
00832   <span class="keywordtype">int</span> platen_gap;
00833   <span class="keywordtype">double</span> base_density;
00834   <span class="keywordtype">double</span> k_lower_scale;
<a name="l00835"></a><a class="code" href="structpaper__t.html#o19">00835</a>   <span class="keywordtype">double</span> k_upper;
<a name="l00836"></a><a class="code" href="structpaper__t.html#o20">00836</a>   <span class="keywordtype">double</span> cyan;
<a name="l00837"></a><a class="code" href="structpaper__t.html#o21">00837</a>   <span class="keywordtype">double</span> magenta;
<a name="l00838"></a><a class="code" href="structpaper__t.html#o22">00838</a>   <span class="keywordtype">double</span> yellow;
<a name="l00839"></a><a class="code" href="structpaper__t.html#o3">00839</a>   <span class="keywordtype">double</span> p_cyan;
<a name="l00840"></a><a class="code" href="structpaper__t.html#o4">00840</a>   <span class="keywordtype">double</span> p_magenta;
<a name="l00841"></a><a class="code" href="structpaper__t.html#o5">00841</a>   <span class="keywordtype">double</span> p_yellow;
<a name="l00842"></a><a class="code" href="structpaper__t.html#o23">00842</a>   <span class="keywordtype">double</span> saturation;
<a name="l00843"></a><a class="code" href="structpaper__t.html#o24">00843</a>   <span class="keywordtype">double</span> gamma;
<a name="l00844"></a><a class="code" href="structpaper__t.html#o25">00844</a>   <span class="keywordtype">int</span> feed_adjustment;
<a name="l00845"></a><a class="code" href="structpaper__t.html#o26">00845</a>   <span class="keywordtype">int</span> vacuum_intensity;
<a name="l00846"></a><a class="code" href="structpaper__t.html#o27">00846</a>   <span class="keywordtype">int</span> paper_thickness;
<a name="l00847"></a><a class="code" href="structpaper__t.html#o28">00847</a>   <span class="keyword">const</span> <span class="keywordtype">char</span> *hue_adjustment;
<a name="l00848"></a><a class="code" href="structpaper__t.html#o29">00848</a>   <span class="keyword">const</span> <span class="keywordtype">char</span> *lum_adjustment;
<a name="l00849"></a><a class="code" href="structpaper__t.html#o30">00849</a>   <span class="keyword">const</span> <span class="keywordtype">char</span> *sat_adjustment;
<a name="l00850"></a><a class="code" href="structpaper__t.html#o31">00850</a> } <a class="code" href="structpaper__t.html">paper_t</a>;
<a name="l00851"></a><a class="code" href="structpaper__t.html#o32">00851</a> 
<a name="l00852"></a><a class="code" href="structpaper__t.html#o33">00852</a> 
<a name="l00853"></a><a class="code" href="structpaper__t.html#o34">00853</a> 
<a name="l00854"></a><a class="code" href="structpaper__t.html#o35">00854</a> <span class="keyword">static</span> <span class="keyword">const</span> <a class="code" href="structpaper__t.html">paper_t</a> <a class="code" href="print-lexmark_8c.html#a107">lexmark_paper_list</a>[] =
<a name="l00855"></a><a class="code" href="structpaper__t.html#o36">00855</a> {
00856   { <span class="stringliteral">"Plain"</span>, <a class="code" href="group__intl__internal.html#ga6">N_</a>(<span class="stringliteral">"Plain Paper"</span>),
00857     1, 0, 0.80, .1, .5, 1.0, 1.0, 1.0, .9, 1.05, 1.15,
00858     1, 1.0, 0x6b, 0x1a, 0x01,
00859     <a class="code" href="print-lexmark_8c.html#a84">standard_hue_adjustment</a>, <a class="code" href="print-lexmark_8c.html#a83">standard_lum_adjustment</a>, <a class="code" href="print-lexmark_8c.html#a82">standard_sat_adjustment</a>},
<a name="l00860"></a><a class="code" href="print-lexmark_8c.html#a107">00860</a>   { <span class="stringliteral">"GlossyFilm"</span>, <a class="code" href="group__intl__internal.html#ga6">N_</a>(<span class="stringliteral">"Glossy Film"</span>),
00861     3, 0, 1.00 ,1, .999, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0,
00862     1, 1.0, 0x6d, 0x00, 0x01,
00863     <a class="code" href="print-lexmark_8c.html#a84">standard_hue_adjustment</a>, <a class="code" href="print-lexmark_8c.html#a83">standard_lum_adjustment</a>, <a class="code" href="print-lexmark_8c.html#a82">standard_sat_adjustment</a>},
00864   { <span class="stringliteral">"Transparency"</span>, <a class="code" href="group__intl__internal.html#ga6">N_</a>(<span class="stringliteral">"Transparencies"</span>),
00865     3, 0, 1.00, 1, .999, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0,
00866     1.0, 1.0, 0x6d, 0x00, 0x02,
00867     <a class="code" href="print-lexmark_8c.html#a84">standard_hue_adjustment</a>, <a class="code" href="print-lexmark_8c.html#a83">standard_lum_adjustment</a>, <a class="code" href="print-lexmark_8c.html#a82">standard_sat_adjustment</a>},
00868   { <span class="stringliteral">"Envelope"</span>, <a class="code" href="group__intl__internal.html#ga6">N_</a>(<span class="stringliteral">"Envelopes"</span>),
00869     4, 0, 0.80, .125, .5, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0,
00870     1, 1.0, 0x6b, 0x1a, 0x01,
00871     <a class="code" href="print-lexmark_8c.html#a84">standard_hue_adjustment</a>, <a class="code" href="print-lexmark_8c.html#a83">standard_lum_adjustment</a>, <a class="code" href="print-lexmark_8c.html#a82">standard_sat_adjustment</a>},
00872   { <span class="stringliteral">"Matte"</span>, <a class="code" href="group__intl__internal.html#ga6">N_</a>(<span class="stringliteral">"Matte Paper"</span>),
00873     7, 0, 0.85, 1.0, .999, 1.05, .9, 1.05, .9, 1.0, 1.1,
00874     1, 1.0, 0x00, 0x00, 0x02,
00875     <a class="code" href="print-lexmark_8c.html#a84">standard_hue_adjustment</a>, <a class="code" href="print-lexmark_8c.html#a82">standard_sat_adjustment</a>, <a class="code" href="print-lexmark_8c.html#a82">standard_sat_adjustment</a>},
00876   { <span class="stringliteral">"Inkjet"</span>, <a class="code" href="group__intl__internal.html#ga6">N_</a>(<span class="stringliteral">"Inkjet Paper"</span>),
00877     7, 0, 0.85, .25, .6, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0,
00878     1, 1.0, 0x6b, 0x1a, 0x01,
00879     <a class="code" href="print-lexmark_8c.html#a84">standard_hue_adjustment</a>, <a class="code" href="print-lexmark_8c.html#a83">standard_lum_adjustment</a>, <a class="code" href="print-lexmark_8c.html#a82">standard_sat_adjustment</a>},
00880   { <span class="stringliteral">"Coated"</span>, <a class="code" href="group__intl__internal.html#ga6">N_</a>(<span class="stringliteral">"Photo Quality Inkjet Paper"</span>),
00881     7, 0, 1.00, 1.0, .999, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0,
00882     1, 1.0, 0x6b, 0x1a, 0x01,
00883     <a class="code" href="print-lexmark_8c.html#a84">standard_hue_adjustment</a>, <a class="code" href="print-lexmark_8c.html#a83">standard_lum_adjustment</a>, <a class="code" href="print-lexmark_8c.html#a82">standard_sat_adjustment</a>},
00884   { <span class="stringliteral">"Photo"</span>, <a class="code" href="group__intl__internal.html#ga6">N_</a>(<span class="stringliteral">"Photo Paper"</span>),
00885     8, 0, 1.00, 1.0, .9, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0,
00886     1, 1.0, 0x67, 0x00, 0x02,
00887     <a class="code" href="print-lexmark_8c.html#a84">standard_hue_adjustment</a>, <a class="code" href="print-lexmark_8c.html#a83">standard_lum_adjustment</a>, <a class="code" href="print-lexmark_8c.html#a82">standard_sat_adjustment</a>},
00888   { <span class="stringliteral">"GlossyPhoto"</span>, <a class="code" href="group__intl__internal.html#ga6">N_</a>(<span class="stringliteral">"Premium Glossy Photo Paper"</span>),
00889     8, 0, 1.10, 1, .999, 1.0, 1.0, 1.0, 1.0, 1.03, 1.0,
00890     1, 1.0, 0x80, 0x00, 0x02,
00891     <a class="code" href="print-lexmark_8c.html#a84">standard_hue_adjustment</a>, <a class="code" href="print-lexmark_8c.html#a83">standard_lum_adjustment</a>, <a class="code" href="print-lexmark_8c.html#a82">standard_sat_adjustment</a>},
00892   { <span class="stringliteral">"Luster"</span>, <a class="code" href="group__intl__internal.html#ga6">N_</a>(<span class="stringliteral">"Premium Luster Photo Paper"</span>),
00893     8, 0, 1.00, 1, .999, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0,
00894     1.0, 1.0, 0x80, 0x00, 0x02,
00895     <a class="code" href="print-lexmark_8c.html#a84">standard_hue_adjustment</a>, <a class="code" href="print-lexmark_8c.html#a83">standard_lum_adjustment</a>, <a class="code" href="print-lexmark_8c.html#a82">standard_sat_adjustment</a>},
00896   { <span class="stringliteral">"GlossyPaper"</span>, <a class="code" href="group__intl__internal.html#ga6">N_</a>(<span class="stringliteral">"Photo Quality Glossy Paper"</span>),
00897     6, 0, 1.00, 1, .999, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0,
00898     1.0, 1.0, 0x6b, 0x1a, 0x01,
00899     <a class="code" href="print-lexmark_8c.html#a84">standard_hue_adjustment</a>, <a class="code" href="print-lexmark_8c.html#a83">standard_lum_adjustment</a>, <a class="code" href="print-lexmark_8c.html#a82">standard_sat_adjustment</a>},
00900   { <span class="stringliteral">"Ilford"</span>, <a class="code" href="group__intl__internal.html#ga6">N_</a>(<span class="stringliteral">"Ilford Heavy Paper"</span>),
00901     8, 0, .85, .5, 1.35, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0,
00902     1, 1.0, 0x80, 0x00, 0x02,
00903     <a class="code" href="print-lexmark_8c.html#a84">standard_hue_adjustment</a>, <a class="code" href="print-lexmark_8c.html#a83">standard_lum_adjustment</a>, <a class="code" href="print-lexmark_8c.html#a82">standard_sat_adjustment</a>},
00904   { <span class="stringliteral">"Other"</span>, <a class="code" href="group__intl__internal.html#ga6">N_</a>(<span class="stringliteral">"Other"</span>),
00905     0, 0, 0.80, 0.125, .5, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0,
00906     1, 1.0, 0x6b, 0x1a, 0x01,
00907     <a class="code" href="print-lexmark_8c.html#a84">standard_hue_adjustment</a>, <a class="code" href="print-lexmark_8c.html#a83">standard_lum_adjustment</a>, <a class="code" href="print-lexmark_8c.html#a82">standard_sat_adjustment</a>},
00908 };
00909 
00910 <span class="keyword">static</span> <span class="keyword">const</span> <span class="keywordtype">int</span> <a class="code" href="print-lexmark_8c.html#a108">paper_type_count</a> = <span class="keyword">sizeof</span>(<a class="code" href="print-lexmark_8c.html#a107">lexmark_paper_list</a>) / <span class="keyword">sizeof</span>(<a class="code" href="structpaper__t.html">paper_t</a>);
00911 
00912 <span class="keyword">static</span> <span class="keyword">const</span> <a class="code" href="structlexmark__inkname__t.html">lexmark_inkname_t</a> *
00913 <a class="code" href="print-lexmark_8c.html#a124">lexmark_get_ink_type</a>(<span class="keyword">const</span> <span class="keywordtype">char</span> *name, <span class="keywordtype">int</span> printing_color, <span class="keyword">const</span> <a class="code" href="structlexmark__cap__t.html">lexmark_cap_t</a> * caps)
00914 {
00915   <span class="keywordtype">int</span> i = 0;
<a name="l00916"></a><a class="code" href="print-lexmark_8c.html#a108">00916</a>   <span class="keyword">const</span> <a class="code" href="structlexmark__inkname__t.html">lexmark_inkname_t</a> *ink_type = caps-&gt;<a class="code" href="structlexmark__cap__t.html#o20">ink_types</a>;
00917 
00918   <span class="keywordflow">if</span> (name)
<a name="l00919"></a><a class="code" href="print-lexmark_8c.html#a124">00919</a>     <span class="keywordflow">for</span> (i=0; ((ink_type[i].<a class="code" href="structlexmark__inkname__t.html#o0">name</a> != NULL) &amp;&amp;
00920                (strcmp(name, ink_type[i].name)  != 0)); i++) ;
00921   <span class="keywordflow">return</span> &amp;(ink_type[i]);
00922 
00923 }
00924 
00925 <span class="keyword">static</span> <span class="keyword">const</span> <a class="code" href="structlexmark__inkparam__t.html">lexmark_inkparam_t</a> *
00926 <a class="code" href="print-lexmark_8c.html#a125">lexmark_get_ink_parameter</a>(<span class="keyword">const</span> <span class="keywordtype">char</span> *name, <span class="keywordtype">int</span> printing_color, <span class="keyword">const</span> <a class="code" href="structlexmark__cap__t.html">lexmark_cap_t</a> * caps, <span class="keyword">const</span> <a class="code" href="structstp__vars.html">stp_vars_t</a> *nv)
00927 {
00928   <span class="keyword">const</span> <a class="code" href="structlexmark__inkname__t.html">lexmark_inkname_t</a> *ink_type = <a class="code" href="print-lexmark_8c.html#a124">lexmark_get_ink_type</a>(name, printing_color, caps);
00929 
00930   <span class="keywordflow">if</span> (ink_type-&gt;<a class="code" href="structlexmark__inkname__t.html#o0">name</a> == NULL) {
00931     <span class="keywordflow">return</span> (NULL); <span class="comment">/* not found ! */</span>
<a name="l00932"></a><a class="code" href="print-lexmark_8c.html#a125">00932</a>   }
00933 
00934   <span class="keywordflow">return</span> &amp;(ink_type-&gt;<a class="code" href="structlexmark__inkname__t.html#o2">ink_parameter</a>[printing_color]);
00935 }
00936 
00937 
00938 <span class="keyword">static</span> <span class="keyword">const</span> <a class="code" href="structpaper__t.html">paper_t</a> *
00939 <a class="code" href="print-lexmark_8c.html#a126">get_media_type</a>(<span class="keyword">const</span> <span class="keywordtype">char</span> *name, <span class="keyword">const</span> <a class="code" href="structlexmark__cap__t.html">lexmark_cap_t</a> * caps)
00940 {
00941   <span class="keywordtype">int</span> i;
00942   <span class="keywordflow">if</span> (name)
00943     {
00944       <span class="keywordflow">for</span> (i = 0; i &lt; <a class="code" href="print-lexmark_8c.html#a108">paper_type_count</a>; i++)
<a name="l00945"></a><a class="code" href="print-lexmark_8c.html#a126">00945</a>         {
00946           <span class="keywordflow">if</span> (!strcmp(name, <a class="code" href="print-lexmark_8c.html#a107">lexmark_paper_list</a>[i].name))
00947             <span class="keywordflow">return</span> &amp;(<a class="code" href="print-lexmark_8c.html#a107">lexmark_paper_list</a>[i]);
00948         }
00949     }
00950   <span class="keywordflow">return</span> NULL;
00951 }
00952 
00953 <span class="keyword">static</span> <span class="keywordtype">int</span>
00954 <a class="code" href="print-lexmark_8c.html#a127">lexmark_source_type</a>(<span class="keyword">const</span> <span class="keywordtype">char</span> *name, <span class="keyword">const</span> <a class="code" href="structlexmark__cap__t.html">lexmark_cap_t</a> * caps)
00955 {
00956   <span class="keywordflow">if</span> (name)
00957     {
00958       <span class="keywordflow">if</span> (!strcmp(name,<span class="stringliteral">"Auto"</span>))    <span class="keywordflow">return</span> 4;
00959       <span class="keywordflow">if</span> (!strcmp(name,<span class="stringliteral">"Manual"</span>))    <span class="keywordflow">return</span> 0;
<a name="l00960"></a><a class="code" href="print-lexmark_8c.html#a127">00960</a>       <span class="keywordflow">if</span> (!strcmp(name,<span class="stringliteral">"ManualNP"</span>)) <span class="keywordflow">return</span> 1;
00961     }
00962 
00963 <span class="preprocessor">#ifdef DEBUG</span>
00964 <span class="preprocessor"></span>  <a class="code" href="print-util_8c.html#a20">stp_erprintf</a>(<span class="stringliteral">"lexmark: Unknown source type '%s' - reverting to auto\n"</span>,name);
00965 <span class="preprocessor">#endif</span>
00966 <span class="preprocessor"></span>  <span class="keywordflow">return</span> 4;
00967 }
00968 
00969 
00970 
00971 <span class="comment">/*******************************</span>
00972 <span class="comment">lexmark_head_offset</span>
00973 <span class="comment">*******************************/</span>
00974 <span class="keyword">static</span> <span class="keyword">const</span> <a class="code" href="unionlexmark__lineoff__t.html">lexmark_lineoff_t</a> *
00975 <a class="code" href="print-lexmark_8c.html#a128">lexmark_head_offset</a>(<span class="keywordtype">int</span> ydpi,                       <span class="comment">/* i */</span>
00976                     <span class="keyword">const</span> <span class="keywordtype">char</span> *ink_type,           <span class="comment">/* i */</span>
00977                     <span class="keyword">const</span> <a class="code" href="structlexmark__cap__t.html">lexmark_cap_t</a> * caps,     <span class="comment">/* i */</span>
00978                     <span class="keyword">const</span> <a class="code" href="structlexmark__inkparam__t.html">lexmark_inkparam_t</a> *ink_parameter, <span class="comment">/* i */</span>
00979                     <a class="code" href="unionlexmark__lineoff__t.html">lexmark_lineoff_t</a> *lineoff_buffer)  <span class="comment">/* o */</span>
00980 {
<a name="l00981"></a><a class="code" href="print-lexmark_8c.html#a128">00981</a>   <span class="keywordtype">int</span> i;
00982 
00983 <span class="preprocessor">#ifdef DEBUG</span>
00984 <span class="preprocessor"></span>  <a class="code" href="print-util_8c.html#a20">stp_erprintf</a>(<span class="stringliteral">"  sizie %d,  size_v %d, size_v[0] %d\n"</span>, <span class="keyword">sizeof</span>(*lineoff_buffer), <span class="keyword">sizeof</span>(lineoff_buffer-&gt;v), <span class="keyword">sizeof</span>(lineoff_buffer-&gt;v[0]));
00985 <span class="preprocessor">#endif</span>
00986 <span class="preprocessor"></span>  memcpy(lineoff_buffer, ink_parameter-&gt;<a class="code" href="structlexmark__inkparam__t.html#o6">head_offset</a>, <span class="keyword">sizeof</span>(*lineoff_buffer));
00987 
00988   <span class="keywordflow">for</span> (i=0; i &lt; (<span class="keyword">sizeof</span>(lineoff_buffer-&gt;v) / <span class="keyword">sizeof</span>(lineoff_buffer-&gt;v[0])); i++) {
00989     lineoff_buffer-&gt;v[i] /= (caps-&gt;<a class="code" href="structlexmark__cap__t.html#o18">y_raster_res</a> / ydpi);
00990   }
00991   <span class="keywordflow">return</span> (lineoff_buffer);
00992 }
00993 
00994 
00995 <span class="preprocessor">#if 0</span>
00996 <span class="preprocessor"></span><span class="comment">/*******************************</span>
00997 <span class="comment">lexmark_size_type</span>
00998 <span class="comment">*******************************/</span>
00999 <span class="comment">/* This method is actually not used.</span>
01000 <span class="comment">   Is there a possibility to set such value ???????????? */</span>
01001 <span class="keyword">static</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">char</span>
01002 lexmark_size_type(<span class="keyword">const</span> <a class="code" href="structstp__vars.html">stp_vars_t</a> *v, <span class="keyword">const</span> <a class="code" href="structlexmark__cap__t.html">lexmark_cap_t</a> * caps)
01003 {
01004   <span class="keyword">const</span> <a class="code" href="structstp__papersize__t.html">stp_papersize_t</a> *pp = <a class="code" href="group__papersize.html#ga12">stp_get_papersize_by_size</a>(<a class="code" href="group__vars.html#ga28">stp_get_page_height</a>(v),
01005                                                         <a class="code" href="group__vars.html#ga26">stp_get_page_width</a>(v));
01006   <span class="keywordflow">if</span> (pp)
01007     {
01008       <span class="keyword">const</span> <span class="keywordtype">char</span> *name = pp-&gt;<a class="code" href="structstp__papersize__t.html#o0">name</a>;
01009       <span class="comment">/* built ins: */</span>
01010       <span class="keywordflow">if</span> (!strcmp(name,<span class="stringliteral">"A5"</span>))           <span class="keywordflow">return</span> 0x01;
01011       <span class="keywordflow">if</span> (!strcmp(name,<span class="stringliteral">"A4"</span>))           <span class="keywordflow">return</span> 0x03;
01012       <span class="keywordflow">if</span> (!strcmp(name,<span class="stringliteral">"B5"</span>))           <span class="keywordflow">return</span> 0x08;
01013       <span class="keywordflow">if</span> (!strcmp(name,<span class="stringliteral">"Letter"</span>))       <span class="keywordflow">return</span> 0x0d;
01014       <span class="keywordflow">if</span> (!strcmp(name,<span class="stringliteral">"Legal"</span>))        <span class="keywordflow">return</span> 0x0f;
01015       <span class="keywordflow">if</span> (!strcmp(name,<span class="stringliteral">"COM10"</span>))        <span class="keywordflow">return</span> 0x16;
01016       <span class="keywordflow">if</span> (!strcmp(name,<span class="stringliteral">"DL"</span>))           <span class="keywordflow">return</span> 0x17;
01017       <span class="keywordflow">if</span> (!strcmp(name,<span class="stringliteral">"LetterExtra"</span>))  <span class="keywordflow">return</span> 0x2a;
01018       <span class="keywordflow">if</span> (!strcmp(name,<span class="stringliteral">"A4Extra"</span>))      <span class="keywordflow">return</span> 0x2b;
01019       <span class="keywordflow">if</span> (!strcmp(name,<span class="stringliteral">"w288h144"</span>))     <span class="keywordflow">return</span> 0x2d;
01020       <span class="comment">/* custom */</span>
01021 
01022 <span class="preprocessor">#ifdef DEBUG</span>
01023 <span class="preprocessor"></span>      <a class="code" href="print-util_8c.html#a20">stp_erprintf</a>(<span class="stringliteral">"lexmark: Unknown paper size '%s' - using custom\n"</span>,name);
01024     } <span class="keywordflow">else</span> {
01025       <a class="code" href="print-util_8c.html#a20">stp_erprintf</a>(<span class="stringliteral">"lexmark: Couldn't look up paper size %dx%d - "</span>
01026               <span class="stringliteral">"using custom\n"</span>,<a class="code" href="group__vars.html#ga28">stp_get_page_height</a>(v), <a class="code" href="group__vars.html#ga26">stp_get_page_width</a>(v));
01027 <span class="preprocessor">#endif</span>
01028 <span class="preprocessor"></span>    }
01029   <span class="keywordflow">return</span> 0;
01030 }
01031 <span class="preprocessor">#endif</span>
01032 <span class="preprocessor"></span>
01033 
01034 <span class="keyword">static</span> <span class="keywordtype">int</span> <a class="code" href="print-lexmark_8c.html#a129">lexmark_get_phys_resolution_vertical</a>(<span class="keywordtype">int</span> model)
01035 {
01036   <span class="keywordflow">return</span> 600;
01037 }
01038 
01039 <span class="preprocessor">#if 0</span>
<a name="l01040"></a><a class="code" href="print-lexmark_8c.html#a129">01040</a> <span class="preprocessor"></span><span class="keyword">static</span> <span class="keywordtype">int</span> lexmark_get_phys_resolution_horizontal(<span class="keywordtype">int</span> model)
01041 {
01042   <span class="keywordflow">return</span> 1200;
01043 }
01044 <span class="preprocessor">#endif</span>
01045 <span class="preprocessor"></span>
01046 <span class="keyword">static</span> <span class="keyword">const</span> <a class="code" href="structlexmark__res__t.html">lexmark_res_t</a>
01047 *<a class="code" href="print-lexmark_8c.html#a130">lexmark_get_resolution_para</a>(<span class="keywordtype">int</span> model, <span class="keyword">const</span> <span class="keywordtype">char</span> *resolution)
01048 {
01049   <span class="keyword">const</span> <a class="code" href="structlexmark__cap__t.html">lexmark_cap_t</a> * caps= <a class="code" href="print-lexmark_8c.html#a123">lexmark_get_model_capabilities</a>(model);
01050 
01051   <span class="keyword">const</span> <a class="code" href="structlexmark__res__t.html">lexmark_res_t</a> *res = *(caps-&gt;<a class="code" href="structlexmark__cap__t.html#o19">res_parameters</a>); <span class="comment">/* get the resolution specific parameters of printer */</span>
01052 
<a name="l01053"></a><a class="code" href="print-lexmark_8c.html#a130">01053</a>   <span class="keywordflow">if</span> (resolution)
01054     {
01055       <span class="keywordflow">while</span> (res-&gt;<a class="code" href="structlexmark__res__t.html#o2">hres</a>)
01056         {
01057           <span class="keywordflow">if</span> ((res-&gt;<a class="code" href="structlexmark__res__t.html#o3">vres</a> &lt;= caps-&gt;<a class="code" href="structlexmark__cap__t.html#o6">max_ydpi</a>) &amp;&amp; (caps-&gt;<a class="code" href="structlexmark__cap__t.html#o6">max_ydpi</a> != -1) &amp;&amp;
01058               (res-&gt;<a class="code" href="structlexmark__res__t.html#o2">hres</a> &lt;= caps-&gt;<a class="code" href="structlexmark__cap__t.html#o5">max_xdpi</a>) &amp;&amp; (caps-&gt;<a class="code" href="structlexmark__cap__t.html#o5">max_xdpi</a> != -1) &amp;&amp;
01059               (!strcmp(resolution, res-&gt;<a class="code" href="structlexmark__res__t.html#o0">name</a>)))
01060             {
01061               <span class="keywordflow">return</span> res;
01062             }
01063           res++;
01064         }
01065     }
01066   <a class="code" href="print-util_8c.html#a20">stp_erprintf</a>(<span class="stringliteral">"lexmark_get_resolution_para: resolution not found (%s)\n"</span>, resolution);
01067   <span class="keywordflow">return</span> NULL;
01068 }
01069 
01070 
01071 <span class="keyword">static</span> <span class="keywordtype">int</span>
01072 <a class="code" href="print-lexmark_8c.html#a131">lexmark_print_bidirectional</a>(<span class="keywordtype">int</span> model, <span class="keyword">const</span> <span class="keywordtype">char</span> *resolution)
01073 {
01074   <span class="keyword">const</span> <a class="code" href="structlexmark__res__t.html">lexmark_res_t</a> *res_para = <a class="code" href="print-lexmark_8c.html#a130">lexmark_get_resolution_para</a>(model, resolution);
01075   <span class="keywordflow">return</span> !res_para-&gt;<a class="code" href="structlexmark__res__t.html#o7">unidirectional</a>;
01076 }
01077 
<a name="l01078"></a><a class="code" href="print-lexmark_8c.html#a131">01078</a> <span class="keyword">static</span> <span class="keyword">const</span> <span class="keywordtype">char</span> *
01079 <a class="code" href="print-lexmark_8c.html#a132">lexmark_lum_adjustment</a>(<span class="keyword">const</span> <a class="code" href="structlexmark__cap__t.html">lexmark_cap_t</a> * caps, <span class="keyword">const</span> <a class="code" href="structstp__vars.html">stp_vars_t</a> *v)
01080 {
01081   <span class="keywordflow">return</span> (caps-&gt;<a class="code" href="structlexmark__cap__t.html#o21">lum_adjustment</a>);
01082 }
01083 
01084 <span class="keyword">static</span> <span class="keyword">const</span> <span class="keywordtype">char</span> *
<a name="l01085"></a><a class="code" href="print-lexmark_8c.html#a132">01085</a> <a class="code" href="print-lexmark_8c.html#a133">lexmark_hue_adjustment</a>(<span class="keyword">const</span> <a class="code" href="structlexmark__cap__t.html">lexmark_cap_t</a> * caps, <span class="keyword">const</span> <a class="code" href="structstp__vars.html">stp_vars_t</a> *v)
01086 {
01087   <span class="keywordflow">return</span> (caps-&gt;<a class="code" href="structlexmark__cap__t.html#o22">hue_adjustment</a>);
01088 }
01089 
01090 <span class="keyword">static</span> <span class="keyword">const</span> <span class="keywordtype">char</span> *
<a name="l01091"></a><a class="code" href="print-lexmark_8c.html#a133">01091</a> <a class="code" href="print-lexmark_8c.html#a134">lexmark_sat_adjustment</a>(<span class="keyword">const</span> <a class="code" href="structlexmark__cap__t.html">lexmark_cap_t</a> * caps, <span class="keyword">const</span> <a class="code" href="structstp__vars.html">stp_vars_t</a> *v)
01092 {
01093   <span class="keywordflow">return</span> (caps-&gt;<a class="code" href="structlexmark__cap__t.html#o23">sat_adjustment</a>);
01094 }
01095 
01096 
<a name="l01097"></a><a class="code" href="print-lexmark_8c.html#a134">01097</a> <span class="keyword">static</span> <span class="keywordtype">void</span>
01098 <a class="code" href="print-lexmark_8c.html#a135">lexmark_describe_resolution</a>(<span class="keyword">const</span> <a class="code" href="structstp__vars.html">stp_vars_t</a> *v, <span class="keywordtype">int</span> *x, <span class="keywordtype">int</span> *y)
01099 {
01100   <span class="keyword">const</span> <span class="keywordtype">char</span> *resolution = <a class="code" href="group__vars.html#ga36">stp_get_string_parameter</a>(v, <span class="stringliteral">"Resolution"</span>);
01101   <span class="keyword">const</span> <a class="code" href="structlexmark__res__t.html">lexmark_res_t</a> *res =
01102     <a class="code" href="print-lexmark_8c.html#a130">lexmark_get_resolution_para</a>(<a class="code" href="group__printer.html#ga23">stp_get_model_id</a>(v), resolution);
01103 
<a name="l01104"></a><a class="code" href="print-lexmark_8c.html#a135">01104</a>   <span class="keywordflow">if</span> (res)
01105     {
01106       *x = res-&gt;<a class="code" href="structlexmark__res__t.html#o2">hres</a>;
01107       *y = res-&gt;<a class="code" href="structlexmark__res__t.html#o3">vres</a>;
01108       <span class="keywordflow">return</span>;
01109     }
01110   *x = -1;
01111   *y = -1;
01112 }
01113 
01114 
01115 <span class="keyword">static</span> <a class="code" href="structstp__param__string__t.html">stp_param_string_t</a> <a class="code" href="print-lexmark_8c.html#a109">media_sources</a>[] =
01116 {
01117   { <span class="stringliteral">"Auto"</span>,             <a class="code" href="group__intl__internal.html#ga6">N_</a>(<span class="stringliteral">"Auto Sheet Feeder"</span>) },
01118   { <span class="stringliteral">"Manual"</span>,           <a class="code" href="group__intl__internal.html#ga6">N_</a>(<span class="stringliteral">"Manual with Pause"</span>) },
01119   { <span class="stringliteral">"ManualNP"</span>,         <a class="code" href="group__intl__internal.html#ga6">N_</a>(<span class="stringliteral">"Manual without Pause"</span>) }
01120 };
<a name="l01121"></a><a class="code" href="print-lexmark_8c.html#a109">01121</a> 
01122 
01123 <span class="comment">/*</span>
01124 <span class="comment"> * 'lexmark_parameters()' - Return the parameter values for the given parameter.</span>
01125 <span class="comment"> */</span>
01126 
01127 <span class="keyword">static</span> <a class="code" href="group__vars.html#ga1">stp_parameter_list_t</a>
01128 <a class="code" href="print-lexmark_8c.html#a136">lexmark_list_parameters</a>(<span class="keyword">const</span> <a class="code" href="structstp__vars.html">stp_vars_t</a> *v)
01129 {
01130   <a class="code" href="group__vars.html#ga1">stp_parameter_list_t</a> *ret = <a class="code" href="group__vars.html#ga43">stp_parameter_list_create</a>();
01131   <span class="keywordtype">int</span> i;
01132   <span class="keywordflow">for</span> (i = 0; i &lt; <a class="code" href="print-lexmark_8c.html#a88">the_parameter_count</a>; i++)
01133     <a class="code" href="group__vars.html#ga82">stp_parameter_list_add_param</a>(ret, &amp;(<a class="code" href="print-lexmark_8c.html#a87">the_parameters</a>[i]));
<a name="l01134"></a><a class="code" href="print-lexmark_8c.html#a136">01134</a>   <span class="keywordflow">for</span> (i = 0; i &lt; <a class="code" href="print-lexmark_8c.html#a90">float_parameter_count</a>; i++)
01135     <a class="code" href="group__vars.html#ga82">stp_parameter_list_add_param</a>(ret, &amp;(float_parameters[i].param));
01136   <span class="keywordflow">return</span> ret;
01137 }
01138 
01139 <span class="keyword">static</span> <span class="keyword">const</span> <span class="keywordtype">char</span> *
01140 <a class="code" href="print-lexmark_8c.html#a137">lexmark_describe_output</a>(<span class="keyword">const</span> <a class="code" href="structstp__vars.html">stp_vars_t</a> *v)
01141 {
01142   <span class="keywordtype">int</span> printing_color = 0;
01143   <span class="keywordtype">int</span> model = <a class="code" href="group__printer.html#ga23">stp_get_model_id</a>(v);
01144   <span class="keyword">const</span> <a class="code" href="structlexmark__cap__t.html">lexmark_cap_t</a> *caps = <a class="code" href="print-lexmark_8c.html#a123">lexmark_get_model_capabilities</a>(model);
01145   <span class="keyword">const</span> <span class="keywordtype">char</span> *print_mode = <a class="code" href="group__vars.html#ga36">stp_get_string_parameter</a>(v, <span class="stringliteral">"PrintingMode"</span>);
<a name="l01146"></a><a class="code" href="print-lexmark_8c.html#a137">01146</a>   <span class="keyword">const</span> <span class="keywordtype">char</span> *ink_type = <a class="code" href="group__vars.html#ga36">stp_get_string_parameter</a>(v, <span class="stringliteral">"InkType"</span>);
01147   <span class="keyword">const</span> <a class="code" href="structlexmark__inkparam__t.html">lexmark_inkparam_t</a> *ink_parameter;
01148 
01149   <span class="keywordflow">if</span> (!print_mode || strcmp(print_mode, <span class="stringliteral">"Color"</span>) == 0)
01150     printing_color = 1;
01151 
01152   ink_parameter = <a class="code" href="print-lexmark_8c.html#a125">lexmark_get_ink_parameter</a>(ink_type, printing_color, caps, v);
01153 
01154   <span class="keywordflow">if</span> (ink_parameter-&gt;<a class="code" href="structlexmark__inkparam__t.html#o1">used_colors</a> == <a class="code" href="print-lexmark_8c.html#a21">COLOR_MODE_K</a> ||
01155       caps-&gt;<a class="code" href="structlexmark__cap__t.html#o12">inks</a> == <a class="code" href="print-lexmark_8c.html#a39">LEXMARK_INK_K</a> || !printing_color)
01156     <span class="keywordflow">return</span> <span class="stringliteral">"Grayscale"</span>;
01157   <span class="keywordflow">else</span> <span class="keywordflow">if</span> (!(ink_parameter-&gt;<a class="code" href="structlexmark__inkparam__t.html#o1">used_colors</a> &amp; <a class="code" href="print-lexmark_8c.html#a21">COLOR_MODE_K</a>))
01158     <span class="keywordflow">return</span> <span class="stringliteral">"CMY"</span>;
01159   <span class="keywordflow">else</span>
01160     <span class="keywordflow">return</span> <span class="stringliteral">"CMYK"</span>;
01161 }
01162 
01163 <span class="keyword">static</span> <span class="keywordtype">void</span>
01164 <a class="code" href="print-lexmark_8c.html#a138">lexmark_parameters</a>(<span class="keyword">const</span> <a class="code" href="structstp__vars.html">stp_vars_t</a> *v, <span class="keyword">const</span> <span class="keywordtype">char</span> *name,
01165                    <a class="code" href="structstp__parameter__t.html">stp_parameter_t</a> *description)
01166 {
01167   <span class="keywordtype">int</span>           i;
01168 
01169   <span class="keyword">const</span> <a class="code" href="structlexmark__cap__t.html">lexmark_cap_t</a> * caps= <a class="code" href="print-lexmark_8c.html#a123">lexmark_get_model_capabilities</a>(<a class="code" href="group__printer.html#ga23">stp_get_model_id</a>(v));
<a name="l01170"></a><a class="code" href="print-lexmark_8c.html#a138">01170</a>   description-&gt;<a class="code" href="structstp__parameter__t.html#o4">p_type</a> = <a class="code" href="group__vars.html#gga132a16">STP_PARAMETER_TYPE_INVALID</a>;
01171 
01172   <span class="keywordflow">if</span> (name == NULL)
01173     <span class="keywordflow">return</span>;
01174 
01175   <span class="keywordflow">for</span> (i = 0; i &lt; <a class="code" href="print-lexmark_8c.html#a90">float_parameter_count</a>; i++)
01176     <span class="keywordflow">if</span> (strcmp(name, float_parameters[i].param.name) == 0)
01177       {
01178         <a class="code" href="group__vars.html#ga75">stp_fill_parameter_settings</a>(description,
01179                                     &amp;(<a class="code" href="print-lexmark_8c.html#a89">float_parameters</a>[i].param));
01180         description-&gt;<a class="code" href="structstp__parameter__t.html#o26">deflt</a>.dbl = <a class="code" href="print-lexmark_8c.html#a89">float_parameters</a>[i].<a class="code" href="structfloat__param__t.html#o3">defval</a>;
01181         description-&gt;<a class="code" href="structstp__parameter__t.html#o18">bounds</a>.dbl.upper = <a class="code" href="print-lexmark_8c.html#a89">float_parameters</a>[i].<a class="code" href="structfloat__param__t.html#o2">max</a>;
01182         description-&gt;<a class="code" href="structstp__parameter__t.html#o18">bounds</a>.dbl.lower = <a class="code" href="print-lexmark_8c.html#a89">float_parameters</a>[i].<a class="code" href="structfloat__param__t.html#o1">min</a>;
01183         <span class="keywordflow">return</span>;
01184       }
01185 
01186   <span class="keywordflow">for</span> (i = 0; i &lt; <a class="code" href="print-lexmark_8c.html#a88">the_parameter_count</a>; i++)
01187     <span class="keywordflow">if</span> (strcmp(name, the_parameters[i].name) == 0)
01188       {
01189         <a class="code" href="group__vars.html#ga75">stp_fill_parameter_settings</a>(description, &amp;(the_parameters[i]));
01190         <span class="keywordflow">break</span>;
01191       }
01192 
01193   <span class="keywordflow">if</span> (strcmp(name, <span class="stringliteral">"PageSize"</span>) == 0)
01194   {
01195     <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> height_limit, width_limit;
01196     <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> min_height_limit, min_width_limit;
01197     <span class="keywordtype">int</span> papersizes = <a class="code" href="group__papersize.html#ga0">stp_known_papersizes</a>();
01198     description-&gt;<a class="code" href="structstp__parameter__t.html#o18">bounds</a>.str = <a class="code" href="string-list_8h.html#a1">stp_string_list_create</a>();
01199 
01200     width_limit  = caps-&gt;<a class="code" href="structlexmark__cap__t.html#o1">max_paper_width</a>;
01201     height_limit = caps-&gt;<a class="code" href="structlexmark__cap__t.html#o2">max_paper_height</a>;
01202     min_width_limit  = caps-&gt;<a class="code" href="structlexmark__cap__t.html#o3">min_paper_width</a>;
01203     min_height_limit = caps-&gt;<a class="code" href="structlexmark__cap__t.html#o4">min_paper_height</a>;
01204 
01205     <span class="keywordflow">for</span> (i = 0; i &lt; papersizes; i++) {
01206       <span class="keyword">const</span> <a class="code" href="structstp__papersize__t.html">stp_papersize_t</a> *pt = <a class="code" href="group__papersize.html#ga10">stp_get_papersize_by_index</a>(i);
01207       <span class="keywordflow">if</span> (strlen(pt-&gt;<a class="code" href="structstp__papersize__t.html#o0">name</a>) &gt; 0 &amp;&amp;
01208           pt-&gt;<a class="code" href="structstp__papersize__t.html#o3">width</a> &lt;= width_limit &amp;&amp; pt-&gt;<a class="code" href="structstp__papersize__t.html#o4">height</a> &lt;= height_limit &amp;&amp;
01209           (pt-&gt;<a class="code" href="structstp__papersize__t.html#o4">height</a> &gt;= min_height_limit || pt-&gt;<a class="code" href="structstp__papersize__t.html#o4">height</a> == 0) &amp;&amp;
01210           (pt-&gt;<a class="code" href="structstp__papersize__t.html#o3">width</a> &gt;= min_width_limit || pt-&gt;<a class="code" href="structstp__papersize__t.html#o3">width</a> == 0))
01211         {
01212           <span class="keywordflow">if</span> (<a class="code" href="string-list_8c.html#a8">stp_string_list_count</a>(description-&gt;<a class="code" href="structstp__parameter__t.html#o18">bounds</a>.str) == 0)
01213             description-&gt;<a class="code" href="structstp__parameter__t.html#o26">deflt</a>.str = pt-&gt;<a class="code" href="structstp__papersize__t.html#o0">name</a>;
01214           <a class="code" href="string-list_8c.html#a11">stp_string_list_add_string</a>(description-&gt;<a class="code" href="structstp__parameter__t.html#o18">bounds</a>.str,
01215                                      pt-&gt;<a class="code" href="structstp__papersize__t.html#o0">name</a>, pt-&gt;<a class="code" href="structstp__papersize__t.html#o1">text</a>);
01216         }
01217     }
01218   }
01219   <span class="keywordflow">else</span> <span class="keywordflow">if</span> (strcmp(name, <span class="stringliteral">"Resolution"</span>) == 0)
01220   {
01221     <span class="keyword">const</span> <a class="code" href="structlexmark__res__t.html">lexmark_res_t</a> *res;
01222     description-&gt;<a class="code" href="structstp__parameter__t.html#o18">bounds</a>.str = <a class="code" href="string-list_8h.html#a1">stp_string_list_create</a>();
01223 
01224     res =  *(caps-&gt;<a class="code" href="structlexmark__cap__t.html#o19">res_parameters</a>); <span class="comment">/* get resolution specific parameters of printer */</span>
01225 
01226     <span class="comment">/* check for allowed resolutions */</span>
01227     <span class="keywordflow">while</span> (res-&gt;<a class="code" href="structlexmark__res__t.html#o2">hres</a>)
01228       {
01229         <span class="keywordflow">if</span> (<a class="code" href="string-list_8c.html#a8">stp_string_list_count</a>(description-&gt;<a class="code" href="structstp__parameter__t.html#o18">bounds</a>.str) == 0)
01230           description-&gt;<a class="code" href="structstp__parameter__t.html#o26">deflt</a>.str = res-&gt;<a class="code" href="structlexmark__res__t.html#o0">name</a>;
01231         <a class="code" href="string-list_8c.html#a11">stp_string_list_add_string</a>(description-&gt;<a class="code" href="structstp__parameter__t.html#o18">bounds</a>.str,
01232                                   res-&gt;<a class="code" href="structlexmark__res__t.html#o0">name</a>, <a class="code" href="group__intl__internal.html#ga5">_</a>(res-&gt;<a class="code" href="structlexmark__res__t.html#o1">text</a>));
01233         res++;
01234       }
01235   }
01236   <span class="keywordflow">else</span> <span class="keywordflow">if</span> (strcmp(name, <span class="stringliteral">"InkType"</span>) == 0)
01237   {
01238     description-&gt;<a class="code" href="structstp__parameter__t.html#o18">bounds</a>.str = <a class="code" href="string-list_8h.html#a1">stp_string_list_create</a>();
01239     description-&gt;<a class="code" href="structstp__parameter__t.html#o26">deflt</a>.str = caps-&gt;<a class="code" href="structlexmark__cap__t.html#o20">ink_types</a>[0].<a class="code" href="structlexmark__inkname__t.html#o0">name</a>;
01240     <span class="keywordflow">for</span> (i = 0; caps-&gt;<a class="code" href="structlexmark__cap__t.html#o20">ink_types</a>[i].<a class="code" href="structlexmark__inkname__t.html#o0">name</a> != NULL; i++)
01241       <a class="code" href="string-list_8c.html#a11">stp_string_list_add_string</a>(description-&gt;<a class="code" href="structstp__parameter__t.html#o18">bounds</a>.str,
01242                                caps-&gt;<a class="code" href="structlexmark__cap__t.html#o20">ink_types</a>[i].<a class="code" href="structlexmark__inkname__t.html#o0">name</a>,
01243                                <a class="code" href="group__intl__internal.html#ga5">_</a>(caps-&gt;<a class="code" href="structlexmark__cap__t.html#o20">ink_types</a>[i].<a class="code" href="structlexmark__inkname__t.html#o1">text</a>));
01244   }
01245   <span class="keywordflow">else</span> <span class="keywordflow">if</span> (strcmp(name, <span class="stringliteral">"MediaType"</span>) == 0)
01246   {
01247     description-&gt;<a class="code" href="structstp__parameter__t.html#o18">bounds</a>.str = <a class="code" href="string-list_8h.html#a1">stp_string_list_create</a>();
01248     description-&gt;<a class="code" href="structstp__parameter__t.html#o26">deflt</a>.str = <a class="code" href="print-lexmark_8c.html#a107">lexmark_paper_list</a>[0].<a class="code" href="structpaper__t.html#o0">name</a>;
01249     <span class="keywordflow">for</span> (i = 0; i &lt; <a class="code" href="print-lexmark_8c.html#a108">paper_type_count</a>; i++)
01250       <a class="code" href="string-list_8c.html#a11">stp_string_list_add_string</a>(description-&gt;<a class="code" href="structstp__parameter__t.html#o18">bounds</a>.str,
01251                                lexmark_paper_list[i].name,
01252                                <a class="code" href="group__intl__internal.html#ga5">_</a>(lexmark_paper_list[i].text));
01253   }
01254   <span class="keywordflow">else</span> <span class="keywordflow">if</span> (strcmp(name, <span class="stringliteral">"InputSlot"</span>) == 0)
01255   {
01256     description-&gt;<a class="code" href="structstp__parameter__t.html#o18">bounds</a>.str = <a class="code" href="string-list_8h.html#a1">stp_string_list_create</a>();
01257     description-&gt;<a class="code" href="structstp__parameter__t.html#o26">deflt</a>.str = <a class="code" href="print-lexmark_8c.html#a109">media_sources</a>[0].<a class="code" href="structstp__param__string__t.html#o0">name</a>;
01258     <span class="keywordflow">for</span> (i = 0; i &lt; <span class="keyword">sizeof</span>(<a class="code" href="print-lexmark_8c.html#a109">media_sources</a>) / <span class="keyword">sizeof</span>(<a class="code" href="structstp__param__string__t.html">stp_param_string_t</a>); i++)
01259       <a class="code" href="string-list_8c.html#a11">stp_string_list_add_string</a>(description-&gt;<a class="code" href="structstp__parameter__t.html#o18">bounds</a>.str,
01260                                media_sources[i].name,
01261                                <a class="code" href="group__intl__internal.html#ga5">_</a>(media_sources[i].name));
01262   }
01263   <span class="keywordflow">else</span> <span class="keywordflow">if</span> (strcmp(name, <span class="stringliteral">"InkChannels"</span>) == 0)
01264     {
01265       <span class="keywordflow">if</span> (caps-&gt;<a class="code" href="structlexmark__cap__t.html#o12">inks</a> &amp; <a class="code" href="print-lexmark_8c.html#a44">LEXMARK_INK_CcMmYyK</a>)
01266         description-&gt;<a class="code" href="structstp__parameter__t.html#o26">deflt</a>.integer = 7;
01267       <span class="keywordflow">else</span> <span class="keywordflow">if</span> (caps-&gt;<a class="code" href="structlexmark__cap__t.html#o12">inks</a> &amp; <a class="code" href="print-lexmark_8c.html#a42">LEXMARK_INK_CcMmYK</a>)
01268         description-&gt;<a class="code" href="structstp__parameter__t.html#o26">deflt</a>.integer = 6;
01269       <span class="keywordflow">else</span> <span class="keywordflow">if</span> (caps-&gt;<a class="code" href="structlexmark__cap__t.html#o12">inks</a> &amp; <a class="code" href="print-lexmark_8c.html#a41">LEXMARK_INK_CMYK</a>)
01270         description-&gt;<a class="code" href="structstp__parameter__t.html#o26">deflt</a>.integer = 4;
01271       <span class="keywordflow">else</span> <span class="keywordflow">if</span> (caps-&gt;<a class="code" href="structlexmark__cap__t.html#o12">inks</a> &amp; <a class="code" href="print-lexmark_8c.html#a40">LEXMARK_INK_CMY</a>)
01272         description-&gt;<a class="code" href="structstp__parameter__t.html#o26">deflt</a>.integer = 3;
01273       <span class="keywordflow">else</span>
01274         description-&gt;<a class="code" href="structstp__parameter__t.html#o26">deflt</a>.integer = 1;
01275       description-&gt;<a class="code" href="structstp__parameter__t.html#o18">bounds</a>.integer.lower = -1;
01276       description-&gt;<a class="code" href="structstp__parameter__t.html#o18">bounds</a>.integer.upper = -1;
01277     }
01278   <span class="keywordflow">else</span> <span class="keywordflow">if</span> (strcmp(name, <span class="stringliteral">"PrintingMode"</span>) == 0)
01279     {
01280       description-&gt;<a class="code" href="structstp__parameter__t.html#o18">bounds</a>.str = <a class="code" href="string-list_8h.html#a1">stp_string_list_create</a>();
01281       <a class="code" href="string-list_8h.html#a7">stp_string_list_add_string</a>
01282         (description-&gt;<a class="code" href="structstp__parameter__t.html#o18">bounds</a>.str, <span class="stringliteral">"Color"</span>, <a class="code" href="group__intl__internal.html#ga5">_</a>(<span class="stringliteral">"Color"</span>));
01283       <a class="code" href="string-list_8h.html#a7">stp_string_list_add_string</a>
01284         (description-&gt;<a class="code" href="structstp__parameter__t.html#o18">bounds</a>.str, <span class="stringliteral">"BW"</span>, <a class="code" href="group__intl__internal.html#ga5">_</a>(<span class="stringliteral">"Black and White"</span>));
01285       description-&gt;<a class="code" href="structstp__parameter__t.html#o26">deflt</a>.str =
01286         <a class="code" href="string-list_8c.html#a6">stp_string_list_param</a>(description-&gt;<a class="code" href="structstp__parameter__t.html#o18">bounds</a>.str, 0)-&gt;<a class="code" href="structstp__param__string__t.html#o0">name</a>;
01287     }
01288 }
01289 
01290 <span class="comment">/*</span>
01291 <span class="comment"> * 'lexmark_imageable_area()' - Return the imageable area of the page.</span>
01292 <span class="comment"> */</span>
01293 
01294 <span class="keyword">static</span> <span class="keywordtype">void</span>
01295 <a class="code" href="print-pcl_8c.html#a135">internal_imageable_area</a>(<span class="keyword">const</span> <a class="code" href="structstp__vars.html">stp_vars_t</a> *v,   <span class="comment">/* I */</span>
01296                         <span class="keywordtype">int</span>  use_paper_margins,
01297                         <span class="keywordtype">int</span>  *left,     <span class="comment">/* O - Left position in points */</span>
01298                         <span class="keywordtype">int</span>  *right,    <span class="comment">/* O - Right position in points */</span>
01299                         <span class="keywordtype">int</span>  *bottom,   <span class="comment">/* O - Bottom position in points */</span>
01300                         <span class="keywordtype">int</span>  *top)      <span class="comment">/* O - Top position in points */</span>
<a name="l01301"></a><a class="code" href="print-lexmark_8c.html#a139">01301</a> {
01302   <span class="keywordtype">int</span>   width, length;                  <span class="comment">/* Size of page */</span>
01303   <span class="keywordtype">int</span> left_margin = 0;
01304   <span class="keywordtype">int</span> right_margin = 0;
01305   <span class="keywordtype">int</span> bottom_margin = 0;
01306   <span class="keywordtype">int</span> top_margin = 0;
01307   <span class="keyword">const</span> <span class="keywordtype">char</span> *media_size = <a class="code" href="group__vars.html#ga36">stp_get_string_parameter</a>(v, <span class="stringliteral">"PageSize"</span>);
01308   <span class="keyword">const</span> <a class="code" href="structstp__papersize__t.html">stp_papersize_t</a> *pt = NULL;
01309   <span class="keyword">const</span> <a class="code" href="structlexmark__cap__t.html">lexmark_cap_t</a> *caps =
01310     <a class="code" href="print-lexmark_8c.html#a123">lexmark_get_model_capabilities</a>(<a class="code" href="group__printer.html#ga23">stp_get_model_id</a>(v));
01311 
01312 
01313   <span class="keywordflow">if</span> (media_size &amp;&amp; use_paper_margins)
01314     pt = <a class="code" href="group__papersize.html#ga9">stp_get_papersize_by_name</a>(media_size);
01315 
01316   <a class="code" href="group__papersize.html#ga13">stp_default_media_size</a>(v, &amp;width, &amp;length);
01317   <span class="keywordflow">if</span> (pt)
01318     {
01319       left_margin = pt-&gt;<a class="code" href="structstp__papersize__t.html#o6">left</a>;
01320       right_margin = pt-&gt;<a class="code" href="structstp__papersize__t.html#o8">right</a>;
01321       bottom_margin = pt-&gt;<a class="code" href="structstp__papersize__t.html#o7">bottom</a>;
01322       top_margin = pt-&gt;<a class="code" href="structstp__papersize__t.html#o5">top</a>;
01323     }
01324   left_margin = <a class="code" href="print-lexmark_8c.html#a6">max</a>(left_margin, caps-&gt;<a class="code" href="structlexmark__cap__t.html#o8">border_left</a>);
01325   right_margin = <a class="code" href="print-lexmark_8c.html#a6">max</a>(right_margin, caps-&gt;<a class="code" href="structlexmark__cap__t.html#o9">border_right</a>);
01326   top_margin = <a class="code" href="print-lexmark_8c.html#a6">max</a>(top_margin, caps-&gt;<a class="code" href="structlexmark__cap__t.html#o10">border_top</a>);
01327   bottom_margin = <a class="code" href="print-lexmark_8c.html#a6">max</a>(bottom_margin, caps-&gt;<a class="code" href="structlexmark__cap__t.html#o11">border_bottom</a>);
01328 
01329   *left =       left_margin;
01330   *right =      width - right_margin;
01331   *top =        top_margin;
01332   *bottom =     length - bottom_margin;
01333 }
01334 
01335 <span class="keyword">static</span> <span class="keywordtype">void</span>
01336 <a class="code" href="print-lexmark_8c.html#a140">lexmark_imageable_area</a>(<span class="keyword">const</span> <a class="code" href="structstp__vars.html">stp_vars_t</a> *v,   <span class="comment">/* I */</span>
01337                        <span class="keywordtype">int</span>  *left,      <span class="comment">/* O - Left position in points */</span>
01338                        <span class="keywordtype">int</span>  *right,     <span class="comment">/* O - Right position in points */</span>
01339                        <span class="keywordtype">int</span>  *bottom,    <span class="comment">/* O - Bottom position in points */</span>
01340                        <span class="keywordtype">int</span>  *top)       <span class="comment">/* O - Top position in points */</span>
01341 {
<a name="l01342"></a><a class="code" href="print-lexmark_8c.html#a140">01342</a>   <a class="code" href="print-pcl_8c.html#a135">internal_imageable_area</a>(v, 1, left, right, bottom, top);
01343 }
01344 
01345 <span class="keyword">static</span> <span class="keywordtype">void</span>
01346 <a class="code" href="print-lexmark_8c.html#a141">lexmark_limit</a>(<span class="keyword">const</span> <a class="code" href="structstp__vars.html">stp_vars_t</a> *v,              <span class="comment">/* I */</span>
01347               <span class="keywordtype">int</span> *width,
01348               <span class="keywordtype">int</span> *height,
01349               <span class="keywordtype">int</span> *min_width,
01350               <span class="keywordtype">int</span> *min_height)
01351 {
<a name="l01352"></a><a class="code" href="print-lexmark_8c.html#a141">01352</a>   <span class="keyword">const</span> <a class="code" href="structlexmark__cap__t.html">lexmark_cap_t</a> * caps= <a class="code" href="print-lexmark_8c.html#a123">lexmark_get_model_capabilities</a>(<a class="code" href="group__printer.html#ga23">stp_get_model_id</a>(v));
01353   *width =      caps-&gt;<a class="code" href="structlexmark__cap__t.html#o1">max_paper_width</a>;
01354   *height =     caps-&gt;<a class="code" href="structlexmark__cap__t.html#o2">max_paper_height</a>;
01355   *min_width =  caps-&gt;<a class="code" href="structlexmark__cap__t.html#o3">min_paper_width</a>;
01356   *min_height = caps-&gt;<a class="code" href="structlexmark__cap__t.html#o4">min_paper_height</a>;
01357 }
01358 
01359 
01360 
01361 <span class="keyword">static</span> <span class="keywordtype">int</span>
01362 <a class="code" href="print-lexmark_8c.html#a142">lexmark_init_printer</a>(<span class="keyword">const</span> <a class="code" href="structstp__vars.html">stp_vars_t</a> *v, <span class="keyword">const</span> <a class="code" href="structlexmark__cap__t.html">lexmark_cap_t</a> * caps,
01363                      <span class="keywordtype">int</span> printing_color,
01364                      <span class="keyword">const</span> <span class="keywordtype">char</span> *source_str,
01365                      <span class="keywordtype">int</span> xdpi, <span class="keywordtype">int</span> ydpi,
01366                      <span class="keywordtype">int</span> page_width, <span class="keywordtype">int</span> page_height,
01367                      <span class="keywordtype">int</span> top, <span class="keywordtype">int</span> left,
<a name="l01368"></a><a class="code" href="print-lexmark_8c.html#a142">01368</a>                      <span class="keywordtype">int</span> use_dmt)
01369 {
01370 
01371   <span class="comment">/* because the details of the header sequence are not known, we simply write it as one image. */</span>
01372 
01373 <span class="preprocessor">#define LXM_Z52_STARTSIZE 0x35</span>
01374 <span class="preprocessor"></span>  <span class="comment">/* 300 dpi */</span>
01375   <span class="keywordtype">unsigned</span> <span class="keywordtype">char</span> startHeader_z52[<a class="code" href="print-lexmark_8c.html#a73">LXM_Z52_STARTSIZE</a>]={0x1b,0x2a,0x81,0x00,0x1c,0x56,0x49,0x00,
01376                                            0x01,0x00,0x2c,0x01,0x00,0x00,0x60,0x09,
01377                                            0xe4,0x0c,0x01,0x00,0x34,0x00,0x00,0x00,
01378                                            0x08,0x00,0x08,0x00,0x1b,0x2a,0x07,0x76,
01379                                            0x01,0x1b,0x2a,0x07,0x73,0x30,0x1b,0x2a,
01380                                            0x6d,0x00,0x14,0x01,0xf4,0x02,0x00,0x01,
01381                                            0xf0,0x1b,0x2a,0x07,0x63};
01382 
01383 <span class="preprocessor">#define LXM_Z42_STARTSIZE 0x30</span>
01384 <span class="preprocessor"></span>  <span class="comment">/* 600 dpi */</span>
01385   <span class="keywordtype">unsigned</span> <span class="keywordtype">char</span> startHeader_z42[<a class="code" href="print-lexmark_8c.html#a74">LXM_Z42_STARTSIZE</a>]={0x1B,0x2A,0x81,0x00,0x1C,0x50,0x41,0x00,
01386                                            0x01,0x00,0x58,0x02,0x04,0x00,0xC0,0x12,
01387                                            0xC8,0x19,0x02,0x00,0x50,0x00,0x14,0x00,
01388                                            0x07,0x00,0x08,0x00,0x1B,0x2A,0x07,0x73,
01389                                            0x30,0x1B,0x2A,0x6D,0x00,0x14,0x01,0xC0,
01390                                            0x02,0x00,0x01,0xBE,0x1B,0x2A,0x07,0x63};
01391 
01392 <span class="preprocessor">  #define ESC2a "\033\052"</span>
01393 <span class="preprocessor"></span>
01394 
01395 
01396 <span class="preprocessor">#define LXM_3200_STARTSIZE 32</span>
01397 <span class="preprocessor"></span>
01398   <span class="keywordtype">unsigned</span> <span class="keywordtype">char</span> startHeader_3200[<a class="code" href="print-lexmark_8c.html#a76">LXM_3200_STARTSIZE</a>] =
01399   {
01400     0x1b, 0x2a, 0x80, 0x00, 0x00, 0x00, 0x00, 0x00,
01401     0x1b, 0x33, 0x00, 0x00, 0x00, 0x00, 0x00, 0x33,
01402     0x1b, 0x30, 0x80, 0x0C, 0x02, 0x00, 0x00, 0xbe,
01403     0x1b, 0x21, 0x00, 0x00, 0x00, 0x00, 0x00, 0x21
01404   };
01405 
01406   <span class="comment">/* write init sequence */</span>
01407   <span class="keywordflow">switch</span>(caps-&gt;<a class="code" href="structlexmark__cap__t.html#o0">model</a>)
01408         {
01409                 <span class="keywordflow">case</span> <a class="code" href="print-lexmark_8c.html#a152a116">m_z52</a>:
01410                         <a class="code" href="group__util.html#ga10">stp_zfwrite</a>((<span class="keyword">const</span> <span class="keywordtype">char</span> *) startHeader_z52,
01411                                     <a class="code" href="print-lexmark_8c.html#a73">LXM_Z52_STARTSIZE</a>,1,v);
01412 <span class="preprocessor">#ifdef DEBUG</span>
01413 <span class="preprocessor"></span>                        lex_write_tmp_file(dbgfileprn, (<span class="keywordtype">void</span> *)startHeader_z52, <a class="code" href="print-lexmark_8c.html#a73">LXM_Z52_STARTSIZE</a>);
01414 <span class="preprocessor">#endif</span>
01415 <span class="preprocessor"></span>                <span class="keywordflow">case</span> <a class="code" href="print-lexmark_8c.html#a152a117">m_z42</a>:
01416                         <a class="code" href="group__util.html#ga10">stp_zfwrite</a>((<span class="keyword">const</span> <span class="keywordtype">char</span> *) startHeader_z42,
01417                                     <a class="code" href="print-lexmark_8c.html#a74">LXM_Z42_STARTSIZE</a>,1,v);
01418 <span class="preprocessor">#ifdef DEBUG</span>
01419 <span class="preprocessor"></span>                        lex_write_tmp_file(dbgfileprn, (<span class="keywordtype">void</span> *)startHeader_z42, <a class="code" href="print-lexmark_8c.html#a74">LXM_Z42_STARTSIZE</a>);
01420 <span class="preprocessor">#endif</span>
01421 <span class="preprocessor"></span>                        <span class="keywordflow">break</span>;
01422 
01423                 <span class="keywordflow">case</span> <a class="code" href="print-lexmark_8c.html#a152a118">m_3200</a>:
01424                         <a class="code" href="group__util.html#ga10">stp_zfwrite</a>((<span class="keyword">const</span> <span class="keywordtype">char</span> *) startHeader_3200,
01425                                     <a class="code" href="print-lexmark_8c.html#a76">LXM_3200_STARTSIZE</a>, 1, v);
01426                         <span class="keywordflow">break</span>;
01427 
01428                 <span class="keywordflow">default</span>:
01429                         <a class="code" href="print-util_8c.html#a20">stp_erprintf</a>(<span class="stringliteral">"Unknown printer !! %i\n"</span>, caps-&gt;<a class="code" href="structlexmark__cap__t.html#o0">model</a>);
01430                         <span class="keywordflow">return</span> 0;
01431   }
01432 
01433 
01434 
01435   <span class="comment">/*</span>
01436 <span class="comment">#ifdef DEBUG</span>
01437 <span class="comment">  stp_erprintf("lexmark: printable size = %dx%d (%dx%d) %02x%02x %02x%02x\n",</span>
01438 <span class="comment">          page_width,page_height,printable_width,printable_length,</span>
01439 <span class="comment">          arg_70_1,arg_70_2,arg_70_3,arg_70_4);</span>
01440 <span class="comment">#endif</span>
01441 <span class="comment">  */</span>
01442   <span class="keywordflow">return</span> 1;
01443 }
01444 
01445 <span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="print-lexmark_8c.html#a143">lexmark_deinit_printer</a>(<span class="keyword">const</span> <a class="code" href="structstp__vars.html">stp_vars_t</a> *v, <span class="keyword">const</span> <a class="code" href="structlexmark__cap__t.html">lexmark_cap_t</a> * caps)
01446 {
01447 
01448         <span class="keywordflow">switch</span>(caps-&gt;<a class="code" href="structlexmark__cap__t.html#o0">model</a>)     {
01449                 <span class="keywordflow">case</span> <a class="code" href="print-lexmark_8c.html#a152a116">m_z52</a>:
01450                 {
<a name="l01451"></a><a class="code" href="print-lexmark_8c.html#a143">01451</a>                         <span class="keywordtype">char</span> buffer[40];
01452 
01453                         memcpy(buffer, ESC2a, 2);
01454                         buffer[2] = 0x7;
01455                         buffer[3] = 0x65;
01456 
01457 <span class="preprocessor">#ifdef DEBUG</span>
01458 <span class="preprocessor"></span>                        <a class="code" href="print-util_8c.html#a20">stp_erprintf</a>(<span class="stringliteral">"lexmark: &lt;&lt;eject page.&gt;&gt; %x %x %x %x   %lx\n"</span>, buffer[0],  buffer[1], buffer[2], buffer[3], dbgfileprn);
01459                         lex_write_tmp_file(dbgfileprn, (<span class="keywordtype">void</span> *)&amp;(buffer[0]), 4);
01460 <span class="preprocessor">#endif</span>
01461 <span class="preprocessor"></span>                        <span class="comment">/* eject page */</span>
01462                         <a class="code" href="group__util.html#ga10">stp_zfwrite</a>(buffer, 1, 4, v);
01463                 }
01464                 <span class="keywordflow">break</span>;
01465 
01466                 <span class="keywordflow">case</span> <a class="code" href="print-lexmark_8c.html#a152a117">m_z42</a>:
01467                 {
01468                         <span class="keywordtype">unsigned</span> <span class="keywordtype">char</span> buffer[12] = {0x1B,0x2A,0x07,0x65,0x1B,0x2A,0x82,0x00,0x00,0x00,0x00,0xAC};
01469 <span class="preprocessor">#ifdef DEBUG</span>
01470 <span class="preprocessor"></span>                        <a class="code" href="print-util_8c.html#a20">stp_erprintf</a>(<span class="stringliteral">"lexmark: &lt;&lt;eject page.&gt;&gt;\n"</span>);
01471                         lex_write_tmp_file(dbgfileprn, (<span class="keywordtype">void</span> *)&amp;(buffer[0]), 12);
01472 <span class="preprocessor">#endif</span>
01473 <span class="preprocessor"></span>                        <span class="comment">/* eject page */</span>
01474                         <a class="code" href="group__util.html#ga10">stp_zfwrite</a>((<span class="keywordtype">char</span> *)buffer, 1, 12, v);
01475                 }
01476                 <span class="keywordflow">break</span>;
01477 
01478                 <span class="keywordflow">case</span> <a class="code" href="print-lexmark_8c.html#a152a118">m_3200</a>:
01479                 {
01480                   <span class="keywordtype">unsigned</span> <span class="keywordtype">char</span> buffer[24] =
01481                   {
01482                     0x1b, 0x22, 0x80, 0x00, 0x00, 0x00, 0x00, 0x00,
01483                     0x1b, 0x31, 0x10, 0x00, 0x00, 0x00, 0x00, 0x00,
01484                     0x1b, 0x33, 0x10, 0x00, 0x00, 0x00, 0x00, 0x33
01485                   };
01486 
01487 <span class="preprocessor">#ifdef DEBUG</span>
01488 <span class="preprocessor"></span>                        <a class="code" href="print-util_8c.html#a20">stp_erprintf</a>(<span class="stringliteral">"Headpos: %d\n"</span>, lxm3200_headpos);
01489 <span class="preprocessor">#endif</span>
01490 <span class="preprocessor"></span>
01491                         <a class="code" href="print-lexmark_8c.html#a101">lxm3200_linetoeject</a> += 2400;
01492                         buffer[3] = <a class="code" href="print-lexmark_8c.html#a101">lxm3200_linetoeject</a> &gt;&gt; 8;
01493                         buffer[4] = <a class="code" href="print-lexmark_8c.html#a101">lxm3200_linetoeject</a> &amp; 0xff;
01494                         buffer[7] = <a class="code" href="print-lexmark_8c.html#a121">lexmark_calc_3200_checksum</a>(&amp;buffer[0]);
01495                         buffer[11] = <a class="code" href="print-lexmark_8c.html#a100">lxm3200_headpos</a> &gt;&gt; 8;
01496                         buffer[12] = <a class="code" href="print-lexmark_8c.html#a100">lxm3200_headpos</a> &amp; 0xff;
01497                         buffer[15] = <a class="code" href="print-lexmark_8c.html#a121">lexmark_calc_3200_checksum</a>(&amp;buffer[8]);
01498 
01499                         <a class="code" href="group__util.html#ga10">stp_zfwrite</a>((<span class="keyword">const</span> <span class="keywordtype">char</span> *)buffer, 24, 1, v);
01500                 }
01501                 <span class="keywordflow">break</span>;
01502 
01503                 <span class="keywordflow">case</span> <a class="code" href="print-lexmark_8c.html#a152a115">m_lex7500</a>:
01504                         <span class="keywordflow">break</span>;
01505         }
01506 
01507 }
01508 
01509 
01510 <span class="comment">/* paper_shift() -- shift paper in printer -- units are unknown :-)</span>
01511 <span class="comment"> */</span>
01512 <span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="print-lexmark_8c.html#a144">paper_shift</a>(<span class="keyword">const</span> <a class="code" href="structstp__vars.html">stp_vars_t</a> *v, <span class="keywordtype">int</span> offset, <span class="keyword">const</span> <a class="code" href="structlexmark__cap__t.html">lexmark_cap_t</a> * caps)
01513 {
01514         <span class="keywordflow">switch</span>(caps-&gt;<a class="code" href="structlexmark__cap__t.html#o0">model</a>)     {
01515                 <span class="keywordflow">case</span> <a class="code" href="print-lexmark_8c.html#a152a116">m_z52</a>:
01516                 <span class="keywordflow">case</span> <a class="code" href="print-lexmark_8c.html#a152a117">m_z42</a>:
01517                 {
<a name="l01518"></a><a class="code" href="print-lexmark_8c.html#a144">01518</a>                         <span class="keywordtype">unsigned</span> <span class="keywordtype">char</span> buf[5] = {0x1b, 0x2a, 0x3, 0x0, 0x0};
01519                         <span class="keywordflow">if</span>(offset == 0)<span class="keywordflow">return</span>;
01520                         buf[3] = (<span class="keywordtype">unsigned</span> <span class="keywordtype">char</span>)(offset &gt;&gt; 8);
01521                         buf[4] = (<span class="keywordtype">unsigned</span> <span class="keywordtype">char</span>)(offset &amp; 0xFF);
01522                         <a class="code" href="group__util.html#ga10">stp_zfwrite</a>((<span class="keyword">const</span> <span class="keywordtype">char</span> *)buf, 1, 5, v);
01523 <span class="preprocessor">#ifdef DEBUG</span>
01524 <span class="preprocessor"></span>                        lex_write_tmp_file(dbgfileprn, (<span class="keywordtype">void</span> *)buf, 5);
01525 <span class="preprocessor">#endif</span>
01526 <span class="preprocessor"></span>                }
01527                 <span class="keywordflow">break</span>;
01528 
01529                 <span class="keywordflow">case</span> <a class="code" href="print-lexmark_8c.html#a152a118">m_3200</a>:
01530                 {
01531                         <span class="keywordtype">unsigned</span> <span class="keywordtype">char</span> buf[8] = {0x1b, 0x23, 0x80, 0x00, 0x00, 0x00, 0x00, 0x00};
01532                         <span class="keywordflow">if</span>(offset == 0)<span class="keywordflow">return</span>;
01533                         <a class="code" href="print-lexmark_8c.html#a101">lxm3200_linetoeject</a> -= offset;
01534                         buf[3] = (<span class="keywordtype">unsigned</span> <span class="keywordtype">char</span>)(offset &gt;&gt; 8);
01535                         buf[4] = (<span class="keywordtype">unsigned</span> <span class="keywordtype">char</span>)(offset &amp; 0xff);
01536                         buf[7] = <a class="code" href="print-lexmark_8c.html#a121">lexmark_calc_3200_checksum</a>(buf);
01537                         <a class="code" href="group__util.html#ga10">stp_zfwrite</a>((<span class="keyword">const</span> <span class="keywordtype">char</span> *)buf, 1, 8, v);
01538                 }
01539                 <span class="keywordflow">break</span>;
01540 
01541                 <span class="keywordflow">case</span> <a class="code" href="print-lexmark_8c.html#a152a115">m_lex7500</a>:
01542                         <span class="keywordflow">break</span>;
01543         }
01544 
01545 <span class="preprocessor">#ifdef DEBUG</span>
01546 <span class="preprocessor"></span>        <a class="code" href="print-util_8c.html#a20">stp_erprintf</a>(<span class="stringliteral">"Lines to eject: %d\n"</span>, lxm3200_linetoeject);
01547 <span class="preprocessor">#endif</span>
01548 <span class="preprocessor"></span>}
01549 
01550 <span class="comment">/*</span>
01551 <span class="comment"> * 'advance_buffer()' - Move (num) lines of length (len) down one line</span>
01552 <span class="comment"> *                      and sets first line to 0s</span>
01553 <span class="comment"> *                      accepts NULL pointers as buf</span>
01554 <span class="comment"> *                  !!! buf must contain more than (num) lines !!!</span>
01555 <span class="comment"> *                      also sets first line to 0s if num&lt;1</span>
01556 <span class="comment"> */</span>
01557 <span class="preprocessor">#if 0</span>
01558 <span class="preprocessor"></span><span class="keyword">static</span> <span class="keywordtype">void</span>
01559 lexmark_advance_buffer(<span class="keywordtype">unsigned</span> <span class="keywordtype">char</span> *buf, <span class="keywordtype">int</span> len, <span class="keywordtype">int</span> num)
01560 {
01561   <span class="keywordflow">if</span> (!buf || !len) <span class="keywordflow">return</span>;
01562   <span class="keywordflow">if</span> (num&gt;0) memmove(buf+len,buf,len*num);
01563   memset(buf,0,len);
01564 }
01565 <span class="preprocessor">#endif</span>
01566 <span class="preprocessor"></span>
01567 <span class="keyword">static</span> <span class="keywordtype">double</span>
01568 <a class="code" href="print-pcl_8c.html#a140">get_double_param</a>(<a class="code" href="structstp__vars.html">stp_vars_t</a> *v, <span class="keyword">const</span> <span class="keywordtype">char</span> *param)
01569 {
01570   <span class="keywordflow">if</span> (param &amp;&amp; <a class="code" href="group__vars.html#ga102">stp_check_float_parameter</a>(v, param, STP_PARAMETER_ACTIVE))
01571     <span class="keywordflow">return</span> <a class="code" href="group__vars.html#ga70">stp_get_float_parameter</a>(v, param);
01572   <span class="keywordflow">else</span>
01573     <span class="keywordflow">return</span> 1.0;
<a name="l01574"></a><a class="code" href="print-lexmark_8c.html#a145">01574</a> }
01575 
01576 <span class="comment">/**********************************************************</span>
01577 <span class="comment"> * lexmark_print() - Print an image to a LEXMARK printer.</span>
01578 <span class="comment"> **********************************************************/</span>
01579 <span class="comment">/* This method should not be printer dependent (mybe it is because of nozzle count and other things) */</span>
01580 <span class="comment">/* The method will set the printing method depending on the selected printer.</span>
01581 <span class="comment">   It will define the colors to be used and the resolution.</span>
01582 <span class="comment">   Additionally the pass_length will be defined.</span>
01583 <span class="comment">   The method lexmark_write() is responsible to handle the received lines</span>
01584 <span class="comment">   in a correct way.</span>
01585 <span class="comment">*/</span>
01586 <span class="keyword">static</span> <span class="keywordtype">int</span>
01587 <a class="code" href="print-lexmark_8c.html#a146">lexmark_do_print</a>(<a class="code" href="structstp__vars.html">stp_vars_t</a> *v, <a class="code" href="structstp__image.html">stp_image_t</a> *image)
01588 {
01589   <span class="keywordtype">int</span>           status = 1;
01590   <span class="keywordtype">int</span>           y;              <span class="comment">/* Looping vars */</span>
01591   <span class="keywordtype">int</span>           xdpi, ydpi;     <span class="comment">/* Resolution */</span>
01592   <span class="keywordtype">int</span>           n;              <span class="comment">/* Output number */</span>
<a name="l01593"></a><a class="code" href="print-lexmark_8c.html#a146">01593</a>   <span class="keywordtype">int</span> page_width,       <span class="comment">/* Width of page */</span>
01594     page_height,        <span class="comment">/* Length of page */</span>
01595     page_left,
01596     page_top,
01597     page_right,
01598     page_bottom,
01599     page_true_height,   <span class="comment">/* True length of page */</span>
01600     out_width,  <span class="comment">/* Width of image on page in pixles */</span>
01601     out_height, <span class="comment">/* Length of image on page */</span>
01602     out_channels,       <span class="comment">/* Output bytes per pixel */</span>
01603     length,             <span class="comment">/* Length of raster data in bytes*/</span>
01604     buf_length,     <span class="comment">/* Length of raster data buffer (dmt) */</span>
01605     errdiv,             <span class="comment">/* Error dividend */</span>
01606     errmod,             <span class="comment">/* Error modulus */</span>
01607     errval,             <span class="comment">/* Current error value */</span>
01608     errline,    <span class="comment">/* Current raster line */</span>
01609     errlast;    <span class="comment">/* Last raster line loaded */</span>
01610   <span class="keywordtype">unsigned</span>      zero_mask;
01611   <span class="keywordtype">int</span>           image_height,
01612                 image_width;
01613   <span class="keywordtype">int</span>           use_dmt = 0;
01614   <span class="keywordtype">int</span> pass_length=0;              <span class="comment">/* count of inkjets for one pass */</span>
01615   <span class="keywordtype">int</span> add_top_offset=0;              <span class="comment">/* additional top offset */</span>
01616   <span class="keywordtype">int</span> printMode = 0;
01617     <span class="keywordtype">int</span> source;
01618   <span class="comment">/* Lexmark do not have differnet pixel sizes. We have to correct the density according the print resolution. */</span>
01619   <span class="keywordtype">double</span>  densityDivisor;            <span class="comment">/* This parameter is will adapt the density according the resolution */</span>
01620   <span class="keywordtype">double</span> k_lower, k_upper;
01621   <span class="keywordtype">int</span>  physical_xdpi = 0;
01622   <span class="keywordtype">int</span>  physical_ydpi = 0;
01623   <span class="keywordtype">int</span> i;
01624 
01625   <a class="code" href="structstp__curve.html">stp_curve_t</a> *lum_adjustment = NULL;
01626   <a class="code" href="structstp__curve.html">stp_curve_t</a> *hue_adjustment = NULL;
01627   <a class="code" href="structstp__curve.html">stp_curve_t</a> *sat_adjustment = NULL;
01628 
01629   <span class="comment">/* weave parameters */</span>
01630   <a class="code" href="unionlexmark__linebufs__t.html">lexmark_linebufs_t</a> cols;
01631   <span class="keywordtype">int</span>  nozzle_separation;
01632   <span class="keywordtype">int</span>  horizontal_passes;
01633   <span class="keywordtype">int</span>  ncolors;
01634   <a class="code" href="structlexm__privdata__weave.html">lexm_privdata_weave</a> privdata;
01635 
01636   <a class="code" href="unionlexmark__lineoff__t.html">lexmark_lineoff_t</a> lineoff_buffer;  <span class="comment">/* holds the line offsets of each color */</span>
01637 <span class="preprocessor">#ifdef DEBUG</span>
01638 <span class="preprocessor"></span>  <a class="code" href="classtestdata.html">testdata</a> td;
01639 <span class="preprocessor">#endif</span>
01640 <span class="preprocessor"></span>
01641 
01642   <span class="keywordtype">int</span>           model         = <a class="code" href="group__printer.html#ga23">stp_get_model_id</a>(v);
01643   <span class="keyword">const</span> <span class="keywordtype">char</span>    *resolution   = <a class="code" href="group__vars.html#ga36">stp_get_string_parameter</a>(v, <span class="stringliteral">"Resolution"</span>);
01644   <span class="keyword">const</span> <span class="keywordtype">char</span>    *media_type   = <a class="code" href="group__vars.html#ga36">stp_get_string_parameter</a>(v, <span class="stringliteral">"MediaType"</span>);
01645   <span class="keyword">const</span> <span class="keywordtype">char</span>    *media_source = <a class="code" href="group__vars.html#ga36">stp_get_string_parameter</a>(v, <span class="stringliteral">"InputSlot"</span>);
01646   <span class="keyword">const</span> <span class="keywordtype">char</span>    *print_mode = <a class="code" href="group__vars.html#ga36">stp_get_string_parameter</a>(v, <span class="stringliteral">"PrintingMode"</span>);
01647   <span class="keywordtype">int</span> printing_color = 0;
01648   <span class="keyword">const</span> <span class="keywordtype">char</span>    *ink_type     = <a class="code" href="group__vars.html#ga36">stp_get_string_parameter</a>(v, <span class="stringliteral">"InkType"</span>);
01649   <span class="keywordtype">int</span>           top = <a class="code" href="group__vars.html#ga20">stp_get_top</a>(v);
01650   <span class="keywordtype">int</span>           left = <a class="code" href="group__vars.html#ga18">stp_get_left</a>(v);
01651 
01652   <span class="keyword">const</span> <a class="code" href="structlexmark__cap__t.html">lexmark_cap_t</a> * caps= <a class="code" href="print-lexmark_8c.html#a123">lexmark_get_model_capabilities</a>(model);
01653   <span class="keyword">const</span> <a class="code" href="structlexmark__res__t.html">lexmark_res_t</a> *res_para_ptr =
01654     <a class="code" href="print-lexmark_8c.html#a130">lexmark_get_resolution_para</a>(model, resolution);
01655   <span class="keyword">const</span> <a class="code" href="structpaper__t.html">paper_t</a> *media = <a class="code" href="print-lexmark_8c.html#a126">get_media_type</a>(media_type,caps);
01656   <span class="keyword">const</span> <a class="code" href="structlexmark__inkparam__t.html">lexmark_inkparam_t</a> *ink_parameter;
01657 
01658   <a class="code" href="group__util.html#ga77">stp_prune_inactive_options</a>(v);
01659 
01660 <span class="preprocessor">#ifdef DEBUG</span>
01661 <span class="preprocessor"></span>  dbgfileprn = lex_open_tmp_file(); <span class="comment">/* open file with xx */</span>
01662 <span class="preprocessor">#endif</span>
01663 <span class="preprocessor"></span>
01664   <span class="keywordflow">if</span> (!<a class="code" href="group__vars.html#ga34">stp_verify</a>(v))
01665     {
01666       <a class="code" href="print-util_8c.html#a18">stp_eprintf</a>(v, <span class="stringliteral">"Print options not verified; cannot print.\n"</span>);
01667       <span class="keywordflow">return</span> 0;
01668     }
01669   <span class="keywordflow">if</span> (strcmp(print_mode, <span class="stringliteral">"Color"</span>) == 0)
01670     printing_color = 1;
01671 
01672   ink_parameter = <a class="code" href="print-lexmark_8c.html#a125">lexmark_get_ink_parameter</a>(ink_type, printing_color, caps, v);
01673 
01674   <span class="keywordflow">if</span> (ink_parameter == NULL)
01675     {
01676       <a class="code" href="print-util_8c.html#a18">stp_eprintf</a>(v, <span class="stringliteral">"Illegal Ink Type specified; cannot print.\n"</span>);
01677       <span class="keywordflow">return</span> 0;
01678     }
01679 
01680   <a class="code" href="group__image.html#ga0">stp_image_init</a>(image);
01681 
01682   source= <a class="code" href="print-lexmark_8c.html#a127">lexmark_source_type</a>(media_source,caps);
01683 
01684   <span class="comment">/* force grayscale if image is grayscale</span>
01685 <span class="comment">   *                 or single black cartridge installed</span>
01686 <span class="comment">   */</span>
01687 
01688   <span class="keywordflow">if</span> ((ink_parameter-&gt;<a class="code" href="structlexmark__inkparam__t.html#o1">used_colors</a> == <a class="code" href="print-lexmark_8c.html#a21">COLOR_MODE_K</a>) ||
01689       (caps-&gt;<a class="code" href="structlexmark__cap__t.html#o12">inks</a> == <a class="code" href="print-lexmark_8c.html#a39">LEXMARK_INK_K</a>))
01690     {
01691       printing_color = 0;
01692       <a class="code" href="group__vars.html#ga32">stp_set_string_parameter</a>(v, <span class="stringliteral">"PrintingMode"</span>, <span class="stringliteral">"BW"</span>);
01693     }
01694 
01695   <span class="comment">/*</span>
01696 <span class="comment">   * Choose the correct color conversion function...</span>
01697 <span class="comment">   */</span>
01698 
01699 
01700   ncolors = ink_parameter-&gt;<a class="code" href="structlexmark__inkparam__t.html#o0">ncolors</a>;
01701   printMode = ink_parameter-&gt;<a class="code" href="structlexmark__inkparam__t.html#o1">used_colors</a>;
01702   pass_length = ink_parameter-&gt;<a class="code" href="structlexmark__inkparam__t.html#o2">pass_length</a>;
01703   add_top_offset = ink_parameter-&gt;<a class="code" href="structlexmark__inkparam__t.html#o3">v_top_head_offset</a>;
01704 
01705 
01706   <span class="comment">/*</span>
01707 <span class="comment">   * Figure out the output resolution...</span>
01708 <span class="comment">   */</span>
01709 
01710   <a class="code" href="group__vars.html#ga32">stp_describe_resolution</a>(v, &amp;xdpi, &amp;ydpi);
01711 <span class="preprocessor">#ifdef DEBUG</span>
01712 <span class="preprocessor"></span>  <a class="code" href="print-util_8c.html#a20">stp_erprintf</a>(<span class="stringliteral">"lexmark: resolution=%dx%d\n"</span>,xdpi,ydpi);
01713 <span class="preprocessor">#endif</span>
01714 <span class="preprocessor"></span>
01715   <span class="keywordflow">switch</span> (res_para_ptr-&gt;<a class="code" href="structlexmark__res__t.html#o8">resid</a>) {
01716   <span class="keywordflow">case</span> <a class="code" href="print-lexmark_8c.html#a9">DPI300</a>:
01717     physical_xdpi = 300;
01718     physical_ydpi = <a class="code" href="print-lexmark_8c.html#a129">lexmark_get_phys_resolution_vertical</a>(model);
01719     <span class="keywordflow">break</span>;
01720   <span class="keywordflow">case</span> <a class="code" href="print-lexmark_8c.html#a10">DPI600</a>:
01721     physical_xdpi = 600;
01722     physical_ydpi = <a class="code" href="print-lexmark_8c.html#a129">lexmark_get_phys_resolution_vertical</a>(model);
01723     <span class="keywordflow">break</span>;
01724   <span class="keywordflow">case</span> <a class="code" href="print-lexmark_8c.html#a11">DPI1200</a>:
01725   <span class="keywordflow">case</span> <a class="code" href="print-lexmark_8c.html#a13">DPItest</a>:
01726     physical_xdpi = 1200;
01727     physical_ydpi = <a class="code" href="print-lexmark_8c.html#a129">lexmark_get_phys_resolution_vertical</a>(model);
01728     <span class="keywordflow">break</span>;
01729   <span class="keywordflow">default</span>:
01730     <span class="keywordflow">return</span> 0;
01731     <span class="keywordflow">break</span>;
01732   }
01733   <span class="comment">/* adapt the density */</span>
01734   densityDivisor = ((xdpi / 300)*(ydpi/ 600));
01735 
01736 <span class="preprocessor">#ifdef DEBUG</span>
01737 <span class="preprocessor"></span>  <span class="keywordflow">if</span> (res_para_ptr-&gt;<a class="code" href="structlexmark__res__t.html#o8">resid</a> == <a class="code" href="print-lexmark_8c.html#a13">DPItest</a>) {
01738     <a class="code" href="print-util_8c.html#a20">stp_erprintf</a>(<span class="stringliteral">"Start test print1\n"</span>);
01739     doTestPrint = 1;
01740   }
01741 <span class="preprocessor">#endif</span>
01742 <span class="preprocessor"></span>
01743   <span class="keywordflow">if</span> ((printMode &amp; <a class="code" href="print-lexmark_8c.html#a34">COLOR_MODE_PHOTO</a>) == <a class="code" href="print-lexmark_8c.html#a34">COLOR_MODE_PHOTO</a>) {
01744     <span class="comment">/* in case of photo mode we have to go a bit ligther */</span>
01745 densityDivisor /= 1.2;
01746   }
01747 
01748   nozzle_separation = ydpi / physical_ydpi;
01749 
01750   horizontal_passes = xdpi / physical_xdpi;
01751 <span class="preprocessor">#ifdef DEBUG</span>
01752 <span class="preprocessor"></span>  <a class="code" href="print-util_8c.html#a20">stp_erprintf</a>(<span class="stringliteral">"lexmark: horizontal_passes %i, xdpi %i, physical_xdpi %i\n"</span>,
01753                horizontal_passes, xdpi, physical_xdpi);
01754 <span class="preprocessor">#endif</span>
01755 <span class="preprocessor"></span>
01756 
01757 
01758 
01759   <span class="keywordflow">if</span> (!strcmp(resolution+(strlen(resolution)-3),<span class="stringliteral">"DMT"</span>) &amp;&amp;
01760       (caps-&gt;<a class="code" href="structlexmark__cap__t.html#o14">features</a> &amp; <a class="code" href="print-lexmark_8c.html#a51">LEXMARK_CAP_DMT</a>)) {
01761     use_dmt= 1;
01762 <span class="preprocessor">#ifdef DEBUG</span>
01763 <span class="preprocessor"></span>    stpi_erprintf(<span class="stringliteral">"lexmark: using drop modulation technology\n"</span>);
01764 <span class="preprocessor">#endif</span>
01765 <span class="preprocessor"></span>  }
01766 
01767   <span class="comment">/*</span>
01768 <span class="comment">  * Compute the output size...</span>
01769 <span class="comment">  */</span>
01770 
01771   out_width = <a class="code" href="group__vars.html#ga22">stp_get_width</a>(v);
01772   out_height = <a class="code" href="group__vars.html#ga24">stp_get_height</a>(v);
01773 
01774   <a class="code" href="print-pcl_8c.html#a135">internal_imageable_area</a>(v, 0, &amp;page_left, &amp;page_right,
01775                           &amp;page_bottom, &amp;page_top);
01776   left -= page_left;
01777   top -= page_top;
01778   page_width = page_right - page_left;
01779   page_height = page_bottom - page_top;
01780 
01781 <span class="preprocessor">#ifdef DEBUG</span>
01782 <span class="preprocessor"></span>  <a class="code" href="print-util_8c.html#a20">stp_erprintf</a>(<span class="stringliteral">"page_right %d, page_left %d, page_top %d, page_bottom %d, left %d, top %d\n"</span>,page_right, page_left, page_top, page_bottom,left, top);
01783 <span class="preprocessor">#endif</span>
01784 <span class="preprocessor"></span>
01785   image_height = <a class="code" href="group__image.html#ga3">stp_image_height</a>(image);
01786   image_width = <a class="code" href="group__image.html#ga2">stp_image_width</a>(image);
01787 
01788   <a class="code" href="group__papersize.html#ga13">stp_default_media_size</a>(v, &amp;n, &amp;page_true_height);
01789   <a class="code" href="print-lexmark_8c.html#a101">lxm3200_linetoeject</a> = (page_true_height * 1200) / 72;
01790 
01791 
01792   <span class="keywordflow">if</span> (!<a class="code" href="print-lexmark_8c.html#a142">lexmark_init_printer</a>(v, caps, printing_color,
01793                             media_source,
01794                             xdpi, ydpi, page_width, page_height,
01795                             top,left,use_dmt))
01796     <span class="keywordflow">return</span> 0;
01797 
01798   <span class="comment">/*</span>
01799 <span class="comment">  * Convert image size to printer resolution...</span>
01800 <span class="comment">  */</span>
01801 
01802   out_width  = xdpi * out_width / 72;
01803   out_height = ydpi * out_height / 72;
01804 
01805 <span class="preprocessor">#ifdef DEBUG</span>
01806 <span class="preprocessor"></span>
01807   <a class="code" href="print-util_8c.html#a20">stp_erprintf</a>(<span class="stringliteral">"border: left %ld, x_raster_res %d, offser_left %ld\n"</span>, left, caps-&gt;<a class="code" href="structlexmark__cap__t.html#o17">x_raster_res</a>, caps-&gt;<a class="code" href="structlexmark__cap__t.html#o15">offset_left_border</a>);
01808 <span class="preprocessor">#endif</span>
01809 <span class="preprocessor"></span>
01810   left = ((caps-&gt;<a class="code" href="structlexmark__cap__t.html#o17">x_raster_res</a> * left) / 72) + caps-&gt;<a class="code" href="structlexmark__cap__t.html#o15">offset_left_border</a>;
01811 
01812 <span class="preprocessor">#ifdef DEBUG</span>
01813 <span class="preprocessor"></span>  <a class="code" href="print-util_8c.html#a20">stp_erprintf</a>(<span class="stringliteral">"border: left %d\n"</span>, left);
01814 <span class="preprocessor">#endif</span>
01815 <span class="preprocessor"></span>
01816 
01817 
01818 <span class="preprocessor">#ifdef DEBUG</span>
01819 <span class="preprocessor"></span>  <span class="keywordflow">if</span> (doTestPrint == 1) {
01820     <a class="code" href="print-util_8c.html#a20">stp_erprintf</a>(<span class="stringliteral">"Start test print\n"</span>);
01821     testprint(&amp;td);
01822     out_width = td.x;
01823     out_height = td.y;
01824     <span class="keywordflow">if</span> (td.cols != 7) {
01825     printMode = <a class="code" href="print-lexmark_8c.html#a21">COLOR_MODE_K</a> | <a class="code" href="print-lexmark_8c.html#a24">COLOR_MODE_M</a> | <a class="code" href="print-lexmark_8c.html#a22">COLOR_MODE_C</a> | <a class="code" href="print-lexmark_8c.html#a23">COLOR_MODE_Y</a>;
01826     } <span class="keywordflow">else</span> {
01827     printMode = <a class="code" href="print-lexmark_8c.html#a21">COLOR_MODE_K</a> | <a class="code" href="print-lexmark_8c.html#a24">COLOR_MODE_M</a> | <a class="code" href="print-lexmark_8c.html#a22">COLOR_MODE_C</a> | <a class="code" href="print-lexmark_8c.html#a23">COLOR_MODE_Y</a> | <a class="code" href="print-lexmark_8c.html#a27">COLOR_MODE_LM</a> | <a class="code" href="print-lexmark_8c.html#a25">COLOR_MODE_LC</a>;
01828     }
01829   }
01830 <span class="preprocessor">#endif</span>
01831 <span class="preprocessor"></span>
01832  <span class="comment">/*</span>
01833 <span class="comment">  * Allocate memory for the raster data...</span>
01834 <span class="comment">  */</span>
01835 
01836   length = (out_width + 7) / 8;
01837 
01838 
01839 
01840   <span class="keywordflow">if</span> (use_dmt) {
01841     <span class="comment">/*    buf_length= length*2; */</span>
01842     buf_length= length;
01843   } <span class="keywordflow">else</span> {
01844     buf_length= length;
01845   }
01846 
01847 <span class="preprocessor">#ifdef DEBUG</span>
01848 <span class="preprocessor"></span>  <a class="code" href="print-util_8c.html#a20">stp_erprintf</a>(<span class="stringliteral">"lexmark: buflength is %d!\n"</span>,buf_length);
01849 <span class="preprocessor">#endif</span>
01850 <span class="preprocessor"></span>
01851 
01852   <span class="comment">/* Now we know the color which are used, let's get the memory for every color image */</span>
01853   cols.<a class="code" href="unionlexmark__linebufs__t.html#o8">p</a>.k = NULL;
01854   cols.<a class="code" href="unionlexmark__linebufs__t.html#o8">p</a>.c = NULL;
01855   cols.<a class="code" href="unionlexmark__linebufs__t.html#o8">p</a>.y = NULL;
01856   cols.<a class="code" href="unionlexmark__linebufs__t.html#o8">p</a>.m = NULL;
01857   cols.<a class="code" href="unionlexmark__linebufs__t.html#o8">p</a>.C = NULL;
01858   cols.<a class="code" href="unionlexmark__linebufs__t.html#o8">p</a>.M = NULL;
01859   cols.<a class="code" href="unionlexmark__linebufs__t.html#o8">p</a>.Y = NULL;
01860 
01861 
01862   <span class="keywordflow">if</span> ((printMode &amp; <a class="code" href="print-lexmark_8c.html#a22">COLOR_MODE_C</a>) == <a class="code" href="print-lexmark_8c.html#a22">COLOR_MODE_C</a>) {
01863     cols.<a class="code" href="unionlexmark__linebufs__t.html#o8">p</a>.c = <a class="code" href="group__util.html#ga29">stp_zalloc</a>(buf_length+10);
01864   }
01865   <span class="keywordflow">if</span> ((printMode &amp; <a class="code" href="print-lexmark_8c.html#a23">COLOR_MODE_Y</a>) == <a class="code" href="print-lexmark_8c.html#a23">COLOR_MODE_Y</a>) {
01866     cols.<a class="code" href="unionlexmark__linebufs__t.html#o8">p</a>.y = <a class="code" href="group__util.html#ga29">stp_zalloc</a>(buf_length+10);
01867   }
01868   <span class="keywordflow">if</span> ((printMode &amp; <a class="code" href="print-lexmark_8c.html#a24">COLOR_MODE_M</a>) == <a class="code" href="print-lexmark_8c.html#a24">COLOR_MODE_M</a>) {
01869     cols.<a class="code" href="unionlexmark__linebufs__t.html#o8">p</a>.m = <a class="code" href="group__util.html#ga29">stp_zalloc</a>(buf_length+10);
01870   }
01871   <span class="keywordflow">if</span> ((printMode &amp; <a class="code" href="print-lexmark_8c.html#a21">COLOR_MODE_K</a>) == <a class="code" href="print-lexmark_8c.html#a21">COLOR_MODE_K</a>) {
01872     cols.<a class="code" href="unionlexmark__linebufs__t.html#o8">p</a>.k = <a class="code" href="group__util.html#ga29">stp_zalloc</a>(buf_length+10);
01873   }
01874   <span class="keywordflow">if</span> ((printMode &amp; <a class="code" href="print-lexmark_8c.html#a25">COLOR_MODE_LC</a>) == <a class="code" href="print-lexmark_8c.html#a25">COLOR_MODE_LC</a>) {
01875     cols.<a class="code" href="unionlexmark__linebufs__t.html#o8">p</a>.C = <a class="code" href="group__util.html#ga29">stp_zalloc</a>(buf_length+10);
01876   }
01877   <span class="keywordflow">if</span> ((printMode &amp; <a class="code" href="print-lexmark_8c.html#a26">COLOR_MODE_LY</a>) == <a class="code" href="print-lexmark_8c.html#a26">COLOR_MODE_LY</a>) {
01878     cols.<a class="code" href="unionlexmark__linebufs__t.html#o8">p</a>.Y = <a class="code" href="group__util.html#ga29">stp_zalloc</a>(buf_length+10);
01879   }
01880   <span class="keywordflow">if</span> ((printMode &amp; <a class="code" href="print-lexmark_8c.html#a27">COLOR_MODE_LM</a>) == <a class="code" href="print-lexmark_8c.html#a27">COLOR_MODE_LM</a>) {
01881     cols.<a class="code" href="unionlexmark__linebufs__t.html#o8">p</a>.M = <a class="code" href="group__util.html#ga29">stp_zalloc</a>(buf_length+10);
01882   }
01883 
01884   <span class="keywordflow">if</span> (cols.<a class="code" href="unionlexmark__linebufs__t.html#o8">p</a>.k)
01885     {
01886       <span class="keywordflow">if</span> (cols.<a class="code" href="unionlexmark__linebufs__t.html#o8">p</a>.c)
01887         <a class="code" href="group__vars.html#ga32">stp_set_string_parameter</a>(v, <span class="stringliteral">"STPIOutputType"</span>, <span class="stringliteral">"KCMY"</span>);
01888       <span class="keywordflow">else</span>
01889         <a class="code" href="group__vars.html#ga32">stp_set_string_parameter</a>(v, <span class="stringliteral">"STPIOutputType"</span>, <span class="stringliteral">"Grayscale"</span>);
01890     }
01891   <span class="keywordflow">else</span>
01892     <a class="code" href="group__vars.html#ga32">stp_set_string_parameter</a>(v, <span class="stringliteral">"STPIOutputType"</span>, <span class="stringliteral">"CMY"</span>);
01893 
01894 <span class="preprocessor">#ifdef DEBUG</span>
01895 <span class="preprocessor"></span>  <a class="code" href="print-util_8c.html#a20">stp_erprintf</a>(<span class="stringliteral">"lexmark: driver will use colors "</span>);
01896   <span class="keywordflow">if</span> (cols.<a class="code" href="unionlexmark__linebufs__t.html#o8">p</a>.c)     <a class="code" href="group__util.html#ga19">stp_erputc</a>(<span class="charliteral">'c'</span>);
01897   <span class="keywordflow">if</span> (cols.<a class="code" href="unionlexmark__linebufs__t.html#o8">p</a>.C)     <a class="code" href="group__util.html#ga19">stp_erputc</a>(<span class="charliteral">'C'</span>);
01898   <span class="keywordflow">if</span> (cols.<a class="code" href="unionlexmark__linebufs__t.html#o8">p</a>.m)     <a class="code" href="group__util.html#ga19">stp_erputc</a>(<span class="charliteral">'m'</span>);
01899   <span class="keywordflow">if</span> (cols.<a class="code" href="unionlexmark__linebufs__t.html#o8">p</a>.M)     <a class="code" href="group__util.html#ga19">stp_erputc</a>(<span class="charliteral">'M'</span>);
01900   <span class="keywordflow">if</span> (cols.<a class="code" href="unionlexmark__linebufs__t.html#o8">p</a>.y)     <a class="code" href="group__util.html#ga19">stp_erputc</a>(<span class="charliteral">'y'</span>);
01901   <span class="keywordflow">if</span> (cols.<a class="code" href="unionlexmark__linebufs__t.html#o8">p</a>.Y)     <a class="code" href="group__util.html#ga19">stp_erputc</a>(<span class="charliteral">'Y'</span>);
01902   <span class="keywordflow">if</span> (cols.<a class="code" href="unionlexmark__linebufs__t.html#o8">p</a>.k)     <a class="code" href="group__util.html#ga19">stp_erputc</a>(<span class="charliteral">'k'</span>);
01903   <a class="code" href="print-util_8c.html#a20">stp_erprintf</a>(<span class="stringliteral">"\n"</span>);
01904 <span class="preprocessor">#endif</span>
01905 <span class="preprocessor"></span>
01906   <span class="comment">/* initialize soft weaveing */</span>
01907   privdata.<a class="code" href="structlexm__privdata__weave.html#o0">ink_parameter</a> = ink_parameter;
01908   privdata.<a class="code" href="structlexm__privdata__weave.html#o1">bidirectional</a> = <a class="code" href="print-lexmark_8c.html#a131">lexmark_print_bidirectional</a>(model, resolution);
01909   privdata.<a class="code" href="structlexm__privdata__weave.html#o14">outbuf</a> = <a class="code" href="group__util.html#ga28">stp_malloc</a>((((((pass_length/8)*11))+40) * out_width)+2000);
01910   privdata.<a class="code" href="structlexm__privdata__weave.html#o2">direction</a> = 0;
01911   <a class="code" href="group__vars.html#ga18">stp_allocate_component_data</a>(v, <span class="stringliteral">"Driver"</span>, NULL, NULL, &amp;privdata);
01912   <span class="comment">/*  lxm_nozzles_used = 1;*/</span>
01913 
01914   <a class="code" href="print-weave_8c.html#a23">stp_initialize_weave</a>(v,
01915                        pass_length, <span class="comment">/* jets */</span>
01916                        nozzle_separation, <span class="comment">/* separation */</span>
01917                        horizontal_passes, <span class="comment">/* h overample */</span>
01918                        res_para_ptr-&gt;<a class="code" href="structlexmark__res__t.html#o5">vertical_passes</a>, <span class="comment">/* v passes */</span>
01919                        res_para_ptr-&gt;<a class="code" href="structlexmark__res__t.html#o6">vertical_oversample</a>, <span class="comment">/* v oversample */</span>
01920                        ncolors, <span class="comment">/* colors */</span>
01921                        1, <span class="comment">/* bits/pixel */</span>
01922                        out_width, <span class="comment">/* line width */</span>
01923                        out_height,
01924                        ((top * ydpi) / 72)+(((caps-&gt;<a class="code" href="structlexmark__cap__t.html#o16">offset_top_border</a>+add_top_offset)*ydpi)
01925                                             /caps-&gt;<a class="code" href="structlexmark__cap__t.html#o18">y_raster_res</a>),
01926                        (page_height * ydpi) / 72,
01927                        (<span class="keyword">const</span> <span class="keywordtype">int</span> *) <a class="code" href="print-lexmark_8c.html#a128">lexmark_head_offset</a>(ydpi, ink_type, caps, ink_parameter, &amp;lineoff_buffer),
01928                        STP_WEAVE_ZIGZAG, <span class="comment">/* weave_strategy */</span>
01929                        flush_pass,
01930                        stp_fill_uncompressed,  <span class="comment">/* fill_start */</span>
01931                        stp_pack_uncompressed,  <span class="comment">/* pack */</span>
01932                        stp_compute_uncompressed_linewidth);  <span class="comment">/* compute_linewidth */</span>
01933   privdata.<a class="code" href="structlexm__privdata__weave.html#o9">last_pass_offset</a> = 0;
01934   privdata.<a class="code" href="structlexm__privdata__weave.html#o10">jets</a> = pass_length;
01935   privdata.<a class="code" href="structlexm__privdata__weave.html#o12">ncolors</a> = ncolors;
01936   privdata.<a class="code" href="structlexm__privdata__weave.html#o13">horizontal_weave</a> = horizontal_passes;
01937 
01938 
01939   <span class="keywordflow">if</span> (!<a class="code" href="group__vars.html#ga102">stp_check_float_parameter</a>(v, <span class="stringliteral">"Density"</span>, STP_PARAMETER_DEFAULTED))
01940     {
01941       <a class="code" href="group__vars.html#ga93">stp_set_float_parameter_active</a>(v, <span class="stringliteral">"Density"</span>, STP_PARAMETER_ACTIVE);
01942       <a class="code" href="group__vars.html#ga67">stp_set_float_parameter</a>(v, <span class="stringliteral">"Density"</span>, 1.0);
01943     }
01944 
01945 <span class="preprocessor">#ifdef DEBUG</span>
01946 <span class="preprocessor"></span>  <a class="code" href="print-util_8c.html#a20">stp_erprintf</a>(<span class="stringliteral">"density is %f\n"</span>,stp_get_parameter(v, <span class="stringliteral">"Density"</span>));
01947 <span class="preprocessor">#endif</span>
01948 <span class="preprocessor"></span>
01949 <span class="preprocessor">#ifdef DEBUG</span>
01950 <span class="preprocessor"></span>  <a class="code" href="print-util_8c.html#a20">stp_erprintf</a>(<span class="stringliteral">"density is %f and will be changed to %f  (%f)\n"</span>,
01951                 <a class="code" href="group__vars.html#ga70">stp_get_float_parameter</a>(v, <span class="stringliteral">"Density"</span>),
01952                 <a class="code" href="group__vars.html#ga70">stp_get_float_parameter</a>(v, <span class="stringliteral">"Density"</span>) / densityDivisor,
01953                 densityDivisor);
01954 <span class="preprocessor">#endif</span>
01955 <span class="preprocessor"></span>
01956   <span class="comment">/* Lexmark do not have differnet pixel sizes. We have to correct the density according the print resolution. */</span>
01957   <a class="code" href="group__vars.html#ga71">stp_scale_float_parameter</a>(v, <span class="stringliteral">"Density"</span>, 1.0 / densityDivisor);
01958 
01959 
01960   <span class="comment">/*</span>
01961 <span class="comment">   * Compute the LUT.  For now, it's 8 bit, but that may eventually</span>
01962 <span class="comment">   * sometimes change.</span>
01963 <span class="comment">   */</span>
01964   <span class="keywordflow">if</span> (ncolors &gt; 4)
01965     k_lower = .5;
01966   <span class="keywordflow">else</span>
01967     k_lower = .25;
01968 
01969   <span class="keywordflow">if</span> (media)
01970     {
01971       <a class="code" href="group__vars.html#ga71">stp_scale_float_parameter</a>(v, <span class="stringliteral">"Density"</span>, media-&gt;<a class="code" href="structpaper__t.html#o3">base_density</a>);
01972       <a class="code" href="group__vars.html#ga71">stp_scale_float_parameter</a>(v, <span class="stringliteral">"Cyan"</span>, media-&gt;<a class="code" href="structpaper__t.html#o26">p_cyan</a>);
01973       <a class="code" href="group__vars.html#ga71">stp_scale_float_parameter</a>(v, <span class="stringliteral">"Magenta"</span>, media-&gt;<a class="code" href="structpaper__t.html#o27">p_magenta</a>);
01974       <a class="code" href="group__vars.html#ga71">stp_scale_float_parameter</a>(v, <span class="stringliteral">"Yellow"</span>, media-&gt;<a class="code" href="structpaper__t.html#o28">p_yellow</a>);
01975       k_lower *= media-&gt;<a class="code" href="structpaper__t.html#o4">k_lower_scale</a>;
01976       k_upper  = media-&gt;<a class="code" href="structpaper__t.html#o5">k_upper</a>;
01977     }
01978   <span class="keywordflow">else</span>
01979     {
01980       <a class="code" href="group__vars.html#ga71">stp_scale_float_parameter</a>(v, <span class="stringliteral">"Density"</span>, .8);
01981       k_lower *= .1;
01982       k_upper = .5;
01983     }
01984   <span class="keywordflow">if</span> (<a class="code" href="group__vars.html#ga70">stp_get_float_parameter</a>(v, <span class="stringliteral">"Density"</span>) &gt; 1.0)
01985     <a class="code" href="group__vars.html#ga67">stp_set_float_parameter</a>(v, <span class="stringliteral">"Density"</span>, 1.0);
01986 
01987 <span class="preprocessor">#ifdef DEBUG</span>
01988 <span class="preprocessor"></span>  <a class="code" href="print-util_8c.html#a20">stp_erprintf</a>(<span class="stringliteral">"density is %f\n"</span>,<a class="code" href="group__vars.html#ga70">stp_get_float_parameter</a>(v, <span class="stringliteral">"Density"</span>));
01989 <span class="preprocessor">#endif</span>
01990 <span class="preprocessor"></span>
01991 
01992   <span class="keywordflow">if</span> (!<a class="code" href="group__vars.html#ga102">stp_check_float_parameter</a>(v, <span class="stringliteral">"GCRLower"</span>, STP_PARAMETER_ACTIVE))
01993     <a class="code" href="group__vars.html#ga68">stp_set_default_float_parameter</a>(v, <span class="stringliteral">"GCRLower"</span>, k_lower);
01994   <span class="keywordflow">if</span> (!<a class="code" href="group__vars.html#ga102">stp_check_float_parameter</a>(v, <span class="stringliteral">"GCRUpper"</span>, STP_PARAMETER_ACTIVE))
01995     <a class="code" href="group__vars.html#ga68">stp_set_default_float_parameter</a>(v, <span class="stringliteral">"GCRUpper"</span>, k_upper);
01996   <a class="code" href="dither-main_8c.html#a13">stp_dither_init</a>(v, image, out_width, xdpi, ydpi);
01997 
01998         <span class="comment">/*</span>
01999 <span class="comment">          stpi_dither_set_black_lower(dither, .8 / ((1 &lt;&lt; (use_dmt+1)) - 1));*/</span>
02000   <span class="comment">/*stpi_dither_set_black_levels(dither, 0.5, 0.5, 0.5);</span>
02001 <span class="comment">    stpi_dither_set_black_lower(dither, 0.4);*/</span>
02002   <span class="comment">/*</span>
02003 <span class="comment">    if (use_glossy_film)</span>
02004 <span class="comment">  */</span>
02005 
02006   <span class="keywordflow">if</span> (!use_dmt) {
02007     <span class="keywordflow">if</span> (cols.<a class="code" href="unionlexmark__linebufs__t.html#o8">p</a>.C)
02008       {
02009         <a class="code" href="dither-inks_8c.html#a11">stp_dither_set_inks_full</a>(v, STP_ECOLOR_C, 2, photo_dither_shades, 1.0,
02010                                   0.31 / .5);
02011       }
02012     <span class="keywordflow">if</span> (cols.<a class="code" href="unionlexmark__linebufs__t.html#o8">p</a>.M)
02013       {
02014         <a class="code" href="dither-inks_8c.html#a11">stp_dither_set_inks_full</a>(v, STP_ECOLOR_M, 2, photo_dither_shades, 1.0,
02015                                   0.61 / .97);
02016       }
02017     <span class="keywordflow">if</span> (cols.<a class="code" href="unionlexmark__linebufs__t.html#o8">p</a>.Y)
02018       {
02019         <a class="code" href="dither-inks_8c.html#a11">stp_dither_set_inks_full</a>(v, STP_ECOLOR_Y, 2, photo_dither_shades, 1.0,
02020                                   0.08);
02021       }
02022   }
02023 
02024   <a class="code" href="channel_8c.html#a7">stp_channel_set_density_adjustment</a>(v, STP_ECOLOR_K, 0,
02025                                      <a class="code" href="print-pcl_8c.html#a140">get_double_param</a>(v, <span class="stringliteral">"BlackDensity"</span>) *
02026                                      <a class="code" href="print-pcl_8c.html#a140">get_double_param</a>(v, <span class="stringliteral">"Density"</span>));
02027   <a class="code" href="channel_8c.html#a7">stp_channel_set_density_adjustment</a>(v, STP_ECOLOR_C, 0,
02028                                      <a class="code" href="print-pcl_8c.html#a140">get_double_param</a>(v, <span class="stringliteral">"CyanDensity"</span>) *
02029                                      <a class="code" href="print-pcl_8c.html#a140">get_double_param</a>(v, <span class="stringliteral">"Density"</span>));
02030   <a class="code" href="channel_8c.html#a7">stp_channel_set_density_adjustment</a>(v, STP_ECOLOR_M, 0,
02031                                      <a class="code" href="print-pcl_8c.html#a140">get_double_param</a>(v, <span class="stringliteral">"MagentaDensity"</span>) *
02032                                      <a class="code" href="print-pcl_8c.html#a140">get_double_param</a>(v, <span class="stringliteral">"Density"</span>));
02033   <a class="code" href="channel_8c.html#a7">stp_channel_set_density_adjustment</a>(v, STP_ECOLOR_Y, 0,
02034                                      <a class="code" href="print-pcl_8c.html#a140">get_double_param</a>(v, <span class="stringliteral">"YellowDensity"</span>) *
02035                                      <a class="code" href="print-pcl_8c.html#a140">get_double_param</a>(v, <span class="stringliteral">"Density"</span>));
02036   <span class="keywordflow">if</span> (!use_dmt) {
02037     <span class="keywordflow">if</span> (cols.<a class="code" href="unionlexmark__linebufs__t.html#o8">p</a>.C)
02038       {
02039         <a class="code" href="channel_8h.html#a3">stp_channel_set_density_adjustment</a>
02040           (v, <a class="code" href="dither_8h.html#a1">STP_ECOLOR_C</a>, 1, (<a class="code" href="print-pcl_8c.html#a140">get_double_param</a>(v, <span class="stringliteral">"CyanDensity"</span>) *
02041                             <a class="code" href="print-pcl_8c.html#a140">get_double_param</a>(v, <span class="stringliteral">"LightCyanTransition"</span>) *
02042                             <a class="code" href="print-pcl_8c.html#a140">get_double_param</a>(v, <span class="stringliteral">"Density"</span>)));
02043       }
02044     <span class="keywordflow">if</span> (cols.<a class="code" href="unionlexmark__linebufs__t.html#o8">p</a>.M)
02045       {
02046         <a class="code" href="channel_8h.html#a3">stp_channel_set_density_adjustment</a>
02047           (v, <a class="code" href="dither_8h.html#a2">STP_ECOLOR_M</a>, 1, (<a class="code" href="print-pcl_8c.html#a140">get_double_param</a>(v, <span class="stringliteral">"MagentaDensity"</span>) *
02048                             <a class="code" href="print-pcl_8c.html#a140">get_double_param</a>(v, <span class="stringliteral">"LightMagentaTransition"</span>) *
02049                             <a class="code" href="print-pcl_8c.html#a140">get_double_param</a>(v, <span class="stringliteral">"Density"</span>)));
02050       }
02051     <span class="keywordflow">if</span> (cols.<a class="code" href="unionlexmark__linebufs__t.html#o8">p</a>.Y)
02052       {
02053         <a class="code" href="channel_8h.html#a3">stp_channel_set_density_adjustment</a>
02054           (v, <a class="code" href="dither_8h.html#a3">STP_ECOLOR_Y</a>, 1, (<a class="code" href="print-pcl_8c.html#a140">get_double_param</a>(v, <span class="stringliteral">"YellowDensity"</span>) *
02055                             <a class="code" href="print-pcl_8c.html#a140">get_double_param</a>(v, <span class="stringliteral">"LightYellowTransition"</span>) *
02056                             <a class="code" href="print-pcl_8c.html#a140">get_double_param</a>(v, <span class="stringliteral">"Density"</span>)));
02057       }
02058   }
02059 
02060   <span class="comment">/*</span>
02061 <span class="comment">   * Output the page...</span>
02062 <span class="comment">  */</span>
02063 
02064   <span class="keywordflow">if</span> (!<a class="code" href="group__vars.html#ga106">stp_check_curve_parameter</a>(v, <span class="stringliteral">"HueMap"</span>, STP_PARAMETER_ACTIVE) &amp;&amp;
02065       media-&gt;<a class="code" href="structpaper__t.html#o6">hue_adjustment</a>)
02066     {
02067       hue_adjustment = <a class="code" href="group__util.html#ga2">stp_read_and_compose_curves</a>
02068         (<a class="code" href="print-lexmark_8c.html#a133">lexmark_hue_adjustment</a>(caps, v),
02069          media ? media-&gt;<a class="code" href="structpaper__t.html#o6">hue_adjustment</a> : NULL, <a class="code" href="group__curve.html#gga49a5">STP_CURVE_COMPOSE_ADD</a>, 384);
02070       <a class="code" href="group__vars.html#ga47">stp_set_curve_parameter</a>(v, <span class="stringliteral">"HueMap"</span>, hue_adjustment);
02071       <a class="code" href="group__curve.html#ga22">stp_curve_destroy</a>(hue_adjustment);
02072     }
02073   <span class="keywordflow">if</span> (!<a class="code" href="group__vars.html#ga106">stp_check_curve_parameter</a>(v, <span class="stringliteral">"LumMap"</span>, STP_PARAMETER_ACTIVE) &amp;&amp;
02074       media-&gt;<a class="code" href="structpaper__t.html#o7">lum_adjustment</a>)
02075     {
02076       lum_adjustment = <a class="code" href="group__util.html#ga2">stp_read_and_compose_curves</a>
02077         (<a class="code" href="print-lexmark_8c.html#a132">lexmark_lum_adjustment</a>(caps, v),
02078          media ? media-&gt;<a class="code" href="structpaper__t.html#o7">lum_adjustment</a> : NULL, <a class="code" href="group__curve.html#gga49a6">STP_CURVE_COMPOSE_MULTIPLY</a>, 384);
02079       <a class="code" href="group__vars.html#ga47">stp_set_curve_parameter</a>(v, <span class="stringliteral">"LumMap"</span>, lum_adjustment);
02080       <a class="code" href="group__curve.html#ga22">stp_curve_destroy</a>(lum_adjustment);
02081     }
02082   <span class="keywordflow">if</span> (!<a class="code" href="group__vars.html#ga106">stp_check_curve_parameter</a>(v, <span class="stringliteral">"SatMap"</span>, STP_PARAMETER_ACTIVE) &amp;&amp;
02083       media-&gt;<a class="code" href="structpaper__t.html#o8">sat_adjustment</a>)
02084     {
02085       sat_adjustment = <a class="code" href="group__util.html#ga2">stp_read_and_compose_curves</a>
02086         (<a class="code" href="print-lexmark_8c.html#a134">lexmark_sat_adjustment</a>(caps, v),
02087          media ? media-&gt;<a class="code" href="structpaper__t.html#o8">sat_adjustment</a> : NULL, <a class="code" href="group__curve.html#gga49a6">STP_CURVE_COMPOSE_MULTIPLY</a>, 384);
02088       <a class="code" href="group__vars.html#ga47">stp_set_curve_parameter</a>(v, <span class="stringliteral">"SatMap"</span>, sat_adjustment);
02089       <a class="code" href="group__curve.html#ga22">stp_curve_destroy</a>(sat_adjustment);
02090     }
02091 
02092   out_channels = <a class="code" href="group__color.html#ga13">stp_color_init</a>(v, image, 65536);
02093 
02094   <span class="comment">/* calculate the memory we need for one line of the printer image (hopefully we are right) */</span>
02095 <span class="preprocessor">#ifdef DEBUG</span>
02096 <span class="preprocessor"></span>  <a class="code" href="print-util_8c.html#a20">stp_erprintf</a>(<span class="stringliteral">"---------- buffer mem size = %d\n"</span>, (((((pass_length/8)*11)/10)+40) * out_width)+200);
02097 <span class="preprocessor">#endif</span>
02098 <span class="preprocessor"></span>
02099   errdiv  = image_height / out_height;
02100   errmod  = image_height % out_height;
02101   errval  = 0;
02102   errlast = -1;
02103   errline  = 0;
02104 
02105   <span class="keywordflow">if</span> (cols.<a class="code" href="unionlexmark__linebufs__t.html#o8">p</a>.k)
02106     <a class="code" href="dither-inks_8c.html#a7">stp_dither_add_channel</a>(v, cols.<a class="code" href="unionlexmark__linebufs__t.html#o8">p</a>.k, STP_ECOLOR_K, 0);
02107   <span class="keywordflow">if</span> (cols.<a class="code" href="unionlexmark__linebufs__t.html#o8">p</a>.c)
02108     <a class="code" href="dither-inks_8c.html#a7">stp_dither_add_channel</a>(v, cols.<a class="code" href="unionlexmark__linebufs__t.html#o8">p</a>.c, STP_ECOLOR_C, 0);
02109   <span class="keywordflow">if</span> (cols.<a class="code" href="unionlexmark__linebufs__t.html#o8">p</a>.C)
02110     <a class="code" href="dither-inks_8c.html#a7">stp_dither_add_channel</a>(v, cols.<a class="code" href="unionlexmark__linebufs__t.html#o8">p</a>.C, STP_ECOLOR_C, 1);
02111   <span class="keywordflow">if</span> (cols.<a class="code" href="unionlexmark__linebufs__t.html#o8">p</a>.m)
02112     <a class="code" href="dither-inks_8c.html#a7">stp_dither_add_channel</a>(v, cols.<a class="code" href="unionlexmark__linebufs__t.html#o8">p</a>.m, STP_ECOLOR_M, 0);
02113   <span class="keywordflow">if</span> (cols.<a class="code" href="unionlexmark__linebufs__t.html#o8">p</a>.M)
02114     <a class="code" href="dither-inks_8c.html#a7">stp_dither_add_channel</a>(v, cols.<a class="code" href="unionlexmark__linebufs__t.html#o8">p</a>.M, STP_ECOLOR_M, 1);
02115   <span class="keywordflow">if</span> (cols.<a class="code" href="unionlexmark__linebufs__t.html#o8">p</a>.y)
02116     <a class="code" href="dither-inks_8c.html#a7">stp_dither_add_channel</a>(v, cols.<a class="code" href="unionlexmark__linebufs__t.html#o8">p</a>.y, STP_ECOLOR_Y, 0);
02117   <span class="keywordflow">if</span> (cols.<a class="code" href="unionlexmark__linebufs__t.html#o8">p</a>.Y)
02118     <a class="code" href="dither-inks_8c.html#a7">stp_dither_add_channel</a>(v, cols.<a class="code" href="unionlexmark__linebufs__t.html#o8">p</a>.Y, STP_ECOLOR_Y, 1);
02119   privdata.<a class="code" href="structlexm__privdata__weave.html#o3">hoffset</a> = left;
02120   privdata.<a class="code" href="structlexm__privdata__weave.html#o6">ydpi</a> = ydpi;
02121   privdata.<a class="code" href="structlexm__privdata__weave.html#o4">model</a> = model;
02122   privdata.<a class="code" href="structlexm__privdata__weave.html#o5">width</a> = out_width;
02123   privdata.<a class="code" href="structlexm__privdata__weave.html#o7">xdpi</a> = xdpi;
02124   privdata.<a class="code" href="structlexm__privdata__weave.html#o8">physical_xdpi</a> = physical_xdpi;
02125 
02126   <span class="keywordflow">for</span> (y = 0; y &lt; out_height; y ++)
02127     {
02128       <span class="keywordtype">int</span> duplicate_line = 1;
02129 
02130       <span class="keywordflow">if</span> (errline != errlast)
02131         {
02132           errlast = errline;
02133           duplicate_line = 0;
02134           <span class="keywordflow">if</span> (<a class="code" href="group__color.html#ga14">stp_color_get_row</a>(v, image, errline, &amp;zero_mask))
02135             {
02136               status = 2;
02137               <span class="keywordflow">break</span>;
02138             }
02139         }
02140       <a class="code" href="dither-main_8c.html#a19">stp_dither</a>(v, y, duplicate_line, zero_mask, NULL);
02141       <a class="code" href="print-weave_8c.html#a47">stp_write_weave</a>(v, (<span class="keywordtype">unsigned</span> <span class="keywordtype">char</span> **)cols.<a class="code" href="unionlexmark__linebufs__t.html#o0">v</a>);
02142 
02143       errval += errmod;
02144       errline += errdiv;
02145       <span class="keywordflow">if</span> (errval &gt;= out_height)
02146         {
02147           errval -= out_height;
02148           errline ++;
02149         }
02150     }
02151   <a class="code" href="group__image.html#ga6">stp_image_conclude</a>(image);
02152 
02153   <a class="code" href="print-weave_8c.html#a45">stp_flush_all</a>(v);
02154 
02155   <a class="code" href="print-lexmark_8c.html#a143">lexmark_deinit_printer</a>(v, caps);
02156 
02157   <span class="comment">/*</span>
02158 <span class="comment">  * Cleanup...</span>
02159 <span class="comment">  */</span>
02160   <span class="keywordflow">if</span> (privdata.<a class="code" href="structlexm__privdata__weave.html#o14">outbuf</a> != NULL) {
02161     <a class="code" href="group__util.html#ga31">stp_free</a>(privdata.<a class="code" href="structlexm__privdata__weave.html#o14">outbuf</a>);<span class="comment">/* !!!!!!!!!!!!!! */</span>
02162   }
02163 
02164   <span class="keywordflow">for</span> (i = 0; i &lt; <a class="code" href="print-lexmark_8c.html#a8">NCHANNELS</a>; i++)
02165     <span class="keywordflow">if</span> (cols.<a class="code" href="unionlexmark__linebufs__t.html#o0">v</a>[i])
02166       <a class="code" href="group__util.html#ga31">stp_free</a>(cols.<a class="code" href="unionlexmark__linebufs__t.html#o0">v</a>[i]);
02167 
02168 <span class="preprocessor">#ifdef DEBUG</span>
02169 <span class="preprocessor"></span>  lex_tmp_file_deinit(dbgfileprn);
02170 <span class="preprocessor">#endif</span>
02171 <span class="preprocessor"></span>
02172   <span class="keywordflow">return</span> status;
02173 }
02174 
02175 <span class="keyword">static</span> <span class="keywordtype">int</span>
02176 <a class="code" href="print-lexmark_8c.html#a147">lexmark_print</a>(<span class="keyword">const</span> <a class="code" href="structstp__vars.html">stp_vars_t</a> *v, <a class="code" href="structstp__image.html">stp_image_t</a> *image)
02177 {
02178   <span class="keywordtype">int</span> status;
02179   <a class="code" href="structstp__vars.html">stp_vars_t</a> *nv = <a class="code" href="group__vars.html#ga78">stp_vars_create_copy</a>(v);
02180   <a class="code" href="group__util.html#ga77">stp_prune_inactive_options</a>(nv);
02181   status = <a class="code" href="print-lexmark_8c.html#a146">lexmark_do_print</a>(nv, image);
<a name="l02182"></a><a class="code" href="print-lexmark_8c.html#a147">02182</a>   <a class="code" href="group__vars.html#ga26">stp_vars_destroy</a>(nv);
02183   <span class="keywordflow">return</span> status;
02184 }
02185 
02186 <span class="keyword">static</span> <span class="keyword">const</span> <a class="code" href="structstp__printfuncs__t.html">stp_printfuncs_t</a> <a class="code" href="print-lexmark_8c.html#a110">print_lexmark_printfuncs</a> =
02187 {
02188   <a class="code" href="print-lexmark_8c.html#a136">lexmark_list_parameters</a>,
02189   <a class="code" href="print-lexmark_8c.html#a138">lexmark_parameters</a>,
02190   <a class="code" href="group__papersize.html#ga4">stp_default_media_size</a>,
02191   <a class="code" href="print-lexmark_8c.html#a140">lexmark_imageable_area</a>,
<a name="l02192"></a><a class="code" href="print-lexmark_8c.html#a110">02192</a>   <a class="code" href="print-lexmark_8c.html#a141">lexmark_limit</a>,
02193   <a class="code" href="print-lexmark_8c.html#a147">lexmark_print</a>,
02194   <a class="code" href="print-lexmark_8c.html#a135">lexmark_describe_resolution</a>,
02195   <a class="code" href="print-lexmark_8c.html#a137">lexmark_describe_output</a>,
02196   <a class="code" href="group__printer.html#ga19">stp_verify_printer_params</a>,
02197   NULL,
02198   NULL
02199 };
02200 
02201 
02202 
02203 <span class="comment">/* lexmark_init_line</span>
02204 <span class="comment">   This method is printer type dependent code.</span>
02205 <span class="comment"></span>
02206 <span class="comment">   This method initializes the line to be printed. It will set</span>
02207 <span class="comment">   the printer specific initialization which has to be done bofor</span>
02208 <span class="comment">   the pixels of the image could be printed.</span>
02209 <span class="comment">*/</span>
02210 <span class="keyword">static</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">char</span> *
02211 <a class="code" href="print-lexmark_8c.html#a148">lexmark_init_line</a>(<span class="keywordtype">int</span> mode, <span class="keywordtype">unsigned</span> <span class="keywordtype">char</span> *prnBuf,
02212                   <span class="keywordtype">int</span> pass_length,
02213                   <span class="keywordtype">int</span> offset,    <span class="comment">/* offset from left in 1/"x_raster_res" DIP (printer resolution)*/</span>
02214                   <span class="keywordtype">int</span> width, <span class="keywordtype">int</span> direction,
02215                   <span class="keyword">const</span> <a class="code" href="structlexmark__inkparam__t.html">lexmark_inkparam_t</a> *ink_parameter,
02216                   <span class="keyword">const</span> <a class="code" href="structlexmark__cap__t.html">lexmark_cap_t</a> *   caps          <span class="comment">/* I - Printer model */</span>
<a name="l02217"></a><a class="code" href="print-lexmark_8c.html#a148">02217</a>                   )
02218 {
02219   <span class="keywordtype">int</span> pos1 = 0;
02220   <span class="keywordtype">int</span> pos2 = 0;
02221   <span class="keywordtype">int</span> abspos, disp;
02222   <span class="keywordtype">int</span> hend = 0;
02223   <span class="keywordtype">int</span> header_size = 0;
02224 
02225 
02226   <span class="comment">/*  stp_erprintf("#### width %d, length %d, pass_length %d\n", width, length, pass_length);*/</span>
02227   <span class="comment">/* first, we wirte the line header */</span>
02228   <span class="keywordflow">switch</span>(caps-&gt;<a class="code" href="structlexmark__cap__t.html#o0">model</a>)  {
02229   <span class="keywordflow">case</span> <a class="code" href="print-lexmark_8c.html#a152a116">m_z52</a>:
02230   <span class="keywordflow">case</span> <a class="code" href="print-lexmark_8c.html#a152a117">m_z42</a>:
02231     <span class="keywordflow">if</span> (caps-&gt;<a class="code" href="structlexmark__cap__t.html#o0">model</a> == <a class="code" href="print-lexmark_8c.html#a152a116">m_z52</a>)
02232       {
02233         header_size = <a class="code" href="print-lexmark_8c.html#a68">LXM_Z52_HEADERSIZE</a>;
02234         memcpy(prnBuf, <a class="code" href="print-lexmark_8c.html#a96">outbufHeader_z52</a>, header_size);
02235       }
02236     <span class="keywordflow">if</span> (caps-&gt;<a class="code" href="structlexmark__cap__t.html#o0">model</a> == <a class="code" href="print-lexmark_8c.html#a152a117">m_z42</a>)
02237       {
02238         header_size = <a class="code" href="print-lexmark_8c.html#a69">LXM_Z42_HEADERSIZE</a>;
02239         memcpy(prnBuf, <a class="code" href="print-lexmark_8c.html#a97">outbufHeader_z42</a>, <a class="code" href="print-lexmark_8c.html#a69">LXM_Z42_HEADERSIZE</a>);
02240       }
02241 
02242     <span class="comment">/* K could only be present if black is printed only. */</span>
02243     <span class="keywordflow">if</span> ((mode &amp; <a class="code" href="print-lexmark_8c.html#a21">COLOR_MODE_K</a>) || (mode &amp; (<a class="code" href="print-lexmark_8c.html#a21">COLOR_MODE_K</a> | <a class="code" href="print-lexmark_8c.html#a25">COLOR_MODE_LC</a> | <a class="code" href="print-lexmark_8c.html#a27">COLOR_MODE_LM</a>))) {
02244 <span class="preprocessor">#ifdef DEBUG</span>
02245 <span class="preprocessor"></span>      <a class="code" href="print-util_8c.html#a20">stp_erprintf</a>(<span class="stringliteral">"set  photo/black catridge \n"</span>);
02246 <span class="preprocessor">#endif</span>
02247 <span class="preprocessor"></span>      prnBuf[<a class="code" href="print-lexmark_8c.html#a65">LX_Z52_COLOR_MODE_POS</a>] = <a class="code" href="print-lexmark_8c.html#a63">LX_Z52_BLACK_PRINT</a>;
02248 
02249       <span class="keywordflow">if</span> (direction) {
02250       } <span class="keywordflow">else</span> {
02251         offset += ink_parameter-&gt;<a class="code" href="structlexmark__inkparam__t.html#o5">h_direction_offset</a>;
02252       }
02253     } <span class="keywordflow">else</span> {
02254 <span class="preprocessor">#ifdef DEBUG</span>
02255 <span class="preprocessor"></span>      <a class="code" href="print-util_8c.html#a20">stp_erprintf</a>(<span class="stringliteral">"set color cartridge \n"</span>);
02256 <span class="preprocessor">#endif</span>
02257 <span class="preprocessor"></span>      prnBuf[<a class="code" href="print-lexmark_8c.html#a65">LX_Z52_COLOR_MODE_POS</a>] = <a class="code" href="print-lexmark_8c.html#a62">LX_Z52_COLOR_PRINT</a>;
02258 
02259       <span class="keywordflow">if</span> (direction) {
02260         offset += ink_parameter-&gt;<a class="code" href="structlexmark__inkparam__t.html#o4">h_catridge_offset</a>;
02261       } <span class="keywordflow">else</span> {
02262         offset += ink_parameter-&gt;<a class="code" href="structlexmark__inkparam__t.html#o4">h_catridge_offset</a> + ink_parameter-&gt;<a class="code" href="structlexmark__inkparam__t.html#o5">h_direction_offset</a>;
02263       }
02264     }
02265 
02266     <span class="keywordflow">switch</span> (mode &amp; <a class="code" href="print-lexmark_8c.html#a33">PRINT_MODE_MASK</a>) {
02267     <span class="keywordflow">case</span> <a class="code" href="print-lexmark_8c.html#a17">PRINT_MODE_300</a>:
02268       prnBuf[<a class="code" href="print-lexmark_8c.html#a66">LX_Z52_RESOLUTION_POS</a>] = <a class="code" href="print-lexmark_8c.html#a58">LX_Z52_300_DPI</a>;
02269       <span class="keywordflow">break</span>;
02270     <span class="keywordflow">case</span> <a class="code" href="print-lexmark_8c.html#a18">PRINT_MODE_600</a>:
02271       prnBuf[<a class="code" href="print-lexmark_8c.html#a66">LX_Z52_RESOLUTION_POS</a>] = <a class="code" href="print-lexmark_8c.html#a59">LX_Z52_600_DPI</a>;
02272       <span class="keywordflow">break</span>;
02273     <span class="keywordflow">case</span> <a class="code" href="print-lexmark_8c.html#a19">PRINT_MODE_1200</a>:
02274       prnBuf[<a class="code" href="print-lexmark_8c.html#a66">LX_Z52_RESOLUTION_POS</a>] = <a class="code" href="print-lexmark_8c.html#a60">LX_Z52_1200_DPI</a>;
02275       <span class="keywordflow">break</span>;
02276     <span class="keywordflow">case</span> <a class="code" href="print-lexmark_8c.html#a20">PRINT_MODE_2400</a>:
02277       prnBuf[<a class="code" href="print-lexmark_8c.html#a66">LX_Z52_RESOLUTION_POS</a>] = <a class="code" href="print-lexmark_8c.html#a61">LX_Z52_2400_DPI</a>;
02278       <span class="keywordflow">break</span>;
02279     }
02280 
02281 
02282     <span class="keywordflow">if</span> (direction) {
02283       prnBuf[<a class="code" href="print-lexmark_8c.html#a67">LX_Z52_PRINT_DIRECTION_POS</a>] = 1;
02284     } <span class="keywordflow">else</span> {
02285       prnBuf[<a class="code" href="print-lexmark_8c.html#a67">LX_Z52_PRINT_DIRECTION_POS</a>] = 2;
02286     }
02287 
02288     <span class="comment">/* set package count */</span>
02289     prnBuf[13] = (<span class="keywordtype">unsigned</span> <span class="keywordtype">char</span>)((width) &gt;&gt; 8);
02290     prnBuf[14] = (<span class="keywordtype">unsigned</span> <span class="keywordtype">char</span>)((width) &amp; 0xFF);
02291     <span class="comment">/* set horizontal offset */</span>
02292     prnBuf[15] =(<span class="keywordtype">unsigned</span> <span class="keywordtype">char</span>)(offset &gt;&gt; 8);
02293     prnBuf[16] =(<span class="keywordtype">unsigned</span> <span class="keywordtype">char</span>)(offset &amp; 0xFF);
02294 
02295     <span class="keywordflow">if</span> (caps-&gt;<a class="code" href="structlexmark__cap__t.html#o0">model</a> == <a class="code" href="print-lexmark_8c.html#a152a117">m_z42</a>) {
02296         <span class="keywordflow">switch</span>(mode &amp; <a class="code" href="print-lexmark_8c.html#a33">PRINT_MODE_MASK</a>) {
02297         <span class="keywordflow">case</span> <a class="code" href="print-lexmark_8c.html#a17">PRINT_MODE_300</a>:
02298                 hend = (width-1)*(2400/300);
02299                 <span class="keywordflow">break</span>;
02300         <span class="keywordflow">case</span> <a class="code" href="print-lexmark_8c.html#a18">PRINT_MODE_600</a>:
02301                 hend = (width-1)*(2400/600);
02302                 <span class="keywordflow">break</span>;
02303         <span class="keywordflow">case</span> <a class="code" href="print-lexmark_8c.html#a19">PRINT_MODE_1200</a>:
02304                 hend = (width-1)*(2400/1200);
02305                 <span class="keywordflow">break</span>;
02306         <span class="keywordflow">case</span> <a class="code" href="print-lexmark_8c.html#a20">PRINT_MODE_2400</a>:
02307                 hend = (width-1)*(2400/2400);
02308                 <span class="keywordflow">break</span>;
02309         }
02310         hend += offset;
02311         prnBuf[17] = (<span class="keywordtype">unsigned</span> <span class="keywordtype">char</span>)(hend &gt;&gt; 8);
02312         prnBuf[18] = (<span class="keywordtype">unsigned</span> <span class="keywordtype">char</span>)(hend &amp; 0xFF);
02313 
02314         prnBuf[10] = (pass_length==208 ? 0x1A : 0x18);
02315     }
02316 
02317     <span class="keywordflow">return</span> prnBuf + header_size;  <span class="comment">/* return the position where the pixels have to be written */</span>
02318     <span class="keywordflow">break</span>;
02319     <span class="keywordflow">case</span> <a class="code" href="print-lexmark_8c.html#a152a118">m_3200</a>:
02320       memcpy(prnBuf, <a class="code" href="print-lexmark_8c.html#a102">outbufHeader_3200</a>, <a class="code" href="print-lexmark_8c.html#a72">LXM_3200_HEADERSIZE</a>);
02321 
02322       offset = (offset - 60) * 4;
02323 
02324       <span class="comment">/* K could only be present if black is printed only. */</span>
02325       <span class="keywordflow">if</span>((mode &amp; <a class="code" href="print-lexmark_8c.html#a21">COLOR_MODE_K</a>) ||
02326          (mode &amp; (<a class="code" href="print-lexmark_8c.html#a21">COLOR_MODE_K</a> | <a class="code" href="print-lexmark_8c.html#a25">COLOR_MODE_LC</a> | <a class="code" href="print-lexmark_8c.html#a27">COLOR_MODE_LM</a>)))
02327         {
02328           disp = <a class="code" href="print-lexmark_8c.html#a70">LXM3200_LEFTOFFS</a>;
02329           prnBuf[2] = 0x00;
02330         }
02331       <span class="keywordflow">else</span>
02332         {
02333           disp = <a class="code" href="print-lexmark_8c.html#a71">LXM3200_RIGHTOFFS</a>;
02334           prnBuf[2] = 0x80;
02335         }
02336 
02337       <span class="keywordflow">if</span>(pass_length == 208)
02338         {
02339           prnBuf[2] |= 0x10;
02340         }
02341 
02342       <span class="keywordflow">switch</span>(mode &amp; <a class="code" href="print-lexmark_8c.html#a33">PRINT_MODE_MASK</a>)    {
02343         <span class="keywordflow">case</span> <a class="code" href="print-lexmark_8c.html#a17">PRINT_MODE_300</a>:
02344           prnBuf[2] |= 0x20;
02345           pos1 = offset + disp;
02346           pos2 = offset + (width * 4) + disp;
02347           <span class="keywordflow">break</span>;
02348 
02349         <span class="keywordflow">case</span> <a class="code" href="print-lexmark_8c.html#a18">PRINT_MODE_600</a>:
02350           prnBuf[2] |= 0x00;
02351           pos1 = offset + disp;
02352           pos2 = offset + (width * 2) + disp;
02353           <span class="keywordflow">break</span>;
02354 
02355         <span class="keywordflow">case</span> <a class="code" href="print-lexmark_8c.html#a19">PRINT_MODE_1200</a>:
02356           prnBuf[2] |= 0x40;
02357           pos1 = offset + disp;
02358           pos2 = (offset + width) + disp;
02359           <span class="keywordflow">break</span>;
02360         }
02361 
02362       <span class="keywordflow">if</span>(direction)
02363         prnBuf[2] |= 0x01;
02364       <span class="keywordflow">else</span>
02365         prnBuf[2] |= 0x00;
02366 
02367       <span class="comment">/* set package count */</span>
02368       prnBuf[3] = (<span class="keywordtype">unsigned</span> <span class="keywordtype">char</span>)((width) &gt;&gt; 8);
02369       prnBuf[4] = (<span class="keywordtype">unsigned</span> <span class="keywordtype">char</span>)((width) &amp; 0xff);
02370 
02371       <span class="comment">/* set horizontal offset */</span>
02372       prnBuf[21] = (<span class="keywordtype">unsigned</span> <span class="keywordtype">char</span>)(pos1 &gt;&gt; 8);
02373       prnBuf[22] = (<span class="keywordtype">unsigned</span> <span class="keywordtype">char</span>)(pos1 &amp; 0xFF);
02374 
02375       abspos = ((((pos2 - 3600) &gt;&gt; 3) &amp; 0xfff0) + 9);
02376       prnBuf[5] = (abspos-<a class="code" href="print-lexmark_8c.html#a100">lxm3200_headpos</a>) &gt;&gt; 8;
02377       prnBuf[6] = (abspos-<a class="code" href="print-lexmark_8c.html#a100">lxm3200_headpos</a>) &amp; 0xff;
02378 
02379       <a class="code" href="print-lexmark_8c.html#a100">lxm3200_headpos</a> = abspos;
02380 
02381       <span class="keywordflow">if</span>(<a class="code" href="print-lexmark_8c.html#a71">LXM3200_RIGHTOFFS</a> &gt; 4816)
02382         abspos = (((<a class="code" href="print-lexmark_8c.html#a71">LXM3200_RIGHTOFFS</a> - 4800) &gt;&gt; 3) &amp; 0xfff0);
02383       <span class="keywordflow">else</span>
02384         abspos = (((<a class="code" href="print-lexmark_8c.html#a71">LXM3200_RIGHTOFFS</a> - 3600) &gt;&gt; 3) &amp; 0xfff0);
02385 
02386       prnBuf[11] = (<a class="code" href="print-lexmark_8c.html#a100">lxm3200_headpos</a>-abspos) &gt;&gt; 8;
02387       prnBuf[12] = (<a class="code" href="print-lexmark_8c.html#a100">lxm3200_headpos</a>-abspos) &amp; 0xff;
02388 
02389       <a class="code" href="print-lexmark_8c.html#a100">lxm3200_headpos</a> = abspos;
02390 
02391       prnBuf[7] = (<span class="keywordtype">unsigned</span> <span class="keywordtype">char</span>)<a class="code" href="print-lexmark_8c.html#a121">lexmark_calc_3200_checksum</a>(&amp;prnBuf[0]);
02392       prnBuf[15] = (<span class="keywordtype">unsigned</span> <span class="keywordtype">char</span>)<a class="code" href="print-lexmark_8c.html#a121">lexmark_calc_3200_checksum</a>(&amp;prnBuf[8]);
02393       prnBuf[23] = (<span class="keywordtype">unsigned</span> <span class="keywordtype">char</span>)<a class="code" href="print-lexmark_8c.html#a121">lexmark_calc_3200_checksum</a>(&amp;prnBuf[16]);
02394 
02395       <span class="comment">/* return the position where the pixels have to be written */</span>
02396       <span class="keywordflow">return</span> prnBuf + <a class="code" href="print-lexmark_8c.html#a72">LXM_3200_HEADERSIZE</a>;
02397       <span class="keywordflow">break</span>;
02398 
02399   <span class="keywordflow">case</span> <a class="code" href="print-lexmark_8c.html#a152a115">m_lex7500</a>:
02400     <a class="code" href="print-util_8c.html#a20">stp_erprintf</a>(<span class="stringliteral">"Lexmark 7500 not supported !\n"</span>);
02401     <span class="keywordflow">return</span> NULL;
02402     <span class="keywordflow">break</span>;
02403   }
02404   <span class="keywordflow">return</span> NULL;
02405 }
02406 
02407 
02408 <span class="keyword">typedef</span> <span class="keyword">struct </span><a class="code" href="structLexmark__head__colors.html">Lexmark_head_colors</a> {
02409   <span class="keywordtype">int</span> v_start;
02410   <span class="keywordtype">unsigned</span> <span class="keywordtype">char</span> *line;
02411   <span class="keywordtype">int</span> head_nozzle_start;
02412   <span class="keywordtype">int</span> head_nozzle_end;
02413   <span class="keywordtype">int</span> used_jets;
<a name="l02414"></a><a class="code" href="structLexmark__head__colors.html">02414</a> } <a class="code" href="structLexmark__head__colors.html">Lexmark_head_colors</a>;
<a name="l02415"></a><a class="code" href="structLexmark__head__colors.html#o0">02415</a> 
<a name="l02416"></a><a class="code" href="structLexmark__head__colors.html#o1">02416</a> <span class="comment">/* lexmark_write</span>
<a name="l02417"></a><a class="code" href="structLexmark__head__colors.html#o2">02417</a> <span class="comment">   This method is has NO printer type dependent code.</span>
<a name="l02418"></a><a class="code" href="structLexmark__head__colors.html#o3">02418</a> <span class="comment">   This method writes a single line of the print. The line consits of "pass_length"</span>
<a name="l02419"></a><a class="code" href="structLexmark__head__colors.html#o4">02419</a> <span class="comment">   pixel lines (pixels, which could be printed with one pass by the printer.</span>
02420 <span class="comment">*/</span>
02421 
02422 
02423 <span class="keyword">static</span> <span class="keywordtype">int</span>
02424 <a class="code" href="print-lexmark_8c.html#a149">lexmark_write</a>(<span class="keyword">const</span> <a class="code" href="structstp__vars.html">stp_vars_t</a> *v,              <span class="comment">/* I - Print file or command */</span>
02425               <span class="keywordtype">unsigned</span> <span class="keywordtype">char</span> *prnBuf,      <span class="comment">/* mem block to buffer output */</span>
02426               <span class="keywordtype">int</span> *paperShift,
02427               <span class="keywordtype">int</span> direction,
02428               <span class="keywordtype">int</span> pass_length,       <span class="comment">/* num of inks to print */</span>
02429               <span class="keyword">const</span> <a class="code" href="structlexmark__cap__t.html">lexmark_cap_t</a> *   caps,             <span class="comment">/* I - Printer model */</span>
<a name="l02430"></a><a class="code" href="print-lexmark_8c.html#a149">02430</a>               <span class="keyword">const</span> <a class="code" href="structlexmark__inkparam__t.html">lexmark_inkparam_t</a> *ink_parameter,
02431               <span class="keywordtype">int</span> xdpi,
02432               <span class="keywordtype">int</span> yCount,
02433               <a class="code" href="structLexmark__head__colors.html">Lexmark_head_colors</a> *head_colors,
02434               <span class="keywordtype">int</span>           length,     <span class="comment">/* I - Length of bitmap data in bytes */</span>
02435               <span class="keywordtype">int</span>           mode,       <span class="comment">/* I - Which color */</span>
02436               <span class="keywordtype">int</span>           ydpi,               <span class="comment">/* I - Vertical resolution */</span>
02437               <span class="keywordtype">int</span>           width,      <span class="comment">/* I - Printed width in pixles */</span>
02438               <span class="keywordtype">int</span>           offset,     <span class="comment">/* I - Offset from left side in lexmark_cap_t.x_raster_res DPI */</span>
02439               <span class="keywordtype">int</span>           dmt)
02440 {
02441   <span class="keywordtype">unsigned</span> <span class="keywordtype">char</span> *tbits=NULL, *p=NULL;
02442   <span class="keywordtype">int</span> clen;
02443   <span class="keywordtype">int</span> x;  <span class="comment">/* actual vertical position */</span>
02444   <span class="keywordtype">int</span> y;  <span class="comment">/* actual horizontal position */</span>
02445   <span class="keywordtype">int</span> dy; <span class="comment">/* horiz. inkjet posintion */</span>
02446   <span class="keywordtype">int</span> x1;
02447   <span class="keywordtype">unsigned</span> <span class="keywordtype">short</span> pixelline;  <span class="comment">/* byte to be written */</span>
02448   <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> valid_bytes; <span class="comment">/* bit list which tells the present bytes */</span>
02449   <span class="keywordtype">int</span> xStart=0; <span class="comment">/* count start for horizontal line */</span>
02450   <span class="keywordtype">int</span> xEnd=0;
02451   <span class="keywordtype">int</span> xIter=0;  <span class="comment">/* count direction for horizontal line */</span>
02452   <span class="keywordtype">int</span> anyCol=0;
02453   <span class="keywordtype">int</span> colIndex;
02454   <span class="keywordtype">int</span> rwidth; <span class="comment">/* real with used at printing (includes shift between even &amp; odd nozzles) */</span>
02455 <span class="preprocessor">#ifdef DEBUG</span>
02456 <span class="preprocessor"></span>  <span class="comment">/* stp_erprintf("&lt;%c&gt;",("CMYKcmy"[coloridx])); */</span>
02457   <a class="code" href="print-util_8c.html#a20">stp_erprintf</a>(<span class="stringliteral">"pass length %d\n"</span>, pass_length);
02458 <span class="preprocessor">#endif</span>
02459 <span class="preprocessor"></span>
02460 
02461   <span class="comment">/* first, we check the length of the line an cut it if necessary. */</span>
02462   <span class="keywordflow">if</span> ((((width*caps-&gt;<a class="code" href="structlexmark__cap__t.html#o17">x_raster_res</a>)/xdpi)+offset) &gt; ((caps-&gt;<a class="code" href="structlexmark__cap__t.html#o1">max_paper_width</a>*caps-&gt;<a class="code" href="structlexmark__cap__t.html#o17">x_raster_res</a>)/72)) {
02463     <span class="comment">/* line too long !! Cut the line */</span>
02464 <span class="preprocessor">#ifdef DEBUG</span>
02465 <span class="preprocessor"></span>   <a class="code" href="print-util_8c.html#a20">stp_erprintf</a>(<span class="stringliteral">"!! Line too long !! reduce it from %d"</span>, width);
02466 <span class="preprocessor">#endif</span>
02467 <span class="preprocessor"></span>    width = ((((caps-&gt;<a class="code" href="structlexmark__cap__t.html#o1">max_paper_width</a>*caps-&gt;<a class="code" href="structlexmark__cap__t.html#o17">x_raster_res</a>)/72) - offset)*xdpi)/caps-&gt;<a class="code" href="structlexmark__cap__t.html#o17">x_raster_res</a>;
02468 <span class="preprocessor">#ifdef DEBUG</span>
02469 <span class="preprocessor"></span>   <a class="code" href="print-util_8c.html#a20">stp_erprintf</a>(<span class="stringliteral">" down to %d\n"</span>, width);
02470 <span class="preprocessor">#endif</span>
02471 <span class="preprocessor"></span>  }
02472 
02473 
02474   <span class="comment">/* we have to write the initial sequence for a line */</span>
02475 
02476 <span class="preprocessor">#ifdef DEBUG</span>
02477 <span class="preprocessor"></span>  <a class="code" href="print-util_8c.html#a20">stp_erprintf</a>(<span class="stringliteral">"lexmark: printer line initialized.\n"</span>);
02478 <span class="preprocessor">#endif</span>
02479 <span class="preprocessor"></span>
02480   <span class="keywordflow">if</span> (direction) {
02481     <span class="comment">/* left to right */</span>
02482     xStart = -<a class="code" href="print-lexmark_8c.html#a120">get_lr_shift</a>(mode);
02483     xEnd = width-1;
02484     xIter = 1;
02485     rwidth = xEnd - xStart;
02486   } <span class="keywordflow">else</span> {
02487     <span class="comment">/* right to left ! */</span>
02488     xStart = width-1;
02489     xEnd = -<a class="code" href="print-lexmark_8c.html#a120">get_lr_shift</a>(mode);
02490     rwidth = xStart - xEnd;
02491     xIter = -1;
02492   }
02493 
02494   p = <a class="code" href="print-lexmark_8c.html#a148">lexmark_init_line</a>(mode, prnBuf, pass_length, offset, rwidth,
02495                         direction,  <span class="comment">/* direction */</span>
02496                         ink_parameter, caps);
02497 
02498 
02499 <span class="preprocessor">#ifdef DEBUG</span>
02500 <span class="preprocessor"></span>  <a class="code" href="print-util_8c.html#a20">stp_erprintf</a>(<span class="stringliteral">"lexmark: xStart %d, xEnd %d, xIter %d.\n"</span>, xStart, xEnd, xIter);
02501 <span class="preprocessor">#endif</span>
02502 <span class="preprocessor"></span>
02503   <span class="comment">/* now we can start to write the pixels */</span>
02504   yCount = 2;
02505 
02506 
02507   <span class="keywordflow">for</span> (x=xStart; x != xEnd; x+=xIter) {
02508     <span class="keywordtype">int</span>  anyDots=0; <span class="comment">/* tells us if there was any dot to print */</span>
02509 
02510        <span class="keywordflow">switch</span>(caps-&gt;<a class="code" href="structlexmark__cap__t.html#o0">model</a>)      {
02511         <span class="keywordflow">case</span> <a class="code" href="print-lexmark_8c.html#a152a116">m_z52</a>:
02512           tbits = p;
02513           *(p++) = 0x3F;
02514           tbits[1] = 0; <span class="comment">/* here will be nice bitmap */</span>
02515           p++;
02516           <span class="keywordflow">break</span>;
02517 
02518         <span class="keywordflow">case</span> <a class="code" href="print-lexmark_8c.html#a152a118">m_3200</a>:
02519         <span class="keywordflow">case</span> <a class="code" href="print-lexmark_8c.html#a152a117">m_z42</a>:
02520           tbits = p;
02521           p += 4;
02522           <span class="keywordflow">break</span>;
02523 
02524         <span class="keywordflow">case</span> <a class="code" href="print-lexmark_8c.html#a152a115">m_lex7500</a>:
02525           <span class="keywordflow">break</span>;
02526         }
02527 
02528 
02529     pixelline =0;     <span class="comment">/* here we store 16 pixels */</span>
02530     valid_bytes = 0;  <span class="comment">/* for every valid word (16 bits) a corresponding bit will be set to 1. */</span>
02531 
02532     anyDots =0;
02533     x1 = x+<a class="code" href="print-lexmark_8c.html#a120">get_lr_shift</a>(mode);
02534 
02535     <span class="keywordflow">for</span> (colIndex=0; colIndex &lt; 3; colIndex++) {
02536       <span class="keywordflow">for</span> (dy=head_colors[colIndex].<a class="code" href="structLexmark__head__colors.html#o2">head_nozzle_start</a>,y=head_colors[colIndex].v_start*yCount;
02537            (dy &lt; head_colors[colIndex].head_nozzle_end);
02538            y+=yCount, dy++) { <span class="comment">/* we start counting with 1 !!!! */</span>
02539         <span class="keywordflow">if</span> (head_colors[colIndex].line != NULL) {
02540           pixelline = pixelline &lt;&lt; 1;
02541           <span class="keywordflow">if</span> ((x &gt;= 0) &amp;&amp;
02542               ((dy - head_colors[colIndex].head_nozzle_start) &lt; (head_colors[colIndex].used_jets/2)))
02543             pixelline = pixelline | ((head_colors[colIndex].line[(y*length)+(x/8)] &gt;&gt; (7-(x%8))) &amp; 0x1);
02544           pixelline = pixelline &lt;&lt; 1;
02545           <span class="keywordflow">if</span> ((x1 &lt; width) &amp;&amp;
02546               (((dy - head_colors[colIndex].head_nozzle_start)+1) &lt; (head_colors[colIndex].used_jets/2)))
02547             pixelline = pixelline | ((head_colors[colIndex].line[(((yCount&gt;&gt;1)+y)*length)+ (x1/8)] &gt;&gt; (7-(x1%8))) &amp; 0x1);
02548 
02549         } <span class="keywordflow">else</span> {
02550           pixelline = pixelline &lt;&lt; 2;
02551         }
02552         <span class="keywordflow">switch</span>(caps-&gt;<a class="code" href="structlexmark__cap__t.html#o0">model</a>)             {
02553         <span class="keywordflow">case</span> <a class="code" href="print-lexmark_8c.html#a152a116">m_z52</a>:
02554           <span class="keywordflow">if</span> ((dy%8) == 7) {
02555             <span class="comment">/* we have two bytes, write them */</span>
02556             anyDots |= pixelline;
02557             <span class="keywordflow">if</span> (pixelline) {
02558               <span class="comment">/* we have some dots */</span>
02559               valid_bytes = valid_bytes &gt;&gt; 1;
02560               *((p++)) = (<span class="keywordtype">unsigned</span> <span class="keywordtype">char</span>)(pixelline &gt;&gt; 8);
02561               *((p++)) = (<span class="keywordtype">unsigned</span> <span class="keywordtype">char</span>)(pixelline &amp; 0xff);
02562             } <span class="keywordflow">else</span> {
02563               <span class="comment">/* there are no dots ! */</span>
02564               valid_bytes = valid_bytes &gt;&gt; 1;
02565               valid_bytes |= 0x1000;
02566             }
02567             pixelline =0;
02568           }
02569           <span class="keywordflow">break</span>;
02570 
02571         <span class="keywordflow">case</span> <a class="code" href="print-lexmark_8c.html#a152a118">m_3200</a>:
02572         <span class="keywordflow">case</span> <a class="code" href="print-lexmark_8c.html#a152a117">m_z42</a>:
02573           <span class="keywordflow">if</span>((dy % 4) == 3)
02574             {
02575               anyDots |= pixelline;
02576               valid_bytes &lt;&lt;= 1;
02577 
02578               <span class="keywordflow">if</span>(pixelline)
02579                 *(p++) = (<span class="keywordtype">unsigned</span> <span class="keywordtype">char</span>)(pixelline &amp; 0xff);
02580               <span class="keywordflow">else</span>
02581                 valid_bytes |= 0x01;
02582 
02583               pixelline = 0;
02584             }
02585           <span class="keywordflow">break</span>;
02586 
02587         <span class="keywordflow">case</span> <a class="code" href="print-lexmark_8c.html#a152a115">m_lex7500</a>:
02588           <span class="keywordflow">break</span>;
02589         }
02590       }
02591     }
02592 
02593     <span class="keywordflow">switch</span>(caps-&gt;<a class="code" href="structlexmark__cap__t.html#o0">model</a>) {
02594     <span class="keywordflow">case</span> <a class="code" href="print-lexmark_8c.html#a152a116">m_z52</a>:
02595       <span class="keywordflow">if</span> (pass_length != 208) {
02596         valid_bytes = valid_bytes &gt;&gt; 1;
02597         valid_bytes |= 0x1000;
02598       }
02599       tbits[0] = 0x20 | ((<span class="keywordtype">unsigned</span> <span class="keywordtype">char</span>)((valid_bytes &gt;&gt; 8) &amp; 0x1f));
02600       tbits[1] = (<span class="keywordtype">unsigned</span> <span class="keywordtype">char</span>)(valid_bytes &amp; 0xff);
02601       <span class="keywordflow">break</span>;
02602 
02603     <span class="keywordflow">case</span> <a class="code" href="print-lexmark_8c.html#a152a117">m_z42</a>:
02604       <span class="keywordflow">if</span> ((p-tbits) &amp; 1) *(p++)=0; <span class="comment">/* z42 packets always have even length */</span>
02605       <span class="comment">/* fall through */</span>
02606     <span class="keywordflow">case</span> <a class="code" href="print-lexmark_8c.html#a152a118">m_3200</a>:
02607       tbits[0] = 0x80 | ((<span class="keywordtype">unsigned</span> <span class="keywordtype">char</span>)((valid_bytes &gt;&gt; 24) &amp; 0x1f));
02608       tbits[1] = (<span class="keywordtype">unsigned</span> <span class="keywordtype">char</span>)((valid_bytes &gt;&gt; 16) &amp; 0xff);
02609       tbits[2] = (<span class="keywordtype">unsigned</span> <span class="keywordtype">char</span>)((valid_bytes &gt;&gt; 8) &amp; 0xff);
02610       tbits[3] = (<span class="keywordtype">unsigned</span> <span class="keywordtype">char</span>)(valid_bytes &amp; 0xff);
02611       <span class="keywordflow">break</span>;
02612 
02613     <span class="keywordflow">case</span> <a class="code" href="print-lexmark_8c.html#a152a115">m_lex7500</a>:
02614       <span class="keywordflow">break</span>;
02615     }
02616 
02617 
02618     <span class="keywordflow">if</span> (anyDots) {
02619       anyCol = 1;
02620     } <span class="keywordflow">else</span> {
02621       <span class="comment">/* there are no dots, make empy package */</span>
02622 <span class="preprocessor">#ifdef DEBUG</span>
02623 <span class="preprocessor"></span>      <span class="comment">/*     stp_erprintf("-- empty col %i\n", x); */</span>
02624 <span class="preprocessor">#endif</span>
02625 <span class="preprocessor"></span>    }
02626   }
02627 
02628 <span class="preprocessor">#ifdef DEBUG</span>
02629 <span class="preprocessor"></span>  <a class="code" href="print-util_8c.html#a20">stp_erprintf</a>(<span class="stringliteral">"lexmark: 4\n"</span>);
02630 <span class="preprocessor">#endif</span>
02631 <span class="preprocessor"></span>
02632   clen=((<span class="keywordtype">unsigned</span> <span class="keywordtype">char</span> *)p)-prnBuf;
02633 
02634   <span class="keywordflow">switch</span>(caps-&gt;<a class="code" href="structlexmark__cap__t.html#o0">model</a>)    {
02635     <span class="keywordflow">case</span> <a class="code" href="print-lexmark_8c.html#a152a116">m_z52</a>:
02636     <span class="keywordflow">case</span> <a class="code" href="print-lexmark_8c.html#a152a117">m_z42</a>:
02637   prnBuf[<a class="code" href="print-lexmark_8c.html#a95">IDX_SEQLEN</a>]  =(<span class="keywordtype">unsigned</span> <span class="keywordtype">char</span>)(clen &gt;&gt; 24);
02638   prnBuf[<a class="code" href="print-lexmark_8c.html#a95">IDX_SEQLEN</a>+1]  =(<span class="keywordtype">unsigned</span> <span class="keywordtype">char</span>)(clen &gt;&gt; 16);
02639   prnBuf[<a class="code" href="print-lexmark_8c.html#a95">IDX_SEQLEN</a>+2]  =(<span class="keywordtype">unsigned</span> <span class="keywordtype">char</span>)(clen &gt;&gt; 8);
02640   prnBuf[<a class="code" href="print-lexmark_8c.html#a95">IDX_SEQLEN</a>+3]=(<span class="keywordtype">unsigned</span> <span class="keywordtype">char</span>)(clen &amp; 0xFF);
02641   <span class="keywordflow">break</span>;
02642 
02643   <span class="keywordflow">case</span> <a class="code" href="print-lexmark_8c.html#a152a118">m_3200</a>:
02644     prnBuf[18] = (<span class="keywordtype">unsigned</span> <span class="keywordtype">char</span>)((clen - <a class="code" href="print-lexmark_8c.html#a72">LXM_3200_HEADERSIZE</a>) &gt;&gt; 16);
02645     prnBuf[19] = (<span class="keywordtype">unsigned</span> <span class="keywordtype">char</span>)((clen - <a class="code" href="print-lexmark_8c.html#a72">LXM_3200_HEADERSIZE</a>) &gt;&gt; 8);
02646     prnBuf[20] = (<span class="keywordtype">unsigned</span> <span class="keywordtype">char</span>)((clen - <a class="code" href="print-lexmark_8c.html#a72">LXM_3200_HEADERSIZE</a>) &amp; 0xff);
02647     prnBuf[23] = (<span class="keywordtype">unsigned</span> <span class="keywordtype">char</span>)<a class="code" href="print-lexmark_8c.html#a121">lexmark_calc_3200_checksum</a>(&amp;prnBuf[16]);
02648     <span class="keywordflow">break</span>;
02649 
02650   <span class="keywordflow">default</span>:
02651     <span class="keywordflow">break</span>;
02652   }
02653 
02654   <span class="keywordflow">if</span> (anyCol) {
02655     <span class="comment">/* fist, move the paper */</span>
02656     <a class="code" href="print-lexmark_8c.html#a144">paper_shift</a>(v, (*paperShift), caps);
02657     *paperShift=0;
02658 
02659     <span class="comment">/* now we write the image line */</span>
02660     <a class="code" href="group__util.html#ga10">stp_zfwrite</a>((<span class="keyword">const</span> <span class="keywordtype">char</span> *)prnBuf,1,clen,v);
02661 <span class="preprocessor">#ifdef DEBUG</span>
02662 <span class="preprocessor"></span>    lex_write_tmp_file(dbgfileprn, (<span class="keywordtype">void</span> *)prnBuf,clen);
02663     <a class="code" href="print-util_8c.html#a20">stp_erprintf</a>(<span class="stringliteral">"lexmark: line written.\n"</span>);
02664 <span class="preprocessor">#endif</span>
02665 <span class="preprocessor"></span>    <span class="keywordflow">return</span> 1;
02666   } <span class="keywordflow">else</span> {
02667 <span class="preprocessor">#ifdef DEBUG</span>
02668 <span class="preprocessor"></span>    <a class="code" href="print-util_8c.html#a20">stp_erprintf</a>(<span class="stringliteral">"-- empty line\n"</span>);
02669 <span class="preprocessor">#endif</span>
02670 <span class="preprocessor"></span>    <span class="keywordflow">return</span> 0;
02671   }
02672 
02673   <span class="comment">/* Send a line of raster graphics... */</span>
02674 
02675   <span class="keywordflow">return</span> 0;
02676 }
02677 
02678 
02679 
02680 <span class="preprocessor">#ifdef DEBUG</span>
02681 <span class="preprocessor"></span><span class="keyword">const</span> <a class="code" href="structstp__vars.html">stp_vars_t</a> *lex_open_tmp_file() {
02682   <span class="keywordtype">int</span> i;
02683   <span class="keyword">const</span> <a class="code" href="structstp__vars.html">stp_vars_t</a> *ofile;
02684   <span class="keywordtype">char</span> tmpstr[256];
02685 
02686       <a class="code" href="print-util_8c.html#a20">stp_erprintf</a>(<span class="stringliteral">" create file !\n"</span>);
02687   <span class="keywordflow">for</span> (i=0, sprintf(tmpstr, <span class="stringliteral">"/tmp/xx%d.prn"</span>, i), ofile = fopen(tmpstr, <span class="stringliteral">"r"</span>);
02688        ofile != NULL;
02689        i++, sprintf(tmpstr, <span class="stringliteral">"/tmp/xx%d.prn"</span>, i), ofile = fopen(tmpstr, <span class="stringliteral">"r"</span>)) {
02690     <span class="keywordflow">if</span> (ofile != NULL)
02691       {
02692         fclose(ofile);
02693       }
02694   }
02695       <a class="code" href="print-util_8c.html#a20">stp_erprintf</a>(<span class="stringliteral">"Create file %s !\n"</span>, tmpstr);
02696   ofile = fopen(tmpstr, <span class="stringliteral">"wb"</span>);
02697   <span class="keywordflow">if</span> (ofile == NULL)
02698     {
02699       <a class="code" href="print-util_8c.html#a20">stp_erprintf</a>(<span class="stringliteral">"Can't create file !\n"</span>);
02700       <a class="code" href="group__util.html#ga3">stp_abort</a>();
02701     }
02702   <span class="keywordflow">return</span> ofile;
02703 }
02704 
02705 <span class="keywordtype">void</span> lex_tmp_file_deinit(<span class="keyword">const</span> <a class="code" href="structstp__vars.html">stp_vars_t</a> *file) {
02706   <a class="code" href="print-util_8c.html#a20">stp_erprintf</a>(<span class="stringliteral">"Close file %lx\n"</span>, file);
02707   fclose(file);
02708 }
02709 
02710 <span class="keyword">const</span> <a class="code" href="structstp__vars.html">stp_vars_t</a> *lex_write_tmp_file(<span class="keyword">const</span> <a class="code" href="structstp__vars.html">stp_vars_t</a> *ofile, <span class="keywordtype">void</span> *data,<span class="keywordtype">int</span> length) {
02711   fwrite(data, 1, length, ofile);
02712 }
02713 
02714 
02715 <span class="preprocessor">#endif</span>
02716 <span class="preprocessor"></span>
02717 
02718 <span class="keyword">static</span> <span class="keywordtype">void</span>
02719 <a class="code" href="print-lexmark_8c.html#a119">flush_pass</a>(<a class="code" href="structstp__vars.html">stp_vars_t</a> *v, <span class="keywordtype">int</span> passno, <span class="keywordtype">int</span> vertical_subpass)
02720 {
02721   <a class="code" href="structstp__lineoff__t.html">stp_lineoff_t</a>        *lineoffs   = <a class="code" href="print-weave_8c.html#a32">stp_get_lineoffsets_by_pass</a>(v, passno);
02722   <a class="code" href="structstp__lineactive__t.html">stp_lineactive_t</a>     *lineactive = <a class="code" href="print-weave_8c.html#a33">stp_get_lineactive_by_pass</a>(v, passno);
02723   <span class="keyword">const</span> <a class="code" href="structstp__linebufs__t.html">stp_linebufs_t</a> *bufs       = <a class="code" href="print-weave_8c.html#a35">stp_get_linebases_by_pass</a>(v, passno);
02724   <a class="code" href="structstp__pass__t.html">stp_pass_t</a>           *pass       = <a class="code" href="print-weave_8c.html#a36">stp_get_pass_by_pass</a>(v, passno);
<a name="l02725"></a><a class="code" href="print-lexmark_8c.html#a119">02725</a>   <a class="code" href="structstp__linecount__t.html">stp_linecount_t</a>      *linecount  = <a class="code" href="print-weave_8c.html#a34">stp_get_linecount_by_pass</a>(v, passno);
02726   <a class="code" href="structlexm__privdata__weave.html">lexm_privdata_weave</a> *pd =
02727     (<a class="code" href="structlexm__privdata__weave.html">lexm_privdata_weave</a> *) <a class="code" href="group__vars.html#ga20">stp_get_component_data</a>(v, <span class="stringliteral">"Driver"</span>);
02728   <span class="keywordtype">int</span> width = pd-&gt;<a class="code" href="structlexm__privdata__weave.html#o5">width</a>;
02729   <span class="keywordtype">int</span> hoffset = pd-&gt;<a class="code" href="structlexm__privdata__weave.html#o3">hoffset</a>;
02730   <span class="keywordtype">int</span> model = pd-&gt;<a class="code" href="structlexm__privdata__weave.html#o4">model</a>;
02731   <span class="keywordtype">int</span> xdpi = pd-&gt;<a class="code" href="structlexm__privdata__weave.html#o7">xdpi</a>;
02732   <span class="keywordtype">int</span> ydpi = pd-&gt;<a class="code" href="structlexm__privdata__weave.html#o6">ydpi</a>;
02733   <span class="keywordtype">int</span> physical_xdpi = pd-&gt;<a class="code" href="structlexm__privdata__weave.html#o8">physical_xdpi</a>;
02734   <span class="keywordtype">int</span> lwidth = (width + (pd-&gt;<a class="code" href="structlexm__privdata__weave.html#o13">horizontal_weave</a> - 1)) / pd-&gt;<a class="code" href="structlexm__privdata__weave.html#o13">horizontal_weave</a>;
02735   <span class="keywordtype">int</span> microoffset = vertical_subpass &amp; (pd-&gt;<a class="code" href="structlexm__privdata__weave.html#o13">horizontal_weave</a> - 1);
02736 
02737   <span class="keywordtype">int</span> prn_mode;
02738   <span class="keywordtype">int</span> j; <span class="comment">/* color counter */</span>
02739   <span class="keyword">const</span> <a class="code" href="structlexmark__cap__t.html">lexmark_cap_t</a> * caps= <a class="code" href="print-lexmark_8c.html#a123">lexmark_get_model_capabilities</a>(model);
02740   <span class="keywordtype">int</span> paperShift;
02741   <a class="code" href="structLexmark__head__colors.html">Lexmark_head_colors</a> head_colors[3]={{0, NULL,     0,  64/2, 64},
02742                                       {0, NULL,  64/2, 128/2, 64},
02743                                       {0, NULL, 128/2, 192/2, 64}};
02744 
02745 
02746 <span class="preprocessor">#ifdef DEBUG</span>
02747 <span class="preprocessor"></span>  <a class="code" href="print-util_8c.html#a20">stp_erprintf</a>(<span class="stringliteral">"Lexmark: flush_pass, here we are !\n"</span>);
02748   <a class="code" href="print-util_8c.html#a20">stp_erprintf</a>(<span class="stringliteral">"  passno %i, pd-&gt;ncolors %i, width %d, lwidth %d, linecount k % d, linecount m % d, bitwidth %d\n"</span>,
02749                passno, pd-&gt;<a class="code" href="structlexm__privdata__weave.html#o12">ncolors</a>, width, lwidth, <span class="comment">/*linecount[0].p.k, linecount[0].p.m,*/</span> pd-&gt;<a class="code" href="structlexm__privdata__weave.html#o11">bitwidth</a>);
02750   <a class="code" href="print-util_8c.html#a20">stp_erprintf</a>(<span class="stringliteral">"microoffset %d, vertical_subpass %d, pd-&gt;horizontal_weave %d\n"</span>, microoffset,vertical_subpass, pd-&gt;<a class="code" href="structlexm__privdata__weave.html#o13">horizontal_weave</a>);
02751 
02752   <a class="code" href="print-util_8c.html#a20">stp_erprintf</a>(<span class="stringliteral">"Lexmark: last_pass_offset %d, logicalpassstart %d\n"</span>, pd-&gt;<a class="code" href="structlexm__privdata__weave.html#o9">last_pass_offset</a>, pass-&gt;<a class="code" href="structstp__pass__t.html#o2">logicalpassstart</a>);
02753   <a class="code" href="print-util_8c.html#a20">stp_erprintf</a>(<span class="stringliteral">"Lexmark: vertical adapt: caps-&gt;y_raster_res %d, ydpi %d,  \n"</span>, caps-&gt;<a class="code" href="structlexmark__cap__t.html#o18">y_raster_res</a>, ydpi);
02754 
02755 <span class="preprocessor">#endif</span>
02756 <span class="preprocessor"></span>
02757   <span class="keywordflow">if</span> (1) { <span class="comment">/* wisi */</span>
02758 
02759 <span class="preprocessor">#ifdef DEBUG</span>
02760 <span class="preprocessor"></span>  <a class="code" href="print-util_8c.html#a20">stp_erprintf</a>(<span class="stringliteral">"1\n"</span>);
02761   <a class="code" href="print-util_8c.html#a20">stp_erprintf</a>(<span class="stringliteral">"\n"</span>);
02762   <a class="code" href="print-util_8c.html#a20">stp_erprintf</a>(<span class="stringliteral">"lineoffs[0].v[j]  %d\n"</span>, lineoffs[0].v[0]);
02763   <a class="code" href="print-util_8c.html#a20">stp_erprintf</a>(<span class="stringliteral">"lineoffs[0].v[j]  %d\n"</span>, lineoffs[0].v[1]);
02764 
02765 <span class="preprocessor">#endif</span>
02766 <span class="preprocessor"></span>
02767   <span class="keywordflow">switch</span> (physical_xdpi) {
02768   <span class="keywordflow">case</span> 300:
02769     prn_mode = <a class="code" href="print-lexmark_8c.html#a17">PRINT_MODE_300</a>;
02770     <span class="keywordflow">break</span>;
02771   <span class="keywordflow">case</span> 600:
02772     prn_mode = <a class="code" href="print-lexmark_8c.html#a18">PRINT_MODE_600</a>;
02773     <span class="keywordflow">break</span>;
02774   <span class="keywordflow">case</span> 1200:
02775     prn_mode = <a class="code" href="print-lexmark_8c.html#a19">PRINT_MODE_1200</a>;
02776     <span class="keywordflow">break</span>;
02777   <span class="keywordflow">default</span>:
02778 <span class="preprocessor">#ifdef DEBUG</span>
02779 <span class="preprocessor"></span>    <a class="code" href="print-util_8c.html#a20">stp_erprintf</a>(<span class="stringliteral">"Eror: Unsupported phys resolution (%d)\n"</span>, physical_xdpi);
02780 <span class="preprocessor">#endif</span>
02781 <span class="preprocessor"></span>    <span class="keywordflow">return</span>;
02782     <span class="keywordflow">break</span>;
02783   }
02784   <span class="comment">/* calculate paper shift and adapt actual resoution to physical positioning resolution */</span>
02785   paperShift = (pass-&gt;<a class="code" href="structstp__pass__t.html#o2">logicalpassstart</a> - pd-&gt;<a class="code" href="structlexm__privdata__weave.html#o9">last_pass_offset</a>) * (caps-&gt;<a class="code" href="structlexmark__cap__t.html#o18">y_raster_res</a>/ydpi);
02786 
02787 
02788       <span class="comment">/*** do we have to print something with the color cartridge ? ***/</span>
02789       <span class="keywordflow">if</span> ((<a class="code" href="dither_8h.html#a1">STP_ECOLOR_C</a> &lt; pd-&gt;<a class="code" href="structlexm__privdata__weave.html#o12">ncolors</a>) &amp;&amp; (lineactive[0].<a class="code" href="structstp__lineactive__t.html#o1">v</a>[<a class="code" href="dither_8h.html#a1">STP_ECOLOR_C</a>] &gt; 0))
02790         {
02791           head_colors[0].<a class="code" href="structLexmark__head__colors.html#o1">line</a> = bufs[0].<a class="code" href="structstp__linebufs__t.html#o1">v</a>[<a class="code" href="dither_8h.html#a1">STP_ECOLOR_C</a>];
02792           head_colors[0].<a class="code" href="structLexmark__head__colors.html#o4">used_jets</a> = linecount[0].<a class="code" href="structstp__linecount__t.html#o1">v</a>[<a class="code" href="dither_8h.html#a1">STP_ECOLOR_C</a>];
02793         }
02794       <span class="keywordflow">else</span>
02795         {
02796           head_colors[0].<a class="code" href="structLexmark__head__colors.html#o1">line</a> = NULL;
02797           head_colors[0].<a class="code" href="structLexmark__head__colors.html#o4">used_jets</a> = 0;
02798         }
02799 
02800       <span class="keywordflow">if</span> ((<a class="code" href="dither_8h.html#a2">STP_ECOLOR_M</a> &lt; pd-&gt;<a class="code" href="structlexm__privdata__weave.html#o12">ncolors</a>) &amp;&amp; (lineactive[0].<a class="code" href="structstp__lineactive__t.html#o1">v</a>[<a class="code" href="dither_8h.html#a2">STP_ECOLOR_M</a>] &gt; 0))
02801         {
02802           head_colors[1].<a class="code" href="structLexmark__head__colors.html#o1">line</a> = bufs[0].<a class="code" href="structstp__linebufs__t.html#o1">v</a>[<a class="code" href="dither_8h.html#a2">STP_ECOLOR_M</a>];
02803           head_colors[1].<a class="code" href="structLexmark__head__colors.html#o4">used_jets</a> = linecount[0].<a class="code" href="structstp__linecount__t.html#o1">v</a>[<a class="code" href="dither_8h.html#a2">STP_ECOLOR_M</a>];
02804         }
02805       <span class="keywordflow">else</span>
02806         {
02807           head_colors[1].<a class="code" href="structLexmark__head__colors.html#o1">line</a> = 0;
02808           head_colors[1].<a class="code" href="structLexmark__head__colors.html#o4">used_jets</a> = 0;
02809         }
02810 
02811       <span class="keywordflow">if</span> ((<a class="code" href="dither_8h.html#a3">STP_ECOLOR_Y</a> &lt; pd-&gt;<a class="code" href="structlexm__privdata__weave.html#o12">ncolors</a>) &amp;&amp; (lineactive[0].<a class="code" href="structstp__lineactive__t.html#o1">v</a>[<a class="code" href="dither_8h.html#a3">STP_ECOLOR_Y</a>] &gt; 0))
02812         {
02813           head_colors[2].<a class="code" href="structLexmark__head__colors.html#o1">line</a> = bufs[0].<a class="code" href="structstp__linebufs__t.html#o1">v</a>[<a class="code" href="dither_8h.html#a3">STP_ECOLOR_Y</a>];
02814           head_colors[2].<a class="code" href="structLexmark__head__colors.html#o4">used_jets</a> = linecount[0].<a class="code" href="structstp__linecount__t.html#o1">v</a>[<a class="code" href="dither_8h.html#a3">STP_ECOLOR_Y</a>];
02815         }
02816       <span class="keywordflow">else</span>
02817         {
02818           head_colors[2].<a class="code" href="structLexmark__head__colors.html#o1">line</a> = 0;
02819           head_colors[2].<a class="code" href="structLexmark__head__colors.html#o4">used_jets</a> = 0;
02820         }
02821 
02822       <span class="keywordflow">if</span> ((head_colors[0].<a class="code" href="structLexmark__head__colors.html#o1">line</a> != 0) || (head_colors[1].<a class="code" href="structLexmark__head__colors.html#o1">line</a> != 0) || (head_colors[2].<a class="code" href="structLexmark__head__colors.html#o1">line</a> != 0)) {
02823 
02824 
02825 
02826 <span class="preprocessor">#ifdef DEBUG</span>
02827 <span class="preprocessor"></span>        <a class="code" href="print-util_8c.html#a20">stp_erprintf</a>(<span class="stringliteral">"lexmark_write: lwidth %d\n"</span>, lwidth);
02828 <span class="preprocessor">#endif</span>
02829 <span class="preprocessor"></span>        <a class="code" href="print-lexmark_8c.html#a149">lexmark_write</a>(v,                <span class="comment">/* I - Print file or command */</span>
02830                       pd-&gt;<a class="code" href="structlexm__privdata__weave.html#o14">outbuf</a>,<span class="comment">/*unsigned char *prnBuf,   mem block to buffer output */</span>
02831                       &amp;paperShift,           <span class="comment">/* int *paperShift, */</span>
02832                       pd-&gt;<a class="code" href="structlexm__privdata__weave.html#o2">direction</a>,                     <span class="comment">/* int direction, */</span>
02833                       pd-&gt;<a class="code" href="structlexm__privdata__weave.html#o10">jets</a>,       <span class="comment">/* num of inks to print */</span>
02834                       caps,                  <span class="comment">/* const lexmark_cap_t *   caps,       I - Printer model */</span>
02835                       pd-&gt;<a class="code" href="structlexm__privdata__weave.html#o0">ink_parameter</a>,
02836                       xdpi,                  <span class="comment">/* int xresolution, */</span>
02837                       2,                     <span class="comment">/* yCount,*/</span>
02838                       head_colors,           <span class="comment">/* Lexmark_head_colors *head_colors, */</span>
02839                       (lwidth+7)/8, <span class="comment">/* length,   I - Length of bitmap data of one line in bytes */</span>
02840                       prn_mode | COLOR_MODE_C | COLOR_MODE_Y | COLOR_MODE_M,       <span class="comment">/* mode,      I - Which color */</span>
02841                       ydpi,                  <span class="comment">/* ydpi,    I - Vertical resolution */</span>
02842                       lwidth,      <span class="comment">/* width,     I - Printed width in pixles*/</span>
02843                       hoffset+microoffset,   <span class="comment">/* offset  I - Offset from left side in x_raster_res DPI */</span>
02844                       0                      <span class="comment">/* dmt */</span>);
02845         <span class="keywordflow">if</span> (pd-&gt;<a class="code" href="structlexm__privdata__weave.html#o1">bidirectional</a>)
02846           pd-&gt;<a class="code" href="structlexm__privdata__weave.html#o2">direction</a> = (pd-&gt;<a class="code" href="structlexm__privdata__weave.html#o2">direction</a> +1) &amp; 1;
02847       }
02848 
02849 
02850       <span class="comment">/*** do we have to print somthing with black or photo cartridge ? ***/</span>
02851       <span class="comment">/* we print with the photo or black cartidge */</span>
02852 
02853     <span class="keywordflow">if</span> (pd-&gt;<a class="code" href="structlexm__privdata__weave.html#o10">jets</a> != 208)
02854       {
02855         <span class="comment">/* we have photo or black cartridge */</span>
02856         <span class="keywordflow">if</span> ((<a class="code" href="print-lexmark_8c.html#a1">STP_ECOLOR_LC</a> &lt; pd-&gt;<a class="code" href="structlexm__privdata__weave.html#o12">ncolors</a>) &amp;&amp; (lineactive[0].<a class="code" href="structstp__lineactive__t.html#o1">v</a>[<a class="code" href="print-lexmark_8c.html#a1">STP_ECOLOR_LC</a>] &gt; 0))
02857           {
02858             head_colors[0].<a class="code" href="structLexmark__head__colors.html#o1">line</a> = bufs[0].<a class="code" href="structstp__linebufs__t.html#o1">v</a>[<a class="code" href="print-lexmark_8c.html#a1">STP_ECOLOR_LC</a>];
02859             head_colors[0].<a class="code" href="structLexmark__head__colors.html#o4">used_jets</a> = linecount[0].<a class="code" href="structstp__linecount__t.html#o1">v</a>[<a class="code" href="print-lexmark_8c.html#a1">STP_ECOLOR_LC</a>];
02860           }
02861         <span class="keywordflow">else</span>
02862           {
02863             head_colors[0].<a class="code" href="structLexmark__head__colors.html#o1">line</a> = 0;
02864             head_colors[0].<a class="code" href="structLexmark__head__colors.html#o4">used_jets</a> = 0;
02865           }
02866 
02867             <span class="keywordflow">if</span> ((<a class="code" href="print-lexmark_8c.html#a2">STP_ECOLOR_LM</a> &lt; pd-&gt;<a class="code" href="structlexm__privdata__weave.html#o12">ncolors</a>) &amp;&amp; (lineactive[0].<a class="code" href="structstp__lineactive__t.html#o1">v</a>[<a class="code" href="print-lexmark_8c.html#a2">STP_ECOLOR_LM</a>] &gt; 0))
02868           {
02869             head_colors[1].<a class="code" href="structLexmark__head__colors.html#o1">line</a> = bufs[0].<a class="code" href="structstp__linebufs__t.html#o1">v</a>[<a class="code" href="print-lexmark_8c.html#a2">STP_ECOLOR_LM</a>];
02870             head_colors[1].<a class="code" href="structLexmark__head__colors.html#o4">used_jets</a> = linecount[0].<a class="code" href="structstp__linecount__t.html#o1">v</a>[<a class="code" href="print-lexmark_8c.html#a2">STP_ECOLOR_LM</a>];
02871           }
02872         <span class="keywordflow">else</span>
02873           {
02874             head_colors[1].<a class="code" href="structLexmark__head__colors.html#o1">line</a> = 0;
02875             head_colors[1].<a class="code" href="structLexmark__head__colors.html#o4">used_jets</a> = 0;
02876           }
02877 
02878             <span class="keywordflow">if</span> ((<a class="code" href="dither_8h.html#a0">STP_ECOLOR_K</a> &lt; pd-&gt;<a class="code" href="structlexm__privdata__weave.html#o12">ncolors</a>) &amp;&amp; (lineactive[0].<a class="code" href="structstp__lineactive__t.html#o1">v</a>[<a class="code" href="dither_8h.html#a0">STP_ECOLOR_K</a>] &gt; 0))
02879           {
02880             head_colors[2].<a class="code" href="structLexmark__head__colors.html#o1">line</a> = bufs[0].<a class="code" href="structstp__linebufs__t.html#o1">v</a>[<a class="code" href="dither_8h.html#a0">STP_ECOLOR_K</a>];
02881             head_colors[2].<a class="code" href="structLexmark__head__colors.html#o4">used_jets</a> = linecount[0].<a class="code" href="structstp__linecount__t.html#o1">v</a>[<a class="code" href="dither_8h.html#a0">STP_ECOLOR_K</a>];
02882           }
02883         <span class="keywordflow">else</span>
02884           {
02885             head_colors[2].<a class="code" href="structLexmark__head__colors.html#o1">line</a> = 0;
02886             head_colors[2].<a class="code" href="structLexmark__head__colors.html#o4">used_jets</a> = 0;
02887           }
02888       }
02889     <span class="keywordflow">else</span>
02890       {
02891         <span class="keywordflow">if</span> ((<a class="code" href="dither_8h.html#a0">STP_ECOLOR_K</a> &lt; pd-&gt;<a class="code" href="structlexm__privdata__weave.html#o12">ncolors</a>) &amp;&amp; (lineactive[0].<a class="code" href="structstp__lineactive__t.html#o1">v</a>[<a class="code" href="dither_8h.html#a0">STP_ECOLOR_K</a>] &gt; 0))
02892           {
02893             <span class="comment">/* we have black cartridge; we have to print with all 208 jets at once */</span>
02894             head_colors[0].<a class="code" href="structLexmark__head__colors.html#o1">line</a> = bufs[0].<a class="code" href="structstp__linebufs__t.html#o1">v</a>[<a class="code" href="dither_8h.html#a0">STP_ECOLOR_K</a>];
02895             head_colors[0].<a class="code" href="structLexmark__head__colors.html#o4">used_jets</a> = linecount[0].<a class="code" href="structstp__linecount__t.html#o1">v</a>[<a class="code" href="dither_8h.html#a0">STP_ECOLOR_K</a>];
02896             head_colors[0].<a class="code" href="structLexmark__head__colors.html#o2">head_nozzle_start</a> = 0;
02897             head_colors[0].<a class="code" href="structLexmark__head__colors.html#o3">head_nozzle_end</a> = pd-&gt;<a class="code" href="structlexm__privdata__weave.html#o10">jets</a>/2;
02898             head_colors[2].<a class="code" href="structLexmark__head__colors.html#o1">line</a> = NULL;
02899             head_colors[2].<a class="code" href="structLexmark__head__colors.html#o4">used_jets</a> = 0;
02900             head_colors[2].<a class="code" href="structLexmark__head__colors.html#o2">head_nozzle_start</a> = 0;
02901             head_colors[2].<a class="code" href="structLexmark__head__colors.html#o3">head_nozzle_end</a> = 0;
02902             head_colors[1].<a class="code" href="structLexmark__head__colors.html#o1">line</a> = NULL;
02903             head_colors[1].<a class="code" href="structLexmark__head__colors.html#o4">used_jets</a> = 0;
02904             head_colors[1].<a class="code" href="structLexmark__head__colors.html#o2">head_nozzle_start</a> = 0;
02905             head_colors[1].<a class="code" href="structLexmark__head__colors.html#o3">head_nozzle_end</a> = 0;
02906           }
02907         <span class="keywordflow">else</span>
02908           {
02909             head_colors[2].<a class="code" href="structLexmark__head__colors.html#o1">line</a> = NULL;
02910             head_colors[2].<a class="code" href="structLexmark__head__colors.html#o4">used_jets</a> = 0;
02911             head_colors[2].<a class="code" href="structLexmark__head__colors.html#o2">head_nozzle_start</a> = 0;
02912             head_colors[2].<a class="code" href="structLexmark__head__colors.html#o3">head_nozzle_end</a> = 0;
02913             head_colors[1].<a class="code" href="structLexmark__head__colors.html#o1">line</a> = NULL;
02914             head_colors[1].<a class="code" href="structLexmark__head__colors.html#o4">used_jets</a> = 0;
02915             head_colors[1].<a class="code" href="structLexmark__head__colors.html#o2">head_nozzle_start</a> = 0;
02916             head_colors[1].<a class="code" href="structLexmark__head__colors.html#o3">head_nozzle_end</a> = 0;
02917             head_colors[0].<a class="code" href="structLexmark__head__colors.html#o1">line</a> = NULL;
02918             head_colors[0].<a class="code" href="structLexmark__head__colors.html#o4">used_jets</a> = 0;
02919             head_colors[0].<a class="code" href="structLexmark__head__colors.html#o2">head_nozzle_start</a> = 0;
02920             head_colors[0].<a class="code" href="structLexmark__head__colors.html#o3">head_nozzle_end</a> = 0;
02921           }
02922       }
02923 
02924      <span class="keywordflow">if</span> ((head_colors[0].<a class="code" href="structLexmark__head__colors.html#o1">line</a> != 0) || (head_colors[1].<a class="code" href="structLexmark__head__colors.html#o1">line</a> != 0) || (head_colors[2].<a class="code" href="structLexmark__head__colors.html#o1">line</a> != 0)) {
02925 
02926     <a class="code" href="print-lexmark_8c.html#a149">lexmark_write</a>(v,            <span class="comment">/* I - Print file or command */</span>
02927                   pd-&gt;<a class="code" href="structlexm__privdata__weave.html#o14">outbuf</a>,<span class="comment">/*unsigned char *prnBuf,   mem block to buffer output */</span>
02928                   &amp;paperShift,           <span class="comment">/* int *paperShift, */</span>
02929                   pd-&gt;<a class="code" href="structlexm__privdata__weave.html#o2">direction</a>,             <span class="comment">/* int direction, */</span>
02930                   pd-&gt;<a class="code" href="structlexm__privdata__weave.html#o10">jets</a>,              <span class="comment">/* num of inks to print */</span>
02931                   caps,                  <span class="comment">/* const lexmark_cap_t *   caps,     I - Printer model */</span>
02932                   pd-&gt;<a class="code" href="structlexm__privdata__weave.html#o0">ink_parameter</a>,
02933                   xdpi,                  <span class="comment">/* int xresolution, */</span>
02934                   2,                     <span class="comment">/* yCount,*/</span>
02935                   head_colors,           <span class="comment">/* Lexmark_head_colors *head_colors, */</span>
02936                   (lwidth+7)/8, <span class="comment">/* length,       I - Length of bitmap data of one line in bytes */</span>
02937                   prn_mode | COLOR_MODE_LC | COLOR_MODE_LM | COLOR_MODE_K,       <span class="comment">/* mode,        I - Which color */</span>
02938                   ydpi,                  <span class="comment">/* ydpi,        I - Vertical resolution */</span>
02939                   lwidth,      <span class="comment">/* width,         I - Printed width in pixles*/</span>
02940                   hoffset+microoffset,   <span class="comment">/* offset  I - Offset from left side in x_raster_res DPI */</span>
02941                   0                      <span class="comment">/* dmt */</span>);
02942     <span class="keywordflow">if</span> (pd-&gt;<a class="code" href="structlexm__privdata__weave.html#o1">bidirectional</a>)
02943       {
02944         pd-&gt;<a class="code" href="structlexm__privdata__weave.html#o2">direction</a> = (pd-&gt;<a class="code" href="structlexm__privdata__weave.html#o2">direction</a> +1) &amp; 1;
02945       }
02946     }
02947   <span class="comment">/* store paper position in respect if there was a paper shift */</span>
02948   pd-&gt;<a class="code" href="structlexm__privdata__weave.html#o9">last_pass_offset</a> = pass-&gt;<a class="code" href="structstp__pass__t.html#o2">logicalpassstart</a> - (paperShift / (caps-&gt;<a class="code" href="structlexmark__cap__t.html#o18">y_raster_res</a>/ydpi));
02949   }
02950 
02951   <span class="keywordflow">for</span> (j = 0; j &lt; pd-&gt;<a class="code" href="structlexm__privdata__weave.html#o12">ncolors</a>; j++)
02952     {
02953       lineoffs[0].<a class="code" href="structstp__lineoff__t.html#o1">v</a>[j]  = 0;
02954       linecount[0].<a class="code" href="structstp__linecount__t.html#o1">v</a>[j] = 0;
02955     }
02956 
02957 <span class="preprocessor">#ifdef DEBUG</span>
02958 <span class="preprocessor"></span>  <a class="code" href="print-util_8c.html#a20">stp_erprintf</a>(<span class="stringliteral">"lexmark_write finished\n"</span>);
02959 <span class="preprocessor">#endif</span>
02960 <span class="preprocessor"></span>
02961 }
02962 
02963 
02964 
02965 
02966 
02967 <span class="preprocessor">#ifdef DEBUG</span>
02968 <span class="preprocessor"></span>
02969 <span class="keyword">static</span> <span class="keywordtype">void</span> testprint(<a class="code" href="classtestdata.html">testdata</a> *td)
02970 {
02971   <span class="keywordtype">int</span> icol, i;
02972   <span class="keywordtype">char</span> dummy1[256], dummy2[256];
02973   <a class="code" href="unionlexmark__linebufs__t.html">lexmark_linebufs_t</a> linebufs;
02974 
02975   <span class="comment">/* init */</span>
02976   <span class="keywordflow">for</span> (i=0; i &lt; (<span class="keyword">sizeof</span>(linebufs.<a class="code" href="unionlexmark__linebufs__t.html#o0">v</a>)/<span class="keyword">sizeof</span>(linebufs.<a class="code" href="unionlexmark__linebufs__t.html#o0">v</a>[0])); i++) {
02977     linebufs.<a class="code" href="unionlexmark__linebufs__t.html#o0">v</a>[i] = NULL;
02978   }
02979 
02980   <span class="comment">/*let's go */</span>
02981   td-&gt;ifile = fopen(<span class="stringliteral">"/t1.ppm"</span>, <span class="stringliteral">"rb"</span>);
02982   <span class="keywordflow">if</span> (td-&gt;ifile != NULL) {
02983     <span class="comment">/* find "{" */</span>
02984     fscanf(td-&gt;ifile, <span class="stringliteral">"%[^{]{%[^\"]\"%d %d %d %d\","</span>, dummy1, dummy2, &amp;(td-&gt;x), &amp;(td-&gt;y), &amp;(td-&gt;cols), &amp;(td-&gt;deep));
02985     td-&gt;cols -= 1; <span class="comment">/* we reduce it by one because fist color will be ignored */</span>
02986     td-&gt;input_line = (<span class="keywordtype">char</span> *)<a class="code" href="group__util.html#ga28">stp_malloc</a>(td-&gt;x+10);
02987     <a class="code" href="print-util_8c.html#a20">stp_erprintf</a>(<span class="stringliteral">"&lt;%s&gt; &lt;%s&gt;\n"</span>, dummy1, dummy2);
02988     <a class="code" href="print-util_8c.html#a20">stp_erprintf</a>(<span class="stringliteral">"%d %d %d %d\n"</span>, td-&gt;x, td-&gt;y, td-&gt;cols, td-&gt;deep);
02989     <span class="keywordflow">if</span> (td-&gt;cols &gt; 16) {
02990       <a class="code" href="print-util_8c.html#a20">stp_erprintf</a>(<span class="stringliteral">"too many colors !!\n"</span>);
02991       <span class="keywordflow">return</span>;
02992     }
02993 
02994     <span class="comment">/* read the colors */</span>
02995     fscanf(td-&gt;ifile, <span class="stringliteral">"%[^\"]\"%c       c %[^\"]\","</span>, dummy1, dummy2, dummy2); <span class="comment">/* jump over first color */</span>
02996     <span class="keywordflow">for</span> (icol=0; icol &lt; td-&gt;cols; icol++) {  <span class="comment">/* we ignor the first color. It is "no dot". */</span>
02997       fscanf(td-&gt;ifile, <span class="stringliteral">"%[^\"]\"%c     c %[^\"]\","</span>, dummy1, &amp;(td-&gt;colchar[icol]), dummy2);
02998       <a class="code" href="print-util_8c.html#a20">stp_erprintf</a>(<span class="stringliteral">"colchar %d &lt;%c&gt;\n"</span>, i, td-&gt;colchar[icol]);
02999     }
03000 
03001 
03002     <span class="keywordflow">if</span> (td-&gt;cols &gt; 5) {
03003       td-&gt;cols = 7;
03004       <span class="keywordflow">for</span> (icol=0; icol &lt; td-&gt;cols; icol++) {  <span class="comment">/* we ignor the first color. It is "no dot". */</span>
03005         linebufs.<a class="code" href="unionlexmark__linebufs__t.html#o0">v</a>[icol] = (<span class="keywordtype">char</span> *)<a class="code" href="group__util.html#ga28">stp_malloc</a>((td-&gt;x+7)/8); <span class="comment">/* allocate the color */</span>
03006       }
03007     } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (td-&gt;cols &gt; 4) {
03008       td-&gt;cols = 5;
03009       <span class="keywordflow">for</span> (icol=0; icol &lt; td-&gt;cols; icol++) {  <span class="comment">/* we ignor the first color. It is "no dot". */</span>
03010         linebufs.<a class="code" href="unionlexmark__linebufs__t.html#o0">v</a>[icol] = (<span class="keywordtype">char</span> *)<a class="code" href="group__util.html#ga28">stp_malloc</a>((td-&gt;x+7)/8); <span class="comment">/* allocate the color */</span>
03011       }
03012     } <span class="keywordflow">else</span> {
03013       td-&gt;cols = 1;
03014       linebufs.<a class="code" href="unionlexmark__linebufs__t.html#o0">v</a>[0] = (<span class="keywordtype">char</span> *)<a class="code" href="group__util.html#ga28">stp_malloc</a>((td-&gt;x+7)/8); <span class="comment">/* allocate the color */</span>
03015     }
03016   } <span class="keywordflow">else</span> {
03017     <a class="code" href="print-util_8c.html#a20">stp_erprintf</a>(<span class="stringliteral">"can't open file !\n"</span>);
03018   }
03019 }
03020 
03021 
03022 <span class="keyword">static</span> <span class="keywordtype">void</span> readtestprintline(<a class="code" href="classtestdata.html">testdata</a> *td, <a class="code" href="unionlexmark__linebufs__t.html">lexmark_linebufs_t</a> *linebufs)
03023 {
03024   <span class="keywordtype">char</span> dummy1[256];
03025   <span class="keywordtype">int</span> icol, ix;
03026 
03027   <a class="code" href="print-util_8c.html#a20">stp_erprintf</a>(<span class="stringliteral">"start readtestprintline\n"</span>);
03028   <span class="keywordflow">for</span> (icol=0; icol &lt; 7; icol++) {
03029     <span class="keywordflow">if</span> (linebufs-&gt;<a class="code" href="unionlexmark__linebufs__t.html#o0">v</a>[icol] != NULL) {
03030       memset(linebufs-&gt;<a class="code" href="unionlexmark__linebufs__t.html#o0">v</a>[icol], 0, (td-&gt;x+7)/8);  <span class="comment">/* clean line */</span>
03031     }
03032   }
03033   <a class="code" href="print-util_8c.html#a20">stp_erprintf</a>(<span class="stringliteral">"1 readtestprintline cols %d\n"</span>, td-&gt;cols);
03034 
03035 
03036   fscanf(td-&gt;ifile, <span class="stringliteral">"%[^\"]\"%[^\"]\","</span>, dummy1, td-&gt;input_line);
03037   <span class="keywordflow">for</span> (icol=0; icol &lt; td-&gt;cols; icol++) {
03038    <span class="keywordflow">for</span> (ix=0; ix &lt; td-&gt;x; ix++) {
03039       <span class="keywordflow">if</span> (td-&gt;input_line[ix] == td-&gt;colchar[icol]) {
03040         <span class="comment">/* set the dot */</span>
03041         <span class="keywordflow">if</span> (icol != 0) {
03042           linebufs-&gt;<a class="code" href="unionlexmark__linebufs__t.html#o0">v</a>[icol-1][ix/8] |= 1 &lt;&lt; (ix%8);
03043         } <span class="keywordflow">else</span> {
03044           <span class="comment">/* this is specific, we set ymc */</span>
03045           linebufs-&gt;<a class="code" href="unionlexmark__linebufs__t.html#o8">p</a>.y[ix/8] |= 1 &lt;&lt; (ix%8);
03046           linebufs-&gt;<a class="code" href="unionlexmark__linebufs__t.html#o8">p</a>.m[ix/8] |= 1 &lt;&lt; (ix%8);
03047           linebufs-&gt;<a class="code" href="unionlexmark__linebufs__t.html#o8">p</a>.c[ix/8] |= 1 &lt;&lt; (ix%8);
03048         }
03049       }
03050     }
03051   }
03052   <span class="comment">/* stp_erprintf("pixchar  &lt;%s&gt;&lt;%s&gt;\n",dummy1, td-&gt;input_line);*/</span>
03053 }
03054 
03055 <span class="preprocessor">#endif</span>
03056 <span class="preprocessor"></span>
03057 
03058 <span class="keyword">static</span> <a class="code" href="structstp__family.html">stp_family_t</a> <a class="code" href="print-lexmark_8c.html#a112">print_lexmark_module_data</a> =
03059   {
03060     &amp;<a class="code" href="print-lexmark_8c.html#a110">print_lexmark_printfuncs</a>,
03061     NULL
03062   };
03063 
<a name="l03064"></a><a class="code" href="print-lexmark_8c.html#a112">03064</a> <span class="keyword">static</span> <span class="keywordtype">int</span>
03065 <a class="code" href="print-lexmark_8c.html#a150">print_lexmark_module_init</a>(<span class="keywordtype">void</span>)
03066 {
03067   <span class="keywordflow">return</span> <a class="code" href="group__printer.html#ga46">stp_family_register</a>(<a class="code" href="print-lexmark_8c.html#a112">print_lexmark_module_data</a>.<a class="code" href="structstp__family.html#o1">printer_list</a>);
03068 }
03069 
03070 
<a name="l03071"></a><a class="code" href="print-lexmark_8c.html#a150">03071</a> <span class="keyword">static</span> <span class="keywordtype">int</span>
03072 <a class="code" href="print-lexmark_8c.html#a151">print_lexmark_module_exit</a>(<span class="keywordtype">void</span>)
03073 {
03074   <span class="keywordflow">return</span> <a class="code" href="group__printer.html#ga47">stp_family_unregister</a>(<a class="code" href="print-lexmark_8c.html#a112">print_lexmark_module_data</a>.<a class="code" href="structstp__family.html#o1">printer_list</a>);
03075 }
03076 
03077 
<a name="l03078"></a><a class="code" href="print-lexmark_8c.html#a151">03078</a> <span class="comment">/* Module header */</span>
03079 <span class="preprocessor">#define stp_module_version print_lexmark_LTX_stp_module_version</span>
03080 <span class="preprocessor"></span><span class="preprocessor">#define stp_module_data print_lexmark_LTX_stp_module_data</span>
03081 <span class="preprocessor"></span>
03082 <a class="code" href="structstp__module__version.html">stp_module_version_t</a> <a class="code" href="structstp__module__version.html">stp_module_version</a> = {0, 0};
03083 
03084 <a class="code" href="structstp__module.html">stp_module_t</a> <a class="code" href="print-canon_8c.html#a45">stp_module_data</a> =
<a name="l03085"></a><a class="code" href="print-lexmark_8c.html#a77">03085</a>   {
<a name="l03086"></a><a class="code" href="print-lexmark_8c.html#a78">03086</a>     <span class="stringliteral">"lexmark"</span>,
03087     VERSION,
<a name="l03088"></a><a class="code" href="print-lexmark_8c.html#a113">03088</a>     <span class="stringliteral">"Lexmark family driver"</span>,
03089     <a class="code" href="module_8h.html#a13a4">STP_MODULE_CLASS_FAMILY</a>,
<a name="l03090"></a><a class="code" href="print-lexmark_8c.html#a114">03090</a>     NULL,
03091     <a class="code" href="print-lexmark_8c.html#a150">print_lexmark_module_init</a>,
03092     <a class="code" href="print-lexmark_8c.html#a151">print_lexmark_module_exit</a>,
03093     (<span class="keywordtype">void</span> *) &amp;<a class="code" href="print-lexmark_8c.html#a112">print_lexmark_module_data</a>
03094   };
03095 
</pre></div><hr size="1"><address style="align: right;"><small>Generated on Wed Aug 25 07:56:14 2004 for libgimpprint API Reference by
<a href="http://www.doxygen.org/index.html">
<img src="doxygen.png" alt="doxygen" align="middle" border=0 > </a>1.3.6 </small></address>
</body>
</html>
