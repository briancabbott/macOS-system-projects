<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html><head><meta http-equiv="Content-Type" content="text/html;charset=iso-8859-1">
<title>libgimpprint API Reference: src/main/printers.c Source File</title>
<link href="doxygen.css" rel="stylesheet" type="text/css">
</head><body>
<!-- Generated by Doxygen 1.3.6 -->
<div class="qindex"><a class="qindex" href="index.html">Main&nbsp;Page</a> | <a class="qindex" href="modules.html">Modules</a> | <a class="qindex" href="classes.html">Alphabetical&nbsp;List</a> | <a class="qindex" href="annotated.html">Data&nbsp;Structures</a> | <a class="qindex" href="files.html">File&nbsp;List</a> | <a class="qindex" href="functions.html">Data&nbsp;Fields</a> | <a class="qindex" href="globals.html">Globals</a> | <a class="qindex" href="pages.html">Related&nbsp;Pages</a></div>
<h1>src/main/printers.c</h1><a href="printers_8c.html">Go to the documentation of this file.</a><div class="fragment"><pre>00001 <span class="comment">/*</span>
00002 <span class="comment"> * "$Id: printers_8c-source.html,v 1.1.1.2 2004/12/22 23:49:11 jlovell Exp $"</span>
00003 <span class="comment"> *</span>
00004 <span class="comment"> *   Print plug-in driver utility functions for the GIMP.</span>
00005 <span class="comment"> *</span>
00006 <span class="comment"> *   Copyright 1997-2000 Michael Sweet (mike@easysw.com) and</span>
00007 <span class="comment"> *      Robert Krawitz (rlk@alum.mit.edu)</span>
00008 <span class="comment"> *</span>
00009 <span class="comment"> *   This program is free software; you can redistribute it and/or modify it</span>
00010 <span class="comment"> *   under the terms of the GNU General Public License as published by the Free</span>
00011 <span class="comment"> *   Software Foundation; either version 2 of the License, or (at your option)</span>
00012 <span class="comment"> *   any later version.</span>
00013 <span class="comment"> *</span>
00014 <span class="comment"> *   This program is distributed in the hope that it will be useful, but</span>
00015 <span class="comment"> *   WITHOUT ANY WARRANTY; without even the implied warranty of MERCHANTABILITY</span>
00016 <span class="comment"> *   or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU General Public License</span>
00017 <span class="comment"> *   for more details.</span>
00018 <span class="comment"> *</span>
00019 <span class="comment"> *   You should have received a copy of the GNU General Public License</span>
00020 <span class="comment"> *   along with this program; if not, write to the Free Software</span>
00021 <span class="comment"> *   Foundation, Inc., 59 Temple Place - Suite 330, Boston, MA 02111-1307, USA.</span>
00022 <span class="comment"> */</span>
00023 
00024 <span class="comment">/*</span>
00025 <span class="comment"> * This file must include only standard C header files.  The core code must</span>
00026 <span class="comment"> * compile on generic platforms that don't support glib, gimp, gtk, etc.</span>
00027 <span class="comment"> */</span>
00028 
00029 <span class="preprocessor">#ifdef HAVE_CONFIG_H</span>
00030 <span class="preprocessor"></span><span class="preprocessor">#include &lt;config.h&gt;</span>
00031 <span class="preprocessor">#endif</span>
00032 <span class="preprocessor"></span><span class="preprocessor">#include &lt;<a class="code" href="gimp-print_8h.html">gimp-print/gimp-print.h</a>&gt;</span>
00033 <span class="preprocessor">#include "<a class="code" href="gimp-print-internal_8h.html">gimp-print-internal.h</a>"</span>
00034 <span class="preprocessor">#include &lt;<a class="code" href="gimp-print-intl-internal_8h.html">gimp-print/gimp-print-intl-internal.h</a>&gt;</span>
00035 <span class="preprocessor">#include &lt;math.h&gt;</span>
00036 <span class="preprocessor">#ifdef HAVE_LIMITS_H</span>
00037 <span class="preprocessor"></span><span class="preprocessor">#include &lt;limits.h&gt;</span>
00038 <span class="preprocessor">#endif</span>
00039 <span class="preprocessor"></span><span class="preprocessor">#include &lt;string.h&gt;</span>
00040 <span class="preprocessor">#include &lt;stdlib.h&gt;</span>
00041 
<a name="l00042"></a><a class="code" href="printers_8c.html#a0">00042</a> <span class="preprocessor">#define FMIN(a, b) ((a) &lt; (b) ? (a) : (b))</span>
00043 <span class="preprocessor"></span>
00044 
00045 <span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="printers_8c.html#a4">stpi_printer_freefunc</a>(<span class="keywordtype">void</span> *item);
00046 <span class="keyword">static</span> <span class="keyword">const</span> <span class="keywordtype">char</span>* <a class="code" href="printers_8c.html#a5">stpi_printer_namefunc</a>(<span class="keyword">const</span> <span class="keywordtype">void</span> *item);
00047 <span class="keyword">static</span> <span class="keyword">const</span> <span class="keywordtype">char</span>* <a class="code" href="printers_8c.html#a6">stpi_printer_long_namefunc</a>(<span class="keyword">const</span> <span class="keywordtype">void</span> *item);
00048 
<a name="l00049"></a><a class="code" href="printers_8c.html#a3">00049</a> <span class="keyword">static</span> <a class="code" href="structstp__list.html">stp_list_t</a> *printer_list = NULL;
00050 
<a name="l00051"></a><a class="code" href="structstp__printer.html">00051</a> <span class="keyword">struct </span><a class="code" href="structstp__printer.html">stp_printer</a>
00052 {
<a name="l00053"></a><a class="code" href="structstp__printer.html#o0">00053</a>   <span class="keyword">const</span> <span class="keywordtype">char</span> *driver;
<a name="l00054"></a><a class="code" href="structstp__printer.html#o1">00054</a>   <span class="keywordtype">char</span>       *long_name;        <span class="comment">/* Long name for UI */</span>
<a name="l00055"></a><a class="code" href="structstp__printer.html#o2">00055</a>   <span class="keywordtype">char</span>       *<a class="code" href="structstp__printer.html#o2">family</a>;           <span class="comment">/* Printer family */</span>
<a name="l00056"></a><a class="code" href="structstp__printer.html#o3">00056</a>   <span class="keywordtype">char</span>       *<a class="code" href="structstp__printer.html#o3">manufacturer</a>;     <span class="comment">/* Printer manufacturer */</span>
<a name="l00057"></a><a class="code" href="structstp__printer.html#o4">00057</a>   <span class="keywordtype">int</span>        model;             <span class="comment">/* Model number */</span>
<a name="l00058"></a><a class="code" href="structstp__printer.html#o5">00058</a>   <span class="keyword">const</span> <a class="code" href="structstp__printfuncs__t.html">stp_printfuncs_t</a> *printfuncs;
<a name="l00059"></a><a class="code" href="structstp__printer.html#o6">00059</a>   <a class="code" href="structstp__vars.html">stp_vars_t</a> *<a class="code" href="structstp__printer.html#o6">printvars</a>;
00060 };
00061 
00062 <span class="keyword">static</span> <span class="keywordtype">int</span>
<a name="l00063"></a><a class="code" href="printers_8c.html#a7">00063</a> <a class="code" href="printers_8c.html#a7">stpi_init_printer_list</a>(<span class="keywordtype">void</span>)
00064 {
00065   <span class="keywordflow">if</span>(printer_list)
00066     <a class="code" href="print-list_8c.html#a10">stp_list_destroy</a>(printer_list);
00067   printer_list = <a class="code" href="list_8h.html#a7">stp_list_create</a>();
00068   <a class="code" href="print-list_8c.html#a19">stp_list_set_freefunc</a>(printer_list, <a class="code" href="printers_8c.html#a4">stpi_printer_freefunc</a>);
00069   <a class="code" href="print-list_8c.html#a23">stp_list_set_namefunc</a>(printer_list, <a class="code" href="printers_8c.html#a5">stpi_printer_namefunc</a>);
00070   <a class="code" href="print-list_8c.html#a25">stp_list_set_long_namefunc</a>(printer_list, <a class="code" href="printers_8c.html#a6">stpi_printer_long_namefunc</a>);
00071   <span class="comment">/* stp_list_set_sortfunc(printer_list, stpi_printer_sortfunc); */</span>
00072 
00073   <span class="keywordflow">return</span> 0;
00074 }
00075 
00076 <span class="keywordtype">int</span>
<a name="l00077"></a><a class="code" href="group__printer.html#ga8">00077</a> <a class="code" href="group__printer.html#ga2">stp_printer_model_count</a>(<span class="keywordtype">void</span>)
00078 {
00079   <span class="keywordflow">if</span> (printer_list == NULL)
00080     {
00081       <a class="code" href="print-util_8c.html#a20">stp_erprintf</a>(<span class="stringliteral">"No printer drivers found: "</span>
00082                    <span class="stringliteral">"are STP_DATA_PATH and STP_MODULE_PATH correct?\n"</span>);
00083       <a class="code" href="printers_8c.html#a7">stpi_init_printer_list</a>();
00084     }
00085   <span class="keywordflow">return</span> <a class="code" href="print-list_8c.html#a11">stp_list_get_length</a>(printer_list);
00086 }
00087 
00088 <span class="keyword">static</span> <span class="keywordtype">void</span>
<a name="l00089"></a><a class="code" href="printers_8c.html#a9">00089</a> <a class="code" href="printers_8c.html#a9">null_printer</a>(<span class="keywordtype">void</span>)
00090 {
00091   <a class="code" href="print-util_8c.html#a20">stp_erprintf</a>(<span class="stringliteral">"Null stp_printer_t! Please report this bug.\n"</span>);
00092   <a class="code" href="group__util.html#ga3">stp_abort</a>();
00093 }
00094 
00095 <span class="keyword">static</span> <span class="keyword">inline</span> <span class="keywordtype">void</span>
<a name="l00096"></a><a class="code" href="printers_8c.html#a10">00096</a> <a class="code" href="printers_8c.html#a10">check_printer</a>(<span class="keyword">const</span> <a class="code" href="structstp__printer.html">stp_printer_t</a> *p)
00097 {
00098   <span class="keywordflow">if</span> (p == NULL)
00099     <a class="code" href="printers_8c.html#a9">null_printer</a>();
00100 }
00101 
00102 <span class="keyword">const</span> <a class="code" href="structstp__printer.html">stp_printer_t</a> *
<a name="l00103"></a><a class="code" href="group__printer.html#ga11">00103</a> <a class="code" href="group__printer.html#ga11">stp_get_printer_by_index</a>(<span class="keywordtype">int</span> idx)
00104 {
00105   <a class="code" href="structstp__list__item.html">stp_list_item_t</a> *printer;
00106   <span class="keywordflow">if</span> (printer_list == NULL)
00107     {
00108       <a class="code" href="print-util_8c.html#a20">stp_erprintf</a>(<span class="stringliteral">"No printer drivers found: "</span>
00109                    <span class="stringliteral">"are STP_DATA_PATH and STP_MODULE_PATH correct?\n"</span>);
00110       <a class="code" href="printers_8c.html#a7">stpi_init_printer_list</a>();
00111     }
00112   printer = <a class="code" href="print-list_8c.html#a14">stp_list_get_item_by_index</a>(printer_list, idx);
00113   <span class="keywordflow">if</span> (printer == NULL)
00114     <span class="keywordflow">return</span> NULL;
00115   <span class="keywordflow">return</span> (<span class="keyword">const</span> <a class="code" href="structstp__printer.html">stp_printer_t</a> *) <a class="code" href="print-list_8c.html#a33">stp_list_item_get_data</a>(printer);
00116 }
00117 
00118 <span class="keyword">static</span> <span class="keywordtype">void</span>
<a name="l00119"></a><a class="code" href="printers_8c.html#a4">00119</a> <a class="code" href="printers_8c.html#a4">stpi_printer_freefunc</a>(<span class="keywordtype">void</span> *item)
00120 {
00121   <a class="code" href="structstp__printer.html">stp_printer_t</a> *printer = (<a class="code" href="structstp__printer.html">stp_printer_t</a> *) item;
00122   <a class="code" href="group__util.html#ga31">stp_free</a>(printer-&gt;<a class="code" href="structstp__printer.html#o1">long_name</a>);
00123   <a class="code" href="group__util.html#ga31">stp_free</a>(printer-&gt;<a class="code" href="structstp__printer.html#o2">family</a>);
00124   <a class="code" href="group__util.html#ga31">stp_free</a>(printer);
00125 }
00126 
00127 <span class="keyword">const</span> <span class="keywordtype">char</span> *
<a name="l00128"></a><a class="code" href="group__printer.html#ga12">00128</a> <a class="code" href="group__printer.html#ga12">stp_printer_get_driver</a>(<span class="keyword">const</span> <a class="code" href="structstp__printer.html">stp_printer_t</a> *printer)
00129 {
00130   <span class="keywordflow">return</span> printer-&gt;<a class="code" href="structstp__printer.html#o0">driver</a>;
00131 }
00132 
00133 <span class="keyword">static</span> <span class="keyword">const</span> <span class="keywordtype">char</span> *
<a name="l00134"></a><a class="code" href="printers_8c.html#a5">00134</a> <a class="code" href="printers_8c.html#a5">stpi_printer_namefunc</a>(<span class="keyword">const</span> <span class="keywordtype">void</span> *item)
00135 {
00136   <span class="keyword">const</span> <a class="code" href="structstp__printer.html">stp_printer_t</a> *printer = (<span class="keyword">const</span> <a class="code" href="structstp__printer.html">stp_printer_t</a> *) item;
00137   <span class="keywordflow">return</span> printer-&gt;<a class="code" href="structstp__printer.html#o0">driver</a>;
00138 }
00139 
00140 <span class="keyword">const</span> <span class="keywordtype">char</span> *
<a name="l00141"></a><a class="code" href="group__printer.html#ga13">00141</a> <a class="code" href="group__printer.html#ga13">stp_printer_get_long_name</a>(<span class="keyword">const</span> <a class="code" href="structstp__printer.html">stp_printer_t</a> *printer)
00142 {
00143   <span class="keywordflow">return</span> printer-&gt;<a class="code" href="structstp__printer.html#o1">long_name</a>;
00144 }
00145 
00146 <span class="keyword">static</span> <span class="keyword">const</span> <span class="keywordtype">char</span> *
<a name="l00147"></a><a class="code" href="printers_8c.html#a6">00147</a> <a class="code" href="printers_8c.html#a6">stpi_printer_long_namefunc</a>(<span class="keyword">const</span> <span class="keywordtype">void</span> *item)
00148 {
00149   <span class="keyword">const</span> <a class="code" href="structstp__printer.html">stp_printer_t</a> *printer = (<span class="keyword">const</span> <a class="code" href="structstp__printer.html">stp_printer_t</a> *) item;
00150   <span class="keywordflow">return</span> printer-&gt;<a class="code" href="structstp__printer.html#o1">long_name</a>;
00151 }
00152 
00153 <span class="keyword">const</span> <span class="keywordtype">char</span> *
<a name="l00154"></a><a class="code" href="group__printer.html#ga14">00154</a> <a class="code" href="group__printer.html#ga14">stp_printer_get_family</a>(<span class="keyword">const</span> <a class="code" href="structstp__printer.html">stp_printer_t</a> *printer)
00155 {
00156   <span class="keywordflow">return</span> printer-&gt;<a class="code" href="structstp__printer.html#o2">family</a>;
00157 }
00158 
00159 <span class="keyword">const</span> <span class="keywordtype">char</span> *
<a name="l00160"></a><a class="code" href="group__printer.html#ga15">00160</a> <a class="code" href="group__printer.html#ga15">stp_printer_get_manufacturer</a>(<span class="keyword">const</span> <a class="code" href="structstp__printer.html">stp_printer_t</a> *printer)
00161 {
00162   <span class="keywordflow">return</span> printer-&gt;<a class="code" href="structstp__printer.html#o3">manufacturer</a>;
00163 }
00164 
00165 <span class="keywordtype">int</span>
<a name="l00166"></a><a class="code" href="group__printer.html#ga16">00166</a> <a class="code" href="group__printer.html#ga16">stp_printer_get_model</a>(<span class="keyword">const</span> <a class="code" href="structstp__printer.html">stp_printer_t</a> *printer)
00167 {
00168   <span class="keywordflow">return</span> printer-&gt;<a class="code" href="structstp__printer.html#o4">model</a>;
00169 }
00170 
00171 <span class="keyword">static</span> <span class="keyword">inline</span> <span class="keyword">const</span> <a class="code" href="structstp__printfuncs__t.html">stp_printfuncs_t</a> *
<a name="l00172"></a><a class="code" href="printers_8c.html#a17">00172</a> <a class="code" href="printers_8c.html#a17">stpi_get_printfuncs</a>(<span class="keyword">const</span> <a class="code" href="structstp__printer.html">stp_printer_t</a> *printer)
00173 {
00174   <span class="keywordflow">return</span> printer-&gt;<a class="code" href="structstp__printer.html#o5">printfuncs</a>;
00175 }
00176 
00177 <span class="keyword">const</span> <a class="code" href="structstp__vars.html">stp_vars_t</a> *
<a name="l00178"></a><a class="code" href="group__printer.html#ga18">00178</a> <a class="code" href="group__printer.html#ga18">stp_printer_get_defaults</a>(<span class="keyword">const</span> <a class="code" href="structstp__printer.html">stp_printer_t</a> *printer)
00179 {
00180   <span class="keywordflow">return</span> printer-&gt;<a class="code" href="structstp__printer.html#o6">printvars</a>;
00181 }
00182 
00183 
00184 <span class="keyword">const</span> <a class="code" href="structstp__printer.html">stp_printer_t</a> *
<a name="l00185"></a><a class="code" href="group__printer.html#ga19">00185</a> <a class="code" href="group__printer.html#ga19">stp_get_printer_by_long_name</a>(<span class="keyword">const</span> <span class="keywordtype">char</span> *long_name)
00186 {
00187   <a class="code" href="structstp__list__item.html">stp_list_item_t</a> *printer_item;
00188   <span class="keywordflow">if</span> (printer_list == NULL)
00189     {
00190       <a class="code" href="print-util_8c.html#a20">stp_erprintf</a>(<span class="stringliteral">"No printer drivers found: "</span>
00191                    <span class="stringliteral">"are STP_DATA_PATH and STP_MODULE_PATH correct?\n"</span>);
00192       <a class="code" href="printers_8c.html#a7">stpi_init_printer_list</a>();
00193     }
00194   printer_item = <a class="code" href="print-list_8c.html#a18">stp_list_get_item_by_long_name</a>(printer_list, long_name);
00195   <span class="keywordflow">if</span> (!printer_item)
00196     <span class="keywordflow">return</span> NULL;
00197   <span class="keywordflow">return</span> (<span class="keyword">const</span> <a class="code" href="structstp__printer.html">stp_printer_t</a> *) <a class="code" href="print-list_8c.html#a33">stp_list_item_get_data</a>(printer_item);
00198 }
00199 
00200 <span class="keyword">const</span> <a class="code" href="structstp__printer.html">stp_printer_t</a> *
<a name="l00201"></a><a class="code" href="group__printer.html#ga20">00201</a> <a class="code" href="group__printer.html#ga20">stp_get_printer_by_driver</a>(<span class="keyword">const</span> <span class="keywordtype">char</span> *driver)
00202 {
00203   <a class="code" href="structstp__list__item.html">stp_list_item_t</a> *printer_item;
00204   <span class="keywordflow">if</span> (printer_list == NULL)
00205     {
00206       <a class="code" href="print-util_8c.html#a20">stp_erprintf</a>(<span class="stringliteral">"No printer drivers found: "</span>
00207                    <span class="stringliteral">"are STP_DATA_PATH and STP_MODULE_PATH correct?\n"</span>);
00208       <a class="code" href="printers_8c.html#a7">stpi_init_printer_list</a>();
00209     }
00210   printer_item = <a class="code" href="print-list_8c.html#a16">stp_list_get_item_by_name</a>(printer_list, driver);
00211   <span class="keywordflow">if</span> (!printer_item)
00212     <span class="keywordflow">return</span> NULL;
00213   <span class="keywordflow">return</span> (<span class="keyword">const</span> <a class="code" href="structstp__printer.html">stp_printer_t</a> *) <a class="code" href="print-list_8c.html#a33">stp_list_item_get_data</a>(printer_item);
00214 }
00215 
00216 <span class="keywordtype">int</span>
<a name="l00217"></a><a class="code" href="group__printer.html#ga21">00217</a> <a class="code" href="group__printer.html#ga21">stp_get_printer_index_by_driver</a>(<span class="keyword">const</span> <span class="keywordtype">char</span> *driver)
00218 {
00219   <span class="comment">/* There should be no need to ever know the index! */</span>
00220   <span class="keywordtype">int</span> idx = 0;
00221   <span class="keywordflow">for</span> (idx = 0; idx &lt; <a class="code" href="group__printer.html#ga2">stp_printer_model_count</a>(); idx++)
00222     {
00223       <span class="keyword">const</span> <a class="code" href="structstp__printer.html">stp_printer_t</a> *printer = <a class="code" href="group__printer.html#ga11">stp_get_printer_by_index</a>(idx);
00224       <span class="keywordflow">if</span> (!strcmp(<a class="code" href="group__printer.html#ga12">stp_printer_get_driver</a>(printer), driver))
00225         <span class="keywordflow">return</span> idx;
00226     }
00227   <span class="keywordflow">return</span> -1;
00228 }
00229 
00230 <span class="keyword">const</span> <a class="code" href="structstp__printer.html">stp_printer_t</a> *
<a name="l00231"></a><a class="code" href="group__printer.html#ga22">00231</a> <a class="code" href="group__printer.html#ga22">stp_get_printer</a>(<span class="keyword">const</span> <a class="code" href="structstp__vars.html">stp_vars_t</a> *v)
00232 {
00233   <span class="keywordflow">return</span> <a class="code" href="group__printer.html#ga20">stp_get_printer_by_driver</a>(<a class="code" href="group__vars.html#ga13">stp_get_driver</a>(v));
00234 }
00235 
00236 <span class="keywordtype">int</span>
<a name="l00237"></a><a class="code" href="group__printer.html#ga23">00237</a> <a class="code" href="group__printer.html#ga23">stp_get_model_id</a>(<span class="keyword">const</span> <a class="code" href="structstp__vars.html">stp_vars_t</a> *v)
00238 {
00239   <span class="keyword">const</span> <a class="code" href="structstp__printer.html">stp_printer_t</a> *printer = <a class="code" href="group__printer.html#ga20">stp_get_printer_by_driver</a>(<a class="code" href="group__vars.html#ga13">stp_get_driver</a>(v));
00240   <span class="keywordflow">return</span> printer-&gt;<a class="code" href="structstp__printer.html#o4">model</a>;
00241 }
00242 
00243 <a class="code" href="group__vars.html#ga1">stp_parameter_list_t</a>
<a name="l00244"></a><a class="code" href="group__printer.html#ga24">00244</a> <a class="code" href="group__printer.html#ga24">stp_printer_list_parameters</a>(<span class="keyword">const</span> <a class="code" href="structstp__vars.html">stp_vars_t</a> *v)
00245 {
00246   <span class="keyword">const</span> <a class="code" href="structstp__printfuncs__t.html">stp_printfuncs_t</a> *printfuncs =
00247     <a class="code" href="printers_8c.html#a17">stpi_get_printfuncs</a>(<a class="code" href="group__printer.html#ga22">stp_get_printer</a>(v));
00248   <span class="keywordflow">return</span> (printfuncs-&gt;<a class="code" href="structstp__printfuncs__t.html#o0">list_parameters</a>)(v);
00249 }
00250 
00251 <span class="keywordtype">void</span>
<a name="l00252"></a><a class="code" href="group__printer.html#ga25">00252</a> <a class="code" href="group__printer.html#ga25">stp_printer_describe_parameter</a>(<span class="keyword">const</span> <a class="code" href="structstp__vars.html">stp_vars_t</a> *v, <span class="keyword">const</span> <span class="keywordtype">char</span> *name,
00253                                <a class="code" href="structstp__parameter__t.html">stp_parameter_t</a> *description)
00254 {
00255   <span class="keyword">const</span> <a class="code" href="structstp__printfuncs__t.html">stp_printfuncs_t</a> *printfuncs =
00256     <a class="code" href="printers_8c.html#a17">stpi_get_printfuncs</a>(<a class="code" href="group__printer.html#ga22">stp_get_printer</a>(v));
00257   (printfuncs-&gt;<a class="code" href="structstp__printfuncs__t.html#o1">parameters</a>)(v, name, description);
00258 }
00259 
00260 <span class="keyword">static</span> <span class="keywordtype">void</span>
<a name="l00261"></a><a class="code" href="printers_8c.html#a26">00261</a> <a class="code" href="printers_8c.html#a26">set_printer_defaults</a>(<a class="code" href="structstp__vars.html">stp_vars_t</a> *v, <span class="keywordtype">int</span> core_only)
00262 {
00263   <a class="code" href="group__vars.html#ga1">stp_parameter_list_t</a> *params;
00264   <span class="keywordtype">int</span> count;
00265   <span class="keywordtype">int</span> i;
00266   <a class="code" href="structstp__parameter__t.html">stp_parameter_t</a> desc;
00267   params = <a class="code" href="group__vars.html#ga39">stp_get_parameter_list</a>(v);
00268   count = <a class="code" href="group__vars.html#ga86">stp_parameter_list_count</a>(params);
00269   <span class="keywordflow">for</span> (i = 0; i &lt; count; i++)
00270     {
00271       <span class="keyword">const</span> <a class="code" href="structstp__parameter__t.html">stp_parameter_t</a> *p = <a class="code" href="group__vars.html#ga88">stp_parameter_list_param</a>(params, i);
00272       <span class="keywordflow">if</span> (p-&gt;<a class="code" href="structstp__parameter__t.html#o7">is_mandatory</a> &amp;&amp;
00273           (!core_only || p-&gt;<a class="code" href="structstp__parameter__t.html#o5">p_class</a> == <a class="code" href="group__vars.html#gga133a19">STP_PARAMETER_CLASS_CORE</a>))
00274         {
00275           <a class="code" href="group__vars.html#ga83">stp_describe_parameter</a>(v, p-&gt;<a class="code" href="structstp__parameter__t.html#o0">name</a>, &amp;desc);
00276           <span class="keywordflow">switch</span> (p-&gt;<a class="code" href="structstp__parameter__t.html#o4">p_type</a>)
00277             {
00278             <span class="keywordflow">case</span> <a class="code" href="group__vars.html#gga132a7">STP_PARAMETER_TYPE_STRING_LIST</a>:
00279               <a class="code" href="group__vars.html#ga32">stp_set_string_parameter</a>(v, p-&gt;<a class="code" href="structstp__parameter__t.html#o0">name</a>, desc.<a class="code" href="structstp__parameter__t.html#o26">deflt</a>.str);
00280               <a class="code" href="group__vars.html#ga91">stp_set_string_parameter_active</a>(v, p-&gt;<a class="code" href="structstp__parameter__t.html#o0">name</a>, <a class="code" href="group__vars.html#gga135a32">STP_PARAMETER_ACTIVE</a>);
00281               <span class="keywordflow">break</span>;
00282             <span class="keywordflow">case</span> <a class="code" href="group__vars.html#gga132a10">STP_PARAMETER_TYPE_DOUBLE</a>:
00283               <a class="code" href="group__vars.html#ga67">stp_set_float_parameter</a>(v, p-&gt;<a class="code" href="structstp__parameter__t.html#o0">name</a>, desc.<a class="code" href="structstp__parameter__t.html#o26">deflt</a>.dbl);
00284               <a class="code" href="group__vars.html#ga93">stp_set_float_parameter_active</a>(v, p-&gt;<a class="code" href="structstp__parameter__t.html#o0">name</a>, <a class="code" href="group__vars.html#gga135a32">STP_PARAMETER_ACTIVE</a>);
00285               <span class="keywordflow">break</span>;
00286             <span class="keywordflow">case</span> <a class="code" href="group__vars.html#gga132a8">STP_PARAMETER_TYPE_INT</a>:
00287               <a class="code" href="group__vars.html#ga55">stp_set_int_parameter</a>(v, p-&gt;<a class="code" href="structstp__parameter__t.html#o0">name</a>, desc.<a class="code" href="structstp__parameter__t.html#o26">deflt</a>.integer);
00288               <a class="code" href="group__vars.html#ga94">stp_set_int_parameter_active</a>(v, p-&gt;<a class="code" href="structstp__parameter__t.html#o0">name</a>, <a class="code" href="group__vars.html#gga135a32">STP_PARAMETER_ACTIVE</a>);
00289               <span class="keywordflow">break</span>;
00290             <span class="keywordflow">case</span> <a class="code" href="group__vars.html#gga132a15">STP_PARAMETER_TYPE_DIMENSION</a>:
00291               <a class="code" href="group__vars.html#ga63">stp_set_dimension_parameter</a>(v, p-&gt;<a class="code" href="structstp__parameter__t.html#o0">name</a>, desc.<a class="code" href="structstp__parameter__t.html#o26">deflt</a>.dimension);
00292               <a class="code" href="group__vars.html#ga95">stp_set_dimension_parameter_active</a>(v, p-&gt;<a class="code" href="structstp__parameter__t.html#o0">name</a>, <a class="code" href="group__vars.html#gga135a32">STP_PARAMETER_ACTIVE</a>);
00293               <span class="keywordflow">break</span>;
00294             <span class="keywordflow">case</span> <a class="code" href="group__vars.html#gga132a9">STP_PARAMETER_TYPE_BOOLEAN</a>:
00295               <a class="code" href="group__vars.html#ga59">stp_set_boolean_parameter</a>(v, p-&gt;<a class="code" href="structstp__parameter__t.html#o0">name</a>, desc.<a class="code" href="structstp__parameter__t.html#o26">deflt</a>.boolean);
00296               <a class="code" href="group__vars.html#ga96">stp_set_boolean_parameter_active</a>(v, p-&gt;<a class="code" href="structstp__parameter__t.html#o0">name</a>, <a class="code" href="group__vars.html#gga135a32">STP_PARAMETER_ACTIVE</a>);
00297               <span class="keywordflow">break</span>;
00298             <span class="keywordflow">case</span> <a class="code" href="group__vars.html#gga132a11">STP_PARAMETER_TYPE_CURVE</a>:
00299               <a class="code" href="group__vars.html#ga47">stp_set_curve_parameter</a>(v, p-&gt;<a class="code" href="structstp__parameter__t.html#o0">name</a>, desc.<a class="code" href="structstp__parameter__t.html#o26">deflt</a>.curve);
00300               <a class="code" href="group__vars.html#ga97">stp_set_curve_parameter_active</a>(v, p-&gt;<a class="code" href="structstp__parameter__t.html#o0">name</a>, <a class="code" href="group__vars.html#gga135a32">STP_PARAMETER_ACTIVE</a>);
00301               <span class="keywordflow">break</span>;
00302             <span class="keywordflow">case</span> <a class="code" href="group__vars.html#gga132a14">STP_PARAMETER_TYPE_ARRAY</a>:
00303               <a class="code" href="group__vars.html#ga51">stp_set_array_parameter</a>(v, p-&gt;<a class="code" href="structstp__parameter__t.html#o0">name</a>, desc.<a class="code" href="structstp__parameter__t.html#o26">deflt</a>.array);
00304               <a class="code" href="group__vars.html#ga98">stp_set_array_parameter_active</a>(v, p-&gt;<a class="code" href="structstp__parameter__t.html#o0">name</a>, <a class="code" href="group__vars.html#gga135a32">STP_PARAMETER_ACTIVE</a>);
00305               <span class="keywordflow">break</span>;
00306             <span class="keywordflow">default</span>:
00307               <span class="keywordflow">break</span>;
00308             }
00309           <a class="code" href="group__vars.html#ga84">stp_parameter_description_destroy</a>(&amp;desc);
00310         }
00311     }
00312   <a class="code" href="group__vars.html#ga89">stp_parameter_list_destroy</a>(params);
00313 }
00314 
00315 <span class="keywordtype">void</span>
<a name="l00316"></a><a class="code" href="group__printer.html#ga27">00316</a> <a class="code" href="group__printer.html#ga27">stp_set_printer_defaults</a>(<a class="code" href="structstp__vars.html">stp_vars_t</a> *v, <span class="keyword">const</span> <a class="code" href="structstp__printer.html">stp_printer_t</a> *printer)
00317 {
00318   <a class="code" href="group__vars.html#ga11">stp_set_driver</a>(v, <a class="code" href="group__printer.html#ga12">stp_printer_get_driver</a>(printer));
00319   <a class="code" href="printers_8c.html#a26">set_printer_defaults</a>(v, 0);
00320 }
00321 
00322 <span class="keywordtype">void</span>
<a name="l00323"></a><a class="code" href="group__printer.html#ga28">00323</a> <a class="code" href="group__printer.html#ga22">stp_initialize_printer_defaults</a>(<span class="keywordtype">void</span>)
00324 {
00325   <a class="code" href="structstp__list__item.html">stp_list_item_t</a> *printer_item;
00326   <span class="keywordflow">if</span> (printer_list == NULL)
00327     {
00328       <a class="code" href="printers_8c.html#a7">stpi_init_printer_list</a>();
00329       <a class="code" href="group__util.html#ga21">stp_deprintf</a>
00330         (<a class="code" href="group__util.html#ga46">STP_DBG_PRINTERS</a>,
00331          <span class="stringliteral">"stpi_family_register(): initialising printer_list...\n"</span>);
00332     }
00333   printer_item = <a class="code" href="print-list_8c.html#a12">stp_list_get_start</a>(printer_list);
00334   <span class="keywordflow">while</span> (printer_item)
00335     {
00336       <a class="code" href="printers_8c.html#a26">set_printer_defaults</a>
00337         (((<a class="code" href="structstp__printer.html">stp_printer_t</a> *)(<a class="code" href="print-list_8c.html#a33">stp_list_item_get_data</a>(printer_item)))-&gt;printvars, 1);
00338       printer_item = <a class="code" href="print-list_8c.html#a32">stp_list_item_next</a>(printer_item);
00339     }
00340 }
00341 
00342 <span class="keywordtype">void</span>
<a name="l00343"></a><a class="code" href="group__vars.html#ga29">00343</a> <a class="code" href="group__vars.html#ga29">stp_get_media_size</a>(<span class="keyword">const</span> <a class="code" href="structstp__vars.html">stp_vars_t</a> *v, <span class="keywordtype">int</span> *width, <span class="keywordtype">int</span> *height)
00344 {
00345   <span class="keyword">const</span> <a class="code" href="structstp__printfuncs__t.html">stp_printfuncs_t</a> *printfuncs =
00346     <a class="code" href="printers_8c.html#a17">stpi_get_printfuncs</a>(<a class="code" href="group__printer.html#ga22">stp_get_printer</a>(v));
00347   (printfuncs-&gt;<a class="code" href="structstp__printfuncs__t.html#o2">media_size</a>)(v, width, height);
00348 }
00349 
00350 <span class="keywordtype">void</span>
<a name="l00351"></a><a class="code" href="group__vars.html#ga30">00351</a> <a class="code" href="group__vars.html#ga30">stp_get_imageable_area</a>(<span class="keyword">const</span> <a class="code" href="structstp__vars.html">stp_vars_t</a> *v,
00352                        <span class="keywordtype">int</span> *left, <span class="keywordtype">int</span> *right, <span class="keywordtype">int</span> *bottom, <span class="keywordtype">int</span> *top)
00353 {
00354   <span class="keyword">const</span> <a class="code" href="structstp__printfuncs__t.html">stp_printfuncs_t</a> *printfuncs =
00355     <a class="code" href="printers_8c.html#a17">stpi_get_printfuncs</a>(<a class="code" href="group__printer.html#ga22">stp_get_printer</a>(v));
00356   (printfuncs-&gt;<a class="code" href="structstp__printfuncs__t.html#o3">imageable_area</a>)(v, left, right, bottom, top);
00357 }
00358 
00359 <span class="keywordtype">void</span>
<a name="l00360"></a><a class="code" href="group__vars.html#ga31">00360</a> <a class="code" href="group__vars.html#ga31">stp_get_size_limit</a>(<span class="keyword">const</span> <a class="code" href="structstp__vars.html">stp_vars_t</a> *v, <span class="keywordtype">int</span> *max_width, <span class="keywordtype">int</span> *max_height,
00361                    <span class="keywordtype">int</span> *min_width, <span class="keywordtype">int</span> *min_height)
00362 {
00363   <span class="keyword">const</span> <a class="code" href="structstp__printfuncs__t.html">stp_printfuncs_t</a> *printfuncs =
00364     <a class="code" href="printers_8c.html#a17">stpi_get_printfuncs</a>(<a class="code" href="group__printer.html#ga22">stp_get_printer</a>(v));
00365   (printfuncs-&gt;<a class="code" href="structstp__printfuncs__t.html#o4">limit</a>)(v, max_width, max_height, min_width,min_height);
00366 }
00367 
00368 <span class="keywordtype">void</span>
<a name="l00369"></a><a class="code" href="group__vars.html#ga32">00369</a> <a class="code" href="group__vars.html#ga32">stp_describe_resolution</a>(<span class="keyword">const</span> <a class="code" href="structstp__vars.html">stp_vars_t</a> *v, <span class="keywordtype">int</span> *x, <span class="keywordtype">int</span> *y)
00370 {
00371   <span class="keyword">const</span> <a class="code" href="structstp__printfuncs__t.html">stp_printfuncs_t</a> *printfuncs =
00372     <a class="code" href="printers_8c.html#a17">stpi_get_printfuncs</a>(<a class="code" href="group__printer.html#ga22">stp_get_printer</a>(v));
00373   (printfuncs-&gt;<a class="code" href="structstp__printfuncs__t.html#o6">describe_resolution</a>)(v, x, y);
00374 }
00375 
00376 <span class="keyword">const</span> <span class="keywordtype">char</span> *
<a name="l00377"></a><a class="code" href="group__printer.html#ga33">00377</a> <a class="code" href="group__printer.html#ga33">stp_describe_output</a>(<span class="keyword">const</span> <a class="code" href="structstp__vars.html">stp_vars_t</a> *v)
00378 {
00379   <span class="keyword">const</span> <a class="code" href="structstp__printfuncs__t.html">stp_printfuncs_t</a> *printfuncs =
00380     <a class="code" href="printers_8c.html#a17">stpi_get_printfuncs</a>(<a class="code" href="group__printer.html#ga22">stp_get_printer</a>(v));
00381   <span class="keywordflow">return</span> (printfuncs-&gt;<a class="code" href="structstp__printfuncs__t.html#o7">describe_output</a>)(v);
00382 }
00383 
00384 <span class="keywordtype">int</span>
<a name="l00385"></a><a class="code" href="group__vars.html#ga34">00385</a> <a class="code" href="group__vars.html#ga34">stp_verify</a>(<a class="code" href="structstp__vars.html">stp_vars_t</a> *v)
00386 {
00387   <span class="keyword">const</span> <a class="code" href="structstp__printfuncs__t.html">stp_printfuncs_t</a> *printfuncs =
00388     <a class="code" href="printers_8c.html#a17">stpi_get_printfuncs</a>(<a class="code" href="group__printer.html#ga22">stp_get_printer</a>(v));
00389   <a class="code" href="structstp__vars.html">stp_vars_t</a> *nv = <a class="code" href="group__vars.html#ga78">stp_vars_create_copy</a>(v);
00390   <span class="keywordtype">int</span> status;
00391   <a class="code" href="group__util.html#ga77">stp_prune_inactive_options</a>(nv);
00392   status = (printfuncs-&gt;<a class="code" href="structstp__printfuncs__t.html#o8">verify</a>)(nv);
00393   <a class="code" href="group__vars.html#ga27">stp_set_verified</a>(v, <a class="code" href="group__vars.html#ga28">stp_get_verified</a>(nv));
00394   <a class="code" href="group__vars.html#ga26">stp_vars_destroy</a>(nv);
00395   <span class="keywordflow">return</span> status;
00396 }
00397 
00398 <span class="keywordtype">int</span>
<a name="l00399"></a><a class="code" href="group__printer.html#ga35">00399</a> <a class="code" href="group__printer.html#ga35">stp_print</a>(<span class="keyword">const</span> <a class="code" href="structstp__vars.html">stp_vars_t</a> *v, <a class="code" href="structstp__image.html">stp_image_t</a> *image)
00400 {
00401   <span class="keyword">const</span> <a class="code" href="structstp__printfuncs__t.html">stp_printfuncs_t</a> *printfuncs =
00402     <a class="code" href="printers_8c.html#a17">stpi_get_printfuncs</a>(<a class="code" href="group__printer.html#ga22">stp_get_printer</a>(v));
00403   <span class="keywordflow">return</span> (printfuncs-&gt;<a class="code" href="structstp__printfuncs__t.html#o5">print</a>)(v, image);
00404 }
00405 
00406 <span class="keywordtype">int</span>
<a name="l00407"></a><a class="code" href="group__printer.html#ga36">00407</a> <a class="code" href="group__printer.html#ga36">stp_start_job</a>(<span class="keyword">const</span> <a class="code" href="structstp__vars.html">stp_vars_t</a> *v, <a class="code" href="structstp__image.html">stp_image_t</a> *image)
00408 {
00409   <span class="keyword">const</span> <a class="code" href="structstp__printfuncs__t.html">stp_printfuncs_t</a> *printfuncs =
00410     <a class="code" href="printers_8c.html#a17">stpi_get_printfuncs</a>(<a class="code" href="group__printer.html#ga22">stp_get_printer</a>(v));
00411   <span class="keywordflow">if</span> (!<a class="code" href="group__vars.html#ga36">stp_get_string_parameter</a>(v, <span class="stringliteral">"JobMode"</span>) ||
00412       strcmp(<a class="code" href="group__vars.html#ga36">stp_get_string_parameter</a>(v, <span class="stringliteral">"JobMode"</span>), <span class="stringliteral">"Page"</span>) == 0)
00413     <span class="keywordflow">return</span> 1;
00414   <span class="keywordflow">if</span> (printfuncs-&gt;<a class="code" href="structstp__printfuncs__t.html#o9">start_job</a>)
00415     <span class="keywordflow">return</span> (printfuncs-&gt;<a class="code" href="structstp__printfuncs__t.html#o9">start_job</a>)(v, image);
00416   <span class="keywordflow">else</span>
00417     <span class="keywordflow">return</span> 1;
00418 }
00419 
00420 <span class="keywordtype">int</span>
<a name="l00421"></a><a class="code" href="group__printer.html#ga37">00421</a> <a class="code" href="group__printer.html#ga37">stp_end_job</a>(<span class="keyword">const</span> <a class="code" href="structstp__vars.html">stp_vars_t</a> *v, <a class="code" href="structstp__image.html">stp_image_t</a> *image)
00422 {
00423   <span class="keyword">const</span> <a class="code" href="structstp__printfuncs__t.html">stp_printfuncs_t</a> *printfuncs =
00424     <a class="code" href="printers_8c.html#a17">stpi_get_printfuncs</a>(<a class="code" href="group__printer.html#ga22">stp_get_printer</a>(v));
00425   <span class="keywordflow">if</span> (!<a class="code" href="group__vars.html#ga36">stp_get_string_parameter</a>(v, <span class="stringliteral">"JobMode"</span>) ||
00426       strcmp(<a class="code" href="group__vars.html#ga36">stp_get_string_parameter</a>(v, <span class="stringliteral">"JobMode"</span>), <span class="stringliteral">"Page"</span>) == 0)
00427     <span class="keywordflow">return</span> 1;
00428   <span class="keywordflow">if</span> (printfuncs-&gt;<a class="code" href="structstp__printfuncs__t.html#o10">end_job</a>)
00429     <span class="keywordflow">return</span> (printfuncs-&gt;<a class="code" href="structstp__printfuncs__t.html#o10">end_job</a>)(v, image);
00430   <span class="keywordflow">else</span>
00431     <span class="keywordflow">return</span> 1;
00432 }
00433 
00434 <span class="keyword">static</span> <span class="keywordtype">int</span>
<a name="l00435"></a><a class="code" href="printers_8c.html#a38">00435</a> <a class="code" href="printers_8c.html#a38">verify_string_param</a>(<span class="keyword">const</span> <a class="code" href="structstp__vars.html">stp_vars_t</a> *v, <span class="keyword">const</span> <span class="keywordtype">char</span> *parameter,
00436                     <a class="code" href="structstp__parameter__t.html">stp_parameter_t</a> *desc, <span class="keywordtype">int</span> quiet)
00437 {
00438   <a class="code" href="group__vars.html#ga136">stp_parameter_verify_t</a> answer = <a class="code" href="group__vars.html#gga136a34">PARAMETER_OK</a>;
00439   <a class="code" href="print-util_8c.html#a23">stp_dprintf</a>(<a class="code" href="group__util.html#ga48">STP_DBG_VARS</a>, v, <span class="stringliteral">"    Verifying string %s\n"</span>, parameter);
00440   <span class="keywordflow">if</span> (desc-&gt;<a class="code" href="structstp__parameter__t.html#o7">is_mandatory</a> ||
00441       <a class="code" href="group__vars.html#ga100">stp_check_string_parameter</a>(v, parameter, <a class="code" href="group__vars.html#gga135a32">STP_PARAMETER_ACTIVE</a>))
00442     {
00443       <span class="keyword">const</span> <span class="keywordtype">char</span> *checkval = <a class="code" href="group__vars.html#ga36">stp_get_string_parameter</a>(v, parameter);
00444       <a class="code" href="string-list_8h.html#a0">stp_string_list_t</a> *vptr = desc-&gt;<a class="code" href="structstp__parameter__t.html#o18">bounds</a>.str;
00445       size_t count = 0;
00446       <span class="keywordtype">int</span> i;
00447       <a class="code" href="print-util_8c.html#a23">stp_dprintf</a>(<a class="code" href="group__util.html#ga48">STP_DBG_VARS</a>, v, <span class="stringliteral">"     value %s\n"</span>,
00448                   checkval ? checkval : <span class="stringliteral">"(null)"</span>);
00449       <span class="keywordflow">if</span> (vptr)
00450         count = <a class="code" href="string-list_8c.html#a8">stp_string_list_count</a>(vptr);
00451       answer = <a class="code" href="group__vars.html#gga136a33">PARAMETER_BAD</a>;
00452       <span class="keywordflow">if</span> (checkval == NULL)
00453         {
00454           <span class="keywordflow">if</span> (count == 0)
00455             answer = <a class="code" href="group__vars.html#gga136a34">PARAMETER_OK</a>;
00456           <span class="keywordflow">else</span>
00457             {
00458               <span class="keywordflow">if</span> (!quiet)
00459                 <a class="code" href="print-util_8c.html#a18">stp_eprintf</a>(v, <a class="code" href="group__intl__internal.html#ga5">_</a>(<span class="stringliteral">"Value must be set for %s\n"</span>), parameter);
00460               answer = <a class="code" href="group__vars.html#gga136a33">PARAMETER_BAD</a>;
00461             }
00462         }
00463       <span class="keywordflow">else</span> <span class="keywordflow">if</span> (count &gt; 0)
00464         {
00465           <span class="keywordflow">for</span> (i = 0; i &lt; count; i++)
00466             <span class="keywordflow">if</span> (!strcmp(checkval, <a class="code" href="string-list_8c.html#a6">stp_string_list_param</a>(vptr, i)-&gt;name))
00467               {
00468                 answer = <a class="code" href="group__vars.html#gga136a34">PARAMETER_OK</a>;
00469                 <span class="keywordflow">break</span>;
00470               }
00471           <span class="keywordflow">if</span> (!answer &amp;&amp; !quiet)
00472             <a class="code" href="print-util_8c.html#a18">stp_eprintf</a>(v, <a class="code" href="group__intl__internal.html#ga5">_</a>(<span class="stringliteral">"`%s' is not a valid %s\n"</span>), checkval, parameter);
00473         }
00474       <span class="keywordflow">else</span> <span class="keywordflow">if</span> (strlen(checkval) == 0)
00475         answer = <a class="code" href="group__vars.html#gga136a34">PARAMETER_OK</a>;
00476       <span class="keywordflow">else</span> <span class="keywordflow">if</span> (!quiet)
00477         <a class="code" href="print-util_8c.html#a18">stp_eprintf</a>(v, <a class="code" href="group__intl__internal.html#ga5">_</a>(<span class="stringliteral">"`%s' is not a valid %s\n"</span>), checkval, parameter);
00478     }
00479   <a class="code" href="group__vars.html#ga84">stp_parameter_description_destroy</a>(desc);
00480   <span class="keywordflow">return</span> answer;
00481 }
00482 
00483 <span class="keyword">static</span> <span class="keywordtype">int</span>
<a name="l00484"></a><a class="code" href="printers_8c.html#a39">00484</a> <a class="code" href="printers_8c.html#a39">verify_double_param</a>(<span class="keyword">const</span> <a class="code" href="structstp__vars.html">stp_vars_t</a> *v, <span class="keyword">const</span> <span class="keywordtype">char</span> *parameter,
00485                     <a class="code" href="structstp__parameter__t.html">stp_parameter_t</a> *desc, <span class="keywordtype">int</span> quiet)
00486 {
00487   <a class="code" href="print-util_8c.html#a23">stp_dprintf</a>(<a class="code" href="group__util.html#ga48">STP_DBG_VARS</a>, v, <span class="stringliteral">"    Verifying double %s\n"</span>, parameter);
00488   <span class="keywordflow">if</span> (desc-&gt;<a class="code" href="structstp__parameter__t.html#o7">is_mandatory</a> ||
00489       <a class="code" href="group__vars.html#ga102">stp_check_float_parameter</a>(v, parameter, <a class="code" href="group__vars.html#gga135a32">STP_PARAMETER_ACTIVE</a>))
00490     {
00491       <span class="keywordtype">double</span> checkval = <a class="code" href="group__vars.html#ga70">stp_get_float_parameter</a>(v, parameter);
00492       <span class="keywordflow">if</span> (checkval &lt; desc-&gt;<a class="code" href="structstp__parameter__t.html#o18">bounds</a>.dbl.lower ||
00493           checkval &gt; desc-&gt;<a class="code" href="structstp__parameter__t.html#o18">bounds</a>.dbl.upper)
00494         {
00495           <span class="keywordflow">if</span> (!quiet)
00496             <a class="code" href="print-util_8c.html#a18">stp_eprintf</a>(v, <a class="code" href="group__intl__internal.html#ga5">_</a>(<span class="stringliteral">"%s must be between %f and %f (is %f)\n"</span>),
00497                         parameter, desc-&gt;<a class="code" href="structstp__parameter__t.html#o18">bounds</a>.dbl.lower,
00498                         desc-&gt;<a class="code" href="structstp__parameter__t.html#o18">bounds</a>.dbl.upper, checkval);
00499           <span class="keywordflow">return</span> <a class="code" href="group__vars.html#gga136a33">PARAMETER_BAD</a>;
00500         }
00501     }
00502   <span class="keywordflow">return</span> <a class="code" href="group__vars.html#gga136a34">PARAMETER_OK</a>;
00503 }
00504 
00505 <span class="keyword">static</span> <span class="keywordtype">int</span>
<a name="l00506"></a><a class="code" href="printers_8c.html#a40">00506</a> <a class="code" href="printers_8c.html#a40">verify_int_param</a>(<span class="keyword">const</span> <a class="code" href="structstp__vars.html">stp_vars_t</a> *v, <span class="keyword">const</span> <span class="keywordtype">char</span> *parameter,
00507                  <a class="code" href="structstp__parameter__t.html">stp_parameter_t</a> *desc, <span class="keywordtype">int</span> quiet)
00508 {
00509   <a class="code" href="print-util_8c.html#a23">stp_dprintf</a>(<a class="code" href="group__util.html#ga48">STP_DBG_VARS</a>, v, <span class="stringliteral">"    Verifying int %s\n"</span>, parameter);
00510   <span class="keywordflow">if</span> (desc-&gt;<a class="code" href="structstp__parameter__t.html#o7">is_mandatory</a> ||
00511       <a class="code" href="group__vars.html#ga103">stp_check_int_parameter</a>(v, parameter, <a class="code" href="group__vars.html#gga135a32">STP_PARAMETER_ACTIVE</a>))
00512     {
00513       <span class="keywordtype">int</span> checkval = <a class="code" href="group__vars.html#ga58">stp_get_int_parameter</a>(v, parameter);
00514       <span class="keywordflow">if</span> (checkval &lt; desc-&gt;<a class="code" href="structstp__parameter__t.html#o18">bounds</a>.integer.lower ||
00515           checkval &gt; desc-&gt;<a class="code" href="structstp__parameter__t.html#o18">bounds</a>.integer.upper)
00516         {
00517           <span class="keywordflow">if</span> (!quiet)
00518             <a class="code" href="print-util_8c.html#a18">stp_eprintf</a>(v, <a class="code" href="group__intl__internal.html#ga5">_</a>(<span class="stringliteral">"%s must be between %d and %d (is %d)\n"</span>),
00519                         parameter, desc-&gt;<a class="code" href="structstp__parameter__t.html#o18">bounds</a>.integer.lower,
00520                         desc-&gt;<a class="code" href="structstp__parameter__t.html#o18">bounds</a>.integer.upper, checkval);
00521           <a class="code" href="group__vars.html#ga84">stp_parameter_description_destroy</a>(desc);
00522           <span class="keywordflow">return</span> <a class="code" href="group__vars.html#gga136a33">PARAMETER_BAD</a>;
00523         }
00524     }
00525   <a class="code" href="group__vars.html#ga84">stp_parameter_description_destroy</a>(desc);
00526   <span class="keywordflow">return</span> <a class="code" href="group__vars.html#gga136a34">PARAMETER_OK</a>;
00527 }
00528 
00529 <span class="keyword">static</span> <span class="keywordtype">int</span>
<a name="l00530"></a><a class="code" href="printers_8c.html#a41">00530</a> <a class="code" href="printers_8c.html#a41">verify_dimension_param</a>(<span class="keyword">const</span> <a class="code" href="structstp__vars.html">stp_vars_t</a> *v, <span class="keyword">const</span> <span class="keywordtype">char</span> *parameter,
00531                  <a class="code" href="structstp__parameter__t.html">stp_parameter_t</a> *desc, <span class="keywordtype">int</span> quiet)
00532 {
00533   <a class="code" href="print-util_8c.html#a23">stp_dprintf</a>(<a class="code" href="group__util.html#ga48">STP_DBG_VARS</a>, v, <span class="stringliteral">"    Verifying dimension %s\n"</span>, parameter);
00534   <span class="keywordflow">if</span> (desc-&gt;<a class="code" href="structstp__parameter__t.html#o7">is_mandatory</a> ||
00535       <a class="code" href="group__vars.html#ga104">stp_check_dimension_parameter</a>(v, parameter, <a class="code" href="group__vars.html#gga135a32">STP_PARAMETER_ACTIVE</a>))
00536     {
00537       <span class="keywordtype">int</span> checkval = <a class="code" href="group__vars.html#ga66">stp_get_dimension_parameter</a>(v, parameter);
00538       <span class="keywordflow">if</span> (checkval &lt; desc-&gt;<a class="code" href="structstp__parameter__t.html#o18">bounds</a>.dimension.lower ||
00539           checkval &gt; desc-&gt;<a class="code" href="structstp__parameter__t.html#o18">bounds</a>.dimension.upper)
00540         {
00541           <span class="keywordflow">if</span> (!quiet)
00542             <a class="code" href="print-util_8c.html#a18">stp_eprintf</a>(v, <a class="code" href="group__intl__internal.html#ga5">_</a>(<span class="stringliteral">"%s must be between %d and %d (is %d)\n"</span>),
00543                         parameter, desc-&gt;<a class="code" href="structstp__parameter__t.html#o18">bounds</a>.dimension.lower,
00544                         desc-&gt;<a class="code" href="structstp__parameter__t.html#o18">bounds</a>.dimension.upper, checkval);
00545           <a class="code" href="group__vars.html#ga84">stp_parameter_description_destroy</a>(desc);
00546           <span class="keywordflow">return</span> <a class="code" href="group__vars.html#gga136a33">PARAMETER_BAD</a>;
00547         }
00548     }
00549   <a class="code" href="group__vars.html#ga84">stp_parameter_description_destroy</a>(desc);
00550   <span class="keywordflow">return</span> <a class="code" href="group__vars.html#gga136a34">PARAMETER_OK</a>;
00551 }
00552 
00553 <span class="keyword">static</span> <span class="keywordtype">int</span>
<a name="l00554"></a><a class="code" href="printers_8c.html#a42">00554</a> <a class="code" href="printers_8c.html#a42">verify_curve_param</a>(<span class="keyword">const</span> <a class="code" href="structstp__vars.html">stp_vars_t</a> *v, <span class="keyword">const</span> <span class="keywordtype">char</span> *parameter,
00555                    <a class="code" href="structstp__parameter__t.html">stp_parameter_t</a> *desc, <span class="keywordtype">int</span> quiet)
00556 {
00557   <a class="code" href="group__vars.html#ga136">stp_parameter_verify_t</a> answer = 1;
00558   <a class="code" href="print-util_8c.html#a23">stp_dprintf</a>(<a class="code" href="group__util.html#ga48">STP_DBG_VARS</a>, v, <span class="stringliteral">"    Verifying curve %s\n"</span>, parameter);
00559   <span class="keywordflow">if</span> (desc-&gt;<a class="code" href="structstp__parameter__t.html#o18">bounds</a>.curve &amp;&amp;
00560       (desc-&gt;<a class="code" href="structstp__parameter__t.html#o7">is_mandatory</a> ||
00561        <a class="code" href="group__vars.html#ga106">stp_check_curve_parameter</a>(v, parameter, <a class="code" href="group__vars.html#gga135a32">STP_PARAMETER_ACTIVE</a>)))
00562     {
00563       <span class="keyword">const</span> <a class="code" href="structstp__curve.html">stp_curve_t</a> *checkval = <a class="code" href="group__vars.html#ga50">stp_get_curve_parameter</a>(v, parameter);
00564       <span class="keywordflow">if</span> (checkval)
00565         {
00566           <span class="keywordtype">double</span> u0, l0;
00567           <span class="keywordtype">double</span> u1, l1;
00568           <a class="code" href="group__curve.html#ga26">stp_curve_get_bounds</a>(checkval, &amp;l0, &amp;u0);
00569           <a class="code" href="group__curve.html#ga26">stp_curve_get_bounds</a>(desc-&gt;<a class="code" href="structstp__parameter__t.html#o18">bounds</a>.curve, &amp;l1, &amp;u1);
00570           <span class="keywordflow">if</span> (u0 &gt; u1 || l0 &lt; l1)
00571             {
00572               <span class="keywordflow">if</span> (!quiet)
00573                 <a class="code" href="print-util_8c.html#a18">stp_eprintf</a>(v, <a class="code" href="group__intl__internal.html#ga5">_</a>(<span class="stringliteral">"%s bounds must be between %f and %f\n"</span>),
00574                             parameter, l1, u1);
00575               answer = <a class="code" href="group__vars.html#gga136a33">PARAMETER_BAD</a>;
00576             }
00577           <span class="keywordflow">if</span> (<a class="code" href="group__curve.html#ga29">stp_curve_get_wrap</a>(checkval) !=
00578               <a class="code" href="group__curve.html#ga29">stp_curve_get_wrap</a>(desc-&gt;<a class="code" href="structstp__parameter__t.html#o18">bounds</a>.curve))
00579             {
00580               <span class="keywordflow">if</span> (!quiet)
00581                 <a class="code" href="print-util_8c.html#a18">stp_eprintf</a>(v, <a class="code" href="group__intl__internal.html#ga5">_</a>(<span class="stringliteral">"%s wrap mode must be %s\n"</span>),
00582                             parameter,
00583                             (<a class="code" href="group__curve.html#ga29">stp_curve_get_wrap</a>(desc-&gt;<a class="code" href="structstp__parameter__t.html#o18">bounds</a>.curve) ==
00584                              <a class="code" href="group__curve.html#gga48a3">STP_CURVE_WRAP_NONE</a>) ?
00585                             <a class="code" href="group__intl__internal.html#ga5">_</a>(<span class="stringliteral">"no wrap"</span>) : <a class="code" href="group__intl__internal.html#ga5">_</a>(<span class="stringliteral">"wrap around"</span>));
00586               answer = <a class="code" href="group__vars.html#gga136a33">PARAMETER_BAD</a>;
00587             }
00588         }
00589     }
00590   <a class="code" href="group__vars.html#ga84">stp_parameter_description_destroy</a>(desc);
00591   <span class="keywordflow">return</span> answer;
00592 }
00593 
00594 <a class="code" href="group__vars.html#ga136">stp_parameter_verify_t</a>
<a name="l00595"></a><a class="code" href="group__vars.html#ga43">00595</a> <a class="code" href="group__vars.html#ga43">stp_verify_parameter</a>(<span class="keyword">const</span> <a class="code" href="structstp__vars.html">stp_vars_t</a> *v, <span class="keyword">const</span> <span class="keywordtype">char</span> *parameter,
00596                      <span class="keywordtype">int</span> quiet)
00597 {
00598   <a class="code" href="structstp__parameter__t.html">stp_parameter_t</a> desc;
00599   quiet = 0;
00600   <a class="code" href="group__vars.html#ga83">stp_describe_parameter</a>(v, parameter, &amp;desc);
00601   <a class="code" href="print-util_8c.html#a23">stp_dprintf</a>(<a class="code" href="group__util.html#ga48">STP_DBG_VARS</a>, v, <span class="stringliteral">"  Verifying %s %d %d\n"</span>, parameter,
00602               desc.<a class="code" href="structstp__parameter__t.html#o8">is_active</a>, desc.<a class="code" href="structstp__parameter__t.html#o11">read_only</a>);
00603   <span class="keywordflow">if</span> (!desc.<a class="code" href="structstp__parameter__t.html#o8">is_active</a> || desc.<a class="code" href="structstp__parameter__t.html#o11">read_only</a>)
00604     {
00605       <a class="code" href="group__vars.html#ga84">stp_parameter_description_destroy</a>(&amp;desc);
00606       <span class="keywordflow">return</span> <a class="code" href="group__vars.html#gga136a35">PARAMETER_INACTIVE</a>;
00607     }
00608   <span class="keywordflow">switch</span> (desc.<a class="code" href="structstp__parameter__t.html#o4">p_type</a>)
00609     {
00610     <span class="keywordflow">case</span> <a class="code" href="group__vars.html#gga132a7">STP_PARAMETER_TYPE_STRING_LIST</a>:
00611       <span class="keywordflow">return</span> <a class="code" href="printers_8c.html#a38">verify_string_param</a>(v, parameter, &amp;desc, quiet);
00612     <span class="keywordflow">case</span> <a class="code" href="group__vars.html#gga132a10">STP_PARAMETER_TYPE_DOUBLE</a>:
00613       <span class="keywordflow">return</span> <a class="code" href="printers_8c.html#a39">verify_double_param</a>(v, parameter, &amp;desc, quiet);
00614     <span class="keywordflow">case</span> <a class="code" href="group__vars.html#gga132a8">STP_PARAMETER_TYPE_INT</a>:
00615       <span class="keywordflow">return</span> <a class="code" href="printers_8c.html#a40">verify_int_param</a>(v, parameter, &amp;desc, quiet);
00616     <span class="keywordflow">case</span> <a class="code" href="group__vars.html#gga132a15">STP_PARAMETER_TYPE_DIMENSION</a>:
00617       <span class="keywordflow">return</span> <a class="code" href="printers_8c.html#a41">verify_dimension_param</a>(v, parameter, &amp;desc, quiet);
00618     <span class="keywordflow">case</span> <a class="code" href="group__vars.html#gga132a11">STP_PARAMETER_TYPE_CURVE</a>:
00619       <span class="keywordflow">return</span> <a class="code" href="printers_8c.html#a42">verify_curve_param</a>(v, parameter, &amp;desc, quiet);
00620     <span class="keywordflow">case</span> <a class="code" href="group__vars.html#gga132a13">STP_PARAMETER_TYPE_RAW</a>:
00621     <span class="keywordflow">case</span> <a class="code" href="group__vars.html#gga132a12">STP_PARAMETER_TYPE_FILE</a>:
00622       <a class="code" href="group__vars.html#ga84">stp_parameter_description_destroy</a>(&amp;desc);
00623       <span class="keywordflow">return</span> <a class="code" href="group__vars.html#gga136a34">PARAMETER_OK</a>;              <span class="comment">/* No way to verify this here */</span>
00624     <span class="keywordflow">case</span> <a class="code" href="group__vars.html#gga132a9">STP_PARAMETER_TYPE_BOOLEAN</a>:
00625       <a class="code" href="group__vars.html#ga84">stp_parameter_description_destroy</a>(&amp;desc);
00626       <span class="keywordflow">return</span> <a class="code" href="group__vars.html#gga136a34">PARAMETER_OK</a>;              <span class="comment">/* Booleans always OK */</span>
00627     <span class="keywordflow">default</span>:
00628       <span class="keywordflow">if</span> (!quiet)
00629         <a class="code" href="print-util_8c.html#a18">stp_eprintf</a>(v, <a class="code" href="group__intl__internal.html#ga5">_</a>(<span class="stringliteral">"Unknown type parameter %s (%d)\n"</span>),
00630                     parameter, desc.<a class="code" href="structstp__parameter__t.html#o4">p_type</a>);
00631       <a class="code" href="group__vars.html#ga84">stp_parameter_description_destroy</a>(&amp;desc);
00632       <span class="keywordflow">return</span> 0;
00633     }
00634 }
00635 
<a name="l00636"></a><a class="code" href="printers_8c.html#a1">00636</a> <span class="preprocessor">#define CHECK_INT_RANGE(v, component, min, max)                             \</span>
00637 <span class="preprocessor">do                                                                          \</span>
00638 <span class="preprocessor">{                                                                           \</span>
00639 <span class="preprocessor">  if (stp_get_##component((v)) &lt; (min) || stp_get_##component((v)) &gt; (max)) \</span>
00640 <span class="preprocessor">    {                                                                       \</span>
00641 <span class="preprocessor">      answer = 0;                                                           \</span>
00642 <span class="preprocessor">      stp_eprintf(v, _("%s out of range (value %d, min %d, max %d)\n"),     \</span>
00643 <span class="preprocessor">                  #component, stp_get_##component(v), min, max);            \</span>
00644 <span class="preprocessor">    }                                                                       \</span>
00645 <span class="preprocessor">} while (0)</span>
00646 <span class="preprocessor"></span>
<a name="l00647"></a><a class="code" href="printers_8c.html#a2">00647</a> <span class="preprocessor">#define CHECK_INT_RANGE_INTERNAL(v, component, min, max)                      \</span>
00648 <span class="preprocessor">do                                                                            \</span>
00649 <span class="preprocessor">{                                                                             \</span>
00650 <span class="preprocessor">  if (stpi_get_##component((v)) &lt; (min) || stpi_get_##component((v)) &gt; (max)) \</span>
00651 <span class="preprocessor">    {                                                                         \</span>
00652 <span class="preprocessor">      answer = 0;                                                             \</span>
00653 <span class="preprocessor">      stp_eprintf(v, _("%s out of range (value %d, min %d, max %d)\n"),       \</span>
00654 <span class="preprocessor">                  #component, stpi_get_##component(v), min, max);             \</span>
00655 <span class="preprocessor">    }                                                                         \</span>
00656 <span class="preprocessor">} while (0)</span>
00657 <span class="preprocessor"></span>
<a name="l00658"></a><a class="code" href="structerrbuf__t.html">00658</a> <span class="keyword">typedef</span> <span class="keyword">struct</span>
00659 <span class="keyword"></span>{
<a name="l00660"></a><a class="code" href="structerrbuf__t.html#o0">00660</a>   <span class="keywordtype">char</span> *data;
<a name="l00661"></a><a class="code" href="structerrbuf__t.html#o1">00661</a>   size_t bytes;
00662 } <a class="code" href="structerrbuf__t.html">errbuf_t</a>;
00663 
00664 <span class="keyword">static</span> <span class="keywordtype">void</span>
<a name="l00665"></a><a class="code" href="printers_8c.html#a44">00665</a> <a class="code" href="printers_8c.html#a44">fill_buffer_writefunc</a>(<span class="keywordtype">void</span> *priv, <span class="keyword">const</span> <span class="keywordtype">char</span> *buffer, size_t bytes)
00666 {
00667   <a class="code" href="structerrbuf__t.html">errbuf_t</a> *errbuf = (<a class="code" href="structerrbuf__t.html">errbuf_t</a> *) priv;
00668   <span class="keywordflow">if</span> (errbuf-&gt;<a class="code" href="structerrbuf__t.html#o1">bytes</a> == 0)
00669     errbuf-&gt;<a class="code" href="structerrbuf__t.html#o0">data</a> = <a class="code" href="group__util.html#ga28">stp_malloc</a>(bytes + 1);
00670   <span class="keywordflow">else</span>
00671     errbuf-&gt;<a class="code" href="structerrbuf__t.html#o0">data</a> = <a class="code" href="group__util.html#ga30">stp_realloc</a>(errbuf-&gt;<a class="code" href="structerrbuf__t.html#o0">data</a>, errbuf-&gt;<a class="code" href="structerrbuf__t.html#o1">bytes</a> + bytes + 1);
00672   memcpy(errbuf-&gt;<a class="code" href="structerrbuf__t.html#o0">data</a> + errbuf-&gt;<a class="code" href="structerrbuf__t.html#o1">bytes</a>, buffer, bytes);
00673   errbuf-&gt;<a class="code" href="structerrbuf__t.html#o1">bytes</a> += bytes;
00674   errbuf-&gt;<a class="code" href="structerrbuf__t.html#o0">data</a>[errbuf-&gt;<a class="code" href="structerrbuf__t.html#o1">bytes</a>] = <span class="charliteral">'\0'</span>;
00675 }
00676 
00677 <span class="keywordtype">int</span>
<a name="l00678"></a><a class="code" href="group__printer.html#ga45">00678</a> <a class="code" href="group__printer.html#ga45">stp_verify_printer_params</a>(<a class="code" href="structstp__vars.html">stp_vars_t</a> *v)
00679 {
00680   <a class="code" href="structerrbuf__t.html">errbuf_t</a> errbuf;
00681   <a class="code" href="group__vars.html#ga3">stp_outfunc_t</a> ofunc = <a class="code" href="group__vars.html#ga32">stp_get_errfunc</a>(v);
00682   <span class="keywordtype">void</span> *odata = <a class="code" href="group__vars.html#ga36">stp_get_errdata</a>(v);
00683 
00684   <a class="code" href="group__vars.html#ga1">stp_parameter_list_t</a> params;
00685   <span class="keywordtype">int</span> nparams;
00686   <span class="keywordtype">int</span> i;
00687   <span class="keywordtype">int</span> answer = 1;
00688   <span class="keywordtype">int</span> left, top, bottom, right;
00689   <span class="keyword">const</span> <span class="keywordtype">char</span> *pagesize = <a class="code" href="group__vars.html#ga36">stp_get_string_parameter</a>(v, <span class="stringliteral">"PageSize"</span>);
00690 
00691   <a class="code" href="group__vars.html#ga31">stp_set_errfunc</a>((<a class="code" href="structstp__vars.html">stp_vars_t</a> *) v, <a class="code" href="printers_8c.html#a44">fill_buffer_writefunc</a>);
00692   <a class="code" href="group__vars.html#ga35">stp_set_errdata</a>((<a class="code" href="structstp__vars.html">stp_vars_t</a> *) v, &amp;errbuf);
00693 
00694   errbuf.<a class="code" href="structerrbuf__t.html#o0">data</a> = NULL;
00695   errbuf.<a class="code" href="structerrbuf__t.html#o1">bytes</a> = 0;
00696 
00697   <span class="keywordflow">if</span> (pagesize &amp;&amp; strlen(pagesize) &gt; 0)
00698     {
00699       <span class="keywordflow">if</span> (<a class="code" href="group__vars.html#ga43">stp_verify_parameter</a>(v, <span class="stringliteral">"PageSize"</span>, 0) == 0)
00700         answer = 0;
00701     }
00702   <span class="keywordflow">else</span>
00703     {
00704       <span class="keywordtype">int</span> width, height, min_height, min_width;
00705       <a class="code" href="group__vars.html#ga31">stp_get_size_limit</a>(v, &amp;width, &amp;height, &amp;min_width, &amp;min_height);
00706       <span class="keywordflow">if</span> (<a class="code" href="group__vars.html#ga28">stp_get_page_height</a>(v) &lt;= min_height ||
00707           <a class="code" href="group__vars.html#ga28">stp_get_page_height</a>(v) &gt; height ||
00708           <a class="code" href="group__vars.html#ga26">stp_get_page_width</a>(v) &lt;= min_width || <a class="code" href="group__vars.html#ga26">stp_get_page_width</a>(v) &gt; width)
00709         {
00710           answer = 0;
00711           <a class="code" href="print-util_8c.html#a18">stp_eprintf</a>(v, <a class="code" href="group__intl__internal.html#ga5">_</a>(<span class="stringliteral">"Page size is not valid\n"</span>));
00712         }
00713       <a class="code" href="print-util_8c.html#a23">stp_dprintf</a>(<a class="code" href="group__util.html#ga45">STP_DBG_PAPER</a>, v,
00714                   <span class="stringliteral">"page size max %d %d min %d %d actual %d %d\n"</span>,
00715                   width, height, min_width, min_height,
00716                   <a class="code" href="group__vars.html#ga26">stp_get_page_width</a>(v), <a class="code" href="group__vars.html#ga28">stp_get_page_height</a>(v));
00717     }
00718 
00719   <a class="code" href="group__vars.html#ga30">stp_get_imageable_area</a>(v, &amp;left, &amp;right, &amp;bottom, &amp;top);
00720 
00721   <a class="code" href="print-util_8c.html#a23">stp_dprintf</a>(<a class="code" href="group__util.html#ga45">STP_DBG_PAPER</a>, v,
00722               <span class="stringliteral">"page      left %d top %d right %d bottom %d\n"</span>,
00723               left, top, right, bottom);
00724   <a class="code" href="print-util_8c.html#a23">stp_dprintf</a>(<a class="code" href="group__util.html#ga45">STP_DBG_PAPER</a>, v,
00725               <span class="stringliteral">"requested left %d top %d width %d height %d\n"</span>,
00726               <a class="code" href="group__vars.html#ga18">stp_get_left</a>(v), <a class="code" href="group__vars.html#ga20">stp_get_top</a>(v),
00727               <a class="code" href="group__vars.html#ga22">stp_get_width</a>(v), <a class="code" href="group__vars.html#ga24">stp_get_height</a>(v));
00728 
00729   <span class="keywordflow">if</span> (<a class="code" href="group__vars.html#ga20">stp_get_top</a>(v) &lt; top)
00730     {
00731       answer = 0;
00732       <a class="code" href="print-util_8c.html#a18">stp_eprintf</a>(v, <a class="code" href="group__intl__internal.html#ga5">_</a>(<span class="stringliteral">"Top margin must not be less than %d\n"</span>), top);
00733     }
00734 
00735   <span class="keywordflow">if</span> (<a class="code" href="group__vars.html#ga18">stp_get_left</a>(v) &lt; left)
00736     {
00737       answer = 0;
00738       <a class="code" href="print-util_8c.html#a18">stp_eprintf</a>(v, <a class="code" href="group__intl__internal.html#ga5">_</a>(<span class="stringliteral">"Left margin must not be less than %d\n"</span>), left);
00739     }
00740 
00741   <span class="keywordflow">if</span> (<a class="code" href="group__vars.html#ga24">stp_get_height</a>(v) &lt;= 0)
00742     {
00743       answer = 0;
00744       <a class="code" href="print-util_8c.html#a18">stp_eprintf</a>(v, <a class="code" href="group__intl__internal.html#ga5">_</a>(<span class="stringliteral">"Height must be greater than zero\n"</span>));
00745     }
00746 
00747   <span class="keywordflow">if</span> (<a class="code" href="group__vars.html#ga22">stp_get_width</a>(v) &lt;= 0)
00748     {
00749       answer = 0;
00750       <a class="code" href="print-util_8c.html#a18">stp_eprintf</a>(v, <a class="code" href="group__intl__internal.html#ga5">_</a>(<span class="stringliteral">"Width must be greater than zero\n"</span>));
00751     }
00752 
00753   <span class="keywordflow">if</span> (<a class="code" href="group__vars.html#ga18">stp_get_left</a>(v) + <a class="code" href="group__vars.html#ga22">stp_get_width</a>(v) &gt; right)
00754     {
00755       answer = 0;
00756       <a class="code" href="print-util_8c.html#a18">stp_eprintf</a>(v, <a class="code" href="group__intl__internal.html#ga5">_</a>(<span class="stringliteral">"Image is too wide for the page: left margin is %d, width %d, right edge is %d\n"</span>),
00757                   <a class="code" href="group__vars.html#ga18">stp_get_left</a>(v), <a class="code" href="group__vars.html#ga22">stp_get_width</a>(v), right);
00758     }
00759 
00760   <span class="keywordflow">if</span> (<a class="code" href="group__vars.html#ga20">stp_get_top</a>(v) + <a class="code" href="group__vars.html#ga24">stp_get_height</a>(v) &gt; bottom)
00761     {
00762       answer = 0;
00763       <a class="code" href="print-util_8c.html#a18">stp_eprintf</a>(v, <a class="code" href="group__intl__internal.html#ga5">_</a>(<span class="stringliteral">"Image is too long for the page: top margin is %d, height %d, bottom edge is %d\n"</span>),
00764                   <a class="code" href="group__vars.html#ga18">stp_get_left</a>(v), <a class="code" href="group__vars.html#ga22">stp_get_width</a>(v), right);
00765     }
00766 
00767   params = <a class="code" href="group__vars.html#ga39">stp_get_parameter_list</a>(v);
00768   nparams = <a class="code" href="group__vars.html#ga86">stp_parameter_list_count</a>(params);
00769   <span class="keywordflow">for</span> (i = 0; i &lt; nparams; i++)
00770     {
00771       <span class="keyword">const</span> <a class="code" href="structstp__parameter__t.html">stp_parameter_t</a> *param = <a class="code" href="group__vars.html#ga88">stp_parameter_list_param</a>(params, i);
00772       <a class="code" href="print-util_8c.html#a23">stp_dprintf</a>(<a class="code" href="group__util.html#ga48">STP_DBG_VARS</a>, v, <span class="stringliteral">"Checking %s %d %d\n"</span>, param-&gt;<a class="code" href="structstp__parameter__t.html#o0">name</a>,
00773                   param-&gt;<a class="code" href="structstp__parameter__t.html#o8">is_active</a>, param-&gt;<a class="code" href="structstp__parameter__t.html#o10">verify_this_parameter</a>);
00774 
00775       <span class="keywordflow">if</span> (strcmp(param-&gt;<a class="code" href="structstp__parameter__t.html#o0">name</a>, <span class="stringliteral">"PageSize"</span>) != 0 &amp;&amp;
00776           param-&gt;<a class="code" href="structstp__parameter__t.html#o8">is_active</a> &amp;&amp; param-&gt;<a class="code" href="structstp__parameter__t.html#o10">verify_this_parameter</a> &amp;&amp;
00777           <a class="code" href="group__vars.html#ga43">stp_verify_parameter</a>(v, param-&gt;<a class="code" href="structstp__parameter__t.html#o0">name</a>, 0) == 0)
00778         answer = 0;
00779     }
00780   <a class="code" href="group__vars.html#ga89">stp_parameter_list_destroy</a>(params);
00781   <a class="code" href="group__vars.html#ga31">stp_set_errfunc</a>((<a class="code" href="structstp__vars.html">stp_vars_t</a> *) v, ofunc);
00782   <a class="code" href="group__vars.html#ga35">stp_set_errdata</a>((<a class="code" href="structstp__vars.html">stp_vars_t</a> *) v, odata);
00783   <a class="code" href="group__vars.html#ga27">stp_set_verified</a>((<a class="code" href="structstp__vars.html">stp_vars_t</a> *) v, answer);
00784   <span class="keywordflow">if</span> (errbuf.<a class="code" href="structerrbuf__t.html#o1">bytes</a> &gt; 0)
00785     {
00786       <a class="code" href="print-util_8c.html#a18">stp_eprintf</a>(v, <span class="stringliteral">"%s"</span>, errbuf.<a class="code" href="structerrbuf__t.html#o0">data</a>);
00787       <a class="code" href="group__util.html#ga31">stp_free</a>(errbuf.<a class="code" href="structerrbuf__t.html#o0">data</a>);
00788     }
00789   <span class="keywordflow">return</span> answer;
00790 }
00791 
00792 <span class="keywordtype">int</span>
<a name="l00793"></a><a class="code" href="group__printer.html#ga46">00793</a> <a class="code" href="group__printer.html#ga46">stp_family_register</a>(<a class="code" href="structstp__list.html">stp_list_t</a> *family)
00794 {
00795   <a class="code" href="structstp__list__item.html">stp_list_item_t</a> *printer_item;
00796   <span class="keyword">const</span> <a class="code" href="structstp__printer.html">stp_printer_t</a> *printer;
00797 
00798   <span class="keywordflow">if</span> (printer_list == NULL)
00799     {
00800       <a class="code" href="printers_8c.html#a7">stpi_init_printer_list</a>();
00801       <a class="code" href="group__util.html#ga21">stp_deprintf</a>
00802         (<a class="code" href="group__util.html#ga46">STP_DBG_PRINTERS</a>,
00803          <span class="stringliteral">"stpi_family_register(): initialising printer_list...\n"</span>);
00804     }
00805 
00806   <span class="keywordflow">if</span> (family)
00807     {
00808       printer_item = <a class="code" href="print-list_8c.html#a12">stp_list_get_start</a>(family);
00809 
00810       <span class="keywordflow">while</span>(printer_item)
00811         {
00812           printer = (<span class="keyword">const</span> <a class="code" href="structstp__printer.html">stp_printer_t</a> *) <a class="code" href="print-list_8c.html#a33">stp_list_item_get_data</a>(printer_item);
00813           <span class="keywordflow">if</span> (!<a class="code" href="print-list_8c.html#a16">stp_list_get_item_by_name</a>(printer_list,
00814                                           <a class="code" href="group__vars.html#ga13">stp_get_driver</a>(printer-&gt;<a class="code" href="structstp__printer.html#o6">printvars</a>)))
00815             <a class="code" href="print-list_8c.html#a29">stp_list_item_create</a>(printer_list, NULL, printer);
00816           printer_item = <a class="code" href="print-list_8c.html#a32">stp_list_item_next</a>(printer_item);
00817         }
00818     }
00819 
00820   <span class="keywordflow">return</span> 0;
00821 }
00822 
00823 <span class="keywordtype">int</span>
<a name="l00824"></a><a class="code" href="group__printer.html#ga47">00824</a> <a class="code" href="group__printer.html#ga47">stp_family_unregister</a>(<a class="code" href="structstp__list.html">stp_list_t</a> *family)
00825 {
00826   <a class="code" href="structstp__list__item.html">stp_list_item_t</a> *printer_item;
00827   <a class="code" href="structstp__list__item.html">stp_list_item_t</a> *old_printer_item;
00828   <span class="keyword">const</span> <a class="code" href="structstp__printer.html">stp_printer_t</a> *printer;
00829 
00830   <span class="keywordflow">if</span> (printer_list == NULL)
00831     {
00832       <a class="code" href="printers_8c.html#a7">stpi_init_printer_list</a>();
00833       <a class="code" href="group__util.html#ga21">stp_deprintf</a>
00834         (<a class="code" href="group__util.html#ga46">STP_DBG_PRINTERS</a>,
00835          <span class="stringliteral">"stpi_family_unregister(): initialising printer_list...\n"</span>);
00836     }
00837 
00838   <span class="keywordflow">if</span> (family)
00839     {
00840       printer_item = <a class="code" href="print-list_8c.html#a12">stp_list_get_start</a>(family);
00841 
00842       <span class="keywordflow">while</span>(printer_item)
00843         {
00844           printer = (<span class="keyword">const</span> <a class="code" href="structstp__printer.html">stp_printer_t</a> *) <a class="code" href="print-list_8c.html#a33">stp_list_item_get_data</a>(printer_item);
00845           old_printer_item =
00846             <a class="code" href="print-list_8c.html#a16">stp_list_get_item_by_name</a>(printer_list,
00847                                       <a class="code" href="group__vars.html#ga13">stp_get_driver</a>(printer-&gt;<a class="code" href="structstp__printer.html#o6">printvars</a>));
00848 
00849           <span class="keywordflow">if</span> (old_printer_item)
00850             <a class="code" href="print-list_8c.html#a30">stp_list_item_destroy</a>(printer_list, old_printer_item);
00851           printer_item = <a class="code" href="print-list_8c.html#a32">stp_list_item_next</a>(printer_item);
00852         }
00853     }
00854   <span class="keywordflow">return</span> 0;
00855 }
00856 
00857 <span class="comment">/*</span>
00858 <span class="comment"> * Parse the printer node, and return the generated printer.  Returns</span>
00859 <span class="comment"> * NULL on failure.</span>
00860 <span class="comment"> */</span>
00861 <span class="keyword">static</span> <a class="code" href="structstp__printer.html">stp_printer_t</a>*
<a name="l00862"></a><a class="code" href="printers_8c.html#a48">00862</a> <a class="code" href="printers_8c.html#a48">stp_printer_create_from_xmltree</a>(<a class="code" href="structstp__mxml__node__s.html">stp_mxml_node_t</a> *printer, <span class="comment">/* The printer node */</span>
00863                                 <span class="keyword">const</span> <span class="keywordtype">char</span> *family,       <span class="comment">/* Family name */</span>
00864                                 <span class="keyword">const</span> <a class="code" href="structstp__printfuncs__t.html">stp_printfuncs_t</a> *printfuncs)
00865                                                        <span class="comment">/* Family printfuncs */</span>
00866 {
00867   <a class="code" href="structstp__mxml__node__s.html">stp_mxml_node_t</a> *prop;                                  <span class="comment">/* Temporary node pointer */</span>
00868   <span class="keyword">const</span> <span class="keywordtype">char</span> *stmp;                                    <span class="comment">/* Temporary string */</span>
00869   <a class="code" href="structstp__printer.html">stp_printer_t</a> *outprinter;                 <span class="comment">/* Generated printer */</span>
00870   <span class="keywordtype">int</span>
00871     driver = 0,                                       <span class="comment">/* Check driver */</span>
00872     long_name = 0;
00873 
00874   outprinter = <a class="code" href="group__util.html#ga29">stp_zalloc</a>(<span class="keyword">sizeof</span>(<a class="code" href="structstp__printer.html">stp_printer_t</a>));
00875   <span class="keywordflow">if</span> (!outprinter)
00876     <span class="keywordflow">return</span> NULL;
00877   outprinter-&gt;<a class="code" href="structstp__printer.html#o6">printvars</a> = <a class="code" href="group__vars.html#ga7">stp_vars_create</a>();
00878   <span class="keywordflow">if</span> (outprinter-&gt;<a class="code" href="structstp__printer.html#o6">printvars</a> == NULL)
00879     {
00880       <a class="code" href="group__util.html#ga31">stp_free</a>(outprinter);
00881       <span class="keywordflow">return</span> NULL;
00882     }
00883 
00884   stmp = <a class="code" href="mxml-attr_8c.html#a0">stp_mxmlElementGetAttr</a>(printer, <span class="stringliteral">"driver"</span>);
00885   <a class="code" href="group__vars.html#ga11">stp_set_driver</a>(outprinter-&gt;<a class="code" href="structstp__printer.html#o6">printvars</a>, (<span class="keyword">const</span> <span class="keywordtype">char</span> *) stmp);
00886 
00887   outprinter-&gt;<a class="code" href="structstp__printer.html#o1">long_name</a> = <a class="code" href="group__util.html#ga35">stp_strdup</a>(<a class="code" href="mxml-attr_8c.html#a0">stp_mxmlElementGetAttr</a>(printer, <span class="stringliteral">"name"</span>));
00888   outprinter-&gt;<a class="code" href="structstp__printer.html#o3">manufacturer</a> = <a class="code" href="group__util.html#ga35">stp_strdup</a>(<a class="code" href="mxml-attr_8c.html#a0">stp_mxmlElementGetAttr</a>(printer, <span class="stringliteral">"manufacturer"</span>));
00889   outprinter-&gt;<a class="code" href="structstp__printer.html#o4">model</a> = <a class="code" href="xml_8c.html#a21">stp_xmlstrtol</a>(<a class="code" href="mxml-attr_8c.html#a0">stp_mxmlElementGetAttr</a>(printer, <span class="stringliteral">"model"</span>));
00890   outprinter-&gt;<a class="code" href="structstp__printer.html#o2">family</a> = <a class="code" href="group__util.html#ga35">stp_strdup</a>((<span class="keyword">const</span> <span class="keywordtype">char</span> *) family);
00891 
00892   <span class="keywordflow">if</span> (<a class="code" href="group__vars.html#ga13">stp_get_driver</a>(outprinter-&gt;<a class="code" href="structstp__printer.html#o6">printvars</a>))
00893     driver = 1;
00894   <span class="keywordflow">if</span> (outprinter-&gt;<a class="code" href="structstp__printer.html#o1">long_name</a>)
00895     long_name = 1;
00896 
00897   outprinter-&gt;<a class="code" href="structstp__printer.html#o5">printfuncs</a> = printfuncs;
00898 
00899   prop = printer-&gt;<a class="code" href="structstp__mxml__node__s.html#o4">child</a>;
00900   <span class="keywordflow">while</span> (prop)
00901     {
00902       <span class="keywordflow">if</span> (prop-&gt;<a class="code" href="structstp__mxml__node__s.html#o0">type</a> == <a class="code" href="mxml_8h.html#a43a20">STP_MXML_ELEMENT</a>)
00903         {
00904           <span class="keyword">const</span> <span class="keywordtype">char</span> *prop_name = prop-&gt;<a class="code" href="structstp__mxml__node__s.html#o6">value</a>.<a class="code" href="unionstp__mxml__value__u.html#o0">element</a>.<a class="code" href="structstp__mxml__value__s.html#o0">name</a>;
00905           <span class="keywordflow">if</span> (!strcmp(prop_name, <span class="stringliteral">"parameter"</span>))
00906             {
00907               <span class="keyword">const</span> <span class="keywordtype">char</span> *p_type = <a class="code" href="mxml-attr_8c.html#a0">stp_mxmlElementGetAttr</a>(prop, <span class="stringliteral">"type"</span>);
00908               <span class="keyword">const</span> <span class="keywordtype">char</span> *p_name = <a class="code" href="mxml-attr_8c.html#a0">stp_mxmlElementGetAttr</a>(prop, <span class="stringliteral">"name"</span>);
00909               <a class="code" href="structstp__mxml__node__s.html">stp_mxml_node_t</a> *child = prop-&gt;<a class="code" href="structstp__mxml__node__s.html#o4">child</a>;
00910               <span class="keywordflow">if</span> (!p_type || !p_name)
00911                 <a class="code" href="print-util_8c.html#a20">stp_erprintf</a>(<span class="stringliteral">"Bad property on driver %s\n"</span>, outprinter-&gt;<a class="code" href="structstp__printer.html#o0">driver</a>);
00912               <span class="keywordflow">else</span> <span class="keywordflow">if</span> (strcmp(p_type, <span class="stringliteral">"float"</span>) == 0)
00913                 {
00914                   <span class="keywordflow">if</span> (child-&gt;<a class="code" href="structstp__mxml__node__s.html#o0">type</a> == <a class="code" href="mxml_8h.html#a43a24">STP_MXML_TEXT</a>)
00915                     <a class="code" href="group__vars.html#ga54">stp_set_float_parameter</a>
00916                       (outprinter-&gt;<a class="code" href="structstp__printer.html#o6">printvars</a>, p_name,
00917                        <a class="code" href="xml_8c.html#a23">stp_xmlstrtod</a>(child-&gt;<a class="code" href="structstp__mxml__node__s.html#o6">value</a>.<a class="code" href="unionstp__mxml__value__u.html#o4">text</a>.<a class="code" href="structstp__mxml__text__s.html#o1">string</a>));
00918                 }
00919               <span class="keywordflow">else</span> <span class="keywordflow">if</span> (strcmp(p_type, <span class="stringliteral">"integer"</span>) == 0)
00920                 {
00921                   <span class="keywordflow">if</span> (child-&gt;<a class="code" href="structstp__mxml__node__s.html#o0">type</a> == <a class="code" href="mxml_8h.html#a43a24">STP_MXML_TEXT</a>)
00922                     <a class="code" href="group__vars.html#ga55">stp_set_int_parameter</a>
00923                       (outprinter-&gt;<a class="code" href="structstp__printer.html#o6">printvars</a>, p_name,
00924                        (<span class="keywordtype">int</span>) <a class="code" href="xml_8c.html#a21">stp_xmlstrtol</a>(child-&gt;<a class="code" href="structstp__mxml__node__s.html#o6">value</a>.<a class="code" href="unionstp__mxml__value__u.html#o4">text</a>.<a class="code" href="structstp__mxml__text__s.html#o1">string</a>));
00925                 }
00926               <span class="keywordflow">else</span> <span class="keywordflow">if</span> (strcmp(p_type, <span class="stringliteral">"boolean"</span>) == 0)
00927                 {
00928                   <span class="keywordflow">if</span> (child-&gt;<a class="code" href="structstp__mxml__node__s.html#o0">type</a> == <a class="code" href="mxml_8h.html#a43a24">STP_MXML_TEXT</a>)
00929                     <a class="code" href="group__vars.html#ga57">stp_set_boolean_parameter</a>
00930                       (outprinter-&gt;<a class="code" href="structstp__printer.html#o6">printvars</a>, p_name,
00931                        (<span class="keywordtype">int</span>) <a class="code" href="xml_8c.html#a21">stp_xmlstrtol</a>(child-&gt;<a class="code" href="structstp__mxml__node__s.html#o6">value</a>.<a class="code" href="unionstp__mxml__value__u.html#o4">text</a>.<a class="code" href="structstp__mxml__text__s.html#o1">string</a>));
00932                 }
00933               <span class="keywordflow">else</span> <span class="keywordflow">if</span> (strcmp(p_type, <span class="stringliteral">"string"</span>) == 0)
00934                 {
00935                   <span class="keywordflow">if</span> (child-&gt;<a class="code" href="structstp__mxml__node__s.html#o0">type</a> == <a class="code" href="mxml_8h.html#a43a24">STP_MXML_TEXT</a>)
00936                     <a class="code" href="group__vars.html#ga50">stp_set_string_parameter</a>
00937                       (outprinter-&gt;<a class="code" href="structstp__printer.html#o6">printvars</a>, p_name, child-&gt;<a class="code" href="structstp__mxml__node__s.html#o6">value</a>.<a class="code" href="unionstp__mxml__value__u.html#o4">text</a>.<a class="code" href="structstp__mxml__text__s.html#o1">string</a>);
00938                 }
00939               <span class="keywordflow">else</span> <span class="keywordflow">if</span> (strcmp(p_type, <span class="stringliteral">"curve"</span>) == 0)
00940                 {
00941                   <a class="code" href="structstp__curve.html">stp_curve_t</a> *curve = <a class="code" href="curve_8c.html#a57">stp_curve_create_from_xmltree</a>(child);
00942                   <span class="keywordflow">if</span> (curve)
00943                     {
00944                       <a class="code" href="group__vars.html#ga47">stp_set_curve_parameter</a>(outprinter-&gt;<a class="code" href="structstp__printer.html#o6">printvars</a>,
00945                                               p_name, curve);
00946                       <a class="code" href="group__curve.html#ga22">stp_curve_destroy</a>(curve);
00947                     }
00948                 }
00949               <span class="keywordflow">else</span> <span class="keywordflow">if</span> (strcmp(p_type, <span class="stringliteral">"array"</span>) == 0)
00950                 {
00951                   <a class="code" href="structstp__array.html">stp_array_t</a> *array = <a class="code" href="array_8c.html#a14">stp_array_create_from_xmltree</a>(child);
00952                   <span class="keywordflow">if</span> (array)
00953                     {
00954                       <a class="code" href="group__vars.html#ga51">stp_set_array_parameter</a>(outprinter-&gt;<a class="code" href="structstp__printer.html#o6">printvars</a>,
00955                                               p_name, array);
00956                       <a class="code" href="group__array.html#ga4">stp_array_destroy</a>(array);
00957                     }
00958                 }
00959               <span class="keywordflow">else</span>
00960                 {
00961                   <a class="code" href="print-util_8c.html#a20">stp_erprintf</a>(<span class="stringliteral">"Bad property %s type %s on driver %s\n"</span>,
00962                                p_name, p_type, outprinter-&gt;<a class="code" href="structstp__printer.html#o0">driver</a>);
00963                   <span class="keywordflow">continue</span>;
00964                 }
00965             }
00966         }
00967       prop = prop-&gt;<a class="code" href="structstp__mxml__node__s.html#o1">next</a>;
00968     }
00969   <span class="keywordflow">if</span> (driver &amp;&amp; long_name &amp;&amp; printfuncs)
00970     {
00971       <span class="keywordflow">if</span> (<a class="code" href="group__util.html#ga19">stp_get_debug_level</a>() &amp; <a class="code" href="group__util.html#ga47">STP_DBG_XML</a>)
00972         {
00973           stmp = <a class="code" href="mxml-attr_8c.html#a0">stp_mxmlElementGetAttr</a>(printer, <span class="stringliteral">"driver"</span>);
00974           <a class="code" href="print-util_8c.html#a20">stp_erprintf</a>(<span class="stringliteral">"stp_printer_create_from_xmltree: printer: %s\n"</span>, stmp);
00975         }
00976       outprinter-&gt;<a class="code" href="structstp__printer.html#o0">driver</a> = <a class="code" href="group__vars.html#ga13">stp_get_driver</a>(outprinter-&gt;<a class="code" href="structstp__printer.html#o6">printvars</a>);
00977       <span class="keywordflow">return</span> outprinter;
00978     }
00979   <a class="code" href="group__util.html#ga31">stp_free</a>(outprinter);
00980   <span class="keywordflow">return</span> NULL;
00981 }
00982 
00983 <span class="comment">/*</span>
00984 <span class="comment"> * Parse the &lt;family&gt; node.</span>
00985 <span class="comment"> */</span>
00986 <span class="keyword">static</span> <span class="keywordtype">void</span>
<a name="l00987"></a><a class="code" href="printers_8c.html#a49">00987</a> <a class="code" href="printers_8c.html#a49">stpi_xml_process_family</a>(<a class="code" href="structstp__mxml__node__s.html">stp_mxml_node_t</a> *family)     <span class="comment">/* The family node */</span>
00988 {
00989   <a class="code" href="structstp__list.html">stp_list_t</a> *family_module_list = NULL;      <span class="comment">/* List of valid families */</span>
00990   <a class="code" href="structstp__list__item.html">stp_list_item_t</a> *family_module_item;        <span class="comment">/* Current family */</span>
00991   <span class="keyword">const</span> <span class="keywordtype">char</span> *family_name;                       <span class="comment">/* Name of family */</span>
00992   <a class="code" href="structstp__mxml__node__s.html">stp_mxml_node_t</a> *printer;                         <span class="comment">/* printer child node */</span>
00993   <a class="code" href="structstp__module.html">stp_module_t</a> *family_module_data;           <span class="comment">/* Family module data */</span>
00994   <a class="code" href="structstp__family.html">stp_family_t</a> *family_data = NULL;  <span class="comment">/* Family data */</span>
00995   <span class="keywordtype">int</span> family_valid = 0;                       <span class="comment">/* Is family valid? */</span>
00996   <a class="code" href="structstp__printer.html">stp_printer_t</a> *outprinter;         <span class="comment">/* Generated printer */</span>
00997 
00998   family_module_list = <a class="code" href="module_8c.html#a16">stp_module_get_class</a>(<a class="code" href="module_8h.html#a13a4">STP_MODULE_CLASS_FAMILY</a>);
00999   <span class="keywordflow">if</span> (!family_module_list)
01000     <span class="keywordflow">return</span>;
01001 
01002   family_name = <a class="code" href="mxml-attr_8c.html#a0">stp_mxmlElementGetAttr</a>(family, <span class="stringliteral">"name"</span>);
01003   family_module_item = <a class="code" href="print-list_8c.html#a12">stp_list_get_start</a>(family_module_list);
01004   <span class="keywordflow">while</span> (family_module_item)
01005     {
01006       family_module_data = (<a class="code" href="structstp__module.html">stp_module_t</a> *)
01007         <a class="code" href="print-list_8c.html#a33">stp_list_item_get_data</a>(family_module_item);
01008       <span class="keywordflow">if</span> (!strcmp(family_name, family_module_data-&gt;<a class="code" href="structstp__module.html#o0">name</a>))
01009         {
01010           <a class="code" href="print-util_8c.html#a24">stp_deprintf</a>(<a class="code" href="group__util.html#ga47">STP_DBG_XML</a>,
01011                        <span class="stringliteral">"stpi_xml_process_family: family module: %s\n"</span>,
01012                        family_module_data-&gt;<a class="code" href="structstp__module.html#o0">name</a>);
01013           family_data = family_module_data-&gt;<a class="code" href="structstp__module.html#o7">syms</a>;
01014           <span class="keywordflow">if</span> (family_data-&gt;<a class="code" href="structstp__family.html#o1">printer_list</a> == NULL)
01015             family_data-&gt;<a class="code" href="structstp__family.html#o1">printer_list</a> = <a class="code" href="list_8h.html#a7">stp_list_create</a>();
01016           family_valid = 1;
01017         }
01018       family_module_item = <a class="code" href="print-list_8c.html#a32">stp_list_item_next</a>(family_module_item);
01019     }
01020 
01021   printer = family-&gt;<a class="code" href="structstp__mxml__node__s.html#o4">child</a>;
01022   <span class="keywordflow">while</span> (family_valid &amp;&amp; printer)
01023     {
01024       <span class="keywordflow">if</span> (printer-&gt;<a class="code" href="structstp__mxml__node__s.html#o0">type</a> == <a class="code" href="mxml_8h.html#a43a20">STP_MXML_ELEMENT</a>)
01025         {
01026           <span class="keyword">const</span> <span class="keywordtype">char</span> *printer_name = printer-&gt;<a class="code" href="structstp__mxml__node__s.html#o6">value</a>.<a class="code" href="unionstp__mxml__value__u.html#o0">element</a>.<a class="code" href="structstp__mxml__value__s.html#o0">name</a>;
01027           <span class="keywordflow">if</span> (!strcmp(printer_name, <span class="stringliteral">"printer"</span>))
01028             {
01029               outprinter =
01030                 <a class="code" href="printers_8c.html#a48">stp_printer_create_from_xmltree</a>(printer, family_name,
01031                                                 family_data-&gt;<a class="code" href="structstp__family.html#o0">printfuncs</a>);
01032               <span class="keywordflow">if</span> (outprinter)
01033                 <a class="code" href="print-list_8c.html#a29">stp_list_item_create</a>(family_data-&gt;<a class="code" href="structstp__family.html#o1">printer_list</a>, NULL,
01034                                       outprinter);
01035             }
01036         }
01037       printer = printer-&gt;<a class="code" href="structstp__mxml__node__s.html#o1">next</a>;
01038     }
01039 
01040   <a class="code" href="print-list_8c.html#a10">stp_list_destroy</a>(family_module_list);
01041   <span class="keywordflow">return</span>;
01042 }
01043 
01044 <span class="comment">/*</span>
01045 <span class="comment"> * Parse the &lt;printdef&gt; node.</span>
01046 <span class="comment"> */</span>
01047 <span class="keyword">static</span> <span class="keywordtype">int</span>
<a name="l01048"></a><a class="code" href="printers_8c.html#a50">01048</a> <a class="code" href="printers_8c.html#a50">stpi_xml_process_printdef</a>(<a class="code" href="structstp__mxml__node__s.html">stp_mxml_node_t</a> *printdef, <span class="keyword">const</span> <span class="keywordtype">char</span> *file) <span class="comment">/* The printdef node */</span>
01049 {
01050   <a class="code" href="structstp__mxml__node__s.html">stp_mxml_node_t</a> *family;                          <span class="comment">/* Family child node */</span>
01051 
01052   family = printdef-&gt;<a class="code" href="structstp__mxml__node__s.html#o4">child</a>;
01053   <span class="keywordflow">while</span> (family)
01054     {
01055       <span class="keywordflow">if</span> (family-&gt;<a class="code" href="structstp__mxml__node__s.html#o0">type</a> == <a class="code" href="mxml_8h.html#a43a20">STP_MXML_ELEMENT</a>)
01056         {
01057           <span class="keyword">const</span> <span class="keywordtype">char</span> *family_name = family-&gt;<a class="code" href="structstp__mxml__node__s.html#o6">value</a>.<a class="code" href="unionstp__mxml__value__u.html#o0">element</a>.<a class="code" href="structstp__mxml__value__s.html#o0">name</a>;
01058           <span class="keywordflow">if</span> (!strcmp(family_name, <span class="stringliteral">"family"</span>))
01059             {
01060               <a class="code" href="printers_8c.html#a49">stpi_xml_process_family</a>(family);
01061             }
01062         }
01063       family = family-&gt;<a class="code" href="structstp__mxml__node__s.html#o1">next</a>;
01064     }
01065   <span class="keywordflow">return</span> 1;
01066 }
01067 
01068 <span class="keywordtype">void</span>
<a name="l01069"></a><a class="code" href="group__util__internal.html#ga2">01069</a> <a class="code" href="group__util__internal.html#ga51">stpi_init_printer</a>(<span class="keywordtype">void</span>)
01070 {
01071   <a class="code" href="xml_8c.html#a10">stp_register_xml_parser</a>(<span class="stringliteral">"printdef"</span>, <a class="code" href="printers_8c.html#a50">stpi_xml_process_printdef</a>);
01072   <a class="code" href="xml_8c.html#a12">stp_register_xml_preload</a>(<span class="stringliteral">"printers.xml"</span>);
01073 }
</pre></div><hr size="1"><address style="align: right;"><small>Generated on Wed Aug 25 07:56:15 2004 for libgimpprint API Reference by
<a href="http://www.doxygen.org/index.html">
<img src="doxygen.png" alt="doxygen" align="middle" border=0 > </a>1.3.6 </small></address>
</body>
</html>
