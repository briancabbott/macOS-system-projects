<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html><head><meta http-equiv="Content-Type" content="text/html;charset=iso-8859-1">
<title>libgimpprint API Reference: src/main/print-escp2.c Source File</title>
<link href="doxygen.css" rel="stylesheet" type="text/css">
</head><body>
<!-- Generated by Doxygen 1.3.6 -->
<div class="qindex"><a class="qindex" href="index.html">Main&nbsp;Page</a> | <a class="qindex" href="modules.html">Modules</a> | <a class="qindex" href="classes.html">Alphabetical&nbsp;List</a> | <a class="qindex" href="annotated.html">Data&nbsp;Structures</a> | <a class="qindex" href="files.html">File&nbsp;List</a> | <a class="qindex" href="functions.html">Data&nbsp;Fields</a> | <a class="qindex" href="globals.html">Globals</a> | <a class="qindex" href="pages.html">Related&nbsp;Pages</a></div>
<h1>src/main/print-escp2.c</h1><a href="print-escp2_8c.html">Go to the documentation of this file.</a><div class="fragment"><pre>00001 <span class="comment">/*</span>
00002 <span class="comment"> * "$Id: print-escp2_8c-source.html,v 1.1.1.2 2004/12/22 23:49:07 jlovell Exp $"</span>
00003 <span class="comment"> *</span>
00004 <span class="comment"> *   Print plug-in EPSON ESC/P2 driver for the GIMP.</span>
00005 <span class="comment"> *</span>
00006 <span class="comment"> *   Copyright 1997-2000 Michael Sweet (mike@easysw.com) and</span>
00007 <span class="comment"> *      Robert Krawitz (rlk@alum.mit.edu)</span>
00008 <span class="comment"> *</span>
00009 <span class="comment"> *   This program is free software; you can redistribute it and/or modify it</span>
00010 <span class="comment"> *   under the terms of the GNU General Public License as published by the Free</span>
00011 <span class="comment"> *   Software Foundation; either version 2 of the License, or (at your option)</span>
00012 <span class="comment"> *   any later version.</span>
00013 <span class="comment"> *</span>
00014 <span class="comment"> *   This program is distributed in the hope that it will be useful, but</span>
00015 <span class="comment"> *   WITHOUT ANY WARRANTY; without even the implied warranty of MERCHANTABILITY</span>
00016 <span class="comment"> *   or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU General Public License</span>
00017 <span class="comment"> *   for more details.</span>
00018 <span class="comment"> *</span>
00019 <span class="comment"> *   You should have received a copy of the GNU General Public License</span>
00020 <span class="comment"> *   along with this program; if not, write to the Free Software</span>
00021 <span class="comment"> *   Foundation, Inc., 59 Temple Place - Suite 330, Boston, MA 02111-1307, USA.</span>
00022 <span class="comment"> */</span>
00023 
00024 <span class="comment">/*</span>
00025 <span class="comment"> * This file must include only standard C header files.  The core code must</span>
00026 <span class="comment"> * compile on generic platforms that don't support glib, gimp, gtk, etc.</span>
00027 <span class="comment"> */</span>
00028 
00029 <span class="preprocessor">#ifdef HAVE_CONFIG_H</span>
00030 <span class="preprocessor"></span><span class="preprocessor">#include &lt;config.h&gt;</span>
00031 <span class="preprocessor">#endif</span>
00032 <span class="preprocessor"></span><span class="preprocessor">#include &lt;<a class="code" href="gimp-print_8h.html">gimp-print/gimp-print.h</a>&gt;</span>
00033 <span class="preprocessor">#include &lt;<a class="code" href="gimp-print-intl-internal_8h.html">gimp-print/gimp-print-intl-internal.h</a>&gt;</span>
00034 <span class="preprocessor">#include "<a class="code" href="gimp-print-internal_8h.html">gimp-print-internal.h</a>"</span>
00035 <span class="preprocessor">#include &lt;string.h&gt;</span>
00036 <span class="preprocessor">#include &lt;assert.h&gt;</span>
00037 <span class="preprocessor">#include &lt;math.h&gt;</span>
00038 <span class="preprocessor">#include "<a class="code" href="print-escp2_8h.html">print-escp2.h</a>"</span>
00039 
00040 <span class="preprocessor">#ifdef __GNUC__</span>
00041 <span class="preprocessor"></span><span class="preprocessor">#define inline __inline__</span>
00042 <span class="preprocessor"></span><span class="preprocessor">#endif</span>
00043 <span class="preprocessor"></span>
<a name="l00044"></a><a class="code" href="print-escp2_8c.html#a0">00044</a> <span class="preprocessor">#define OP_JOB_START 1</span>
<a name="l00045"></a><a class="code" href="print-escp2_8c.html#a1">00045</a> <span class="preprocessor"></span><span class="preprocessor">#define OP_JOB_PRINT 2</span>
<a name="l00046"></a><a class="code" href="print-escp2_8c.html#a2">00046</a> <span class="preprocessor"></span><span class="preprocessor">#define OP_JOB_END   4</span>
00047 <span class="preprocessor"></span>
<a name="l00048"></a><a class="code" href="print-escp2_8c.html#a3">00048</a> <span class="preprocessor">#define MAX(a, b) ((a) &gt; (b) ? (a) : (b))</span>
00049 <span class="preprocessor"></span>
<a name="l00050"></a><a class="code" href="structescp2__printer__attr__t.html">00050</a> <span class="keyword">typedef</span> <span class="keyword">struct</span>
00051 <span class="keyword"></span>{
<a name="l00052"></a><a class="code" href="structescp2__printer__attr__t.html#o0">00052</a>   <span class="keyword">const</span> <span class="keywordtype">char</span> *attr_name;
<a name="l00053"></a><a class="code" href="structescp2__printer__attr__t.html#o1">00053</a>   <span class="keywordtype">short</span> bit_shift;
<a name="l00054"></a><a class="code" href="structescp2__printer__attr__t.html#o2">00054</a>   <span class="keywordtype">short</span> bit_width;
00055 } <a class="code" href="structescp2__printer__attr__t.html">escp2_printer_attr_t</a>;
00056 
<a name="l00057"></a><a class="code" href="print-escp2_8c.html#a14">00057</a> <span class="keyword">static</span> <span class="keyword">const</span> <a class="code" href="structescp2__printer__attr__t.html">escp2_printer_attr_t</a> <a class="code" href="print-escp2_8c.html#a14">escp2_printer_attrs</a>[] =
00058 {
00059   { <span class="stringliteral">"command_mode"</span>,             0, 4 },
00060   { <span class="stringliteral">"horizontal_zero_margin"</span>,   4, 1 },
00061   { <span class="stringliteral">"rollfeed"</span>,                 5, 1 },
00062   { <span class="stringliteral">"variable_mode"</span>,            6, 1 },
00063   { <span class="stringliteral">"graymode"</span>,                 7, 1 },
00064   { <span class="stringliteral">"vacuum"</span>,                   8, 1 },
00065   { <span class="stringliteral">"fast_360"</span>,                 9, 1 },
00066   { <span class="stringliteral">"send_zero_advance"</span>,       10, 1 },
00067   { <span class="stringliteral">"supports_ink_change"</span>,     11, 1 },
00068   { <span class="stringliteral">"packet_mode"</span>,             12, 1 },
00069   { <span class="stringliteral">"print_to_cd"</span>,             13, 1 },
00070 };
00071 
<a name="l00072"></a><a class="code" href="structchannel__count__t.html">00072</a> <span class="keyword">typedef</span> <span class="keyword">struct</span>
00073 <span class="keyword"></span>{
<a name="l00074"></a><a class="code" href="structchannel__count__t.html#o0">00074</a>   <span class="keywordtype">unsigned</span> count;
<a name="l00075"></a><a class="code" href="structchannel__count__t.html#o1">00075</a>   <span class="keyword">const</span> <span class="keywordtype">char</span> *name;
00076 } <a class="code" href="structchannel__count__t.html">channel_count_t</a>;
00077 
<a name="l00078"></a><a class="code" href="print-escp2_8c.html#a15">00078</a> <span class="keyword">static</span> <span class="keyword">const</span> <a class="code" href="structchannel__count__t.html">channel_count_t</a> <a class="code" href="print-escp2_8c.html#a15">escp2_channel_counts</a>[] =
00079 {
00080   { 1,  <span class="stringliteral">"1"</span> },
00081   { 2,  <span class="stringliteral">"2"</span> },
00082   { 3,  <span class="stringliteral">"3"</span> },
00083   { 4,  <span class="stringliteral">"4"</span> },
00084   { 5,  <span class="stringliteral">"5"</span> },
00085   { 6,  <span class="stringliteral">"6"</span> },
00086   { 7,  <span class="stringliteral">"7"</span> },
00087   { 8,  <span class="stringliteral">"8"</span> },
00088   { 9,  <span class="stringliteral">"9"</span> },
00089   { 10, <span class="stringliteral">"10"</span> },
00090   { 11, <span class="stringliteral">"11"</span> },
00091   { 12, <span class="stringliteral">"12"</span> },
00092   { 13, <span class="stringliteral">"13"</span> },
00093   { 14, <span class="stringliteral">"14"</span> },
00094   { 15, <span class="stringliteral">"15"</span> },
00095   { 16, <span class="stringliteral">"16"</span> },
00096   { 17, <span class="stringliteral">"17"</span> },
00097   { 18, <span class="stringliteral">"18"</span> },
00098   { 19, <span class="stringliteral">"19"</span> },
00099   { 20, <span class="stringliteral">"20"</span> },
00100   { 21, <span class="stringliteral">"21"</span> },
00101   { 22, <span class="stringliteral">"22"</span> },
00102   { 23, <span class="stringliteral">"23"</span> },
00103   { 24, <span class="stringliteral">"24"</span> },
00104   { 25, <span class="stringliteral">"25"</span> },
00105   { 26, <span class="stringliteral">"26"</span> },
00106   { 27, <span class="stringliteral">"27"</span> },
00107   { 28, <span class="stringliteral">"28"</span> },
00108   { 29, <span class="stringliteral">"29"</span> },
00109   { 30, <span class="stringliteral">"30"</span> },
00110   { 31, <span class="stringliteral">"31"</span> },
00111   { 32, <span class="stringliteral">"32"</span> },
00112 };
00113 
<a name="l00114"></a><a class="code" href="print-escp2_8c.html#a16">00114</a> <span class="keyword">static</span> <span class="keywordtype">int</span> <a class="code" href="print-escp2_8c.html#a16">escp2_channel_counts_count</a> =
00115 <span class="keyword">sizeof</span>(<a class="code" href="print-escp2_8c.html#a15">escp2_channel_counts</a>) / <span class="keyword">sizeof</span>(<a class="code" href="structchannel__count__t.html">channel_count_t</a>);
00116 
<a name="l00117"></a><a class="code" href="print-escp2_8c.html#a17">00117</a> <span class="keyword">static</span> <span class="keyword">const</span> <span class="keywordtype">double</span> <a class="code" href="print-escp2_8c.html#a17">ink_darknesses</a>[] =
00118 {
00119   1.0, 0.31 / .4, 0.61 / .96, 0.08, 0.31 * 0.33 / .4, 0.61 * 0.33 / .96, 0.33, 1.0
00120 };
00121 
<a name="l00122"></a><a class="code" href="print-escp2_8c.html#a4">00122</a> <span class="preprocessor">#define INCH(x)         (72 * x)</span>
00123 <span class="preprocessor"></span>
00124 <span class="keyword">static</span> <span class="keyword">const</span> <a class="code" href="structres__t.html">res_t</a> *<a class="code" href="print-escp2_8c.html#a26">escp2_find_resolution</a>(<span class="keyword">const</span> <a class="code" href="structstp__vars.html">stp_vars_t</a> *v);
00125 
<a name="l00126"></a><a class="code" href="print-escp2_8c.html#a5">00126</a> <span class="preprocessor">#define PARAMETER_INT(s)                                                \</span>
00127 <span class="preprocessor">{                                                                       \</span>
00128 <span class="preprocessor">  "escp2_" #s, "escp2_" #s, N_("Advanced Printer Functionality"), NULL, \</span>
00129 <span class="preprocessor">  STP_PARAMETER_TYPE_INT, STP_PARAMETER_CLASS_FEATURE,                  \</span>
00130 <span class="preprocessor">  STP_PARAMETER_LEVEL_INTERNAL, 0, 1, -1, 1, 0                          \</span>
00131 <span class="preprocessor">}</span>
00132 <span class="preprocessor"></span>
<a name="l00133"></a><a class="code" href="print-escp2_8c.html#a6">00133</a> <span class="preprocessor">#define PARAMETER_INT_RO(s)                                             \</span>
00134 <span class="preprocessor">{                                                                       \</span>
00135 <span class="preprocessor">  "escp2_" #s, "escp2_" #s, N_("Advanced Printer Functionality"), NULL, \</span>
00136 <span class="preprocessor">  STP_PARAMETER_TYPE_INT, STP_PARAMETER_CLASS_FEATURE,                  \</span>
00137 <span class="preprocessor">  STP_PARAMETER_LEVEL_INTERNAL, 0, 1, -1, 1, 1                          \</span>
00138 <span class="preprocessor">}</span>
00139 <span class="preprocessor"></span>
<a name="l00140"></a><a class="code" href="print-escp2_8c.html#a7">00140</a> <span class="preprocessor">#define PARAMETER_RAW(s)                                                \</span>
00141 <span class="preprocessor">{                                                                       \</span>
00142 <span class="preprocessor">  "escp2_" #s, "escp2_" #s, N_("Advanced Printer Functionality"), NULL, \</span>
00143 <span class="preprocessor">  STP_PARAMETER_TYPE_RAW, STP_PARAMETER_CLASS_FEATURE,                  \</span>
00144 <span class="preprocessor">  STP_PARAMETER_LEVEL_INTERNAL, 0, 1, -1, 1, 0                          \</span>
00145 <span class="preprocessor">}</span>
00146 <span class="preprocessor"></span>
00147 <span class="keyword">typedef</span> <span class="keyword">struct</span>
00148 <span class="keyword"></span>{
00149   <span class="keyword">const</span> <a class="code" href="structstp__parameter__t.html">stp_parameter_t</a> param;
00150   <span class="keywordtype">double</span> min;
00151   <span class="keywordtype">double</span> <a class="code" href="print-lexmark_8c.html#a6">max</a>;
00152   <span class="keywordtype">double</span> defval;
00153   <span class="keywordtype">int</span> color_only;
00154 } <a class="code" href="structfloat__param__t.html">float_param_t</a>;
00155 
<a name="l00156"></a><a class="code" href="print-escp2_8c.html#a18">00156</a> <span class="keyword">static</span> <span class="keyword">const</span> <a class="code" href="structstp__parameter__t.html">stp_parameter_t</a> <a class="code" href="print-escp2_8c.html#a18">the_parameters</a>[] =
00157 {
00158 <span class="preprocessor">#if 0</span>
00159 <span class="preprocessor"></span>  {
00160     <span class="stringliteral">"AutoMode"</span>, <a class="code" href="group__intl__internal.html#ga6">N_</a>(<span class="stringliteral">"Automatic Printing Mode"</span>), <a class="code" href="group__intl__internal.html#ga6">N_</a>(<span class="stringliteral">"Basic Output Adjustment"</span>),
00161     <a class="code" href="group__intl__internal.html#ga6">N_</a>(<span class="stringliteral">"Automatic printing mode"</span>),
00162     <a class="code" href="group__vars.html#gga132a7">STP_PARAMETER_TYPE_STRING_LIST</a>, <a class="code" href="group__vars.html#gga133a17">STP_PARAMETER_CLASS_FEATURE</a>,
00163     <a class="code" href="group__vars.html#gga134a21">STP_PARAMETER_LEVEL_BASIC</a>, 1, 1, -1, 1, 0
00164   },
00165 <span class="preprocessor">#endif</span>
00166 <span class="preprocessor"></span>  <span class="comment">/*</span>
00167 <span class="comment">   * Don't check this parameter.  We may offer different settings for</span>
00168 <span class="comment">   * different papers, but we need to be able to handle settings from PPD</span>
00169 <span class="comment">   * files that don't have constraints set up.</span>
00170 <span class="comment">   */</span>
00171   {
00172     <span class="stringliteral">"Quality"</span>, <a class="code" href="group__intl__internal.html#ga6">N_</a>(<span class="stringliteral">"Print Quality"</span>), <a class="code" href="group__intl__internal.html#ga6">N_</a>(<span class="stringliteral">"Basic Output Adjustment"</span>),
00173     <a class="code" href="group__intl__internal.html#ga6">N_</a>(<span class="stringliteral">"Print Quality"</span>),
00174     <a class="code" href="group__vars.html#gga132a7">STP_PARAMETER_TYPE_STRING_LIST</a>, <a class="code" href="group__vars.html#gga133a17">STP_PARAMETER_CLASS_FEATURE</a>,
00175     <a class="code" href="group__vars.html#gga134a21">STP_PARAMETER_LEVEL_BASIC</a>, 1, 1, -1, 0, 0
00176   },
00177   {
00178     <span class="stringliteral">"PageSize"</span>, <a class="code" href="group__intl__internal.html#ga6">N_</a>(<span class="stringliteral">"Page Size"</span>), <a class="code" href="group__intl__internal.html#ga6">N_</a>(<span class="stringliteral">"Basic Printer Setup"</span>),
00179     <a class="code" href="group__intl__internal.html#ga6">N_</a>(<span class="stringliteral">"Size of the paper being printed to"</span>),
00180     <a class="code" href="group__vars.html#gga132a7">STP_PARAMETER_TYPE_STRING_LIST</a>, <a class="code" href="group__vars.html#gga133a19">STP_PARAMETER_CLASS_CORE</a>,
00181     <a class="code" href="group__vars.html#gga134a21">STP_PARAMETER_LEVEL_BASIC</a>, 1, 1, -1, 1, 0
00182   },
00183   {
00184     <span class="stringliteral">"MediaType"</span>, <a class="code" href="group__intl__internal.html#ga6">N_</a>(<span class="stringliteral">"Media Type"</span>), <a class="code" href="group__intl__internal.html#ga6">N_</a>(<span class="stringliteral">"Basic Printer Setup"</span>),
00185     <a class="code" href="group__intl__internal.html#ga6">N_</a>(<span class="stringliteral">"Type of media (plain paper, photo paper, etc.)"</span>),
00186     <a class="code" href="group__vars.html#gga132a7">STP_PARAMETER_TYPE_STRING_LIST</a>, <a class="code" href="group__vars.html#gga133a17">STP_PARAMETER_CLASS_FEATURE</a>,
00187     <a class="code" href="group__vars.html#gga134a21">STP_PARAMETER_LEVEL_BASIC</a>, 1, 1, -1, 1, 0
00188   },
00189   {
00190     <span class="stringliteral">"InputSlot"</span>, <a class="code" href="group__intl__internal.html#ga6">N_</a>(<span class="stringliteral">"Media Source"</span>), <a class="code" href="group__intl__internal.html#ga6">N_</a>(<span class="stringliteral">"Basic Printer Setup"</span>),
00191     <a class="code" href="group__intl__internal.html#ga6">N_</a>(<span class="stringliteral">"Source (input slot) of the media"</span>),
00192     <a class="code" href="group__vars.html#gga132a7">STP_PARAMETER_TYPE_STRING_LIST</a>, <a class="code" href="group__vars.html#gga133a17">STP_PARAMETER_CLASS_FEATURE</a>,
00193     <a class="code" href="group__vars.html#gga134a21">STP_PARAMETER_LEVEL_BASIC</a>, 1, 1, -1, 1, 0
00194   },
00195   {
00196     <span class="stringliteral">"CDInnerRadius"</span>, <a class="code" href="group__intl__internal.html#ga6">N_</a>(<span class="stringliteral">"CD Hub Size"</span>), <a class="code" href="group__intl__internal.html#ga6">N_</a>(<span class="stringliteral">"Basic Printer Setup"</span>),
00197     <a class="code" href="group__intl__internal.html#ga6">N_</a>(<span class="stringliteral">"Print only outside of the hub of the CD, or all the way to the hole"</span>),
00198     <a class="code" href="group__vars.html#gga132a7">STP_PARAMETER_TYPE_STRING_LIST</a>, <a class="code" href="group__vars.html#gga133a17">STP_PARAMETER_CLASS_FEATURE</a>,
00199     <a class="code" href="group__vars.html#gga134a21">STP_PARAMETER_LEVEL_BASIC</a>, 1, 1, -1, 1, 0
00200   },
00201   {
00202     <span class="stringliteral">"CDXAdjustment"</span>, <a class="code" href="group__intl__internal.html#ga6">N_</a>(<span class="stringliteral">"CD Horizontal Fine Adjustment"</span>), <a class="code" href="group__intl__internal.html#ga6">N_</a>(<span class="stringliteral">"Advanced Printer Setup"</span>),
00203     <a class="code" href="group__intl__internal.html#ga6">N_</a>(<span class="stringliteral">"Fine adjustment to horizontal position for CD printing"</span>),
00204     <a class="code" href="group__vars.html#gga132a15">STP_PARAMETER_TYPE_DIMENSION</a>, <a class="code" href="group__vars.html#gga133a17">STP_PARAMETER_CLASS_FEATURE</a>,
00205     <a class="code" href="group__vars.html#gga134a22">STP_PARAMETER_LEVEL_ADVANCED</a>, 1, 1, -1, 1, 0
00206   },
00207   {
00208     <span class="stringliteral">"CDYAdjustment"</span>, <a class="code" href="group__intl__internal.html#ga6">N_</a>(<span class="stringliteral">"CD Vertical Fine Adjustment"</span>), <a class="code" href="group__intl__internal.html#ga6">N_</a>(<span class="stringliteral">"Advanced Printer Setup"</span>),
00209     <a class="code" href="group__intl__internal.html#ga6">N_</a>(<span class="stringliteral">"Fine adjustment to horizontal position for CD printing"</span>),
00210     <a class="code" href="group__vars.html#gga132a15">STP_PARAMETER_TYPE_DIMENSION</a>, <a class="code" href="group__vars.html#gga133a17">STP_PARAMETER_CLASS_FEATURE</a>,
00211     <a class="code" href="group__vars.html#gga134a22">STP_PARAMETER_LEVEL_ADVANCED</a>, 1, 1, -1, 1, 0
00212   },
00213   {
00214     <span class="stringliteral">"Resolution"</span>, <a class="code" href="group__intl__internal.html#ga6">N_</a>(<span class="stringliteral">"Resolution"</span>), <a class="code" href="group__intl__internal.html#ga6">N_</a>(<span class="stringliteral">"Basic Printer Setup"</span>),
00215     <a class="code" href="group__intl__internal.html#ga6">N_</a>(<span class="stringliteral">"Resolution of the print"</span>),
00216     <a class="code" href="group__vars.html#gga132a7">STP_PARAMETER_TYPE_STRING_LIST</a>, <a class="code" href="group__vars.html#gga133a17">STP_PARAMETER_CLASS_FEATURE</a>,
00217     <a class="code" href="group__vars.html#gga134a22">STP_PARAMETER_LEVEL_ADVANCED</a>, 1, 1, -1, 1, 0
00218   },
00219   <span class="comment">/*</span>
00220 <span class="comment">   * Don't check this parameter.  We may offer different settings for</span>
00221 <span class="comment">   * different ink sets, but we need to be able to handle settings from PPD</span>
00222 <span class="comment">   * files that don't have constraints set up.</span>
00223 <span class="comment">   */</span>
00224   {
00225     <span class="stringliteral">"InkType"</span>, <a class="code" href="group__intl__internal.html#ga6">N_</a>(<span class="stringliteral">"Ink Type"</span>), <a class="code" href="group__intl__internal.html#ga6">N_</a>(<span class="stringliteral">"Advanced Printer Setup"</span>),
00226     <a class="code" href="group__intl__internal.html#ga6">N_</a>(<span class="stringliteral">"Type of ink in the printer"</span>),
00227     <a class="code" href="group__vars.html#gga132a7">STP_PARAMETER_TYPE_STRING_LIST</a>, <a class="code" href="group__vars.html#gga133a17">STP_PARAMETER_CLASS_FEATURE</a>,
00228     <a class="code" href="group__vars.html#gga134a24">STP_PARAMETER_LEVEL_ADVANCED2</a>, 1, 1, -1, 0, 0
00229   },
00230   {
00231     <span class="stringliteral">"InkSet"</span>, <a class="code" href="group__intl__internal.html#ga6">N_</a>(<span class="stringliteral">"Ink Set"</span>), <a class="code" href="group__intl__internal.html#ga6">N_</a>(<span class="stringliteral">"Advanced Printer Setup"</span>),
00232     <a class="code" href="group__intl__internal.html#ga6">N_</a>(<span class="stringliteral">"Type of ink in the printer"</span>),
00233     <a class="code" href="group__vars.html#gga132a7">STP_PARAMETER_TYPE_STRING_LIST</a>, <a class="code" href="group__vars.html#gga133a17">STP_PARAMETER_CLASS_FEATURE</a>,
00234     <a class="code" href="group__vars.html#gga134a21">STP_PARAMETER_LEVEL_BASIC</a>, 1, 1, -1, 1, 0
00235   },
00236   {
00237     <span class="stringliteral">"PrintingDirection"</span>, <a class="code" href="group__intl__internal.html#ga6">N_</a>(<span class="stringliteral">"Printing Direction"</span>), <a class="code" href="group__intl__internal.html#ga6">N_</a>(<span class="stringliteral">"Advanced Output Adjustment"</span>),
00238     <a class="code" href="group__intl__internal.html#ga6">N_</a>(<span class="stringliteral">"Printing direction (unidirectional is higher quality, but slower)"</span>),
00239     <a class="code" href="group__vars.html#gga132a7">STP_PARAMETER_TYPE_STRING_LIST</a>, <a class="code" href="group__vars.html#gga133a17">STP_PARAMETER_CLASS_FEATURE</a>,
00240     <a class="code" href="group__vars.html#gga134a23">STP_PARAMETER_LEVEL_ADVANCED1</a>, 1, 1, -1, 1, 0
00241   },
00242   {
00243     <span class="stringliteral">"FullBleed"</span>, <a class="code" href="group__intl__internal.html#ga6">N_</a>(<span class="stringliteral">"Borderless"</span>), <a class="code" href="group__intl__internal.html#ga6">N_</a>(<span class="stringliteral">"Basic Printer Setup"</span>),
00244     <a class="code" href="group__intl__internal.html#ga6">N_</a>(<span class="stringliteral">"Print without borders"</span>),
00245     <a class="code" href="group__vars.html#gga132a9">STP_PARAMETER_TYPE_BOOLEAN</a>, <a class="code" href="group__vars.html#gga133a17">STP_PARAMETER_CLASS_FEATURE</a>,
00246     <a class="code" href="group__vars.html#gga134a21">STP_PARAMETER_LEVEL_BASIC</a>, 1, 1, -1, 1, 0
00247   },
00248   {
00249     <span class="stringliteral">"Weave"</span>, <a class="code" href="group__intl__internal.html#ga6">N_</a>(<span class="stringliteral">"Interleave Method"</span>), <a class="code" href="group__intl__internal.html#ga6">N_</a>(<span class="stringliteral">"Advanced Output Adjustment"</span>),
00250     <a class="code" href="group__intl__internal.html#ga6">N_</a>(<span class="stringliteral">"Interleave pattern to use"</span>),
00251     <a class="code" href="group__vars.html#gga132a7">STP_PARAMETER_TYPE_STRING_LIST</a>, <a class="code" href="group__vars.html#gga133a17">STP_PARAMETER_CLASS_FEATURE</a>,
00252     <a class="code" href="group__vars.html#gga134a23">STP_PARAMETER_LEVEL_ADVANCED1</a>, 1, 1, -1, 1, 0
00253   },    
00254   {
00255     <span class="stringliteral">"AdjustDotsize"</span>, <a class="code" href="group__intl__internal.html#ga6">N_</a>(<span class="stringliteral">"Adjust dot size as necessary"</span>), <a class="code" href="group__intl__internal.html#ga6">N_</a>(<span class="stringliteral">"Advanced Printer Setup"</span>),
00256     <a class="code" href="group__intl__internal.html#ga6">N_</a>(<span class="stringliteral">"Adjust dot size as necessary to achieve desired density"</span>),
00257     <a class="code" href="group__vars.html#gga132a9">STP_PARAMETER_TYPE_BOOLEAN</a>, <a class="code" href="group__vars.html#gga133a17">STP_PARAMETER_CLASS_FEATURE</a>,
00258     <a class="code" href="group__vars.html#gga134a26">STP_PARAMETER_LEVEL_ADVANCED4</a>, 1, 1, -1, 1, 0
00259   },
00260   {
00261     <span class="stringliteral">"OutputOrder"</span>, <a class="code" href="group__intl__internal.html#ga6">N_</a>(<span class="stringliteral">"Output Order"</span>), <a class="code" href="group__intl__internal.html#ga6">N_</a>(<span class="stringliteral">"Basic Printer Setup"</span>),
00262     <a class="code" href="group__intl__internal.html#ga6">N_</a>(<span class="stringliteral">"Output Order"</span>),
00263     <a class="code" href="group__vars.html#gga132a7">STP_PARAMETER_TYPE_STRING_LIST</a>, <a class="code" href="group__vars.html#gga133a17">STP_PARAMETER_CLASS_FEATURE</a>,
00264     <a class="code" href="group__vars.html#gga134a21">STP_PARAMETER_LEVEL_BASIC</a>, 0, 0, -1, 0, 0
00265   },
00266   {
00267     <span class="stringliteral">"AlignmentPasses"</span>, <a class="code" href="group__intl__internal.html#ga6">N_</a>(<span class="stringliteral">"Alignment Passes"</span>), <a class="code" href="group__intl__internal.html#ga6">N_</a>(<span class="stringliteral">"Advanced Printer Functionality"</span>),
00268     <a class="code" href="group__intl__internal.html#ga6">N_</a>(<span class="stringliteral">"Alignment Passes"</span>),
00269     <a class="code" href="group__vars.html#gga132a8">STP_PARAMETER_TYPE_INT</a>, <a class="code" href="group__vars.html#gga133a17">STP_PARAMETER_CLASS_FEATURE</a>,
00270     <a class="code" href="group__vars.html#gga134a27">STP_PARAMETER_LEVEL_INTERNAL</a>, 0, 0, -1, 0, 0
00271   },
00272   {
00273     <span class="stringliteral">"AlignmentChoices"</span>, <a class="code" href="group__intl__internal.html#ga6">N_</a>(<span class="stringliteral">"Alignment Choices"</span>), <a class="code" href="group__intl__internal.html#ga6">N_</a>(<span class="stringliteral">"Advanced Printer Functionality"</span>),
00274     <a class="code" href="group__intl__internal.html#ga6">N_</a>(<span class="stringliteral">"Alignment Choices"</span>),
00275     <a class="code" href="group__vars.html#gga132a8">STP_PARAMETER_TYPE_INT</a>, <a class="code" href="group__vars.html#gga133a17">STP_PARAMETER_CLASS_FEATURE</a>,
00276     <a class="code" href="group__vars.html#gga134a27">STP_PARAMETER_LEVEL_INTERNAL</a>, 0, 0, -1, 0, 0
00277   },
00278   {
00279     <span class="stringliteral">"InkChange"</span>, <a class="code" href="group__intl__internal.html#ga6">N_</a>(<span class="stringliteral">"Ink change command"</span>), <a class="code" href="group__intl__internal.html#ga6">N_</a>(<span class="stringliteral">"Advanced Printer Functionality"</span>),
00280     <a class="code" href="group__intl__internal.html#ga6">N_</a>(<span class="stringliteral">"Ink change command"</span>),
00281     <a class="code" href="group__vars.html#gga132a8">STP_PARAMETER_TYPE_INT</a>, <a class="code" href="group__vars.html#gga133a17">STP_PARAMETER_CLASS_FEATURE</a>,
00282     <a class="code" href="group__vars.html#gga134a27">STP_PARAMETER_LEVEL_INTERNAL</a>, 0, 0, -1, 0, 0
00283   },
00284   {
00285     <span class="stringliteral">"AlternateAlignmentPasses"</span>, <a class="code" href="group__intl__internal.html#ga6">N_</a>(<span class="stringliteral">"Alternate Alignment Passes"</span>), <a class="code" href="group__intl__internal.html#ga6">N_</a>(<span class="stringliteral">"Advanced Printer Functionality"</span>),
00286     <a class="code" href="group__intl__internal.html#ga6">N_</a>(<span class="stringliteral">"Alternate Alignment Passes"</span>),
00287     <a class="code" href="group__vars.html#gga132a8">STP_PARAMETER_TYPE_INT</a>, <a class="code" href="group__vars.html#gga133a17">STP_PARAMETER_CLASS_FEATURE</a>,
00288     <a class="code" href="group__vars.html#gga134a27">STP_PARAMETER_LEVEL_INTERNAL</a>, 0, 0, -1, 0, 0
00289   },
00290   {
00291     <span class="stringliteral">"AlternateAlignmentChoices"</span>, <a class="code" href="group__intl__internal.html#ga6">N_</a>(<span class="stringliteral">"Alternate Alignment Choices"</span>), <a class="code" href="group__intl__internal.html#ga6">N_</a>(<span class="stringliteral">"Advanced Printer Functionality"</span>),
00292     <a class="code" href="group__intl__internal.html#ga6">N_</a>(<span class="stringliteral">"Alternate Alignment Choices"</span>),
00293     <a class="code" href="group__vars.html#gga132a8">STP_PARAMETER_TYPE_INT</a>, <a class="code" href="group__vars.html#gga133a17">STP_PARAMETER_CLASS_FEATURE</a>,
00294     <a class="code" href="group__vars.html#gga134a27">STP_PARAMETER_LEVEL_INTERNAL</a>, 0, 0, -1, 0, 0
00295   },
00296   {
00297     <span class="stringliteral">"SupportsPacketMode"</span>, <a class="code" href="group__intl__internal.html#ga6">N_</a>(<span class="stringliteral">"Supports Packet Mode"</span>), <a class="code" href="group__intl__internal.html#ga6">N_</a>(<span class="stringliteral">"Advanced Printer Functionality"</span>),
00298     <a class="code" href="group__intl__internal.html#ga6">N_</a>(<span class="stringliteral">"Alternate Alignment Choices"</span>),
00299     <a class="code" href="group__vars.html#gga132a9">STP_PARAMETER_TYPE_BOOLEAN</a>, <a class="code" href="group__vars.html#gga133a17">STP_PARAMETER_CLASS_FEATURE</a>,
00300     <a class="code" href="group__vars.html#gga134a27">STP_PARAMETER_LEVEL_INTERNAL</a>, 0, 0, -1, 0, 0
00301   },
00302   {
00303     <span class="stringliteral">"InkChannels"</span>, <a class="code" href="group__intl__internal.html#ga6">N_</a>(<span class="stringliteral">"Ink Channels"</span>), <a class="code" href="group__intl__internal.html#ga6">N_</a>(<span class="stringliteral">"Advanced Printer Functionality"</span>),
00304     <a class="code" href="group__intl__internal.html#ga6">N_</a>(<span class="stringliteral">"Ink Channels"</span>),
00305     <a class="code" href="group__vars.html#gga132a8">STP_PARAMETER_TYPE_INT</a>, <a class="code" href="group__vars.html#gga133a17">STP_PARAMETER_CLASS_FEATURE</a>,
00306     <a class="code" href="group__vars.html#gga134a27">STP_PARAMETER_LEVEL_INTERNAL</a>, 0, 0, -1, 0, 0
00307   },
00308   {
00309     <span class="stringliteral">"PrintingMode"</span>, <a class="code" href="group__intl__internal.html#ga6">N_</a>(<span class="stringliteral">"Printing Mode"</span>), <a class="code" href="group__intl__internal.html#ga6">N_</a>(<span class="stringliteral">"Core Parameter"</span>),
00310     <a class="code" href="group__intl__internal.html#ga6">N_</a>(<span class="stringliteral">"Printing Output Mode"</span>),
00311     <a class="code" href="group__vars.html#gga132a7">STP_PARAMETER_TYPE_STRING_LIST</a>, <a class="code" href="group__vars.html#gga133a19">STP_PARAMETER_CLASS_CORE</a>,
00312     <a class="code" href="group__vars.html#gga134a21">STP_PARAMETER_LEVEL_BASIC</a>, 1, 1, -1, 1, 0
00313   },
00314   {
00315     <span class="stringliteral">"RawChannels"</span>, <a class="code" href="group__intl__internal.html#ga6">N_</a>(<span class="stringliteral">"Raw Channels"</span>), <a class="code" href="group__intl__internal.html#ga6">N_</a>(<span class="stringliteral">"Core Parameter"</span>),
00316     <a class="code" href="group__intl__internal.html#ga6">N_</a>(<span class="stringliteral">"Raw Channel Count"</span>),
00317     <a class="code" href="group__vars.html#gga132a7">STP_PARAMETER_TYPE_STRING_LIST</a>, <a class="code" href="group__vars.html#gga133a19">STP_PARAMETER_CLASS_CORE</a>,
00318     <a class="code" href="group__vars.html#gga134a21">STP_PARAMETER_LEVEL_BASIC</a>, 0, 1, -1, 1, 0
00319   },
00320   <a class="code" href="print-escp2_8c.html#a5">PARAMETER_INT</a>(max_hres),
00321   <a class="code" href="print-escp2_8c.html#a5">PARAMETER_INT</a>(max_vres),
00322   <a class="code" href="print-escp2_8c.html#a5">PARAMETER_INT</a>(min_hres),
00323   <a class="code" href="print-escp2_8c.html#a5">PARAMETER_INT</a>(min_vres),
00324   <a class="code" href="print-escp2_8c.html#a5">PARAMETER_INT</a>(nozzles),
00325   <a class="code" href="print-escp2_8c.html#a5">PARAMETER_INT</a>(black_nozzles),
00326   <a class="code" href="print-escp2_8c.html#a5">PARAMETER_INT</a>(fast_nozzles),
00327   <a class="code" href="print-escp2_8c.html#a5">PARAMETER_INT</a>(min_nozzles),
00328   <a class="code" href="print-escp2_8c.html#a5">PARAMETER_INT</a>(min_black_nozzles),
00329   <a class="code" href="print-escp2_8c.html#a5">PARAMETER_INT</a>(min_fast_nozzles),
00330   <a class="code" href="print-escp2_8c.html#a5">PARAMETER_INT</a>(nozzle_separation),
00331   <a class="code" href="print-escp2_8c.html#a5">PARAMETER_INT</a>(black_nozzle_separation),
00332   <a class="code" href="print-escp2_8c.html#a5">PARAMETER_INT</a>(fast_nozzle_separation),
00333   <a class="code" href="print-escp2_8c.html#a5">PARAMETER_INT</a>(separation_rows),
00334   <a class="code" href="print-escp2_8c.html#a5">PARAMETER_INT</a>(max_paper_width),
00335   <a class="code" href="print-escp2_8c.html#a5">PARAMETER_INT</a>(max_paper_height),
00336   <a class="code" href="print-escp2_8c.html#a5">PARAMETER_INT</a>(min_paper_width),
00337   <a class="code" href="print-escp2_8c.html#a5">PARAMETER_INT</a>(min_paper_height),
00338   <a class="code" href="print-escp2_8c.html#a5">PARAMETER_INT</a>(extra_feed),
00339   <a class="code" href="print-escp2_8c.html#a5">PARAMETER_INT</a>(pseudo_separation_rows),
00340   <a class="code" href="print-escp2_8c.html#a5">PARAMETER_INT</a>(base_separation),
00341   <a class="code" href="print-escp2_8c.html#a5">PARAMETER_INT</a>(resolution_scale),
00342   <a class="code" href="print-escp2_8c.html#a5">PARAMETER_INT</a>(initial_vertical_offset),
00343   <a class="code" href="print-escp2_8c.html#a5">PARAMETER_INT</a>(black_initial_vertical_offset),
00344   <a class="code" href="print-escp2_8c.html#a5">PARAMETER_INT</a>(max_black_resolution),
00345   <a class="code" href="print-escp2_8c.html#a5">PARAMETER_INT</a>(zero_margin_offset),
00346   <a class="code" href="print-escp2_8c.html#a5">PARAMETER_INT</a>(extra_720dpi_separation),
00347   <a class="code" href="print-escp2_8c.html#a5">PARAMETER_INT</a>(physical_channels),
00348   <a class="code" href="print-escp2_8c.html#a5">PARAMETER_INT</a>(left_margin),
00349   <a class="code" href="print-escp2_8c.html#a5">PARAMETER_INT</a>(right_margin),
00350   <a class="code" href="print-escp2_8c.html#a5">PARAMETER_INT</a>(top_margin),
00351   <a class="code" href="print-escp2_8c.html#a5">PARAMETER_INT</a>(bottom_margin),
00352   <a class="code" href="print-escp2_8c.html#a6">PARAMETER_INT_RO</a>(alignment_passes),
00353   <a class="code" href="print-escp2_8c.html#a6">PARAMETER_INT_RO</a>(alignment_choices),
00354   <a class="code" href="print-escp2_8c.html#a6">PARAMETER_INT_RO</a>(alternate_alignment_passes),
00355   <a class="code" href="print-escp2_8c.html#a6">PARAMETER_INT_RO</a>(alternate_alignment_choices),
00356   <a class="code" href="print-escp2_8c.html#a5">PARAMETER_INT</a>(cd_x_offset),
00357   <a class="code" href="print-escp2_8c.html#a5">PARAMETER_INT</a>(cd_y_offset),
00358   <a class="code" href="print-escp2_8c.html#a5">PARAMETER_INT</a>(cd_page_width),
00359   <a class="code" href="print-escp2_8c.html#a5">PARAMETER_INT</a>(cd_page_height),
00360   <a class="code" href="print-escp2_8c.html#a7">PARAMETER_RAW</a>(preinit_sequence),
00361   <a class="code" href="print-escp2_8c.html#a7">PARAMETER_RAW</a>(postinit_remote_sequence)
00362 };
00363 
<a name="l00364"></a><a class="code" href="print-escp2_8c.html#a19">00364</a> <span class="keyword">static</span> <span class="keyword">const</span> <span class="keywordtype">int</span> <a class="code" href="print-escp2_8c.html#a19">the_parameter_count</a> =
00365 <span class="keyword">sizeof</span>(<a class="code" href="print-escp2_8c.html#a18">the_parameters</a>) / <span class="keyword">sizeof</span>(<span class="keyword">const</span> <a class="code" href="structstp__parameter__t.html">stp_parameter_t</a>);
00366 
<a name="l00367"></a><a class="code" href="print-escp2_8c.html#a20">00367</a> <span class="keyword">static</span> <span class="keyword">const</span> <a class="code" href="structfloat__param__t.html">float_param_t</a> <a class="code" href="print-escp2_8c.html#a20">float_parameters</a>[] =
00368 {
00369   {
00370     {
00371       <span class="stringliteral">"CyanDensity"</span>, <a class="code" href="group__intl__internal.html#ga6">N_</a>(<span class="stringliteral">"Cyan Balance"</span>), <a class="code" href="group__intl__internal.html#ga6">N_</a>(<span class="stringliteral">"Output Level Adjustment"</span>),
00372       <a class="code" href="group__intl__internal.html#ga6">N_</a>(<span class="stringliteral">"Adjust the cyan balance"</span>),
00373       <a class="code" href="group__vars.html#gga132a10">STP_PARAMETER_TYPE_DOUBLE</a>, <a class="code" href="group__vars.html#gga133a18">STP_PARAMETER_CLASS_OUTPUT</a>,
00374       <a class="code" href="group__vars.html#gga134a22">STP_PARAMETER_LEVEL_ADVANCED</a>, 0, 1, 1, 1, 0
00375     }, 0.0, 2.0, 1.0, 1
00376   },
00377   {
00378     {
00379       <span class="stringliteral">"MagentaDensity"</span>, <a class="code" href="group__intl__internal.html#ga6">N_</a>(<span class="stringliteral">"Magenta Balance"</span>), <a class="code" href="group__intl__internal.html#ga6">N_</a>(<span class="stringliteral">"Output Level Adjustment"</span>),
00380       <a class="code" href="group__intl__internal.html#ga6">N_</a>(<span class="stringliteral">"Adjust the magenta balance"</span>),
00381       <a class="code" href="group__vars.html#gga132a10">STP_PARAMETER_TYPE_DOUBLE</a>, <a class="code" href="group__vars.html#gga133a18">STP_PARAMETER_CLASS_OUTPUT</a>,
00382       <a class="code" href="group__vars.html#gga134a22">STP_PARAMETER_LEVEL_ADVANCED</a>, 0, 1, 2, 1, 0
00383     }, 0.0, 2.0, 1.0, 1
00384   },
00385   {
00386     {
00387       <span class="stringliteral">"YellowDensity"</span>, <a class="code" href="group__intl__internal.html#ga6">N_</a>(<span class="stringliteral">"Yellow Balance"</span>), <a class="code" href="group__intl__internal.html#ga6">N_</a>(<span class="stringliteral">"Output Level Adjustment"</span>),
00388       <a class="code" href="group__intl__internal.html#ga6">N_</a>(<span class="stringliteral">"Adjust the yellow balance"</span>),
00389       <a class="code" href="group__vars.html#gga132a10">STP_PARAMETER_TYPE_DOUBLE</a>, <a class="code" href="group__vars.html#gga133a18">STP_PARAMETER_CLASS_OUTPUT</a>,
00390       <a class="code" href="group__vars.html#gga134a22">STP_PARAMETER_LEVEL_ADVANCED</a>, 0, 1, 3, 1, 0
00391     }, 0.0, 2.0, 1.0, 1
00392   },
00393   {
00394     {
00395       <span class="stringliteral">"BlackDensity"</span>, <a class="code" href="group__intl__internal.html#ga6">N_</a>(<span class="stringliteral">"Black Balance"</span>), <a class="code" href="group__intl__internal.html#ga6">N_</a>(<span class="stringliteral">"Output Level Adjustment"</span>),
00396       <a class="code" href="group__intl__internal.html#ga6">N_</a>(<span class="stringliteral">"Adjust the black balance"</span>),
00397       <a class="code" href="group__vars.html#gga132a10">STP_PARAMETER_TYPE_DOUBLE</a>, <a class="code" href="group__vars.html#gga133a18">STP_PARAMETER_CLASS_OUTPUT</a>,
00398       <a class="code" href="group__vars.html#gga134a22">STP_PARAMETER_LEVEL_ADVANCED</a>, 0, 1, 0, 1, 0
00399     }, 0.0, 2.0, 1.0, 1
00400   },
00401   {
00402     {
00403       <span class="stringliteral">"RedDensity"</span>, <a class="code" href="group__intl__internal.html#ga6">N_</a>(<span class="stringliteral">"Red Balance"</span>), <a class="code" href="group__intl__internal.html#ga6">N_</a>(<span class="stringliteral">"Output Level Adjustment"</span>),
00404       <a class="code" href="group__intl__internal.html#ga6">N_</a>(<span class="stringliteral">"Adjust the red balance"</span>),
00405       <a class="code" href="group__vars.html#gga132a10">STP_PARAMETER_TYPE_DOUBLE</a>, <a class="code" href="group__vars.html#gga133a18">STP_PARAMETER_CLASS_OUTPUT</a>,
00406       <a class="code" href="group__vars.html#gga134a22">STP_PARAMETER_LEVEL_ADVANCED</a>, 0, 1, 4, 1, 0
00407     }, 0.0, 2.0, 1.0, 1
00408   },
00409   {
00410     {
00411       <span class="stringliteral">"BlueDensity"</span>, <a class="code" href="group__intl__internal.html#ga6">N_</a>(<span class="stringliteral">"Blue Balance"</span>), <a class="code" href="group__intl__internal.html#ga6">N_</a>(<span class="stringliteral">"Output Level Adjustment"</span>),
00412       <a class="code" href="group__intl__internal.html#ga6">N_</a>(<span class="stringliteral">"Adjust the blue balance"</span>),
00413       <a class="code" href="group__vars.html#gga132a10">STP_PARAMETER_TYPE_DOUBLE</a>, <a class="code" href="group__vars.html#gga133a18">STP_PARAMETER_CLASS_OUTPUT</a>,
00414       <a class="code" href="group__vars.html#gga134a22">STP_PARAMETER_LEVEL_ADVANCED</a>, 0, 1, 5, 1, 0
00415     }, 0.0, 2.0, 1.0, 1
00416   },
00417   {
00418     {
00419       <span class="stringliteral">"GlossDensity"</span>, <a class="code" href="group__intl__internal.html#ga6">N_</a>(<span class="stringliteral">"Gloss Balance"</span>), <a class="code" href="group__intl__internal.html#ga6">N_</a>(<span class="stringliteral">"Output Level Adjustment"</span>),
00420       <a class="code" href="group__intl__internal.html#ga6">N_</a>(<span class="stringliteral">"Adjust the gloss balance"</span>),
00421       <a class="code" href="group__vars.html#gga132a10">STP_PARAMETER_TYPE_DOUBLE</a>, <a class="code" href="group__vars.html#gga133a18">STP_PARAMETER_CLASS_OUTPUT</a>,
00422       <a class="code" href="group__vars.html#gga134a22">STP_PARAMETER_LEVEL_ADVANCED</a>, 0, 1, 6, 1, 0
00423     }, 0.0, 2.0, 1.0, 1
00424   },
00425   {
00426     {
00427       <span class="stringliteral">"LightCyanTransition"</span>, <a class="code" href="group__intl__internal.html#ga6">N_</a>(<span class="stringliteral">"Light Cyan Transition"</span>), <a class="code" href="group__intl__internal.html#ga6">N_</a>(<span class="stringliteral">"Advanced Ink Adjustment"</span>),
00428       <a class="code" href="group__intl__internal.html#ga6">N_</a>(<span class="stringliteral">"Light Cyan Transition"</span>),
00429       <a class="code" href="group__vars.html#gga132a10">STP_PARAMETER_TYPE_DOUBLE</a>, <a class="code" href="group__vars.html#gga133a18">STP_PARAMETER_CLASS_OUTPUT</a>,
00430       <a class="code" href="group__vars.html#gga134a26">STP_PARAMETER_LEVEL_ADVANCED4</a>, 0, 1, -1, 1, 0
00431     }, 0.0, 5.0, 1.0, 1
00432   },
00433   {
00434     {
00435       <span class="stringliteral">"LightMagentaTransition"</span>, <a class="code" href="group__intl__internal.html#ga6">N_</a>(<span class="stringliteral">"Light Magenta Transition"</span>), <a class="code" href="group__intl__internal.html#ga6">N_</a>(<span class="stringliteral">"Advanced Ink Adjustment"</span>),
00436       <a class="code" href="group__intl__internal.html#ga6">N_</a>(<span class="stringliteral">"Light Magenta Transition"</span>),
00437       <a class="code" href="group__vars.html#gga132a10">STP_PARAMETER_TYPE_DOUBLE</a>, <a class="code" href="group__vars.html#gga133a18">STP_PARAMETER_CLASS_OUTPUT</a>,
00438       <a class="code" href="group__vars.html#gga134a26">STP_PARAMETER_LEVEL_ADVANCED4</a>, 0, 1, -1, 1, 0
00439     }, 0.0, 5.0, 1.0, 1
00440   },
00441   {
00442     {
00443       <span class="stringliteral">"DarkYellowTransition"</span>, <a class="code" href="group__intl__internal.html#ga6">N_</a>(<span class="stringliteral">"Dark Yellow Transition"</span>), <a class="code" href="group__intl__internal.html#ga6">N_</a>(<span class="stringliteral">"Advanced Ink Adjustment"</span>),
00444       <a class="code" href="group__intl__internal.html#ga6">N_</a>(<span class="stringliteral">"Dark Yellow Transition"</span>),
00445       <a class="code" href="group__vars.html#gga132a10">STP_PARAMETER_TYPE_DOUBLE</a>, <a class="code" href="group__vars.html#gga133a18">STP_PARAMETER_CLASS_OUTPUT</a>,
00446       <a class="code" href="group__vars.html#gga134a26">STP_PARAMETER_LEVEL_ADVANCED4</a>, 0, 1, -1, 1, 0
00447     }, 0.0, 5.0, 1.0, 1
00448   },
00449   {
00450     {
00451       <span class="stringliteral">"GrayTransition"</span>, <a class="code" href="group__intl__internal.html#ga6">N_</a>(<span class="stringliteral">"Gray Transition"</span>), <a class="code" href="group__intl__internal.html#ga6">N_</a>(<span class="stringliteral">"Advanced Ink Adjustment"</span>),
00452       <a class="code" href="group__intl__internal.html#ga6">N_</a>(<span class="stringliteral">"Gray Transition"</span>),
00453       <a class="code" href="group__vars.html#gga132a10">STP_PARAMETER_TYPE_DOUBLE</a>, <a class="code" href="group__vars.html#gga133a18">STP_PARAMETER_CLASS_OUTPUT</a>,
00454       <a class="code" href="group__vars.html#gga134a26">STP_PARAMETER_LEVEL_ADVANCED4</a>, 0, 1, -1, 1, 0
00455     }, 0.0, 5.0, 1.0, 1
00456   },
00457   {
00458     {
00459       <span class="stringliteral">"Gray3Transition"</span>, <a class="code" href="group__intl__internal.html#ga6">N_</a>(<span class="stringliteral">"Dark Gray Transition"</span>), <a class="code" href="group__intl__internal.html#ga6">N_</a>(<span class="stringliteral">"Advanced Ink Adjustment"</span>),
00460       <a class="code" href="group__intl__internal.html#ga6">N_</a>(<span class="stringliteral">"Dark Gray Transition"</span>),
00461       <a class="code" href="group__vars.html#gga132a10">STP_PARAMETER_TYPE_DOUBLE</a>, <a class="code" href="group__vars.html#gga133a18">STP_PARAMETER_CLASS_OUTPUT</a>,
00462       <a class="code" href="group__vars.html#gga134a26">STP_PARAMETER_LEVEL_ADVANCED4</a>, 0, 1, -1, 1, 0
00463     }, 0.0, 5.0, 1.0, 1
00464   },
00465   {
00466     {
00467       <span class="stringliteral">"Gray2Transition"</span>, <a class="code" href="group__intl__internal.html#ga6">N_</a>(<span class="stringliteral">"Mid Gray Transition"</span>), <a class="code" href="group__intl__internal.html#ga6">N_</a>(<span class="stringliteral">"Advanced Ink Adjustment"</span>),
00468       <a class="code" href="group__intl__internal.html#ga6">N_</a>(<span class="stringliteral">"Medium Gray Transition"</span>),
00469       <a class="code" href="group__vars.html#gga132a10">STP_PARAMETER_TYPE_DOUBLE</a>, <a class="code" href="group__vars.html#gga133a18">STP_PARAMETER_CLASS_OUTPUT</a>,
00470       <a class="code" href="group__vars.html#gga134a26">STP_PARAMETER_LEVEL_ADVANCED4</a>, 0, 1, -1, 1, 0
00471     }, 0.0, 5.0, 1.0, 1
00472   },
00473   {
00474     {
00475       <span class="stringliteral">"Gray1Transition"</span>, <a class="code" href="group__intl__internal.html#ga6">N_</a>(<span class="stringliteral">"Light Gray Transition"</span>), <a class="code" href="group__intl__internal.html#ga6">N_</a>(<span class="stringliteral">"Advanced Ink Adjustment"</span>),
00476       <a class="code" href="group__intl__internal.html#ga6">N_</a>(<span class="stringliteral">"Light Gray Transition"</span>),
00477       <a class="code" href="group__vars.html#gga132a10">STP_PARAMETER_TYPE_DOUBLE</a>, <a class="code" href="group__vars.html#gga133a18">STP_PARAMETER_CLASS_OUTPUT</a>,
00478       <a class="code" href="group__vars.html#gga134a26">STP_PARAMETER_LEVEL_ADVANCED4</a>, 0, 1, -1, 1, 0
00479     }, 0.0, 5.0, 1.0, 1
00480   },
00481 };
00482 
<a name="l00483"></a><a class="code" href="print-escp2_8c.html#a21">00483</a> <span class="keyword">static</span> <span class="keyword">const</span> <span class="keywordtype">int</span> <a class="code" href="print-escp2_8c.html#a21">float_parameter_count</a> =
00484 <span class="keyword">sizeof</span>(<a class="code" href="print-escp2_8c.html#a20">float_parameters</a>) / <span class="keyword">sizeof</span>(<span class="keyword">const</span> <a class="code" href="structfloat__param__t.html">float_param_t</a>);
00485 
00486 
00487 <span class="keyword">static</span> <a class="code" href="structescp2__privdata__t.html">escp2_privdata_t</a> *
<a name="l00488"></a><a class="code" href="print-escp2_8c.html#a27">00488</a> <a class="code" href="print-escp2_8c.html#a27">get_privdata</a>(<a class="code" href="structstp__vars.html">stp_vars_t</a> *v)
00489 {
00490   <span class="keywordflow">return</span> (<a class="code" href="structescp2__privdata__t.html">escp2_privdata_t</a> *) <a class="code" href="group__vars.html#ga20">stp_get_component_data</a>(v, <span class="stringliteral">"Driver"</span>);
00491 }
00492 
00493 <span class="keyword">static</span> <a class="code" href="print-escp2_8h.html#a57">model_featureset_t</a>
<a name="l00494"></a><a class="code" href="print-escp2_8c.html#a28">00494</a> <a class="code" href="print-escp2_8c.html#a28">escp2_get_cap</a>(<span class="keyword">const</span> <a class="code" href="structstp__vars.html">stp_vars_t</a> *v, escp2_model_option_t feature)
00495 {
00496   <span class="keywordtype">int</span> model = <a class="code" href="group__printer.html#ga23">stp_get_model_id</a>(v);
00497   <span class="keywordflow">if</span> (feature &lt; 0 || feature &gt;= <a class="code" href="print-escp2_8h.html#a158a150">MODEL_LIMIT</a>)
00498     <span class="keywordflow">return</span> (<a class="code" href="print-escp2_8h.html#a57">model_featureset_t</a>) -1;
00499   <span class="keywordflow">else</span>
00500     {
00501       <a class="code" href="print-escp2_8h.html#a57">model_featureset_t</a> featureset =
00502         (((1ul &lt;&lt; <a class="code" href="print-escp2_8c.html#a14">escp2_printer_attrs</a>[feature].<a class="code" href="structescp2__printer__attr__t.html#o2">bit_width</a>) - 1ul) &lt;&lt;
00503          <a class="code" href="print-escp2_8c.html#a14">escp2_printer_attrs</a>[feature].<a class="code" href="structescp2__printer__attr__t.html#o1">bit_shift</a>);
00504       <span class="keywordflow">return</span> <a class="code" href="print-escp2-data_8c.html#a80">stpi_escp2_model_capabilities</a>[model].<a class="code" href="structescp2__printer.html#o0">flags</a> &amp; featureset;
00505     }
00506 }
00507 
00508 <span class="keyword">static</span> <span class="keywordtype">int</span>
<a name="l00509"></a><a class="code" href="print-escp2_8c.html#a29">00509</a> <a class="code" href="print-escp2_8c.html#a29">escp2_has_cap</a>(<span class="keyword">const</span> <a class="code" href="structstp__vars.html">stp_vars_t</a> *v, escp2_model_option_t feature,
00510               <a class="code" href="print-escp2_8h.html#a57">model_featureset_t</a> <span class="keyword">class</span>)
00511 {
00512   <span class="keywordtype">int</span> model = <a class="code" href="group__printer.html#ga23">stp_get_model_id</a>(v);
00513   <span class="keywordflow">if</span> (feature &lt; 0 || feature &gt;= <a class="code" href="print-escp2_8h.html#a158a150">MODEL_LIMIT</a>)
00514     <span class="keywordflow">return</span> -1;
00515   <span class="keywordflow">else</span>
00516     {
00517       <a class="code" href="print-escp2_8h.html#a57">model_featureset_t</a> featureset =
00518         (((1ul &lt;&lt; <a class="code" href="print-escp2_8c.html#a14">escp2_printer_attrs</a>[feature].<a class="code" href="structescp2__printer__attr__t.html#o2">bit_width</a>) - 1ul) &lt;&lt;
00519          <a class="code" href="print-escp2_8c.html#a14">escp2_printer_attrs</a>[feature].<a class="code" href="structescp2__printer__attr__t.html#o1">bit_shift</a>);
00520       <span class="keywordflow">if</span> ((<a class="code" href="print-escp2-data_8c.html#a80">stpi_escp2_model_capabilities</a>[model].<a class="code" href="structescp2__printer.html#o0">flags</a> &amp; featureset) == <span class="keyword">class</span>)
00521         <span class="keywordflow">return</span> 1;
00522       <span class="keywordflow">else</span>
00523         <span class="keywordflow">return</span> 0;
00524     }
00525 }
00526 
<a name="l00527"></a><a class="code" href="print-escp2_8c.html#a8">00527</a> <span class="preprocessor">#define DEF_SIMPLE_ACCESSOR(f, t)                                       \</span>
00528 <span class="preprocessor">static inline t                                                         \</span>
00529 <span class="preprocessor">escp2_##f(const stp_vars_t *v)                                          \</span>
00530 <span class="preprocessor">{                                                                       \</span>
00531 <span class="preprocessor">  if (stp_check_int_parameter(v, "escp2_" #f, STP_PARAMETER_ACTIVE))    \</span>
00532 <span class="preprocessor">    return stp_get_int_parameter(v, "escp2_" #f);                       \</span>
00533 <span class="preprocessor">  else                                                                  \</span>
00534 <span class="preprocessor">    {                                                                   \</span>
00535 <span class="preprocessor">      int model = stp_get_model_id(v);                                  \</span>
00536 <span class="preprocessor">      return (stpi_escp2_model_capabilities[model].f);                  \</span>
00537 <span class="preprocessor">    }                                                                   \</span>
00538 <span class="preprocessor">}</span>
00539 <span class="preprocessor"></span>
<a name="l00540"></a><a class="code" href="print-escp2_8c.html#a9">00540</a> <span class="preprocessor">#define DEF_RAW_ACCESSOR(f, t)                                          \</span>
00541 <span class="preprocessor">static inline t                                                         \</span>
00542 <span class="preprocessor">escp2_##f(const stp_vars_t *v)                                          \</span>
00543 <span class="preprocessor">{                                                                       \</span>
00544 <span class="preprocessor">  if (stp_check_raw_parameter(v, "escp2_" #f, STP_PARAMETER_ACTIVE))    \</span>
00545 <span class="preprocessor">    return stp_get_raw_parameter(v, "escp2_" #f);                       \</span>
00546 <span class="preprocessor">  else                                                                  \</span>
00547 <span class="preprocessor">    {                                                                   \</span>
00548 <span class="preprocessor">      int model = stp_get_model_id(v);                                  \</span>
00549 <span class="preprocessor">      return (stpi_escp2_model_capabilities[model].f);                  \</span>
00550 <span class="preprocessor">    }                                                                   \</span>
00551 <span class="preprocessor">}</span>
00552 <span class="preprocessor"></span>
<a name="l00553"></a><a class="code" href="print-escp2_8c.html#a10">00553</a> <span class="preprocessor">#define DEF_COMPOSITE_ACCESSOR(f, t)                    \</span>
00554 <span class="preprocessor">static inline t                                         \</span>
00555 <span class="preprocessor">escp2_##f(const stp_vars_t *v)                          \</span>
00556 <span class="preprocessor">{                                                       \</span>
00557 <span class="preprocessor">  int model = stp_get_model_id(v);                      \</span>
00558 <span class="preprocessor">  return (stpi_escp2_model_capabilities[model].f);      \</span>
00559 <span class="preprocessor">}</span>
00560 <span class="preprocessor"></span>
<a name="l00561"></a><a class="code" href="print-escp2_8c.html#a11">00561</a> <span class="preprocessor">#define DEF_ROLL_ACCESSOR(f, t)                                         \</span>
00562 <span class="preprocessor">static inline t                                                         \</span>
00563 <span class="preprocessor">escp2_##f(const stp_vars_t *v, int rollfeed)                            \</span>
00564 <span class="preprocessor">{                                                                       \</span>
00565 <span class="preprocessor">  if (stp_check_int_parameter(v, "escp2_" #f, STP_PARAMETER_ACTIVE))    \</span>
00566 <span class="preprocessor">    return stp_get_int_parameter(v, "escp2_" #f);                       \</span>
00567 <span class="preprocessor">  else                                                                  \</span>
00568 <span class="preprocessor">    {                                                                   \</span>
00569 <span class="preprocessor">      int model = stp_get_model_id(v);                                  \</span>
00570 <span class="preprocessor">      const res_t *res = escp2_find_resolution(v);                      \</span>
00571 <span class="preprocessor">      if (res &amp;&amp; !(res-&gt;softweave))                                     \</span>
00572 <span class="preprocessor">        {                                                               \</span>
00573 <span class="preprocessor">          if (rollfeed)                                                 \</span>
00574 <span class="preprocessor">            return (stpi_escp2_model_capabilities[model].m_roll_##f);   \</span>
00575 <span class="preprocessor">          else                                                          \</span>
00576 <span class="preprocessor">            return (stpi_escp2_model_capabilities[model].m_##f);        \</span>
00577 <span class="preprocessor">        }                                                               \</span>
00578 <span class="preprocessor">      else                                                              \</span>
00579 <span class="preprocessor">        {                                                               \</span>
00580 <span class="preprocessor">          if (rollfeed)                                                 \</span>
00581 <span class="preprocessor">            return (stpi_escp2_model_capabilities[model].roll_##f);     \</span>
00582 <span class="preprocessor">          else                                                          \</span>
00583 <span class="preprocessor">            return (stpi_escp2_model_capabilities[model].f);            \</span>
00584 <span class="preprocessor">        }                                                               \</span>
00585 <span class="preprocessor">    }                                                                   \</span>
00586 <span class="preprocessor">}</span>
00587 <span class="preprocessor"></span>
00588 <a class="code" href="print-escp2_8c.html#a8">DEF_SIMPLE_ACCESSOR</a>(max_hres, <span class="keywordtype">int</span>)
00589 <a class="code" href="print-escp2_8c.html#a8">DEF_SIMPLE_ACCESSOR</a>(max_vres, <span class="keywordtype">int</span>)
00590 <a class="code" href="print-escp2_8c.html#a8">DEF_SIMPLE_ACCESSOR</a>(min_hres, <span class="keywordtype">int</span>)
00591 <a class="code" href="print-escp2_8c.html#a8">DEF_SIMPLE_ACCESSOR</a>(min_vres, <span class="keywordtype">int</span>)
00592 <a class="code" href="print-escp2_8c.html#a8">DEF_SIMPLE_ACCESSOR</a>(nozzles, <span class="keywordtype">unsigned</span>)
00593 <a class="code" href="print-escp2_8c.html#a8">DEF_SIMPLE_ACCESSOR</a>(black_nozzles, <span class="keywordtype">unsigned</span>)
00594 <a class="code" href="print-escp2_8c.html#a8">DEF_SIMPLE_ACCESSOR</a>(fast_nozzles, <span class="keywordtype">unsigned</span>)
00595 <a class="code" href="print-escp2_8c.html#a8">DEF_SIMPLE_ACCESSOR</a>(min_nozzles, <span class="keywordtype">unsigned</span>)
00596 <a class="code" href="print-escp2_8c.html#a8">DEF_SIMPLE_ACCESSOR</a>(min_black_nozzles, <span class="keywordtype">unsigned</span>)
00597 <a class="code" href="print-escp2_8c.html#a8">DEF_SIMPLE_ACCESSOR</a>(min_fast_nozzles, <span class="keywordtype">unsigned</span>)
00598 <a class="code" href="print-escp2_8c.html#a8">DEF_SIMPLE_ACCESSOR</a>(nozzle_separation, <span class="keywordtype">unsigned</span>)
00599 <a class="code" href="print-escp2_8c.html#a8">DEF_SIMPLE_ACCESSOR</a>(black_nozzle_separation, <span class="keywordtype">unsigned</span>)
00600 <a class="code" href="print-escp2_8c.html#a8">DEF_SIMPLE_ACCESSOR</a>(fast_nozzle_separation, <span class="keywordtype">unsigned</span>)
00601 <a class="code" href="print-escp2_8c.html#a8">DEF_SIMPLE_ACCESSOR</a>(separation_rows, <span class="keywordtype">unsigned</span>)
00602 <a class="code" href="print-escp2_8c.html#a8">DEF_SIMPLE_ACCESSOR</a>(max_paper_width, <span class="keywordtype">unsigned</span>)
00603 <a class="code" href="print-escp2_8c.html#a8">DEF_SIMPLE_ACCESSOR</a>(max_paper_height, <span class="keywordtype">unsigned</span>)
00604 <a class="code" href="print-escp2_8c.html#a8">DEF_SIMPLE_ACCESSOR</a>(min_paper_width, <span class="keywordtype">unsigned</span>)
00605 <a class="code" href="print-escp2_8c.html#a8">DEF_SIMPLE_ACCESSOR</a>(min_paper_height, <span class="keywordtype">unsigned</span>)
00606 <a class="code" href="print-escp2_8c.html#a8">DEF_SIMPLE_ACCESSOR</a>(cd_x_offset, <span class="keywordtype">int</span>)
00607 <a class="code" href="print-escp2_8c.html#a8">DEF_SIMPLE_ACCESSOR</a>(cd_y_offset, <span class="keywordtype">int</span>)
00608 <a class="code" href="print-escp2_8c.html#a8">DEF_SIMPLE_ACCESSOR</a>(cd_page_width, <span class="keywordtype">int</span>)
00609 <a class="code" href="print-escp2_8c.html#a8">DEF_SIMPLE_ACCESSOR</a>(cd_page_height, <span class="keywordtype">int</span>)
00610 <a class="code" href="print-escp2_8c.html#a8">DEF_SIMPLE_ACCESSOR</a>(extra_feed, <span class="keywordtype">unsigned</span>)
00611 <a class="code" href="print-escp2_8c.html#a8">DEF_SIMPLE_ACCESSOR</a>(pseudo_separation_rows, <span class="keywordtype">int</span>)
00612 <a class="code" href="print-escp2_8c.html#a8">DEF_SIMPLE_ACCESSOR</a>(base_separation, <span class="keywordtype">int</span>)
00613 <a class="code" href="print-escp2_8c.html#a8">DEF_SIMPLE_ACCESSOR</a>(resolution_scale, <span class="keywordtype">int</span>)
00614 <a class="code" href="print-escp2_8c.html#a8">DEF_SIMPLE_ACCESSOR</a>(initial_vertical_offset, <span class="keywordtype">int</span>)
00615 <a class="code" href="print-escp2_8c.html#a8">DEF_SIMPLE_ACCESSOR</a>(black_initial_vertical_offset, <span class="keywordtype">int</span>)
00616 <a class="code" href="print-escp2_8c.html#a8">DEF_SIMPLE_ACCESSOR</a>(max_black_resolution, <span class="keywordtype">int</span>)
00617 <a class="code" href="print-escp2_8c.html#a8">DEF_SIMPLE_ACCESSOR</a>(zero_margin_offset, <span class="keywordtype">int</span>)
00618 <a class="code" href="print-escp2_8c.html#a8">DEF_SIMPLE_ACCESSOR</a>(extra_720dpi_separation, <span class="keywordtype">int</span>)
00619 <a class="code" href="print-escp2_8c.html#a8">DEF_SIMPLE_ACCESSOR</a>(physical_channels, <span class="keywordtype">int</span>)
00620 <a class="code" href="print-escp2_8c.html#a8">DEF_SIMPLE_ACCESSOR</a>(alignment_passes, <span class="keywordtype">int</span>)
00621 <a class="code" href="print-escp2_8c.html#a8">DEF_SIMPLE_ACCESSOR</a>(alignment_choices, <span class="keywordtype">int</span>)
00622 <a class="code" href="print-escp2_8c.html#a8">DEF_SIMPLE_ACCESSOR</a>(alternate_alignment_passes, <span class="keywordtype">int</span>)
00623 <a class="code" href="print-escp2_8c.html#a8">DEF_SIMPLE_ACCESSOR</a>(alternate_alignment_choices, <span class="keywordtype">int</span>)
00624 <a class="code" href="print-escp2_8c.html#a10">DEF_COMPOSITE_ACCESSOR</a>(printer_weaves, <span class="keyword">const</span> <a class="code" href="structprinter__weave__list__t.html">printer_weave_list_t</a> *)
00625 
00626 <a class="code" href="print-escp2_8c.html#a11">DEF_ROLL_ACCESSOR</a>(left_margin, <span class="keywordtype">unsigned</span>)
00627 <a class="code" href="print-escp2_8c.html#a11">DEF_ROLL_ACCESSOR</a>(right_margin, <span class="keywordtype">unsigned</span>)
00628 <a class="code" href="print-escp2_8c.html#a11">DEF_ROLL_ACCESSOR</a>(top_margin, <span class="keywordtype">unsigned</span>)
00629 <a class="code" href="print-escp2_8c.html#a11">DEF_ROLL_ACCESSOR</a>(bottom_margin, <span class="keywordtype">unsigned</span>)
00630 
00631 <a class="code" href="print-escp2_8c.html#a9">DEF_RAW_ACCESSOR</a>(preinit_sequence, <span class="keyword">const</span> <a class="code" href="structstp__raw__t.html">stp_raw_t</a> *)
00632 <a class="code" href="print-escp2_8c.html#a9">DEF_RAW_ACCESSOR</a>(postinit_remote_sequence, <span class="keyword">const</span> <a class="code" href="structstp__raw__t.html">stp_raw_t</a> *)
00633 
00634 <a class="code" href="print-escp2_8c.html#a10">DEF_COMPOSITE_ACCESSOR</a>(reslist, <span class="keyword">const</span> <a class="code" href="structres__t.html">res_t</a> *<span class="keyword">const</span> *)
00635 <a class="code" href="print-escp2_8c.html#a10">DEF_COMPOSITE_ACCESSOR</a>(inkgroup, <span class="keyword">const</span> <a class="code" href="structinkgroup__t.html">inkgroup_t</a> *)
00636 <a class="code" href="print-escp2_8c.html#a10">DEF_COMPOSITE_ACCESSOR</a>(input_slots, <span class="keyword">const</span> <a class="code" href="structinput__slot__list__t.html">input_slot_list_t</a> *)
00637 <a class="code" href="print-escp2_8c.html#a10">DEF_COMPOSITE_ACCESSOR</a>(quality_list, <span class="keyword">const</span> <a class="code" href="structquality__list__t.html">quality_list_t</a> *)
00638 
00639 <span class="keyword">static</span> <span class="keyword">const</span> <a class="code" href="structchannel__count__t.html">channel_count_t</a> *
<a name="l00640"></a><a class="code" href="print-escp2_8c.html#a30">00640</a> <a class="code" href="print-escp2_8c.html#a30">get_channel_count_by_name</a>(<span class="keyword">const</span> <span class="keywordtype">char</span> *name)
00641 {
00642   <span class="keywordtype">int</span> i;
00643   <span class="keywordflow">for</span> (i = 0; i &lt; <a class="code" href="print-escp2_8c.html#a16">escp2_channel_counts_count</a>; i++)
00644     <span class="keywordflow">if</span> (strcmp(name, <a class="code" href="print-escp2_8c.html#a15">escp2_channel_counts</a>[i].name) == 0)
00645       <span class="keywordflow">return</span> &amp;(<a class="code" href="print-escp2_8c.html#a15">escp2_channel_counts</a>[i]);
00646   <span class="keywordflow">return</span> NULL;
00647 }
00648 
00649 <span class="keyword">static</span> <span class="keyword">const</span> <a class="code" href="structchannel__count__t.html">channel_count_t</a> *
<a name="l00650"></a><a class="code" href="print-escp2_8c.html#a31">00650</a> <a class="code" href="print-escp2_8c.html#a31">get_channel_count_by_number</a>(<span class="keywordtype">unsigned</span> count)
00651 {
00652   <span class="keywordtype">int</span> i;
00653   <span class="keywordflow">for</span> (i = 0; i &lt; <a class="code" href="print-escp2_8c.html#a16">escp2_channel_counts_count</a>; i++)
00654     <span class="keywordflow">if</span> (count == <a class="code" href="print-escp2_8c.html#a15">escp2_channel_counts</a>[i].<a class="code" href="structchannel__count__t.html#o0">count</a>)
00655       <span class="keywordflow">return</span> &amp;(<a class="code" href="print-escp2_8c.html#a15">escp2_channel_counts</a>[i]);
00656   <span class="keywordflow">return</span> NULL;
00657 }
00658 
00659 <span class="keyword">static</span> <span class="keywordtype">int</span>
<a name="l00660"></a><a class="code" href="print-escp2_8c.html#a32">00660</a> <a class="code" href="print-escp2_8c.html#a32">escp2_ink_type</a>(<span class="keyword">const</span> <a class="code" href="structstp__vars.html">stp_vars_t</a> *v, <span class="keywordtype">int</span> resid)
00661 {
00662   <span class="keywordflow">if</span> (<a class="code" href="group__vars.html#ga103">stp_check_int_parameter</a>(v, <span class="stringliteral">"escp2_ink_type"</span>, <a class="code" href="group__vars.html#gga135a32">STP_PARAMETER_ACTIVE</a>))
00663     <span class="keywordflow">return</span> <a class="code" href="group__vars.html#ga58">stp_get_int_parameter</a>(v, <span class="stringliteral">"escp2_ink_type"</span>);
00664   <span class="keywordflow">else</span>
00665     {
00666       <span class="keywordtype">int</span> model = <a class="code" href="group__printer.html#ga23">stp_get_model_id</a>(v);
00667       <span class="keywordflow">return</span> <a class="code" href="print-escp2-data_8c.html#a80">stpi_escp2_model_capabilities</a>[model].<a class="code" href="structescp2__printer.html#o53">dot_sizes</a>[resid];
00668     }
00669 }
00670 
00671 <span class="keyword">static</span> <span class="keywordtype">double</span>
<a name="l00672"></a><a class="code" href="print-escp2_8c.html#a33">00672</a> <a class="code" href="print-escp2_8c.html#a33">escp2_density</a>(<span class="keyword">const</span> <a class="code" href="structstp__vars.html">stp_vars_t</a> *v, <span class="keywordtype">int</span> resid)
00673 {
00674   <span class="keywordflow">if</span> (<a class="code" href="group__vars.html#ga102">stp_check_float_parameter</a>(v, <span class="stringliteral">"escp2_density"</span>, <a class="code" href="group__vars.html#gga135a32">STP_PARAMETER_ACTIVE</a>))
00675     <span class="keywordflow">return</span> <a class="code" href="group__vars.html#ga70">stp_get_float_parameter</a>(v, <span class="stringliteral">"escp2_density"</span>);
00676   <span class="keywordflow">else</span>
00677     {
00678       <span class="keywordtype">int</span> model = <a class="code" href="group__printer.html#ga23">stp_get_model_id</a>(v);
00679       <span class="keywordflow">return</span> <a class="code" href="print-escp2-data_8c.html#a80">stpi_escp2_model_capabilities</a>[model].<a class="code" href="structescp2__printer.html#o54">densities</a>[resid];
00680     }
00681 }
00682 
00683 <span class="keyword">static</span> <span class="keywordtype">int</span>
<a name="l00684"></a><a class="code" href="print-escp2_8c.html#a34">00684</a> <a class="code" href="print-escp2_8c.html#a34">escp2_bits</a>(<span class="keyword">const</span> <a class="code" href="structstp__vars.html">stp_vars_t</a> *v, <span class="keywordtype">int</span> resid)
00685 {
00686   <span class="keywordflow">if</span> (<a class="code" href="group__vars.html#ga103">stp_check_int_parameter</a>(v, <span class="stringliteral">"escp2_bits"</span>, <a class="code" href="group__vars.html#gga135a32">STP_PARAMETER_ACTIVE</a>))
00687     <span class="keywordflow">return</span> <a class="code" href="group__vars.html#ga58">stp_get_int_parameter</a>(v, <span class="stringliteral">"escp2_bits"</span>);
00688   <span class="keywordflow">else</span>
00689     {
00690       <span class="keywordtype">int</span> model = <a class="code" href="group__printer.html#ga23">stp_get_model_id</a>(v);
00691       <span class="keywordflow">return</span> <a class="code" href="print-escp2-data_8c.html#a80">stpi_escp2_model_capabilities</a>[model].<a class="code" href="structescp2__printer.html#o58">bits</a>[resid];
00692     }
00693 }
00694 
00695 <span class="keyword">static</span> <span class="keywordtype">double</span>
<a name="l00696"></a><a class="code" href="print-escp2_8c.html#a35">00696</a> <a class="code" href="print-escp2_8c.html#a35">escp2_base_res</a>(<span class="keyword">const</span> <a class="code" href="structstp__vars.html">stp_vars_t</a> *v, <span class="keywordtype">int</span> resid)
00697 {
00698   <span class="keywordflow">if</span> (<a class="code" href="group__vars.html#ga102">stp_check_float_parameter</a>(v, <span class="stringliteral">"escp2_base_res"</span>, <a class="code" href="group__vars.html#gga135a32">STP_PARAMETER_ACTIVE</a>))
00699     <span class="keywordflow">return</span> <a class="code" href="group__vars.html#ga70">stp_get_float_parameter</a>(v, <span class="stringliteral">"escp2_base_res"</span>);
00700   <span class="keywordflow">else</span>
00701     {
00702       <span class="keywordtype">int</span> model = <a class="code" href="group__printer.html#ga23">stp_get_model_id</a>(v);
00703       <span class="keywordflow">return</span> <a class="code" href="print-escp2-data_8c.html#a80">stpi_escp2_model_capabilities</a>[model].<a class="code" href="structescp2__printer.html#o59">base_resolutions</a>[resid];
00704     }
00705 }
00706 
00707 <span class="keyword">static</span> <span class="keyword">const</span> <a class="code" href="structescp2__dropsize__t.html">escp2_dropsize_t</a> *
<a name="l00708"></a><a class="code" href="print-escp2_8c.html#a36">00708</a> <a class="code" href="print-escp2_8c.html#a36">escp2_dropsizes</a>(<span class="keyword">const</span> <a class="code" href="structstp__vars.html">stp_vars_t</a> *v, <span class="keywordtype">int</span> resid)
00709 {
00710   <span class="keywordtype">int</span> model = <a class="code" href="group__printer.html#ga23">stp_get_model_id</a>(v);
00711   <span class="keyword">const</span> <a class="code" href="print-escp2_8h.html#a58">escp2_drop_list_t</a> *drops = <a class="code" href="print-escp2-data_8c.html#a80">stpi_escp2_model_capabilities</a>[model].<a class="code" href="structescp2__printer.html#o55">drops</a>;
00712   <span class="keywordflow">return</span> (*drops)[resid];
00713 }
00714 
00715 <span class="keyword">static</span> <span class="keyword">const</span> <a class="code" href="structinklist__t.html">inklist_t</a> *
<a name="l00716"></a><a class="code" href="print-escp2_8c.html#a37">00716</a> <a class="code" href="print-escp2_8c.html#a37">escp2_inklist</a>(<span class="keyword">const</span> <a class="code" href="structstp__vars.html">stp_vars_t</a> *v)
00717 {
00718   <span class="keywordtype">int</span> model = <a class="code" href="group__printer.html#ga23">stp_get_model_id</a>(v);
00719   <span class="keywordtype">int</span> i;
00720   <span class="keyword">const</span> <span class="keywordtype">char</span> *ink_list_name = NULL;
00721   <span class="keyword">const</span> <a class="code" href="structinkgroup__t.html">inkgroup_t</a> *inkgroup = <a class="code" href="print-escp2-data_8c.html#a80">stpi_escp2_model_capabilities</a>[model].<a class="code" href="structescp2__printer.html#o57">inkgroup</a>;
00722 
00723   <span class="keywordflow">if</span> (<a class="code" href="group__vars.html#ga100">stp_check_string_parameter</a>(v, <span class="stringliteral">"InkSet"</span>, <a class="code" href="group__vars.html#gga135a32">STP_PARAMETER_ACTIVE</a>))
00724     ink_list_name = <a class="code" href="group__vars.html#ga36">stp_get_string_parameter</a>(v, <span class="stringliteral">"InkSet"</span>);
00725   <span class="keywordflow">if</span> (ink_list_name)
00726     {
00727       <span class="keywordflow">for</span> (i = 0; i &lt; inkgroup-&gt;<a class="code" href="structinkgroup__t.html#o2">n_inklists</a>; i++)
00728         {
00729           <span class="keywordflow">if</span> (strcmp(ink_list_name, inkgroup-&gt;<a class="code" href="structinkgroup__t.html#o1">inklists</a>[i]-&gt;<a class="code" href="structinklist__t.html#o0">name</a>) == 0)
00730             <span class="keywordflow">return</span> inkgroup-&gt;<a class="code" href="structinkgroup__t.html#o1">inklists</a>[i];
00731         }
00732     }
00733   <span class="keywordflow">return</span> inkgroup-&gt;<a class="code" href="structinkgroup__t.html#o1">inklists</a>[0];
00734 }
00735 
00736 <span class="keyword">static</span> <span class="keyword">const</span> <a class="code" href="structshade__t.html">shade_t</a> *
<a name="l00737"></a><a class="code" href="print-escp2_8c.html#a38">00737</a> <a class="code" href="print-escp2_8c.html#a38">escp2_shades</a>(<span class="keyword">const</span> <a class="code" href="structstp__vars.html">stp_vars_t</a> *v, <span class="keywordtype">int</span> channel)
00738 {
00739   <span class="keyword">const</span> <a class="code" href="structinklist__t.html">inklist_t</a> *inklist = <a class="code" href="print-escp2_8c.html#a37">escp2_inklist</a>(v);
00740   <span class="keywordflow">return</span> &amp;((*inklist-&gt;<a class="code" href="structinklist__t.html#o5">shades</a>)[channel]);
00741 }
00742 
00743 <span class="keyword">static</span> <span class="keyword">const</span> <a class="code" href="structpaperlist__t.html">paperlist_t</a> *
<a name="l00744"></a><a class="code" href="print-escp2_8c.html#a39">00744</a> <a class="code" href="print-escp2_8c.html#a39">escp2_paperlist</a>(<span class="keyword">const</span> <a class="code" href="structstp__vars.html">stp_vars_t</a> *v)
00745 {
00746   <span class="keyword">const</span> <a class="code" href="structinklist__t.html">inklist_t</a> *inklist = <a class="code" href="print-escp2_8c.html#a37">escp2_inklist</a>(v);
00747   <span class="keywordflow">if</span> (inklist)
00748     <span class="keywordflow">return</span> inklist-&gt;<a class="code" href="structinklist__t.html#o3">papers</a>;
00749   <span class="keywordflow">else</span>
00750     <span class="keywordflow">return</span> NULL;
00751 }
00752 
00753 <span class="keyword">static</span> <span class="keywordtype">int</span>
<a name="l00754"></a><a class="code" href="print-escp2_8c.html#a40">00754</a> <a class="code" href="print-escp2_8c.html#a40">using_automatic_settings</a>(<span class="keyword">const</span> <a class="code" href="structstp__vars.html">stp_vars_t</a> *v, auto_mode_t mode)
00755 {
00756   <span class="keywordtype">int</span> is_raw = 0;
00757   <span class="keywordflow">if</span> (<a class="code" href="group__vars.html#ga36">stp_get_string_parameter</a>(v, <span class="stringliteral">"InputImageType"</span>) &amp;&amp;
00758       strcmp(<a class="code" href="group__vars.html#ga36">stp_get_string_parameter</a>(v, <span class="stringliteral">"InputImageType"</span>), <span class="stringliteral">"Raw"</span>) == 0)
00759     is_raw = 1;
00760   <span class="keywordflow">switch</span> (mode)
00761     {
00762     <span class="keywordflow">case</span> <a class="code" href="print-escp2_8h.html#a157a137">AUTO_MODE_QUALITY</a>:
00763       <span class="keywordflow">if</span> (<a class="code" href="group__vars.html#ga100">stp_check_string_parameter</a>(v, <span class="stringliteral">"Quality"</span>, <a class="code" href="group__vars.html#gga135a32">STP_PARAMETER_ACTIVE</a>) &amp;&amp;
00764           strcmp(<a class="code" href="group__vars.html#ga36">stp_get_string_parameter</a>(v, <span class="stringliteral">"Quality"</span>), <span class="stringliteral">"None"</span>) != 0 &amp;&amp;
00765           !is_raw)
00766         <span class="keywordflow">return</span> 1;
00767       <span class="keywordflow">else</span>
00768         <span class="keywordflow">return</span> 0;
00769 <span class="preprocessor">#if 0</span>
00770 <span class="preprocessor"></span>    <span class="keywordflow">case</span> AUTO_MODE_FULL_AUTO:
00771       <span class="keywordflow">if</span> (<a class="code" href="group__vars.html#ga100">stp_check_string_parameter</a>(v, <span class="stringliteral">"AutoMode"</span>, <a class="code" href="group__vars.html#gga135a32">STP_PARAMETER_ACTIVE</a>) &amp;&amp;
00772           strcmp(<a class="code" href="group__vars.html#ga36">stp_get_string_parameter</a>(v, <span class="stringliteral">"AutoMode"</span>), <span class="stringliteral">"None"</span>) != 0 &amp;&amp;
00773           !is_raw)
00774         <span class="keywordflow">return</span> 1;
00775       <span class="keywordflow">else</span>
00776         <span class="keywordflow">return</span> 0;
00777 <span class="preprocessor">#endif</span>
00778 <span class="preprocessor"></span>    <span class="keywordflow">case</span> <a class="code" href="print-escp2_8h.html#a157a138">AUTO_MODE_MANUAL</a>:
00779       <span class="keywordflow">if</span> (!<a class="code" href="group__vars.html#ga100">stp_check_string_parameter</a>(v, <span class="stringliteral">"Quality"</span>, <a class="code" href="group__vars.html#gga135a32">STP_PARAMETER_ACTIVE</a>) ||
00780           strcmp(<a class="code" href="group__vars.html#ga36">stp_get_string_parameter</a>(v, <span class="stringliteral">"Quality"</span>), <span class="stringliteral">"None"</span>) == 0 ||
00781           is_raw)
00782         <span class="keywordflow">return</span> 1;
00783       <span class="keywordflow">else</span>
00784         <span class="keywordflow">return</span> 0;
00785     }
00786   <span class="keywordflow">return</span> 0;
00787 }    
00788 
00789 <span class="keyword">static</span> <span class="keywordtype">int</span>
<a name="l00790"></a><a class="code" href="print-escp2_8c.html#a41">00790</a> <a class="code" href="print-escp2_8c.html#a41">compute_internal_resid</a>(<span class="keywordtype">int</span> hres, <span class="keywordtype">int</span> vres)
00791 {
00792   <span class="keyword">static</span> <span class="keyword">const</span> <span class="keywordtype">int</span> resolutions[<a class="code" href="print-escp2_8h.html#a13">RES_N</a>] =
00793     {
00794       0,
00795       360 * 360,
00796       720 * 360,
00797       720 * 720,
00798       1440 * 720,
00799       1440 * 1440,
00800       2880 * 1440,
00801       2880 * 2880,
00802     };
00803   <span class="keywordtype">int</span> total_resolution = hres * vres;
00804   <span class="keywordtype">int</span> i;
00805   <span class="keywordflow">for</span> (i = 0; i &lt; <a class="code" href="print-escp2_8h.html#a13">RES_N</a>; i++)
00806     {
00807       <span class="keywordflow">if</span> (total_resolution &lt; resolutions[i])
00808         <span class="keywordflow">return</span> i - 1;
00809     }
00810   <span class="keywordflow">return</span> <a class="code" href="print-escp2_8h.html#a13">RES_N</a> - 1;
00811 }  
00812 
00813 <span class="keyword">static</span> <span class="keywordtype">int</span>
<a name="l00814"></a><a class="code" href="print-escp2_8c.html#a42">00814</a> <a class="code" href="print-escp2_8c.html#a42">compute_resid</a>(<span class="keyword">const</span> <a class="code" href="structres__t.html">res_t</a> *res)
00815 {
00816   <span class="keywordflow">return</span> <a class="code" href="print-escp2_8c.html#a41">compute_internal_resid</a>(res-&gt;<a class="code" href="structres__t.html#o2">hres</a>, res-&gt;<a class="code" href="structres__t.html#o3">vres</a>);
00817 }
00818 
00819 <span class="keyword">static</span> <span class="keywordtype">int</span>
<a name="l00820"></a><a class="code" href="print-escp2_8c.html#a43">00820</a> <a class="code" href="print-escp2_8c.html#a43">compute_printed_resid</a>(<span class="keyword">const</span> <a class="code" href="structres__t.html">res_t</a> *res)
00821 {
00822   <span class="keywordflow">return</span> <a class="code" href="print-escp2_8c.html#a41">compute_internal_resid</a>(res-&gt;<a class="code" href="structres__t.html#o4">printed_hres</a>, res-&gt;<a class="code" href="structres__t.html#o5">printed_vres</a>);
00823 }
00824 
00825 
00826 <span class="keyword">static</span> <span class="keyword">const</span> <a class="code" href="structinput__slot__t.html">input_slot_t</a> *
<a name="l00827"></a><a class="code" href="print-escp2_8c.html#a44">00827</a> <a class="code" href="print-escp2_8c.html#a44">get_input_slot</a>(<span class="keyword">const</span> <a class="code" href="structstp__vars.html">stp_vars_t</a> *v)
00828 {
00829   <span class="keywordtype">int</span> i;
00830   <span class="keyword">const</span> <span class="keywordtype">char</span> *input_slot = <a class="code" href="group__vars.html#ga36">stp_get_string_parameter</a>(v, <span class="stringliteral">"InputSlot"</span>);
00831   <span class="keywordflow">if</span> (input_slot &amp;&amp; strlen(input_slot) &gt; 0)
00832     {
00833       <span class="keyword">const</span> <a class="code" href="structinput__slot__list__t.html">input_slot_list_t</a> *slots = escp2_input_slots(v);
00834       <span class="keywordflow">if</span> (slots)
00835         {
00836           <span class="keywordflow">for</span> (i = 0; i &lt; slots-&gt;<a class="code" href="structinput__slot__list__t.html#o1">n_input_slots</a>; i++)
00837             {
00838               <span class="keywordflow">if</span> (slots-&gt;<a class="code" href="structinput__slot__list__t.html#o0">slots</a>[i].<a class="code" href="structinput__slot__t.html#o0">name</a> &amp;&amp;
00839                   strcmp(input_slot, slots-&gt;<a class="code" href="structinput__slot__list__t.html#o0">slots</a>[i].<a class="code" href="structinput__slot__t.html#o0">name</a>) == 0)
00840                 {
00841                   <span class="keywordflow">return</span> &amp;(slots-&gt;<a class="code" href="structinput__slot__list__t.html#o0">slots</a>[i]);
00842                   <span class="keywordflow">break</span>;
00843                 }
00844             }
00845         }
00846     }
00847   <span class="keywordflow">return</span> NULL;
00848 }
00849 
00850 <span class="keyword">static</span> <span class="keyword">const</span> <a class="code" href="structprinter__weave__t.html">printer_weave_t</a> *
<a name="l00851"></a><a class="code" href="print-escp2_8c.html#a45">00851</a> <a class="code" href="print-escp2_8c.html#a45">get_printer_weave</a>(<span class="keyword">const</span> <a class="code" href="structstp__vars.html">stp_vars_t</a> *v)
00852 {
00853   <span class="keywordtype">int</span> i;
00854   <span class="keyword">const</span> <a class="code" href="structprinter__weave__list__t.html">printer_weave_list_t</a> *p = escp2_printer_weaves(v);
00855   <span class="keywordflow">if</span> (p)
00856     {
00857       <span class="keyword">const</span> <span class="keywordtype">char</span> *name = <a class="code" href="group__vars.html#ga36">stp_get_string_parameter</a>(v, <span class="stringliteral">"Weave"</span>);
00858       <span class="keywordtype">int</span> printer_weave_count = p-&gt;<a class="code" href="structprinter__weave__list__t.html#o1">n_printer_weaves</a>;
00859       <span class="keywordflow">if</span> (name)
00860         {
00861           <span class="keywordflow">for</span> (i = 0; i &lt; printer_weave_count; i++)
00862             {
00863               <span class="keywordflow">if</span> (!strcmp(name, p-&gt;<a class="code" href="structprinter__weave__list__t.html#o2">printer_weaves</a>[i].<a class="code" href="structprinter__weave__t.html#o0">name</a>))
00864                 <span class="keywordflow">return</span> &amp;(p-&gt;<a class="code" href="structprinter__weave__list__t.html#o2">printer_weaves</a>[i]);
00865             }
00866         }
00867     }
00868   <span class="keywordflow">return</span> NULL;
00869 }
00870 
00871 <span class="keyword">static</span> <span class="keywordtype">int</span>
<a name="l00872"></a><a class="code" href="print-escp2_8c.html#a46">00872</a> <a class="code" href="print-escp2_8c.html#a46">use_printer_weave</a>(<span class="keyword">const</span> <a class="code" href="structstp__vars.html">stp_vars_t</a> *v)
00873 {
00874   <span class="keyword">const</span> <a class="code" href="structres__t.html">res_t</a> *res = <a class="code" href="print-escp2_8c.html#a26">escp2_find_resolution</a>(v);
00875   <span class="keywordflow">if</span> (!res)
00876     <span class="keywordflow">return</span> 1;
00877   <span class="keywordflow">else</span> <span class="keywordflow">if</span> (!(res-&gt;<a class="code" href="structres__t.html#o6">softweave</a>))
00878     <span class="keywordflow">return</span> 1;
00879   <span class="keywordflow">else</span> <span class="keywordflow">if</span> (res-&gt;<a class="code" href="structres__t.html#o7">printer_weave</a>)
00880     <span class="keywordflow">return</span> 1;
00881   <span class="keywordflow">else</span>
00882     <span class="keywordflow">return</span> 0;
00883 }
00884   
00885 
00886 <span class="keyword">static</span> <span class="keyword">const</span> <a class="code" href="structpaper__t.html">paper_t</a> *
<a name="l00887"></a><a class="code" href="print-escp2_8c.html#a47">00887</a> <a class="code" href="print-lexmark_8c.html#a126">get_media_type</a>(<span class="keyword">const</span> <a class="code" href="structstp__vars.html">stp_vars_t</a> *v)
00888 {
00889   <span class="keywordtype">int</span> i;
00890   <span class="keyword">const</span> <a class="code" href="structpaperlist__t.html">paperlist_t</a> *p = <a class="code" href="print-escp2_8c.html#a39">escp2_paperlist</a>(v);
00891   <span class="keywordflow">if</span> (p)
00892     {
00893       <span class="keyword">const</span> <span class="keywordtype">char</span> *name = <a class="code" href="group__vars.html#ga36">stp_get_string_parameter</a>(v, <span class="stringliteral">"MediaType"</span>);
00894       <span class="keywordtype">int</span> paper_type_count = p-&gt;<a class="code" href="structpaperlist__t.html#o1">paper_count</a>;
00895       <span class="keywordflow">if</span> (name)
00896         {
00897           <span class="keywordflow">for</span> (i = 0; i &lt; paper_type_count; i++)
00898             {
00899               <span class="keywordflow">if</span> (!strcmp(name, p-&gt;<a class="code" href="structpaperlist__t.html#o2">papers</a>[i].<a class="code" href="structpaper__t.html#o0">name</a>))
00900                 <span class="keywordflow">return</span> &amp;(p-&gt;<a class="code" href="structpaperlist__t.html#o2">papers</a>[i]);
00901             }
00902         }
00903     }
00904   <span class="keywordflow">return</span> NULL;
00905 }
00906 
00907 <span class="keyword">static</span> <span class="keywordtype">int</span>
<a name="l00908"></a><a class="code" href="print-escp2_8c.html#a48">00908</a> <a class="code" href="print-escp2_8c.html#a48">verify_resolution_by_paper_type</a>(<span class="keyword">const</span> <a class="code" href="structstp__vars.html">stp_vars_t</a> *v, <span class="keyword">const</span> <a class="code" href="structres__t.html">res_t</a> *res)
00909 {
00910   <span class="keyword">const</span> <a class="code" href="structpaper__t.html">paper_t</a> *paper = <a class="code" href="print-lexmark_8c.html#a126">get_media_type</a>(v);
00911   <span class="keywordflow">if</span> (paper)
00912     {
00913       <span class="keywordflow">switch</span> (paper-&gt;<a class="code" href="structpaper__t.html#o11">paper_class</a>)
00914         {
00915         <span class="keywordflow">case</span> <a class="code" href="print-escp2_8h.html#a155a125">PAPER_PLAIN</a>:
00916           <span class="keywordflow">if</span> (res-&gt;<a class="code" href="structres__t.html#o5">printed_vres</a> &gt; 720 || res-&gt;<a class="code" href="structres__t.html#o2">hres</a> &gt; 720)
00917             <span class="keywordflow">return</span> 0;
00918           <span class="keywordflow">break</span>;
00919         <span class="keywordflow">case</span> <a class="code" href="print-escp2_8h.html#a155a126">PAPER_GOOD</a>:
00920           <span class="keywordflow">if</span> (res-&gt;<a class="code" href="structres__t.html#o5">printed_vres</a> &lt; 180 || res-&gt;<a class="code" href="structres__t.html#o2">hres</a> &lt; 360 ||
00921               res-&gt;<a class="code" href="structres__t.html#o5">printed_vres</a> &gt; 720 || res-&gt;<a class="code" href="structres__t.html#o2">hres</a> &gt; 1440)
00922             <span class="keywordflow">return</span> 0;
00923           <span class="keywordflow">break</span>;
00924         <span class="keywordflow">case</span> <a class="code" href="print-escp2_8h.html#a155a127">PAPER_PHOTO</a>:
00925           <span class="keywordflow">if</span> (res-&gt;<a class="code" href="structres__t.html#o5">printed_vres</a> &lt; 360 || 
00926               (res-&gt;<a class="code" href="structres__t.html#o2">hres</a> &lt; 720 &amp;&amp; res-&gt;<a class="code" href="structres__t.html#o2">hres</a> &lt; escp2_max_hres(v)))
00927             <span class="keywordflow">return</span> 0;
00928           <span class="keywordflow">break</span>;
00929         <span class="keywordflow">case</span> <a class="code" href="print-escp2_8h.html#a155a128">PAPER_PREMIUM_PHOTO</a>:
00930           <span class="keywordflow">if</span> (res-&gt;<a class="code" href="structres__t.html#o5">printed_vres</a> &lt; 720 ||
00931               (res-&gt;<a class="code" href="structres__t.html#o2">hres</a> &lt; 720 &amp;&amp; res-&gt;<a class="code" href="structres__t.html#o2">hres</a> &lt; escp2_max_hres(v)))
00932             <span class="keywordflow">return</span> 0;
00933           <span class="keywordflow">break</span>;
00934         <span class="keywordflow">case</span> <a class="code" href="print-escp2_8h.html#a155a129">PAPER_TRANSPARENCY</a>:
00935           <span class="keywordflow">if</span> (res-&gt;<a class="code" href="structres__t.html#o5">printed_vres</a> &lt; 360 || res-&gt;<a class="code" href="structres__t.html#o2">hres</a> &lt; 360 ||
00936               res-&gt;<a class="code" href="structres__t.html#o5">printed_vres</a> &gt; 720 || res-&gt;<a class="code" href="structres__t.html#o2">hres</a> &gt; 720)
00937             <span class="keywordflow">return</span> 0;
00938           <span class="keywordflow">break</span>;
00939         }
00940     }
00941   <span class="keywordflow">return</span> 1;
00942 }
00943 
00944 <span class="keyword">static</span> <span class="keywordtype">int</span>
<a name="l00945"></a><a class="code" href="print-escp2_8c.html#a49">00945</a> <a class="code" href="print-escp2_8c.html#a49">verify_resolution</a>(<span class="keyword">const</span> <a class="code" href="structstp__vars.html">stp_vars_t</a> *v, <span class="keyword">const</span> <a class="code" href="structres__t.html">res_t</a> *res)
00946 {
00947   <span class="keywordtype">int</span> nozzle_width =
00948     (escp2_base_separation(v) / escp2_nozzle_separation(v));
00949   <span class="keywordtype">int</span> nozzles = escp2_nozzles(v);
00950   <span class="keywordflow">if</span> (<a class="code" href="print-escp2_8c.html#a32">escp2_ink_type</a>(v, <a class="code" href="print-escp2_8c.html#a43">compute_printed_resid</a>(res)) != -1 &amp;&amp;
00951       res-&gt;<a class="code" href="structres__t.html#o3">vres</a> &lt;= escp2_max_vres(v) &amp;&amp;
00952       res-&gt;<a class="code" href="structres__t.html#o2">hres</a> &lt;= escp2_max_hres(v) &amp;&amp;
00953       res-&gt;<a class="code" href="structres__t.html#o3">vres</a> &gt;= escp2_min_vres(v) &amp;&amp;
00954       res-&gt;<a class="code" href="structres__t.html#o2">hres</a> &gt;= escp2_min_hres(v) &amp;&amp;
00955       (nozzles == 1 ||
00956        ((res-&gt;<a class="code" href="structres__t.html#o3">vres</a> / nozzle_width) * nozzle_width) == res-&gt;<a class="code" href="structres__t.html#o3">vres</a>))
00957     {
00958       <span class="keywordtype">int</span> xdpi = res-&gt;<a class="code" href="structres__t.html#o2">hres</a>;
00959       <span class="keywordtype">int</span> physical_xdpi = <a class="code" href="print-escp2_8c.html#a35">escp2_base_res</a>(v, <a class="code" href="print-escp2_8c.html#a42">compute_resid</a>(res));
00960       <span class="keywordtype">int</span> horizontal_passes, oversample;
00961       <span class="keywordflow">if</span> (physical_xdpi &gt; xdpi)
00962         physical_xdpi = xdpi;
00963       horizontal_passes = xdpi / physical_xdpi;
00964       oversample = horizontal_passes * res-&gt;<a class="code" href="structres__t.html#o8">vertical_passes</a>;
00965       <span class="keywordflow">if</span> (horizontal_passes &lt; 1)
00966         horizontal_passes = 1;
00967       <span class="keywordflow">if</span> (oversample &lt; 1)
00968         oversample = 1;
00969       <span class="keywordflow">if</span> (((horizontal_passes * res-&gt;<a class="code" href="structres__t.html#o8">vertical_passes</a>) &lt;= 8) &amp;&amp;
00970           (! res-&gt;<a class="code" href="structres__t.html#o6">softweave</a> || (nozzles &gt; 1 &amp;&amp; nozzles &gt; oversample)))
00971         <span class="keywordflow">return</span> 1;
00972     }
00973   <span class="keywordflow">return</span> 0;
00974 }
00975 
00976 <span class="keyword">static</span> <span class="keywordtype">int</span>
<a name="l00977"></a><a class="code" href="print-escp2_8c.html#a50">00977</a> <a class="code" href="print-escp2_8c.html#a50">verify_papersize</a>(<span class="keyword">const</span> <a class="code" href="structstp__vars.html">stp_vars_t</a> *v, <span class="keyword">const</span> <a class="code" href="structstp__papersize__t.html">stp_papersize_t</a> *pt)
00978 {
00979   <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> height_limit, width_limit;
00980   <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> min_height_limit, min_width_limit;
00981   width_limit = escp2_max_paper_width(v);
00982   height_limit = escp2_max_paper_height(v);
00983   min_width_limit = escp2_min_paper_width(v);
00984   min_height_limit = escp2_min_paper_height(v);
00985   <span class="keywordflow">if</span> (strlen(pt-&gt;<a class="code" href="structstp__papersize__t.html#o0">name</a>) &gt; 0 &amp;&amp;
00986       pt-&gt;<a class="code" href="structstp__papersize__t.html#o3">width</a> &lt;= width_limit &amp;&amp; pt-&gt;<a class="code" href="structstp__papersize__t.html#o4">height</a> &lt;= height_limit &amp;&amp;
00987       (pt-&gt;<a class="code" href="structstp__papersize__t.html#o4">height</a> &gt;= min_height_limit || pt-&gt;<a class="code" href="structstp__papersize__t.html#o4">height</a> == 0) &amp;&amp;
00988       (pt-&gt;<a class="code" href="structstp__papersize__t.html#o3">width</a> &gt;= min_width_limit || pt-&gt;<a class="code" href="structstp__papersize__t.html#o3">width</a> == 0) &amp;&amp;
00989       (pt-&gt;<a class="code" href="structstp__papersize__t.html#o3">width</a> == 0 || pt-&gt;<a class="code" href="structstp__papersize__t.html#o4">height</a> &gt; 0 ||
00990        <a class="code" href="print-escp2_8c.html#a29">escp2_has_cap</a>(v, <a class="code" href="print-escp2_8h.html#a158a141">MODEL_ROLLFEED</a>, <a class="code" href="print-escp2_8h.html#a27">MODEL_ROLLFEED_YES</a>)))
00991     <span class="keywordflow">return</span> 1;
00992   <span class="keywordflow">else</span>
00993     <span class="keywordflow">return</span> 0;
00994 }
00995 
00996 <span class="keyword">static</span> <span class="keywordtype">int</span>
<a name="l00997"></a><a class="code" href="print-escp2_8c.html#a51">00997</a> <a class="code" href="print-escp2_8c.html#a51">verify_inktype</a>(<span class="keyword">const</span> <a class="code" href="structstp__vars.html">stp_vars_t</a> *v, <span class="keyword">const</span> <a class="code" href="structescp2__inkname__t.html">escp2_inkname_t</a> *inks)
00998 {
00999   <span class="keywordflow">if</span> (inks-&gt;<a class="code" href="structescp2__inkname__t.html#o2">inkset</a> == <a class="code" href="print-escp2_8h.html#a156a136">INKSET_EXTENDED</a>)
01000     <span class="keywordflow">return</span> 0;
01001   <span class="keywordflow">else</span>
01002     <span class="keywordflow">return</span> 1;
01003 }
01004 
01005 <span class="keyword">static</span> <span class="keyword">const</span> <span class="keywordtype">char</span> *
<a name="l01006"></a><a class="code" href="print-escp2_8c.html#a52">01006</a> <a class="code" href="print-escp2_8c.html#a52">get_default_inktype</a>(<span class="keyword">const</span> <a class="code" href="structstp__vars.html">stp_vars_t</a> *v)
01007 {
01008   <span class="keyword">const</span> <a class="code" href="structinklist__t.html">inklist_t</a> *ink_list = <a class="code" href="print-escp2_8c.html#a37">escp2_inklist</a>(v);
01009   <span class="keyword">const</span> <a class="code" href="structpaper__t.html">paper_t</a> *paper_type = <a class="code" href="print-lexmark_8c.html#a126">get_media_type</a>(v);
01010   <span class="keywordflow">if</span> (!ink_list)
01011     <span class="keywordflow">return</span> NULL;
01012   <span class="keywordflow">if</span> (!paper_type)
01013     {
01014       <span class="keyword">const</span> <a class="code" href="structpaperlist__t.html">paperlist_t</a> *p = <a class="code" href="print-escp2_8c.html#a39">escp2_paperlist</a>(v);
01015       <span class="keywordflow">if</span> (p)
01016         paper_type = &amp;(p-&gt;<a class="code" href="structpaperlist__t.html#o2">papers</a>[0]);
01017     }
01018   <span class="keywordflow">if</span> (paper_type &amp;&amp; paper_type-&gt;<a class="code" href="structpaper__t.html#o17">preferred_ink_type</a>)
01019     <span class="keywordflow">return</span> paper_type-&gt;<a class="code" href="structpaper__t.html#o17">preferred_ink_type</a>;
01020   <span class="keywordflow">else</span> <span class="keywordflow">if</span> (<a class="code" href="print-escp2_8c.html#a29">escp2_has_cap</a>(v, <a class="code" href="print-escp2_8h.html#a158a145">MODEL_FAST_360</a>, <a class="code" href="print-escp2_8h.html#a39">MODEL_FAST_360_YES</a>) &amp;&amp;
01021            <a class="code" href="group__vars.html#ga100">stp_check_string_parameter</a>(v, <span class="stringliteral">"Resolution"</span>, <a class="code" href="group__vars.html#gga135a32">STP_PARAMETER_ACTIVE</a>))
01022     {
01023       <span class="keyword">const</span> <a class="code" href="structres__t.html">res_t</a> *res = <a class="code" href="print-escp2_8c.html#a26">escp2_find_resolution</a>(v);
01024       <span class="keywordflow">if</span> (res)
01025         {
01026           <span class="keywordtype">int</span> resid = <a class="code" href="print-escp2_8c.html#a43">compute_printed_resid</a>(res);
01027           <span class="keywordflow">if</span> (res-&gt;<a class="code" href="structres__t.html#o3">vres</a> == 360 &amp;&amp; res-&gt;<a class="code" href="structres__t.html#o2">hres</a> == <a class="code" href="print-escp2_8c.html#a35">escp2_base_res</a>(v, resid))
01028             {
01029               <span class="keywordtype">int</span> i;
01030               <span class="keywordflow">for</span> (i = 0; i &lt; ink_list-&gt;<a class="code" href="structinklist__t.html#o6">n_inks</a>; i++)
01031                 <span class="keywordflow">if</span> (strcmp(ink_list-&gt;<a class="code" href="structinklist__t.html#o2">inknames</a>[i]-&gt;<a class="code" href="structescp2__inkname__t.html#o0">name</a>, <span class="stringliteral">"CMYK"</span>) == 0)
01032                   <span class="keywordflow">return</span> ink_list-&gt;<a class="code" href="structinklist__t.html#o2">inknames</a>[i]-&gt;<a class="code" href="structescp2__inkname__t.html#o0">name</a>;
01033             }
01034         }
01035     }
01036   <span class="keywordflow">return</span> ink_list-&gt;<a class="code" href="structinklist__t.html#o2">inknames</a>[0]-&gt;<a class="code" href="structescp2__inkname__t.html#o0">name</a>;
01037 }
01038 
01039 
01040 <span class="keyword">static</span> <span class="keyword">const</span> <a class="code" href="structescp2__inkname__t.html">escp2_inkname_t</a> *
<a name="l01041"></a><a class="code" href="print-escp2_8c.html#a53">01041</a> <a class="code" href="print-escp2_8c.html#a53">get_inktype</a>(<span class="keyword">const</span> <a class="code" href="structstp__vars.html">stp_vars_t</a> *v)
01042 {
01043   <span class="keyword">const</span> <span class="keywordtype">char</span>    *ink_type = <a class="code" href="group__vars.html#ga36">stp_get_string_parameter</a>(v, <span class="stringliteral">"InkType"</span>);
01044   <span class="keyword">const</span> <a class="code" href="structinklist__t.html">inklist_t</a> *ink_list = <a class="code" href="print-escp2_8c.html#a37">escp2_inklist</a>(v);
01045   <span class="keywordtype">int</span> i;
01046 
01047   <span class="keywordflow">if</span> (!ink_type || strcmp(ink_type, <span class="stringliteral">"None"</span>) == 0 ||
01048       (ink_list &amp;&amp; ink_list-&gt;<a class="code" href="structinklist__t.html#o6">n_inks</a> == 1) ||
01049       !<a class="code" href="print-escp2_8c.html#a40">using_automatic_settings</a>(v, <a class="code" href="print-escp2_8h.html#a157a138">AUTO_MODE_MANUAL</a>))
01050     ink_type = <a class="code" href="print-escp2_8c.html#a52">get_default_inktype</a>(v);
01051 
01052   <span class="keywordflow">if</span> (ink_type &amp;&amp; ink_list)
01053     {
01054       <span class="keywordflow">for</span> (i = 0; i &lt; ink_list-&gt;<a class="code" href="structinklist__t.html#o6">n_inks</a>; i++)
01055         {
01056           <span class="keywordflow">if</span> (strcmp(ink_type, ink_list-&gt;<a class="code" href="structinklist__t.html#o2">inknames</a>[i]-&gt;<a class="code" href="structescp2__inkname__t.html#o0">name</a>) == 0)
01057             <span class="keywordflow">return</span> ink_list-&gt;<a class="code" href="structinklist__t.html#o2">inknames</a>[i];
01058         }
01059     }
01060   <span class="comment">/*</span>
01061 <span class="comment">   * If we couldn't find anything, try again with the default ink type.</span>
01062 <span class="comment">   * This may mean duplicate work, but that's cheap enough.</span>
01063 <span class="comment">   */</span>
01064   ink_type = <a class="code" href="print-escp2_8c.html#a52">get_default_inktype</a>(v);
01065   <span class="keywordflow">for</span> (i = 0; i &lt; ink_list-&gt;<a class="code" href="structinklist__t.html#o6">n_inks</a>; i++)
01066     {
01067       <span class="keywordflow">if</span> (strcmp(ink_type, ink_list-&gt;<a class="code" href="structinklist__t.html#o2">inknames</a>[i]-&gt;<a class="code" href="structescp2__inkname__t.html#o0">name</a>) == 0)
01068         <span class="keywordflow">return</span> ink_list-&gt;<a class="code" href="structinklist__t.html#o2">inknames</a>[i];
01069     }
01070   <span class="keywordflow">return</span> NULL;
01071 }
01072 
01073 <span class="keyword">static</span> <span class="keyword">const</span> <a class="code" href="structpaper__adjustment__t.html">paper_adjustment_t</a> *
<a name="l01074"></a><a class="code" href="print-escp2_8c.html#a54">01074</a> <a class="code" href="print-escp2_8c.html#a54">get_media_adjustment</a>(<span class="keyword">const</span> <a class="code" href="structstp__vars.html">stp_vars_t</a> *v)
01075 {
01076   <span class="keyword">const</span> <a class="code" href="structpaper__t.html">paper_t</a> *pt = <a class="code" href="print-lexmark_8c.html#a126">get_media_type</a>(v);
01077   <span class="keyword">const</span> <a class="code" href="structinklist__t.html">inklist_t</a> *ink_list = <a class="code" href="print-escp2_8c.html#a37">escp2_inklist</a>(v);
01078   <span class="keywordflow">if</span> (pt &amp;&amp; ink_list &amp;&amp; ink_list-&gt;<a class="code" href="structinklist__t.html#o4">paper_adjustments</a>)
01079     {
01080       <span class="keyword">const</span> <a class="code" href="structpaper__adjustment__list__t.html">paper_adjustment_list_t</a> *adjlist = ink_list-&gt;<a class="code" href="structinklist__t.html#o4">paper_adjustments</a>;
01081       <span class="keyword">const</span> <span class="keywordtype">char</span> *paper_name = pt-&gt;<a class="code" href="structpaper__t.html#o0">name</a>;
01082       <span class="keywordtype">int</span> i;
01083       <span class="keywordflow">for</span> (i = 0; i &lt; adjlist-&gt;<a class="code" href="structpaper__adjustment__list__t.html#o1">paper_count</a>; i++)
01084         {
01085           <span class="keywordflow">if</span> (strcmp(paper_name, adjlist-&gt;<a class="code" href="structpaper__adjustment__list__t.html#o2">papers</a>[i].<a class="code" href="structpaper__adjustment__t.html#o0">name</a>) == 0)
01086             <span class="keywordflow">return</span> &amp;(adjlist-&gt;<a class="code" href="structpaper__adjustment__list__t.html#o2">papers</a>[i]);
01087         }
01088     }
01089   <span class="keywordflow">return</span> NULL;
01090 }
01091 
01092 
01093 <span class="comment">/*</span>
01094 <span class="comment"> * 'escp2_parameters()' - Return the parameter values for the given parameter.</span>
01095 <span class="comment"> */</span>
01096 
01097 <span class="keyword">static</span> <a class="code" href="group__vars.html#ga1">stp_parameter_list_t</a>
<a name="l01098"></a><a class="code" href="print-escp2_8c.html#a55">01098</a> <a class="code" href="print-escp2_8c.html#a55">escp2_list_parameters</a>(<span class="keyword">const</span> <a class="code" href="structstp__vars.html">stp_vars_t</a> *v)
01099 {
01100   <a class="code" href="group__vars.html#ga1">stp_parameter_list_t</a> *ret = <a class="code" href="group__vars.html#ga43">stp_parameter_list_create</a>();
01101   <span class="keywordtype">int</span> i;
01102   <span class="keywordflow">for</span> (i = 0; i &lt; <a class="code" href="print-escp2_8c.html#a19">the_parameter_count</a>; i++)
01103     <a class="code" href="group__vars.html#ga82">stp_parameter_list_add_param</a>(ret, &amp;(<a class="code" href="print-escp2_8c.html#a18">the_parameters</a>[i]));
01104   <span class="keywordflow">for</span> (i = 0; i &lt; <a class="code" href="print-escp2_8c.html#a21">float_parameter_count</a>; i++)
01105     <a class="code" href="group__vars.html#ga82">stp_parameter_list_add_param</a>(ret, &amp;(<a class="code" href="print-escp2_8c.html#a20">float_parameters</a>[i].param));
01106   <span class="keywordflow">return</span> ret;
01107 }
01108 
01109 <span class="keyword">static</span> <span class="keywordtype">void</span>
<a name="l01110"></a><a class="code" href="print-escp2_8c.html#a56">01110</a> <a class="code" href="print-escp2_8c.html#a56">fill_transition_parameters</a>(<a class="code" href="structstp__parameter__t.html">stp_parameter_t</a> *description)
01111 {
01112   description-&gt;<a class="code" href="structstp__parameter__t.html#o8">is_active</a> = 1;
01113   description-&gt;<a class="code" href="structstp__parameter__t.html#o18">bounds</a>.dbl.lower = 0;
01114   description-&gt;<a class="code" href="structstp__parameter__t.html#o18">bounds</a>.dbl.upper = 5.0;
01115   description-&gt;<a class="code" href="structstp__parameter__t.html#o26">deflt</a>.dbl = 1.0;
01116 }
01117 
01118 <span class="keyword">static</span> <span class="keywordtype">void</span>
<a name="l01119"></a><a class="code" href="print-escp2_8c.html#a57">01119</a> <a class="code" href="print-escp2_8c.html#a57">set_density_parameter</a>(<span class="keyword">const</span> <a class="code" href="structstp__vars.html">stp_vars_t</a> *v,
01120                       <a class="code" href="structstp__parameter__t.html">stp_parameter_t</a> *description,
01121                       <span class="keywordtype">int</span> color)
01122 {
01123   description-&gt;<a class="code" href="structstp__parameter__t.html#o8">is_active</a> = 0;
01124   <span class="keywordflow">if</span> (<a class="code" href="group__vars.html#ga36">stp_get_string_parameter</a>(v, <span class="stringliteral">"PrintingMode"</span>) &amp;&amp;
01125       strcmp(<a class="code" href="group__vars.html#ga36">stp_get_string_parameter</a>(v, <span class="stringliteral">"PrintingMode"</span>), <span class="stringliteral">"BW"</span>) != 0 &amp;&amp;
01126       <a class="code" href="print-escp2_8c.html#a40">using_automatic_settings</a>(v, <a class="code" href="print-escp2_8h.html#a157a138">AUTO_MODE_MANUAL</a>))
01127     {
01128       <span class="keyword">const</span> <a class="code" href="structescp2__inkname__t.html">escp2_inkname_t</a> *ink_name = <a class="code" href="print-escp2_8c.html#a53">get_inktype</a>(v);
01129       <span class="keywordflow">if</span> (ink_name &amp;&amp;
01130           ink_name-&gt;<a class="code" href="structescp2__inkname__t.html#o3">channel_set</a>-&gt;<a class="code" href="structchannel__set__t.html#o2">channel_count</a> &gt; color &amp;&amp;
01131           ink_name-&gt;<a class="code" href="structescp2__inkname__t.html#o3">channel_set</a>-&gt;<a class="code" href="structchannel__set__t.html#o1">channels</a>[color])
01132         description-&gt;<a class="code" href="structstp__parameter__t.html#o8">is_active</a> = 1;
01133     }
01134 }  
01135 
01136 <span class="keyword">static</span> <span class="keywordtype">void</span>
<a name="l01137"></a><a class="code" href="print-escp2_8c.html#a58">01137</a> <a class="code" href="print-escp2_8c.html#a58">set_gray_transition_parameter</a>(<span class="keyword">const</span> <a class="code" href="structstp__vars.html">stp_vars_t</a> *v,
01138                               <a class="code" href="structstp__parameter__t.html">stp_parameter_t</a> *description,
01139                               <span class="keywordtype">int</span> expected_channels)
01140 {
01141   <span class="keyword">const</span> <a class="code" href="structescp2__inkname__t.html">escp2_inkname_t</a> *ink_name = <a class="code" href="print-escp2_8c.html#a53">get_inktype</a>(v);
01142   description-&gt;<a class="code" href="structstp__parameter__t.html#o8">is_active</a> = 0;
01143   <span class="keywordflow">if</span> (ink_name &amp;&amp; ink_name-&gt;<a class="code" href="structescp2__inkname__t.html#o3">channel_set</a>-&gt;<a class="code" href="structchannel__set__t.html#o1">channels</a>[<a class="code" href="dither_8h.html#a0">STP_ECOLOR_K</a>] &amp;&amp;
01144       (ink_name-&gt;<a class="code" href="structescp2__inkname__t.html#o3">channel_set</a>-&gt;<a class="code" href="structchannel__set__t.html#o1">channels</a>[<a class="code" href="dither_8h.html#a0">STP_ECOLOR_K</a>]-&gt;<a class="code" href="structink__channel__t.html#o2">n_subchannels</a> ==
01145        expected_channels) &amp;&amp;
01146       <a class="code" href="print-escp2_8c.html#a40">using_automatic_settings</a>(v, <a class="code" href="print-escp2_8h.html#a157a138">AUTO_MODE_MANUAL</a>))
01147     <a class="code" href="print-escp2_8c.html#a56">fill_transition_parameters</a>(description);
01148 }
01149 
01150 <span class="keyword">static</span> <span class="keywordtype">void</span>
<a name="l01151"></a><a class="code" href="print-escp2_8c.html#a59">01151</a> <a class="code" href="print-escp2_8c.html#a59">set_color_transition_parameter</a>(<span class="keyword">const</span> <a class="code" href="structstp__vars.html">stp_vars_t</a> *v,
01152                                <a class="code" href="structstp__parameter__t.html">stp_parameter_t</a> *description,
01153                                <span class="keywordtype">int</span> color)
01154 {
01155   description-&gt;<a class="code" href="structstp__parameter__t.html#o8">is_active</a> = 0;
01156   <span class="keywordflow">if</span> (<a class="code" href="group__vars.html#ga36">stp_get_string_parameter</a>(v, <span class="stringliteral">"PrintingMode"</span>) &amp;&amp;
01157       strcmp(<a class="code" href="group__vars.html#ga36">stp_get_string_parameter</a>(v, <span class="stringliteral">"PrintingMode"</span>), <span class="stringliteral">"BW"</span>) != 0 &amp;&amp;
01158       <a class="code" href="print-escp2_8c.html#a40">using_automatic_settings</a>(v, <a class="code" href="print-escp2_8h.html#a157a138">AUTO_MODE_MANUAL</a>))
01159     {
01160       <span class="keyword">const</span> <a class="code" href="structescp2__inkname__t.html">escp2_inkname_t</a> *ink_name = <a class="code" href="print-escp2_8c.html#a53">get_inktype</a>(v);
01161       <span class="keywordflow">if</span> (ink_name &amp;&amp;
01162           ink_name-&gt;<a class="code" href="structescp2__inkname__t.html#o3">channel_set</a>-&gt;<a class="code" href="structchannel__set__t.html#o2">channel_count</a> == 4 &amp;&amp;
01163           ink_name-&gt;<a class="code" href="structescp2__inkname__t.html#o3">channel_set</a>-&gt;<a class="code" href="structchannel__set__t.html#o1">channels</a>[color] &amp;&amp;
01164           ink_name-&gt;<a class="code" href="structescp2__inkname__t.html#o3">channel_set</a>-&gt;<a class="code" href="structchannel__set__t.html#o1">channels</a>[color]-&gt;<a class="code" href="structink__channel__t.html#o2">n_subchannels</a> == 2)
01165         <a class="code" href="print-escp2_8c.html#a56">fill_transition_parameters</a>(description);
01166     }
01167 }
01168 
01169 <span class="keyword">static</span> <span class="keyword">const</span> <a class="code" href="structres__t.html">res_t</a> *
<a name="l01170"></a><a class="code" href="print-escp2_8c.html#a60">01170</a> <a class="code" href="print-escp2_8c.html#a60">find_default_resolution</a>(<span class="keyword">const</span> <a class="code" href="structstp__vars.html">stp_vars_t</a> *v, <span class="keywordtype">int</span> desired_hres, <span class="keywordtype">int</span> desired_vres,
01171                         <span class="keywordtype">int</span> strict)
01172 {
01173   <span class="keyword">const</span> <a class="code" href="structres__t.html">res_t</a> *<span class="keyword">const</span> *res = escp2_reslist(v);
01174   <span class="keywordtype">int</span> i = 0;
01175   <span class="keywordflow">if</span> (desired_hres &lt; 0)
01176     {
01177       <span class="keywordflow">while</span> (res[i])
01178         i++;
01179       i--;
01180       <span class="keywordflow">while</span> (i &gt;= 0)
01181         {
01182           <span class="keywordflow">if</span> (<a class="code" href="print-escp2_8c.html#a49">verify_resolution</a>(v, res[i]) &amp;&amp;
01183               <a class="code" href="print-escp2_8c.html#a48">verify_resolution_by_paper_type</a>(v, res[i]))
01184             <span class="keywordflow">return</span> res[i];
01185           i--;
01186         }
01187     }
01188   i = 0;
01189   <span class="keywordflow">while</span> (res[i])
01190     {
01191       <span class="keywordflow">if</span> (<a class="code" href="print-escp2_8c.html#a49">verify_resolution</a>(v, res[i]) &amp;&amp;
01192           <a class="code" href="print-escp2_8c.html#a48">verify_resolution_by_paper_type</a>(v, res[i]) &amp;&amp;
01193           res[i]-&gt;<a class="code" href="structres__t.html#o3">vres</a> &gt;= desired_vres &amp;&amp; res[i]-&gt;<a class="code" href="structres__t.html#o2">hres</a> &gt;= desired_hres &amp;&amp;
01194           res[i]-&gt;vres &lt;= 2 * desired_vres &amp;&amp; res[i]-&gt;hres &lt;= 2 * desired_hres)
01195         <span class="keywordflow">return</span> res[i];
01196       i++;
01197     }
01198 <span class="preprocessor">#if 0</span>
01199 <span class="preprocessor"></span>  <span class="keywordflow">if</span> (!strict)                  <span class="comment">/* Try again to find a match */</span>
01200     {
01201       i = 0;
01202       <span class="keywordflow">while</span> (res[i])
01203         {
01204           <span class="keywordflow">if</span> (<a class="code" href="print-escp2_8c.html#a49">verify_resolution</a>(v, res[i]) &amp;&amp;
01205               res[i]-&gt;<a class="code" href="structres__t.html#o3">vres</a> &gt;= desired_vres &amp;&amp;
01206               res[i]-&gt;<a class="code" href="structres__t.html#o2">hres</a> &gt;= desired_hres &amp;&amp;
01207               res[i]-&gt;vres &lt;= 2 * desired_vres &amp;&amp;
01208               res[i]-&gt;hres &lt;= 2 * desired_hres)
01209             <span class="keywordflow">return</span> res[i];
01210           i++;
01211         }
01212     }    
01213 <span class="preprocessor">#endif</span>
01214 <span class="preprocessor"></span>  <span class="keywordflow">return</span> NULL;
01215 }
01216 
01217 <span class="keyword">static</span> <span class="keyword">const</span> <a class="code" href="structres__t.html">res_t</a> *
<a name="l01218"></a><a class="code" href="print-escp2_8c.html#a61">01218</a> <a class="code" href="print-escp2_8c.html#a61">find_resolution_from_quality</a>(<span class="keyword">const</span> <a class="code" href="structstp__vars.html">stp_vars_t</a> *v, <span class="keyword">const</span> <span class="keywordtype">char</span> *quality,
01219                              <span class="keywordtype">int</span> strict)
01220 {
01221   <span class="keywordtype">int</span> i;
01222   <span class="keyword">const</span> <a class="code" href="structquality__list__t.html">quality_list_t</a> *quals = escp2_quality_list(v);
01223   <span class="keywordflow">for</span> (i = 0; i &lt; quals-&gt;<a class="code" href="structquality__list__t.html#o1">n_quals</a>; i++)
01224     {
01225       <span class="keyword">const</span> <a class="code" href="structquality__t.html">quality_t</a> *q = &amp;(quals-&gt;<a class="code" href="structquality__list__t.html#o0">qualities</a>[i]);
01226       <span class="keywordflow">if</span> (strcmp(quality, q-&gt;<a class="code" href="structquality__t.html#o0">name</a>) == 0 &amp;&amp;
01227           (q-&gt;<a class="code" href="structquality__t.html#o3">min_vres</a> == 0 || escp2_min_vres(v) &lt;= q-&gt;<a class="code" href="structquality__t.html#o3">min_vres</a>) &amp;&amp;
01228           (q-&gt;<a class="code" href="structquality__t.html#o2">min_hres</a> == 0 || escp2_min_hres(v) &lt;= q-&gt;<a class="code" href="structquality__t.html#o2">min_hres</a>) &amp;&amp;
01229           (q-&gt;<a class="code" href="structquality__t.html#o5">max_vres</a> == 0 || escp2_max_vres(v) &gt;= q-&gt;<a class="code" href="structquality__t.html#o5">max_vres</a>) &amp;&amp;
01230           (q-&gt;<a class="code" href="structquality__t.html#o4">max_hres</a> == 0 || escp2_max_hres(v) &gt;= q-&gt;<a class="code" href="structquality__t.html#o4">max_hres</a>))
01231         {
01232           <span class="keywordflow">return</span> <a class="code" href="print-escp2_8c.html#a60">find_default_resolution</a>(v, q-&gt;<a class="code" href="structquality__t.html#o6">desired_hres</a>, q-&gt;<a class="code" href="structquality__t.html#o7">desired_vres</a>,
01233                                          strict);
01234         }
01235     }
01236   <span class="keywordflow">return</span> NULL;
01237 }
01238 
01239 <span class="keyword">static</span> <span class="keywordtype">void</span>
<a name="l01240"></a><a class="code" href="print-escp2_8c.html#a62">01240</a> <a class="code" href="print-escp2_8c.html#a62">escp2_parameters</a>(<span class="keyword">const</span> <a class="code" href="structstp__vars.html">stp_vars_t</a> *v, <span class="keyword">const</span> <span class="keywordtype">char</span> *name,
01241                  <a class="code" href="structstp__parameter__t.html">stp_parameter_t</a> *description)
01242 {
01243   <span class="keywordtype">int</span>           i;
01244   description-&gt;<a class="code" href="structstp__parameter__t.html#o4">p_type</a> = <a class="code" href="group__vars.html#gga132a16">STP_PARAMETER_TYPE_INVALID</a>;
01245   <span class="keywordflow">if</span> (name == NULL)
01246     <span class="keywordflow">return</span>;
01247 
01248   <span class="keywordflow">for</span> (i = 0; i &lt; <a class="code" href="print-escp2_8c.html#a21">float_parameter_count</a>; i++)
01249     <span class="keywordflow">if</span> (strcmp(name, <a class="code" href="print-escp2_8c.html#a20">float_parameters</a>[i].param.name) == 0)
01250       {
01251         <a class="code" href="group__vars.html#ga75">stp_fill_parameter_settings</a>(description,
01252                                      &amp;(<a class="code" href="print-escp2_8c.html#a20">float_parameters</a>[i].param));
01253         description-&gt;<a class="code" href="structstp__parameter__t.html#o26">deflt</a>.dbl = <a class="code" href="print-escp2_8c.html#a20">float_parameters</a>[i].<a class="code" href="structfloat__param__t.html#o3">defval</a>;
01254         description-&gt;<a class="code" href="structstp__parameter__t.html#o18">bounds</a>.dbl.upper = <a class="code" href="print-escp2_8c.html#a20">float_parameters</a>[i].<a class="code" href="structfloat__param__t.html#o2">max</a>;
01255         description-&gt;<a class="code" href="structstp__parameter__t.html#o18">bounds</a>.dbl.lower = <a class="code" href="print-escp2_8c.html#a20">float_parameters</a>[i].<a class="code" href="structfloat__param__t.html#o1">min</a>;
01256         <span class="keywordflow">break</span>;
01257       }
01258 
01259   <span class="keywordflow">for</span> (i = 0; i &lt; <a class="code" href="print-escp2_8c.html#a19">the_parameter_count</a>; i++)
01260     <span class="keywordflow">if</span> (strcmp(name, <a class="code" href="print-escp2_8c.html#a18">the_parameters</a>[i].name) == 0)
01261       {
01262         <a class="code" href="group__vars.html#ga75">stp_fill_parameter_settings</a>(description, &amp;(<a class="code" href="print-escp2_8c.html#a18">the_parameters</a>[i]));
01263         <span class="keywordflow">break</span>;
01264       }
01265 
01266   description-&gt;<a class="code" href="structstp__parameter__t.html#o26">deflt</a>.str = NULL;
01267   <span class="keywordflow">if</span> (strcmp(name, <span class="stringliteral">"AutoMode"</span>) == 0)
01268     {
01269       description-&gt;<a class="code" href="structstp__parameter__t.html#o18">bounds</a>.str = <a class="code" href="string-list_8h.html#a1">stp_string_list_create</a>();
01270       <a class="code" href="string-list_8c.html#a11">stp_string_list_add_string</a>(description-&gt;<a class="code" href="structstp__parameter__t.html#o18">bounds</a>.str, <span class="stringliteral">"None"</span>,
01271                                  <a class="code" href="group__intl__internal.html#ga5">_</a>(<span class="stringliteral">"Full Manual Control"</span>));
01272       <a class="code" href="string-list_8c.html#a11">stp_string_list_add_string</a>(description-&gt;<a class="code" href="structstp__parameter__t.html#o18">bounds</a>.str, <span class="stringliteral">"Auto"</span>,
01273                                  <a class="code" href="group__intl__internal.html#ga5">_</a>(<span class="stringliteral">"Automatic Setting Control"</span>));
01274       description-&gt;<a class="code" href="structstp__parameter__t.html#o26">deflt</a>.str = <span class="stringliteral">"None"</span>; <span class="comment">/* so CUPS and Foomatic don't break */</span>
01275     }      
01276   <span class="keywordflow">else</span> <span class="keywordflow">if</span> (strcmp(name, <span class="stringliteral">"PageSize"</span>) == 0)
01277     {
01278       <span class="keywordtype">int</span> papersizes = <a class="code" href="group__papersize.html#ga0">stp_known_papersizes</a>();
01279       <span class="keyword">const</span> <a class="code" href="structinput__slot__t.html">input_slot_t</a> *slot = <a class="code" href="print-escp2_8c.html#a44">get_input_slot</a>(v);
01280       description-&gt;<a class="code" href="structstp__parameter__t.html#o18">bounds</a>.str = <a class="code" href="string-list_8h.html#a1">stp_string_list_create</a>();
01281       <span class="keywordflow">if</span> (slot &amp;&amp; slot-&gt;<a class="code" href="structinput__slot__t.html#o2">is_cd</a>)
01282         {
01283           <a class="code" href="string-list_8h.html#a7">stp_string_list_add_string</a>
01284             (description-&gt;<a class="code" href="structstp__parameter__t.html#o18">bounds</a>.str, <span class="stringliteral">"CD5Inch"</span>, <a class="code" href="group__intl__internal.html#ga5">_</a>(<span class="stringliteral">"CD - 5 inch"</span>));
01285           <a class="code" href="string-list_8h.html#a7">stp_string_list_add_string</a>
01286             (description-&gt;<a class="code" href="structstp__parameter__t.html#o18">bounds</a>.str, <span class="stringliteral">"CD3Inch"</span>, <a class="code" href="group__intl__internal.html#ga5">_</a>(<span class="stringliteral">"CD - 3 inch"</span>));
01287         }         
01288       <span class="keywordflow">else</span>
01289         {
01290           <span class="keywordflow">for</span> (i = 0; i &lt; papersizes; i++)
01291             {
01292               <span class="keyword">const</span> <a class="code" href="structstp__papersize__t.html">stp_papersize_t</a> *pt = <a class="code" href="group__papersize.html#ga10">stp_get_papersize_by_index</a>(i);
01293               <span class="keywordflow">if</span> (<a class="code" href="print-escp2_8c.html#a50">verify_papersize</a>(v, pt))
01294                 <a class="code" href="string-list_8c.html#a11">stp_string_list_add_string</a>(description-&gt;<a class="code" href="structstp__parameter__t.html#o18">bounds</a>.str,
01295                                            pt-&gt;<a class="code" href="structstp__papersize__t.html#o0">name</a>, pt-&gt;<a class="code" href="structstp__papersize__t.html#o1">text</a>);
01296             }
01297         }
01298       description-&gt;<a class="code" href="structstp__parameter__t.html#o26">deflt</a>.str =
01299         <a class="code" href="string-list_8c.html#a6">stp_string_list_param</a>(description-&gt;<a class="code" href="structstp__parameter__t.html#o18">bounds</a>.str, 0)-&gt;<a class="code" href="structstp__param__string__t.html#o0">name</a>;
01300     }
01301   <span class="keywordflow">else</span> <span class="keywordflow">if</span> (strcmp(name, <span class="stringliteral">"CDInnerRadius"</span>) == 0)
01302     {
01303       <span class="keyword">const</span> <a class="code" href="structinput__slot__t.html">input_slot_t</a> *slot = <a class="code" href="print-escp2_8c.html#a44">get_input_slot</a>(v);
01304       description-&gt;<a class="code" href="structstp__parameter__t.html#o18">bounds</a>.str = <a class="code" href="string-list_8h.html#a1">stp_string_list_create</a>();
01305       <span class="keywordflow">if</span> (<a class="code" href="print-escp2_8c.html#a29">escp2_has_cap</a>(v, <a class="code" href="print-escp2_8h.html#a158a149">MODEL_PRINT_TO_CD</a>, <a class="code" href="print-escp2_8h.html#a51">MODEL_PRINT_TO_CD_YES</a>) &amp;&amp;
01306           (!slot || (slot &amp;&amp; slot-&gt;<a class="code" href="structinput__slot__t.html#o2">is_cd</a>)))
01307         {
01308           <a class="code" href="string-list_8h.html#a7">stp_string_list_add_string</a>
01309             (description-&gt;<a class="code" href="structstp__parameter__t.html#o18">bounds</a>.str, <span class="stringliteral">"None"</span>, <a class="code" href="group__intl__internal.html#ga5">_</a>(<span class="stringliteral">"Normal"</span>));
01310           <a class="code" href="string-list_8h.html#a7">stp_string_list_add_string</a>
01311             (description-&gt;<a class="code" href="structstp__parameter__t.html#o18">bounds</a>.str, <span class="stringliteral">"Small"</span>, <a class="code" href="group__intl__internal.html#ga5">_</a>(<span class="stringliteral">"Print To Hub"</span>));
01312           description-&gt;<a class="code" href="structstp__parameter__t.html#o26">deflt</a>.str =
01313             <a class="code" href="string-list_8c.html#a6">stp_string_list_param</a>(description-&gt;<a class="code" href="structstp__parameter__t.html#o18">bounds</a>.str, 0)-&gt;<a class="code" href="structstp__param__string__t.html#o0">name</a>;
01314         }         
01315       <span class="keywordflow">else</span>
01316         description-&gt;<a class="code" href="structstp__parameter__t.html#o8">is_active</a> = 0;
01317     }
01318   <span class="keywordflow">else</span> <span class="keywordflow">if</span> (strcmp(name, <span class="stringliteral">"CDXAdjustment"</span>) == 0 ||
01319            strcmp(name, <span class="stringliteral">"CDYAdjustment"</span>) == 0)
01320     {
01321       <span class="keyword">const</span> <a class="code" href="structinput__slot__t.html">input_slot_t</a> *slot = <a class="code" href="print-escp2_8c.html#a44">get_input_slot</a>(v);
01322       <span class="keywordflow">if</span> (<a class="code" href="print-escp2_8c.html#a29">escp2_has_cap</a>(v, <a class="code" href="print-escp2_8h.html#a158a149">MODEL_PRINT_TO_CD</a>, <a class="code" href="print-escp2_8h.html#a51">MODEL_PRINT_TO_CD_YES</a>) &amp;&amp;
01323           (!slot || (slot &amp;&amp; slot-&gt;<a class="code" href="structinput__slot__t.html#o2">is_cd</a>)))
01324         {
01325           description-&gt;<a class="code" href="structstp__parameter__t.html#o18">bounds</a>.dimension.lower = -15;
01326           description-&gt;<a class="code" href="structstp__parameter__t.html#o18">bounds</a>.dimension.upper = 15;
01327           description-&gt;<a class="code" href="structstp__parameter__t.html#o26">deflt</a>.dimension = 0;
01328         }         
01329       <span class="keywordflow">else</span>
01330         description-&gt;<a class="code" href="structstp__parameter__t.html#o8">is_active</a> = 0;
01331     }
01332   <span class="keywordflow">else</span> <span class="keywordflow">if</span> (strcmp(name, <span class="stringliteral">"Quality"</span>) == 0)
01333     {
01334       <span class="keyword">const</span> <a class="code" href="structquality__list__t.html">quality_list_t</a> *quals = escp2_quality_list(v);
01335       <span class="keywordtype">int</span> has_standard_quality = 0;
01336       description-&gt;<a class="code" href="structstp__parameter__t.html#o18">bounds</a>.str = <a class="code" href="string-list_8h.html#a1">stp_string_list_create</a>();
01337       <a class="code" href="string-list_8c.html#a11">stp_string_list_add_string</a>(description-&gt;<a class="code" href="structstp__parameter__t.html#o18">bounds</a>.str, <span class="stringliteral">"None"</span>,
01338                                  <a class="code" href="group__intl__internal.html#ga5">_</a>(<span class="stringliteral">"Manual Control"</span>));
01339       <span class="keywordflow">for</span> (i = 0; i &lt; quals-&gt;<a class="code" href="structquality__list__t.html#o1">n_quals</a>; i++)
01340         {
01341           <span class="keyword">const</span> <a class="code" href="structquality__t.html">quality_t</a> *q = &amp;(quals-&gt;<a class="code" href="structquality__list__t.html#o0">qualities</a>[i]);
01342           <span class="keywordflow">if</span> (((q-&gt;<a class="code" href="structquality__t.html#o3">min_vres</a> == 0 || escp2_min_vres(v) &lt;= q-&gt;<a class="code" href="structquality__t.html#o3">min_vres</a>) &amp;&amp;
01343                (q-&gt;<a class="code" href="structquality__t.html#o2">min_hres</a> == 0 || escp2_min_hres(v) &lt;= q-&gt;<a class="code" href="structquality__t.html#o2">min_hres</a>) &amp;&amp;
01344                (q-&gt;<a class="code" href="structquality__t.html#o5">max_vres</a> == 0 || escp2_max_vres(v) &gt;= q-&gt;<a class="code" href="structquality__t.html#o5">max_vres</a>) &amp;&amp;
01345                (q-&gt;<a class="code" href="structquality__t.html#o4">max_hres</a> == 0 || escp2_max_hres(v) &gt;= q-&gt;<a class="code" href="structquality__t.html#o4">max_hres</a>)) &amp;&amp;
01346               (<a class="code" href="print-escp2_8c.html#a61">find_resolution_from_quality</a>(v, q-&gt;<a class="code" href="structquality__t.html#o0">name</a>, 1) ||
01347                (!<a class="code" href="group__vars.html#ga100">stp_check_string_parameter</a>(v, <span class="stringliteral">"MediaType"</span>,
01348                                             <a class="code" href="group__vars.html#gga135a32">STP_PARAMETER_ACTIVE</a>))))
01349             <a class="code" href="string-list_8c.html#a11">stp_string_list_add_string</a>(description-&gt;<a class="code" href="structstp__parameter__t.html#o18">bounds</a>.str, q-&gt;<a class="code" href="structquality__t.html#o0">name</a>,
01350                                        q-&gt;<a class="code" href="structquality__t.html#o1">text</a>);
01351           <span class="keywordflow">if</span> (strcmp(q-&gt;<a class="code" href="structquality__t.html#o0">name</a>, <span class="stringliteral">"Standard"</span>) == 0)
01352             has_standard_quality = 1;
01353         }
01354       <span class="keywordflow">if</span> (has_standard_quality)
01355         description-&gt;<a class="code" href="structstp__parameter__t.html#o26">deflt</a>.str = <span class="stringliteral">"Standard"</span>;
01356       <span class="keywordflow">else</span>
01357         description-&gt;<a class="code" href="structstp__parameter__t.html#o26">deflt</a>.str = <span class="stringliteral">"None"</span>;
01358     }
01359   <span class="keywordflow">else</span> <span class="keywordflow">if</span> (strcmp(name, <span class="stringliteral">"Resolution"</span>) == 0)
01360     {
01361       <span class="keyword">const</span> <a class="code" href="structres__t.html">res_t</a> *<span class="keyword">const</span> *res = escp2_reslist(v);
01362       <span class="keyword">const</span> <a class="code" href="structres__t.html">res_t</a> *defval = <a class="code" href="print-escp2_8c.html#a60">find_default_resolution</a>(v, 720, 360, 0);
01363       description-&gt;<a class="code" href="structstp__parameter__t.html#o18">bounds</a>.str = <a class="code" href="string-list_8h.html#a1">stp_string_list_create</a>();
01364       i = 0;
01365       <span class="keywordflow">while</span> (res[i])
01366         {
01367           <span class="keywordflow">if</span> (<a class="code" href="print-escp2_8c.html#a49">verify_resolution</a>(v, res[i]) &amp;&amp;
01368               (<a class="code" href="print-escp2_8c.html#a40">using_automatic_settings</a>(v, <a class="code" href="print-escp2_8h.html#a157a138">AUTO_MODE_MANUAL</a>) ||
01369                !<a class="code" href="group__vars.html#ga100">stp_check_string_parameter</a>(v, <span class="stringliteral">"MediaType"</span>,
01370                                            <a class="code" href="group__vars.html#gga135a32">STP_PARAMETER_ACTIVE</a>) ||
01371                <a class="code" href="print-escp2_8c.html#a48">verify_resolution_by_paper_type</a>(v, res[i])))
01372             <a class="code" href="string-list_8c.html#a11">stp_string_list_add_string</a>(description-&gt;<a class="code" href="structstp__parameter__t.html#o18">bounds</a>.str,
01373                                        res[i]-&gt;<a class="code" href="structres__t.html#o0">name</a>, <a class="code" href="group__intl__internal.html#ga5">_</a>(res[i]-&gt;text));
01374           i++;
01375         }
01376       <span class="keywordflow">if</span> (defval)
01377         description-&gt;<a class="code" href="structstp__parameter__t.html#o26">deflt</a>.str = defval-&gt;<a class="code" href="structres__t.html#o0">name</a>;
01378       <span class="keywordflow">else</span>
01379         description-&gt;<a class="code" href="structstp__parameter__t.html#o26">deflt</a>.str = res[0]-&gt;<a class="code" href="structres__t.html#o0">name</a>;
01380       <span class="keywordflow">if</span> (!<a class="code" href="print-escp2_8c.html#a40">using_automatic_settings</a>(v, <a class="code" href="print-escp2_8h.html#a157a138">AUTO_MODE_MANUAL</a>))
01381         description-&gt;<a class="code" href="structstp__parameter__t.html#o8">is_active</a> = 0;
01382     }
01383   <span class="keywordflow">else</span> <span class="keywordflow">if</span> (strcmp(name, <span class="stringliteral">"InkType"</span>) == 0)
01384     {
01385       <span class="keyword">const</span> <a class="code" href="structinklist__t.html">inklist_t</a> *inks = <a class="code" href="print-escp2_8c.html#a37">escp2_inklist</a>(v);
01386       <span class="keywordtype">int</span> ninktypes = inks-&gt;<a class="code" href="structinklist__t.html#o6">n_inks</a>;
01387       description-&gt;<a class="code" href="structstp__parameter__t.html#o18">bounds</a>.str = <a class="code" href="string-list_8h.html#a1">stp_string_list_create</a>();
01388       <span class="keywordflow">if</span> (ninktypes &gt; 1)
01389         {
01390           <a class="code" href="string-list_8c.html#a11">stp_string_list_add_string</a>(description-&gt;<a class="code" href="structstp__parameter__t.html#o18">bounds</a>.str, <span class="stringliteral">"None"</span>,
01391                                      <a class="code" href="group__intl__internal.html#ga5">_</a>(<span class="stringliteral">"Standard"</span>));
01392           <span class="keywordflow">for</span> (i = 0; i &lt; ninktypes; i++)
01393             <span class="keywordflow">if</span> (<a class="code" href="print-escp2_8c.html#a51">verify_inktype</a>(v, inks-&gt;<a class="code" href="structinklist__t.html#o2">inknames</a>[i]))
01394               <a class="code" href="string-list_8c.html#a11">stp_string_list_add_string</a>(description-&gt;<a class="code" href="structstp__parameter__t.html#o18">bounds</a>.str,
01395                                          inks-&gt;<a class="code" href="structinklist__t.html#o2">inknames</a>[i]-&gt;<a class="code" href="structescp2__inkname__t.html#o0">name</a>,
01396                                          <a class="code" href="group__intl__internal.html#ga5">_</a>(inks-&gt;<a class="code" href="structinklist__t.html#o2">inknames</a>[i]-&gt;<a class="code" href="structescp2__inkname__t.html#o1">text</a>));
01397           description-&gt;<a class="code" href="structstp__parameter__t.html#o26">deflt</a>.str = <span class="stringliteral">"None"</span>;
01398         }
01399       <span class="keywordflow">if</span> (ninktypes &lt;= 1 || !<a class="code" href="print-escp2_8c.html#a40">using_automatic_settings</a>(v, <a class="code" href="print-escp2_8h.html#a157a138">AUTO_MODE_MANUAL</a>))
01400         description-&gt;<a class="code" href="structstp__parameter__t.html#o8">is_active</a> = 0;
01401     }
01402   <span class="keywordflow">else</span> <span class="keywordflow">if</span> (strcmp(name, <span class="stringliteral">"InkSet"</span>) == 0)
01403     {
01404       <span class="keyword">const</span> <a class="code" href="structinkgroup__t.html">inkgroup_t</a> *inks = escp2_inkgroup(v);
01405       <span class="keywordtype">int</span> ninklists = inks-&gt;<a class="code" href="structinkgroup__t.html#o2">n_inklists</a>;
01406       description-&gt;<a class="code" href="structstp__parameter__t.html#o18">bounds</a>.str = <a class="code" href="string-list_8h.html#a1">stp_string_list_create</a>();
01407       <span class="keywordflow">if</span> (ninklists &gt; 1)
01408         {
01409           <span class="keywordtype">int</span> has_default_choice = 0;
01410           <span class="keywordflow">for</span> (i = 0; i &lt; ninklists; i++)
01411             {
01412               <a class="code" href="string-list_8c.html#a11">stp_string_list_add_string</a>(description-&gt;<a class="code" href="structstp__parameter__t.html#o18">bounds</a>.str,
01413                                          inks-&gt;<a class="code" href="structinkgroup__t.html#o1">inklists</a>[i]-&gt;<a class="code" href="structinklist__t.html#o0">name</a>,
01414                                          <a class="code" href="group__intl__internal.html#ga5">_</a>(inks-&gt;<a class="code" href="structinkgroup__t.html#o1">inklists</a>[i]-&gt;<a class="code" href="structinklist__t.html#o1">text</a>));
01415               <span class="keywordflow">if</span> (strcmp(inks-&gt;<a class="code" href="structinkgroup__t.html#o1">inklists</a>[i]-&gt;<a class="code" href="structinklist__t.html#o0">name</a>, <span class="stringliteral">"None"</span>) == 0)
01416                 has_default_choice = 1;
01417             }
01418           description-&gt;<a class="code" href="structstp__parameter__t.html#o26">deflt</a>.str =
01419             <a class="code" href="string-list_8c.html#a6">stp_string_list_param</a>(description-&gt;<a class="code" href="structstp__parameter__t.html#o18">bounds</a>.str, 0)-&gt;<a class="code" href="structstp__param__string__t.html#o0">name</a>;
01420           <span class="keywordflow">if</span> (!<a class="code" href="print-escp2_8c.html#a40">using_automatic_settings</a>(v, <a class="code" href="print-escp2_8h.html#a157a138">AUTO_MODE_MANUAL</a>) &amp;&amp;
01421               has_default_choice)
01422             description-&gt;<a class="code" href="structstp__parameter__t.html#o8">is_active</a> = 0;
01423         }
01424       <span class="keywordflow">else</span>
01425         description-&gt;<a class="code" href="structstp__parameter__t.html#o8">is_active</a> = 0;
01426     }
01427   <span class="keywordflow">else</span> <span class="keywordflow">if</span> (strcmp(name, <span class="stringliteral">"MediaType"</span>) == 0)
01428     {
01429       <span class="keyword">const</span> <a class="code" href="structpaperlist__t.html">paperlist_t</a> *p = <a class="code" href="print-escp2_8c.html#a39">escp2_paperlist</a>(v);
01430       <span class="keywordtype">int</span> nmediatypes = p-&gt;<a class="code" href="structpaperlist__t.html#o1">paper_count</a>;
01431       description-&gt;<a class="code" href="structstp__parameter__t.html#o18">bounds</a>.str = <a class="code" href="string-list_8h.html#a1">stp_string_list_create</a>();
01432       <span class="keywordflow">if</span> (nmediatypes)
01433         {
01434           <span class="keywordflow">for</span> (i = 0; i &lt; nmediatypes; i++)
01435             <a class="code" href="string-list_8c.html#a11">stp_string_list_add_string</a>(description-&gt;<a class="code" href="structstp__parameter__t.html#o18">bounds</a>.str,
01436                                        p-&gt;<a class="code" href="structpaperlist__t.html#o2">papers</a>[i].<a class="code" href="structpaper__t.html#o0">name</a>,
01437                                        <a class="code" href="group__intl__internal.html#ga5">_</a>(p-&gt;<a class="code" href="structpaperlist__t.html#o2">papers</a>[i].<a class="code" href="structpaper__t.html#o1">text</a>));
01438           description-&gt;<a class="code" href="structstp__parameter__t.html#o26">deflt</a>.str =
01439             <a class="code" href="string-list_8c.html#a6">stp_string_list_param</a>(description-&gt;<a class="code" href="structstp__parameter__t.html#o18">bounds</a>.str, 0)-&gt;<a class="code" href="structstp__param__string__t.html#o0">name</a>;
01440         }
01441       <span class="keywordflow">else</span>
01442         description-&gt;<a class="code" href="structstp__parameter__t.html#o8">is_active</a> = 0;
01443     }
01444   <span class="keywordflow">else</span> <span class="keywordflow">if</span> (strcmp(name, <span class="stringliteral">"InputSlot"</span>) == 0)
01445     {
01446       <span class="keyword">const</span> <a class="code" href="structinput__slot__list__t.html">input_slot_list_t</a> *slots = escp2_input_slots(v);
01447       <span class="keywordtype">int</span> ninputslots = slots-&gt;<a class="code" href="structinput__slot__list__t.html#o1">n_input_slots</a>;
01448       description-&gt;<a class="code" href="structstp__parameter__t.html#o18">bounds</a>.str = <a class="code" href="string-list_8h.html#a1">stp_string_list_create</a>();
01449       <span class="keywordflow">if</span> (ninputslots)
01450         {
01451           <span class="keywordflow">for</span> (i = 0; i &lt; ninputslots; i++)
01452             <a class="code" href="string-list_8c.html#a11">stp_string_list_add_string</a>(description-&gt;<a class="code" href="structstp__parameter__t.html#o18">bounds</a>.str,
01453                                        slots-&gt;<a class="code" href="structinput__slot__list__t.html#o0">slots</a>[i].<a class="code" href="structinput__slot__t.html#o0">name</a>,
01454                                        <a class="code" href="group__intl__internal.html#ga5">_</a>(slots-&gt;<a class="code" href="structinput__slot__list__t.html#o0">slots</a>[i].<a class="code" href="structinput__slot__t.html#o1">text</a>));
01455           description-&gt;<a class="code" href="structstp__parameter__t.html#o26">deflt</a>.str =
01456             <a class="code" href="string-list_8c.html#a6">stp_string_list_param</a>(description-&gt;<a class="code" href="structstp__parameter__t.html#o18">bounds</a>.str, 0)-&gt;<a class="code" href="structstp__param__string__t.html#o0">name</a>;
01457         }
01458       <span class="keywordflow">else</span>
01459         description-&gt;<a class="code" href="structstp__parameter__t.html#o8">is_active</a> = 0;
01460     }
01461   <span class="keywordflow">else</span> <span class="keywordflow">if</span> (strcmp(name, <span class="stringliteral">"PrintingDirection"</span>) == 0)
01462     {
01463       description-&gt;<a class="code" href="structstp__parameter__t.html#o18">bounds</a>.str = <a class="code" href="string-list_8h.html#a1">stp_string_list_create</a>();
01464       <a class="code" href="string-list_8h.html#a7">stp_string_list_add_string</a>
01465         (description-&gt;<a class="code" href="structstp__parameter__t.html#o18">bounds</a>.str, <span class="stringliteral">"None"</span>, <a class="code" href="group__intl__internal.html#ga5">_</a>(<span class="stringliteral">"Automatic"</span>));
01466       <a class="code" href="string-list_8h.html#a7">stp_string_list_add_string</a>
01467         (description-&gt;<a class="code" href="structstp__parameter__t.html#o18">bounds</a>.str, <span class="stringliteral">"Bidirectional"</span>, <a class="code" href="group__intl__internal.html#ga5">_</a>(<span class="stringliteral">"Bidirectional"</span>));
01468       <a class="code" href="string-list_8h.html#a7">stp_string_list_add_string</a>
01469         (description-&gt;<a class="code" href="structstp__parameter__t.html#o18">bounds</a>.str, <span class="stringliteral">"Unidirectional"</span>, <a class="code" href="group__intl__internal.html#ga5">_</a>(<span class="stringliteral">"Unidirectional"</span>));
01470       description-&gt;<a class="code" href="structstp__parameter__t.html#o26">deflt</a>.str =
01471         <a class="code" href="string-list_8c.html#a6">stp_string_list_param</a>(description-&gt;<a class="code" href="structstp__parameter__t.html#o18">bounds</a>.str, 0)-&gt;<a class="code" href="structstp__param__string__t.html#o0">name</a>;
01472       <span class="keywordflow">if</span> (!<a class="code" href="print-escp2_8c.html#a40">using_automatic_settings</a>(v, <a class="code" href="print-escp2_8h.html#a157a138">AUTO_MODE_MANUAL</a>))
01473         description-&gt;<a class="code" href="structstp__parameter__t.html#o8">is_active</a> = 0;
01474     }
01475   <span class="keywordflow">else</span> <span class="keywordflow">if</span> (strcmp(name, <span class="stringliteral">"Weave"</span>) == 0)
01476     {
01477       description-&gt;<a class="code" href="structstp__parameter__t.html#o18">bounds</a>.str = <a class="code" href="string-list_8h.html#a1">stp_string_list_create</a>();
01478       <span class="keywordflow">if</span> (<a class="code" href="print-escp2_8c.html#a29">escp2_has_cap</a>(v, <a class="code" href="print-escp2_8h.html#a158a139">MODEL_COMMAND</a>, <a class="code" href="print-escp2_8h.html#a21">MODEL_COMMAND_PRO</a>))
01479         {
01480           <span class="keyword">const</span> <a class="code" href="structres__t.html">res_t</a> *res = <a class="code" href="print-escp2_8c.html#a26">escp2_find_resolution</a>(v);
01481           <span class="keyword">const</span> <a class="code" href="structprinter__weave__list__t.html">printer_weave_list_t</a> *printer_weaves = escp2_printer_weaves(v);
01482           <span class="keywordtype">int</span> nprinter_weaves = 0;
01483           <span class="keywordflow">if</span> (<a class="code" href="print-escp2_8c.html#a46">use_printer_weave</a>(v) &amp;&amp; (!res || res-&gt;<a class="code" href="structres__t.html#o7">printer_weave</a>))
01484             nprinter_weaves = printer_weaves-&gt;<a class="code" href="structprinter__weave__list__t.html#o1">n_printer_weaves</a>;
01485           <span class="keywordflow">if</span> (nprinter_weaves)
01486             {
01487               <a class="code" href="string-list_8c.html#a11">stp_string_list_add_string</a>(description-&gt;<a class="code" href="structstp__parameter__t.html#o18">bounds</a>.str, <span class="stringliteral">"None"</span>,
01488                                          <a class="code" href="group__intl__internal.html#ga5">_</a>(<span class="stringliteral">"Standard"</span>));
01489               <span class="keywordflow">for</span> (i = 0; i &lt; nprinter_weaves; i++)
01490                 <a class="code" href="string-list_8c.html#a11">stp_string_list_add_string</a>(description-&gt;<a class="code" href="structstp__parameter__t.html#o18">bounds</a>.str,
01491                                            printer_weaves-&gt;<a class="code" href="structprinter__weave__list__t.html#o2">printer_weaves</a>[i].<a class="code" href="structprinter__weave__t.html#o0">name</a>,
01492                                            <a class="code" href="group__intl__internal.html#ga5">_</a>(printer_weaves-&gt;<a class="code" href="structprinter__weave__list__t.html#o2">printer_weaves</a>[i].<a class="code" href="structprinter__weave__t.html#o1">text</a>));
01493             }
01494           <span class="keywordflow">else</span>
01495             description-&gt;<a class="code" href="structstp__parameter__t.html#o8">is_active</a> = 0;
01496         }
01497       <span class="keywordflow">else</span>
01498         {
01499           <a class="code" href="string-list_8h.html#a7">stp_string_list_add_string</a>
01500             (description-&gt;<a class="code" href="structstp__parameter__t.html#o18">bounds</a>.str, <span class="stringliteral">"None"</span>, <a class="code" href="group__intl__internal.html#ga5">_</a>(<span class="stringliteral">"Standard"</span>));
01501           <a class="code" href="string-list_8h.html#a7">stp_string_list_add_string</a>
01502             (description-&gt;<a class="code" href="structstp__parameter__t.html#o18">bounds</a>.str, <span class="stringliteral">"Alternate"</span>, <a class="code" href="group__intl__internal.html#ga5">_</a>(<span class="stringliteral">"Alternate Fill"</span>));
01503           <a class="code" href="string-list_8h.html#a7">stp_string_list_add_string</a>
01504             (description-&gt;<a class="code" href="structstp__parameter__t.html#o18">bounds</a>.str, <span class="stringliteral">"Ascending"</span>, <a class="code" href="group__intl__internal.html#ga5">_</a>(<span class="stringliteral">"Ascending Fill"</span>));
01505           <a class="code" href="string-list_8h.html#a7">stp_string_list_add_string</a>
01506             (description-&gt;<a class="code" href="structstp__parameter__t.html#o18">bounds</a>.str, <span class="stringliteral">"Descending"</span>, <a class="code" href="group__intl__internal.html#ga5">_</a>(<span class="stringliteral">"Descending Fill"</span>));
01507           <a class="code" href="string-list_8h.html#a7">stp_string_list_add_string</a>
01508             (description-&gt;<a class="code" href="structstp__parameter__t.html#o18">bounds</a>.str, <span class="stringliteral">"Ascending2X"</span>, <a class="code" href="group__intl__internal.html#ga5">_</a>(<span class="stringliteral">"Ascending Double"</span>));
01509           <a class="code" href="string-list_8h.html#a7">stp_string_list_add_string</a>
01510             (description-&gt;<a class="code" href="structstp__parameter__t.html#o18">bounds</a>.str, <span class="stringliteral">"Staggered"</span>, <a class="code" href="group__intl__internal.html#ga5">_</a>(<span class="stringliteral">"Nearest Neighbor Avoidance"</span>));
01511         }
01512       <span class="keywordflow">if</span> (description-&gt;<a class="code" href="structstp__parameter__t.html#o8">is_active</a>)
01513         description-&gt;<a class="code" href="structstp__parameter__t.html#o26">deflt</a>.str =
01514           <a class="code" href="string-list_8c.html#a6">stp_string_list_param</a>(description-&gt;<a class="code" href="structstp__parameter__t.html#o18">bounds</a>.str, 0)-&gt;<a class="code" href="structstp__param__string__t.html#o0">name</a>;
01515       <span class="keywordflow">if</span> (!<a class="code" href="print-escp2_8c.html#a40">using_automatic_settings</a>(v, <a class="code" href="print-escp2_8h.html#a157a138">AUTO_MODE_MANUAL</a>))
01516         description-&gt;<a class="code" href="structstp__parameter__t.html#o8">is_active</a> = 0;
01517     }
01518   <span class="keywordflow">else</span> <span class="keywordflow">if</span> (strcmp(name, <span class="stringliteral">"OutputOrder"</span>) == 0)
01519     {
01520       description-&gt;<a class="code" href="structstp__parameter__t.html#o18">bounds</a>.str = <a class="code" href="string-list_8h.html#a1">stp_string_list_create</a>();
01521       description-&gt;<a class="code" href="structstp__parameter__t.html#o26">deflt</a>.str = <span class="stringliteral">"Reverse"</span>;
01522     }
01523   <span class="keywordflow">else</span> <span class="keywordflow">if</span> (strcmp(name, <span class="stringliteral">"FullBleed"</span>) == 0)
01524     {
01525       <span class="keyword">const</span> <a class="code" href="structinput__slot__t.html">input_slot_t</a> *slot = <a class="code" href="print-escp2_8c.html#a44">get_input_slot</a>(v);
01526       <span class="keywordflow">if</span> (slot &amp;&amp; slot-&gt;<a class="code" href="structinput__slot__t.html#o2">is_cd</a>)
01527         description-&gt;<a class="code" href="structstp__parameter__t.html#o8">is_active</a> = 0;
01528       <span class="keywordflow">else</span> <span class="keywordflow">if</span> (<a class="code" href="print-escp2_8c.html#a29">escp2_has_cap</a>(v, <a class="code" href="print-escp2_8h.html#a158a140">MODEL_XZEROMARGIN</a>, <a class="code" href="print-escp2_8h.html#a24">MODEL_XZEROMARGIN_YES</a>))
01529         description-&gt;<a class="code" href="structstp__parameter__t.html#o26">deflt</a>.boolean = 0;
01530       <span class="keywordflow">else</span>
01531         description-&gt;<a class="code" href="structstp__parameter__t.html#o8">is_active</a> = 0;
01532     }
01533   <span class="keywordflow">else</span> <span class="keywordflow">if</span> (strcmp(name, <span class="stringliteral">"AdjustDotsize"</span>) == 0)
01534     {
01535       description-&gt;<a class="code" href="structstp__parameter__t.html#o26">deflt</a>.boolean = 0;
01536       <span class="keywordflow">if</span> (!<a class="code" href="print-escp2_8c.html#a40">using_automatic_settings</a>(v, <a class="code" href="print-escp2_8h.html#a157a138">AUTO_MODE_MANUAL</a>))
01537         description-&gt;<a class="code" href="structstp__parameter__t.html#o8">is_active</a> = 0;
01538     }
01539   <span class="keywordflow">else</span> <span class="keywordflow">if</span> (strcmp(name, <span class="stringliteral">"CyanDensity"</span>) == 0)
01540     <a class="code" href="print-escp2_8c.html#a57">set_density_parameter</a>(v, description, <a class="code" href="dither_8h.html#a1">STP_ECOLOR_C</a>);
01541   <span class="keywordflow">else</span> <span class="keywordflow">if</span> (strcmp(name, <span class="stringliteral">"MagentaDensity"</span>) == 0)
01542     <a class="code" href="print-escp2_8c.html#a57">set_density_parameter</a>(v, description, <a class="code" href="dither_8h.html#a2">STP_ECOLOR_M</a>);
01543   <span class="keywordflow">else</span> <span class="keywordflow">if</span> (strcmp(name, <span class="stringliteral">"YellowDensity"</span>) == 0)
01544     <a class="code" href="print-escp2_8c.html#a57">set_density_parameter</a>(v, description, <a class="code" href="dither_8h.html#a3">STP_ECOLOR_Y</a>);
01545   <span class="keywordflow">else</span> <span class="keywordflow">if</span> (strcmp(name, <span class="stringliteral">"BlackDensity"</span>) == 0)
01546     <a class="code" href="print-escp2_8c.html#a57">set_density_parameter</a>(v, description, <a class="code" href="dither_8h.html#a0">STP_ECOLOR_K</a>);
01547   <span class="keywordflow">else</span> <span class="keywordflow">if</span> (strcmp(name, <span class="stringliteral">"RedDensity"</span>) == 0)
01548     <a class="code" href="print-escp2_8c.html#a57">set_density_parameter</a>(v, description, <a class="code" href="print-escp2_8h.html#a2">XCOLOR_R</a>);
01549   <span class="keywordflow">else</span> <span class="keywordflow">if</span> (strcmp(name, <span class="stringliteral">"BlueDensity"</span>) == 0)
01550     <a class="code" href="print-escp2_8c.html#a57">set_density_parameter</a>(v, description, <a class="code" href="print-escp2_8h.html#a3">XCOLOR_B</a>);
01551   <span class="keywordflow">else</span> <span class="keywordflow">if</span> (strcmp(name, <span class="stringliteral">"GlossDensity"</span>) == 0)
01552     <a class="code" href="print-escp2_8c.html#a57">set_density_parameter</a>(v, description, <a class="code" href="print-escp2_8h.html#a4">XCOLOR_GLOSS</a>);
01553   <span class="keywordflow">else</span> <span class="keywordflow">if</span> (strcmp(name, <span class="stringliteral">"GrayTransition"</span>) == 0)
01554     <a class="code" href="print-escp2_8c.html#a58">set_gray_transition_parameter</a>(v, description, 2);
01555   <span class="keywordflow">else</span> <span class="keywordflow">if</span> (strcmp(name, <span class="stringliteral">"Gray1Transition"</span>) == 0 ||
01556            strcmp(name, <span class="stringliteral">"Gray2Transition"</span>) == 0 ||
01557            strcmp(name, <span class="stringliteral">"Gray3Transition"</span>) == 0)
01558     <a class="code" href="print-escp2_8c.html#a58">set_gray_transition_parameter</a>(v, description, 4);
01559   <span class="keywordflow">else</span> <span class="keywordflow">if</span> (strcmp(name, <span class="stringliteral">"LightCyanTransition"</span>) == 0)
01560     <a class="code" href="print-escp2_8c.html#a59">set_color_transition_parameter</a>(v, description, <a class="code" href="dither_8h.html#a1">STP_ECOLOR_C</a>);
01561   <span class="keywordflow">else</span> <span class="keywordflow">if</span> (strcmp(name, <span class="stringliteral">"LightMagentaTransition"</span>) == 0)
01562     <a class="code" href="print-escp2_8c.html#a59">set_color_transition_parameter</a>(v, description, <a class="code" href="dither_8h.html#a2">STP_ECOLOR_M</a>);
01563   <span class="keywordflow">else</span> <span class="keywordflow">if</span> (strcmp(name, <span class="stringliteral">"DarkYellowTransition"</span>) == 0)
01564     <a class="code" href="print-escp2_8c.html#a59">set_color_transition_parameter</a>(v, description, <a class="code" href="dither_8h.html#a3">STP_ECOLOR_Y</a>);
01565   <span class="keywordflow">else</span> <span class="keywordflow">if</span> (strcmp(name, <span class="stringliteral">"AlignmentPasses"</span>) == 0)
01566     {
01567       description-&gt;<a class="code" href="structstp__parameter__t.html#o26">deflt</a>.integer = escp2_alignment_passes(v);
01568     }
01569   <span class="keywordflow">else</span> <span class="keywordflow">if</span> (strcmp(name, <span class="stringliteral">"AlignmentChoices"</span>) == 0)
01570     {
01571       description-&gt;<a class="code" href="structstp__parameter__t.html#o26">deflt</a>.integer = escp2_alignment_choices(v);
01572     }
01573   <span class="keywordflow">else</span> <span class="keywordflow">if</span> (strcmp(name, <span class="stringliteral">"SupportsInkChange"</span>) == 0)
01574     {
01575       description-&gt;<a class="code" href="structstp__parameter__t.html#o26">deflt</a>.integer =
01576         <a class="code" href="print-escp2_8c.html#a29">escp2_has_cap</a>(v, <a class="code" href="print-escp2_8h.html#a158a147">MODEL_SUPPORTS_INK_CHANGE</a>,
01577                       <a class="code" href="print-escp2_8h.html#a45">MODEL_SUPPORTS_INK_CHANGE_YES</a>);
01578     }
01579   <span class="keywordflow">else</span> <span class="keywordflow">if</span> (strcmp(name, <span class="stringliteral">"AlternateAlignmentPasses"</span>) == 0)
01580     {
01581       description-&gt;<a class="code" href="structstp__parameter__t.html#o26">deflt</a>.integer = escp2_alternate_alignment_passes(v);
01582     }
01583   <span class="keywordflow">else</span> <span class="keywordflow">if</span> (strcmp(name, <span class="stringliteral">"AlternateAlignmentChoices"</span>) == 0)
01584     {
01585       description-&gt;<a class="code" href="structstp__parameter__t.html#o26">deflt</a>.integer = escp2_alternate_alignment_choices(v);
01586     }
01587   <span class="keywordflow">else</span> <span class="keywordflow">if</span> (strcmp(name, <span class="stringliteral">"InkChannels"</span>) == 0)
01588     {
01589       description-&gt;<a class="code" href="structstp__parameter__t.html#o26">deflt</a>.integer = escp2_physical_channels(v);
01590     }
01591   <span class="keywordflow">else</span> <span class="keywordflow">if</span> (strcmp(name, <span class="stringliteral">"SupportsPacketMode"</span>) == 0)
01592     {
01593       description-&gt;<a class="code" href="structstp__parameter__t.html#o26">deflt</a>.integer =
01594         <a class="code" href="print-escp2_8c.html#a29">escp2_has_cap</a>(v, <a class="code" href="print-escp2_8h.html#a158a148">MODEL_PACKET_MODE</a>, <a class="code" href="print-escp2_8h.html#a48">MODEL_PACKET_MODE_YES</a>);
01595     }
01596   <span class="keywordflow">else</span> <span class="keywordflow">if</span> (strcmp(name, <span class="stringliteral">"PrintingMode"</span>) == 0)
01597     {
01598       description-&gt;<a class="code" href="structstp__parameter__t.html#o18">bounds</a>.str = <a class="code" href="string-list_8h.html#a1">stp_string_list_create</a>();
01599       <a class="code" href="string-list_8h.html#a7">stp_string_list_add_string</a>
01600         (description-&gt;<a class="code" href="structstp__parameter__t.html#o18">bounds</a>.str, <span class="stringliteral">"Color"</span>, <a class="code" href="group__intl__internal.html#ga5">_</a>(<span class="stringliteral">"Color"</span>));
01601       <a class="code" href="string-list_8h.html#a7">stp_string_list_add_string</a>
01602         (description-&gt;<a class="code" href="structstp__parameter__t.html#o18">bounds</a>.str, <span class="stringliteral">"BW"</span>, <a class="code" href="group__intl__internal.html#ga5">_</a>(<span class="stringliteral">"Black and White"</span>));
01603       description-&gt;<a class="code" href="structstp__parameter__t.html#o26">deflt</a>.str =
01604         <a class="code" href="string-list_8c.html#a6">stp_string_list_param</a>(description-&gt;<a class="code" href="structstp__parameter__t.html#o18">bounds</a>.str, 0)-&gt;<a class="code" href="structstp__param__string__t.html#o0">name</a>;
01605     }
01606   <span class="keywordflow">else</span> <span class="keywordflow">if</span> (strcmp(name, <span class="stringliteral">"RawChannels"</span>) == 0)
01607     {
01608       <span class="keyword">const</span> <a class="code" href="structinklist__t.html">inklist_t</a> *inks = <a class="code" href="print-escp2_8c.html#a37">escp2_inklist</a>(v);
01609       <span class="keywordtype">int</span> ninktypes = inks-&gt;<a class="code" href="structinklist__t.html#o6">n_inks</a>;
01610       description-&gt;<a class="code" href="structstp__parameter__t.html#o18">bounds</a>.str = <a class="code" href="string-list_8h.html#a1">stp_string_list_create</a>();
01611       <span class="keywordflow">if</span> (ninktypes &gt; 1)
01612         {
01613           <a class="code" href="string-list_8c.html#a11">stp_string_list_add_string</a>(description-&gt;<a class="code" href="structstp__parameter__t.html#o18">bounds</a>.str, <span class="stringliteral">"None"</span>, <span class="stringliteral">"None"</span>);
01614           <span class="keywordflow">for</span> (i = 0; i &lt; ninktypes; i++)
01615             <span class="keywordflow">if</span> (inks-&gt;<a class="code" href="structinklist__t.html#o2">inknames</a>[i]-&gt;<a class="code" href="structescp2__inkname__t.html#o2">inkset</a> == <a class="code" href="print-escp2_8h.html#a156a136">INKSET_EXTENDED</a>)
01616               {
01617                 <span class="keyword">const</span> <a class="code" href="structchannel__count__t.html">channel_count_t</a> *ch =
01618                   (<a class="code" href="print-escp2_8c.html#a31">get_channel_count_by_number</a>
01619                    (inks-&gt;<a class="code" href="structinklist__t.html#o2">inknames</a>[i]-&gt;<a class="code" href="structescp2__inkname__t.html#o3">channel_set</a>-&gt;<a class="code" href="structchannel__set__t.html#o2">channel_count</a>));
01620                 <a class="code" href="string-list_8c.html#a11">stp_string_list_add_string</a>(description-&gt;<a class="code" href="structstp__parameter__t.html#o18">bounds</a>.str,
01621                                            ch-&gt;<a class="code" href="structchannel__count__t.html#o1">name</a>, ch-&gt;<a class="code" href="structchannel__count__t.html#o1">name</a>);
01622               }
01623           description-&gt;<a class="code" href="structstp__parameter__t.html#o26">deflt</a>.str =
01624             <a class="code" href="string-list_8c.html#a6">stp_string_list_param</a>(description-&gt;<a class="code" href="structstp__parameter__t.html#o18">bounds</a>.str, 0)-&gt;<a class="code" href="structstp__param__string__t.html#o0">name</a>;
01625         }
01626       <span class="keywordflow">if</span> (ninktypes &lt;= 1)
01627         description-&gt;<a class="code" href="structstp__parameter__t.html#o8">is_active</a> = 0;
01628     }
01629 }
01630 
01631 <span class="keyword">static</span> <span class="keyword">const</span> <a class="code" href="structres__t.html">res_t</a> *
<a name="l01632"></a><a class="code" href="print-escp2_8c.html#a26">01632</a> <a class="code" href="print-escp2_8c.html#a26">escp2_find_resolution</a>(<span class="keyword">const</span> <a class="code" href="structstp__vars.html">stp_vars_t</a> *v)
01633 {
01634   <span class="keyword">const</span> <span class="keywordtype">char</span> *resolution;
01635   <span class="keywordflow">if</span> (<a class="code" href="group__vars.html#ga100">stp_check_string_parameter</a>(v, <span class="stringliteral">"Quality"</span>, <a class="code" href="group__vars.html#gga135a32">STP_PARAMETER_ACTIVE</a>))
01636     {
01637       <span class="keyword">const</span> <a class="code" href="structres__t.html">res_t</a> *default_res =
01638         <a class="code" href="print-escp2_8c.html#a61">find_resolution_from_quality</a>(v, <a class="code" href="group__vars.html#ga36">stp_get_string_parameter</a>(v, <span class="stringliteral">"Quality"</span>),
01639                                      0);
01640       <span class="keywordflow">if</span> (default_res)
01641         {
01642           <a class="code" href="print-util_8c.html#a23">stp_dprintf</a>(<a class="code" href="group__util.html#ga36">STP_DBG_ESCP2</a>, v,
01643                       <span class="stringliteral">"Setting resolution to %s from quality %s\n"</span>,
01644                       default_res-&gt;<a class="code" href="structres__t.html#o0">name</a>,
01645                       <a class="code" href="group__vars.html#ga73">stp_get_string_parameter</a>(v, <span class="stringliteral">"Quality"</span>));
01646           <span class="keywordflow">return</span> default_res;
01647         }
01648       <span class="keywordflow">else</span>
01649         <a class="code" href="print-util_8c.html#a23">stp_dprintf</a>(<a class="code" href="group__util.html#ga36">STP_DBG_ESCP2</a>, v, <span class="stringliteral">"Unable to map quality %s\n"</span>,
01650                     <a class="code" href="group__vars.html#ga36">stp_get_string_parameter</a>(v, <span class="stringliteral">"Quality"</span>));
01651     }
01652   resolution = <a class="code" href="group__vars.html#ga36">stp_get_string_parameter</a>(v, <span class="stringliteral">"Resolution"</span>);
01653   <span class="keywordflow">if</span> (resolution)
01654     {
01655       <span class="keyword">const</span> <a class="code" href="structres__t.html">res_t</a> *<span class="keyword">const</span> *res = escp2_reslist(v);
01656       <span class="keywordtype">int</span> i = 0;
01657       <span class="keywordflow">while</span> (res[i])
01658         {
01659           <span class="keywordflow">if</span> (!strcmp(resolution, res[i]-&gt;name))
01660             <span class="keywordflow">return</span> res[i];
01661           <span class="keywordflow">else</span> <span class="keywordflow">if</span> (!strcmp(res[i]-&gt;name, <span class="stringliteral">""</span>))
01662             <span class="keywordflow">return</span> NULL;
01663           i++;
01664         }
01665     }
01666   <span class="keywordflow">return</span> NULL;
01667 }
01668 
01669 <span class="keyword">static</span> <span class="keyword">inline</span> <span class="keywordtype">int</span>
<a name="l01670"></a><a class="code" href="print-escp2_8c.html#a63">01670</a> <a class="code" href="print-escp2_8c.html#a63">imax</a>(<span class="keywordtype">int</span> a, <span class="keywordtype">int</span> b)
01671 {
01672   <span class="keywordflow">if</span> (a &gt; b)
01673     <span class="keywordflow">return</span> a;
01674   <span class="keywordflow">else</span>
01675     <span class="keywordflow">return</span> b;
01676 }
01677 
01678 <span class="keyword">static</span> <span class="keywordtype">void</span>
<a name="l01679"></a><a class="code" href="print-escp2_8c.html#a64">01679</a> <a class="code" href="print-pcl_8c.html#a135">internal_imageable_area</a>(<span class="keyword">const</span> <a class="code" href="structstp__vars.html">stp_vars_t</a> *v, <span class="keywordtype">int</span> use_paper_margins,
01680                         <span class="keywordtype">int</span> *left, <span class="keywordtype">int</span> *right, <span class="keywordtype">int</span> *bottom, <span class="keywordtype">int</span> *top)
01681 {
01682   <span class="keywordtype">int</span>   width, height;                  <span class="comment">/* Size of page */</span>
01683   <span class="keywordtype">int</span>   rollfeed = 0;                   <span class="comment">/* Roll feed selected */</span>
01684   <span class="keywordtype">int</span>   cd = 0;                 <span class="comment">/* CD selected */</span>
01685   <span class="keyword">const</span> <span class="keywordtype">char</span> *media_size = <a class="code" href="group__vars.html#ga36">stp_get_string_parameter</a>(v, <span class="stringliteral">"PageSize"</span>);
01686   <span class="keywordtype">int</span> left_margin = 0;
01687   <span class="keywordtype">int</span> right_margin = 0;
01688   <span class="keywordtype">int</span> bottom_margin = 0;
01689   <span class="keywordtype">int</span> top_margin = 0;
01690   <span class="keyword">const</span> <a class="code" href="structstp__papersize__t.html">stp_papersize_t</a> *pt = NULL;
01691   <span class="keyword">const</span> <a class="code" href="structinput__slot__t.html">input_slot_t</a> *input_slot = NULL;
01692 
01693   <span class="keywordflow">if</span> (media_size &amp;&amp; use_paper_margins)
01694     pt = <a class="code" href="group__papersize.html#ga9">stp_get_papersize_by_name</a>(media_size);
01695 
01696   input_slot = <a class="code" href="print-escp2_8c.html#a44">get_input_slot</a>(v);
01697   <span class="keywordflow">if</span> (input_slot)
01698     {
01699       cd = input_slot-&gt;<a class="code" href="structinput__slot__t.html#o2">is_cd</a>;
01700       rollfeed = input_slot-&gt;<a class="code" href="structinput__slot__t.html#o3">is_roll_feed</a>;
01701     }
01702 
01703   <a class="code" href="group__papersize.html#ga13">stp_default_media_size</a>(v, &amp;width, &amp;height);
01704   <span class="keywordflow">if</span> (cd)
01705     {
01706       left_margin = 0;
01707       right_margin = 0;
01708       bottom_margin = 0;
01709       top_margin = 0;
01710     }
01711   <span class="keywordflow">else</span>
01712     {
01713       <span class="keywordflow">if</span> (pt)
01714         {
01715           left_margin = pt-&gt;<a class="code" href="structstp__papersize__t.html#o6">left</a>;
01716           right_margin = pt-&gt;<a class="code" href="structstp__papersize__t.html#o8">right</a>;
01717           bottom_margin = pt-&gt;<a class="code" href="structstp__papersize__t.html#o7">bottom</a>;
01718           top_margin = pt-&gt;<a class="code" href="structstp__papersize__t.html#o5">top</a>;
01719         }
01720 
01721       left_margin = <a class="code" href="print-escp2_8c.html#a63">imax</a>(left_margin, escp2_left_margin(v, rollfeed));
01722       right_margin = <a class="code" href="print-escp2_8c.html#a63">imax</a>(right_margin, escp2_right_margin(v, rollfeed));
01723       bottom_margin = <a class="code" href="print-escp2_8c.html#a63">imax</a>(bottom_margin, escp2_bottom_margin(v, rollfeed));
01724       top_margin = <a class="code" href="print-escp2_8c.html#a63">imax</a>(top_margin, escp2_top_margin(v, rollfeed));
01725     }
01726   *left =       left_margin;
01727   *right =      width - right_margin;
01728   *top =        top_margin;
01729   *bottom =     height - bottom_margin;
01730   <span class="keywordflow">if</span> (!cd &amp;&amp;
01731       <a class="code" href="print-escp2_8c.html#a29">escp2_has_cap</a>(v, <a class="code" href="print-escp2_8h.html#a158a140">MODEL_XZEROMARGIN</a>, <a class="code" href="print-escp2_8h.html#a24">MODEL_XZEROMARGIN_YES</a>) &amp;&amp;
01732       <a class="code" href="group__vars.html#ga62">stp_get_boolean_parameter</a>(v, <span class="stringliteral">"FullBleed"</span>))
01733     {
01734       *left -= 80 / (360 / 72); <span class="comment">/* 80 per the Epson manual */</span>
01735       *right += 80 / (360 / 72);        <span class="comment">/* 80 per the Epson manual */</span>
01736       *bottom += escp2_nozzles(v) * escp2_nozzle_separation(v) * 72 /
01737         escp2_base_separation(v);
01738     }
01739 }
01740 
01741 <span class="comment">/*</span>
01742 <span class="comment"> * 'escp2_imageable_area()' - Return the imageable area of the page.</span>
01743 <span class="comment"> */</span>
01744 
01745 <span class="keyword">static</span> <span class="keywordtype">void</span>
<a name="l01746"></a><a class="code" href="print-escp2_8c.html#a65">01746</a> <a class="code" href="print-escp2_8c.html#a65">escp2_imageable_area</a>(<span class="keyword">const</span> <a class="code" href="structstp__vars.html">stp_vars_t</a> *v,   <span class="comment">/* I */</span>
01747                      <span class="keywordtype">int</span>  *left,        <span class="comment">/* O - Left position in points */</span>
01748                      <span class="keywordtype">int</span>  *right,       <span class="comment">/* O - Right position in points */</span>
01749                      <span class="keywordtype">int</span>  *bottom,      <span class="comment">/* O - Bottom position in points */</span>
01750                      <span class="keywordtype">int</span>  *top)         <span class="comment">/* O - Top position in points */</span>
01751 {
01752   <a class="code" href="print-pcl_8c.html#a135">internal_imageable_area</a>(v, 1, left, right, bottom, top);
01753 }
01754 
01755 <span class="keyword">static</span> <span class="keywordtype">void</span>
<a name="l01756"></a><a class="code" href="print-escp2_8c.html#a66">01756</a> <a class="code" href="print-escp2_8c.html#a66">escp2_limit</a>(<span class="keyword">const</span> <a class="code" href="structstp__vars.html">stp_vars_t</a> *v,                        <span class="comment">/* I */</span>
01757             <span class="keywordtype">int</span> *width, <span class="keywordtype">int</span> *height,
01758             <span class="keywordtype">int</span> *min_width, <span class="keywordtype">int</span> *min_height)
01759 {
01760   *width =      escp2_max_paper_width(v);
01761   *height =     escp2_max_paper_height(v);
01762   *min_width =  escp2_min_paper_width(v);
01763   *min_height = escp2_min_paper_height(v);
01764 }
01765 
01766 <span class="keyword">static</span> <span class="keywordtype">void</span>
<a name="l01767"></a><a class="code" href="print-escp2_8c.html#a67">01767</a> <a class="code" href="print-escp2_8c.html#a67">escp2_describe_resolution</a>(<span class="keyword">const</span> <a class="code" href="structstp__vars.html">stp_vars_t</a> *v, <span class="keywordtype">int</span> *x, <span class="keywordtype">int</span> *y)
01768 {
01769   <span class="keyword">const</span> <a class="code" href="structres__t.html">res_t</a> *res = <a class="code" href="print-escp2_8c.html#a26">escp2_find_resolution</a>(v);
01770   <span class="keywordflow">if</span> (res &amp;&amp; <a class="code" href="print-escp2_8c.html#a49">verify_resolution</a>(v, res))
01771     {
01772       *x = res-&gt;<a class="code" href="structres__t.html#o4">printed_hres</a>;
01773       *y = res-&gt;<a class="code" href="structres__t.html#o5">printed_vres</a>;
01774       <span class="keywordflow">return</span>;
01775     }
01776   *x = -1;
01777   *y = -1;
01778 }
01779 
01780 <span class="keyword">static</span> <span class="keyword">const</span> <span class="keywordtype">char</span> *
<a name="l01781"></a><a class="code" href="print-escp2_8c.html#a68">01781</a> <a class="code" href="print-escp2_8c.html#a68">escp2_describe_output</a>(<span class="keyword">const</span> <a class="code" href="structstp__vars.html">stp_vars_t</a> *v)
01782 {
01783   <span class="keyword">const</span> <span class="keywordtype">char</span> *printing_mode = <a class="code" href="group__vars.html#ga36">stp_get_string_parameter</a>(v, <span class="stringliteral">"PrintingMode"</span>);
01784   <span class="keyword">const</span> <span class="keywordtype">char</span> *input_image_type = <a class="code" href="group__vars.html#ga36">stp_get_string_parameter</a>(v, <span class="stringliteral">"InputImageType"</span>);
01785   <span class="keywordflow">if</span> (input_image_type &amp;&amp; strcmp(input_image_type, <span class="stringliteral">"Raw"</span>) == 0)
01786     <span class="keywordflow">return</span> <span class="stringliteral">"Raw"</span>;
01787   <span class="keywordflow">else</span> <span class="keywordflow">if</span> (printing_mode &amp;&amp; strcmp(printing_mode, <span class="stringliteral">"BW"</span>) == 0)
01788     <span class="keywordflow">return</span> <span class="stringliteral">"Grayscale"</span>;
01789   <span class="keywordflow">else</span>
01790     {
01791       <span class="keyword">const</span> <a class="code" href="structescp2__inkname__t.html">escp2_inkname_t</a> *ink_type = <a class="code" href="print-escp2_8c.html#a53">get_inktype</a>(v);
01792       <span class="keywordflow">if</span> (ink_type)
01793         {
01794           <span class="keywordflow">switch</span> (ink_type-&gt;<a class="code" href="structescp2__inkname__t.html#o2">inkset</a>)
01795             {
01796             <span class="keywordflow">case</span> <a class="code" href="print-escp2_8h.html#a156a135">INKSET_CMYKRB</a>:
01797               <span class="keywordflow">return</span> <span class="stringliteral">"CMYKRB"</span>;
01798             <span class="keywordflow">case</span> <a class="code" href="print-escp2_8h.html#a156a130">INKSET_CMYK</a>:
01799             <span class="keywordflow">case</span> <a class="code" href="print-escp2_8h.html#a156a131">INKSET_CcMmYK</a>:
01800             <span class="keywordflow">case</span> <a class="code" href="print-escp2_8h.html#a156a132">INKSET_CcMmYyK</a>:
01801             <span class="keywordflow">case</span> <a class="code" href="print-escp2_8h.html#a156a133">INKSET_CcMmYKk</a>:
01802             <span class="keywordflow">default</span>:
01803               <span class="keywordflow">if</span> (ink_type-&gt;<a class="code" href="structescp2__inkname__t.html#o3">channel_set</a>-&gt;<a class="code" href="structchannel__set__t.html#o1">channels</a>[0])
01804                 <span class="keywordflow">return</span> <span class="stringliteral">"KCMY"</span>;
01805               <span class="keywordflow">else</span>
01806                 <span class="keywordflow">return</span> <span class="stringliteral">"CMY"</span>;
01807               <span class="keywordflow">break</span>;
01808             }
01809         }
01810       <span class="keywordflow">else</span>
01811         <span class="keywordflow">return</span> <span class="stringliteral">"CMYK"</span>;
01812     }
01813 }
01814 
01815 <span class="keyword">static</span> <span class="keywordtype">int</span>
<a name="l01816"></a><a class="code" href="print-escp2_8c.html#a69">01816</a> <a class="code" href="print-escp2_8c.html#a69">escp2_has_advanced_command_set</a>(<span class="keyword">const</span> <a class="code" href="structstp__vars.html">stp_vars_t</a> *v)
01817 {
01818   <span class="keywordflow">return</span> (<a class="code" href="print-escp2_8c.html#a29">escp2_has_cap</a>(v, <a class="code" href="print-escp2_8h.html#a158a139">MODEL_COMMAND</a>, <a class="code" href="print-escp2_8h.html#a21">MODEL_COMMAND_PRO</a>) ||
01819           <a class="code" href="print-escp2_8c.html#a29">escp2_has_cap</a>(v, <a class="code" href="print-escp2_8h.html#a158a139">MODEL_COMMAND</a>, <a class="code" href="print-escp2_8h.html#a19">MODEL_COMMAND_1999</a>) ||
01820           <a class="code" href="print-escp2_8c.html#a29">escp2_has_cap</a>(v, <a class="code" href="print-escp2_8h.html#a158a139">MODEL_COMMAND</a>, <a class="code" href="print-escp2_8h.html#a20">MODEL_COMMAND_2000</a>));
01821 }
01822 
01823 <span class="keyword">static</span> <span class="keywordtype">int</span>
<a name="l01824"></a><a class="code" href="print-escp2_8c.html#a70">01824</a> <a class="code" href="print-escp2_8c.html#a70">escp2_use_extended_commands</a>(<span class="keyword">const</span> <a class="code" href="structstp__vars.html">stp_vars_t</a> *v, <span class="keywordtype">int</span> use_softweave)
01825 {
01826   <span class="keywordflow">return</span> (<a class="code" href="print-escp2_8c.html#a29">escp2_has_cap</a>(v, <a class="code" href="print-escp2_8h.html#a158a139">MODEL_COMMAND</a>, <a class="code" href="print-escp2_8h.html#a21">MODEL_COMMAND_PRO</a>) ||
01827           (<a class="code" href="print-escp2_8c.html#a29">escp2_has_cap</a>(v, <a class="code" href="print-escp2_8h.html#a158a142">MODEL_VARIABLE_DOT</a>, <a class="code" href="print-escp2_8h.html#a30">MODEL_VARIABLE_YES</a>) &amp;&amp;
01828            use_softweave));
01829 }
01830 
01831 <span class="keyword">static</span> <span class="keywordtype">int</span>
<a name="l01832"></a><a class="code" href="print-escp2_8c.html#a71">01832</a> <a class="code" href="print-escp2_8c.html#a71">set_raw_ink_type</a>(<a class="code" href="structstp__vars.html">stp_vars_t</a> *v)
01833 {
01834   <span class="keyword">const</span> <a class="code" href="structinklist__t.html">inklist_t</a> *inks = <a class="code" href="print-escp2_8c.html#a37">escp2_inklist</a>(v);
01835   <span class="keywordtype">int</span> ninktypes = inks-&gt;<a class="code" href="structinklist__t.html#o6">n_inks</a>;
01836   <span class="keywordtype">int</span> i;
01837   <span class="keyword">const</span> <span class="keywordtype">char</span> *channel_name = <a class="code" href="group__vars.html#ga36">stp_get_string_parameter</a>(v, <span class="stringliteral">"RawChannels"</span>);
01838   <span class="keyword">const</span> <a class="code" href="structchannel__count__t.html">channel_count_t</a> *count;
01839   <span class="keywordflow">if</span> (!channel_name)
01840     <span class="keywordflow">return</span> 0;
01841   count = <a class="code" href="print-escp2_8c.html#a30">get_channel_count_by_name</a>(channel_name);
01842   <span class="keywordflow">if</span> (!count)
01843     <span class="keywordflow">return</span> 0;
01844     
01845   <span class="comment">/*</span>
01846 <span class="comment">   * If we're using raw printer output, we dummy up the appropriate inkset.</span>
01847 <span class="comment">   */</span>
01848   <span class="keywordflow">for</span> (i = 0; i &lt; ninktypes; i++)
01849     <span class="keywordflow">if</span> (inks-&gt;<a class="code" href="structinklist__t.html#o2">inknames</a>[i]-&gt;<a class="code" href="structescp2__inkname__t.html#o2">inkset</a> == <a class="code" href="print-escp2_8h.html#a156a136">INKSET_EXTENDED</a> &amp;&amp;
01850         (inks-&gt;<a class="code" href="structinklist__t.html#o2">inknames</a>[i]-&gt;<a class="code" href="structescp2__inkname__t.html#o3">channel_set</a>-&gt;<a class="code" href="structchannel__set__t.html#o2">channel_count</a> == count-&gt;<a class="code" href="structchannel__count__t.html#o0">count</a>))
01851       {
01852         <a class="code" href="print-util_8c.html#a23">stp_dprintf</a>(<a class="code" href="group__util.html#ga33">STP_DBG_INK</a>, v, <span class="stringliteral">"Changing ink type from %s to %s\n"</span>,
01853                     <a class="code" href="group__vars.html#ga36">stp_get_string_parameter</a>(v, <span class="stringliteral">"InkType"</span>) ?
01854                     <a class="code" href="group__vars.html#ga36">stp_get_string_parameter</a>(v, <span class="stringliteral">"InkType"</span>) : <span class="stringliteral">"NULL"</span>,
01855                     inks-&gt;<a class="code" href="structinklist__t.html#o2">inknames</a>[i]-&gt;<a class="code" href="structescp2__inkname__t.html#o0">name</a>);
01856         <a class="code" href="group__vars.html#ga32">stp_set_string_parameter</a>(v, <span class="stringliteral">"InkType"</span>, inks-&gt;<a class="code" href="structinklist__t.html#o2">inknames</a>[i]-&gt;<a class="code" href="structescp2__inkname__t.html#o0">name</a>);
01857         <a class="code" href="group__vars.html#ga55">stp_set_int_parameter</a>(v, <span class="stringliteral">"STPIRawChannels"</span>, count-&gt;<a class="code" href="structchannel__count__t.html#o0">count</a>);
01858         <span class="keywordflow">return</span> 1;
01859       }
01860   <a class="code" href="group__util.html#ga15">stp_eprintf</a>
01861     (v, <a class="code" href="group__intl__internal.html#ga5">_</a>(<span class="stringliteral">"This printer does not support raw printer output at depth %d\n"</span>),
01862      count-&gt;<a class="code" href="structchannel__count__t.html#o0">count</a>);
01863   <span class="keywordflow">return</span> 0;
01864 }
01865 
01866 <span class="keyword">static</span> <span class="keywordtype">void</span>
<a name="l01867"></a><a class="code" href="print-escp2_8c.html#a72">01867</a> <a class="code" href="print-escp2_8c.html#a72">adjust_density_and_ink_type</a>(<a class="code" href="structstp__vars.html">stp_vars_t</a> *v, <a class="code" href="structstp__image.html">stp_image_t</a> *image)
01868 {
01869   <a class="code" href="structescp2__privdata__t.html">escp2_privdata_t</a> *pd = <a class="code" href="print-escp2_8c.html#a27">get_privdata</a>(v);
01870   <span class="keyword">const</span> <a class="code" href="structpaper__adjustment__t.html">paper_adjustment_t</a> *pt = pd-&gt;<a class="code" href="structescp2__privdata__t.html#o26">paper_adjustment</a>;
01871   <span class="keywordtype">double</span> paper_density = .8;
01872   <span class="keywordtype">int</span> o_resid = <a class="code" href="print-escp2_8c.html#a43">compute_printed_resid</a>(pd-&gt;<a class="code" href="structescp2__privdata__t.html#o42">res</a>);
01873 
01874   <span class="keywordflow">if</span> (pt)
01875     paper_density = pt-&gt;<a class="code" href="structpaper__adjustment__t.html#o1">base_density</a>;
01876 
01877   <span class="keywordflow">if</span> (!<a class="code" href="group__vars.html#ga102">stp_check_float_parameter</a>(v, <span class="stringliteral">"Density"</span>, <a class="code" href="group__vars.html#gga135a31">STP_PARAMETER_DEFAULTED</a>))
01878     {
01879       <a class="code" href="group__vars.html#ga93">stp_set_float_parameter_active</a>(v, <span class="stringliteral">"Density"</span>, <a class="code" href="group__vars.html#gga135a32">STP_PARAMETER_ACTIVE</a>);
01880       <a class="code" href="group__vars.html#ga67">stp_set_float_parameter</a>(v, <span class="stringliteral">"Density"</span>, 1.0);
01881     }
01882 
01883   <a class="code" href="group__vars.html#ga61">stp_scale_float_parameter</a>
01884     (v, <span class="stringliteral">"Density"</span>, paper_density * <a class="code" href="print-escp2_8c.html#a33">escp2_density</a>(v, o_resid));
01885   pd-&gt;<a class="code" href="structescp2__privdata__t.html#o12">drop_size</a> = <a class="code" href="print-escp2_8c.html#a32">escp2_ink_type</a>(v, o_resid);
01886   pd-&gt;<a class="code" href="structescp2__privdata__t.html#o13">ink_resid</a> = o_resid;
01887 
01888   <span class="comment">/*</span>
01889 <span class="comment">   * If density is greater than 1, try to find the dot size from a lower</span>
01890 <span class="comment">   * resolution that will let us print.  This allows use of high ink levels</span>
01891 <span class="comment">   * on special paper types that need a lot of ink.</span>
01892 <span class="comment">   */</span>
01893   <span class="keywordflow">if</span> (<a class="code" href="group__vars.html#ga70">stp_get_float_parameter</a>(v, <span class="stringliteral">"Density"</span>) &gt; 1.0)
01894     {
01895       <span class="keywordflow">if</span> (<a class="code" href="group__vars.html#ga103">stp_check_int_parameter</a>(v, <span class="stringliteral">"escp2_ink_type"</span>, <a class="code" href="group__vars.html#gga135a32">STP_PARAMETER_ACTIVE</a>) ||
01896           <a class="code" href="group__vars.html#ga103">stp_check_int_parameter</a>(v, <span class="stringliteral">"escp2_density"</span>, <a class="code" href="group__vars.html#gga135a32">STP_PARAMETER_ACTIVE</a>) ||
01897           <a class="code" href="group__vars.html#ga103">stp_check_int_parameter</a>(v, <span class="stringliteral">"escp2_bits"</span>, <a class="code" href="group__vars.html#gga135a32">STP_PARAMETER_ACTIVE</a>) ||
01898           (<a class="code" href="group__vars.html#ga105">stp_check_boolean_parameter</a>(v, <span class="stringliteral">"AdjustDotsize"</span>,
01899                                        <a class="code" href="group__vars.html#gga135a32">STP_PARAMETER_ACTIVE</a>) &amp;&amp;
01900            ! <a class="code" href="group__vars.html#ga62">stp_get_boolean_parameter</a>(v, <span class="stringliteral">"AdjustDotsize"</span>)))
01901         {
01902           <a class="code" href="group__vars.html#ga67">stp_set_float_parameter</a>(v, <span class="stringliteral">"Density"</span>, 1.0);
01903         }
01904       <span class="keywordflow">else</span>
01905         {
01906           <span class="keywordtype">double</span> density = <a class="code" href="group__vars.html#ga70">stp_get_float_parameter</a>(v, <span class="stringliteral">"Density"</span>);
01907           <span class="keywordtype">int</span> resid = o_resid;
01908           <span class="keywordtype">int</span> xresid = resid;
01909           <span class="keywordtype">double</span> xdensity = density;
01910           <span class="keywordflow">while</span> (density &gt; 1.0 &amp;&amp; resid &gt;= <a class="code" href="print-escp2_8h.html#a6">RES_360</a>)
01911             {
01912               <span class="keywordtype">int</span> tresid = xresid - 1;
01913               <span class="keywordtype">int</span> bits_now = <a class="code" href="print-escp2_8c.html#a34">escp2_bits</a>(v, resid);
01914               <span class="keywordtype">double</span> density_now = <a class="code" href="print-escp2_8c.html#a33">escp2_density</a>(v, resid);
01915               <span class="keywordtype">int</span> bits_then = <a class="code" href="print-escp2_8c.html#a34">escp2_bits</a>(v, tresid);
01916               <span class="keywordtype">double</span> density_then = <a class="code" href="print-escp2_8c.html#a33">escp2_density</a>(v, tresid);
01917               <span class="keywordtype">int</span> drop_size_then = <a class="code" href="print-escp2_8c.html#a32">escp2_ink_type</a>(v, tresid);
01918 
01919               <span class="comment">/*</span>
01920 <span class="comment">               * If we would change the number of bits in the ink type,</span>
01921 <span class="comment">               * don't try this.  Some resolutions require using a certain</span>
01922 <span class="comment">               * number of bits!</span>
01923 <span class="comment">               */</span>
01924 
01925               <span class="keywordflow">if</span> (bits_now != bits_then || density_then &lt;= 0.0 ||
01926                   drop_size_then == -1)
01927                 <span class="keywordflow">break</span>;
01928               xdensity = density * density_then / density_now / 2;
01929               xresid = tresid;
01930 
01931               <span class="comment">/*</span>
01932 <span class="comment">               * If we wouldn't get a significant improvement by changing the</span>
01933 <span class="comment">               * resolution, don't waste the effort trying.</span>
01934 <span class="comment">               */</span>
01935               <span class="keywordflow">if</span> (density / xdensity &gt; 1.001)
01936                 {
01937                   density = xdensity;
01938                   resid = tresid;
01939                 }
01940             }
01941           pd-&gt;<a class="code" href="structescp2__privdata__t.html#o12">drop_size</a> = <a class="code" href="print-escp2_8c.html#a32">escp2_ink_type</a>(v, resid);
01942           pd-&gt;<a class="code" href="structescp2__privdata__t.html#o13">ink_resid</a> = resid;
01943           <span class="keywordflow">if</span> (density &gt; 1.0)
01944             density = 1.0;
01945           <a class="code" href="group__vars.html#ga67">stp_set_float_parameter</a>(v, <span class="stringliteral">"Density"</span>, density);
01946         }
01947     }
01948 }
01949 
01950 <span class="keyword">static</span> <span class="keywordtype">void</span>
<a name="l01951"></a><a class="code" href="print-escp2_8c.html#a73">01951</a> <a class="code" href="print-escp2_8c.html#a73">adjust_print_quality</a>(<a class="code" href="structstp__vars.html">stp_vars_t</a> *v, <a class="code" href="structstp__image.html">stp_image_t</a> *image)
01952 {
01953   <a class="code" href="structescp2__privdata__t.html">escp2_privdata_t</a> *pd = <a class="code" href="print-escp2_8c.html#a27">get_privdata</a>(v);
01954   <a class="code" href="structstp__curve.html">stp_curve_t</a> *adjustment = NULL;
01955   <span class="keyword">const</span> <a class="code" href="structpaper__adjustment__t.html">paper_adjustment_t</a> *pt;
01956   <span class="keywordtype">double</span> k_upper = 1.0;
01957   <span class="keywordtype">double</span> k_lower = 0;
01958   <span class="keywordtype">double</span> k_transition = 1.0;
01959 
01960   <span class="comment">/*</span>
01961 <span class="comment">   * Compute the LUT.  For now, it's 8 bit, but that may eventually</span>
01962 <span class="comment">   * sometimes change.</span>
01963 <span class="comment">   */</span>
01964 
01965   pt = pd-&gt;<a class="code" href="structescp2__privdata__t.html#o26">paper_adjustment</a>;
01966   <span class="keywordflow">if</span> (pt)
01967     {
01968       k_lower = pt-&gt;<a class="code" href="structpaper__adjustment__t.html#o4">k_lower</a>;
01969       k_upper = pt-&gt;<a class="code" href="structpaper__adjustment__t.html#o5">k_upper</a>;
01970       k_transition = pt-&gt;<a class="code" href="structpaper__adjustment__t.html#o3">k_transition</a>;
01971       <a class="code" href="group__vars.html#ga68">stp_set_default_float_parameter</a>(v, <span class="stringliteral">"CyanDensity"</span>, 1.0);
01972       <a class="code" href="group__vars.html#ga71">stp_scale_float_parameter</a>(v, <span class="stringliteral">"CyanDensity"</span>, pt-&gt;<a class="code" href="structpaper__adjustment__t.html#o6">cyan</a>);
01973       <a class="code" href="group__vars.html#ga68">stp_set_default_float_parameter</a>(v, <span class="stringliteral">"MagentaDensity"</span>, 1.0);
01974       <a class="code" href="group__vars.html#ga71">stp_scale_float_parameter</a>(v, <span class="stringliteral">"MagentaDensity"</span>, pt-&gt;<a class="code" href="structpaper__adjustment__t.html#o7">magenta</a>);
01975       <a class="code" href="group__vars.html#ga68">stp_set_default_float_parameter</a>(v, <span class="stringliteral">"YellowDensity"</span>, 1.0);
01976       <a class="code" href="group__vars.html#ga71">stp_scale_float_parameter</a>(v, <span class="stringliteral">"YellowDensity"</span>, pt-&gt;<a class="code" href="structpaper__adjustment__t.html#o8">yellow</a>);
01977       <a class="code" href="group__vars.html#ga68">stp_set_default_float_parameter</a>(v, <span class="stringliteral">"BlackDensity"</span>, 1.0);
01978       <a class="code" href="group__vars.html#ga71">stp_scale_float_parameter</a>(v, <span class="stringliteral">"BlackDensity"</span>, pt-&gt;<a class="code" href="structpaper__adjustment__t.html#o9">black</a>);
01979       <a class="code" href="group__vars.html#ga68">stp_set_default_float_parameter</a>(v, <span class="stringliteral">"Saturation"</span>, 1.0);
01980       <a class="code" href="group__vars.html#ga71">stp_scale_float_parameter</a>(v, <span class="stringliteral">"Saturation"</span>, pt-&gt;<a class="code" href="structpaper__adjustment__t.html#o10">saturation</a>);
01981       <a class="code" href="group__vars.html#ga68">stp_set_default_float_parameter</a>(v, <span class="stringliteral">"Gamma"</span>, 1.0);
01982       <a class="code" href="group__vars.html#ga71">stp_scale_float_parameter</a>(v, <span class="stringliteral">"Gamma"</span>, pt-&gt;<a class="code" href="structpaper__adjustment__t.html#o11">gamma</a>);
01983     }
01984 
01985 
01986   <span class="keywordflow">if</span> (!<a class="code" href="group__vars.html#ga102">stp_check_float_parameter</a>(v, <span class="stringliteral">"GCRLower"</span>, <a class="code" href="group__vars.html#gga135a32">STP_PARAMETER_ACTIVE</a>))
01987     <a class="code" href="group__vars.html#ga68">stp_set_default_float_parameter</a>(v, <span class="stringliteral">"GCRLower"</span>, k_lower);
01988   <span class="keywordflow">if</span> (!<a class="code" href="group__vars.html#ga102">stp_check_float_parameter</a>(v, <span class="stringliteral">"GCRUpper"</span>, <a class="code" href="group__vars.html#gga135a32">STP_PARAMETER_ACTIVE</a>))
01989     <a class="code" href="group__vars.html#ga68">stp_set_default_float_parameter</a>(v, <span class="stringliteral">"GCRUpper"</span>, k_upper);
01990   <span class="keywordflow">if</span> (!<a class="code" href="group__vars.html#ga102">stp_check_float_parameter</a>(v, <span class="stringliteral">"BlackGamma"</span>, <a class="code" href="group__vars.html#gga135a32">STP_PARAMETER_ACTIVE</a>))
01991     <a class="code" href="group__vars.html#ga68">stp_set_default_float_parameter</a>(v, <span class="stringliteral">"BlackGamma"</span>, k_transition);
01992     
01993 
01994   <span class="keywordflow">if</span> (!<a class="code" href="group__vars.html#ga106">stp_check_curve_parameter</a>(v, <span class="stringliteral">"HueMap"</span>, <a class="code" href="group__vars.html#gga135a32">STP_PARAMETER_ACTIVE</a>) &amp;&amp;
01995       pt-&gt;<a class="code" href="structpaper__adjustment__t.html#o12">hue_adjustment</a>)
01996     {
01997       adjustment = <a class="code" href="group__curve.html#ga66">stp_curve_create_from_string</a>(pt-&gt;<a class="code" href="structpaper__adjustment__t.html#o12">hue_adjustment</a>);
01998       <a class="code" href="group__vars.html#ga47">stp_set_curve_parameter</a>(v, <span class="stringliteral">"HueMap"</span>, adjustment);
01999       <a class="code" href="group__vars.html#ga97">stp_set_curve_parameter_active</a>(v, <span class="stringliteral">"HueMap"</span>, <a class="code" href="group__vars.html#gga135a32">STP_PARAMETER_ACTIVE</a>);
02000       <a class="code" href="group__curve.html#ga22">stp_curve_destroy</a>(adjustment);
02001     }
02002   <span class="keywordflow">if</span> (!<a class="code" href="group__vars.html#ga106">stp_check_curve_parameter</a>(v, <span class="stringliteral">"SatMap"</span>, <a class="code" href="group__vars.html#gga135a32">STP_PARAMETER_ACTIVE</a>) &amp;&amp;
02003       pt-&gt;<a class="code" href="structpaper__adjustment__t.html#o14">sat_adjustment</a>)
02004     {
02005       adjustment = <a class="code" href="group__curve.html#ga66">stp_curve_create_from_string</a>(pt-&gt;<a class="code" href="structpaper__adjustment__t.html#o14">sat_adjustment</a>);
02006       <a class="code" href="group__vars.html#ga47">stp_set_curve_parameter</a>(v, <span class="stringliteral">"SatMap"</span>, adjustment);
02007       <a class="code" href="group__vars.html#ga97">stp_set_curve_parameter_active</a>(v, <span class="stringliteral">"SatMap"</span>, <a class="code" href="group__vars.html#gga135a32">STP_PARAMETER_ACTIVE</a>);
02008       <a class="code" href="group__curve.html#ga22">stp_curve_destroy</a>(adjustment);
02009     }
02010   <span class="keywordflow">if</span> (!<a class="code" href="group__vars.html#ga106">stp_check_curve_parameter</a>(v, <span class="stringliteral">"LumMap"</span>, <a class="code" href="group__vars.html#gga135a32">STP_PARAMETER_ACTIVE</a>) &amp;&amp;
02011       pt-&gt;<a class="code" href="structpaper__adjustment__t.html#o13">lum_adjustment</a>)
02012     {
02013       adjustment = <a class="code" href="group__curve.html#ga66">stp_curve_create_from_string</a>(pt-&gt;<a class="code" href="structpaper__adjustment__t.html#o13">lum_adjustment</a>);
02014       <a class="code" href="group__vars.html#ga47">stp_set_curve_parameter</a>(v, <span class="stringliteral">"LumMap"</span>, adjustment);
02015       <a class="code" href="group__vars.html#ga97">stp_set_curve_parameter_active</a>(v, <span class="stringliteral">"LumMap"</span>, <a class="code" href="group__vars.html#gga135a32">STP_PARAMETER_ACTIVE</a>);
02016       <a class="code" href="group__curve.html#ga22">stp_curve_destroy</a>(adjustment);
02017     }
02018 }
02019 
02020 <span class="keyword">static</span> <span class="keywordtype">int</span>
<a name="l02021"></a><a class="code" href="print-escp2_8c.html#a74">02021</a> <a class="code" href="print-escp2_8c.html#a74">count_channels</a>(<span class="keyword">const</span> <a class="code" href="structescp2__inkname__t.html">escp2_inkname_t</a> *inks)
02022 {
02023   <span class="keywordtype">int</span> answer = 0;
02024   <span class="keywordtype">int</span> i;
02025   <span class="keywordflow">for</span> (i = 0; i &lt; inks-&gt;<a class="code" href="structescp2__inkname__t.html#o3">channel_set</a>-&gt;<a class="code" href="structchannel__set__t.html#o2">channel_count</a>; i++)
02026     <span class="keywordflow">if</span> (inks-&gt;<a class="code" href="structescp2__inkname__t.html#o3">channel_set</a>-&gt;<a class="code" href="structchannel__set__t.html#o1">channels</a>[i])
02027       answer += inks-&gt;<a class="code" href="structescp2__inkname__t.html#o3">channel_set</a>-&gt;<a class="code" href="structchannel__set__t.html#o1">channels</a>[i]-&gt;<a class="code" href="structink__channel__t.html#o2">n_subchannels</a>;
02028   <span class="keywordflow">return</span> answer;
02029 }
02030 
02031 <span class="keyword">static</span> <span class="keywordtype">int</span>
<a name="l02032"></a><a class="code" href="print-escp2_8c.html#a75">02032</a> <a class="code" href="print-escp2_8c.html#a75">compute_channel_count</a>(<span class="keyword">const</span> <a class="code" href="structescp2__inkname__t.html">escp2_inkname_t</a> *ink_type, <span class="keywordtype">int</span> channel_limit)
02033 {
02034   <span class="keywordtype">int</span> i;
02035   <span class="keywordtype">int</span> physical_channels = 0;
02036   <span class="keywordflow">for</span> (i = 0; i &lt; channel_limit; i++)
02037     {
02038       <span class="keyword">const</span> <a class="code" href="structink__channel__t.html">ink_channel_t</a> *channel = ink_type-&gt;<a class="code" href="structescp2__inkname__t.html#o3">channel_set</a>-&gt;<a class="code" href="structchannel__set__t.html#o1">channels</a>[i];
02039       <span class="keywordflow">if</span> (channel)
02040         physical_channels += channel-&gt;<a class="code" href="structink__channel__t.html#o2">n_subchannels</a>;
02041     }
02042   <span class="keywordflow">return</span> physical_channels;
02043 }
02044 
02045 <span class="keyword">static</span> <span class="keywordtype">double</span>
<a name="l02046"></a><a class="code" href="print-escp2_8c.html#a76">02046</a> <a class="code" href="print-pcl_8c.html#a140">get_double_param</a>(<span class="keyword">const</span> <a class="code" href="structstp__vars.html">stp_vars_t</a> *v, <span class="keyword">const</span> <span class="keywordtype">char</span> *param)
02047 {
02048   <span class="keywordflow">if</span> (param &amp;&amp; <a class="code" href="group__vars.html#ga102">stp_check_float_parameter</a>(v, param, <a class="code" href="group__vars.html#gga135a32">STP_PARAMETER_ACTIVE</a>))
02049     <span class="keywordflow">return</span> <a class="code" href="group__vars.html#ga70">stp_get_float_parameter</a>(v, param);
02050   <span class="keywordflow">else</span>
02051     <span class="keywordflow">return</span> 1.0;
02052 }
02053 
02054 <span class="keyword">static</span> <span class="keywordtype">void</span>
<a name="l02055"></a><a class="code" href="print-escp2_8c.html#a77">02055</a> <a class="code" href="print-escp2_8c.html#a77">setup_inks</a>(<a class="code" href="structstp__vars.html">stp_vars_t</a> *v)
02056 {
02057   <a class="code" href="structescp2__privdata__t.html">escp2_privdata_t</a> *pd = <a class="code" href="print-escp2_8c.html#a27">get_privdata</a>(v);
02058   <span class="keywordtype">int</span> i, j;
02059   <span class="keyword">const</span> <a class="code" href="structescp2__dropsize__t.html">escp2_dropsize_t</a> *drops;
02060   <span class="keyword">const</span> <a class="code" href="structescp2__inkname__t.html">escp2_inkname_t</a> *ink_type = pd-&gt;<a class="code" href="structescp2__privdata__t.html#o14">inkname</a>;
02061   <span class="keyword">const</span> <a class="code" href="structpaper__adjustment__t.html">paper_adjustment_t</a> *paper = pd-&gt;<a class="code" href="structescp2__privdata__t.html#o26">paper_adjustment</a>;
02062 
02063   drops = <a class="code" href="print-escp2_8c.html#a36">escp2_dropsizes</a>(v, pd-&gt;<a class="code" href="structescp2__privdata__t.html#o13">ink_resid</a>);
02064   <a class="code" href="group__util.html#ga26">stp_init_debug_messages</a>(v);
02065   <span class="keywordflow">for</span> (i = 0; i &lt; pd-&gt;<a class="code" href="structescp2__privdata__t.html#o15">logical_channels</a>; i++)
02066     {
02067       <span class="keyword">const</span> <a class="code" href="structink__channel__t.html">ink_channel_t</a> *channel = ink_type-&gt;<a class="code" href="structescp2__inkname__t.html#o3">channel_set</a>-&gt;<a class="code" href="structchannel__set__t.html#o1">channels</a>[i];
02068       <span class="keywordflow">if</span> (channel &amp;&amp; channel-&gt;<a class="code" href="structink__channel__t.html#o2">n_subchannels</a> &gt; 0)
02069         {
02070           <span class="keyword">const</span> <span class="keywordtype">char</span> *param = channel-&gt;<a class="code" href="structink__channel__t.html#o1">subchannels</a>[0].<a class="code" href="structphysical__subchannel__t.html#o3">channel_density</a>;
02071           <span class="keyword">const</span> <a class="code" href="structshade__t.html">shade_t</a> *shades = <a class="code" href="print-escp2_8c.html#a38">escp2_shades</a>(v, i);
02072           <span class="keywordtype">double</span> userval = <a class="code" href="print-pcl_8c.html#a140">get_double_param</a>(v, param);
02073           <span class="keywordflow">if</span> (shades-&gt;<a class="code" href="structshade__t.html#o0">n_shades</a> &lt; channel-&gt;<a class="code" href="structink__channel__t.html#o2">n_subchannels</a>)
02074             {
02075               <a class="code" href="print-util_8c.html#a20">stp_erprintf</a>(<span class="stringliteral">"Not enough shades!\n"</span>);
02076             }
02077           <span class="keywordflow">if</span> (strcmp(param, <span class="stringliteral">"BlackDensity"</span>) == 0)
02078             <a class="code" href="channel_8c.html#a9">stp_channel_set_black_channel</a>(v, i);
02079           <a class="code" href="dither-inks_8c.html#a12">stp_dither_set_inks</a>(v, i, 1.0, <a class="code" href="print-escp2_8c.html#a17">ink_darknesses</a>[i % 8],
02080                               channel-&gt;<a class="code" href="structink__channel__t.html#o2">n_subchannels</a>, shades-&gt;<a class="code" href="structshade__t.html#o1">shades</a>,
02081                               drops-&gt;<a class="code" href="structescp2__dropsize__t.html#o1">numdropsizes</a>, drops-&gt;<a class="code" href="structescp2__dropsize__t.html#o2">dropsizes</a>);
02082           <span class="keywordflow">for</span> (j = 0; j &lt; channel-&gt;<a class="code" href="structink__channel__t.html#o2">n_subchannels</a>; j++)
02083             {
02084               <span class="keyword">const</span> <span class="keywordtype">char</span> *subparam =
02085                 channel-&gt;<a class="code" href="structink__channel__t.html#o1">subchannels</a>[j].<a class="code" href="structphysical__subchannel__t.html#o4">subchannel_scale</a>;
02086               <span class="keywordtype">double</span> scale = userval * <a class="code" href="print-pcl_8c.html#a140">get_double_param</a>(v, subparam);
02087               scale *= <a class="code" href="print-pcl_8c.html#a140">get_double_param</a>(v, <span class="stringliteral">"Density"</span>);
02088               <a class="code" href="channel_8c.html#a7">stp_channel_set_density_adjustment</a>(v, i, j, scale);
02089               <span class="keywordflow">if</span> (paper)
02090                 <a class="code" href="channel_8c.html#a10">stp_channel_set_cutoff_adjustment</a>(v, i, j,
02091                                                   paper-&gt;<a class="code" href="structpaper__adjustment__t.html#o2">subchannel_cutoff</a>);
02092             }
02093         }
02094     }
02095   <a class="code" href="group__util.html#ga27">stp_flush_debug_messages</a>(v);
02096 }
02097 
02098 <span class="keyword">static</span> <span class="keywordtype">void</span>
<a name="l02099"></a><a class="code" href="print-escp2_8c.html#a78">02099</a> <a class="code" href="print-escp2_8c.html#a78">setup_head_offset</a>(<a class="code" href="structstp__vars.html">stp_vars_t</a> *v)
02100 {
02101   <a class="code" href="structescp2__privdata__t.html">escp2_privdata_t</a> *pd = <a class="code" href="print-escp2_8c.html#a27">get_privdata</a>(v);
02102   <span class="keywordtype">int</span> i;
02103   <span class="keywordtype">int</span> channel_id = 0;
02104   <span class="keywordtype">int</span> channel_limit = pd-&gt;<a class="code" href="structescp2__privdata__t.html#o15">logical_channels</a>;
02105   <span class="keyword">const</span> <a class="code" href="structescp2__inkname__t.html">escp2_inkname_t</a> *ink_type = pd-&gt;<a class="code" href="structescp2__privdata__t.html#o14">inkname</a>;
02106   <span class="keywordflow">if</span> (pd-&gt;<a class="code" href="structescp2__privdata__t.html#o17">channels_in_use</a> &gt; pd-&gt;<a class="code" href="structescp2__privdata__t.html#o15">logical_channels</a>)
02107     channel_limit = pd-&gt;<a class="code" href="structescp2__privdata__t.html#o17">channels_in_use</a>;
02108   pd-&gt;<a class="code" href="structescp2__privdata__t.html#o3">head_offset</a> = <a class="code" href="group__util.html#ga29">stp_zalloc</a>(<span class="keyword">sizeof</span>(<span class="keywordtype">int</span>) * channel_limit);
02109   <span class="keywordflow">for</span> (i = 0; i &lt; pd-&gt;<a class="code" href="structescp2__privdata__t.html#o15">logical_channels</a>; i++)
02110     {
02111       <span class="keyword">const</span> <a class="code" href="structink__channel__t.html">ink_channel_t</a> *channel = ink_type-&gt;<a class="code" href="structescp2__inkname__t.html#o3">channel_set</a>-&gt;<a class="code" href="structchannel__set__t.html#o1">channels</a>[i];
02112       <span class="keywordflow">if</span> (channel)
02113         {
02114           <span class="keywordtype">int</span> j;
02115           <span class="keywordflow">for</span> (j = 0; j &lt; channel-&gt;<a class="code" href="structink__channel__t.html#o2">n_subchannels</a>; j++)
02116             {
02117               pd-&gt;<a class="code" href="structescp2__privdata__t.html#o3">head_offset</a>[channel_id] =
02118                 channel-&gt;<a class="code" href="structink__channel__t.html#o1">subchannels</a>[j].<a class="code" href="structphysical__subchannel__t.html#o2">head_offset</a>;
02119               channel_id++;
02120             }
02121         }
02122     }
02123   <span class="keywordflow">if</span> (pd-&gt;<a class="code" href="structescp2__privdata__t.html#o16">physical_channels</a> == 1)
02124     pd-&gt;<a class="code" href="structescp2__privdata__t.html#o3">head_offset</a>[0] = 0;
02125   pd-&gt;<a class="code" href="structescp2__privdata__t.html#o4">max_head_offset</a> = 0;
02126   <span class="keywordflow">if</span> (pd-&gt;<a class="code" href="structescp2__privdata__t.html#o16">physical_channels</a> &gt; 1)
02127     <span class="keywordflow">for</span> (i = 0; i &lt; pd-&gt;<a class="code" href="structescp2__privdata__t.html#o17">channels_in_use</a>; i++)
02128       {
02129         pd-&gt;<a class="code" href="structescp2__privdata__t.html#o3">head_offset</a>[i] = pd-&gt;<a class="code" href="structescp2__privdata__t.html#o3">head_offset</a>[i] * pd-&gt;<a class="code" href="structescp2__privdata__t.html#o42">res</a>-&gt;<a class="code" href="structres__t.html#o3">vres</a> /
02130           escp2_base_separation(v);
02131         <span class="keywordflow">if</span> (pd-&gt;<a class="code" href="structescp2__privdata__t.html#o3">head_offset</a>[i] &gt; pd-&gt;<a class="code" href="structescp2__privdata__t.html#o4">max_head_offset</a>)
02132           pd-&gt;<a class="code" href="structescp2__privdata__t.html#o4">max_head_offset</a> = pd-&gt;<a class="code" href="structescp2__privdata__t.html#o3">head_offset</a>[i];
02133       }
02134 }
02135 
02136 <span class="keyword">static</span> <span class="keywordtype">void</span>
<a name="l02137"></a><a class="code" href="print-escp2_8c.html#a79">02137</a> <a class="code" href="print-escp2_8c.html#a79">setup_misc</a>(<a class="code" href="structstp__vars.html">stp_vars_t</a> *v)
02138 {
02139   <a class="code" href="structescp2__privdata__t.html">escp2_privdata_t</a> *pd = <a class="code" href="print-escp2_8c.html#a27">get_privdata</a>(v);
02140   pd-&gt;<a class="code" href="structescp2__privdata__t.html#o24">input_slot</a> = <a class="code" href="print-escp2_8c.html#a44">get_input_slot</a>(v);
02141   pd-&gt;<a class="code" href="structescp2__privdata__t.html#o25">paper_type</a> = <a class="code" href="print-lexmark_8c.html#a126">get_media_type</a>(v);
02142   pd-&gt;<a class="code" href="structescp2__privdata__t.html#o26">paper_adjustment</a> = <a class="code" href="print-escp2_8c.html#a54">get_media_adjustment</a>(v);
02143   pd-&gt;<a class="code" href="structescp2__privdata__t.html#o27">ink_group</a> = escp2_inkgroup(v);
02144   pd-&gt;<a class="code" href="structescp2__privdata__t.html#o28">init_sequence</a> = escp2_preinit_sequence(v);
02145   pd-&gt;<a class="code" href="structescp2__privdata__t.html#o29">deinit_sequence</a> = escp2_postinit_remote_sequence(v);
02146   pd-&gt;<a class="code" href="structescp2__privdata__t.html#o22">advanced_command_set</a> = <a class="code" href="print-escp2_8c.html#a69">escp2_has_advanced_command_set</a>(v);
02147   pd-&gt;<a class="code" href="structescp2__privdata__t.html#o30">command_set</a> = <a class="code" href="print-escp2_8c.html#a28">escp2_get_cap</a>(v, <a class="code" href="print-escp2_8h.html#a158a139">MODEL_COMMAND</a>);
02148   pd-&gt;<a class="code" href="structescp2__privdata__t.html#o31">variable_dots</a> = <a class="code" href="print-escp2_8c.html#a29">escp2_has_cap</a>(v, <a class="code" href="print-escp2_8h.html#a158a142">MODEL_VARIABLE_DOT</a>, <a class="code" href="print-escp2_8h.html#a30">MODEL_VARIABLE_YES</a>);
02149   pd-&gt;<a class="code" href="structescp2__privdata__t.html#o32">has_vacuum</a> = <a class="code" href="print-escp2_8c.html#a29">escp2_has_cap</a>(v, <a class="code" href="print-escp2_8h.html#a158a144">MODEL_VACUUM</a>, <a class="code" href="print-escp2_8h.html#a36">MODEL_VACUUM_YES</a>);
02150   pd-&gt;<a class="code" href="structescp2__privdata__t.html#o33">has_graymode</a> = <a class="code" href="print-escp2_8c.html#a29">escp2_has_cap</a>(v, <a class="code" href="print-escp2_8h.html#a158a143">MODEL_GRAYMODE</a>, <a class="code" href="print-escp2_8h.html#a33">MODEL_GRAYMODE_YES</a>);
02151   pd-&gt;<a class="code" href="structescp2__privdata__t.html#o34">base_separation</a> = escp2_base_separation(v);
02152   pd-&gt;<a class="code" href="structescp2__privdata__t.html#o35">resolution_scale</a> = escp2_resolution_scale(v);
02153   pd-&gt;<a class="code" href="structescp2__privdata__t.html#o23">use_extended_commands</a> =
02154     <a class="code" href="print-escp2_8c.html#a70">escp2_use_extended_commands</a>(v, pd-&gt;<a class="code" href="structescp2__privdata__t.html#o42">res</a>-&gt;<a class="code" href="structres__t.html#o6">softweave</a>);
02155 }
02156 
02157 <span class="keyword">static</span> <span class="keywordtype">void</span>
<a name="l02158"></a><a class="code" href="print-escp2_8c.html#a80">02158</a> <a class="code" href="print-escp2_8c.html#a80">allocate_channels</a>(<a class="code" href="structstp__vars.html">stp_vars_t</a> *v, <span class="keywordtype">int</span> line_length)
02159 {
02160   <a class="code" href="structescp2__privdata__t.html">escp2_privdata_t</a> *pd = <a class="code" href="print-escp2_8c.html#a27">get_privdata</a>(v);
02161   <span class="keyword">const</span> <a class="code" href="structescp2__inkname__t.html">escp2_inkname_t</a> *ink_type = pd-&gt;<a class="code" href="structescp2__privdata__t.html#o14">inkname</a>;
02162   <span class="keywordtype">int</span> i;
02163   <span class="keywordtype">int</span> channel_id = 0;
02164 
02165   pd-&gt;<a class="code" href="structescp2__privdata__t.html#o18">cols</a> = <a class="code" href="group__util.html#ga29">stp_zalloc</a>(<span class="keyword">sizeof</span>(<span class="keywordtype">unsigned</span> <span class="keywordtype">char</span> *) * pd-&gt;<a class="code" href="structescp2__privdata__t.html#o17">channels_in_use</a>);
02166   pd-&gt;<a class="code" href="structescp2__privdata__t.html#o19">channels</a> =
02167     <a class="code" href="group__util.html#ga29">stp_zalloc</a>(<span class="keyword">sizeof</span>(<a class="code" href="structphysical__subchannel__t.html">physical_subchannel_t</a> *) * pd-&gt;<a class="code" href="structescp2__privdata__t.html#o17">channels_in_use</a>);
02168 
02169   <span class="keywordflow">for</span> (i = 0; i &lt; pd-&gt;<a class="code" href="structescp2__privdata__t.html#o15">logical_channels</a>; i++)
02170     {
02171       <span class="keyword">const</span> <a class="code" href="structink__channel__t.html">ink_channel_t</a> *channel = ink_type-&gt;<a class="code" href="structescp2__inkname__t.html#o3">channel_set</a>-&gt;<a class="code" href="structchannel__set__t.html#o1">channels</a>[i];
02172       <span class="keywordflow">if</span> (channel)
02173         {
02174           <span class="keywordtype">int</span> j;
02175           <span class="keywordflow">for</span> (j = 0; j &lt; channel-&gt;<a class="code" href="structink__channel__t.html#o2">n_subchannels</a>; j++)
02176             {
02177               pd-&gt;<a class="code" href="structescp2__privdata__t.html#o18">cols</a>[channel_id] = <a class="code" href="group__util.html#ga29">stp_zalloc</a>(line_length);
02178               pd-&gt;<a class="code" href="structescp2__privdata__t.html#o19">channels</a>[channel_id] = &amp;(channel-&gt;<a class="code" href="structink__channel__t.html#o1">subchannels</a>[j]);
02179               <a class="code" href="dither-inks_8c.html#a7">stp_dither_add_channel</a>(v, pd-&gt;<a class="code" href="structescp2__privdata__t.html#o18">cols</a>[channel_id], i, j);
02180               channel_id++;
02181             }
02182         }
02183     }
02184   <a class="code" href="group__vars.html#ga32">stp_set_string_parameter</a>(v, <span class="stringliteral">"STPIOutputType"</span>, <a class="code" href="print-escp2_8c.html#a68">escp2_describe_output</a>(v));
02185 }
02186 
02187 <span class="keyword">static</span> <span class="keywordtype">unsigned</span>
<a name="l02188"></a><a class="code" href="print-escp2_8c.html#a81">02188</a> <a class="code" href="print-weave_8c.html#a5">gcd</a>(<span class="keywordtype">unsigned</span> a, <span class="keywordtype">unsigned</span> b)
02189 {
02190   <span class="keywordtype">unsigned</span> tmp;
02191   <span class="keywordflow">if</span> (b &gt; a)
02192     {
02193       tmp = a;
02194       a = b;
02195       b = tmp;
02196     }
02197   <span class="keywordflow">while</span> (1)
02198     {
02199       tmp = a % b;
02200       <span class="keywordflow">if</span> (tmp == 0)
02201         <span class="keywordflow">return</span> b;
02202       a = b;
02203       b = tmp;
02204     }
02205 }
02206 
02207 <span class="keyword">static</span> <span class="keywordtype">unsigned</span>
<a name="l02208"></a><a class="code" href="print-escp2_8c.html#a82">02208</a> <a class="code" href="print-escp2_8c.html#a82">lcm</a>(<span class="keywordtype">unsigned</span> a, <span class="keywordtype">unsigned</span> b)
02209 {
02210   <span class="keywordflow">if</span> (a == b)
02211     <span class="keywordflow">return</span> a;
02212   <span class="keywordflow">else</span>
02213     <span class="keywordflow">return</span> a * b / <a class="code" href="print-weave_8c.html#a5">gcd</a>(a, b);
02214 }
02215 
02216 <span class="keyword">static</span> <span class="keywordtype">int</span>
<a name="l02217"></a><a class="code" href="print-escp2_8c.html#a83">02217</a> <a class="code" href="print-escp2_8c.html#a83">adjusted_vertical_resolution</a>(<span class="keyword">const</span> <a class="code" href="structres__t.html">res_t</a> *res)
02218 {
02219   <span class="keywordflow">if</span> (res-&gt;<a class="code" href="structres__t.html#o3">vres</a> &gt;= 720)
02220     <span class="keywordflow">return</span> res-&gt;<a class="code" href="structres__t.html#o3">vres</a>;
02221   <span class="keywordflow">else</span> <span class="keywordflow">if</span> (res-&gt;<a class="code" href="structres__t.html#o2">hres</a> &gt;= 720)    <span class="comment">/* Special case 720x360 */</span>
02222     <span class="keywordflow">return</span> 720;
02223   <span class="keywordflow">else</span> <span class="keywordflow">if</span> (res-&gt;<a class="code" href="structres__t.html#o3">vres</a> % 90 == 0)
02224     <span class="keywordflow">return</span> res-&gt;<a class="code" href="structres__t.html#o3">vres</a>;
02225   <span class="keywordflow">else</span>
02226     <span class="keywordflow">return</span> <a class="code" href="print-escp2_8c.html#a82">lcm</a>(res-&gt;<a class="code" href="structres__t.html#o2">hres</a>, res-&gt;<a class="code" href="structres__t.html#o3">vres</a>);
02227 }
02228 
02229 <span class="keyword">static</span> <span class="keywordtype">int</span>
<a name="l02230"></a><a class="code" href="print-escp2_8c.html#a84">02230</a> <a class="code" href="print-escp2_8c.html#a84">adjusted_horizontal_resolution</a>(<span class="keyword">const</span> <a class="code" href="structres__t.html">res_t</a> *res)
02231 {
02232   <span class="keywordflow">if</span> (res-&gt;<a class="code" href="structres__t.html#o3">vres</a> % 90 == 0)
02233     <span class="keywordflow">return</span> res-&gt;<a class="code" href="structres__t.html#o2">hres</a>;
02234   <span class="keywordflow">else</span>
02235     <span class="keywordflow">return</span> <a class="code" href="print-escp2_8c.html#a82">lcm</a>(res-&gt;<a class="code" href="structres__t.html#o2">hres</a>, res-&gt;<a class="code" href="structres__t.html#o3">vres</a>);
02236 }
02237 
02238 <span class="keyword">static</span> <span class="keywordtype">void</span>
<a name="l02239"></a><a class="code" href="print-escp2_8c.html#a85">02239</a> <a class="code" href="print-escp2_8c.html#a85">setup_resolution</a>(<a class="code" href="structstp__vars.html">stp_vars_t</a> *v)
02240 {
02241   <a class="code" href="structescp2__privdata__t.html">escp2_privdata_t</a> *pd = <a class="code" href="print-escp2_8c.html#a27">get_privdata</a>(v);
02242   <span class="keyword">const</span> <a class="code" href="structres__t.html">res_t</a> *res = <a class="code" href="print-escp2_8c.html#a26">escp2_find_resolution</a>(v);
02243   <span class="keywordtype">int</span> resid = <a class="code" href="print-escp2_8c.html#a42">compute_resid</a>(res);
02244 
02245   <span class="keywordtype">int</span> vertical = <a class="code" href="print-escp2_8c.html#a83">adjusted_vertical_resolution</a>(res);
02246   <span class="keywordtype">int</span> horizontal = <a class="code" href="print-escp2_8c.html#a84">adjusted_horizontal_resolution</a>(res);
02247 
02248   pd-&gt;<a class="code" href="structescp2__privdata__t.html#o42">res</a> = res;
02249   pd-&gt;<a class="code" href="structescp2__privdata__t.html#o41">physical_xdpi</a> = <a class="code" href="print-escp2_8c.html#a35">escp2_base_res</a>(v, resid);
02250   <span class="keywordflow">if</span> (pd-&gt;<a class="code" href="structescp2__privdata__t.html#o41">physical_xdpi</a> &gt; pd-&gt;<a class="code" href="structescp2__privdata__t.html#o42">res</a>-&gt;<a class="code" href="structres__t.html#o2">hres</a>)
02251     pd-&gt;<a class="code" href="structescp2__privdata__t.html#o41">physical_xdpi</a> = pd-&gt;<a class="code" href="structescp2__privdata__t.html#o42">res</a>-&gt;<a class="code" href="structres__t.html#o2">hres</a>;
02252 
02253   <span class="keywordflow">if</span> (<a class="code" href="print-escp2_8c.html#a70">escp2_use_extended_commands</a>(v, pd-&gt;<a class="code" href="structescp2__privdata__t.html#o42">res</a>-&gt;<a class="code" href="structres__t.html#o6">softweave</a>))
02254     {
02255       pd-&gt;<a class="code" href="structescp2__privdata__t.html#o9">unit_scale</a> = escp2_max_hres(v);
02256       pd-&gt;<a class="code" href="structescp2__privdata__t.html#o7">horizontal_units</a> = horizontal;
02257       pd-&gt;<a class="code" href="structescp2__privdata__t.html#o8">micro_units</a> = horizontal;
02258     }
02259   <span class="keywordflow">else</span>
02260     {
02261       pd-&gt;<a class="code" href="structescp2__privdata__t.html#o9">unit_scale</a> = 3600;
02262       <span class="keywordflow">if</span> (pd-&gt;<a class="code" href="structescp2__privdata__t.html#o42">res</a>-&gt;<a class="code" href="structres__t.html#o2">hres</a> &lt;= 720)
02263         pd-&gt;<a class="code" href="structescp2__privdata__t.html#o8">micro_units</a> = vertical;
02264       <span class="keywordflow">else</span>
02265         pd-&gt;<a class="code" href="structescp2__privdata__t.html#o8">micro_units</a> = horizontal;
02266       pd-&gt;<a class="code" href="structescp2__privdata__t.html#o7">horizontal_units</a> = vertical;
02267     }
02268   <span class="keywordflow">if</span> (<a class="code" href="print-escp2_8c.html#a29">escp2_has_cap</a>(v, <a class="code" href="print-escp2_8h.html#a158a139">MODEL_COMMAND</a>, <a class="code" href="print-escp2_8h.html#a19">MODEL_COMMAND_1999</a>) &amp;&amp;
02269       <a class="code" href="print-escp2_8c.html#a29">escp2_has_cap</a>(v, <a class="code" href="print-escp2_8h.html#a158a142">MODEL_VARIABLE_DOT</a>, <a class="code" href="print-escp2_8h.html#a29">MODEL_VARIABLE_NO</a>))
02270     pd-&gt;<a class="code" href="structescp2__privdata__t.html#o8">micro_units</a> = 1440;
02271   pd-&gt;<a class="code" href="structescp2__privdata__t.html#o6">vertical_units</a> = vertical;
02272   pd-&gt;<a class="code" href="structescp2__privdata__t.html#o5">page_management_units</a> = vertical;
02273   pd-&gt;<a class="code" href="structescp2__privdata__t.html#o36">printing_resolution</a> = <a class="code" href="print-escp2_8c.html#a35">escp2_base_res</a>(v, resid);
02274 }
02275 
02276 <span class="keyword">static</span> <span class="keywordtype">void</span>
<a name="l02277"></a><a class="code" href="print-escp2_8c.html#a86">02277</a> <a class="code" href="print-escp2_8c.html#a86">setup_softweave_parameters</a>(<a class="code" href="structstp__vars.html">stp_vars_t</a> *v)
02278 {
02279   <a class="code" href="structescp2__privdata__t.html">escp2_privdata_t</a> *pd = <a class="code" href="print-escp2_8c.html#a27">get_privdata</a>(v);
02280   pd-&gt;<a class="code" href="structescp2__privdata__t.html#o40">horizontal_passes</a> = pd-&gt;<a class="code" href="structescp2__privdata__t.html#o42">res</a>-&gt;<a class="code" href="structres__t.html#o4">printed_hres</a> / pd-&gt;<a class="code" href="structescp2__privdata__t.html#o41">physical_xdpi</a>;
02281   <span class="keywordflow">if</span> (pd-&gt;<a class="code" href="structescp2__privdata__t.html#o16">physical_channels</a> == 1 &amp;&amp;
02282       (pd-&gt;<a class="code" href="structescp2__privdata__t.html#o42">res</a>-&gt;<a class="code" href="structres__t.html#o3">vres</a> &gt;=
02283        (escp2_base_separation(v) / escp2_black_nozzle_separation(v))) &amp;&amp;
02284       (escp2_max_black_resolution(v) &lt; 0 ||
02285        pd-&gt;<a class="code" href="structescp2__privdata__t.html#o42">res</a>-&gt;<a class="code" href="structres__t.html#o3">vres</a> &lt;= escp2_max_black_resolution(v)) &amp;&amp;
02286       escp2_black_nozzles(v))
02287     pd-&gt;<a class="code" href="structescp2__privdata__t.html#o20">use_black_parameters</a> = 1;
02288   <span class="keywordflow">else</span>
02289     pd-&gt;<a class="code" href="structescp2__privdata__t.html#o20">use_black_parameters</a> = 0;
02290   <span class="keywordflow">if</span> (pd-&gt;<a class="code" href="structescp2__privdata__t.html#o21">use_fast_360</a>)
02291     {
02292       pd-&gt;<a class="code" href="structescp2__privdata__t.html#o0">nozzles</a> = escp2_fast_nozzles(v);
02293       pd-&gt;<a class="code" href="structescp2__privdata__t.html#o2">nozzle_separation</a> = escp2_fast_nozzle_separation(v);
02294       pd-&gt;<a class="code" href="structescp2__privdata__t.html#o1">min_nozzles</a> = escp2_min_fast_nozzles(v);
02295     }
02296   <span class="keywordflow">else</span> <span class="keywordflow">if</span> (pd-&gt;<a class="code" href="structescp2__privdata__t.html#o20">use_black_parameters</a>)
02297     {
02298       pd-&gt;<a class="code" href="structescp2__privdata__t.html#o0">nozzles</a> = escp2_black_nozzles(v);
02299       pd-&gt;<a class="code" href="structescp2__privdata__t.html#o2">nozzle_separation</a> = escp2_black_nozzle_separation(v);
02300       pd-&gt;<a class="code" href="structescp2__privdata__t.html#o1">min_nozzles</a> = escp2_min_black_nozzles(v);
02301     }
02302   <span class="keywordflow">else</span>
02303     {
02304       pd-&gt;<a class="code" href="structescp2__privdata__t.html#o0">nozzles</a> = escp2_nozzles(v);
02305       pd-&gt;<a class="code" href="structescp2__privdata__t.html#o2">nozzle_separation</a> = escp2_nozzle_separation(v);
02306       pd-&gt;<a class="code" href="structescp2__privdata__t.html#o1">min_nozzles</a> = escp2_min_nozzles(v);
02307     }
02308 }
02309 
02310 <span class="keyword">static</span> <span class="keywordtype">void</span>
<a name="l02311"></a><a class="code" href="print-escp2_8c.html#a87">02311</a> <a class="code" href="print-escp2_8c.html#a87">setup_printer_weave_parameters</a>(<a class="code" href="structstp__vars.html">stp_vars_t</a> *v)
02312 {
02313   <a class="code" href="structescp2__privdata__t.html">escp2_privdata_t</a> *pd = <a class="code" href="print-escp2_8c.html#a27">get_privdata</a>(v);
02314   pd-&gt;<a class="code" href="structescp2__privdata__t.html#o40">horizontal_passes</a> = 1;
02315   pd-&gt;<a class="code" href="structescp2__privdata__t.html#o0">nozzles</a> = 1;
02316   pd-&gt;<a class="code" href="structescp2__privdata__t.html#o2">nozzle_separation</a> = 1;
02317   pd-&gt;<a class="code" href="structescp2__privdata__t.html#o1">min_nozzles</a> = 1;
02318   pd-&gt;<a class="code" href="structescp2__privdata__t.html#o20">use_black_parameters</a> = 0;
02319 }
02320 
02321 <span class="keyword">static</span> <span class="keywordtype">void</span>
<a name="l02322"></a><a class="code" href="print-escp2_8c.html#a88">02322</a> <a class="code" href="print-escp2_8c.html#a88">setup_head_parameters</a>(<a class="code" href="structstp__vars.html">stp_vars_t</a> *v)
02323 {
02324   <a class="code" href="structescp2__privdata__t.html">escp2_privdata_t</a> *pd = <a class="code" href="print-escp2_8c.html#a27">get_privdata</a>(v);
02325   <span class="comment">/*</span>
02326 <span class="comment">   * Set up the output channels</span>
02327 <span class="comment">   */</span>
02328   <span class="keywordflow">if</span> (strcmp(<a class="code" href="group__vars.html#ga36">stp_get_string_parameter</a>(v, <span class="stringliteral">"PrintingMode"</span>), <span class="stringliteral">"BW"</span>) == 0)
02329     pd-&gt;<a class="code" href="structescp2__privdata__t.html#o15">logical_channels</a> = 1;
02330   <span class="keywordflow">else</span>
02331     pd-&gt;<a class="code" href="structescp2__privdata__t.html#o15">logical_channels</a> = pd-&gt;<a class="code" href="structescp2__privdata__t.html#o14">inkname</a>-&gt;<a class="code" href="structescp2__inkname__t.html#o3">channel_set</a>-&gt;<a class="code" href="structchannel__set__t.html#o2">channel_count</a>;
02332 
02333   pd-&gt;<a class="code" href="structescp2__privdata__t.html#o16">physical_channels</a> =
02334     <a class="code" href="print-escp2_8c.html#a75">compute_channel_count</a>(pd-&gt;<a class="code" href="structescp2__privdata__t.html#o14">inkname</a>, pd-&gt;<a class="code" href="structescp2__privdata__t.html#o15">logical_channels</a>);
02335   <span class="keywordflow">if</span> (pd-&gt;<a class="code" href="structescp2__privdata__t.html#o16">physical_channels</a> == 0)
02336     {
02337       pd-&gt;<a class="code" href="structescp2__privdata__t.html#o14">inkname</a> = &amp;<a class="code" href="escp2-channels_8c.html#a47">stpi_escp2_default_black_inkset</a>;
02338       pd-&gt;<a class="code" href="structescp2__privdata__t.html#o16">physical_channels</a> =
02339         <a class="code" href="print-escp2_8c.html#a75">compute_channel_count</a>(pd-&gt;<a class="code" href="structescp2__privdata__t.html#o14">inkname</a>, pd-&gt;<a class="code" href="structescp2__privdata__t.html#o15">logical_channels</a>);
02340     }
02341 
02342   pd-&gt;<a class="code" href="structescp2__privdata__t.html#o44">use_printer_weave</a> = <a class="code" href="print-escp2_8c.html#a46">use_printer_weave</a>(v);
02343   <span class="keywordflow">if</span> (pd-&gt;<a class="code" href="structescp2__privdata__t.html#o44">use_printer_weave</a>)
02344     {
02345       pd-&gt;<a class="code" href="structescp2__privdata__t.html#o43">printer_weave</a> = <a class="code" href="print-escp2_8c.html#a45">get_printer_weave</a>(v);
02346       <span class="keywordflow">if</span> (pd-&gt;<a class="code" href="structescp2__privdata__t.html#o42">res</a>-&gt;<a class="code" href="structres__t.html#o6">softweave</a> &amp;&amp; pd-&gt;<a class="code" href="structescp2__privdata__t.html#o43">printer_weave</a> &amp;&amp; pd-&gt;<a class="code" href="structescp2__privdata__t.html#o43">printer_weave</a>-&gt;<a class="code" href="structprinter__weave__t.html#o2">value</a> == 0)
02347         pd-&gt;<a class="code" href="structescp2__privdata__t.html#o43">printer_weave</a> = NULL;
02348     }
02349   
02350 
02351   <span class="keywordflow">if</span> (<a class="code" href="print-escp2_8c.html#a29">escp2_has_cap</a>(v, <a class="code" href="print-escp2_8h.html#a158a145">MODEL_FAST_360</a>, <a class="code" href="print-escp2_8h.html#a39">MODEL_FAST_360_YES</a>) &amp;&amp;
02352       (pd-&gt;<a class="code" href="structescp2__privdata__t.html#o14">inkname</a>-&gt;<a class="code" href="structescp2__inkname__t.html#o2">inkset</a> == <a class="code" href="print-escp2_8h.html#a156a130">INKSET_CMYK</a> || pd-&gt;<a class="code" href="structescp2__privdata__t.html#o16">physical_channels</a> == 1) &amp;&amp;
02353       pd-&gt;<a class="code" href="structescp2__privdata__t.html#o42">res</a>-&gt;<a class="code" href="structres__t.html#o2">hres</a> == pd-&gt;<a class="code" href="structescp2__privdata__t.html#o41">physical_xdpi</a> &amp;&amp; pd-&gt;<a class="code" href="structescp2__privdata__t.html#o42">res</a>-&gt;<a class="code" href="structres__t.html#o3">vres</a> == 360)
02354     pd-&gt;<a class="code" href="structescp2__privdata__t.html#o21">use_fast_360</a> = 1;
02355   <span class="keywordflow">else</span>
02356     pd-&gt;<a class="code" href="structescp2__privdata__t.html#o21">use_fast_360</a> = 0;
02357 
02358   <span class="comment">/*</span>
02359 <span class="comment">   * Set up the printer-specific parameters (weaving)</span>
02360 <span class="comment">   */</span>
02361   <span class="keywordflow">if</span> (pd-&gt;<a class="code" href="structescp2__privdata__t.html#o44">use_printer_weave</a>)
02362     <a class="code" href="print-escp2_8c.html#a87">setup_printer_weave_parameters</a>(v);
02363   <span class="keywordflow">else</span>
02364     <a class="code" href="print-escp2_8c.html#a86">setup_softweave_parameters</a>(v);
02365   pd-&gt;<a class="code" href="structescp2__privdata__t.html#o37">separation_rows</a> = escp2_separation_rows(v);
02366   pd-&gt;<a class="code" href="structescp2__privdata__t.html#o38">pseudo_separation_rows</a> = escp2_pseudo_separation_rows(v);
02367   pd-&gt;<a class="code" href="structescp2__privdata__t.html#o39">extra_720dpi_separation</a> = escp2_extra_720dpi_separation(v);
02368 
02369   <span class="keywordflow">if</span> (pd-&gt;<a class="code" href="structescp2__privdata__t.html#o40">horizontal_passes</a> == 0)
02370     pd-&gt;<a class="code" href="structescp2__privdata__t.html#o40">horizontal_passes</a> = 1;
02371 
02372   <a class="code" href="print-escp2_8c.html#a78">setup_head_offset</a>(v);
02373 
02374   <span class="keywordflow">if</span> (strcmp(<a class="code" href="group__vars.html#ga36">stp_get_string_parameter</a>(v, <span class="stringliteral">"PrintingMode"</span>), <span class="stringliteral">"BW"</span>) == 0 &amp;&amp;
02375       pd-&gt;<a class="code" href="structescp2__privdata__t.html#o16">physical_channels</a> == 1)
02376     {
02377       <span class="keywordflow">if</span> (pd-&gt;<a class="code" href="structescp2__privdata__t.html#o20">use_black_parameters</a>)
02378         pd-&gt;<a class="code" href="structescp2__privdata__t.html#o66">initial_vertical_offset</a> =
02379           escp2_black_initial_vertical_offset(v) * pd-&gt;<a class="code" href="structescp2__privdata__t.html#o5">page_management_units</a> /
02380           escp2_base_separation(v);
02381       <span class="keywordflow">else</span>
02382         pd-&gt;<a class="code" href="structescp2__privdata__t.html#o66">initial_vertical_offset</a> = pd-&gt;<a class="code" href="structescp2__privdata__t.html#o3">head_offset</a>[0] +
02383           (escp2_initial_vertical_offset(v) *
02384            pd-&gt;<a class="code" href="structescp2__privdata__t.html#o5">page_management_units</a> / escp2_base_separation(v));
02385     }
02386   <span class="keywordflow">else</span>
02387     pd-&gt;<a class="code" href="structescp2__privdata__t.html#o66">initial_vertical_offset</a> =
02388       escp2_initial_vertical_offset(v) * pd-&gt;<a class="code" href="structescp2__privdata__t.html#o5">page_management_units</a> /
02389       escp2_base_separation(v);
02390 
02391   pd-&gt;<a class="code" href="structescp2__privdata__t.html#o67">printing_initial_vertical_offset</a> = 0;
02392   pd-&gt;<a class="code" href="structescp2__privdata__t.html#o11">bitwidth</a> = <a class="code" href="print-escp2_8c.html#a34">escp2_bits</a>(v, <a class="code" href="print-escp2_8c.html#a43">compute_printed_resid</a>(pd-&gt;<a class="code" href="structescp2__privdata__t.html#o42">res</a>));
02393 }
02394 
02395 <span class="keyword">static</span> <span class="keywordtype">void</span>
<a name="l02396"></a><a class="code" href="print-escp2_8c.html#a89">02396</a> <a class="code" href="print-escp2_8c.html#a89">setup_page</a>(<a class="code" href="structstp__vars.html">stp_vars_t</a> *v)
02397 {
02398   <span class="keywordtype">int</span> n;
02399   <a class="code" href="structescp2__privdata__t.html">escp2_privdata_t</a> *pd = <a class="code" href="print-escp2_8c.html#a27">get_privdata</a>(v);
02400   <span class="keyword">const</span> <a class="code" href="structinput__slot__t.html">input_slot_t</a> *input_slot = <a class="code" href="print-escp2_8c.html#a44">get_input_slot</a>(v);
02401   <span class="keywordtype">int</span> extra_left = 0;
02402   <span class="keywordtype">int</span> extra_top = 0;
02403   <span class="keyword">const</span> <span class="keywordtype">char</span> *inner_radius_name = <a class="code" href="group__vars.html#ga36">stp_get_string_parameter</a>(v, <span class="stringliteral">"CDInnerRadius"</span>);
02404   <span class="keywordtype">int</span> hub_size = 43;            <span class="comment">/* 43 mm standard CD hub */</span>
02405 
02406   <span class="keywordflow">if</span> (inner_radius_name &amp;&amp; strcmp(inner_radius_name, <span class="stringliteral">"Small"</span>) == 0)
02407     hub_size = 16;              <span class="comment">/* 15 mm prints to the hole - play it</span>
02408 <span class="comment">                                   safe and print 16 mm */</span>
02409 
02410   <a class="code" href="group__papersize.html#ga13">stp_default_media_size</a>(v, &amp;n, &amp;(pd-&gt;<a class="code" href="structescp2__privdata__t.html#o51">page_true_height</a>));
02411   <a class="code" href="print-pcl_8c.html#a135">internal_imageable_area</a>(v, 0, &amp;pd-&gt;<a class="code" href="structescp2__privdata__t.html#o45">page_left</a>, &amp;pd-&gt;<a class="code" href="structescp2__privdata__t.html#o46">page_right</a>,
02412                           &amp;pd-&gt;<a class="code" href="structescp2__privdata__t.html#o48">page_bottom</a>, &amp;pd-&gt;<a class="code" href="structescp2__privdata__t.html#o47">page_top</a>);
02413 
02414   <span class="keywordflow">if</span> (input_slot &amp;&amp; input_slot-&gt;<a class="code" href="structinput__slot__t.html#o2">is_cd</a> &amp;&amp; escp2_cd_x_offset(v) &gt; 0)
02415     {
02416       <span class="keywordtype">int</span> left_center = escp2_cd_x_offset(v) +
02417         <a class="code" href="group__vars.html#ga66">stp_get_dimension_parameter</a>(v, <span class="stringliteral">"CDXAdjustment"</span>);
02418       <span class="keywordtype">int</span> top_center = escp2_cd_y_offset(v) +
02419         <a class="code" href="group__vars.html#ga66">stp_get_dimension_parameter</a>(v, <span class="stringliteral">"CDYAdjustment"</span>);
02420       extra_top = top_center - (pd-&gt;<a class="code" href="structescp2__privdata__t.html#o48">page_bottom</a> / 2);
02421       extra_left = left_center - (pd-&gt;<a class="code" href="structescp2__privdata__t.html#o46">page_right</a> / 2);
02422       pd-&gt;<a class="code" href="structescp2__privdata__t.html#o55">cd_inner_radius</a> = hub_size * pd-&gt;<a class="code" href="structescp2__privdata__t.html#o8">micro_units</a> * 10 / 254 / 2;
02423       pd-&gt;<a class="code" href="structescp2__privdata__t.html#o54">cd_outer_radius</a> = pd-&gt;<a class="code" href="structescp2__privdata__t.html#o46">page_right</a> * pd-&gt;<a class="code" href="structescp2__privdata__t.html#o8">micro_units</a> / 72 / 2;
02424       pd-&gt;<a class="code" href="structescp2__privdata__t.html#o52">cd_x_offset</a> =
02425         ((pd-&gt;<a class="code" href="structescp2__privdata__t.html#o46">page_right</a> / 2) - <a class="code" href="group__vars.html#ga18">stp_get_left</a>(v)) * pd-&gt;<a class="code" href="structescp2__privdata__t.html#o8">micro_units</a> / 72;
02426       pd-&gt;<a class="code" href="structescp2__privdata__t.html#o53">cd_y_offset</a> =
02427         ((pd-&gt;<a class="code" href="structescp2__privdata__t.html#o48">page_bottom</a> / 2) - <a class="code" href="group__vars.html#ga20">stp_get_top</a>(v)) * pd-&gt;<a class="code" href="structescp2__privdata__t.html#o8">micro_units</a> / 72;
02428       <span class="keywordflow">if</span> (escp2_cd_page_height(v))
02429         {
02430           pd-&gt;<a class="code" href="structescp2__privdata__t.html#o46">page_right</a> = escp2_cd_page_width(v);
02431           pd-&gt;<a class="code" href="structescp2__privdata__t.html#o48">page_bottom</a> = escp2_cd_page_height(v);
02432           pd-&gt;<a class="code" href="structescp2__privdata__t.html#o51">page_true_height</a> = escp2_cd_page_height(v);
02433         }
02434     }
02435 
02436   pd-&gt;<a class="code" href="structescp2__privdata__t.html#o46">page_right</a> += extra_left + 1;
02437   pd-&gt;<a class="code" href="structescp2__privdata__t.html#o49">page_width</a> = pd-&gt;<a class="code" href="structescp2__privdata__t.html#o46">page_right</a> - pd-&gt;<a class="code" href="structescp2__privdata__t.html#o45">page_left</a>;
02438   pd-&gt;<a class="code" href="structescp2__privdata__t.html#o59">image_left</a> = <a class="code" href="group__vars.html#ga18">stp_get_left</a>(v) - pd-&gt;<a class="code" href="structescp2__privdata__t.html#o45">page_left</a> + extra_left;
02439   pd-&gt;<a class="code" href="structescp2__privdata__t.html#o57">image_width</a> = <a class="code" href="group__vars.html#ga22">stp_get_width</a>(v);
02440   pd-&gt;<a class="code" href="structescp2__privdata__t.html#o60">image_scaled_width</a> = pd-&gt;<a class="code" href="structescp2__privdata__t.html#o57">image_width</a> * pd-&gt;<a class="code" href="structescp2__privdata__t.html#o42">res</a>-&gt;<a class="code" href="structres__t.html#o2">hres</a> / 72;
02441   pd-&gt;<a class="code" href="structescp2__privdata__t.html#o61">image_printed_width</a> = pd-&gt;<a class="code" href="structescp2__privdata__t.html#o57">image_width</a> * pd-&gt;<a class="code" href="structescp2__privdata__t.html#o42">res</a>-&gt;<a class="code" href="structres__t.html#o4">printed_hres</a> / 72;
02442   pd-&gt;<a class="code" href="structescp2__privdata__t.html#o64">image_left_position</a> = pd-&gt;<a class="code" href="structescp2__privdata__t.html#o59">image_left</a> * pd-&gt;<a class="code" href="structescp2__privdata__t.html#o8">micro_units</a> / 72;
02443 
02444 
02445   pd-&gt;<a class="code" href="structescp2__privdata__t.html#o48">page_bottom</a> += extra_top + 1;
02446   pd-&gt;<a class="code" href="structescp2__privdata__t.html#o51">page_true_height</a> += extra_top + 1;
02447   pd-&gt;<a class="code" href="structescp2__privdata__t.html#o50">page_height</a> = pd-&gt;<a class="code" href="structescp2__privdata__t.html#o48">page_bottom</a> - pd-&gt;<a class="code" href="structescp2__privdata__t.html#o47">page_top</a>;
02448   pd-&gt;<a class="code" href="structescp2__privdata__t.html#o58">image_top</a> = <a class="code" href="group__vars.html#ga20">stp_get_top</a>(v) - pd-&gt;<a class="code" href="structescp2__privdata__t.html#o47">page_top</a> + extra_top;
02449   pd-&gt;<a class="code" href="structescp2__privdata__t.html#o56">image_height</a> = <a class="code" href="group__vars.html#ga24">stp_get_height</a>(v);
02450   pd-&gt;<a class="code" href="structescp2__privdata__t.html#o62">image_scaled_height</a> = pd-&gt;<a class="code" href="structescp2__privdata__t.html#o56">image_height</a> * pd-&gt;<a class="code" href="structescp2__privdata__t.html#o42">res</a>-&gt;<a class="code" href="structres__t.html#o3">vres</a> / 72;
02451   pd-&gt;<a class="code" href="structescp2__privdata__t.html#o63">image_printed_height</a> = pd-&gt;<a class="code" href="structescp2__privdata__t.html#o56">image_height</a> * pd-&gt;<a class="code" href="structescp2__privdata__t.html#o42">res</a>-&gt;<a class="code" href="structres__t.html#o5">printed_vres</a> / 72;
02452 
02453   <span class="keywordflow">if</span> (input_slot &amp;&amp; input_slot-&gt;<a class="code" href="structinput__slot__t.html#o4">roll_feed_cut_flags</a>)
02454     {
02455       pd-&gt;<a class="code" href="structescp2__privdata__t.html#o51">page_true_height</a> += 4; <span class="comment">/* Empirically-determined constants */</span>
02456       pd-&gt;<a class="code" href="structescp2__privdata__t.html#o47">page_top</a> += 2;
02457       pd-&gt;<a class="code" href="structescp2__privdata__t.html#o48">page_bottom</a> += 2;
02458       pd-&gt;<a class="code" href="structescp2__privdata__t.html#o58">image_top</a> += 2;
02459       pd-&gt;<a class="code" href="structescp2__privdata__t.html#o50">page_height</a> += 2;
02460     }
02461 }
02462 
02463 <span class="keyword">static</span> <span class="keywordtype">void</span>
<a name="l02464"></a><a class="code" href="print-escp2_8c.html#a90">02464</a> <a class="code" href="print-escp2_8c.html#a90">set_mask</a>(<span class="keywordtype">unsigned</span> <span class="keywordtype">char</span> *cd_mask, <span class="keywordtype">int</span> x_center, <span class="keywordtype">int</span> scaled_x_where,
02465          <span class="keywordtype">int</span> limit, <span class="keywordtype">int</span> expansion, <span class="keywordtype">int</span> invert)
02466 {
02467   <span class="keywordtype">int</span> clear_val = invert ? 255 : 0;
02468   <span class="keywordtype">int</span> set_val = invert ? 0 : 255;
02469   <span class="keywordtype">int</span> bytesize = 8 / expansion;
02470   <span class="keywordtype">int</span> byteextra = bytesize - 1;
02471   <span class="keywordtype">int</span> first_x_on = x_center - scaled_x_where;
02472   <span class="keywordtype">int</span> first_x_off = x_center + scaled_x_where;
02473   <span class="keywordflow">if</span> (first_x_on &lt; 0)
02474     first_x_on = 0;
02475   <span class="keywordflow">if</span> (first_x_on &gt; limit)
02476     first_x_on = limit;
02477   <span class="keywordflow">if</span> (first_x_off &lt; 0)
02478     first_x_off = 0;
02479   <span class="keywordflow">if</span> (first_x_off &gt; limit)
02480     first_x_off = limit;
02481   first_x_on += byteextra;
02482   <span class="keywordflow">if</span> (first_x_off &gt; (first_x_on - byteextra))
02483     {
02484       <span class="keywordtype">int</span> first_x_on_byte = first_x_on / bytesize;
02485       <span class="keywordtype">int</span> first_x_on_mod = expansion * (byteextra - (first_x_on % bytesize));
02486       <span class="keywordtype">int</span> first_x_on_extra = ((1 &lt;&lt; first_x_on_mod) - 1) ^ clear_val;
02487       <span class="keywordtype">int</span> first_x_off_byte = first_x_off / bytesize;
02488       <span class="keywordtype">int</span> first_x_off_mod = expansion * (byteextra - (first_x_off % bytesize));
02489       <span class="keywordtype">int</span> first_x_off_extra = ((1 &lt;&lt; 8) - (1 &lt;&lt; first_x_off_mod)) ^ clear_val;
02490       <span class="keywordflow">if</span> (first_x_off_byte &lt; first_x_on_byte)
02491         {
02492           <span class="comment">/* This can happen, if 6 or fewer points are turned on */</span>
02493           cd_mask[first_x_on_byte] = first_x_on_extra &amp; first_x_off_extra;
02494         }
02495       <span class="keywordflow">else</span>
02496         {
02497           <span class="keywordflow">if</span> (first_x_on_extra != clear_val)
02498             cd_mask[first_x_on_byte - 1] = first_x_on_extra;
02499           <span class="keywordflow">if</span> (first_x_off_byte &gt; first_x_on_byte)
02500             memset(cd_mask + first_x_on_byte, set_val,
02501                    first_x_off_byte - first_x_on_byte);
02502           <span class="keywordflow">if</span> (first_x_off_extra != clear_val)
02503             cd_mask[first_x_off_byte] = first_x_off_extra;
02504         }
02505     }
02506 }  
02507 
02508 <span class="keyword">static</span> <span class="keywordtype">int</span>
<a name="l02509"></a><a class="code" href="print-escp2_8c.html#a91">02509</a> <a class="code" href="print-escp2_8c.html#a91">escp2_print_data</a>(<a class="code" href="structstp__vars.html">stp_vars_t</a> *v, <a class="code" href="structstp__image.html">stp_image_t</a> *image)
02510 {
02511   <a class="code" href="structescp2__privdata__t.html">escp2_privdata_t</a> *pd = <a class="code" href="print-escp2_8c.html#a27">get_privdata</a>(v);
02512   <span class="keywordtype">int</span> errdiv  = <a class="code" href="group__image.html#ga3">stp_image_height</a>(image) / pd-&gt;<a class="code" href="structescp2__privdata__t.html#o63">image_printed_height</a>;
02513   <span class="keywordtype">int</span> errmod  = <a class="code" href="group__image.html#ga3">stp_image_height</a>(image) % pd-&gt;<a class="code" href="structescp2__privdata__t.html#o63">image_printed_height</a>;
02514   <span class="keywordtype">int</span> errval  = 0;
02515   <span class="keywordtype">int</span> errlast = -1;
02516   <span class="keywordtype">int</span> errline  = 0;
02517   <span class="keywordtype">int</span> y;
02518   <span class="keywordtype">double</span> outer_r_sq = 0;
02519   <span class="keywordtype">double</span> inner_r_sq = 0;
02520   <span class="keywordtype">int</span> x_center = pd-&gt;<a class="code" href="structescp2__privdata__t.html#o52">cd_x_offset</a> * pd-&gt;<a class="code" href="structescp2__privdata__t.html#o42">res</a>-&gt;<a class="code" href="structres__t.html#o4">printed_hres</a> / pd-&gt;<a class="code" href="structescp2__privdata__t.html#o8">micro_units</a>;
02521   <span class="keywordtype">unsigned</span> <span class="keywordtype">char</span> *cd_mask = NULL;
02522   <span class="keywordflow">if</span> (pd-&gt;<a class="code" href="structescp2__privdata__t.html#o54">cd_outer_radius</a> &gt; 0)
02523     {
02524       cd_mask = <a class="code" href="group__util.html#ga28">stp_malloc</a>(1 + (pd-&gt;<a class="code" href="structescp2__privdata__t.html#o61">image_printed_width</a> + 7) / 8);
02525       outer_r_sq = (<span class="keywordtype">double</span>) pd-&gt;<a class="code" href="structescp2__privdata__t.html#o54">cd_outer_radius</a> * (<span class="keywordtype">double</span>) pd-&gt;<a class="code" href="structescp2__privdata__t.html#o54">cd_outer_radius</a>;
02526       inner_r_sq = (<span class="keywordtype">double</span>) pd-&gt;<a class="code" href="structescp2__privdata__t.html#o55">cd_inner_radius</a> * (<span class="keywordtype">double</span>) pd-&gt;<a class="code" href="structescp2__privdata__t.html#o55">cd_inner_radius</a>;
02527     }
02528 
02529   <span class="keywordflow">for</span> (y = 0; y &lt; pd-&gt;<a class="code" href="structescp2__privdata__t.html#o63">image_printed_height</a>; y ++)
02530     {
02531       <span class="keywordtype">int</span> duplicate_line = 1;
02532       <span class="keywordtype">unsigned</span> zero_mask;
02533 
02534       <span class="keywordflow">if</span> (errline != errlast)
02535         {
02536           errlast = errline;
02537           duplicate_line = 0;
02538           <span class="keywordflow">if</span> (<a class="code" href="group__color.html#ga14">stp_color_get_row</a>(v, image, errline, &amp;zero_mask))
02539             <span class="keywordflow">return</span> 2;
02540         }
02541 
02542       <span class="keywordflow">if</span> (cd_mask)
02543         {
02544           <span class="keywordtype">int</span> y_distance_from_center =
02545             pd-&gt;<a class="code" href="structescp2__privdata__t.html#o54">cd_outer_radius</a> - (y * pd-&gt;<a class="code" href="structescp2__privdata__t.html#o8">micro_units</a> / pd-&gt;<a class="code" href="structescp2__privdata__t.html#o42">res</a>-&gt;<a class="code" href="structres__t.html#o5">printed_vres</a>);
02546           <span class="keywordflow">if</span> (y_distance_from_center &lt; 0)
02547             y_distance_from_center = -y_distance_from_center;
02548           memset(cd_mask, 0, (pd-&gt;<a class="code" href="structescp2__privdata__t.html#o61">image_printed_width</a> + 7) / 8);
02549           <span class="keywordflow">if</span> (y_distance_from_center &lt; pd-&gt;<a class="code" href="structescp2__privdata__t.html#o54">cd_outer_radius</a>)
02550             {
02551               <span class="keywordtype">double</span> y_sq = (<span class="keywordtype">double</span>) y_distance_from_center *
02552                 (<span class="keywordtype">double</span>) y_distance_from_center;
02553               <span class="keywordtype">int</span> x_where = sqrt(outer_r_sq - y_sq) + .5;
02554               <span class="keywordtype">int</span> scaled_x_where = x_where * pd-&gt;<a class="code" href="structescp2__privdata__t.html#o42">res</a>-&gt;<a class="code" href="structres__t.html#o4">printed_hres</a> / pd-&gt;<a class="code" href="structescp2__privdata__t.html#o8">micro_units</a>;
02555               <a class="code" href="print-escp2_8c.html#a90">set_mask</a>(cd_mask, x_center, scaled_x_where,
02556                        pd-&gt;<a class="code" href="structescp2__privdata__t.html#o61">image_printed_width</a>, 1, 0);
02557               <span class="keywordflow">if</span> (y_distance_from_center &lt; pd-&gt;<a class="code" href="structescp2__privdata__t.html#o55">cd_inner_radius</a>)
02558                 {
02559                   x_where = sqrt(inner_r_sq - y_sq) + .5;
02560                   scaled_x_where = x_where * pd-&gt;<a class="code" href="structescp2__privdata__t.html#o42">res</a>-&gt;<a class="code" href="structres__t.html#o4">printed_hres</a> / pd-&gt;<a class="code" href="structescp2__privdata__t.html#o8">micro_units</a>;
02561                   <a class="code" href="print-escp2_8c.html#a90">set_mask</a>(cd_mask, x_center, scaled_x_where,
02562                            pd-&gt;<a class="code" href="structescp2__privdata__t.html#o61">image_printed_width</a>, 1, 1);
02563                 }
02564             }
02565         }
02566 
02567       <a class="code" href="dither-main_8c.html#a19">stp_dither</a>(v, y, duplicate_line, zero_mask, cd_mask);
02568 
02569       <a class="code" href="print-weave_8c.html#a47">stp_write_weave</a>(v, pd-&gt;<a class="code" href="structescp2__privdata__t.html#o18">cols</a>);
02570       errval += errmod;
02571       errline += errdiv;
02572       <span class="keywordflow">if</span> (errval &gt;= pd-&gt;<a class="code" href="structescp2__privdata__t.html#o63">image_printed_height</a>)
02573         {
02574           errval -= pd-&gt;<a class="code" href="structescp2__privdata__t.html#o63">image_printed_height</a>;
02575           errline ++;
02576         }
02577     }
02578   <span class="keywordflow">if</span> (cd_mask)
02579     <a class="code" href="group__util.html#ga31">stp_free</a>(cd_mask);
02580   <span class="keywordflow">return</span> 1;
02581 }
02582 
02583 <span class="keyword">static</span> <span class="keywordtype">int</span>
<a name="l02584"></a><a class="code" href="print-escp2_8c.html#a92">02584</a> <a class="code" href="print-escp2_8c.html#a92">escp2_print_page</a>(<a class="code" href="structstp__vars.html">stp_vars_t</a> *v, <a class="code" href="structstp__image.html">stp_image_t</a> *image)
02585 {
02586   <span class="keywordtype">int</span> status;
02587   <span class="keywordtype">int</span> i;
02588   <a class="code" href="structescp2__privdata__t.html">escp2_privdata_t</a> *pd = <a class="code" href="print-escp2_8c.html#a27">get_privdata</a>(v);
02589   <span class="keywordtype">int</span> out_channels;             <span class="comment">/* Output bytes per pixel */</span>
02590   <span class="keywordtype">int</span> line_width = (pd-&gt;<a class="code" href="structescp2__privdata__t.html#o61">image_printed_width</a> + 7) / 8 * pd-&gt;<a class="code" href="structescp2__privdata__t.html#o11">bitwidth</a>;
02591   <span class="keywordtype">int</span> weave_pattern = <a class="code" href="weave_8h.html#a26a11">STP_WEAVE_ZIGZAG</a>;
02592   <span class="keywordflow">if</span> (<a class="code" href="group__vars.html#ga100">stp_check_string_parameter</a>(v, <span class="stringliteral">"Weave"</span>, <a class="code" href="group__vars.html#gga135a32">STP_PARAMETER_ACTIVE</a>))
02593     {
02594       <span class="keyword">const</span> <span class="keywordtype">char</span> *weave = <a class="code" href="group__vars.html#ga36">stp_get_string_parameter</a>(v, <span class="stringliteral">"Weave"</span>);
02595       <span class="keywordflow">if</span> (strcmp(weave, <span class="stringliteral">"Alternate"</span>) == 0)
02596         weave_pattern = <a class="code" href="weave_8h.html#a26a11">STP_WEAVE_ZIGZAG</a>;
02597       <span class="keywordflow">else</span> <span class="keywordflow">if</span> (strcmp(weave, <span class="stringliteral">"Ascending"</span>) == 0)
02598         weave_pattern = <a class="code" href="weave_8h.html#a26a12">STP_WEAVE_ASCENDING</a>;
02599       <span class="keywordflow">else</span> <span class="keywordflow">if</span> (strcmp(weave, <span class="stringliteral">"Descending"</span>) == 0)
02600         weave_pattern = <a class="code" href="weave_8h.html#a26a13">STP_WEAVE_DESCENDING</a>;
02601       <span class="keywordflow">else</span> <span class="keywordflow">if</span> (strcmp(weave, <span class="stringliteral">"Ascending2X"</span>) == 0)
02602         weave_pattern = <a class="code" href="weave_8h.html#a26a14">STP_WEAVE_ASCENDING_2X</a>;
02603       <span class="keywordflow">else</span> <span class="keywordflow">if</span> (strcmp(weave, <span class="stringliteral">"Staggered"</span>) == 0)
02604         weave_pattern = <a class="code" href="weave_8h.html#a26a15">STP_WEAVE_STAGGERED</a>;
02605     }
02606 
02607   <a class="code" href="weave_8h.html#a17">stp_initialize_weave</a>
02608     (v,
02609      pd-&gt;<a class="code" href="structescp2__privdata__t.html#o0">nozzles</a>,
02610      pd-&gt;<a class="code" href="structescp2__privdata__t.html#o2">nozzle_separation</a> * pd-&gt;<a class="code" href="structescp2__privdata__t.html#o42">res</a>-&gt;<a class="code" href="structres__t.html#o3">vres</a> / escp2_base_separation(v),
02611      pd-&gt;<a class="code" href="structescp2__privdata__t.html#o40">horizontal_passes</a>,
02612      pd-&gt;<a class="code" href="structescp2__privdata__t.html#o42">res</a>-&gt;<a class="code" href="structres__t.html#o8">vertical_passes</a>,
02613      1,
02614      pd-&gt;<a class="code" href="structescp2__privdata__t.html#o17">channels_in_use</a>,
02615      pd-&gt;<a class="code" href="structescp2__privdata__t.html#o11">bitwidth</a>,
02616      pd-&gt;<a class="code" href="structescp2__privdata__t.html#o61">image_printed_width</a>,
02617      pd-&gt;<a class="code" href="structescp2__privdata__t.html#o63">image_printed_height</a>,
02618      pd-&gt;<a class="code" href="structescp2__privdata__t.html#o58">image_top</a> * pd-&gt;<a class="code" href="structescp2__privdata__t.html#o42">res</a>-&gt;<a class="code" href="structres__t.html#o3">vres</a> / 72,
02619      (pd-&gt;<a class="code" href="structescp2__privdata__t.html#o50">page_height</a> + escp2_extra_feed(v)) * pd-&gt;<a class="code" href="structescp2__privdata__t.html#o42">res</a>-&gt;<a class="code" href="structres__t.html#o3">vres</a> / 72,
02620      pd-&gt;<a class="code" href="structescp2__privdata__t.html#o3">head_offset</a>,
02621      weave_pattern,
02622      <a class="code" href="escp2-driver_8c.html#a24">stpi_escp2_flush_pass</a>,
02623      <a class="code" href="print-escp2_8h.html#a53">FILLFUNC</a>,
02624      <a class="code" href="print-escp2_8h.html#a55">PACKFUNC</a>,
02625      <a class="code" href="print-escp2_8h.html#a54">COMPUTEFUNC</a>);
02626 
02627   <a class="code" href="dither-main_8c.html#a13">stp_dither_init</a>(v, image, pd-&gt;<a class="code" href="structescp2__privdata__t.html#o61">image_printed_width</a>, pd-&gt;<a class="code" href="structescp2__privdata__t.html#o42">res</a>-&gt;<a class="code" href="structres__t.html#o4">printed_hres</a>,
02628                   pd-&gt;<a class="code" href="structescp2__privdata__t.html#o42">res</a>-&gt;<a class="code" href="structres__t.html#o5">printed_vres</a>);
02629   <a class="code" href="print-escp2_8c.html#a80">allocate_channels</a>(v, line_width);
02630   <a class="code" href="print-escp2_8c.html#a73">adjust_print_quality</a>(v, image);
02631   out_channels = <a class="code" href="group__color.html#ga13">stp_color_init</a>(v, image, 65536);
02632 
02633 <span class="comment">/*  stpi_dither_set_expansion(v, pd-&gt;res-&gt;hres / pd-&gt;res-&gt;printed_hres); */</span>
02634 
02635   <a class="code" href="print-escp2_8c.html#a77">setup_inks</a>(v);
02636 
02637   status = <a class="code" href="print-escp2_8c.html#a91">escp2_print_data</a>(v, image);
02638   <a class="code" href="group__image.html#ga6">stp_image_conclude</a>(image);
02639   <a class="code" href="print-weave_8c.html#a45">stp_flush_all</a>(v);
02640   <a class="code" href="print-escp2_8h.html#a154">stpi_escp2_terminate_page</a>(v);
02641 
02642   <span class="comment">/*</span>
02643 <span class="comment">   * Cleanup...</span>
02644 <span class="comment">   */</span>
02645   <span class="keywordflow">for</span> (i = 0; i &lt; pd-&gt;<a class="code" href="structescp2__privdata__t.html#o17">channels_in_use</a>; i++)
02646     <span class="keywordflow">if</span> (pd-&gt;<a class="code" href="structescp2__privdata__t.html#o18">cols</a>[i])
02647       <a class="code" href="group__util.html#ga31">stp_free</a>(pd-&gt;<a class="code" href="structescp2__privdata__t.html#o18">cols</a>[i]);
02648   <a class="code" href="group__util.html#ga31">stp_free</a>(pd-&gt;<a class="code" href="structescp2__privdata__t.html#o18">cols</a>);
02649   <a class="code" href="group__util.html#ga31">stp_free</a>(pd-&gt;<a class="code" href="structescp2__privdata__t.html#o19">channels</a>);
02650   <span class="keywordflow">return</span> status;
02651 }
02652 
02653 <span class="comment">/*</span>
02654 <span class="comment"> * 'escp2_print()' - Print an image to an EPSON printer.</span>
02655 <span class="comment"> */</span>
02656 <span class="keyword">static</span> <span class="keywordtype">int</span>
<a name="l02657"></a><a class="code" href="print-escp2_8c.html#a93">02657</a> <a class="code" href="print-escp2_8c.html#a93">escp2_do_print</a>(<a class="code" href="structstp__vars.html">stp_vars_t</a> *v, <a class="code" href="structstp__image.html">stp_image_t</a> *image, <span class="keywordtype">int</span> print_op)
02658 {
02659   <span class="keywordtype">int</span> status = 1;
02660 
02661   <a class="code" href="structescp2__privdata__t.html">escp2_privdata_t</a> *pd;
02662 
02663   <span class="keywordflow">if</span> (!<a class="code" href="group__vars.html#ga34">stp_verify</a>(v))
02664     {
02665       <a class="code" href="print-util_8c.html#a18">stp_eprintf</a>(v, <a class="code" href="group__intl__internal.html#ga5">_</a>(<span class="stringliteral">"Print options not verified; cannot print.\n"</span>));
02666       <span class="keywordflow">return</span> 0;
02667     }
02668   <a class="code" href="group__image.html#ga0">stp_image_init</a>(image);
02669 
02670   <span class="keywordflow">if</span> (strcmp(<a class="code" href="group__vars.html#ga36">stp_get_string_parameter</a>(v, <span class="stringliteral">"InputImageType"</span>), <span class="stringliteral">"Raw"</span>) == 0 &amp;&amp;
02671       !<a class="code" href="print-escp2_8c.html#a71">set_raw_ink_type</a>(v))
02672     <span class="keywordflow">return</span> 0;
02673 
02674   pd = (<a class="code" href="structescp2__privdata__t.html">escp2_privdata_t</a> *) <a class="code" href="group__util.html#ga29">stp_zalloc</a>(<span class="keyword">sizeof</span>(<a class="code" href="structescp2__privdata__t.html">escp2_privdata_t</a>));
02675   pd-&gt;<a class="code" href="structescp2__privdata__t.html#o65">printed_something</a> = 0;
02676   pd-&gt;<a class="code" href="structescp2__privdata__t.html#o68">last_color</a> = -1;
02677   pd-&gt;<a class="code" href="structescp2__privdata__t.html#o69">last_pass_offset</a> = 0;
02678   pd-&gt;<a class="code" href="structescp2__privdata__t.html#o70">last_pass</a> = -1;
02679   pd-&gt;<a class="code" href="structescp2__privdata__t.html#o10">send_zero_pass_advance</a> =
02680     <a class="code" href="print-escp2_8c.html#a29">escp2_has_cap</a>(v, <a class="code" href="print-escp2_8h.html#a158a146">MODEL_SEND_ZERO_ADVANCE</a>, <a class="code" href="print-escp2_8h.html#a42">MODEL_SEND_ZERO_ADVANCE_YES</a>);
02681   <a class="code" href="group__vars.html#ga18">stp_allocate_component_data</a>(v, <span class="stringliteral">"Driver"</span>, NULL, NULL, pd);
02682 
02683   pd-&gt;<a class="code" href="structescp2__privdata__t.html#o14">inkname</a> = <a class="code" href="print-escp2_8c.html#a53">get_inktype</a>(v);
02684   pd-&gt;<a class="code" href="structescp2__privdata__t.html#o17">channels_in_use</a> = <a class="code" href="print-escp2_8c.html#a74">count_channels</a>(pd-&gt;<a class="code" href="structescp2__privdata__t.html#o14">inkname</a>);
02685 
02686   <a class="code" href="print-escp2_8c.html#a85">setup_resolution</a>(v);
02687   <a class="code" href="print-escp2_8c.html#a88">setup_head_parameters</a>(v);
02688   <a class="code" href="print-escp2_8c.html#a89">setup_page</a>(v);
02689   <a class="code" href="print-escp2_8c.html#a79">setup_misc</a>(v);
02690 
02691   <a class="code" href="print-escp2_8c.html#a72">adjust_density_and_ink_type</a>(v, image);
02692   <span class="keywordflow">if</span> (print_op &amp; <a class="code" href="print-escp2_8c.html#a0">OP_JOB_START</a>)
02693     <a class="code" href="print-escp2_8h.html#a151">stpi_escp2_init_printer</a>(v);
02694   <span class="keywordflow">if</span> (print_op &amp; <a class="code" href="print-escp2_8c.html#a1">OP_JOB_PRINT</a>)
02695     status = <a class="code" href="print-escp2_8c.html#a92">escp2_print_page</a>(v, image);
02696   <span class="keywordflow">if</span> (print_op &amp; <a class="code" href="print-escp2_8c.html#a2">OP_JOB_END</a>)
02697     <a class="code" href="print-escp2_8h.html#a152">stpi_escp2_deinit_printer</a>(v);
02698 
02699   <a class="code" href="group__util.html#ga31">stp_free</a>(pd-&gt;<a class="code" href="structescp2__privdata__t.html#o3">head_offset</a>);
02700   <a class="code" href="group__util.html#ga31">stp_free</a>(pd);
02701 
02702   <span class="keywordflow">return</span> status;
02703 }
02704 
02705 <span class="keyword">static</span> <span class="keywordtype">int</span>
<a name="l02706"></a><a class="code" href="print-escp2_8c.html#a94">02706</a> <a class="code" href="print-escp2_8c.html#a94">escp2_print</a>(<span class="keyword">const</span> <a class="code" href="structstp__vars.html">stp_vars_t</a> *v, <a class="code" href="structstp__image.html">stp_image_t</a> *image)
02707 {
02708   <a class="code" href="structstp__vars.html">stp_vars_t</a> *nv = <a class="code" href="group__vars.html#ga78">stp_vars_create_copy</a>(v);
02709   <span class="keywordtype">int</span> op = <a class="code" href="print-escp2_8c.html#a1">OP_JOB_PRINT</a>;
02710   <span class="keywordtype">int</span> status;
02711   <span class="keywordflow">if</span> (!<a class="code" href="group__vars.html#ga36">stp_get_string_parameter</a>(v, <span class="stringliteral">"JobMode"</span>) ||
02712       strcmp(<a class="code" href="group__vars.html#ga36">stp_get_string_parameter</a>(v, <span class="stringliteral">"JobMode"</span>), <span class="stringliteral">"Page"</span>) == 0)
02713     op = <a class="code" href="print-escp2_8c.html#a0">OP_JOB_START</a> | <a class="code" href="print-escp2_8c.html#a1">OP_JOB_PRINT</a> | <a class="code" href="print-escp2_8c.html#a2">OP_JOB_END</a>;
02714   <a class="code" href="group__util.html#ga77">stp_prune_inactive_options</a>(nv);
02715   status = <a class="code" href="print-escp2_8c.html#a93">escp2_do_print</a>(nv, image, op);
02716   <a class="code" href="group__vars.html#ga26">stp_vars_destroy</a>(nv);
02717   <span class="keywordflow">return</span> status;
02718 }
02719 
02720 <span class="keyword">static</span> <span class="keywordtype">int</span>
<a name="l02721"></a><a class="code" href="print-escp2_8c.html#a95">02721</a> <a class="code" href="print-escp2_8c.html#a95">escp2_job_start</a>(<span class="keyword">const</span> <a class="code" href="structstp__vars.html">stp_vars_t</a> *v, <a class="code" href="structstp__image.html">stp_image_t</a> *image)
02722 {
02723   <a class="code" href="structstp__vars.html">stp_vars_t</a> *nv = <a class="code" href="group__vars.html#ga78">stp_vars_create_copy</a>(v);
02724   <span class="keywordtype">int</span> status;
02725   <a class="code" href="group__util.html#ga77">stp_prune_inactive_options</a>(nv);
02726   status = <a class="code" href="print-escp2_8c.html#a93">escp2_do_print</a>(nv, image, <a class="code" href="print-escp2_8c.html#a0">OP_JOB_START</a>);
02727   <a class="code" href="group__vars.html#ga26">stp_vars_destroy</a>(nv);
02728   <span class="keywordflow">return</span> status;
02729 }
02730 
02731 <span class="keyword">static</span> <span class="keywordtype">int</span>
<a name="l02732"></a><a class="code" href="print-escp2_8c.html#a96">02732</a> <a class="code" href="print-escp2_8c.html#a96">escp2_job_end</a>(<span class="keyword">const</span> <a class="code" href="structstp__vars.html">stp_vars_t</a> *v, <a class="code" href="structstp__image.html">stp_image_t</a> *image)
02733 {
02734   <a class="code" href="structstp__vars.html">stp_vars_t</a> *nv = <a class="code" href="group__vars.html#ga78">stp_vars_create_copy</a>(v);
02735   <span class="keywordtype">int</span> status;
02736   <a class="code" href="group__util.html#ga77">stp_prune_inactive_options</a>(nv);
02737   status = <a class="code" href="print-escp2_8c.html#a93">escp2_do_print</a>(nv, image, <a class="code" href="print-escp2_8c.html#a2">OP_JOB_END</a>);
02738   <a class="code" href="group__vars.html#ga26">stp_vars_destroy</a>(nv);
02739   <span class="keywordflow">return</span> status;
02740 }
02741 
<a name="l02742"></a><a class="code" href="print-escp2_8c.html#a22">02742</a> <span class="keyword">static</span> <span class="keyword">const</span> <a class="code" href="structstp__printfuncs__t.html">stp_printfuncs_t</a> <a class="code" href="print-escp2_8c.html#a22">print_escp2_printfuncs</a> =
02743 {
02744   <a class="code" href="print-escp2_8c.html#a55">escp2_list_parameters</a>,
02745   <a class="code" href="print-escp2_8c.html#a62">escp2_parameters</a>,
02746   <a class="code" href="group__papersize.html#ga4">stp_default_media_size</a>,
02747   <a class="code" href="print-escp2_8c.html#a65">escp2_imageable_area</a>,
02748   <a class="code" href="print-escp2_8c.html#a66">escp2_limit</a>,
02749   <a class="code" href="print-escp2_8c.html#a94">escp2_print</a>,
02750   <a class="code" href="print-escp2_8c.html#a67">escp2_describe_resolution</a>,
02751   <a class="code" href="print-escp2_8c.html#a68">escp2_describe_output</a>,
02752   <a class="code" href="group__printer.html#ga19">stp_verify_printer_params</a>,
02753   <a class="code" href="print-escp2_8c.html#a95">escp2_job_start</a>,
02754   <a class="code" href="print-escp2_8c.html#a96">escp2_job_end</a>
02755 };
02756 
<a name="l02757"></a><a class="code" href="print-escp2_8c.html#a23">02757</a> <span class="keyword">static</span> <a class="code" href="structstp__family.html">stp_family_t</a> <a class="code" href="print-escp2_8c.html#a23">print_escp2_module_data</a> =
02758   {
02759     &amp;<a class="code" href="print-escp2_8c.html#a22">print_escp2_printfuncs</a>,
02760     NULL
02761   };
02762 
02763 
02764 <span class="keyword">static</span> <span class="keywordtype">int</span>
<a name="l02765"></a><a class="code" href="print-escp2_8c.html#a97">02765</a> <a class="code" href="print-escp2_8c.html#a97">print_escp2_module_init</a>(<span class="keywordtype">void</span>)
02766 {
02767   <span class="keywordflow">return</span> <a class="code" href="group__printer.html#ga46">stp_family_register</a>(<a class="code" href="print-escp2_8c.html#a23">print_escp2_module_data</a>.<a class="code" href="structstp__family.html#o1">printer_list</a>);
02768 }
02769 
02770 
02771 <span class="keyword">static</span> <span class="keywordtype">int</span>
<a name="l02772"></a><a class="code" href="print-escp2_8c.html#a98">02772</a> <a class="code" href="print-escp2_8c.html#a98">print_escp2_module_exit</a>(<span class="keywordtype">void</span>)
02773 {
02774   <span class="keywordflow">return</span> <a class="code" href="group__printer.html#ga47">stp_family_unregister</a>(<a class="code" href="print-escp2_8c.html#a23">print_escp2_module_data</a>.<a class="code" href="structstp__family.html#o1">printer_list</a>);
02775 }
02776 
02777 
02778 <span class="comment">/* Module header */</span>
<a name="l02779"></a><a class="code" href="print-escp2_8c.html#a12">02779</a> <span class="preprocessor">#define stp_module_version print_escp2_LTX_stp_module_version</span>
<a name="l02780"></a><a class="code" href="print-escp2_8c.html#a13">02780</a> <span class="preprocessor"></span><span class="preprocessor">#define stp_module_data print_escp2_LTX_stp_module_data</span>
02781 <span class="preprocessor"></span>
<a name="l02782"></a><a class="code" href="print-escp2_8c.html#a24">02782</a> <a class="code" href="structstp__module__version.html">stp_module_version_t</a> <a class="code" href="structstp__module__version.html">stp_module_version</a> = {0, 0};
02783 
<a name="l02784"></a><a class="code" href="print-escp2_8c.html#a25">02784</a> <a class="code" href="structstp__module.html">stp_module_t</a> <a class="code" href="print-canon_8c.html#a45">stp_module_data</a> =
02785   {
02786     <span class="stringliteral">"escp2"</span>,
02787     VERSION,
02788     <span class="stringliteral">"Epson family driver"</span>,
02789     <a class="code" href="module_8h.html#a13a4">STP_MODULE_CLASS_FAMILY</a>,
02790     NULL,
02791     <a class="code" href="print-escp2_8c.html#a97">print_escp2_module_init</a>,
02792     <a class="code" href="print-escp2_8c.html#a98">print_escp2_module_exit</a>,
02793     (<span class="keywordtype">void</span> *) &amp;<a class="code" href="print-escp2_8c.html#a23">print_escp2_module_data</a>
02794   };
02795 
</pre></div><hr size="1"><address style="align: right;"><small>Generated on Wed Aug 25 07:56:14 2004 for libgimpprint API Reference by
<a href="http://www.doxygen.org/index.html">
<img src="doxygen.png" alt="doxygen" align="middle" border=0 > </a>1.3.6 </small></address>
</body>
</html>
