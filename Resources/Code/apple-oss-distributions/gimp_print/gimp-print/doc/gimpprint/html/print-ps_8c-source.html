<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html><head><meta http-equiv="Content-Type" content="text/html;charset=iso-8859-1">
<title>libgimpprint API Reference: src/main/print-ps.c Source File</title>
<link href="doxygen.css" rel="stylesheet" type="text/css">
</head><body>
<!-- Generated by Doxygen 1.3.6 -->
<div class="qindex"><a class="qindex" href="index.html">Main&nbsp;Page</a> | <a class="qindex" href="modules.html">Modules</a> | <a class="qindex" href="classes.html">Alphabetical&nbsp;List</a> | <a class="qindex" href="annotated.html">Data&nbsp;Structures</a> | <a class="qindex" href="files.html">File&nbsp;List</a> | <a class="qindex" href="functions.html">Data&nbsp;Fields</a> | <a class="qindex" href="globals.html">Globals</a> | <a class="qindex" href="pages.html">Related&nbsp;Pages</a></div>
<h1>src/main/print-ps.c</h1><a href="print-ps_8c.html">Go to the documentation of this file.</a><div class="fragment"><pre>00001 <span class="comment">/*</span>
00002 <span class="comment"> * "$Id: print-ps_8c-source.html,v 1.1.1.2 2004/12/22 23:49:09 jlovell Exp $"</span>
00003 <span class="comment"> *</span>
00004 <span class="comment"> *   Print plug-in Adobe PostScript driver for the GIMP.</span>
00005 <span class="comment"> *</span>
00006 <span class="comment"> *   Copyright 1997-2002 Michael Sweet (mike@easysw.com) and</span>
00007 <span class="comment"> *      Robert Krawitz (rlk@alum.mit.edu)</span>
00008 <span class="comment"> *</span>
00009 <span class="comment"> *   This program is free software; you can redistribute it and/or modify it</span>
00010 <span class="comment"> *   under the terms of the GNU General Public License as published by the Free</span>
00011 <span class="comment"> *   Software Foundation; either version 2 of the License, or (at your option)</span>
00012 <span class="comment"> *   any later version.</span>
00013 <span class="comment"> *</span>
00014 <span class="comment"> *   This program is distributed in the hope that it will be useful, but</span>
00015 <span class="comment"> *   WITHOUT ANY WARRANTY; without even the implied warranty of MERCHANTABILITY</span>
00016 <span class="comment"> *   or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU General Public License</span>
00017 <span class="comment"> *   for more details.</span>
00018 <span class="comment"> *</span>
00019 <span class="comment"> *   You should have received a copy of the GNU General Public License</span>
00020 <span class="comment"> *   along with this program; if not, write to the Free Software</span>
00021 <span class="comment"> *   Foundation, Inc., 59 Temple Place - Suite 330, Boston, MA 02111-1307, USA.</span>
00022 <span class="comment"> */</span>
00023 
00024 <span class="comment">/*</span>
00025 <span class="comment"> * This file must include only standard C header files.  The core code must</span>
00026 <span class="comment"> * compile on generic platforms that don't support glib, gimp, gtk, etc.</span>
00027 <span class="comment"> */</span>
00028 
00029 <span class="preprocessor">#ifdef HAVE_CONFIG_H</span>
00030 <span class="preprocessor"></span><span class="preprocessor">#include &lt;config.h&gt;</span>
00031 <span class="preprocessor">#endif</span>
00032 <span class="preprocessor"></span><span class="preprocessor">#include &lt;<a class="code" href="gimp-print_8h.html">gimp-print/gimp-print.h</a>&gt;</span>
00033 <span class="preprocessor">#include &lt;<a class="code" href="gimp-print-intl-internal_8h.html">gimp-print/gimp-print-intl-internal.h</a>&gt;</span>
00034 <span class="preprocessor">#include "<a class="code" href="gimp-print-internal_8h.html">gimp-print-internal.h</a>"</span>
00035 <span class="preprocessor">#include &lt;time.h&gt;</span>
00036 <span class="preprocessor">#include &lt;string.h&gt;</span>
00037 <span class="preprocessor">#ifdef HAVE_LIMITS_H</span>
00038 <span class="preprocessor"></span><span class="preprocessor">#include &lt;limits.h&gt;</span>
00039 <span class="preprocessor">#endif</span>
00040 <span class="preprocessor"></span><span class="preprocessor">#include &lt;stdio.h&gt;</span>
00041 
00042 <span class="preprocessor">#ifdef _MSC_VER</span>
00043 <span class="preprocessor"></span><span class="preprocessor">#define strncasecmp(s,t,n) _strnicmp(s,t,n)</span>
00044 <span class="preprocessor"></span><span class="preprocessor">#define strcasecmp(s,t) _stricmp(s,t)</span>
00045 <span class="preprocessor"></span><span class="preprocessor">#endif</span>
00046 <span class="preprocessor"></span>
00047 <span class="comment">/*</span>
00048 <span class="comment"> * Local variables...</span>
00049 <span class="comment"> */</span>
00050 
<a name="l00051"></a><a class="code" href="print-ps_8c.html#a2">00051</a> <span class="keyword">static</span> FILE     *<a class="code" href="print-ps_8c.html#a2">ps_ppd</a> = NULL;
<a name="l00052"></a><a class="code" href="print-ps_8c.html#a3">00052</a> <span class="keyword">static</span> <span class="keyword">const</span> <span class="keywordtype">char</span>       *<a class="code" href="print-ps_8c.html#a3">ps_ppd_file</a> = NULL;
00053 
00054 
00055 <span class="comment">/*</span>
00056 <span class="comment"> * Local functions...</span>
00057 <span class="comment"> */</span>
00058 
00059 <span class="keyword">static</span> <span class="keywordtype">void</span>     <a class="code" href="print-ps_8c.html#a10">ps_hex</a>(<span class="keyword">const</span> <a class="code" href="structstp__vars.html">stp_vars_t</a> *, <span class="keywordtype">unsigned</span> <span class="keywordtype">short</span> *, <span class="keywordtype">int</span>);
00060 <span class="keyword">static</span> <span class="keywordtype">void</span>     <a class="code" href="print-ps_8c.html#a11">ps_ascii85</a>(<span class="keyword">const</span> <a class="code" href="structstp__vars.html">stp_vars_t</a> *, <span class="keywordtype">unsigned</span> <span class="keywordtype">short</span> *, <span class="keywordtype">int</span>, <span class="keywordtype">int</span>);
00061 <span class="keyword">static</span> <span class="keywordtype">char</span>     *<a class="code" href="print-ps_8c.html#a12">ppd_find</a>(<span class="keyword">const</span> <span class="keywordtype">char</span> *, <span class="keyword">const</span> <span class="keywordtype">char</span> *, <span class="keyword">const</span> <span class="keywordtype">char</span> *, <span class="keywordtype">int</span> *);
00062 
<a name="l00063"></a><a class="code" href="print-ps_8c.html#a4">00063</a> <span class="keyword">static</span> <span class="keyword">const</span> <a class="code" href="structstp__parameter__t.html">stp_parameter_t</a> <a class="code" href="print-ps_8c.html#a4">the_parameters</a>[] =
00064 {
00065   {
00066     <span class="stringliteral">"PageSize"</span>, <a class="code" href="group__intl__internal.html#ga6">N_</a>(<span class="stringliteral">"Page Size"</span>), <a class="code" href="group__intl__internal.html#ga6">N_</a>(<span class="stringliteral">"Basic Printer Setup"</span>),
00067     <a class="code" href="group__intl__internal.html#ga6">N_</a>(<span class="stringliteral">"Size of the paper being printed to"</span>),
00068     <a class="code" href="group__vars.html#gga132a7">STP_PARAMETER_TYPE_STRING_LIST</a>, <a class="code" href="group__vars.html#gga133a19">STP_PARAMETER_CLASS_CORE</a>,
00069     <a class="code" href="group__vars.html#gga134a21">STP_PARAMETER_LEVEL_BASIC</a>, 1, 1, -1, 1, 0
00070   },
00071   {
00072     <span class="stringliteral">"MediaType"</span>, <a class="code" href="group__intl__internal.html#ga6">N_</a>(<span class="stringliteral">"Media Type"</span>), <a class="code" href="group__intl__internal.html#ga6">N_</a>(<span class="stringliteral">"Basic Printer Setup"</span>),
00073     <a class="code" href="group__intl__internal.html#ga6">N_</a>(<span class="stringliteral">"Type of media (plain paper, photo paper, etc.)"</span>),
00074     <a class="code" href="group__vars.html#gga132a7">STP_PARAMETER_TYPE_STRING_LIST</a>, <a class="code" href="group__vars.html#gga133a17">STP_PARAMETER_CLASS_FEATURE</a>,
00075     <a class="code" href="group__vars.html#gga134a21">STP_PARAMETER_LEVEL_BASIC</a>, 1, 1, -1, 1, 0
00076   },
00077   {
00078     <span class="stringliteral">"InputSlot"</span>, <a class="code" href="group__intl__internal.html#ga6">N_</a>(<span class="stringliteral">"Media Source"</span>), <a class="code" href="group__intl__internal.html#ga6">N_</a>(<span class="stringliteral">"Basic Printer Setup"</span>),
00079     <a class="code" href="group__intl__internal.html#ga6">N_</a>(<span class="stringliteral">"Source (input slot) of the media"</span>),
00080     <a class="code" href="group__vars.html#gga132a7">STP_PARAMETER_TYPE_STRING_LIST</a>, <a class="code" href="group__vars.html#gga133a17">STP_PARAMETER_CLASS_FEATURE</a>,
00081     <a class="code" href="group__vars.html#gga134a21">STP_PARAMETER_LEVEL_BASIC</a>, 1, 1, -1, 1, 0
00082   },
00083   {
00084     <span class="stringliteral">"Resolution"</span>, <a class="code" href="group__intl__internal.html#ga6">N_</a>(<span class="stringliteral">"Resolution"</span>), <a class="code" href="group__intl__internal.html#ga6">N_</a>(<span class="stringliteral">"Basic Printer Setup"</span>),
00085     <a class="code" href="group__intl__internal.html#ga6">N_</a>(<span class="stringliteral">"Resolution and quality of the print"</span>),
00086     <a class="code" href="group__vars.html#gga132a7">STP_PARAMETER_TYPE_STRING_LIST</a>, <a class="code" href="group__vars.html#gga133a17">STP_PARAMETER_CLASS_FEATURE</a>,
00087     <a class="code" href="group__vars.html#gga134a21">STP_PARAMETER_LEVEL_BASIC</a>, 1, 1, -1, 1, 0
00088   },
00089   {
00090     <span class="stringliteral">"InkType"</span>, <a class="code" href="group__intl__internal.html#ga6">N_</a>(<span class="stringliteral">"Ink Type"</span>), <a class="code" href="group__intl__internal.html#ga6">N_</a>(<span class="stringliteral">"Advanced Printer Setup"</span>),
00091     <a class="code" href="group__intl__internal.html#ga6">N_</a>(<span class="stringliteral">"Type of ink in the printer"</span>),
00092     <a class="code" href="group__vars.html#gga132a7">STP_PARAMETER_TYPE_STRING_LIST</a>, <a class="code" href="group__vars.html#gga133a17">STP_PARAMETER_CLASS_FEATURE</a>,
00093     <a class="code" href="group__vars.html#gga134a21">STP_PARAMETER_LEVEL_BASIC</a>, 1, 1, -1, 1, 0
00094   },
00095   {
00096     <span class="stringliteral">"PPDFile"</span>, <a class="code" href="group__intl__internal.html#ga6">N_</a>(<span class="stringliteral">"PPDFile"</span>), <a class="code" href="group__intl__internal.html#ga6">N_</a>(<span class="stringliteral">"Basic Printer Setup"</span>),
00097     <a class="code" href="group__intl__internal.html#ga6">N_</a>(<span class="stringliteral">"PPD File"</span>),
00098     <a class="code" href="group__vars.html#gga132a12">STP_PARAMETER_TYPE_FILE</a>, <a class="code" href="group__vars.html#gga133a17">STP_PARAMETER_CLASS_FEATURE</a>,
00099     <a class="code" href="group__vars.html#gga134a21">STP_PARAMETER_LEVEL_BASIC</a>, 1, 1, -1, 1, 0
00100   },
00101   {
00102     <span class="stringliteral">"PrintingMode"</span>, <a class="code" href="group__intl__internal.html#ga6">N_</a>(<span class="stringliteral">"Printing Mode"</span>), <a class="code" href="group__intl__internal.html#ga6">N_</a>(<span class="stringliteral">"Core Parameter"</span>),
00103     <a class="code" href="group__intl__internal.html#ga6">N_</a>(<span class="stringliteral">"Printing Output Mode"</span>),
00104     <a class="code" href="group__vars.html#gga132a7">STP_PARAMETER_TYPE_STRING_LIST</a>, <a class="code" href="group__vars.html#gga133a19">STP_PARAMETER_CLASS_CORE</a>,
00105     <a class="code" href="group__vars.html#gga134a21">STP_PARAMETER_LEVEL_BASIC</a>, 1, 1, -1, 1, 0
00106   },
00107 };
00108 
<a name="l00109"></a><a class="code" href="print-ps_8c.html#a5">00109</a> <span class="keyword">static</span> <span class="keyword">const</span> <span class="keywordtype">int</span> <a class="code" href="print-ps_8c.html#a5">the_parameter_count</a> =
00110 <span class="keyword">sizeof</span>(<a class="code" href="print-ps_8c.html#a4">the_parameters</a>) / <span class="keyword">sizeof</span>(<span class="keyword">const</span> <a class="code" href="structstp__parameter__t.html">stp_parameter_t</a>);
00111 
00112 <span class="comment">/*</span>
00113 <span class="comment"> * 'ps_parameters()' - Return the parameter values for the given parameter.</span>
00114 <span class="comment"> */</span>
00115 
00116 <span class="keyword">static</span> <a class="code" href="group__vars.html#ga1">stp_parameter_list_t</a>
<a name="l00117"></a><a class="code" href="print-ps_8c.html#a13">00117</a> <a class="code" href="print-ps_8c.html#a13">ps_list_parameters</a>(<span class="keyword">const</span> <a class="code" href="structstp__vars.html">stp_vars_t</a> *v)
00118 {
00119   <a class="code" href="group__vars.html#ga1">stp_parameter_list_t</a> *ret = <a class="code" href="group__vars.html#ga43">stp_parameter_list_create</a>();
00120   <span class="keywordtype">int</span> i;
00121   <span class="keywordflow">for</span> (i = 0; i &lt; <a class="code" href="print-ps_8c.html#a5">the_parameter_count</a>; i++)
00122     <a class="code" href="group__vars.html#ga82">stp_parameter_list_add_param</a>(ret, &amp;(<a class="code" href="print-ps_8c.html#a4">the_parameters</a>[i]));
00123   <span class="keywordflow">return</span> ret;
00124 }
00125 
00126 <span class="keyword">static</span> <span class="keywordtype">void</span>
<a name="l00127"></a><a class="code" href="print-ps_8c.html#a14">00127</a> <a class="code" href="print-ps_8c.html#a14">ps_parameters_internal</a>(<span class="keyword">const</span> <a class="code" href="structstp__vars.html">stp_vars_t</a> *v, <span class="keyword">const</span> <span class="keywordtype">char</span> *name,
00128                        <a class="code" href="structstp__parameter__t.html">stp_parameter_t</a> *description)
00129 {
00130   <span class="keywordtype">int</span>           i;
00131   <span class="keywordtype">char</span>          line[1024],
00132                 lname[255],
00133                 loption[255],
00134                 *ltext;
00135   <span class="keyword">const</span> <span class="keywordtype">char</span> *ppd_file = <a class="code" href="group__vars.html#ga46">stp_get_file_parameter</a>(v, <span class="stringliteral">"PPDFile"</span>);
00136   description-&gt;<a class="code" href="structstp__parameter__t.html#o4">p_type</a> = <a class="code" href="group__vars.html#gga132a16">STP_PARAMETER_TYPE_INVALID</a>;
00137   description-&gt;<a class="code" href="structstp__parameter__t.html#o26">deflt</a>.str = 0;
00138 
00139   <span class="keywordflow">if</span> (name == NULL)
00140     <span class="keywordflow">return</span>;
00141 
00142   <span class="keywordflow">if</span> (ppd_file != NULL &amp;&amp; strlen(ppd_file) &gt; 0 &amp;&amp;
00143       (<a class="code" href="print-ps_8c.html#a3">ps_ppd_file</a> == NULL || strcmp(<a class="code" href="print-ps_8c.html#a3">ps_ppd_file</a>, ppd_file) != 0))
00144   {
00145     <span class="keywordflow">if</span> (<a class="code" href="print-ps_8c.html#a2">ps_ppd</a> != NULL)
00146       fclose(<a class="code" href="print-ps_8c.html#a2">ps_ppd</a>);
00147 
00148     <a class="code" href="print-ps_8c.html#a2">ps_ppd</a> = fopen(ppd_file, <span class="stringliteral">"r"</span>);
00149 
00150     <span class="keywordflow">if</span> (<a class="code" href="print-ps_8c.html#a2">ps_ppd</a> == NULL)
00151       <a class="code" href="print-ps_8c.html#a3">ps_ppd_file</a> = NULL;
00152     <span class="keywordflow">else</span>
00153       <a class="code" href="print-ps_8c.html#a3">ps_ppd_file</a> = ppd_file;
00154   }
00155 
00156   <span class="keywordflow">for</span> (i = 0; i &lt; <a class="code" href="print-ps_8c.html#a5">the_parameter_count</a>; i++)
00157     <span class="keywordflow">if</span> (strcmp(name, <a class="code" href="print-ps_8c.html#a4">the_parameters</a>[i].name) == 0)
00158       {
00159         <a class="code" href="group__vars.html#ga75">stp_fill_parameter_settings</a>(description, &amp;(<a class="code" href="print-ps_8c.html#a4">the_parameters</a>[i]));
00160         <span class="keywordflow">break</span>;
00161       }
00162 
00163   <span class="keywordflow">if</span> (strcmp(name, <span class="stringliteral">"PrintingMode"</span>) == 0)
00164     {
00165       description-&gt;<a class="code" href="structstp__parameter__t.html#o18">bounds</a>.str = <a class="code" href="string-list_8h.html#a1">stp_string_list_create</a>();
00166       <a class="code" href="string-list_8h.html#a7">stp_string_list_add_string</a>
00167         (description-&gt;<a class="code" href="structstp__parameter__t.html#o18">bounds</a>.str, <span class="stringliteral">"Color"</span>, <a class="code" href="group__intl__internal.html#ga5">_</a>(<span class="stringliteral">"Color"</span>));
00168       <a class="code" href="string-list_8h.html#a7">stp_string_list_add_string</a>
00169         (description-&gt;<a class="code" href="structstp__parameter__t.html#o18">bounds</a>.str, <span class="stringliteral">"BW"</span>, <a class="code" href="group__intl__internal.html#ga5">_</a>(<span class="stringliteral">"Black and White"</span>));
00170       description-&gt;<a class="code" href="structstp__parameter__t.html#o26">deflt</a>.str =
00171         <a class="code" href="string-list_8c.html#a6">stp_string_list_param</a>(description-&gt;<a class="code" href="structstp__parameter__t.html#o18">bounds</a>.str, 0)-&gt;<a class="code" href="structstp__param__string__t.html#o0">name</a>;
00172       <span class="keywordflow">return</span>;
00173     }
00174 
00175   <span class="keywordflow">if</span> (<a class="code" href="print-ps_8c.html#a2">ps_ppd</a> == NULL)
00176     {
00177       <span class="keywordflow">if</span> (strcmp(name, <span class="stringliteral">"PageSize"</span>) == 0)
00178         {
00179           <span class="keywordtype">int</span> papersizes = <a class="code" href="group__papersize.html#ga0">stp_known_papersizes</a>();
00180           description-&gt;<a class="code" href="structstp__parameter__t.html#o18">bounds</a>.str = <a class="code" href="string-list_8h.html#a1">stp_string_list_create</a>();
00181           <span class="keywordflow">for</span> (i = 0; i &lt; papersizes; i++)
00182             {
00183               <span class="keyword">const</span> <a class="code" href="structstp__papersize__t.html">stp_papersize_t</a> *pt = <a class="code" href="group__papersize.html#ga10">stp_get_papersize_by_index</a>(i);
00184               <span class="keywordflow">if</span> (strlen(pt-&gt;<a class="code" href="structstp__papersize__t.html#o0">name</a>) &gt; 0)
00185                 <a class="code" href="string-list_8h.html#a7">stp_string_list_add_string</a>
00186                   (description-&gt;<a class="code" href="structstp__parameter__t.html#o18">bounds</a>.str, pt-&gt;<a class="code" href="structstp__papersize__t.html#o0">name</a>, pt-&gt;<a class="code" href="structstp__papersize__t.html#o1">text</a>);
00187             }
00188           description-&gt;<a class="code" href="structstp__parameter__t.html#o26">deflt</a>.str =
00189             <a class="code" href="string-list_8c.html#a6">stp_string_list_param</a>(description-&gt;<a class="code" href="structstp__parameter__t.html#o18">bounds</a>.str, 0)-&gt;<a class="code" href="structstp__param__string__t.html#o0">name</a>;
00190           description-&gt;<a class="code" href="structstp__parameter__t.html#o8">is_active</a> = 1;
00191         }
00192       <span class="keywordflow">else</span>
00193         description-&gt;<a class="code" href="structstp__parameter__t.html#o8">is_active</a> = 0;
00194       <span class="keywordflow">return</span>;
00195     }
00196 
00197   rewind(<a class="code" href="print-ps_8c.html#a2">ps_ppd</a>);
00198   description-&gt;<a class="code" href="structstp__parameter__t.html#o18">bounds</a>.str = <a class="code" href="string-list_8h.html#a1">stp_string_list_create</a>();
00199 
00200   <span class="keywordflow">while</span> (fgets(line, <span class="keyword">sizeof</span>(line), <a class="code" href="print-ps_8c.html#a2">ps_ppd</a>) != NULL)
00201   {
00202     <span class="keywordflow">if</span> (line[0] != <span class="charliteral">'*'</span>)
00203       <span class="keywordflow">continue</span>;
00204 
00205     <span class="keywordflow">if</span> (sscanf(line, <span class="stringliteral">"*%s %[^:]"</span>, lname, loption) != 2)
00206       <span class="keywordflow">continue</span>;
00207 
00208     <span class="keywordflow">if</span> (strcasecmp(lname, name) == 0)
00209     {
00210       <span class="keywordflow">if</span> ((ltext = strchr(loption, <span class="charliteral">'/'</span>)) != NULL)
00211         *ltext++ = <span class="charliteral">'\0'</span>;
00212       <span class="keywordflow">else</span>
00213         ltext = loption;
00214 
00215       <a class="code" href="string-list_8c.html#a11">stp_string_list_add_string</a>(description-&gt;<a class="code" href="structstp__parameter__t.html#o18">bounds</a>.str, loption, ltext);
00216     }
00217   }
00218 
00219   <span class="keywordflow">if</span> (<a class="code" href="string-list_8c.html#a8">stp_string_list_count</a>(description-&gt;<a class="code" href="structstp__parameter__t.html#o18">bounds</a>.str) &gt; 0)
00220     description-&gt;<a class="code" href="structstp__parameter__t.html#o26">deflt</a>.str =
00221       <a class="code" href="string-list_8c.html#a6">stp_string_list_param</a>(description-&gt;<a class="code" href="structstp__parameter__t.html#o18">bounds</a>.str, 0)-&gt;<a class="code" href="structstp__param__string__t.html#o0">name</a>;
00222   <span class="keywordflow">else</span>
00223     description-&gt;<a class="code" href="structstp__parameter__t.html#o8">is_active</a> = 0;
00224   <span class="keywordflow">return</span>;
00225 }
00226 
00227 <span class="keyword">static</span> <span class="keywordtype">void</span>
<a name="l00228"></a><a class="code" href="print-ps_8c.html#a15">00228</a> <a class="code" href="print-ps_8c.html#a15">ps_parameters</a>(<span class="keyword">const</span> <a class="code" href="structstp__vars.html">stp_vars_t</a> *v, <span class="keyword">const</span> <span class="keywordtype">char</span> *name,
00229               <a class="code" href="structstp__parameter__t.html">stp_parameter_t</a> *description)
00230 {
00231   setlocale(LC_ALL, <span class="stringliteral">"C"</span>);
00232   <a class="code" href="print-ps_8c.html#a14">ps_parameters_internal</a>(v, name, description);
00233   setlocale(LC_ALL, <span class="stringliteral">""</span>);
00234 }
00235 
00236 <span class="comment">/*</span>
00237 <span class="comment"> * 'ps_media_size()' - Return the size of the page.</span>
00238 <span class="comment"> */</span>
00239 
00240 <span class="keyword">static</span> <span class="keywordtype">void</span>
<a name="l00241"></a><a class="code" href="print-ps_8c.html#a16">00241</a> <a class="code" href="print-ps_8c.html#a16">ps_media_size_internal</a>(<span class="keyword">const</span> <a class="code" href="structstp__vars.html">stp_vars_t</a> *v,             <span class="comment">/* I */</span>
00242                        <span class="keywordtype">int</span>  *width,             <span class="comment">/* O - Width in points */</span>
00243                        <span class="keywordtype">int</span>  *height)            <span class="comment">/* O - Height in points */</span>
00244 {
00245   <span class="keywordtype">char</span>  *dimensions;                    <span class="comment">/* Dimensions of media size */</span>
00246   <span class="keyword">const</span> <span class="keywordtype">char</span> *pagesize = <a class="code" href="group__vars.html#ga36">stp_get_string_parameter</a>(v, <span class="stringliteral">"PageSize"</span>);
00247   <span class="keyword">const</span> <span class="keywordtype">char</span> *ppd_file_name = <a class="code" href="group__vars.html#ga46">stp_get_file_parameter</a>(v, <span class="stringliteral">"PPDFile"</span>);
00248   <span class="keywordtype">float</span> fwidth, fheight;
00249   <span class="keywordflow">if</span> (!pagesize)
00250     pagesize = <span class="stringliteral">""</span>;
00251 
00252   <a class="code" href="print-util_8c.html#a23">stp_dprintf</a>(<a class="code" href="group__util.html#ga34">STP_DBG_PS</a>, v,
00253               <span class="stringliteral">"ps_media_size(%d, \'%s\', \'%s\', %p, %p)\n"</span>,
00254               <a class="code" href="group__printer.html#ga23">stp_get_model_id</a>(v), ppd_file_name, pagesize,
00255               (<span class="keywordtype">void</span> *) width, (<span class="keywordtype">void</span> *) height);
00256 
00257   <span class="keywordflow">if</span> ((dimensions = <a class="code" href="print-ps_8c.html#a12">ppd_find</a>(ppd_file_name, <span class="stringliteral">"PaperDimension"</span>, pagesize, NULL))
00258       != NULL)
00259     {
00260       sscanf(dimensions, <span class="stringliteral">"%f%f"</span>, &amp;fwidth, &amp;fheight);
00261       *width = fwidth;
00262       *height = fheight;
00263       <a class="code" href="print-util_8c.html#a23">stp_dprintf</a>(<a class="code" href="group__util.html#ga34">STP_DBG_PS</a>, v, <span class="stringliteral">"dimensions '%s' %f %f %d %d\n"</span>,
00264                   dimensions, fwidth, fheight, *width, *height);
00265     }
00266   <span class="keywordflow">else</span>
00267     <a class="code" href="group__papersize.html#ga13">stp_default_media_size</a>(v, width, height);
00268 }
00269 
00270 <span class="keyword">static</span> <span class="keywordtype">void</span>
<a name="l00271"></a><a class="code" href="print-ps_8c.html#a17">00271</a> <a class="code" href="print-ps_8c.html#a17">ps_media_size</a>(<span class="keyword">const</span> <a class="code" href="structstp__vars.html">stp_vars_t</a> *v, <span class="keywordtype">int</span> *width, <span class="keywordtype">int</span> *height)
00272 {
00273   setlocale(LC_ALL, <span class="stringliteral">"C"</span>);
00274   <a class="code" href="print-ps_8c.html#a16">ps_media_size_internal</a>(v, width, height);
00275   setlocale(LC_ALL, <span class="stringliteral">""</span>);
00276 }
00277 
00278 <span class="comment">/*</span>
00279 <span class="comment"> * 'ps_imageable_area()' - Return the imageable area of the page.</span>
00280 <span class="comment"> */</span>
00281 
00282 <span class="keyword">static</span> <span class="keywordtype">void</span>
<a name="l00283"></a><a class="code" href="print-ps_8c.html#a18">00283</a> <a class="code" href="print-ps_8c.html#a18">ps_imageable_area_internal</a>(<span class="keyword">const</span> <a class="code" href="structstp__vars.html">stp_vars_t</a> *v,      <span class="comment">/* I */</span>
00284                            <span class="keywordtype">int</span>  *left,  <span class="comment">/* O - Left position in points */</span>
00285                            <span class="keywordtype">int</span>  *right, <span class="comment">/* O - Right position in points */</span>
00286                            <span class="keywordtype">int</span>  *bottom, <span class="comment">/* O - Bottom position in points */</span>
00287                            <span class="keywordtype">int</span>  *top)   <span class="comment">/* O - Top position in points */</span>
00288 {
00289   <span class="keywordtype">char</span>  *area;                          <span class="comment">/* Imageable area of media */</span>
00290   <span class="keywordtype">float</span> fleft,                          <span class="comment">/* Floating point versions */</span>
00291         fright,
00292         fbottom,
00293         ftop;
00294   <span class="keywordtype">int</span> width, height;
00295   <span class="keyword">const</span> <span class="keywordtype">char</span> *pagesize = <a class="code" href="group__vars.html#ga36">stp_get_string_parameter</a>(v, <span class="stringliteral">"PageSize"</span>);
00296   <span class="keywordflow">if</span> (!pagesize)
00297     pagesize = <span class="stringliteral">""</span>;
00298   <a class="code" href="print-ps_8c.html#a17">ps_media_size</a>(v, &amp;width, &amp;height);
00299 
00300   <span class="keywordflow">if</span> ((area = <a class="code" href="print-ps_8c.html#a12">ppd_find</a>(<a class="code" href="group__vars.html#ga46">stp_get_file_parameter</a>(v, <span class="stringliteral">"PPDFile"</span>),
00301                        <span class="stringliteral">"ImageableArea"</span>, pagesize, NULL))
00302       != NULL)
00303     {
00304       <a class="code" href="print-util_8c.html#a23">stp_dprintf</a>(<a class="code" href="group__util.html#ga34">STP_DBG_PS</a>, v, <span class="stringliteral">"area = \'%s\'\n"</span>, area);
00305       <span class="keywordflow">if</span> (sscanf(area, <span class="stringliteral">"%f%f%f%f"</span>, &amp;fleft, &amp;fbottom, &amp;fright, &amp;ftop) == 4)
00306         {
00307           *left   = (<span class="keywordtype">int</span>)fleft;
00308           *right  = (<span class="keywordtype">int</span>)fright;
00309           *bottom = height - (<span class="keywordtype">int</span>)fbottom;
00310           *top    = height - (<span class="keywordtype">int</span>)ftop;
00311         }
00312       <span class="keywordflow">else</span>
00313         *left = *right = *bottom = *top = 0;
00314       <a class="code" href="print-util_8c.html#a23">stp_dprintf</a>(<a class="code" href="group__util.html#ga34">STP_DBG_PS</a>, v, <span class="stringliteral">"l %d r %d b %d t %d h %d w %d\n"</span>,
00315                   *left, *right, *bottom, *top, width, height);
00316     }
00317   <span class="keywordflow">else</span>
00318     {
00319       *left   = 18;
00320       *right  = width - 18;
00321       *top    = 36;
00322       *bottom = height - 36;
00323     }
00324 }
00325 
00326 <span class="keyword">static</span> <span class="keywordtype">void</span>
<a name="l00327"></a><a class="code" href="print-ps_8c.html#a19">00327</a> <a class="code" href="print-ps_8c.html#a19">ps_imageable_area</a>(<span class="keyword">const</span> <a class="code" href="structstp__vars.html">stp_vars_t</a> *v,      <span class="comment">/* I */</span>
00328                   <span class="keywordtype">int</span>  *left,           <span class="comment">/* O - Left position in points */</span>
00329                   <span class="keywordtype">int</span>  *right,          <span class="comment">/* O - Right position in points */</span>
00330                   <span class="keywordtype">int</span>  *bottom,         <span class="comment">/* O - Bottom position in points */</span>
00331                   <span class="keywordtype">int</span>  *top)            <span class="comment">/* O - Top position in points */</span>
00332 {
00333   setlocale(LC_ALL, <span class="stringliteral">"C"</span>);
00334   <a class="code" href="print-ps_8c.html#a18">ps_imageable_area_internal</a>(v, left, right, bottom, top);
00335   setlocale(LC_ALL, <span class="stringliteral">""</span>);
00336 }
00337 
00338 <span class="keyword">static</span> <span class="keywordtype">void</span>
<a name="l00339"></a><a class="code" href="print-ps_8c.html#a20">00339</a> <a class="code" href="print-ps_8c.html#a20">ps_limit</a>(<span class="keyword">const</span> <a class="code" href="structstp__vars.html">stp_vars_t</a> *v,           <span class="comment">/* I */</span>
00340          <span class="keywordtype">int</span> *width,
00341          <span class="keywordtype">int</span> *height,
00342          <span class="keywordtype">int</span> *min_width,
00343          <span class="keywordtype">int</span> *min_height)
00344 {
00345   *width =      INT_MAX;
00346   *height =     INT_MAX;
00347   *min_width =  1;
00348   *min_height = 1;
00349 }
00350 
00351 <span class="comment">/*</span>
00352 <span class="comment"> * This is really bogus...</span>
00353 <span class="comment"> */</span>
00354 <span class="keyword">static</span> <span class="keywordtype">void</span>
<a name="l00355"></a><a class="code" href="print-ps_8c.html#a21">00355</a> <a class="code" href="print-ps_8c.html#a21">ps_describe_resolution_internal</a>(<span class="keyword">const</span> <a class="code" href="structstp__vars.html">stp_vars_t</a> *v, <span class="keywordtype">int</span> *x, <span class="keywordtype">int</span> *y)
00356 {
00357   <span class="keyword">const</span> <span class="keywordtype">char</span> *resolution = <a class="code" href="group__vars.html#ga36">stp_get_string_parameter</a>(v, <span class="stringliteral">"Resolution"</span>);
00358   *x = -1;
00359   *y = -1;
00360   <span class="keywordflow">if</span> (resolution)
00361     sscanf(resolution, <span class="stringliteral">"%dx%d"</span>, x, y);
00362   <span class="keywordflow">return</span>;
00363 }
00364 
00365 <span class="keyword">static</span> <span class="keywordtype">void</span>
<a name="l00366"></a><a class="code" href="print-ps_8c.html#a22">00366</a> <a class="code" href="print-ps_8c.html#a22">ps_describe_resolution</a>(<span class="keyword">const</span> <a class="code" href="structstp__vars.html">stp_vars_t</a> *v, <span class="keywordtype">int</span> *x, <span class="keywordtype">int</span> *y)
00367 {
00368   setlocale(LC_ALL, <span class="stringliteral">"C"</span>);
00369   <a class="code" href="print-ps_8c.html#a21">ps_describe_resolution_internal</a>(v, x, y);
00370   setlocale(LC_ALL, <span class="stringliteral">""</span>);
00371 }
00372 
00373 <span class="keyword">static</span> <span class="keyword">const</span> <span class="keywordtype">char</span> *
<a name="l00374"></a><a class="code" href="print-ps_8c.html#a23">00374</a> <a class="code" href="print-ps_8c.html#a23">ps_describe_output</a>(<span class="keyword">const</span> <a class="code" href="structstp__vars.html">stp_vars_t</a> *v)
00375 {
00376   <span class="keyword">const</span> <span class="keywordtype">char</span> *print_mode = <a class="code" href="group__vars.html#ga36">stp_get_string_parameter</a>(v, <span class="stringliteral">"PrintingMode"</span>);
00377   <span class="keywordflow">if</span> (print_mode &amp;&amp; strcmp(print_mode, <span class="stringliteral">"Color"</span>) == 0)
00378     <span class="keywordflow">return</span> <span class="stringliteral">"RGB"</span>;
00379   <span class="keywordflow">else</span>
00380     <span class="keywordflow">return</span> <span class="stringliteral">"Whitescale"</span>;
00381 }
00382 
00383 <span class="comment">/*</span>
00384 <span class="comment"> * 'ps_print()' - Print an image to a PostScript printer.</span>
00385 <span class="comment"> */</span>
00386 
00387 <span class="keyword">static</span> <span class="keywordtype">int</span>
<a name="l00388"></a><a class="code" href="print-ps_8c.html#a24">00388</a> <a class="code" href="print-ps_8c.html#a24">ps_print_internal</a>(<span class="keyword">const</span> <a class="code" href="structstp__vars.html">stp_vars_t</a> *v, <a class="code" href="structstp__image.html">stp_image_t</a> *image)
00389 {
00390   <span class="keywordtype">int</span>           status = 1;
00391   <span class="keywordtype">int</span>           model = <a class="code" href="group__printer.html#ga23">stp_get_model_id</a>(v);
00392   <span class="keyword">const</span> <span class="keywordtype">char</span>    *ppd_file = <a class="code" href="group__vars.html#ga46">stp_get_file_parameter</a>(v, <span class="stringliteral">"PPDFile"</span>);
00393   <span class="keyword">const</span> <span class="keywordtype">char</span>    *resolution = <a class="code" href="group__vars.html#ga36">stp_get_string_parameter</a>(v, <span class="stringliteral">"Resolution"</span>);
00394   <span class="keyword">const</span> <span class="keywordtype">char</span>    *media_size = <a class="code" href="group__vars.html#ga36">stp_get_string_parameter</a>(v, <span class="stringliteral">"PageSize"</span>);
00395   <span class="keyword">const</span> <span class="keywordtype">char</span>    *media_type = <a class="code" href="group__vars.html#ga36">stp_get_string_parameter</a>(v, <span class="stringliteral">"MediaType"</span>);
00396   <span class="keyword">const</span> <span class="keywordtype">char</span>    *media_source = <a class="code" href="group__vars.html#ga36">stp_get_string_parameter</a>(v, <span class="stringliteral">"InputSlot"</span>);
00397   <span class="keyword">const</span> <span class="keywordtype">char</span>    *print_mode = <a class="code" href="group__vars.html#ga36">stp_get_string_parameter</a>(v, <span class="stringliteral">"PrintingMode"</span>);
00398   <span class="keywordtype">unsigned</span> <span class="keywordtype">short</span> *out = NULL;
00399   <span class="keywordtype">int</span>           top = <a class="code" href="group__vars.html#ga20">stp_get_top</a>(v);
00400   <span class="keywordtype">int</span>           left = <a class="code" href="group__vars.html#ga18">stp_get_left</a>(v);
00401   <span class="keywordtype">int</span>           i, j;           <span class="comment">/* Looping vars */</span>
00402   <span class="keywordtype">int</span>           y;              <span class="comment">/* Looping vars */</span>
00403   <span class="keywordtype">int</span>           page_left,      <span class="comment">/* Left margin of page */</span>
00404                 page_right,     <span class="comment">/* Right margin of page */</span>
00405                 page_top,       <span class="comment">/* Top of page */</span>
00406                 page_bottom,    <span class="comment">/* Bottom of page */</span>
00407                 page_width,     <span class="comment">/* Width of page */</span>
00408                 page_height,    <span class="comment">/* Height of page */</span>
00409                 out_width,      <span class="comment">/* Width of image on page */</span>
00410                 out_height,     <span class="comment">/* Height of image on page */</span>
00411                 out_channels,   <span class="comment">/* Output bytes per pixel */</span>
00412                 out_ps_height,  <span class="comment">/* Output height (Level 2 output) */</span>
00413                 out_offset;     <span class="comment">/* Output offset (Level 2 output) */</span>
00414   time_t        curtime;        <span class="comment">/* Current time of day */</span>
00415   <span class="keywordtype">unsigned</span>      zero_mask;
00416   <span class="keywordtype">char</span>          *command;       <span class="comment">/* PostScript command */</span>
00417   <span class="keyword">const</span> <span class="keywordtype">char</span>    *temp;          <span class="comment">/* Temporary string pointer */</span>
00418   <span class="keywordtype">int</span>           order,          <span class="comment">/* Order of command */</span>
00419                 num_commands;   <span class="comment">/* Number of commands */</span>
00420   <span class="keyword">struct                        </span><span class="comment">/* PostScript commands... */</span>
00421   {
00422     <span class="keyword">const</span> <span class="keywordtype">char</span>  *keyword, *choice;
00423     <span class="keywordtype">char</span>        *command;
00424     <span class="keywordtype">int</span>         order;
00425   }             commands[4];
00426   <span class="keywordtype">int</span>           image_height,
00427                 image_width;
00428   <a class="code" href="structstp__vars.html">stp_vars_t</a>    *nv = <a class="code" href="group__vars.html#ga78">stp_vars_create_copy</a>(v);
00429   <span class="keywordflow">if</span> (!resolution)
00430     resolution = <span class="stringliteral">""</span>;
00431   <span class="keywordflow">if</span> (!media_size)
00432     media_size = <span class="stringliteral">""</span>;
00433   <span class="keywordflow">if</span> (!media_type)
00434     media_type = <span class="stringliteral">""</span>;
00435   <span class="keywordflow">if</span> (!media_source)
00436     media_source = <span class="stringliteral">""</span>;
00437 
00438   <a class="code" href="group__util.html#ga77">stp_prune_inactive_options</a>(nv);
00439   <span class="keywordflow">if</span> (!<a class="code" href="group__vars.html#ga34">stp_verify</a>(nv))
00440     {
00441       <a class="code" href="print-util_8c.html#a18">stp_eprintf</a>(nv, <span class="stringliteral">"Print options not verified; cannot print.\n"</span>);
00442       <span class="keywordflow">return</span> 0;
00443     }
00444 
00445   <a class="code" href="group__image.html#ga0">stp_image_init</a>(image);
00446 
00447  <span class="comment">/*</span>
00448 <span class="comment">  * Compute the output size...</span>
00449 <span class="comment">  */</span>
00450 
00451   out_width = <a class="code" href="group__vars.html#ga22">stp_get_width</a>(v);
00452   out_height = <a class="code" href="group__vars.html#ga24">stp_get_height</a>(v);
00453 
00454   <a class="code" href="print-ps_8c.html#a19">ps_imageable_area</a>(nv, &amp;page_left, &amp;page_right, &amp;page_bottom, &amp;page_top);
00455   left -= page_left;
00456   top -= page_top;
00457   page_width = page_right - page_left;
00458   page_height = page_bottom - page_top;
00459 
00460   image_height = <a class="code" href="group__image.html#ga3">stp_image_height</a>(image);
00461   image_width = <a class="code" href="group__image.html#ga2">stp_image_width</a>(image);
00462 
00463  <span class="comment">/*</span>
00464 <span class="comment">  * Output a standard PostScript header with DSC comments...</span>
00465 <span class="comment">  */</span>
00466 
00467   curtime = time(NULL);
00468 
00469   left += page_left;
00470 
00471   top = page_height - top;
00472 
00473   <a class="code" href="print-util_8c.html#a23">stp_dprintf</a>(<a class="code" href="group__util.html#ga34">STP_DBG_PS</a>, v,
00474               <span class="stringliteral">"out_width = %d, out_height = %d\n"</span>, out_width, out_height);
00475   <a class="code" href="print-util_8c.html#a23">stp_dprintf</a>(<a class="code" href="group__util.html#ga34">STP_DBG_PS</a>, v,
00476               <span class="stringliteral">"page_left = %d, page_right = %d, page_bottom = %d, page_top = %d\n"</span>,
00477               page_left, page_right, page_bottom, page_top);
00478   <a class="code" href="print-util_8c.html#a23">stp_dprintf</a>(<a class="code" href="group__util.html#ga34">STP_DBG_PS</a>, v, <span class="stringliteral">"left = %d, top = %d\n"</span>, left, top);
00479 
00480   <a class="code" href="group__util.html#ga16">stp_puts</a>(<span class="stringliteral">"%!PS-Adobe-3.0\n"</span>, v);
00481 <span class="preprocessor">#ifdef HAVE_CONFIG_H</span>
00482 <span class="preprocessor"></span>  <a class="code" href="print-util_8c.html#a7">stp_zprintf</a>(v, <span class="stringliteral">"%%%%Creator: %s/Gimp-Print %s (%s)\n"</span>,
00483               <a class="code" href="group__image.html#ga5">stp_image_get_appname</a>(image), VERSION, RELEASE_DATE);
00484 <span class="preprocessor">#else</span>
00485 <span class="preprocessor"></span>  <a class="code" href="print-util_8c.html#a7">stp_zprintf</a>(v, <span class="stringliteral">"%%%%Creator: %s/Gimp-Print\n"</span>, <a class="code" href="group__image.html#ga5">stp_image_get_appname</a>(image));
00486 <span class="preprocessor">#endif</span>
00487 <span class="preprocessor"></span>  <a class="code" href="print-util_8c.html#a7">stp_zprintf</a>(v, <span class="stringliteral">"%%%%CreationDate: %s"</span>, ctime(&amp;curtime));
00488   <a class="code" href="group__util.html#ga16">stp_puts</a>(<span class="stringliteral">"%Copyright: 1997-2002 by Michael Sweet (mike@easysw.com) and Robert Krawitz (rlk@alum.mit.edu)\n"</span>, v);
00489   <a class="code" href="print-util_8c.html#a7">stp_zprintf</a>(v, <span class="stringliteral">"%%%%BoundingBox: %d %d %d %d\n"</span>,
00490               left, top - out_height, left + out_width, top);
00491   <a class="code" href="group__util.html#ga16">stp_puts</a>(<span class="stringliteral">"%%DocumentData: Clean7Bit\n"</span>, v);
00492   <a class="code" href="print-util_8c.html#a7">stp_zprintf</a>(v, <span class="stringliteral">"%%%%LanguageLevel: %d\n"</span>, model + 1);
00493   <a class="code" href="group__util.html#ga16">stp_puts</a>(<span class="stringliteral">"%%Pages: 1\n"</span>, v);
00494   <a class="code" href="group__util.html#ga16">stp_puts</a>(<span class="stringliteral">"%%Orientation: Portrait\n"</span>, v);
00495   <a class="code" href="group__util.html#ga16">stp_puts</a>(<span class="stringliteral">"%%EndComments\n"</span>, v);
00496 
00497  <span class="comment">/*</span>
00498 <span class="comment">  * Find any printer-specific commands...</span>
00499 <span class="comment">  */</span>
00500 
00501   num_commands = 0;
00502 
00503   <span class="keywordflow">if</span> ((command = <a class="code" href="print-ps_8c.html#a12">ppd_find</a>(ppd_file, <span class="stringliteral">"PageSize"</span>, media_size, &amp;order)) != NULL)
00504   {
00505     commands[num_commands].keyword = <span class="stringliteral">"PageSize"</span>;
00506     commands[num_commands].choice  = media_size;
00507     commands[num_commands].command = <a class="code" href="group__util.html#ga28">stp_malloc</a>(strlen(command) + 1);
00508     strcpy(commands[num_commands].command, command);
00509     commands[num_commands].order   = order;
00510     num_commands ++;
00511   }
00512 
00513   <span class="keywordflow">if</span> ((command = <a class="code" href="print-ps_8c.html#a12">ppd_find</a>(ppd_file, <span class="stringliteral">"InputSlot"</span>, media_source, &amp;order)) != NULL)
00514   {
00515     commands[num_commands].keyword = <span class="stringliteral">"InputSlot"</span>;
00516     commands[num_commands].choice  = media_source;
00517     commands[num_commands].command = <a class="code" href="group__util.html#ga28">stp_malloc</a>(strlen(command) + 1);
00518     strcpy(commands[num_commands].command, command);
00519     commands[num_commands].order   = order;
00520     num_commands ++;
00521   }
00522 
00523   <span class="keywordflow">if</span> ((command = <a class="code" href="print-ps_8c.html#a12">ppd_find</a>(ppd_file, <span class="stringliteral">"MediaType"</span>, media_type, &amp;order)) != NULL)
00524   {
00525     commands[num_commands].keyword = <span class="stringliteral">"MediaType"</span>;
00526     commands[num_commands].choice  = media_type;
00527     commands[num_commands].command = <a class="code" href="group__util.html#ga28">stp_malloc</a>(strlen(command) + 1);
00528     strcpy(commands[num_commands].command, command);
00529     commands[num_commands].order   = order;
00530     num_commands ++;
00531   }
00532 
00533   <span class="keywordflow">if</span> ((command = <a class="code" href="print-ps_8c.html#a12">ppd_find</a>(ppd_file, <span class="stringliteral">"Resolution"</span>, resolution, &amp;order)) != NULL)
00534   {
00535     commands[num_commands].keyword = <span class="stringliteral">"Resolution"</span>;
00536     commands[num_commands].choice  = resolution;
00537     commands[num_commands].command = <a class="code" href="group__util.html#ga28">stp_malloc</a>(strlen(command) + 1);
00538     strcpy(commands[num_commands].command, command);
00539     commands[num_commands].order   = order;
00540     num_commands ++;
00541   }
00542 
00543  <span class="comment">/*</span>
00544 <span class="comment">  * Sort the commands using the OrderDependency value...</span>
00545 <span class="comment">  */</span>
00546 
00547   <span class="keywordflow">for</span> (i = 0; i &lt; (num_commands - 1); i ++)
00548     <span class="keywordflow">for</span> (j = i + 1; j &lt; num_commands; j ++)
00549       <span class="keywordflow">if</span> (commands[j].order &lt; commands[i].order)
00550       {
00551         temp                = commands[i].keyword;
00552         commands[i].keyword = commands[j].keyword;
00553         commands[j].keyword = temp;
00554 
00555         temp                = commands[i].choice;
00556         commands[i].choice  = commands[j].choice;
00557         commands[j].choice  = temp;
00558 
00559         order               = commands[i].order;
00560         commands[i].order   = commands[j].order;
00561         commands[j].order   = order;
00562 
00563         command             = commands[i].command;
00564         commands[i].command = commands[j].command;
00565         commands[j].command = command;
00566       }
00567 
00568  <span class="comment">/*</span>
00569 <span class="comment">  * Send the commands...</span>
00570 <span class="comment">  */</span>
00571 
00572   <span class="keywordflow">if</span> (num_commands &gt; 0)
00573   {
00574     <a class="code" href="group__util.html#ga16">stp_puts</a>(<span class="stringliteral">"%%BeginSetup\n"</span>, v);
00575 
00576     <span class="keywordflow">for</span> (i = 0; i &lt; num_commands; i ++)
00577     {
00578       <a class="code" href="group__util.html#ga16">stp_puts</a>(<span class="stringliteral">"[{\n"</span>, v);
00579       <a class="code" href="print-util_8c.html#a7">stp_zprintf</a>(v, <span class="stringliteral">"%%%%BeginFeature: *%s %s\n"</span>, commands[i].keyword,
00580                   commands[i].choice);
00581       <span class="keywordflow">if</span> (commands[i].command[0])
00582       {
00583         <a class="code" href="group__util.html#ga16">stp_puts</a>(commands[i].command, v);
00584         <span class="keywordflow">if</span> (commands[i].command[strlen(commands[i].command) - 1] != <span class="charliteral">'\n'</span>)
00585           <a class="code" href="group__util.html#ga16">stp_puts</a>(<span class="stringliteral">"\n"</span>, v);
00586       }
00587 
00588       <a class="code" href="group__util.html#ga16">stp_puts</a>(<span class="stringliteral">"%%EndFeature\n"</span>, v);
00589       <a class="code" href="group__util.html#ga16">stp_puts</a>(<span class="stringliteral">"} stopped cleartomark\n"</span>, v);
00590       <a class="code" href="group__util.html#ga31">stp_free</a>(commands[i].command);
00591     }
00592 
00593     <a class="code" href="group__util.html#ga16">stp_puts</a>(<span class="stringliteral">"%%EndSetup\n"</span>, v);
00594   }
00595 
00596  <span class="comment">/*</span>
00597 <span class="comment">  * Output the page...</span>
00598 <span class="comment">  */</span>
00599 
00600   <a class="code" href="group__util.html#ga16">stp_puts</a>(<span class="stringliteral">"%%Page: 1 1\n"</span>, v);
00601   <a class="code" href="group__util.html#ga16">stp_puts</a>(<span class="stringliteral">"gsave\n"</span>, v);
00602 
00603   <a class="code" href="print-util_8c.html#a7">stp_zprintf</a>(v, <span class="stringliteral">"%d %d translate\n"</span>, left, top);
00604 
00605   <span class="comment">/* Force locale to "C", because decimal numbers in Postscript must</span>
00606 <span class="comment">     always be printed with a decimal point rather than the</span>
00607 <span class="comment">     locale-specific setting. */</span>
00608 
00609   setlocale(LC_ALL, <span class="stringliteral">"C"</span>);
00610   <a class="code" href="print-util_8c.html#a7">stp_zprintf</a>(v, <span class="stringliteral">"%.3f %.3f scale\n"</span>,
00611               (<span class="keywordtype">double</span>)out_width / ((<span class="keywordtype">double</span>)image_width),
00612               (<span class="keywordtype">double</span>)out_height / ((<span class="keywordtype">double</span>)image_height));
00613   setlocale(LC_ALL, <span class="stringliteral">""</span>);
00614 
00615   <a class="code" href="channel_8c.html#a2">stp_channel_reset</a>(nv);
00616   <a class="code" href="channel_8c.html#a6">stp_channel_add</a>(nv, 0, 0, 1.0);
00617   <span class="keywordflow">if</span> (strcmp(print_mode, <span class="stringliteral">"Color"</span>) == 0)
00618     {
00619       <a class="code" href="channel_8c.html#a6">stp_channel_add</a>(nv, 1, 0, 1.0);
00620       <a class="code" href="channel_8c.html#a6">stp_channel_add</a>(nv, 2, 0, 1.0);
00621       <a class="code" href="group__vars.html#ga32">stp_set_string_parameter</a>(nv, <span class="stringliteral">"STPIOutputType"</span>, <span class="stringliteral">"RGB"</span>);
00622     }
00623   <span class="keywordflow">else</span>
00624     <a class="code" href="group__vars.html#ga32">stp_set_string_parameter</a>(nv, <span class="stringliteral">"STPIOutputType"</span>, <span class="stringliteral">"Whitescale"</span>);
00625 
00626   out_channels = <a class="code" href="group__color.html#ga13">stp_color_init</a>(nv, image, 256);
00627 
00628   <span class="keywordflow">if</span> (model == 0)
00629   {
00630     <a class="code" href="print-util_8c.html#a7">stp_zprintf</a>(v, <span class="stringliteral">"/picture %d string def\n"</span>, image_width * out_channels);
00631 
00632     <a class="code" href="print-util_8c.html#a7">stp_zprintf</a>(v, <span class="stringliteral">"%d %d 8\n"</span>, image_width, image_height);
00633 
00634     <a class="code" href="group__util.html#ga16">stp_puts</a>(<span class="stringliteral">"[ 1 0 0 -1 0 1 ]\n"</span>, v);
00635 
00636     <span class="keywordflow">if</span> (strcmp(print_mode, <span class="stringliteral">"Color"</span>) == 0)
00637       <a class="code" href="group__util.html#ga16">stp_puts</a>(<span class="stringliteral">"{currentfile picture readhexstring pop} false 3 colorimage\n"</span>, v);
00638     <span class="keywordflow">else</span>
00639       <a class="code" href="group__util.html#ga16">stp_puts</a>(<span class="stringliteral">"{currentfile picture readhexstring pop} image\n"</span>, v);
00640 
00641     <span class="keywordflow">for</span> (y = 0; y &lt; image_height; y ++)
00642     {
00643       <span class="keywordflow">if</span> (<a class="code" href="group__color.html#ga14">stp_color_get_row</a>(nv, image, y, &amp;zero_mask))
00644         {
00645           status = 2;
00646           <span class="keywordflow">break</span>;
00647         }
00648 
00649       out = <a class="code" href="channel_8c.html#a20">stp_channel_get_input</a>(nv);
00650       <a class="code" href="print-ps_8c.html#a10">ps_hex</a>(v, out, image_width * out_channels);
00651     }
00652   }
00653   <span class="keywordflow">else</span>
00654   {
00655     <span class="keywordflow">if</span> (strcmp(print_mode, <span class="stringliteral">"Color"</span>) == 0)
00656       <a class="code" href="group__util.html#ga16">stp_puts</a>(<span class="stringliteral">"/DeviceRGB setcolorspace\n"</span>, v);
00657     <span class="keywordflow">else</span>
00658       <a class="code" href="group__util.html#ga16">stp_puts</a>(<span class="stringliteral">"/DeviceGray setcolorspace\n"</span>, v);
00659 
00660     <a class="code" href="group__util.html#ga16">stp_puts</a>(<span class="stringliteral">"&lt;&lt;\n"</span>, v);
00661     <a class="code" href="group__util.html#ga16">stp_puts</a>(<span class="stringliteral">"\t/ImageType 1\n"</span>, v);
00662 
00663     <a class="code" href="print-util_8c.html#a7">stp_zprintf</a>(v, <span class="stringliteral">"\t/Width %d\n"</span>, image_width);
00664     <a class="code" href="print-util_8c.html#a7">stp_zprintf</a>(v, <span class="stringliteral">"\t/Height %d\n"</span>, image_height);
00665     <a class="code" href="group__util.html#ga16">stp_puts</a>(<span class="stringliteral">"\t/BitsPerComponent 8\n"</span>, v);
00666 
00667     <span class="keywordflow">if</span> (strcmp(print_mode, <span class="stringliteral">"Color"</span>) == 0)
00668       <a class="code" href="group__util.html#ga16">stp_puts</a>(<span class="stringliteral">"\t/Decode [ 0 1 0 1 0 1 ]\n"</span>, v);
00669     <span class="keywordflow">else</span>
00670       <a class="code" href="group__util.html#ga16">stp_puts</a>(<span class="stringliteral">"\t/Decode [ 0 1 ]\n"</span>, v);
00671 
00672     <a class="code" href="group__util.html#ga16">stp_puts</a>(<span class="stringliteral">"\t/DataSource currentfile /ASCII85Decode filter\n"</span>, v);
00673 
00674     <span class="keywordflow">if</span> ((image_width * 72 / out_width) &lt; 100)
00675       <a class="code" href="group__util.html#ga16">stp_puts</a>(<span class="stringliteral">"\t/Interpolate true\n"</span>, v);
00676 
00677     <a class="code" href="group__util.html#ga16">stp_puts</a>(<span class="stringliteral">"\t/ImageMatrix [ 1 0 0 -1 0 1 ]\n"</span>, v);
00678 
00679     <a class="code" href="group__util.html#ga16">stp_puts</a>(<span class="stringliteral">"&gt;&gt;\n"</span>, v);
00680     <a class="code" href="group__util.html#ga16">stp_puts</a>(<span class="stringliteral">"image\n"</span>, v);
00681 
00682     <span class="keywordflow">for</span> (y = 0, out_offset = 0; y &lt; image_height; y ++)
00683     {
00684       <span class="comment">/* FIXME!!! */</span>
00685       <span class="keywordflow">if</span> (<a class="code" href="group__color.html#ga14">stp_color_get_row</a>(nv, image, y <span class="comment">/*, out + out_offset */</span> , &amp;zero_mask))
00686         {
00687           status = 2;
00688           <span class="keywordflow">break</span>;
00689         }
00690       out = <a class="code" href="channel_8c.html#a20">stp_channel_get_input</a>(nv);
00691 
00692       out_ps_height = out_offset + image_width * out_channels;
00693 
00694       <span class="keywordflow">if</span> (y &lt; (image_height - 1))
00695       {
00696         <a class="code" href="print-ps_8c.html#a11">ps_ascii85</a>(v, out, out_ps_height &amp; ~3, 0);
00697         out_offset = out_ps_height &amp; 3;
00698       }
00699       <span class="keywordflow">else</span>
00700       {
00701         <a class="code" href="print-ps_8c.html#a11">ps_ascii85</a>(v, out, out_ps_height, 1);
00702         out_offset = 0;
00703       }
00704 
00705       <span class="keywordflow">if</span> (out_offset &gt; 0)
00706         memcpy(out, out + out_ps_height - out_offset, out_offset);
00707     }
00708   }
00709   <a class="code" href="group__image.html#ga6">stp_image_conclude</a>(image);
00710 
00711   <a class="code" href="group__util.html#ga16">stp_puts</a>(<span class="stringliteral">"grestore\n"</span>, v);
00712   <a class="code" href="group__util.html#ga16">stp_puts</a>(<span class="stringliteral">"showpage\n"</span>, v);
00713   <a class="code" href="group__util.html#ga16">stp_puts</a>(<span class="stringliteral">"%%Trailer\n"</span>, v);
00714   <a class="code" href="group__util.html#ga16">stp_puts</a>(<span class="stringliteral">"%%EOF\n"</span>, v);
00715   <a class="code" href="group__vars.html#ga26">stp_vars_destroy</a>(nv);
00716   <span class="keywordflow">return</span> status;
00717 }
00718 
00719 <span class="keyword">static</span> <span class="keywordtype">int</span>
<a name="l00720"></a><a class="code" href="print-ps_8c.html#a25">00720</a> <a class="code" href="print-ps_8c.html#a25">ps_print</a>(<span class="keyword">const</span> <a class="code" href="structstp__vars.html">stp_vars_t</a> *v, <a class="code" href="structstp__image.html">stp_image_t</a> *image)
00721 {
00722   <span class="keywordtype">int</span> status;
00723   setlocale(LC_ALL, <span class="stringliteral">"C"</span>);
00724   status = <a class="code" href="print-ps_8c.html#a24">ps_print_internal</a>(v, image);
00725   setlocale(LC_ALL, <span class="stringliteral">""</span>);
00726   <span class="keywordflow">return</span> status;
00727 }
00728 
00729 
00730 <span class="comment">/*</span>
00731 <span class="comment"> * 'ps_hex()' - Print binary data as a series of hexadecimal numbers.</span>
00732 <span class="comment"> */</span>
00733 
00734 <span class="keyword">static</span> <span class="keywordtype">void</span>
<a name="l00735"></a><a class="code" href="print-ps_8c.html#a10">00735</a> <a class="code" href="print-ps_8c.html#a10">ps_hex</a>(<span class="keyword">const</span> <a class="code" href="structstp__vars.html">stp_vars_t</a> *v,     <span class="comment">/* I - File to print to */</span>
00736        <span class="keywordtype">unsigned</span> <span class="keywordtype">short</span>   *data,  <span class="comment">/* I - Data to print */</span>
00737        <span class="keywordtype">int</span>              length) <span class="comment">/* I - Number of bytes to print */</span>
00738 {
00739   <span class="keywordtype">int</span>           col;            <span class="comment">/* Current column */</span>
00740   <span class="keyword">static</span> <span class="keyword">const</span> <span class="keywordtype">char</span>     *hex = <span class="stringliteral">"0123456789ABCDEF"</span>;
00741 
00742 
00743   col = 0;
00744   <span class="keywordflow">while</span> (length &gt; 0)
00745   {
00746     <span class="keywordtype">unsigned</span> <span class="keywordtype">char</span> pixel = (*data &amp; 0xff00) &gt;&gt; 8;
00747    <span class="comment">/*</span>
00748 <span class="comment">    * Put the hex chars out to the file; note that we don't use stp_zprintf()</span>
00749 <span class="comment">    * for speed reasons...</span>
00750 <span class="comment">    */</span>
00751 
00752     <a class="code" href="group__util.html#ga11">stp_putc</a>(hex[pixel &gt;&gt; 4], v);
00753     <a class="code" href="group__util.html#ga11">stp_putc</a>(hex[pixel &amp; 15], v);
00754 
00755     data ++;
00756     length --;
00757 
00758     col += 2;
00759     <span class="keywordflow">if</span> (col &gt;= 72)
00760     {
00761       col = 0;
00762       <a class="code" href="group__util.html#ga11">stp_putc</a>(<span class="charliteral">'\n'</span>, v);
00763     }
00764   }
00765 
00766   <span class="keywordflow">if</span> (col &gt; 0)
00767     <a class="code" href="group__util.html#ga11">stp_putc</a>(<span class="charliteral">'\n'</span>, v);
00768 }
00769 
00770 
00771 <span class="comment">/*</span>
00772 <span class="comment"> * 'ps_ascii85()' - Print binary data as a series of base-85 numbers.</span>
00773 <span class="comment"> */</span>
00774 
00775 <span class="keyword">static</span> <span class="keywordtype">void</span>
<a name="l00776"></a><a class="code" href="print-ps_8c.html#a11">00776</a> <a class="code" href="print-ps_8c.html#a11">ps_ascii85</a>(<span class="keyword">const</span> <a class="code" href="structstp__vars.html">stp_vars_t</a> *v, <span class="comment">/* I - File to print to */</span>
00777            <span class="keywordtype">unsigned</span> <span class="keywordtype">short</span> *data,        <span class="comment">/* I - Data to print */</span>
00778            <span class="keywordtype">int</span>            length,       <span class="comment">/* I - Number of bytes to print */</span>
00779            <span class="keywordtype">int</span>            last_line)    <span class="comment">/* I - Last line of raster data? */</span>
00780 {
00781   <span class="keywordtype">int</span>           i;                      <span class="comment">/* Looping var */</span>
00782   <span class="keywordtype">unsigned</span>      b;                      <span class="comment">/* Binary data word */</span>
00783   <span class="keywordtype">unsigned</span> <span class="keywordtype">char</span> c[5];                   <span class="comment">/* ASCII85 encoded chars */</span>
00784   <span class="keyword">static</span> <span class="keywordtype">int</span>    column = 0;             <span class="comment">/* Current column */</span>
00785 
00786 
00787   <span class="keywordflow">while</span> (length &gt; 3)
00788   {
00789     <span class="keywordtype">unsigned</span> <span class="keywordtype">char</span> d0 = (data[0] &amp; 0xff00) &gt;&gt; 8;
00790     <span class="keywordtype">unsigned</span> <span class="keywordtype">char</span> d1 = (data[1] &amp; 0xff00) &gt;&gt; 8;
00791     <span class="keywordtype">unsigned</span> <span class="keywordtype">char</span> d2 = (data[2] &amp; 0xff00) &gt;&gt; 8;
00792     <span class="keywordtype">unsigned</span> <span class="keywordtype">char</span> d3 = (data[3] &amp; 0xff00) &gt;&gt; 8;
00793     b = (((((d0 &lt;&lt; 8) | d1) &lt;&lt; 8) | d2) &lt;&lt; 8) | d3;
00794 
00795     <span class="keywordflow">if</span> (b == 0)
00796     {
00797       <a class="code" href="group__util.html#ga11">stp_putc</a>(<span class="charliteral">'z'</span>, v);
00798       column ++;
00799     }
00800     <span class="keywordflow">else</span>
00801     {
00802       c[4] = (b % 85) + <span class="charliteral">'!'</span>;
00803       b /= 85;
00804       c[3] = (b % 85) + <span class="charliteral">'!'</span>;
00805       b /= 85;
00806       c[2] = (b % 85) + <span class="charliteral">'!'</span>;
00807       b /= 85;
00808       c[1] = (b % 85) + <span class="charliteral">'!'</span>;
00809       b /= 85;
00810       c[0] = b + <span class="charliteral">'!'</span>;
00811 
00812       <a class="code" href="group__util.html#ga10">stp_zfwrite</a>((<span class="keyword">const</span> <span class="keywordtype">char</span> *)c, 5, 1, v);
00813       column += 5;
00814     }
00815 
00816     <span class="keywordflow">if</span> (column &gt; 72)
00817     {
00818       <a class="code" href="group__util.html#ga11">stp_putc</a>(<span class="charliteral">'\n'</span>, v);
00819       column = 0;
00820     }
00821 
00822     data += 4;
00823     length -= 4;
00824   }
00825 
00826   <span class="keywordflow">if</span> (last_line)
00827   {
00828     <span class="keywordflow">if</span> (length &gt; 0)
00829     {
00830       <span class="keywordflow">for</span> (b = 0, i = length; i &gt; 0; b = (b &lt;&lt; 8) | data[0], data ++, i --);
00831 
00832       c[4] = (b % 85) + <span class="charliteral">'!'</span>;
00833       b /= 85;
00834       c[3] = (b % 85) + <span class="charliteral">'!'</span>;
00835       b /= 85;
00836       c[2] = (b % 85) + <span class="charliteral">'!'</span>;
00837       b /= 85;
00838       c[1] = (b % 85) + <span class="charliteral">'!'</span>;
00839       b /= 85;
00840       c[0] = b + <span class="charliteral">'!'</span>;
00841 
00842       <a class="code" href="group__util.html#ga10">stp_zfwrite</a>((<span class="keyword">const</span> <span class="keywordtype">char</span> *)c, length + 1, 1, v);
00843     }
00844 
00845     <a class="code" href="group__util.html#ga16">stp_puts</a>(<span class="stringliteral">"~&gt;\n"</span>, v);
00846     column = 0;
00847   }
00848 }
00849 
00850 
00851 <span class="comment">/*</span>
00852 <span class="comment"> * 'ppd_find()' - Find a control string with the specified name &amp; parameters.</span>
00853 <span class="comment"> */</span>
00854 
00855 <span class="keyword">static</span> <span class="keywordtype">char</span> *                   <span class="comment">/* O - Control string */</span>
<a name="l00856"></a><a class="code" href="print-ps_8c.html#a12">00856</a> <a class="code" href="print-ps_8c.html#a12">ppd_find</a>(<span class="keyword">const</span> <span class="keywordtype">char</span> *ppd_file,  <span class="comment">/* I - Name of PPD file */</span>
00857          <span class="keyword">const</span> <span class="keywordtype">char</span> *name,      <span class="comment">/* I - Name of parameter */</span>
00858          <span class="keyword">const</span> <span class="keywordtype">char</span> *option,    <span class="comment">/* I - Value of parameter */</span>
00859          <span class="keywordtype">int</span>  *order)           <span class="comment">/* O - Order of the control string */</span>
00860 {
00861   <span class="keywordtype">char</span>          line[1024],     <span class="comment">/* Line from file */</span>
00862                 lname[255],     <span class="comment">/* Name from line */</span>
00863                 loption[255],   <span class="comment">/* Value from line */</span>
00864                 *opt;           <span class="comment">/* Current control string pointer */</span>
00865   <span class="keyword">static</span> <span class="keywordtype">char</span>   *value = NULL;  <span class="comment">/* Current control string value */</span>
00866 
00867 
00868   <span class="keywordflow">if</span> (ppd_file == NULL || name == NULL || option == NULL)
00869     <span class="keywordflow">return</span> (NULL);
00870   <span class="keywordflow">if</span> (!value)
00871     value = <a class="code" href="group__util.html#ga29">stp_zalloc</a>(32768);
00872 
00873   <span class="keywordflow">if</span> (<a class="code" href="print-ps_8c.html#a3">ps_ppd_file</a> == NULL || strcmp(<a class="code" href="print-ps_8c.html#a3">ps_ppd_file</a>, ppd_file) != 0)
00874   {
00875     <span class="keywordflow">if</span> (<a class="code" href="print-ps_8c.html#a2">ps_ppd</a> != NULL)
00876       fclose(<a class="code" href="print-ps_8c.html#a2">ps_ppd</a>);
00877 
00878     <a class="code" href="print-ps_8c.html#a2">ps_ppd</a> = fopen(ppd_file, <span class="stringliteral">"r"</span>);
00879 
00880     <span class="keywordflow">if</span> (<a class="code" href="print-ps_8c.html#a2">ps_ppd</a> == NULL)
00881       <a class="code" href="print-ps_8c.html#a3">ps_ppd_file</a> = NULL;
00882     <span class="keywordflow">else</span>
00883       <a class="code" href="print-ps_8c.html#a3">ps_ppd_file</a> = ppd_file;
00884   }
00885 
00886   <span class="keywordflow">if</span> (<a class="code" href="print-ps_8c.html#a2">ps_ppd</a> == NULL)
00887     <span class="keywordflow">return</span> (NULL);
00888 
00889   <span class="keywordflow">if</span> (order != NULL)
00890     *order = 1000;
00891 
00892   rewind(<a class="code" href="print-ps_8c.html#a2">ps_ppd</a>);
00893   <span class="keywordflow">while</span> (fgets(line, <span class="keyword">sizeof</span>(line), <a class="code" href="print-ps_8c.html#a2">ps_ppd</a>) != NULL)
00894   {
00895     <span class="keywordflow">if</span> (line[0] != <span class="charliteral">'*'</span>)
00896       <span class="keywordflow">continue</span>;
00897 
00898     <span class="keywordflow">if</span> (strncasecmp(line, <span class="stringliteral">"*OrderDependency:"</span>, 17) == 0 &amp;&amp; order != NULL)
00899     {
00900       sscanf(line, <span class="stringliteral">"%*s%d"</span>, order);
00901       <span class="keywordflow">continue</span>;
00902     }
00903     <span class="keywordflow">else</span> <span class="keywordflow">if</span> (sscanf(line, <span class="stringliteral">"*%s %[^/:]"</span>, lname, loption) != 2)
00904       <span class="keywordflow">continue</span>;
00905 
00906     <span class="keywordflow">if</span> (strcasecmp(lname, name) == 0 &amp;&amp;
00907         strcasecmp(loption, option) == 0)
00908     {
00909       opt = strchr(line, <span class="charliteral">':'</span>) + 1;
00910       <span class="keywordflow">while</span> (*opt == <span class="charliteral">' '</span> || *opt == <span class="charliteral">'\t'</span>)
00911         opt ++;
00912       <span class="keywordflow">if</span> (*opt != <span class="charliteral">'\"'</span>)
00913         <span class="keywordflow">continue</span>;
00914 
00915       strcpy(value, opt + 1);
00916       <span class="keywordflow">if</span> ((opt = strchr(value, <span class="charliteral">'\"'</span>)) == NULL)
00917       {
00918         <span class="keywordflow">while</span> (fgets(line, <span class="keyword">sizeof</span>(line), <a class="code" href="print-ps_8c.html#a2">ps_ppd</a>) != NULL)
00919         {
00920           strcat(value, line);
00921           <span class="keywordflow">if</span> (strchr(line, <span class="charliteral">'\"'</span>) != NULL)
00922           {
00923             strcpy(strchr(value, <span class="charliteral">'\"'</span>), <span class="stringliteral">"\n"</span>);
00924             <span class="keywordflow">break</span>;
00925           }
00926         }
00927       }
00928       <span class="keywordflow">else</span>
00929         *opt = <span class="charliteral">'\0'</span>;
00930 
00931       <span class="keywordflow">return</span> (value);
00932     }
00933   }
00934 
00935   <span class="keywordflow">return</span> (NULL);
00936 }
00937 
<a name="l00938"></a><a class="code" href="print-ps_8c.html#a6">00938</a> <span class="keyword">static</span> <span class="keyword">const</span> <a class="code" href="structstp__printfuncs__t.html">stp_printfuncs_t</a> <a class="code" href="print-ps_8c.html#a6">print_ps_printfuncs</a> =
00939 {
00940   <a class="code" href="print-ps_8c.html#a13">ps_list_parameters</a>,
00941   <a class="code" href="print-ps_8c.html#a15">ps_parameters</a>,
00942   <a class="code" href="print-ps_8c.html#a17">ps_media_size</a>,
00943   <a class="code" href="print-ps_8c.html#a19">ps_imageable_area</a>,
00944   <a class="code" href="print-ps_8c.html#a20">ps_limit</a>,
00945   <a class="code" href="print-ps_8c.html#a25">ps_print</a>,
00946   <a class="code" href="print-ps_8c.html#a22">ps_describe_resolution</a>,
00947   <a class="code" href="print-ps_8c.html#a23">ps_describe_output</a>,
00948   <a class="code" href="group__printer.html#ga19">stp_verify_printer_params</a>,
00949   NULL,
00950   NULL
00951 };
00952 
00953 
<a name="l00954"></a><a class="code" href="print-ps_8c.html#a7">00954</a> <span class="keyword">static</span> <a class="code" href="structstp__family.html">stp_family_t</a> <a class="code" href="print-ps_8c.html#a7">print_ps_module_data</a> =
00955   {
00956     &amp;<a class="code" href="print-ps_8c.html#a6">print_ps_printfuncs</a>,
00957     NULL
00958   };
00959 
00960 
00961 <span class="keyword">static</span> <span class="keywordtype">int</span>
<a name="l00962"></a><a class="code" href="print-ps_8c.html#a26">00962</a> <a class="code" href="print-ps_8c.html#a26">print_ps_module_init</a>(<span class="keywordtype">void</span>)
00963 {
00964   <span class="keywordflow">return</span> <a class="code" href="group__printer.html#ga46">stp_family_register</a>(<a class="code" href="print-ps_8c.html#a7">print_ps_module_data</a>.<a class="code" href="structstp__family.html#o1">printer_list</a>);
00965 }
00966 
00967 
00968 <span class="keyword">static</span> <span class="keywordtype">int</span>
<a name="l00969"></a><a class="code" href="print-ps_8c.html#a27">00969</a> <a class="code" href="print-ps_8c.html#a27">print_ps_module_exit</a>(<span class="keywordtype">void</span>)
00970 {
00971   <span class="keywordflow">return</span> <a class="code" href="group__printer.html#ga47">stp_family_unregister</a>(<a class="code" href="print-ps_8c.html#a7">print_ps_module_data</a>.<a class="code" href="structstp__family.html#o1">printer_list</a>);
00972 }
00973 
00974 
00975 <span class="comment">/* Module header */</span>
<a name="l00976"></a><a class="code" href="print-ps_8c.html#a0">00976</a> <span class="preprocessor">#define stp_module_version print_ps_LTX_stp_module_version</span>
<a name="l00977"></a><a class="code" href="print-ps_8c.html#a1">00977</a> <span class="preprocessor"></span><span class="preprocessor">#define stp_module_data print_ps_LTX_stp_module_data</span>
00978 <span class="preprocessor"></span>
<a name="l00979"></a><a class="code" href="print-ps_8c.html#a8">00979</a> <a class="code" href="structstp__module__version.html">stp_module_version_t</a> <a class="code" href="structstp__module__version.html">stp_module_version</a> = {0, 0};
00980 
<a name="l00981"></a><a class="code" href="print-ps_8c.html#a9">00981</a> <a class="code" href="structstp__module.html">stp_module_t</a> <a class="code" href="print-canon_8c.html#a45">stp_module_data</a> =
00982   {
00983     <span class="stringliteral">"ps"</span>,
00984     VERSION,
00985     <span class="stringliteral">"Postscript family driver"</span>,
00986     <a class="code" href="module_8h.html#a13a4">STP_MODULE_CLASS_FAMILY</a>,
00987     NULL,
00988     <a class="code" href="print-ps_8c.html#a26">print_ps_module_init</a>,
00989     <a class="code" href="print-ps_8c.html#a27">print_ps_module_exit</a>,
00990     (<span class="keywordtype">void</span> *) &amp;<a class="code" href="print-ps_8c.html#a7">print_ps_module_data</a>
00991   };
00992 
</pre></div><hr size="1"><address style="align: right;"><small>Generated on Wed Aug 25 07:56:14 2004 for libgimpprint API Reference by
<a href="http://www.doxygen.org/index.html">
<img src="doxygen.png" alt="doxygen" align="middle" border=0 > </a>1.3.6 </small></address>
</body>
</html>
