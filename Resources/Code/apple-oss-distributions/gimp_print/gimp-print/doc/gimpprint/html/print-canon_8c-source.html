<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html><head><meta http-equiv="Content-Type" content="text/html;charset=iso-8859-1">
<title>libgimpprint API Reference: src/main/print-canon.c Source File</title>
<link href="doxygen.css" rel="stylesheet" type="text/css">
</head><body>
<!-- Generated by Doxygen 1.3.6 -->
<div class="qindex"><a class="qindex" href="index.html">Main&nbsp;Page</a> | <a class="qindex" href="modules.html">Modules</a> | <a class="qindex" href="classes.html">Alphabetical&nbsp;List</a> | <a class="qindex" href="annotated.html">Data&nbsp;Structures</a> | <a class="qindex" href="files.html">File&nbsp;List</a> | <a class="qindex" href="functions.html">Data&nbsp;Fields</a> | <a class="qindex" href="globals.html">Globals</a> | <a class="qindex" href="pages.html">Related&nbsp;Pages</a></div>
<h1>src/main/print-canon.c</h1><a href="print-canon_8c.html">Go to the documentation of this file.</a><div class="fragment"><pre>00001 <span class="comment">/*</span>
00002 <span class="comment"> * "$Id: print-canon_8c-source.html,v 1.1.1.2 2004/12/22 23:49:06 jlovell Exp $"</span>
00003 <span class="comment"> *</span>
00004 <span class="comment"> *   Print plug-in CANON BJL driver for the GIMP.</span>
00005 <span class="comment"> *</span>
00006 <span class="comment"> *   Copyright 1997-2000 Michael Sweet (mike@easysw.com),</span>
00007 <span class="comment"> *      Robert Krawitz (rlk@alum.mit.edu) and</span>
00008 <span class="comment"> *      Andy Thaller (thaller@ph.tum.de)</span>
00009 <span class="comment"> *</span>
00010 <span class="comment"> *   This program is free software; you can redistribute it and/or modify it</span>
00011 <span class="comment"> *   under the terms of the GNU General Public License as published by the Free</span>
00012 <span class="comment"> *   Software Foundation; either version 2 of the License, or (at your option)</span>
00013 <span class="comment"> *   any later version.</span>
00014 <span class="comment"> *</span>
00015 <span class="comment"> *   This program is distributed in the hope that it will be useful, but</span>
00016 <span class="comment"> *   WITHOUT ANY WARRANTY; without even the implied warranty of MERCHANTABILITY</span>
00017 <span class="comment"> *   or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU General Public License</span>
00018 <span class="comment"> *   for more details.</span>
00019 <span class="comment"> *</span>
00020 <span class="comment"> *   You should have received a copy of the GNU General Public License</span>
00021 <span class="comment"> *   along with this program; if not, write to the Free Software</span>
00022 <span class="comment"> *   Foundation, Inc., 59 Temple Place - Suite 330, Boston, MA 02111-1307, USA.</span>
00023 <span class="comment"> */</span>
00024 
00025 <span class="comment">/*</span>
00026 <span class="comment"> * This file must include only standard C header files.  The core code must</span>
00027 <span class="comment"> * compile on generic platforms that don't support glib, gimp, gtk, etc.</span>
00028 <span class="comment"> */</span>
00029 
00030 <span class="comment">/*</span>
00031 <span class="comment"> * Large parts of this file (mainly the ink handling) is based on</span>
00032 <span class="comment"> * print-escp2.c -- refer to README.new-printer on how to adjust the colors</span>
00033 <span class="comment"> * for a certain model.</span>
00034 <span class="comment"> */</span>
00035 
00036 <span class="comment">/* TODO-LIST</span>
00037 <span class="comment"> *</span>
00038 <span class="comment"> *   * adjust the colors of all supported models</span>
00039 <span class="comment"> *</span>
00040 <span class="comment"> */</span>
00041 
00042 <span class="preprocessor">#ifdef HAVE_CONFIG_H</span>
00043 <span class="preprocessor"></span><span class="preprocessor">#include &lt;config.h&gt;</span>
00044 <span class="preprocessor">#endif</span>
00045 <span class="preprocessor"></span><span class="preprocessor">#include &lt;<a class="code" href="gimp-print_8h.html">gimp-print/gimp-print.h</a>&gt;</span>
00046 <span class="preprocessor">#include "<a class="code" href="gimp-print-internal_8h.html">gimp-print-internal.h</a>"</span>
00047 <span class="preprocessor">#include &lt;<a class="code" href="gimp-print-intl-internal_8h.html">gimp-print/gimp-print-intl-internal.h</a>&gt;</span>
00048 <span class="preprocessor">#include &lt;string.h&gt;</span>
00049 <span class="preprocessor">#include &lt;stdio.h&gt;</span>
00050 <span class="preprocessor">#if defined(HAVE_VARARGS_H) &amp;&amp; !defined(HAVE_STDARG_H)</span>
00051 <span class="preprocessor"></span><span class="preprocessor">#include &lt;varargs.h&gt;</span>
00052 <span class="preprocessor">#else</span>
00053 <span class="preprocessor"></span><span class="preprocessor">#include &lt;stdarg.h&gt;</span>
00054 <span class="preprocessor">#endif</span>
00055 <span class="preprocessor"></span><span class="preprocessor">#ifdef HAVE_LIMITS_H</span>
00056 <span class="preprocessor"></span><span class="preprocessor">#include &lt;limits.h&gt;</span>
00057 <span class="preprocessor">#endif</span>
00058 <span class="preprocessor"></span>
00059 <span class="comment">/* Solaris with gcc has problems because gcc's limits.h doesn't #define */</span>
00060 <span class="comment">/* this */</span>
00061 <span class="preprocessor">#ifndef CHAR_BIT</span>
<a name="l00062"></a><a class="code" href="print-canon_8c.html#a0">00062</a> <span class="preprocessor"></span><span class="preprocessor">#define CHAR_BIT 8</span>
00063 <span class="preprocessor"></span><span class="preprocessor">#endif</span>
00064 <span class="preprocessor"></span>
00065 <span class="preprocessor">#if (0)</span>
00066 <span class="preprocessor"></span><span class="preprocessor">#define EXPERIMENTAL_STUFF 0</span>
00067 <span class="preprocessor"></span><span class="preprocessor">#endif</span>
00068 <span class="preprocessor"></span>
<a name="l00069"></a><a class="code" href="print-canon_8c.html#a1">00069</a> <span class="preprocessor">#define MAX_CARRIAGE_WIDTH      13 </span><span class="comment">/* This really needs to go away */</span>
00070 
00071 <span class="comment">/*</span>
00072 <span class="comment"> * We really need to get away from this silly static nonsense...</span>
00073 <span class="comment"> */</span>
00074 <span class="preprocessor">#define MAX_PHYSICAL_BPI 1440</span>
<a name="l00075"></a><a class="code" href="print-canon_8c.html#a2">00075</a> <span class="preprocessor"></span><span class="preprocessor">#define MAX_OVERSAMPLED 8</span>
<a name="l00076"></a><a class="code" href="print-canon_8c.html#a3">00076</a> <span class="preprocessor"></span><span class="preprocessor">#define MAX_BPP 4</span>
<a name="l00077"></a><a class="code" href="print-canon_8c.html#a4">00077</a> <span class="preprocessor"></span><span class="preprocessor">#define COMPBUFWIDTH (MAX_PHYSICAL_BPI * MAX_OVERSAMPLED * MAX_BPP * \</span>
<a name="l00078"></a><a class="code" href="print-canon_8c.html#a5">00078</a> <span class="preprocessor">        MAX_CARRIAGE_WIDTH / CHAR_BIT)</span>
00079 <span class="preprocessor"></span>
00080 <span class="preprocessor">#define MIN(a,b) (((a)&lt;(b)) ? (a) : (b))</span>
<a name="l00081"></a><a class="code" href="print-canon_8c.html#a6">00081</a> <span class="preprocessor"></span><span class="preprocessor">#define MAX(a, b) ((a) &gt; (b) ? (a) : (b))</span>
<a name="l00082"></a><a class="code" href="print-canon_8c.html#a7">00082</a> <span class="preprocessor"></span>
00083 <span class="keyword">static</span> <span class="keyword">const</span> <span class="keywordtype">int</span> <a class="code" href="print-canon_8c.html#a46">channel_color_map</a>[] =
<a name="l00084"></a><a class="code" href="print-canon_8c.html#a46">00084</a> {
00085   <a class="code" href="dither_8h.html#a0">STP_ECOLOR_K</a>, <a class="code" href="dither_8h.html#a1">STP_ECOLOR_C</a>, <a class="code" href="dither_8h.html#a2">STP_ECOLOR_M</a>, <a class="code" href="dither_8h.html#a3">STP_ECOLOR_Y</a>, <a class="code" href="dither_8h.html#a1">STP_ECOLOR_C</a>, <a class="code" href="dither_8h.html#a2">STP_ECOLOR_M</a>, <a class="code" href="dither_8h.html#a3">STP_ECOLOR_Y</a>
00086 };
00087 
00088 <span class="keyword">static</span> <span class="keyword">const</span> <span class="keywordtype">int</span> <a class="code" href="print-canon_8c.html#a47">subchannel_color_map</a>[] =
<a name="l00089"></a><a class="code" href="print-canon_8c.html#a47">00089</a> {
00090   0, 0, 0, 0, 1, 1, 1
00091 };
00092 
00093 <span class="keyword">static</span> <span class="keyword">const</span> <span class="keywordtype">double</span> <a class="code" href="print-canon_8c.html#a48">ink_darknesses</a>[] =
<a name="l00094"></a><a class="code" href="print-canon_8c.html#a48">00094</a> {
00095   1.0, 0.31 / .5, 0.61 / .97, 0.08
00096 };
00097 
00098 <span class="preprocessor">#define USE_3BIT_FOLD_TYPE 323</span>
<a name="l00099"></a><a class="code" href="print-canon_8c.html#a8">00099</a> <span class="preprocessor"></span>
00100 <span class="comment">/*</span>
00101 <span class="comment"> * For each printer, we can select from a variety of dot sizes.</span>
00102 <span class="comment"> * For single dot size printers, the available sizes are usually 0,</span>
00103 <span class="comment"> * which is the "default", and some subset of 1-4.  For simple variable</span>
00104 <span class="comment"> * dot size printers (with only one kind of variable dot size), the</span>
00105 <span class="comment"> * variable dot size is specified as 0x10.  For newer printers, there</span>
00106 <span class="comment"> * is a choice of variable dot sizes available, 0x10, 0x11, and 0x12 in</span>
00107 <span class="comment"> * order of increasing size.</span>
00108 <span class="comment"> *</span>
00109 <span class="comment"> * Normally, we want to specify the smallest dot size that lets us achieve</span>
00110 <span class="comment"> * a density of less than .8 or thereabouts (above that we start to get</span>
00111 <span class="comment"> * some dither artifacts).  This needs to be tested for each printer and</span>
00112 <span class="comment"> * resolution.</span>
00113 <span class="comment"> *</span>
00114 <span class="comment"> * An entry of -1 in a slot means that this resolution is not available.</span>
00115 <span class="comment"> *              0                      standard dot sizes are used.</span>
00116 <span class="comment"> *              1                      drop modulation is used.</span>
00117 <span class="comment"> */</span>
00118 
00119 <span class="comment">/* We know a per-model base resolution (like 180dpi or 150dpi)</span>
00120 <span class="comment"> * and multipliers for the base resolution in the dotsize-, densities-</span>
00121 <span class="comment"> * and inklist:</span>
00122 <span class="comment"> * for 180dpi base resolution we would have</span>
00123 <span class="comment"> *   s_r11_4 for 4color ink @180dpi</span>
00124 <span class="comment"> *   s_r22_4 for 4color ink @360dpi</span>
00125 <span class="comment"> *   s_r33_4 for 4color ink @720dpi</span>
00126 <span class="comment"> *   s_r43_4 for 4color ink @1440x720dpi</span>
00127 <span class="comment"> */</span>
00128 
00129 <span class="keyword">typedef</span> <span class="keyword">struct </span><a class="code" href="structcanon__dot__sizes.html">canon_dot_sizes</a>
<a name="l00130"></a><a class="code" href="structcanon__dot__sizes.html">00130</a> {
00131   <span class="keywordtype">int</span> <a class="code" href="structcanon__dot__sizes.html#o0">dot_r11</a>;    <span class="comment">/*  180x180  or   150x150  */</span>
<a name="l00132"></a><a class="code" href="structcanon__dot__sizes.html#o0">00132</a>   <span class="keywordtype">int</span> <a class="code" href="structcanon__dot__sizes.html#o1">dot_r22</a>;    <span class="comment">/*  360x360  or   300x300  */</span>
<a name="l00133"></a><a class="code" href="structcanon__dot__sizes.html#o1">00133</a>   <span class="keywordtype">int</span> <a class="code" href="structcanon__dot__sizes.html#o2">dot_r33</a>;    <span class="comment">/*  720x720  or   600x600  */</span>
<a name="l00134"></a><a class="code" href="structcanon__dot__sizes.html#o2">00134</a>   <span class="keywordtype">int</span> <a class="code" href="structcanon__dot__sizes.html#o3">dot_r43</a>;    <span class="comment">/* 1440x720  or  1200x600  */</span>
<a name="l00135"></a><a class="code" href="structcanon__dot__sizes.html#o3">00135</a>   <span class="keywordtype">int</span> <a class="code" href="structcanon__dot__sizes.html#o4">dot_r44</a>;    <span class="comment">/* 1440x1440 or  1200x1200 */</span>
<a name="l00136"></a><a class="code" href="structcanon__dot__sizes.html#o4">00136</a>   <span class="keywordtype">int</span> <a class="code" href="structcanon__dot__sizes.html#o5">dot_r55</a>;    <span class="comment">/* 2880x2880 or  2400x2400 */</span>
<a name="l00137"></a><a class="code" href="structcanon__dot__sizes.html#o5">00137</a> } <a class="code" href="structcanon__dot__sizes.html">canon_dot_size_t</a>;
00138 
00139 <span class="comment">/*</span>
00140 <span class="comment"> * Specify the base density for each available resolution.</span>
00141 <span class="comment"> *</span>
00142 <span class="comment"> */</span>
00143 
00144 <span class="keyword">typedef</span> <span class="keyword">struct </span><a class="code" href="structcanon__densities.html">canon_densities</a>
<a name="l00145"></a><a class="code" href="structcanon__densities.html">00145</a> {
00146   <span class="keywordtype">double</span> <a class="code" href="structcanon__densities.html#o0">d_r11</a>;  <span class="comment">/*  180x180  or   150x150  */</span>
<a name="l00147"></a><a class="code" href="structcanon__densities.html#o0">00147</a>   <span class="keywordtype">double</span> <a class="code" href="structcanon__densities.html#o1">d_r22</a>;  <span class="comment">/*  360x360  or   300x300  */</span>
<a name="l00148"></a><a class="code" href="structcanon__densities.html#o1">00148</a>   <span class="keywordtype">double</span> <a class="code" href="structcanon__densities.html#o2">d_r33</a>;  <span class="comment">/*  720x720  or   600x600  */</span>
<a name="l00149"></a><a class="code" href="structcanon__densities.html#o2">00149</a>   <span class="keywordtype">double</span> <a class="code" href="structcanon__densities.html#o3">d_r43</a>;  <span class="comment">/* 1440x720  or  1200x600  */</span>
<a name="l00150"></a><a class="code" href="structcanon__densities.html#o3">00150</a>   <span class="keywordtype">double</span> <a class="code" href="structcanon__densities.html#o4">d_r44</a>;  <span class="comment">/* 1440x1440 or  1200x1200 */</span>
<a name="l00151"></a><a class="code" href="structcanon__densities.html#o4">00151</a>   <span class="keywordtype">double</span> <a class="code" href="structcanon__densities.html#o5">d_r55</a>;  <span class="comment">/* 2880x2880 or  2400x2400 */</span>
<a name="l00152"></a><a class="code" href="structcanon__densities.html#o5">00152</a> } <a class="code" href="structcanon__densities.html">canon_densities_t</a>;
00153 
00154 
00155 
00156 <span class="comment">/*</span>
00157 <span class="comment"> * Definition of the multi-level inks available to a given printer.</span>
00158 <span class="comment"> * Each printer may use a different kind of ink droplet for variable</span>
00159 <span class="comment"> * and single drop size for each supported horizontal resolution and</span>
00160 <span class="comment"> * type of ink (4 or 6 color).</span>
00161 <span class="comment"> *</span>
00162 <span class="comment"> * Recall that 6 color ink is treated as simply another kind of</span>
00163 <span class="comment"> * multi-level ink, but the driver offers the user a choice of 4 and</span>
00164 <span class="comment"> * 6 color ink, so we need to define appropriate inksets for both</span>
00165 <span class="comment"> * kinds of ink.</span>
00166 <span class="comment"> *</span>
00167 <span class="comment"> * Stuff like the MIS 4 and 6 "color" monochrome inks doesn't fit into</span>
00168 <span class="comment"> * this model very nicely, so we'll either have to special case it</span>
00169 <span class="comment"> * or find some way of handling it in here.</span>
00170 <span class="comment"> */</span>
00171 
00172 <span class="keyword">typedef</span> <span class="keyword">struct </span><a class="code" href="structcanon__variable__ink.html">canon_variable_ink</a>
<a name="l00173"></a><a class="code" href="structcanon__variable__ink.html">00173</a> {
00174   <span class="keywordtype">double</span> density;
<a name="l00175"></a><a class="code" href="structcanon__variable__ink.html#o0">00175</a>   <span class="keyword">const</span> <a class="code" href="structstp__shade.html">stp_shade_t</a> *<a class="code" href="structcanon__variable__ink.html#o1">shades</a>;
<a name="l00176"></a><a class="code" href="structcanon__variable__ink.html#o1">00176</a>   <span class="keywordtype">int</span> <a class="code" href="structcanon__variable__ink.html#o2">numshades</a>;
<a name="l00177"></a><a class="code" href="structcanon__variable__ink.html#o2">00177</a> } <a class="code" href="structcanon__variable__ink.html">canon_variable_ink_t</a>;
00178 
00179 <span class="keyword">typedef</span> <span class="keyword">struct </span><a class="code" href="structcanon__variable__inkset.html">canon_variable_inkset</a>
<a name="l00180"></a><a class="code" href="structcanon__variable__inkset.html">00180</a> {
00181   <span class="keyword">const</span> <a class="code" href="structcanon__variable__ink.html">canon_variable_ink_t</a> *c;
<a name="l00182"></a><a class="code" href="structcanon__variable__inkset.html#o0">00182</a>   <span class="keyword">const</span> <a class="code" href="structcanon__variable__ink.html">canon_variable_ink_t</a> *<a class="code" href="structcanon__variable__inkset.html#o1">m</a>;
<a name="l00183"></a><a class="code" href="structcanon__variable__inkset.html#o1">00183</a>   <span class="keyword">const</span> <a class="code" href="structcanon__variable__ink.html">canon_variable_ink_t</a> *y;
<a name="l00184"></a><a class="code" href="structcanon__variable__inkset.html#o2">00184</a>   <span class="keyword">const</span> <a class="code" href="structcanon__variable__ink.html">canon_variable_ink_t</a> *<a class="code" href="structcanon__variable__inkset.html#o3">k</a>;
<a name="l00185"></a><a class="code" href="structcanon__variable__inkset.html#o3">00185</a> } <a class="code" href="structcanon__variable__inkset.html">canon_variable_inkset_t</a>;
00186 
00187 <span class="comment">/*</span>
00188 <span class="comment"> * currenty unaccounted for are the 7color printers and the 3color ones</span>
00189 <span class="comment"> * (which use CMY only printheads)</span>
00190 <span class="comment"> *</span>
00191 <span class="comment"> */</span>
00192 
00193 <span class="keyword">typedef</span> <span class="keyword">struct </span><a class="code" href="structcanon__variable__inklist.html">canon_variable_inklist</a>
<a name="l00194"></a><a class="code" href="structcanon__variable__inklist.html">00194</a> {
00195   <span class="keyword">const</span> <span class="keywordtype">int</span> bits;
<a name="l00196"></a><a class="code" href="structcanon__variable__inklist.html#o0">00196</a>   <span class="keyword">const</span> <span class="keywordtype">int</span> <a class="code" href="structcanon__variable__inklist.html#o1">colors</a>;
<a name="l00197"></a><a class="code" href="structcanon__variable__inklist.html#o1">00197</a>   <span class="keyword">const</span> <a class="code" href="structcanon__variable__inkset.html">canon_variable_inkset_t</a> *<a class="code" href="structcanon__variable__inklist.html#o2">r11</a>;    <span class="comment">/*  180x180  or   150x150  */</span>
<a name="l00198"></a><a class="code" href="structcanon__variable__inklist.html#o2">00198</a>   <span class="keyword">const</span> <a class="code" href="structcanon__variable__inkset.html">canon_variable_inkset_t</a> *<a class="code" href="structcanon__variable__inklist.html#o3">r22</a>;    <span class="comment">/*  360x360  or   300x300  */</span>
<a name="l00199"></a><a class="code" href="structcanon__variable__inklist.html#o3">00199</a>   <span class="keyword">const</span> <a class="code" href="structcanon__variable__inkset.html">canon_variable_inkset_t</a> *<a class="code" href="structcanon__variable__inklist.html#o4">r33</a>;    <span class="comment">/*  720x720  or   600x600  */</span>
<a name="l00200"></a><a class="code" href="structcanon__variable__inklist.html#o4">00200</a>   <span class="keyword">const</span> <a class="code" href="structcanon__variable__inkset.html">canon_variable_inkset_t</a> *<a class="code" href="structcanon__variable__inklist.html#o5">r43</a>;    <span class="comment">/* 1440x720  or  1200x600  */</span>
<a name="l00201"></a><a class="code" href="structcanon__variable__inklist.html#o5">00201</a>   <span class="keyword">const</span> <a class="code" href="structcanon__variable__inkset.html">canon_variable_inkset_t</a> *<a class="code" href="structcanon__variable__inklist.html#o6">r44</a>;    <span class="comment">/* 1440x1440 or  1200x1200 */</span>
<a name="l00202"></a><a class="code" href="structcanon__variable__inklist.html#o6">00202</a>   <span class="keyword">const</span> <a class="code" href="structcanon__variable__inkset.html">canon_variable_inkset_t</a> *<a class="code" href="structcanon__variable__inklist.html#o7">r55</a>;    <span class="comment">/* 2880x2880 or  2400x2400 */</span>
<a name="l00203"></a><a class="code" href="structcanon__variable__inklist.html#o7">00203</a> } <a class="code" href="structcanon__variable__inklist.html">canon_variable_inklist_t</a>;
00204 
00205 
00206 <span class="preprocessor">#ifdef EXPERIMENTAL_STUFF</span>
00207 <span class="preprocessor"></span><span class="comment">/*</span>
00208 <span class="comment"> * A printmode is defined by its resolution (xdpi x ydpi), the bits per pixel</span>
00209 <span class="comment"> * and the installed printhead.</span>
00210 <span class="comment"> *</span>
00211 <span class="comment"> * For a hereby defined printmode we specify the density and gamma multipliers</span>
00212 <span class="comment"> * and the ink definition with optional adjustments for lum, hue and sat</span>
00213 <span class="comment"> *</span>
00214 <span class="comment"> */</span>
00215 <span class="keyword">typedef</span> <span class="keyword">struct </span>canon_variable_printmode
00216 {
00217   <span class="keyword">const</span> <span class="keywordtype">int</span> xdpi;                      <span class="comment">/* horizontal resolution */</span>
00218   <span class="keyword">const</span> <span class="keywordtype">int</span> ydpi;                      <span class="comment">/* vertical resolution   */</span>
00219   <span class="keyword">const</span> <span class="keywordtype">int</span> bits;                      <span class="comment">/* bits per pixel        */</span>
00220   <span class="keyword">const</span> <span class="keywordtype">int</span> printhead;                 <span class="comment">/* installed printhead   */</span>
00221   <span class="keyword">const</span> <span class="keywordtype">int</span> quality;                   <span class="comment">/* maximum init-quality  */</span>
00222   <span class="keyword">const</span> <span class="keywordtype">double</span> density;                <span class="comment">/* density multiplier    */</span>
00223   <span class="keyword">const</span> <span class="keywordtype">double</span> gamma;                  <span class="comment">/* gamma multiplier      */</span>
00224   <span class="keyword">const</span> <a class="code" href="structcanon__variable__inkset.html">canon_variable_inkset_t</a> *inks; <span class="comment">/* ink definition        */</span>
00225   <span class="keyword">const</span> <span class="keywordtype">char</span> *lum_adjustment;          <span class="comment">/* optional lum adj.     */</span>
00226   <span class="keyword">const</span> <span class="keywordtype">char</span> *hue_adjustment;          <span class="comment">/* optional hue adj.     */</span>
00227   <span class="keyword">const</span> <span class="keywordtype">char</span> *sat_adjustment;          <span class="comment">/* optional sat adj.     */</span>
00228 } canon_variable_printmode_t;
00229 <span class="preprocessor">#endif</span>
00230 <span class="preprocessor"></span>
00231 <span class="comment">/* NOTE  NOTE  NOTE  NOTE  NOTE  NOTE  NOTE  NOTE  NOTE  NOTE  NOTE  NOTE</span>
00232 <span class="comment"> *</span>
00233 <span class="comment"> * The following dither ranges were taken from print-escp2.c and do NOT</span>
00234 <span class="comment"> * represent the requirements of canon inks. Feel free to play with them</span>
00235 <span class="comment"> * accoring to the escp2 part of doc/README.new-printer and send me a patch</span>
00236 <span class="comment"> * if you get better results. Please send mail to thaller@ph.tum.de</span>
00237 <span class="comment"> */</span>
00238 
00239 <span class="preprocessor">#define DECLARE_INK(name, density)              \</span>
<a name="l00240"></a><a class="code" href="print-canon_8c.html#a9">00240</a> <span class="preprocessor">static const canon_variable_ink_t name##_ink =  \</span>
00241 <span class="preprocessor">{                                               \</span>
00242 <span class="preprocessor">  density,                                      \</span>
00243 <span class="preprocessor">  name##_shades,                                \</span>
00244 <span class="preprocessor">  sizeof(name##_shades) / sizeof(stp_shade_t)   \</span>
00245 <span class="preprocessor">}</span>
00246 <span class="preprocessor"></span>
00247 <span class="preprocessor">#define SHADE(density, name)                            \</span>
<a name="l00248"></a><a class="code" href="print-canon_8c.html#a10">00248</a> <span class="preprocessor">{ density, sizeof(name)/sizeof(stp_dotsize_t), name }</span>
00249 <span class="preprocessor"></span>
00250 <span class="comment">/*</span>
00251 <span class="comment"> * Dither ranges specifically for Cyan/LightCyan (see NOTE above)</span>
00252 <span class="comment"> *</span>
00253 <span class="comment"> */</span>
00254 
00255 <span class="keyword">static</span> <span class="keyword">const</span> <a class="code" href="structstp__dotsize.html">stp_dotsize_t</a> <a class="code" href="print-canon_8c.html#a54">single_dotsize</a>[] =
<a name="l00256"></a><a class="code" href="print-canon_8c.html#a54">00256</a> {
00257   { 0x1, 1.0 }
00258 };
00259 
00260 <span class="keyword">static</span> <span class="keyword">const</span> <a class="code" href="structstp__shade.html">stp_shade_t</a> <a class="code" href="print-canon_8c.html#a55">canon_Cc_1bit_shades</a>[] =
<a name="l00261"></a><a class="code" href="print-canon_8c.html#a55">00261</a> {
00262   <a class="code" href="print-canon_8c.html#a10">SHADE</a>(1.0, <a class="code" href="print-canon_8c.html#a54">single_dotsize</a>),
00263   <a class="code" href="print-canon_8c.html#a10">SHADE</a>(0.25, <a class="code" href="print-canon_8c.html#a54">single_dotsize</a>),
00264 };
00265 
00266 <a class="code" href="print-canon_8c.html#a9">DECLARE_INK</a>(canon_Cc_1bit, 0.75);
00267 
00268 <span class="comment">/*</span>
00269 <span class="comment"> * Dither ranges specifically for Magenta/LightMagenta (see NOTE above)</span>
00270 <span class="comment"> *</span>
00271 <span class="comment"> */</span>
00272 
00273 <span class="keyword">static</span> <span class="keyword">const</span> <a class="code" href="structstp__shade.html">stp_shade_t</a> <a class="code" href="print-canon_8c.html#a56">canon_Mm_1bit_shades</a>[] =
<a name="l00274"></a><a class="code" href="print-canon_8c.html#a56">00274</a> {
00275   <a class="code" href="print-canon_8c.html#a10">SHADE</a>(1.0, <a class="code" href="print-canon_8c.html#a54">single_dotsize</a>),
00276   <a class="code" href="print-canon_8c.html#a10">SHADE</a>(0.26, <a class="code" href="print-canon_8c.html#a54">single_dotsize</a>),
00277 };
00278 
00279 <a class="code" href="print-canon_8c.html#a9">DECLARE_INK</a>(canon_Mm_1bit, 0.75);
00280 
00281 <span class="comment">/*</span>
00282 <span class="comment"> * Dither ranges specifically for any Color and 2bit/pixel (see NOTE above)</span>
00283 <span class="comment"> *</span>
00284 <span class="comment"> */</span>
00285 <span class="keyword">static</span> <span class="keyword">const</span> <a class="code" href="structstp__dotsize.html">stp_dotsize_t</a> <a class="code" href="print-canon_8c.html#a57">two_bit_dotsize</a>[] =
<a name="l00286"></a><a class="code" href="print-canon_8c.html#a57">00286</a> {
00287   { 0x1, 0.45 },
00288   { 0x2, 0.68 },
00289   { 0x3, 1.0 }
00290 };
00291 
00292 <span class="keyword">static</span> <span class="keyword">const</span> <a class="code" href="structstp__shade.html">stp_shade_t</a> <a class="code" href="print-canon_8c.html#a58">canon_X_2bit_shades</a>[] =
<a name="l00293"></a><a class="code" href="print-canon_8c.html#a58">00293</a> {
00294   <a class="code" href="print-canon_8c.html#a10">SHADE</a>(1.0, <a class="code" href="print-canon_8c.html#a57">two_bit_dotsize</a>)
00295 };
00296 
00297 <a class="code" href="print-canon_8c.html#a9">DECLARE_INK</a>(canon_X_2bit, 1.0);
00298 
00299 <span class="comment">/*</span>
00300 <span class="comment"> * Dither ranges specifically for any Color/LightColor and 2bit/pixel</span>
00301 <span class="comment"> * (see NOTE above)</span>
00302 <span class="comment"> */</span>
00303 <span class="keyword">static</span> <span class="keyword">const</span> <a class="code" href="structstp__shade.html">stp_shade_t</a> <a class="code" href="print-canon_8c.html#a59">canon_Xx_2bit_shades</a>[] =
<a name="l00304"></a><a class="code" href="print-canon_8c.html#a59">00304</a> {
00305   <a class="code" href="print-canon_8c.html#a10">SHADE</a>(1.0, <a class="code" href="print-canon_8c.html#a57">two_bit_dotsize</a>),
00306   <a class="code" href="print-canon_8c.html#a10">SHADE</a>(0.33, <a class="code" href="print-canon_8c.html#a57">two_bit_dotsize</a>),
00307 };
00308 
00309 <a class="code" href="print-canon_8c.html#a9">DECLARE_INK</a>(canon_Xx_2bit, 1.0);
00310 
00311 <span class="comment">/*</span>
00312 <span class="comment"> * Dither ranges specifically for any Color and 3bit/pixel</span>
00313 <span class="comment"> * (see NOTE above)</span>
00314 <span class="comment"> *</span>
00315 <span class="comment"> * BIG NOTE: The bjc8200 has this kind of ink. One Byte seems to hold</span>
00316 <span class="comment"> *           drop sizes for 3 pixels in a 3/2/2 bit fashion.</span>
00317 <span class="comment"> *           Size values for 3bit-sized pixels range from 1 to 7,</span>
00318 <span class="comment"> *           size values for 2bit-sized picels from 1 to 3 (kill msb).</span>
00319 <span class="comment"> *</span>
00320 <span class="comment"> *</span>
00321 <span class="comment"> */</span>
00322 <span class="keyword">static</span> <span class="keyword">const</span> <a class="code" href="structstp__dotsize.html">stp_dotsize_t</a> <a class="code" href="print-canon_8c.html#a60">three_bit_dotsize</a>[] =
<a name="l00323"></a><a class="code" href="print-canon_8c.html#a60">00323</a> {
00324   { 0x1, 0.45 },
00325   { 0x2, 0.55 },
00326   { 0x3, 0.66 },
00327   { 0x4, 0.77 },
00328   { 0x5, 0.88 },
00329   { 0x6, 1.0 }
00330 };
00331 
00332 <span class="keyword">static</span> <span class="keyword">const</span> <a class="code" href="structstp__shade.html">stp_shade_t</a> <a class="code" href="print-canon_8c.html#a61">canon_X_3bit_shades</a>[] =
<a name="l00333"></a><a class="code" href="print-canon_8c.html#a61">00333</a> {
00334   <a class="code" href="print-canon_8c.html#a10">SHADE</a>(1.0, <a class="code" href="print-canon_8c.html#a60">three_bit_dotsize</a>)
00335 };
00336 
00337 <a class="code" href="print-canon_8c.html#a9">DECLARE_INK</a>(canon_X_3bit, 1.0);
00338 
00339 <span class="comment">/*</span>
00340 <span class="comment"> * Dither ranges specifically for any Color/LightColor and 3bit/pixel</span>
00341 <span class="comment"> * (see NOTE above)</span>
00342 <span class="comment"> */</span>
00343 <span class="keyword">static</span> <span class="keyword">const</span> <a class="code" href="structstp__shade.html">stp_shade_t</a> <a class="code" href="print-canon_8c.html#a62">canon_Xx_3bit_shades</a>[] =
<a name="l00344"></a><a class="code" href="print-canon_8c.html#a62">00344</a> {
00345   <a class="code" href="print-canon_8c.html#a10">SHADE</a>(1.0, <a class="code" href="print-canon_8c.html#a60">three_bit_dotsize</a>),
00346   <a class="code" href="print-canon_8c.html#a10">SHADE</a>(0.33, <a class="code" href="print-canon_8c.html#a60">three_bit_dotsize</a>),
00347 };
00348 
00349 <a class="code" href="print-canon_8c.html#a9">DECLARE_INK</a>(canon_Xx_3bit, 1.0);
00350 
00351 
00352 <span class="comment">/* Inkset for printing in CMY and 1bit/pixel */</span>
00353 <span class="keyword">static</span> <span class="keyword">const</span> <a class="code" href="structcanon__variable__inkset.html">canon_variable_inkset_t</a> <a class="code" href="print-canon_8c.html#a63">ci_CMY_1</a> =
<a name="l00354"></a><a class="code" href="print-canon_8c.html#a63">00354</a> {
00355   NULL,
00356   NULL,
00357   NULL,
00358   NULL
00359 };
00360 
00361 <span class="comment">/* Inkset for printing in CMY and 2bit/pixel */</span>
00362 <span class="keyword">static</span> <span class="keyword">const</span> <a class="code" href="structcanon__variable__inkset.html">canon_variable_inkset_t</a> <a class="code" href="print-canon_8c.html#a64">ci_CMY_2</a> =
<a name="l00363"></a><a class="code" href="print-canon_8c.html#a64">00363</a> {
00364   &amp;canon_X_2bit_ink,
00365   &amp;canon_X_2bit_ink,
00366   &amp;canon_X_2bit_ink,
00367   NULL
00368 };
00369 
00370 <span class="comment">/* Inkset for printing in CMYK and 1bit/pixel */</span>
00371 <span class="keyword">static</span> <span class="keyword">const</span> <a class="code" href="structcanon__variable__inkset.html">canon_variable_inkset_t</a> <a class="code" href="print-canon_8c.html#a65">ci_CMYK_1</a> =
<a name="l00372"></a><a class="code" href="print-canon_8c.html#a65">00372</a> {
00373   NULL,
00374   NULL,
00375   NULL,
00376   NULL
00377 };
00378 
00379 <span class="comment">/* Inkset for printing in CcMmYK and 1bit/pixel */</span>
00380 <span class="keyword">static</span> <span class="keyword">const</span> <a class="code" href="structcanon__variable__inkset.html">canon_variable_inkset_t</a> <a class="code" href="print-canon_8c.html#a66">ci_CcMmYK_1</a> =
<a name="l00381"></a><a class="code" href="print-canon_8c.html#a66">00381</a> {
00382   &amp;canon_Cc_1bit_ink,
00383   &amp;canon_Mm_1bit_ink,
00384   NULL,
00385   NULL
00386 };
00387 
00388 <span class="comment">/* Inkset for printing in CMYK and 2bit/pixel */</span>
00389 <span class="keyword">static</span> <span class="keyword">const</span> <a class="code" href="structcanon__variable__inkset.html">canon_variable_inkset_t</a> <a class="code" href="print-canon_8c.html#a67">ci_CMYK_2</a> =
<a name="l00390"></a><a class="code" href="print-canon_8c.html#a67">00390</a> {
00391   &amp;canon_X_2bit_ink,
00392   &amp;canon_X_2bit_ink,
00393   &amp;canon_X_2bit_ink,
00394   &amp;canon_X_2bit_ink
00395 };
00396 
00397 <span class="comment">/* Inkset for printing in CcMmYK and 2bit/pixel */</span>
00398 <span class="keyword">static</span> <span class="keyword">const</span> <a class="code" href="structcanon__variable__inkset.html">canon_variable_inkset_t</a> <a class="code" href="print-canon_8c.html#a68">ci_CcMmYK_2</a> =
<a name="l00399"></a><a class="code" href="print-canon_8c.html#a68">00399</a> {
00400   &amp;canon_Xx_2bit_ink,
00401   &amp;canon_Xx_2bit_ink,
00402   &amp;canon_X_2bit_ink,
00403   &amp;canon_X_2bit_ink
00404 };
00405 
00406 <span class="comment">/* Inkset for printing in CMYK and 3bit/pixel */</span>
00407 <span class="keyword">static</span> <span class="keyword">const</span> <a class="code" href="structcanon__variable__inkset.html">canon_variable_inkset_t</a> <a class="code" href="print-canon_8c.html#a69">ci_CMYK_3</a> =
<a name="l00408"></a><a class="code" href="print-canon_8c.html#a69">00408</a> {
00409   &amp;canon_X_3bit_ink,
00410   &amp;canon_X_3bit_ink,
00411   &amp;canon_X_3bit_ink,
00412   &amp;canon_X_3bit_ink
00413 };
00414 
00415 <span class="comment">/* Inkset for printing in CcMmYK and 3bit/pixel */</span>
00416 <span class="keyword">static</span> <span class="keyword">const</span> <a class="code" href="structcanon__variable__inkset.html">canon_variable_inkset_t</a> <a class="code" href="print-canon_8c.html#a70">ci_CcMmYK_3</a> =
<a name="l00417"></a><a class="code" href="print-canon_8c.html#a70">00417</a> {
00418   &amp;canon_Xx_3bit_ink,
00419   &amp;canon_Xx_3bit_ink,
00420   &amp;canon_X_3bit_ink,
00421   &amp;canon_X_3bit_ink,
00422 };
00423 
00424 
00425 <span class="keyword">typedef</span> <a class="code" href="structcanon__variable__inklist.html">canon_variable_inklist_t</a>* <a class="code" href="structcanon__variable__inklist.html">canon_variable_inklist_p</a>;
<a name="l00426"></a><a class="code" href="print-canon_8c.html#a71">00426</a> 
00427 <span class="comment">/* Ink set should be applicable for any CMYK based model */</span>
00428 <span class="keyword">static</span> <span class="keyword">const</span> <a class="code" href="structcanon__variable__inklist.html">canon_variable_inklist_t</a> <a class="code" href="print-canon_8c.html#a72">canon_ink_standard</a>[] =
<a name="l00429"></a><a class="code" href="print-canon_8c.html#a72">00429</a> {
00430   {
00431     1,4,
00432     &amp;<a class="code" href="print-canon_8c.html#a65">ci_CMYK_1</a>, &amp;<a class="code" href="print-canon_8c.html#a65">ci_CMYK_1</a>, &amp;<a class="code" href="print-canon_8c.html#a65">ci_CMYK_1</a>,
00433     &amp;<a class="code" href="print-canon_8c.html#a65">ci_CMYK_1</a>, &amp;<a class="code" href="print-canon_8c.html#a65">ci_CMYK_1</a>, &amp;<a class="code" href="print-canon_8c.html#a65">ci_CMYK_1</a>,
00434   },
00435 };
00436 
00437 <span class="comment">/* Ink set for printers using CMY and CMY photo printing, 1 or 2bit/pixel */</span>
00438 <span class="keyword">static</span> <span class="keyword">const</span> <a class="code" href="structcanon__variable__inklist.html">canon_variable_inklist_t</a> <a class="code" href="print-canon_8c.html#a73">canon_ink_oldphoto</a>[] =
<a name="l00439"></a><a class="code" href="print-canon_8c.html#a73">00439</a> {
00440   {
00441     1,3,
00442     &amp;<a class="code" href="print-canon_8c.html#a63">ci_CMY_1</a>, &amp;<a class="code" href="print-canon_8c.html#a63">ci_CMY_1</a>, &amp;<a class="code" href="print-canon_8c.html#a63">ci_CMY_1</a>,
00443     &amp;<a class="code" href="print-canon_8c.html#a63">ci_CMY_1</a>, &amp;<a class="code" href="print-canon_8c.html#a63">ci_CMY_1</a>, &amp;<a class="code" href="print-canon_8c.html#a63">ci_CMY_1</a>,
00444   },
00445   {
00446     2,3,
00447     &amp;<a class="code" href="print-canon_8c.html#a64">ci_CMY_2</a>, &amp;<a class="code" href="print-canon_8c.html#a64">ci_CMY_2</a>,
00448     &amp;<a class="code" href="print-canon_8c.html#a64">ci_CMY_2</a>, &amp;<a class="code" href="print-canon_8c.html#a64">ci_CMY_2</a>,
00449     &amp;<a class="code" href="print-canon_8c.html#a64">ci_CMY_2</a>, &amp;<a class="code" href="print-canon_8c.html#a64">ci_CMY_2</a>,
00450   },
00451 };
00452 
00453 <span class="comment">/* Ink set for printers using CMYK and CcMmYK printing, 1 or 2bit/pixel */</span>
00454 <span class="keyword">static</span> <span class="keyword">const</span> <a class="code" href="structcanon__variable__inklist.html">canon_variable_inklist_t</a> <a class="code" href="print-canon_8c.html#a74">canon_ink_standardphoto</a>[] =
<a name="l00455"></a><a class="code" href="print-canon_8c.html#a74">00455</a> {
00456   {
00457     1,4,
00458     &amp;<a class="code" href="print-canon_8c.html#a65">ci_CMYK_1</a>, &amp;<a class="code" href="print-canon_8c.html#a65">ci_CMYK_1</a>, &amp;<a class="code" href="print-canon_8c.html#a65">ci_CMYK_1</a>,
00459     &amp;<a class="code" href="print-canon_8c.html#a65">ci_CMYK_1</a>, &amp;<a class="code" href="print-canon_8c.html#a65">ci_CMYK_1</a>, &amp;<a class="code" href="print-canon_8c.html#a65">ci_CMYK_1</a>,
00460   },
00461   {
00462     2,4,
00463     &amp;<a class="code" href="print-canon_8c.html#a67">ci_CMYK_2</a>, &amp;<a class="code" href="print-canon_8c.html#a67">ci_CMYK_2</a>,
00464     &amp;<a class="code" href="print-canon_8c.html#a67">ci_CMYK_2</a>, &amp;<a class="code" href="print-canon_8c.html#a67">ci_CMYK_2</a>,
00465     &amp;<a class="code" href="print-canon_8c.html#a67">ci_CMYK_2</a>, &amp;<a class="code" href="print-canon_8c.html#a67">ci_CMYK_2</a>,
00466   },
00467   {
00468     1,6,
00469     &amp;<a class="code" href="print-canon_8c.html#a66">ci_CcMmYK_1</a>, &amp;<a class="code" href="print-canon_8c.html#a66">ci_CcMmYK_1</a>, &amp;<a class="code" href="print-canon_8c.html#a66">ci_CcMmYK_1</a>,
00470     &amp;<a class="code" href="print-canon_8c.html#a66">ci_CcMmYK_1</a>, &amp;<a class="code" href="print-canon_8c.html#a66">ci_CcMmYK_1</a>, &amp;<a class="code" href="print-canon_8c.html#a66">ci_CcMmYK_1</a>,
00471   },
00472   {
00473     2,6,
00474     &amp;<a class="code" href="print-canon_8c.html#a68">ci_CcMmYK_2</a>, &amp;<a class="code" href="print-canon_8c.html#a68">ci_CcMmYK_2</a>, &amp;<a class="code" href="print-canon_8c.html#a68">ci_CcMmYK_2</a>,
00475     &amp;<a class="code" href="print-canon_8c.html#a68">ci_CcMmYK_2</a>, &amp;<a class="code" href="print-canon_8c.html#a68">ci_CcMmYK_2</a>, &amp;<a class="code" href="print-canon_8c.html#a68">ci_CcMmYK_2</a>,
00476   },
00477 };
00478 
00479 <span class="comment">/* Ink set for printers using CMYK and CcMmYK printing, 1 or 3bit/pixel */</span>
00480 <span class="keyword">static</span> <span class="keyword">const</span> <a class="code" href="structcanon__variable__inklist.html">canon_variable_inklist_t</a> <a class="code" href="print-canon_8c.html#a75">canon_ink_superphoto</a>[] =
<a name="l00481"></a><a class="code" href="print-canon_8c.html#a75">00481</a> {
00482   {
00483     1,4,
00484     &amp;<a class="code" href="print-canon_8c.html#a65">ci_CMYK_1</a>, &amp;<a class="code" href="print-canon_8c.html#a65">ci_CMYK_1</a>, &amp;<a class="code" href="print-canon_8c.html#a65">ci_CMYK_1</a>,
00485     &amp;<a class="code" href="print-canon_8c.html#a65">ci_CMYK_1</a>, &amp;<a class="code" href="print-canon_8c.html#a65">ci_CMYK_1</a>, &amp;<a class="code" href="print-canon_8c.html#a65">ci_CMYK_1</a>,
00486   },
00487   {
00488     3,4,
00489     &amp;<a class="code" href="print-canon_8c.html#a69">ci_CMYK_3</a>, &amp;<a class="code" href="print-canon_8c.html#a69">ci_CMYK_3</a>, &amp;<a class="code" href="print-canon_8c.html#a69">ci_CMYK_3</a>,
00490     &amp;<a class="code" href="print-canon_8c.html#a69">ci_CMYK_3</a>, &amp;<a class="code" href="print-canon_8c.html#a69">ci_CMYK_3</a>, &amp;<a class="code" href="print-canon_8c.html#a69">ci_CMYK_3</a>,
00491   },
00492   {
00493     3,6,
00494     &amp;<a class="code" href="print-canon_8c.html#a70">ci_CcMmYK_3</a>, &amp;<a class="code" href="print-canon_8c.html#a70">ci_CcMmYK_3</a>, &amp;<a class="code" href="print-canon_8c.html#a70">ci_CcMmYK_3</a>,
00495     &amp;<a class="code" href="print-canon_8c.html#a70">ci_CcMmYK_3</a>, &amp;<a class="code" href="print-canon_8c.html#a70">ci_CcMmYK_3</a>, &amp;<a class="code" href="print-canon_8c.html#a70">ci_CcMmYK_3</a>,
00496   },
00497 };
00498 
00499 
00500 <span class="keyword">static</span> <span class="keyword">const</span> <span class="keywordtype">char</span> <a class="code" href="print-canon_8c.html#a76">standard_sat_adjustment</a>[] =
<a name="l00501"></a><a class="code" href="print-canon_8c.html#a76">00501</a> <span class="stringliteral">"&lt;?xml version=\"1.0\" encoding=\"UTF-8\"?&gt;\n"</span>
00502 <span class="stringliteral">"&lt;gimp-print&gt;\n"</span>
00503 <span class="stringliteral">"&lt;curve wrap=\"wrap\" type=\"linear\" gamma=\"0\"&gt;\n"</span>
00504 <span class="stringliteral">"&lt;sequence count=\"48\" lower-bound=\"0\" upper-bound=\"4\"&gt;\n"</span>
00505 <span class="comment">/* C */</span>  <span class="stringliteral">"1.00 1.00 1.00 1.00 1.00 1.00 1.00 1.00 "</span>  <span class="comment">/* B */</span>
00506 <span class="comment">/* B */</span>  <span class="stringliteral">"1.00 1.00 1.00 1.00 1.00 1.00 1.00 1.00 "</span>  <span class="comment">/* M */</span>
00507 <span class="comment">/* M */</span>  <span class="stringliteral">"1.00 0.95 0.90 0.90 0.90 0.90 0.90 0.90 "</span>  <span class="comment">/* R */</span>
00508 <span class="comment">/* R */</span>  <span class="stringliteral">"0.90 0.95 0.95 1.00 1.00 1.00 1.00 1.00 "</span>  <span class="comment">/* Y */</span>
00509 <span class="comment">/* Y */</span>  <span class="stringliteral">"1.00 1.00 1.00 1.00 1.00 1.00 1.00 1.00 "</span>  <span class="comment">/* G */</span>
00510 <span class="comment">/* G */</span>  <span class="stringliteral">"1.00 1.00 1.00 1.00 1.00 1.00 1.00 1.00 "</span>  <span class="comment">/* C */</span>
00511 <span class="stringliteral">"&lt;/sequence&gt;\n"</span>
00512 <span class="stringliteral">"&lt;/curve&gt;\n"</span>
00513 <span class="stringliteral">"&lt;/gimp-print&gt;\n"</span>;
00514 
00515 <span class="keyword">static</span> <span class="keyword">const</span> <span class="keywordtype">char</span> <a class="code" href="print-canon_8c.html#a77">standard_lum_adjustment</a>[] =
<a name="l00516"></a><a class="code" href="print-canon_8c.html#a77">00516</a> <span class="stringliteral">"&lt;?xml version=\"1.0\" encoding=\"UTF-8\"?&gt;\n"</span>
00517 <span class="stringliteral">"&lt;gimp-print&gt;\n"</span>
00518 <span class="stringliteral">"&lt;curve wrap=\"wrap\" type=\"linear\" gamma=\"0\"&gt;\n"</span>
00519 <span class="stringliteral">"&lt;sequence count=\"48\" lower-bound=\"0\" upper-bound=\"4\"&gt;\n"</span>
00520 <span class="comment">/* C */</span>  <span class="stringliteral">"0.50 0.52 0.56 0.60 0.66 0.71 0.74 0.77 "</span>  <span class="comment">/* B */</span>
00521 <span class="comment">/* B */</span>  <span class="stringliteral">"0.81 0.79 0.74 0.68 0.70 0.74 0.77 0.82 "</span>  <span class="comment">/* M */</span>
00522 <span class="comment">/* M */</span>  <span class="stringliteral">"0.88 0.93 0.95 0.97 0.97 0.96 0.95 0.95 "</span>  <span class="comment">/* R */</span>
00523 <span class="comment">/* R */</span>  <span class="stringliteral">"0.95 0.96 0.97 0.98 0.99 1.00 1.00 1.00 "</span>  <span class="comment">/* Y */</span>
00524 <span class="comment">/* Y */</span>  <span class="stringliteral">"1.00 0.97 0.94 0.92 0.90 0.88 0.85 0.79 "</span>  <span class="comment">/* G */</span>
00525 <span class="comment">/* G */</span>  <span class="stringliteral">"0.69 0.64 0.58 0.54 0.54 0.54 0.53 0.51 "</span>  <span class="comment">/* C */</span>
00526 <span class="stringliteral">"&lt;/sequence&gt;\n"</span>
00527 <span class="stringliteral">"&lt;/curve&gt;\n"</span>
00528 <span class="stringliteral">"&lt;/gimp-print&gt;\n"</span>;
00529 
00530 <span class="keyword">static</span> <span class="keyword">const</span> <span class="keywordtype">char</span> <a class="code" href="print-canon_8c.html#a78">standard_hue_adjustment</a>[] =
<a name="l00531"></a><a class="code" href="print-canon_8c.html#a78">00531</a> <span class="stringliteral">"&lt;?xml version=\"1.0\" encoding=\"UTF-8\"?&gt;\n"</span>
00532 <span class="stringliteral">"&lt;gimp-print&gt;\n"</span>
00533 <span class="stringliteral">"&lt;curve wrap=\"wrap\" type=\"linear\" gamma=\"0\"&gt;\n"</span>
00534 <span class="stringliteral">"&lt;sequence count=\"48\" lower-bound=\"-6\" upper-bound=\"6\"&gt;\n"</span>
00535 <span class="comment">/* C */</span>  <span class="stringliteral">"0.00 0.06 0.10 0.10 0.06 -.01 -.09 -.17 "</span>  <span class="comment">/* B */</span>
00536 <span class="comment">/* B */</span>  <span class="stringliteral">"-.25 -.33 -.38 -.38 -.36 -.34 -.34 -.34 "</span>  <span class="comment">/* M */</span>
00537 <span class="comment">/* M */</span>  <span class="stringliteral">"-.34 -.34 -.36 -.40 -.50 -.40 -.30 -.20 "</span>  <span class="comment">/* R */</span>
00538 <span class="comment">/* R */</span>  <span class="stringliteral">"-.12 -.07 -.04 -.02 0.00 0.00 0.00 0.00 "</span>  <span class="comment">/* Y */</span>
00539 <span class="comment">/* Y */</span>  <span class="stringliteral">"0.00 0.00 0.00 -.05 -.10 -.15 -.22 -.24 "</span>  <span class="comment">/* G */</span>
00540 <span class="comment">/* G */</span>  <span class="stringliteral">"-.26 -.30 -.33 -.28 -.25 -.20 -.13 -.06 "</span>  <span class="comment">/* C */</span>
00541 <span class="stringliteral">"&lt;/sequence&gt;\n"</span>
00542 <span class="stringliteral">"&lt;/curve&gt;\n"</span>
00543 <span class="stringliteral">"&lt;/gimp-print&gt;\n"</span>;
00544 
00545 <span class="keyword">typedef</span> <span class="keyword">enum</span> {
<a name="l00546"></a><a class="code" href="print-canon_8c.html#a156">00546</a>   <a class="code" href="print-canon_8c.html#a156a94">COLOR_MONOCHROME</a> = 1,
00547   <a class="code" href="print-canon_8c.html#a156a95">COLOR_CMY</a> = 3,
00548   <a class="code" href="print-canon_8c.html#a156a96">COLOR_CMYK</a> = 4,
00549   <a class="code" href="print-canon_8c.html#a156a97">COLOR_CCMMYK</a>= 6,
00550   <a class="code" href="print-canon_8c.html#a156a98">COLOR_CCMMYYK</a>= 7
00551 } <a class="code" href="print-canon_8c.html#a156">colormode_t</a>;
00552 
00553 <span class="keyword">typedef</span> <span class="keyword">struct </span><a class="code" href="structcanon__caps.html">canon_caps</a> {
<a name="l00554"></a><a class="code" href="structcanon__caps.html">00554</a>   <span class="keywordtype">int</span> <a class="code" href="structcanon__caps.html#o0">model</a>;          <span class="comment">/* model number as used in printers.xml */</span>
<a name="l00555"></a><a class="code" href="structcanon__caps.html#o0">00555</a>   <span class="keywordtype">int</span> <a class="code" href="structcanon__caps.html#o1">model_id</a>;       <span class="comment">/* model ID code for use in commands */</span>
<a name="l00556"></a><a class="code" href="structcanon__caps.html#o1">00556</a>   <span class="keywordtype">int</span> <a class="code" href="structcanon__caps.html#o2">max_width</a>;      <span class="comment">/* maximum printable paper size */</span>
<a name="l00557"></a><a class="code" href="structcanon__caps.html#o2">00557</a>   <span class="keywordtype">int</span> <a class="code" href="structcanon__caps.html#o3">max_height</a>;
<a name="l00558"></a><a class="code" href="structcanon__caps.html#o3">00558</a>   <span class="keywordtype">int</span> <a class="code" href="structcanon__caps.html#o4">base_res</a>;       <span class="comment">/* base resolution - shall be 150 or 180 */</span>
<a name="l00559"></a><a class="code" href="structcanon__caps.html#o4">00559</a>   <span class="keywordtype">int</span> <a class="code" href="structcanon__caps.html#o5">max_xdpi</a>;       <span class="comment">/* maximum horizontal resolution */</span>
<a name="l00560"></a><a class="code" href="structcanon__caps.html#o5">00560</a>   <span class="keywordtype">int</span> <a class="code" href="structcanon__caps.html#o6">max_ydpi</a>;       <span class="comment">/* maximum vertical resolution */</span>
<a name="l00561"></a><a class="code" href="structcanon__caps.html#o6">00561</a>   <span class="keywordtype">int</span> <a class="code" href="structcanon__caps.html#o7">max_quality</a>;
<a name="l00562"></a><a class="code" href="structcanon__caps.html#o7">00562</a>   <span class="keywordtype">int</span> <a class="code" href="structcanon__caps.html#o8">border_left</a>;    <span class="comment">/* left margin, points */</span>
<a name="l00563"></a><a class="code" href="structcanon__caps.html#o8">00563</a>   <span class="keywordtype">int</span> <a class="code" href="structcanon__caps.html#o9">border_right</a>;   <span class="comment">/* right margin, points */</span>
<a name="l00564"></a><a class="code" href="structcanon__caps.html#o9">00564</a>   <span class="keywordtype">int</span> <a class="code" href="structcanon__caps.html#o10">border_top</a>;     <span class="comment">/* absolute top margin, points */</span>
<a name="l00565"></a><a class="code" href="structcanon__caps.html#o10">00565</a>   <span class="keywordtype">int</span> <a class="code" href="structcanon__caps.html#o11">border_bottom</a>;  <span class="comment">/* absolute bottom margin, points */</span>
<a name="l00566"></a><a class="code" href="structcanon__caps.html#o11">00566</a>   <span class="keywordtype">int</span> <a class="code" href="structcanon__caps.html#o12">inks</a>;           <span class="comment">/* installable cartridges (CANON_INK_*) */</span>
<a name="l00567"></a><a class="code" href="structcanon__caps.html#o12">00567</a>   <span class="keywordtype">int</span> <a class="code" href="structcanon__caps.html#o13">slots</a>;          <span class="comment">/* available paperslots */</span>
<a name="l00568"></a><a class="code" href="structcanon__caps.html#o13">00568</a>   <span class="keywordtype">unsigned</span> <span class="keywordtype">long</span> <a class="code" href="structcanon__caps.html#o14">features</a>;       <span class="comment">/* special bjl settings */</span>
<a name="l00569"></a><a class="code" href="structcanon__caps.html#o14">00569</a> <span class="preprocessor">#ifdef EXPERIMENTAL_STUFF</span>
00570 <span class="preprocessor"></span>  <span class="keyword">const</span> canon_variable_printmode_t *printmodes;
00571   <span class="keywordtype">int</span> printmodes_cnt;
00572 <span class="preprocessor">#else</span>
00573 <span class="preprocessor"></span>  <span class="keywordtype">int</span> <a class="code" href="structcanon__caps.html#o15">dummy</a>;
<a name="l00574"></a><a class="code" href="structcanon__caps.html#o15">00574</a>   <span class="keyword">const</span> <a class="code" href="structcanon__dot__sizes.html">canon_dot_size_t</a> dot_sizes;   <span class="comment">/* Vector of dot sizes for resolutions */</span>
<a name="l00575"></a><a class="code" href="structcanon__caps.html#o16">00575</a>   <span class="keyword">const</span> <a class="code" href="structcanon__densities.html">canon_densities_t</a> <a class="code" href="structcanon__caps.html#o17">densities</a>;   <span class="comment">/* List of densities for each printer */</span>
<a name="l00576"></a><a class="code" href="structcanon__caps.html#o17">00576</a>   <span class="keyword">const</span> <a class="code" href="structcanon__variable__inklist.html">canon_variable_inklist_t</a> *<a class="code" href="structcanon__caps.html#o18">inxs</a>; <span class="comment">/* Choices of inks for this printer */</span>
<a name="l00577"></a><a class="code" href="structcanon__caps.html#o18">00577</a>   <span class="keywordtype">int</span> <a class="code" href="structcanon__caps.html#o19">inxs_cnt</a>;                         <span class="comment">/* number of ink definitions in inxs */</span>
<a name="l00578"></a><a class="code" href="structcanon__caps.html#o19">00578</a> <span class="preprocessor">#endif</span>
00579 <span class="preprocessor"></span>  <span class="keyword">const</span> <span class="keywordtype">char</span> *<a class="code" href="structcanon__caps.html#o20">lum_adjustment</a>;
<a name="l00580"></a><a class="code" href="structcanon__caps.html#o20">00580</a>   <span class="keyword">const</span> <span class="keywordtype">char</span> *<a class="code" href="structcanon__caps.html#o21">hue_adjustment</a>;
<a name="l00581"></a><a class="code" href="structcanon__caps.html#o21">00581</a>   <span class="keyword">const</span> <span class="keywordtype">char</span> *<a class="code" href="structcanon__caps.html#o22">sat_adjustment</a>;
<a name="l00582"></a><a class="code" href="structcanon__caps.html#o22">00582</a> } <a class="code" href="structcanon__caps.html">canon_cap_t</a>;
00583 
00584 <span class="keyword">typedef</span> <span class="keyword">struct</span>
<a name="l00585"></a><a class="code" href="structcanon__privdata__t.html">00585</a> <span class="keyword"></span>{
00586   <span class="keyword">const</span> <a class="code" href="structcanon__caps.html">canon_cap_t</a> *caps;
<a name="l00587"></a><a class="code" href="structcanon__privdata__t.html#o0">00587</a>   <span class="keywordtype">unsigned</span> <span class="keywordtype">char</span> *cols[7];
<a name="l00588"></a><a class="code" href="structcanon__privdata__t.html#o1">00588</a>   <span class="keywordtype">int</span> delay[7];
<a name="l00589"></a><a class="code" href="structcanon__privdata__t.html#o2">00589</a>   <span class="keywordtype">int</span> delay_max;
<a name="l00590"></a><a class="code" href="structcanon__privdata__t.html#o3">00590</a>   <span class="keywordtype">int</span> buf_length;
<a name="l00591"></a><a class="code" href="structcanon__privdata__t.html#o4">00591</a>   <span class="keywordtype">int</span> out_width;
<a name="l00592"></a><a class="code" href="structcanon__privdata__t.html#o5">00592</a>   <span class="keywordtype">int</span> left;
<a name="l00593"></a><a class="code" href="structcanon__privdata__t.html#o6">00593</a>   <span class="keywordtype">int</span> emptylines;
<a name="l00594"></a><a class="code" href="structcanon__privdata__t.html#o7">00594</a>   <span class="keywordtype">int</span> bits;
<a name="l00595"></a><a class="code" href="structcanon__privdata__t.html#o8">00595</a>   <span class="keywordtype">int</span> ydpi;
<a name="l00596"></a><a class="code" href="structcanon__privdata__t.html#o9">00596</a> } <a class="code" href="structcanon__privdata__t.html">canon_privdata_t</a>;
00597 
00598 <span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="print-canon_8c.html#a105">canon_write_line</a>(<a class="code" href="structstp__vars.html">stp_vars_t</a> *v);
00599 
00600 
00601 <span class="comment">/* Codes for possible ink-tank combinations.</span>
00602 <span class="comment"> * Each combo is represented by the colors that can be used with</span>
00603 <span class="comment"> * the installed ink-tank(s)</span>
00604 <span class="comment"> * Combinations of the codes represent the combinations allowed for a model</span>
00605 <span class="comment"> * Note that only preferrable combinations should be used</span>
00606 <span class="comment"> */</span>
00607 <span class="preprocessor">#define CANON_INK_K           1</span>
<a name="l00608"></a><a class="code" href="print-canon_8c.html#a11">00608</a> <span class="preprocessor"></span><span class="preprocessor">#define CANON_INK_CMY         2</span>
<a name="l00609"></a><a class="code" href="print-canon_8c.html#a12">00609</a> <span class="preprocessor"></span><span class="preprocessor">#define CANON_INK_CMYK        4</span>
<a name="l00610"></a><a class="code" href="print-canon_8c.html#a13">00610</a> <span class="preprocessor"></span><span class="preprocessor">#define CANON_INK_CcMmYK      8</span>
<a name="l00611"></a><a class="code" href="print-canon_8c.html#a14">00611</a> <span class="preprocessor"></span><span class="preprocessor">#define CANON_INK_CcMmYyK    16</span>
<a name="l00612"></a><a class="code" href="print-canon_8c.html#a15">00612</a> <span class="preprocessor"></span>
00613 <span class="preprocessor">#define CANON_INK_BLACK_MASK (CANON_INK_K|CANON_INK_CMYK|CANON_INK_CcMmYK)</span>
<a name="l00614"></a><a class="code" href="print-canon_8c.html#a16">00614</a> <span class="preprocessor"></span>
00615 <span class="preprocessor">#define CANON_INK_PHOTO_MASK (CANON_INK_CcMmYK|CANON_INK_CcMmYyK)</span>
<a name="l00616"></a><a class="code" href="print-canon_8c.html#a17">00616</a> <span class="preprocessor"></span>
00617 <span class="comment">/* document feeding */</span>
00618 <span class="preprocessor">#define CANON_SLOT_ASF1    1</span>
<a name="l00619"></a><a class="code" href="print-canon_8c.html#a18">00619</a> <span class="preprocessor"></span><span class="preprocessor">#define CANON_SLOT_ASF2    2</span>
<a name="l00620"></a><a class="code" href="print-canon_8c.html#a19">00620</a> <span class="preprocessor"></span><span class="preprocessor">#define CANON_SLOT_MAN1    4</span>
<a name="l00621"></a><a class="code" href="print-canon_8c.html#a20">00621</a> <span class="preprocessor"></span><span class="preprocessor">#define CANON_SLOT_MAN2    8</span>
<a name="l00622"></a><a class="code" href="print-canon_8c.html#a21">00622</a> <span class="preprocessor"></span>
00623 <span class="comment">/* model peculiarities */</span>
00624 <span class="preprocessor">#define CANON_CAP_DMT       0x01ul    </span><span class="comment">/* Drop Modulation Technology */</span>
<a name="l00625"></a><a class="code" href="print-canon_8c.html#a22">00625</a> <span class="preprocessor">#define CANON_CAP_MSB_FIRST 0x02ul    </span><span class="comment">/* how to send data           */</span>
00626 <span class="preprocessor">#define CANON_CAP_a         0x04ul</span>
<a name="l00627"></a><a class="code" href="print-canon_8c.html#a23">00627</a> <span class="preprocessor"></span><span class="preprocessor">#define CANON_CAP_b         0x08ul</span>
00628 <span class="preprocessor"></span><span class="preprocessor">#define CANON_CAP_q         0x10ul</span>
<a name="l00629"></a><a class="code" href="print-canon_8c.html#a24">00629</a> <span class="preprocessor"></span><span class="preprocessor">#define CANON_CAP_m         0x20ul</span>
<a name="l00630"></a><a class="code" href="print-canon_8c.html#a25">00630</a> <span class="preprocessor"></span><span class="preprocessor">#define CANON_CAP_d         0x40ul</span>
<a name="l00631"></a><a class="code" href="print-canon_8c.html#a26">00631</a> <span class="preprocessor"></span><span class="preprocessor">#define CANON_CAP_t         0x80ul</span>
<a name="l00632"></a><a class="code" href="print-canon_8c.html#a27">00632</a> <span class="preprocessor"></span><span class="preprocessor">#define CANON_CAP_c         0x100ul</span>
<a name="l00633"></a><a class="code" href="print-canon_8c.html#a28">00633</a> <span class="preprocessor"></span><span class="preprocessor">#define CANON_CAP_p         0x200ul</span>
<a name="l00634"></a><a class="code" href="print-canon_8c.html#a29">00634</a> <span class="preprocessor"></span><span class="preprocessor">#define CANON_CAP_l         0x400ul</span>
<a name="l00635"></a><a class="code" href="print-canon_8c.html#a30">00635</a> <span class="preprocessor"></span><span class="preprocessor">#define CANON_CAP_r         0x800ul</span>
<a name="l00636"></a><a class="code" href="print-canon_8c.html#a31">00636</a> <span class="preprocessor"></span><span class="preprocessor">#define CANON_CAP_g         0x1000ul</span>
<a name="l00637"></a><a class="code" href="print-canon_8c.html#a32">00637</a> <span class="preprocessor"></span><span class="preprocessor">#define CANON_CAP_ACKSHORT  0x2000ul</span>
<a name="l00638"></a><a class="code" href="print-canon_8c.html#a33">00638</a> <span class="preprocessor"></span>
<a name="l00639"></a><a class="code" href="print-canon_8c.html#a34">00639</a> <span class="preprocessor">#define CANON_CAP_STD0 (CANON_CAP_b|CANON_CAP_c|CANON_CAP_d|\</span>
<a name="l00640"></a><a class="code" href="print-canon_8c.html#a35">00640</a> <span class="preprocessor">                        CANON_CAP_l|CANON_CAP_q|CANON_CAP_t)</span>
00641 <span class="preprocessor"></span>
<a name="l00642"></a><a class="code" href="print-canon_8c.html#a36">00642</a> <span class="preprocessor">#define CANON_CAP_STD1 (CANON_CAP_b|CANON_CAP_c|CANON_CAP_d|CANON_CAP_l|\</span>
00643 <span class="preprocessor">                        CANON_CAP_m|CANON_CAP_p|CANON_CAP_q|CANON_CAP_t)</span>
00644 <span class="preprocessor"></span>
<a name="l00645"></a><a class="code" href="print-canon_8c.html#a37">00645</a> <span class="preprocessor">#ifdef EXPERIMENTAL_STUFF</span>
00646 <span class="preprocessor"></span><span class="preprocessor">#define CANON_MODES(A) A,sizeof(A)/sizeof(canon_variable_printmode_t*)</span>
00647 <span class="preprocessor"></span><span class="preprocessor">#else</span>
00648 <span class="preprocessor"></span><span class="preprocessor">#define CANON_MODES(A) 0</span>
00649 <span class="preprocessor"></span><span class="preprocessor">#endif</span>
00650 <span class="preprocessor"></span>
<a name="l00651"></a><a class="code" href="print-canon_8c.html#a38">00651</a> <span class="preprocessor">#define CANON_INK(A) A,sizeof(A)/sizeof(canon_variable_inklist_t*)</span>
00652 <span class="preprocessor"></span>
00653 
<a name="l00654"></a><a class="code" href="print-canon_8c.html#a39">00654</a> <span class="preprocessor">#ifdef EXPERIMENTAL_STUFF</span>
00655 <span class="preprocessor"></span>
00656 <span class="preprocessor">#define BC_10   CANON_INK_K       </span><span class="comment">/* b/w   */</span>
00657 <span class="preprocessor">#define BC_11   CANON_INK_CMYK    </span><span class="comment">/* color */</span>
00658 <span class="preprocessor">#define BC_12   CANON_INK_CMYK    </span><span class="comment">/* photo */</span>
00659 <span class="preprocessor">#define BC_20   CANON_INK_K       </span><span class="comment">/* b/w   */</span>
00660 <span class="preprocessor">#define BC_21   CANON_INK_CMYK    </span><span class="comment">/* color */</span>
00661 <span class="preprocessor">#define BC_22   CANON_INK_CMYK    </span><span class="comment">/* photo */</span>
00662 <span class="preprocessor">#define BC_29   0                 </span><span class="comment">/* neon! */</span>
00663 <span class="preprocessor">#define BC_3031 CANON_INK_CMYK    </span><span class="comment">/* color */</span>
00664 <span class="preprocessor">#define BC_3231 CANON_INK_CcMmYK  </span><span class="comment">/* photo */</span>
00665 
00666 
00667 <span class="keyword">static</span> <span class="keyword">const</span> canon_variable_printmode_t canon_nomodes[] =
00668 {
00669   {0,0,0,0,0,0,0,0,0,0}
00670 };
00671 
00672 <span class="keyword">static</span> <span class="keyword">const</span> canon_variable_printmode_t canon_modes_30[] = {
00673   {  180, 180, 1, BC_10, 2,  1.0, 1.0, &amp;<a class="code" href="print-canon_8c.html#a65">ci_CMYK_1</a>,   0,0,0 },
00674   {  360, 360, 1, BC_10, 2,  1.0, 1.0, &amp;<a class="code" href="print-canon_8c.html#a65">ci_CMYK_1</a>,   0,0,0 },
00675   {  720, 360, 1, BC_10, 2,  1.0, 1.0, &amp;<a class="code" href="print-canon_8c.html#a65">ci_CMYK_1</a>,   0,0,0 },
00676 };
00677 
00678 <span class="keyword">static</span> <span class="keyword">const</span> canon_variable_printmode_t canon_modes_85[] = {
00679   {  360, 360, 1, BC_10, 2,  1.0, 1.0, &amp;<a class="code" href="print-canon_8c.html#a65">ci_CMYK_1</a>,   0,0,0 },
00680   {  360, 360, 1, BC_11, 2,  1.0, 1.0, &amp;<a class="code" href="print-canon_8c.html#a65">ci_CMYK_1</a>,   0,0,0 },
00681   {  360, 360, 2, BC_11, 2,  1.0, 1.0, &amp;<a class="code" href="print-canon_8c.html#a67">ci_CMYK_2</a>,   0,0,0 },
00682   {  360, 360, 1, BC_21, 2,  1.0, 1.0, &amp;<a class="code" href="print-canon_8c.html#a65">ci_CMYK_1</a>,   0,0,0 },
00683   {  360, 360, 2, BC_21, 2,  1.0, 1.0, &amp;<a class="code" href="print-canon_8c.html#a67">ci_CMYK_2</a>,   0,0,0 },
00684 };
00685 
00686 <span class="keyword">static</span> <span class="keyword">const</span> canon_variable_printmode_t canon_modes_2x00[] = {
00687   {  360, 360, 1, BC_20, 2,  1.0, 1.0, &amp;<a class="code" href="print-canon_8c.html#a65">ci_CMYK_1</a>,   0,0,0 },
00688   {  360, 360, 1, BC_21, 2,  1.0, 1.0, &amp;<a class="code" href="print-canon_8c.html#a65">ci_CMYK_1</a>,   0,0,0 },
00689   {  360, 360, 1, BC_22, 2,  1.0, 1.0, &amp;<a class="code" href="print-canon_8c.html#a65">ci_CMYK_1</a>,   0,0,0 },
00690 };
00691 
00692 <span class="keyword">static</span> <span class="keyword">const</span> canon_variable_printmode_t canon_modes_6x00[] = {
00693   {  360, 360, 1, BC_3031, 2,  1.8, 1.0, &amp;<a class="code" href="print-canon_8c.html#a65">ci_CMYK_1</a>,   0,0,0 },
00694   {  360, 360, 2, BC_3031, 2,  1.8, 1.0, &amp;<a class="code" href="print-canon_8c.html#a67">ci_CMYK_2</a>,   0,0,0 },
00695   {  720, 720, 1, BC_3031, 2,  1.0, 1.0, &amp;<a class="code" href="print-canon_8c.html#a65">ci_CMYK_1</a>,   0,0,0 },
00696   { 1440, 720, 1, BC_3031, 2,  0.5, 1.0, &amp;<a class="code" href="print-canon_8c.html#a65">ci_CMYK_1</a>,   0,0,0 },
00697   {  360, 360, 1, BC_3231, 2,  1.8, 1.0, &amp;<a class="code" href="print-canon_8c.html#a66">ci_CcMmYK_1</a>, 0,0,0 },
00698   {  360, 360, 2, BC_3231, 2,  1.8, 1.0, &amp;<a class="code" href="print-canon_8c.html#a68">ci_CcMmYK_2</a>, 0,0,0 },
00699   {  720, 720, 1, BC_3231, 2,  1.0, 1.0, &amp;<a class="code" href="print-canon_8c.html#a66">ci_CcMmYK_1</a>, 0,0,0 },
00700   { 1440, 720, 1, BC_3231, 2,  0.5, 1.0, &amp;<a class="code" href="print-canon_8c.html#a66">ci_CcMmYK_1</a>, 0,0,0 },
00701 };
00702 <span class="preprocessor">#endif</span>
00703 <span class="preprocessor"></span>
00704 <span class="keyword">static</span> <span class="keyword">const</span> <a class="code" href="structcanon__caps.html">canon_cap_t</a> <a class="code" href="print-canon_8c.html#a80">canon_model_capabilities</a>[] =
00705 {
00706   <span class="comment">/* default settings for unknown models */</span>
<a name="l00707"></a><a class="code" href="print-canon_8c.html#a80">00707</a> 
00708   {   -1, 17*72/2,842,180,180,20,20,20,20, <a class="code" href="print-canon_8c.html#a11">CANON_INK_K</a>, <a class="code" href="print-canon_8c.html#a18">CANON_SLOT_ASF1</a>, 0 },
00709 
00710   <span class="comment">/* ******************************** */</span>
00711   <span class="comment">/*                                  */</span>
00712   <span class="comment">/* tested and color-adjusted models */</span>
00713   <span class="comment">/*                                  */</span>
00714   <span class="comment">/* ******************************** */</span>
00715 
00716 
00717 
00718 
00719   <span class="comment">/* ************************************ */</span>
00720   <span class="comment">/*                                      */</span>
00721   <span class="comment">/* tested models w/out color-adjustment */</span>
00722   <span class="comment">/*                                      */</span>
00723   <span class="comment">/* ************************************ */</span>
00724 
00725 
00726   { <span class="comment">/* Canon  BJ 30   */</span><span class="comment">/* heads: BC-10 */</span>
00727     30, 1,
00728     9.5*72, 14*72,
00729     90, 360, 360, 2,
00730     11, 9, 10, 18,
00731     <a class="code" href="print-canon_8c.html#a11">CANON_INK_K</a>,
00732     <a class="code" href="print-canon_8c.html#a18">CANON_SLOT_ASF1</a>,
00733     <a class="code" href="print-canon_8c.html#a36">CANON_CAP_STD0</a> | <a class="code" href="print-canon_8c.html#a24">CANON_CAP_a</a>,
00734     <a class="code" href="print-canon_8c.html#a38">CANON_MODES</a>(canon_modes_30),
00735 <span class="preprocessor">#ifndef EXPERIMENTAL_STUFF</span>
00736 <span class="preprocessor"></span>    {-1,0,0,0,-1,-1}, <span class="comment">/*090x090 180x180 360x360 720x360 720x720 1440x1440*/</span>
00737     {1,1,1,1,1,1},    <span class="comment">/*------- 180x180 360x360 720x360 ------- ---------*/</span>
00738     <a class="code" href="print-canon_8c.html#a39">CANON_INK</a>(canon_ink_standard),
00739 <span class="preprocessor">#endif</span>
00740 <span class="preprocessor"></span>    <a class="code" href="print-canon_8c.html#a77">standard_lum_adjustment</a>,
00741     <a class="code" href="print-canon_8c.html#a78">standard_hue_adjustment</a>,
00742     <a class="code" href="print-canon_8c.html#a76">standard_sat_adjustment</a>
00743   },
00744 
00745   { <span class="comment">/* Canon  BJC 85  */</span><span class="comment">/* heads: BC-20 BC-21 BC-22 */</span>
00746     85, 1,
00747     9.5*72, 14*72,
00748     90, 720, 360, 2,
00749     11, 9, 10, 18,
00750     <a class="code" href="print-canon_8c.html#a11">CANON_INK_K</a> | <a class="code" href="print-canon_8c.html#a13">CANON_INK_CMYK</a> | <a class="code" href="print-canon_8c.html#a14">CANON_INK_CcMmYK</a>,
00751     <a class="code" href="print-canon_8c.html#a18">CANON_SLOT_ASF1</a>,
00752     <a class="code" href="print-canon_8c.html#a36">CANON_CAP_STD0</a> | <a class="code" href="print-canon_8c.html#a24">CANON_CAP_a</a> | <a class="code" href="print-canon_8c.html#a22">CANON_CAP_DMT</a>,
00753     <a class="code" href="print-canon_8c.html#a38">CANON_MODES</a>(canon_modes_85),
00754 <span class="preprocessor">#ifndef EXPERIMENTAL_STUFF</span>
00755 <span class="preprocessor"></span>    {-1,-1,1,0,-1,-1},<span class="comment">/*090x090 180x180 360x360 720x360 720x720 1440x1440*/</span>
00756     {1,1,1,1,1,1},    <span class="comment">/*------- ------- 360x360 720x360 ------- ---------*/</span>
00757     <a class="code" href="print-canon_8c.html#a39">CANON_INK</a>(canon_ink_standard),
00758 <span class="preprocessor">#endif</span>
00759 <span class="preprocessor"></span>    <a class="code" href="print-canon_8c.html#a77">standard_lum_adjustment</a>,
00760     <a class="code" href="print-canon_8c.html#a78">standard_hue_adjustment</a>,
00761     <a class="code" href="print-canon_8c.html#a76">standard_sat_adjustment</a>
00762   },
00763 
00764   { <span class="comment">/* Canon BJC 4300 */</span><span class="comment">/* heads: BC-20 BC-21 BC-22 BC-29 */</span>
00765     4300, 1,
00766     618, 936,      <span class="comment">/* 8.58" x 13 " */</span>
00767     180, 1440, 720, 2,
00768     11, 9, 10, 18,
00769     <a class="code" href="print-canon_8c.html#a13">CANON_INK_CMYK</a> | <a class="code" href="print-canon_8c.html#a14">CANON_INK_CcMmYK</a>,
00770     <a class="code" href="print-canon_8c.html#a18">CANON_SLOT_ASF1</a> | <a class="code" href="print-canon_8c.html#a20">CANON_SLOT_MAN1</a>,
00771     <a class="code" href="print-canon_8c.html#a36">CANON_CAP_STD0</a> | <a class="code" href="print-canon_8c.html#a22">CANON_CAP_DMT</a>,
00772     <a class="code" href="print-canon_8c.html#a38">CANON_MODES</a>(canon_nomodes),
00773 <span class="preprocessor">#ifndef EXPERIMENTAL_STUFF</span>
00774 <span class="preprocessor"></span>    {-1,1,0,0,-1,-1}, <span class="comment">/*180x180 360x360 720x720 1440x720 1440x1440 2880x2880*/</span>
00775     {1,1,1,1,1,1},    <span class="comment">/*------- 360x360 720x720 1440x720 --------- ---------*/</span>
00776     <a class="code" href="print-canon_8c.html#a39">CANON_INK</a>(canon_ink_standard),
00777 <span class="preprocessor">#endif</span>
00778 <span class="preprocessor"></span>    <a class="code" href="print-canon_8c.html#a77">standard_lum_adjustment</a>,
00779     <a class="code" href="print-canon_8c.html#a78">standard_hue_adjustment</a>,
00780     <a class="code" href="print-canon_8c.html#a76">standard_sat_adjustment</a>
00781   },
00782 
00783   { <span class="comment">/* Canon BJC 4400 */</span><span class="comment">/* heads: BC-20 BC-21 BC-22 BC-29 */</span>
00784     4400, 1,
00785     9.5*72, 14*72,
00786     90, 720, 360, 2,
00787     11, 9, 10, 18,
00788     <a class="code" href="print-canon_8c.html#a11">CANON_INK_K</a> | <a class="code" href="print-canon_8c.html#a13">CANON_INK_CMYK</a> | <a class="code" href="print-canon_8c.html#a14">CANON_INK_CcMmYK</a>,
00789     <a class="code" href="print-canon_8c.html#a18">CANON_SLOT_ASF1</a>,
00790     <a class="code" href="print-canon_8c.html#a36">CANON_CAP_STD0</a> | <a class="code" href="print-canon_8c.html#a24">CANON_CAP_a</a> | <a class="code" href="print-canon_8c.html#a22">CANON_CAP_DMT</a>,
00791     <a class="code" href="print-canon_8c.html#a38">CANON_MODES</a>(canon_nomodes),
00792 <span class="preprocessor">#ifndef EXPERIMENTAL_STUFF</span>
00793 <span class="preprocessor"></span>    {-1,-1,0,0,-1,-1},<span class="comment">/*090x090 180x180 360x360 720x360 720x720 1440x1440*/</span>
00794     {1,1,1,1,1,1},    <span class="comment">/*------- ------- 360x360 720x360 ------- ---------*/</span>
00795     <a class="code" href="print-canon_8c.html#a39">CANON_INK</a>(canon_ink_standard),
00796 <span class="preprocessor">#endif</span>
00797 <span class="preprocessor"></span>    <a class="code" href="print-canon_8c.html#a77">standard_lum_adjustment</a>,
00798     <a class="code" href="print-canon_8c.html#a78">standard_hue_adjustment</a>,
00799     <a class="code" href="print-canon_8c.html#a76">standard_sat_adjustment</a>
00800   },
00801 
00802   { <span class="comment">/* Canon BJC 6000 */</span><span class="comment">/* heads: BC-30/BC-31 BC-32/BC-31 */</span>
00803     6000, 3,
00804     618, 936,      <span class="comment">/* 8.58" x 13 " */</span>
00805     180, 1440, 720, 2,
00806     11, 9, 10, 18,
00807     <a class="code" href="print-canon_8c.html#a13">CANON_INK_CMYK</a> | <a class="code" href="print-canon_8c.html#a14">CANON_INK_CcMmYK</a>,
00808     <a class="code" href="print-canon_8c.html#a18">CANON_SLOT_ASF1</a> | <a class="code" href="print-canon_8c.html#a20">CANON_SLOT_MAN1</a>,
00809     <a class="code" href="print-canon_8c.html#a37">CANON_CAP_STD1</a> | <a class="code" href="print-canon_8c.html#a22">CANON_CAP_DMT</a> | <a class="code" href="print-canon_8c.html#a35">CANON_CAP_ACKSHORT</a>,
00810     <a class="code" href="print-canon_8c.html#a38">CANON_MODES</a>(canon_modes_6x00),
00811 <span class="preprocessor">#ifndef EXPERIMENTAL_STUFF</span>
00812 <span class="preprocessor"></span>    {-1,1,0,0,-1,-1}, <span class="comment">/*180x180 360x360 720x720 1440x720 1440x1440 2880x2880*/</span>
00813     {1,1.8,1,0.5,1,1},<span class="comment">/*------- 360x360 720x720 1440x720 --------- ---------*/</span>
00814     <a class="code" href="print-canon_8c.html#a39">CANON_INK</a>(canon_ink_standardphoto),
00815 <span class="preprocessor">#endif</span>
00816 <span class="preprocessor"></span>    <a class="code" href="print-canon_8c.html#a77">standard_lum_adjustment</a>,
00817     <a class="code" href="print-canon_8c.html#a78">standard_hue_adjustment</a>,
00818     <a class="code" href="print-canon_8c.html#a76">standard_sat_adjustment</a>
00819   },
00820 
00821   { <span class="comment">/* Canon BJC 6200 */</span><span class="comment">/* heads: BC-30/BC-31 BC-32/BC-31 */</span>
00822     6200, 3,
00823     618, 936,      <span class="comment">/* 8.58" x 13 " */</span>
00824     180, 1440, 720, 2,
00825     11, 9, 10, 18,
00826     <a class="code" href="print-canon_8c.html#a13">CANON_INK_CMYK</a> | <a class="code" href="print-canon_8c.html#a14">CANON_INK_CcMmYK</a>,
00827     <a class="code" href="print-canon_8c.html#a18">CANON_SLOT_ASF1</a> | <a class="code" href="print-canon_8c.html#a20">CANON_SLOT_MAN1</a>,
00828     <a class="code" href="print-canon_8c.html#a37">CANON_CAP_STD1</a> | <a class="code" href="print-canon_8c.html#a22">CANON_CAP_DMT</a> | <a class="code" href="print-canon_8c.html#a35">CANON_CAP_ACKSHORT</a>,
00829     <a class="code" href="print-canon_8c.html#a38">CANON_MODES</a>(canon_modes_6x00),
00830 <span class="preprocessor">#ifndef EXPERIMENTAL_STUFF</span>
00831 <span class="preprocessor"></span>    {-1,1,0,0,-1,-1}, <span class="comment">/*180x180 360x360 720x720 1440x720 1440x1440 2880x2880*/</span>
00832     {0,1.8,1,.5,0,0}, <span class="comment">/*------- 360x360 720x720 1440x720 --------- ---------*/</span>
00833     <a class="code" href="print-canon_8c.html#a39">CANON_INK</a>(canon_ink_standardphoto),
00834 <span class="preprocessor">#endif</span>
00835 <span class="preprocessor"></span>    <a class="code" href="print-canon_8c.html#a77">standard_lum_adjustment</a>,
00836     <a class="code" href="print-canon_8c.html#a78">standard_hue_adjustment</a>,
00837     <a class="code" href="print-canon_8c.html#a76">standard_sat_adjustment</a>
00838   },
00839 
00840   { <span class="comment">/* Canon BJC 6500 */</span><span class="comment">/* heads: BC-30/BC-31 BC-32/BC-31 */</span>
00841     6500, 3,
00842     842, 17*72,
00843     180, 1440, 720, 2,
00844     11, 9, 10, 18,
00845     <a class="code" href="print-canon_8c.html#a13">CANON_INK_CMYK</a> | <a class="code" href="print-canon_8c.html#a14">CANON_INK_CcMmYK</a>,
00846     <a class="code" href="print-canon_8c.html#a18">CANON_SLOT_ASF1</a> | <a class="code" href="print-canon_8c.html#a20">CANON_SLOT_MAN1</a>,
00847     <a class="code" href="print-canon_8c.html#a37">CANON_CAP_STD1</a> | <a class="code" href="print-canon_8c.html#a22">CANON_CAP_DMT</a>,
00848     <a class="code" href="print-canon_8c.html#a38">CANON_MODES</a>(canon_modes_6x00),
00849 <span class="preprocessor">#ifndef EXPERIMENTAL_STUFF</span>
00850 <span class="preprocessor"></span>    {-1,1,0,0,-1,-1}, <span class="comment">/*180x180 360x360 720x720 1440x720 1440x1440 2880x2880*/</span>
00851     {0,1.8,1,.5,0,0}, <span class="comment">/*------- 360x360 720x720 1440x720 --------- ---------*/</span>
00852     <a class="code" href="print-canon_8c.html#a39">CANON_INK</a>(canon_ink_standardphoto),
00853 <span class="preprocessor">#endif</span>
00854 <span class="preprocessor"></span>    <a class="code" href="print-canon_8c.html#a77">standard_lum_adjustment</a>,
00855     <a class="code" href="print-canon_8c.html#a78">standard_hue_adjustment</a>,
00856     <a class="code" href="print-canon_8c.html#a76">standard_sat_adjustment</a>
00857   },
00858 
00859   { <span class="comment">/* Canon BJC 8200 */</span><span class="comment">/* heads: BC-50 */</span>
00860     8200, 3,
00861     842, 17*72,
00862     150, 1200,1200, 4,
00863     11, 9, 10, 18,
00864     <a class="code" href="print-canon_8c.html#a13">CANON_INK_CMYK</a>, <span class="comment">/*  | CANON_INK_CcMmYK */</span>
00865     <a class="code" href="print-canon_8c.html#a18">CANON_SLOT_ASF1</a>,
00866     <a class="code" href="print-canon_8c.html#a37">CANON_CAP_STD1</a> | <a class="code" href="print-canon_8c.html#a33">CANON_CAP_r</a> | <a class="code" href="print-canon_8c.html#a22">CANON_CAP_DMT</a> | <a class="code" href="print-canon_8c.html#a35">CANON_CAP_ACKSHORT</a>,
00867     <a class="code" href="print-canon_8c.html#a38">CANON_MODES</a>(canon_nomodes),
00868 <span class="preprocessor">#ifndef EXPERIMENTAL_STUFF</span>
00869 <span class="preprocessor"></span>    {-1,0,0,-1,0,-1}, <span class="comment">/*150x150 300x300 600x600 1200x600 1200x1200 2400x2400*/</span>
00870     {1,1,1,1,1,1},    <span class="comment">/*------- 300x300 600x600 -------- 1200x1200 ---------*/</span>
00871     <a class="code" href="print-canon_8c.html#a39">CANON_INK</a>(canon_ink_superphoto),
00872 <span class="preprocessor">#endif</span>
00873 <span class="preprocessor"></span>    <a class="code" href="print-canon_8c.html#a77">standard_lum_adjustment</a>,
00874     <a class="code" href="print-canon_8c.html#a78">standard_hue_adjustment</a>,
00875     <a class="code" href="print-canon_8c.html#a76">standard_sat_adjustment</a>
00876   },
00877 
00878 
00879   <span class="comment">/* *************** */</span>
00880   <span class="comment">/*                 */</span>
00881   <span class="comment">/* untested models */</span>
00882   <span class="comment">/*                 */</span>
00883   <span class="comment">/* *************** */</span>
00884 
00885 
00886   { <span class="comment">/* Canon BJC 210 */</span><span class="comment">/* heads: BC-02 BC-05 BC-06 */</span>
00887     210, 1,
00888     618, 936,      <span class="comment">/* 8.58" x 13 " */</span>
00889     90, 720, 360, 2,
00890     11, 9, 10, 18,
00891     <a class="code" href="print-canon_8c.html#a11">CANON_INK_K</a> | <a class="code" href="print-canon_8c.html#a12">CANON_INK_CMY</a>,
00892     <a class="code" href="print-canon_8c.html#a18">CANON_SLOT_ASF1</a> | <a class="code" href="print-canon_8c.html#a20">CANON_SLOT_MAN1</a>,
00893     <a class="code" href="print-canon_8c.html#a36">CANON_CAP_STD0</a>,
00894     <a class="code" href="print-canon_8c.html#a38">CANON_MODES</a>(canon_nomodes),
00895 <span class="preprocessor">#ifndef EXPERIMENTAL_STUFF</span>
00896 <span class="preprocessor"></span>    {0,0,0,0,-1,-1},<span class="comment">/*180x180 360x360 720x720 1440x720 1440x1440 2880x2880*/</span>
00897     {1,1,1,1,1,1},    <span class="comment">/*180x180 360x360 ------- -------- --------- ---------*/</span>
00898     <a class="code" href="print-canon_8c.html#a39">CANON_INK</a>(canon_ink_standard),
00899 <span class="preprocessor">#endif</span>
00900 <span class="preprocessor"></span>    <a class="code" href="print-canon_8c.html#a77">standard_lum_adjustment</a>,
00901     <a class="code" href="print-canon_8c.html#a78">standard_hue_adjustment</a>,
00902     <a class="code" href="print-canon_8c.html#a76">standard_sat_adjustment</a>
00903   },
00904   { <span class="comment">/* Canon BJC 240 */</span><span class="comment">/* heads: BC-02 BC-05 BC-06 */</span>
00905     240, 1,
00906     618, 936,      <span class="comment">/* 8.58" x 13 " */</span>
00907     90, 720, 360, 2,
00908     11, 9, 10, 18,
00909     <a class="code" href="print-canon_8c.html#a11">CANON_INK_K</a> | <a class="code" href="print-canon_8c.html#a12">CANON_INK_CMY</a>,
00910     <a class="code" href="print-canon_8c.html#a18">CANON_SLOT_ASF1</a> | <a class="code" href="print-canon_8c.html#a20">CANON_SLOT_MAN1</a>,
00911     <a class="code" href="print-canon_8c.html#a36">CANON_CAP_STD0</a> | <a class="code" href="print-canon_8c.html#a22">CANON_CAP_DMT</a>,
00912     <a class="code" href="print-canon_8c.html#a38">CANON_MODES</a>(canon_nomodes),
00913 <span class="preprocessor">#ifndef EXPERIMENTAL_STUFF</span>
00914 <span class="preprocessor"></span>    {0,0,1,0,-1,-1},<span class="comment">/*180x180 360x360 720x720 1440x720 1440x1440 2880x2880*/</span>
00915     {1,1,1,1,1,1},    <span class="comment">/*180x180 360x360 ------- -------- --------- ---------*/</span>
00916     <a class="code" href="print-canon_8c.html#a39">CANON_INK</a>(canon_ink_oldphoto),
00917 <span class="preprocessor">#endif</span>
00918 <span class="preprocessor"></span>    <a class="code" href="print-canon_8c.html#a77">standard_lum_adjustment</a>,
00919     <a class="code" href="print-canon_8c.html#a78">standard_hue_adjustment</a>,
00920     <a class="code" href="print-canon_8c.html#a76">standard_sat_adjustment</a>
00921   },
00922   { <span class="comment">/* Canon BJC 250 */</span><span class="comment">/* heads: BC-02 BC-05 BC-06 */</span>
00923     250, 1,
00924     618, 936,      <span class="comment">/* 8.58" x 13 " */</span>
00925     90, 720, 360, 2,
00926     11, 9, 10, 18,
00927     <a class="code" href="print-canon_8c.html#a11">CANON_INK_K</a> | <a class="code" href="print-canon_8c.html#a12">CANON_INK_CMY</a>,
00928     <a class="code" href="print-canon_8c.html#a18">CANON_SLOT_ASF1</a> | <a class="code" href="print-canon_8c.html#a20">CANON_SLOT_MAN1</a>,
00929     <a class="code" href="print-canon_8c.html#a36">CANON_CAP_STD0</a> | <a class="code" href="print-canon_8c.html#a22">CANON_CAP_DMT</a>,
00930     <a class="code" href="print-canon_8c.html#a38">CANON_MODES</a>(canon_nomodes),
00931 <span class="preprocessor">#ifndef EXPERIMENTAL_STUFF</span>
00932 <span class="preprocessor"></span>    {0,0,1,0,-1,-1},<span class="comment">/*180x180 360x360 720x720 1440x720 1440x1440 2880x2880*/</span>
00933     {1,1,1,1,1,1},    <span class="comment">/*180x180 360x360 ------- -------- --------- ---------*/</span>
00934     <a class="code" href="print-canon_8c.html#a39">CANON_INK</a>(canon_ink_oldphoto),
00935 <span class="preprocessor">#endif</span>
00936 <span class="preprocessor"></span>    <a class="code" href="print-canon_8c.html#a77">standard_lum_adjustment</a>,
00937     <a class="code" href="print-canon_8c.html#a78">standard_hue_adjustment</a>,
00938     <a class="code" href="print-canon_8c.html#a76">standard_sat_adjustment</a>
00939   },
00940   { <span class="comment">/* Canon BJC 1000 */</span><span class="comment">/* heads: BC-02 BC-05 BC-06 */</span>
00941     1000, 1,
00942     842, 17*72,
00943     90, 720, 360, 2,
00944     11, 9, 10, 18,
00945     <a class="code" href="print-canon_8c.html#a11">CANON_INK_K</a> | <a class="code" href="print-canon_8c.html#a12">CANON_INK_CMY</a>,
00946     <a class="code" href="print-canon_8c.html#a18">CANON_SLOT_ASF1</a>,
00947     <a class="code" href="print-canon_8c.html#a36">CANON_CAP_STD0</a> | <a class="code" href="print-canon_8c.html#a22">CANON_CAP_DMT</a> | <a class="code" href="print-canon_8c.html#a24">CANON_CAP_a</a>,
00948     <a class="code" href="print-canon_8c.html#a38">CANON_MODES</a>(canon_nomodes),
00949 <span class="preprocessor">#ifndef EXPERIMENTAL_STUFF</span>
00950 <span class="preprocessor"></span>    {0,0,1,0,-1,-1},  <span class="comment">/*180x180 360x360 720x720 1440x720 1440x1440 2880x2880*/</span>
00951     {1,1,1,1,1,1},    <span class="comment">/*180x180 360x360 ------- -------- --------- ---------*/</span>
00952     <a class="code" href="print-canon_8c.html#a39">CANON_INK</a>(canon_ink_oldphoto),
00953 <span class="preprocessor">#endif</span>
00954 <span class="preprocessor"></span>    <a class="code" href="print-canon_8c.html#a77">standard_lum_adjustment</a>,
00955     <a class="code" href="print-canon_8c.html#a78">standard_hue_adjustment</a>,
00956     <a class="code" href="print-canon_8c.html#a76">standard_sat_adjustment</a>
00957   },
00958   { <span class="comment">/* Canon BJC 2000 */</span><span class="comment">/* heads: BC-20 BC-21 BC-22 BC-29 */</span>
00959     2000, 1,
00960     842, 17*72,
00961     180, 720, 360, 2,
00962     11, 9, 10, 18,
00963     <a class="code" href="print-canon_8c.html#a13">CANON_INK_CMYK</a>,
00964     <a class="code" href="print-canon_8c.html#a18">CANON_SLOT_ASF1</a>,
00965     <a class="code" href="print-canon_8c.html#a36">CANON_CAP_STD0</a> | <a class="code" href="print-canon_8c.html#a24">CANON_CAP_a</a>,
00966     <a class="code" href="print-canon_8c.html#a38">CANON_MODES</a>(canon_nomodes),
00967 <span class="preprocessor">#ifndef EXPERIMENTAL_STUFF</span>
00968 <span class="preprocessor"></span>    {0,0,-1,-1,-1,-1},<span class="comment">/*180x180 360x360 720x720 1440x720 1440x1440 2880x2880*/</span>
00969     {1,1,1,1,1,1},    <span class="comment">/*180x180 360x360 ------- -------- --------- ---------*/</span>
00970     <a class="code" href="print-canon_8c.html#a39">CANON_INK</a>(canon_ink_standard),
00971 <span class="preprocessor">#endif</span>
00972 <span class="preprocessor"></span>    <a class="code" href="print-canon_8c.html#a77">standard_lum_adjustment</a>,
00973     <a class="code" href="print-canon_8c.html#a78">standard_hue_adjustment</a>,
00974     <a class="code" href="print-canon_8c.html#a76">standard_sat_adjustment</a>
00975   },
00976   { <span class="comment">/* Canon BJC 3000 */</span><span class="comment">/* heads: BC-30 BC-33 BC-34 */</span>
00977     3000, 3,
00978     842, 17*72,
00979     180, 1440, 720, 2,
00980     11, 9, 10, 18,
00981     <a class="code" href="print-canon_8c.html#a13">CANON_INK_CMYK</a> | <a class="code" href="print-canon_8c.html#a14">CANON_INK_CcMmYK</a>,
00982     <a class="code" href="print-canon_8c.html#a18">CANON_SLOT_ASF1</a>,
00983     <a class="code" href="print-canon_8c.html#a36">CANON_CAP_STD0</a> | <a class="code" href="print-canon_8c.html#a24">CANON_CAP_a</a> | <a class="code" href="print-canon_8c.html#a22">CANON_CAP_DMT</a>, <span class="comment">/*FIX? should have _r? */</span>
00984     <a class="code" href="print-canon_8c.html#a38">CANON_MODES</a>(canon_nomodes),
00985 <span class="preprocessor">#ifndef EXPERIMENTAL_STUFF</span>
00986 <span class="preprocessor"></span>    {-1,1,0,0,-1,-1}, <span class="comment">/*180x180 360x360 720x720 1440x720 1440x1440 2880x2880*/</span>
00987     {1,1,1,1,1,1},    <span class="comment">/*------- 360x360 720x720 1440x720 --------- ---------*/</span>
00988     <a class="code" href="print-canon_8c.html#a39">CANON_INK</a>(canon_ink_standard),
00989 <span class="preprocessor">#endif</span>
00990 <span class="preprocessor"></span>    <a class="code" href="print-canon_8c.html#a77">standard_lum_adjustment</a>,
00991     <a class="code" href="print-canon_8c.html#a78">standard_hue_adjustment</a>,
00992     <a class="code" href="print-canon_8c.html#a76">standard_sat_adjustment</a>
00993   },
00994   { <span class="comment">/* Canon BJC 6100 */</span><span class="comment">/* heads: BC-30/BC-31 BC-32/BC-31 */</span>
00995     6100, 3,
00996     842, 17*72,
00997     180, 1440, 720, 2,
00998     11, 9, 10, 18,
00999     <a class="code" href="print-canon_8c.html#a13">CANON_INK_CMYK</a> | <a class="code" href="print-canon_8c.html#a14">CANON_INK_CcMmYK</a>,
01000     <a class="code" href="print-canon_8c.html#a18">CANON_SLOT_ASF1</a>,
01001     <a class="code" href="print-canon_8c.html#a37">CANON_CAP_STD1</a> | <a class="code" href="print-canon_8c.html#a24">CANON_CAP_a</a> | <a class="code" href="print-canon_8c.html#a33">CANON_CAP_r</a> | <a class="code" href="print-canon_8c.html#a22">CANON_CAP_DMT</a>,
01002     <a class="code" href="print-canon_8c.html#a38">CANON_MODES</a>(canon_modes_6x00),
01003 <span class="preprocessor">#ifndef EXPERIMENTAL_STUFF</span>
01004 <span class="preprocessor"></span>    {-1,1,0,0,-1,-1}, <span class="comment">/*180x180 360x360 720x720 1440x720 1440x1440 2880x2880*/</span>
01005     {1,1,1,1,1,1},    <span class="comment">/*------- 360x360 720x720 1440x720 --------- ---------*/</span>
01006     <a class="code" href="print-canon_8c.html#a39">CANON_INK</a>(canon_ink_standard),
01007 <span class="preprocessor">#endif</span>
01008 <span class="preprocessor"></span>    <a class="code" href="print-canon_8c.html#a77">standard_lum_adjustment</a>,
01009     <a class="code" href="print-canon_8c.html#a78">standard_hue_adjustment</a>,
01010     <a class="code" href="print-canon_8c.html#a76">standard_sat_adjustment</a>
01011   },
01012   { <span class="comment">/* Canon BJC 7000 */</span><span class="comment">/* heads: BC-60/BC-61 BC-60/BC-62   ??????? */</span>
01013     7000, 3,
01014     842, 17*72,
01015     150, 1200, 600, 2,
01016     11, 9, 10, 18,
01017     <a class="code" href="print-canon_8c.html#a13">CANON_INK_CMYK</a> | <a class="code" href="print-canon_8c.html#a15">CANON_INK_CcMmYyK</a>,
01018     <a class="code" href="print-canon_8c.html#a18">CANON_SLOT_ASF1</a>,
01019     <a class="code" href="print-canon_8c.html#a37">CANON_CAP_STD1</a>,
01020     <a class="code" href="print-canon_8c.html#a38">CANON_MODES</a>(canon_nomodes),
01021 <span class="preprocessor">#ifndef EXPERIMENTAL_STUFF</span>
01022 <span class="preprocessor"></span>    {-1,0,0,0,-1,-1}, <span class="comment">/*150x150 300x300 600x600 1200x600 1200x1200 2400x2400*/</span>
01023     {1,3.5,1.8,1,1,1},<span class="comment">/*------- 300x300 600x600 1200x600 --------- ---------*/</span>
01024     <a class="code" href="print-canon_8c.html#a39">CANON_INK</a>(canon_ink_standard),
01025 <span class="preprocessor">#endif</span>
01026 <span class="preprocessor"></span>    <a class="code" href="print-canon_8c.html#a77">standard_lum_adjustment</a>,
01027     <a class="code" href="print-canon_8c.html#a78">standard_hue_adjustment</a>,
01028     <a class="code" href="print-canon_8c.html#a76">standard_sat_adjustment</a>
01029   },
01030   { <span class="comment">/* Canon BJC 7100 */</span><span class="comment">/* heads: BC-60/BC-61 BC-60/BC-62   ??????? */</span>
01031     7100, 3,
01032     842, 17*72,
01033     150, 1200, 600, 2,
01034     11, 9, 10, 18,
01035     <a class="code" href="print-canon_8c.html#a13">CANON_INK_CMYK</a> | <a class="code" href="print-canon_8c.html#a15">CANON_INK_CcMmYyK</a>,
01036     <a class="code" href="print-canon_8c.html#a18">CANON_SLOT_ASF1</a>,
01037     <a class="code" href="print-canon_8c.html#a36">CANON_CAP_STD0</a>,
01038     <a class="code" href="print-canon_8c.html#a38">CANON_MODES</a>(canon_nomodes),
01039 <span class="preprocessor">#ifndef EXPERIMENTAL_STUFF</span>
01040 <span class="preprocessor"></span>    {-1,0,0,0,-1,-1}, <span class="comment">/*150x150 300x300 600x600 1200x600 1200x1200 2400x2400*/</span>
01041     {1,1,1,1,1,1},    <span class="comment">/*------- 300x300 600x600 1200x600 --------- ---------*/</span>
01042     <a class="code" href="print-canon_8c.html#a39">CANON_INK</a>(canon_ink_standard),
01043 <span class="preprocessor">#endif</span>
01044 <span class="preprocessor"></span>    <a class="code" href="print-canon_8c.html#a77">standard_lum_adjustment</a>,
01045     <a class="code" href="print-canon_8c.html#a78">standard_hue_adjustment</a>,
01046     <a class="code" href="print-canon_8c.html#a76">standard_sat_adjustment</a>
01047   },
01048 
01049   <span class="comment">/*****************************/</span>
01050   <span class="comment">/*                           */</span>
01051   <span class="comment">/*  extremely fuzzy models   */</span>
01052   <span class="comment">/* (might never work at all) */</span>
01053   <span class="comment">/*                           */</span>
01054   <span class="comment">/*****************************/</span>
01055 
01056   { <span class="comment">/* Canon BJC 5100 */</span><span class="comment">/* heads: BC-20 BC-21 BC-22 BC-23 BC-29 */</span>
01057     5100, 1,
01058     17*72, 22*72,
01059     180, 1440, 720, 2,
01060     11, 9, 10, 18,
01061     <a class="code" href="print-canon_8c.html#a13">CANON_INK_CMYK</a> | <a class="code" href="print-canon_8c.html#a14">CANON_INK_CcMmYK</a>,
01062     <a class="code" href="print-canon_8c.html#a18">CANON_SLOT_ASF1</a>,
01063     <a class="code" href="print-canon_8c.html#a36">CANON_CAP_STD0</a> | <a class="code" href="print-canon_8c.html#a22">CANON_CAP_DMT</a>,
01064     <a class="code" href="print-canon_8c.html#a38">CANON_MODES</a>(canon_nomodes),
01065 <span class="preprocessor">#ifndef EXPERIMENTAL_STUFF</span>
01066 <span class="preprocessor"></span>    {-1,1,0,0,-1,-1}, <span class="comment">/*180x180 360x360 720x720 1440x720 1440x1440 2880x2880*/</span>
01067     {1,1,1,1,1,1},    <span class="comment">/*------- 360x360 720x720 1440x720 --------- ---------*/</span>
01068     <a class="code" href="print-canon_8c.html#a39">CANON_INK</a>(canon_ink_standard),
01069 <span class="preprocessor">#endif</span>
01070 <span class="preprocessor"></span>    <a class="code" href="print-canon_8c.html#a77">standard_lum_adjustment</a>,
01071     <a class="code" href="print-canon_8c.html#a78">standard_hue_adjustment</a>,
01072     <a class="code" href="print-canon_8c.html#a76">standard_sat_adjustment</a>
01073   },
01074   { <span class="comment">/* Canon BJC 5500 */</span><span class="comment">/* heads: BC-20 BC-21 BC-29 */</span>
01075     5500, 1,
01076     22*72, 34*72,
01077     180, 720, 360, 2,
01078     11, 9, 10, 18,
01079     <a class="code" href="print-canon_8c.html#a13">CANON_INK_CMYK</a> | <a class="code" href="print-canon_8c.html#a14">CANON_INK_CcMmYK</a>,
01080     <a class="code" href="print-canon_8c.html#a18">CANON_SLOT_ASF1</a>,
01081     <a class="code" href="print-canon_8c.html#a36">CANON_CAP_STD0</a> | <a class="code" href="print-canon_8c.html#a24">CANON_CAP_a</a>,
01082     <a class="code" href="print-canon_8c.html#a38">CANON_MODES</a>(canon_nomodes),
01083 <span class="preprocessor">#ifndef EXPERIMENTAL_STUFF</span>
01084 <span class="preprocessor"></span>    {0,0,-1,-1,-1,-1},<span class="comment">/*180x180 360x360 720x720 1440x720 1440x1440 2880x2880*/</span>
01085     {1,1,1,1,1,1},    <span class="comment">/*180x180 360x360 ------- -------- --------- ---------*/</span>
01086     <a class="code" href="print-canon_8c.html#a39">CANON_INK</a>(canon_ink_standard),
01087 <span class="preprocessor">#endif</span>
01088 <span class="preprocessor"></span>    <a class="code" href="print-canon_8c.html#a77">standard_lum_adjustment</a>,
01089     <a class="code" href="print-canon_8c.html#a78">standard_hue_adjustment</a>,
01090     <a class="code" href="print-canon_8c.html#a76">standard_sat_adjustment</a>
01091   },
01092   { <span class="comment">/* Canon BJC 6500 */</span><span class="comment">/* heads: BC-30/BC-31 BC-32/BC-31 */</span>
01093     6500, 3,
01094     17*72, 22*72,
01095     180, 1440, 720, 2,
01096     11, 9, 10, 18,
01097     <a class="code" href="print-canon_8c.html#a13">CANON_INK_CMYK</a> | <a class="code" href="print-canon_8c.html#a14">CANON_INK_CcMmYK</a>,
01098     <a class="code" href="print-canon_8c.html#a18">CANON_SLOT_ASF1</a>,
01099     <a class="code" href="print-canon_8c.html#a37">CANON_CAP_STD1</a> | <a class="code" href="print-canon_8c.html#a24">CANON_CAP_a</a> | <a class="code" href="print-canon_8c.html#a22">CANON_CAP_DMT</a>,
01100     <a class="code" href="print-canon_8c.html#a38">CANON_MODES</a>(canon_nomodes),
01101 <span class="preprocessor">#ifndef EXPERIMENTAL_STUFF</span>
01102 <span class="preprocessor"></span>    {-1,1,0,0,-1,-1}, <span class="comment">/*180x180 360x360 720x720 1440x720 1440x1440 2880x2880*/</span>
01103     {1,1,1,1,1,1},    <span class="comment">/*------- 360x360 720x720 1440x720 --------- ---------*/</span>
01104     <a class="code" href="print-canon_8c.html#a39">CANON_INK</a>(canon_ink_standard),
01105 <span class="preprocessor">#endif</span>
01106 <span class="preprocessor"></span>    <a class="code" href="print-canon_8c.html#a77">standard_lum_adjustment</a>,
01107     <a class="code" href="print-canon_8c.html#a78">standard_hue_adjustment</a>,
01108     <a class="code" href="print-canon_8c.html#a76">standard_sat_adjustment</a>
01109   },
01110   { <span class="comment">/* Canon BJC 8500 */</span><span class="comment">/* heads: BC-80/BC-81 BC-82/BC-81 */</span>
01111     8500, 3,
01112     17*72, 22*72,
01113     150, 1200,1200, 2,
01114     11, 9, 10, 18,
01115     <a class="code" href="print-canon_8c.html#a13">CANON_INK_CMYK</a> | <a class="code" href="print-canon_8c.html#a14">CANON_INK_CcMmYK</a>,
01116     <a class="code" href="print-canon_8c.html#a18">CANON_SLOT_ASF1</a>,
01117     <a class="code" href="print-canon_8c.html#a36">CANON_CAP_STD0</a>,
01118     <a class="code" href="print-canon_8c.html#a38">CANON_MODES</a>(canon_nomodes),
01119 <span class="preprocessor">#ifndef EXPERIMENTAL_STUFF</span>
01120 <span class="preprocessor"></span>    {-1,0,0,-1,0,-1}, <span class="comment">/*150x150 300x300 600x600 1200x600 1200x1200 2400x2400*/</span>
01121     {1,1,1,1,1,1},    <span class="comment">/*------- 300x300 600x600 -------- 1200x1200 ---------*/</span>
01122     <a class="code" href="print-canon_8c.html#a39">CANON_INK</a>(canon_ink_standard),
01123 <span class="preprocessor">#endif</span>
01124 <span class="preprocessor"></span>    <a class="code" href="print-canon_8c.html#a77">standard_lum_adjustment</a>,
01125     <a class="code" href="print-canon_8c.html#a78">standard_hue_adjustment</a>,
01126     <a class="code" href="print-canon_8c.html#a76">standard_sat_adjustment</a>
01127   },
01128 };
01129 
01130 <span class="keyword">typedef</span> <span class="keyword">struct </span>{
01131   <span class="keywordtype">int</span> x;
01132   <span class="keywordtype">int</span> y;
<a name="l01133"></a><a class="code" href="structcanon__res__t.html">01133</a>   <span class="keyword">const</span> <span class="keywordtype">char</span> *name;
<a name="l01134"></a><a class="code" href="structcanon__res__t.html#o0">01134</a>   <span class="keyword">const</span> <span class="keywordtype">char</span> *text;
<a name="l01135"></a><a class="code" href="structcanon__res__t.html#o1">01135</a>   <span class="keyword">const</span> <span class="keywordtype">char</span> *name_dmt;
<a name="l01136"></a><a class="code" href="structcanon__res__t.html#o2">01136</a>   <span class="keyword">const</span> <span class="keywordtype">char</span> *text_dmt;
<a name="l01137"></a><a class="code" href="structcanon__res__t.html#o3">01137</a> } <a class="code" href="structcanon__res__t.html">canon_res_t</a>;
<a name="l01138"></a><a class="code" href="structcanon__res__t.html#o4">01138</a> 
<a name="l01139"></a><a class="code" href="structcanon__res__t.html#o5">01139</a> <span class="keyword">static</span> <span class="keyword">const</span> <a class="code" href="structcanon__res__t.html">canon_res_t</a> <a class="code" href="print-canon_8c.html#a81">canon_resolutions</a>[] = {
01140   { 90, 90, <span class="stringliteral">"90x90dpi"</span>, <a class="code" href="group__intl__internal.html#ga6">N_</a>(<span class="stringliteral">"90x90 DPI"</span>), <span class="stringliteral">"90x90dmt"</span>, <a class="code" href="group__intl__internal.html#ga6">N_</a>(<span class="stringliteral">"90x90 DPI DMT"</span>) },
01141   { 180, 180, <span class="stringliteral">"180x180dpi"</span>, <a class="code" href="group__intl__internal.html#ga6">N_</a>(<span class="stringliteral">"180x180 DPI"</span>), <span class="stringliteral">"180x180dmt"</span>, <a class="code" href="group__intl__internal.html#ga6">N_</a>(<span class="stringliteral">"180x180 DPI DMT"</span>) },
<a name="l01142"></a><a class="code" href="print-canon_8c.html#a81">01142</a>   { 360, 360, <span class="stringliteral">"360x360dpi"</span>, <a class="code" href="group__intl__internal.html#ga6">N_</a>(<span class="stringliteral">"360x360 DPI"</span>), <span class="stringliteral">"360x360dmt"</span>, <a class="code" href="group__intl__internal.html#ga6">N_</a>(<span class="stringliteral">"360x360 DPI DMT"</span>) },
01143   { 720, 360, <span class="stringliteral">"720x360dpi"</span>, <a class="code" href="group__intl__internal.html#ga6">N_</a>(<span class="stringliteral">"720x360 DPI"</span>), <span class="stringliteral">"720x360dmt"</span>, <a class="code" href="group__intl__internal.html#ga6">N_</a>(<span class="stringliteral">"720x360 DPI DMT"</span>) },
01144   { 720, 720, <span class="stringliteral">"720x720dpi"</span>, <a class="code" href="group__intl__internal.html#ga6">N_</a>(<span class="stringliteral">"720x720 DPI"</span>), <span class="stringliteral">"720x720dmt"</span>, <a class="code" href="group__intl__internal.html#ga6">N_</a>(<span class="stringliteral">"720x720 DPI DMT"</span>) },
01145   { 1440, 720, <span class="stringliteral">"1440x720dpi"</span>, <a class="code" href="group__intl__internal.html#ga6">N_</a>(<span class="stringliteral">"1440x720 DPI"</span>), <span class="stringliteral">"1440x720dmt"</span>, <a class="code" href="group__intl__internal.html#ga6">N_</a>(<span class="stringliteral">"1440x720 DPI DMT"</span>) },
01146   { 1440, 1440, <span class="stringliteral">"1440x1440dpi"</span>, <a class="code" href="group__intl__internal.html#ga6">N_</a>(<span class="stringliteral">"1440x1440 DPI"</span>), <span class="stringliteral">"1440x1440dmt"</span>, <a class="code" href="group__intl__internal.html#ga6">N_</a>(<span class="stringliteral">"1440x1440 DPI DMT"</span>) },
01147   { 2880, 2880, <span class="stringliteral">"2880x2880dpi"</span>, <a class="code" href="group__intl__internal.html#ga6">N_</a>(<span class="stringliteral">"2880x2880 DPI"</span>), <span class="stringliteral">"2880x2880dmt"</span>, <a class="code" href="group__intl__internal.html#ga6">N_</a>(<span class="stringliteral">"2880x2880 DPI DMT"</span>) },
01148   { 150, 150, <span class="stringliteral">"150x150dpi"</span>, <a class="code" href="group__intl__internal.html#ga6">N_</a>(<span class="stringliteral">"150x150 DPI"</span>), <span class="stringliteral">"150x150dmt"</span>, <a class="code" href="group__intl__internal.html#ga6">N_</a>(<span class="stringliteral">"150x150 DPI DMT"</span>) },
01149   { 300, 300, <span class="stringliteral">"300x300dpi"</span>, <a class="code" href="group__intl__internal.html#ga6">N_</a>(<span class="stringliteral">"300x300 DPI"</span>), <span class="stringliteral">"300x300dmt"</span>, <a class="code" href="group__intl__internal.html#ga6">N_</a>(<span class="stringliteral">"300x300 DPI DMT"</span>) },
01150   { 600, 300, <span class="stringliteral">"600x300dpi"</span>, <a class="code" href="group__intl__internal.html#ga6">N_</a>(<span class="stringliteral">"600x300 DPI"</span>), <span class="stringliteral">"600x300dmt"</span>, <a class="code" href="group__intl__internal.html#ga6">N_</a>(<span class="stringliteral">"600x300 DPI DMT"</span>) },
01151   { 600, 600, <span class="stringliteral">"600x600dpi"</span>, <a class="code" href="group__intl__internal.html#ga6">N_</a>(<span class="stringliteral">"600x600 DPI"</span>), <span class="stringliteral">"600x600dmt"</span>, <a class="code" href="group__intl__internal.html#ga6">N_</a>(<span class="stringliteral">"600x600 DPI DMT"</span>) },
01152   { 1200, 600, <span class="stringliteral">"1200x600dpi"</span>, <a class="code" href="group__intl__internal.html#ga6">N_</a>(<span class="stringliteral">"1200x600 DPI"</span>), <span class="stringliteral">"1200x600dmt"</span>, <a class="code" href="group__intl__internal.html#ga6">N_</a>(<span class="stringliteral">"1200x600 DPI DMT"</span>) },
01153   { 1200, 1200, <span class="stringliteral">"1200x1200dpi"</span>, <a class="code" href="group__intl__internal.html#ga6">N_</a>(<span class="stringliteral">"1200x1200 DPI"</span>), <span class="stringliteral">"1200x1200dmt"</span>, <a class="code" href="group__intl__internal.html#ga6">N_</a>(<span class="stringliteral">"1200x1200 DPI DMT"</span>) },
01154   { 2400, 2400, <span class="stringliteral">"2400x2400dpi"</span>, <a class="code" href="group__intl__internal.html#ga6">N_</a>(<span class="stringliteral">"2400x2400 DPI"</span>), <span class="stringliteral">"2400x2400dmt"</span>, <a class="code" href="group__intl__internal.html#ga6">N_</a>(<span class="stringliteral">"2400x2400 DPI DMT"</span>) },
01155   { 0, 0, NULL, NULL, NULL, NULL }
01156 };
01157 
01158 <span class="keyword">static</span> <span class="keyword">const</span> <span class="keywordtype">char</span> <a class="code" href="print-canon_8c.html#a82">plain_paper_lum_adjustment</a>[] =
01159 <span class="stringliteral">"&lt;?xml version=\"1.0\" encoding=\"UTF-8\"?&gt;\n"</span>
01160 <span class="stringliteral">"&lt;gimp-print&gt;\n"</span>
<a name="l01161"></a><a class="code" href="print-canon_8c.html#a82">01161</a> <span class="stringliteral">"&lt;curve wrap=\"wrap\" type=\"linear\" gamma=\"0\"&gt;\n"</span>
01162 <span class="stringliteral">"&lt;sequence count=\"48\" lower-bound=\"0\" upper-bound=\"4\"&gt;\n"</span>
01163 <span class="stringliteral">"1.20 1.22 1.28 1.34 1.39 1.42 1.45 1.48 "</span>  <span class="comment">/* C */</span>
01164 <span class="stringliteral">"1.50 1.40 1.30 1.25 1.20 1.10 1.05 1.05 "</span>  <span class="comment">/* B */</span>
01165 <span class="stringliteral">"1.05 1.05 1.05 1.05 1.05 1.05 1.05 1.05 "</span>  <span class="comment">/* M */</span>
01166 <span class="stringliteral">"1.05 1.05 1.05 1.10 1.10 1.10 1.10 1.10 "</span>  <span class="comment">/* R */</span>
01167 <span class="stringliteral">"1.10 1.15 1.30 1.45 1.60 1.75 1.90 2.00 "</span>  <span class="comment">/* Y */</span>
01168 <span class="stringliteral">"2.10 2.00 1.80 1.70 1.60 1.50 1.40 1.30 "</span>  <span class="comment">/* G */</span>
01169 <span class="stringliteral">"&lt;/sequence&gt;\n"</span>
01170 <span class="stringliteral">"&lt;/curve&gt;\n"</span>
01171 <span class="stringliteral">"&lt;/gimp-print&gt;\n"</span>;
01172 
01173 <span class="keyword">typedef</span> <span class="keyword">struct </span>{
01174   <span class="keyword">const</span> <span class="keywordtype">char</span> *name;
01175   <span class="keyword">const</span> <span class="keywordtype">char</span> *text;
<a name="l01176"></a><a class="code" href="structpaper__t.html">01176</a>   <span class="keywordtype">int</span> media_code;
<a name="l01177"></a><a class="code" href="structpaper__t.html#o0">01177</a>   <span class="keywordtype">double</span> base_density;
<a name="l01178"></a><a class="code" href="structpaper__t.html#o1">01178</a>   <span class="keywordtype">double</span> k_lower_scale;
<a name="l01179"></a><a class="code" href="structpaper__t.html#o2">01179</a>   <span class="keywordtype">double</span> k_upper;
01180   <span class="keyword">const</span> <span class="keywordtype">char</span> *hue_adjustment;
01181   <span class="keyword">const</span> <span class="keywordtype">char</span> *lum_adjustment;
01182   <span class="keyword">const</span> <span class="keywordtype">char</span> *sat_adjustment;
<a name="l01183"></a><a class="code" href="structpaper__t.html#o6">01183</a> } <a class="code" href="structpaper__t.html">paper_t</a>;
<a name="l01184"></a><a class="code" href="structpaper__t.html#o7">01184</a> 
<a name="l01185"></a><a class="code" href="structpaper__t.html#o8">01185</a> <span class="keyword">typedef</span> <span class="keyword">struct </span>{
01186   <span class="keyword">const</span> <a class="code" href="structcanon__caps.html">canon_cap_t</a> *caps;
01187   <span class="keywordtype">int</span> printing_color;
<a name="l01188"></a><a class="code" href="structcanon__init__t.html">01188</a>   <span class="keyword">const</span> <a class="code" href="structpaper__t.html">paper_t</a> *pt;
<a name="l01189"></a><a class="code" href="structcanon__init__t.html#o0">01189</a>   <span class="keywordtype">int</span> print_head;
<a name="l01190"></a><a class="code" href="structcanon__init__t.html#o1">01190</a>   <span class="keywordtype">int</span> colormode;
<a name="l01191"></a><a class="code" href="structcanon__init__t.html#o2">01191</a>   <span class="keyword">const</span> <span class="keywordtype">char</span> *source_str;
<a name="l01192"></a><a class="code" href="structcanon__init__t.html#o3">01192</a>   <span class="keywordtype">int</span> xdpi;
<a name="l01193"></a><a class="code" href="structcanon__init__t.html#o4">01193</a>   <span class="keywordtype">int</span> ydpi;
<a name="l01194"></a><a class="code" href="structcanon__init__t.html#o5">01194</a>   <span class="keywordtype">int</span> page_width;
<a name="l01195"></a><a class="code" href="structcanon__init__t.html#o6">01195</a>   <span class="keywordtype">int</span> page_height;
<a name="l01196"></a><a class="code" href="structcanon__init__t.html#o7">01196</a>   <span class="keywordtype">int</span> top;
<a name="l01197"></a><a class="code" href="structcanon__init__t.html#o8">01197</a>   <span class="keywordtype">int</span> left;
<a name="l01198"></a><a class="code" href="structcanon__init__t.html#o9">01198</a>   <span class="keywordtype">int</span> bits;
<a name="l01199"></a><a class="code" href="structcanon__init__t.html#o10">01199</a> } <a class="code" href="structcanon__init__t.html">canon_init_t</a>;
<a name="l01200"></a><a class="code" href="structcanon__init__t.html#o11">01200</a> 
<a name="l01201"></a><a class="code" href="structcanon__init__t.html#o12">01201</a> <span class="keyword">static</span> <span class="keyword">const</span> <a class="code" href="structpaper__t.html">paper_t</a> <a class="code" href="print-canon_8c.html#a83">canon_paper_list</a>[] = {
01202   { <span class="stringliteral">"Plain"</span>,            <a class="code" href="group__intl__internal.html#ga6">N_</a> (<span class="stringliteral">"Plain Paper"</span>),                0x00, 0.50, 0.25, 0.500, 0, 0, 0 },
01203   { <span class="stringliteral">"Transparency"</span>,     <a class="code" href="group__intl__internal.html#ga6">N_</a> (<span class="stringliteral">"Transparencies"</span>),             0x02, 1.00, 1.00, 0.900, 0, 0, 0 },
<a name="l01204"></a><a class="code" href="print-canon_8c.html#a83">01204</a>   { <span class="stringliteral">"BackPrint"</span>,        <a class="code" href="group__intl__internal.html#ga6">N_</a> (<span class="stringliteral">"Back Print Film"</span>),            0x03, 1.00, 1.00, 0.900, 0, 0, 0 },
01205   { <span class="stringliteral">"Fabric"</span>,           <a class="code" href="group__intl__internal.html#ga6">N_</a> (<span class="stringliteral">"Fabric Sheets"</span>),              0x04, 0.50, 0.25, 0.500, 0, 0, 0 },
01206   { <span class="stringliteral">"Envelope"</span>,         <a class="code" href="group__intl__internal.html#ga6">N_</a> (<span class="stringliteral">"Envelope"</span>),                   0x08, 0.50, 0.25, 0.500, 0, 0, 0 },
01207   { <span class="stringliteral">"Coated"</span>,           <a class="code" href="group__intl__internal.html#ga6">N_</a> (<span class="stringliteral">"High Resolution Paper"</span>),      0x07, 0.78, 0.25, 0.500, 0, 0, 0 },
01208   { <span class="stringliteral">"TShirt"</span>,           <a class="code" href="group__intl__internal.html#ga6">N_</a> (<span class="stringliteral">"T-Shirt Transfers"</span>),          0x03, 0.50, 0.25, 0.500, 0, 0, 0 },
01209   { <span class="stringliteral">"GlossyFilm"</span>,       <a class="code" href="group__intl__internal.html#ga6">N_</a> (<span class="stringliteral">"High Gloss Film"</span>),            0x06, 1.00, 1.00, 0.999, 0, 0, 0 },
01210   { <span class="stringliteral">"GlossyPaper"</span>,      <a class="code" href="group__intl__internal.html#ga6">N_</a> (<span class="stringliteral">"Glossy Photo Paper"</span>),         0x05, 1.00, 1.00, 0.999, 0, 0, 0 },
01211   { <span class="stringliteral">"GlossyCard"</span>,       <a class="code" href="group__intl__internal.html#ga6">N_</a> (<span class="stringliteral">"Glossy Photo Cards"</span>),         0x0a, 1.00, 1.00, 0.999, 0, 0, 0 },
01212   { <span class="stringliteral">"GlossyPro"</span>,        <a class="code" href="group__intl__internal.html#ga6">N_</a> (<span class="stringliteral">"Photo Paper Pro"</span>),            0x09, 1.00, 1.00, 0.999, 0, 0, 0 },
01213   { <span class="stringliteral">"Other"</span>,            <a class="code" href="group__intl__internal.html#ga6">N_</a> (<span class="stringliteral">"Other"</span>),                      0x00, 0.50, 0.25, .5, 0, 0, 0 },
01214 };
01215 
01216 <span class="keyword">static</span> <span class="keyword">const</span> <span class="keywordtype">int</span> <a class="code" href="print-canon_8c.html#a84">paper_type_count</a> = <span class="keyword">sizeof</span>(<a class="code" href="print-canon_8c.html#a83">canon_paper_list</a>) / <span class="keyword">sizeof</span>(<a class="code" href="structpaper__t.html">paper_t</a>);
01217 
01218 <span class="keyword">static</span> <span class="keyword">const</span> <a class="code" href="structstp__parameter__t.html">stp_parameter_t</a> <a class="code" href="print-canon_8c.html#a85">the_parameters</a>[] =
<a name="l01219"></a><a class="code" href="print-canon_8c.html#a84">01219</a> {
01220   {
<a name="l01221"></a><a class="code" href="print-canon_8c.html#a85">01221</a>     <span class="stringliteral">"PageSize"</span>, <a class="code" href="group__intl__internal.html#ga6">N_</a>(<span class="stringliteral">"Page Size"</span>), <a class="code" href="group__intl__internal.html#ga6">N_</a>(<span class="stringliteral">"Basic Printer Setup"</span>),
01222     <a class="code" href="group__intl__internal.html#ga6">N_</a>(<span class="stringliteral">"Size of the paper being printed to"</span>),
01223     <a class="code" href="group__vars.html#gga132a7">STP_PARAMETER_TYPE_STRING_LIST</a>, <a class="code" href="group__vars.html#gga133a19">STP_PARAMETER_CLASS_CORE</a>,
01224     <a class="code" href="group__vars.html#gga134a21">STP_PARAMETER_LEVEL_BASIC</a>, 1, 1, -1, 1, 0
01225   },
01226   {
01227     <span class="stringliteral">"MediaType"</span>, <a class="code" href="group__intl__internal.html#ga6">N_</a>(<span class="stringliteral">"Media Type"</span>), <a class="code" href="group__intl__internal.html#ga6">N_</a>(<span class="stringliteral">"Basic Printer Setup"</span>),
01228     <a class="code" href="group__intl__internal.html#ga6">N_</a>(<span class="stringliteral">"Type of media (plain paper, photo paper, etc.)"</span>),
01229     <a class="code" href="group__vars.html#gga132a7">STP_PARAMETER_TYPE_STRING_LIST</a>, <a class="code" href="group__vars.html#gga133a17">STP_PARAMETER_CLASS_FEATURE</a>,
01230     <a class="code" href="group__vars.html#gga134a21">STP_PARAMETER_LEVEL_BASIC</a>, 1, 1, -1, 1, 0
01231   },
01232   {
01233     <span class="stringliteral">"InputSlot"</span>, <a class="code" href="group__intl__internal.html#ga6">N_</a>(<span class="stringliteral">"Media Source"</span>), <a class="code" href="group__intl__internal.html#ga6">N_</a>(<span class="stringliteral">"Basic Printer Setup"</span>),
01234     <a class="code" href="group__intl__internal.html#ga6">N_</a>(<span class="stringliteral">"Source (input slot) of the media"</span>),
01235     <a class="code" href="group__vars.html#gga132a7">STP_PARAMETER_TYPE_STRING_LIST</a>, <a class="code" href="group__vars.html#gga133a17">STP_PARAMETER_CLASS_FEATURE</a>,
01236     <a class="code" href="group__vars.html#gga134a21">STP_PARAMETER_LEVEL_BASIC</a>, 1, 1, -1, 1, 0
01237   },
01238   {
01239     <span class="stringliteral">"Resolution"</span>, <a class="code" href="group__intl__internal.html#ga6">N_</a>(<span class="stringliteral">"Resolution"</span>), <a class="code" href="group__intl__internal.html#ga6">N_</a>(<span class="stringliteral">"Basic Printer Setup"</span>),
01240     <a class="code" href="group__intl__internal.html#ga6">N_</a>(<span class="stringliteral">"Resolution and quality of the print"</span>),
01241     <a class="code" href="group__vars.html#gga132a7">STP_PARAMETER_TYPE_STRING_LIST</a>, <a class="code" href="group__vars.html#gga133a17">STP_PARAMETER_CLASS_FEATURE</a>,
01242     <a class="code" href="group__vars.html#gga134a21">STP_PARAMETER_LEVEL_BASIC</a>, 1, 1, -1, 1, 0
01243   },
01244   {
01245     <span class="stringliteral">"InkType"</span>, <a class="code" href="group__intl__internal.html#ga6">N_</a>(<span class="stringliteral">"Ink Type"</span>), <a class="code" href="group__intl__internal.html#ga6">N_</a>(<span class="stringliteral">"Advanced Printer Setup"</span>),
01246     <a class="code" href="group__intl__internal.html#ga6">N_</a>(<span class="stringliteral">"Type of ink in the printer"</span>),
01247     <a class="code" href="group__vars.html#gga132a7">STP_PARAMETER_TYPE_STRING_LIST</a>, <a class="code" href="group__vars.html#gga133a17">STP_PARAMETER_CLASS_FEATURE</a>,
01248     <a class="code" href="group__vars.html#gga134a21">STP_PARAMETER_LEVEL_BASIC</a>, 1, 1, -1, 1, 0
01249   },
01250   {
01251     <span class="stringliteral">"InkChannels"</span>, <a class="code" href="group__intl__internal.html#ga6">N_</a>(<span class="stringliteral">"Ink Channels"</span>), <a class="code" href="group__intl__internal.html#ga6">N_</a>(<span class="stringliteral">"Advanced Printer Functionality"</span>),
01252     <a class="code" href="group__intl__internal.html#ga6">N_</a>(<span class="stringliteral">"Ink Channels"</span>),
01253     <a class="code" href="group__vars.html#gga132a8">STP_PARAMETER_TYPE_INT</a>, <a class="code" href="group__vars.html#gga133a17">STP_PARAMETER_CLASS_FEATURE</a>,
01254     <a class="code" href="group__vars.html#gga134a27">STP_PARAMETER_LEVEL_INTERNAL</a>, 0, 0, -1, 0, 0
01255   },
01256   {
01257     <span class="stringliteral">"PrintingMode"</span>, <a class="code" href="group__intl__internal.html#ga6">N_</a>(<span class="stringliteral">"Printing Mode"</span>), <a class="code" href="group__intl__internal.html#ga6">N_</a>(<span class="stringliteral">"Core Parameter"</span>),
01258     <a class="code" href="group__intl__internal.html#ga6">N_</a>(<span class="stringliteral">"Printing Output Mode"</span>),
01259     <a class="code" href="group__vars.html#gga132a7">STP_PARAMETER_TYPE_STRING_LIST</a>, <a class="code" href="group__vars.html#gga133a19">STP_PARAMETER_CLASS_CORE</a>,
01260     <a class="code" href="group__vars.html#gga134a21">STP_PARAMETER_LEVEL_BASIC</a>, 1, 1, -1, 1, 0
01261   },
01262 };
01263 
01264 <span class="keyword">static</span> <span class="keyword">const</span> <span class="keywordtype">int</span> <a class="code" href="print-canon_8c.html#a86">the_parameter_count</a> =
01265 <span class="keyword">sizeof</span>(<a class="code" href="print-canon_8c.html#a85">the_parameters</a>) / <span class="keyword">sizeof</span>(<span class="keyword">const</span> <a class="code" href="structstp__parameter__t.html">stp_parameter_t</a>);
01266 
<a name="l01267"></a><a class="code" href="print-canon_8c.html#a86">01267</a> <span class="keyword">typedef</span> <span class="keyword">struct</span>
01268 <span class="keyword"></span>{
01269   <span class="keyword">const</span> <a class="code" href="structstp__parameter__t.html">stp_parameter_t</a> param;
<a name="l01270"></a><a class="code" href="structfloat__param__t.html">01270</a>   <span class="keywordtype">double</span> min;
01271   <span class="keywordtype">double</span> <a class="code" href="print-lexmark_8c.html#a6">max</a>;
01272   <span class="keywordtype">double</span> defval;
01273   <span class="keywordtype">int</span> color_only;
01274 } <a class="code" href="structfloat__param__t.html">float_param_t</a>;
01275 
01276 <span class="keyword">static</span> <span class="keyword">const</span> <a class="code" href="structfloat__param__t.html">float_param_t</a> <a class="code" href="print-canon_8c.html#a87">float_parameters</a>[] =
01277 {
01278   {
<a name="l01279"></a><a class="code" href="print-canon_8c.html#a87">01279</a>     {
01280       <span class="stringliteral">"CyanDensity"</span>, <a class="code" href="group__intl__internal.html#ga6">N_</a>(<span class="stringliteral">"Cyan Balance"</span>), <a class="code" href="group__intl__internal.html#ga6">N_</a>(<span class="stringliteral">"Output Level Adjustment"</span>),
01281       <a class="code" href="group__intl__internal.html#ga6">N_</a>(<span class="stringliteral">"Adjust the cyan balance"</span>),
01282       <a class="code" href="group__vars.html#gga132a10">STP_PARAMETER_TYPE_DOUBLE</a>, <a class="code" href="group__vars.html#gga133a18">STP_PARAMETER_CLASS_OUTPUT</a>,
01283       <a class="code" href="group__vars.html#gga134a22">STP_PARAMETER_LEVEL_ADVANCED</a>, 0, 1, 1, 1, 0
01284     }, 0.0, 2.0, 1.0, 1
01285   },
01286   {
01287     {
01288       <span class="stringliteral">"MagentaDensity"</span>, <a class="code" href="group__intl__internal.html#ga6">N_</a>(<span class="stringliteral">"Magenta Balance"</span>), <a class="code" href="group__intl__internal.html#ga6">N_</a>(<span class="stringliteral">"Output Level Adjustment"</span>),
01289       <a class="code" href="group__intl__internal.html#ga6">N_</a>(<span class="stringliteral">"Adjust the magenta balance"</span>),
01290       <a class="code" href="group__vars.html#gga132a10">STP_PARAMETER_TYPE_DOUBLE</a>, <a class="code" href="group__vars.html#gga133a18">STP_PARAMETER_CLASS_OUTPUT</a>,
01291       <a class="code" href="group__vars.html#gga134a22">STP_PARAMETER_LEVEL_ADVANCED</a>, 0, 1, 2, 1, 0
01292     }, 0.0, 2.0, 1.0, 1
01293   },
01294   {
01295     {
01296       <span class="stringliteral">"YellowDensity"</span>, <a class="code" href="group__intl__internal.html#ga6">N_</a>(<span class="stringliteral">"Yellow Balance"</span>), <a class="code" href="group__intl__internal.html#ga6">N_</a>(<span class="stringliteral">"Output Level Adjustment"</span>),
01297       <a class="code" href="group__intl__internal.html#ga6">N_</a>(<span class="stringliteral">"Adjust the yellow balance"</span>),
01298       <a class="code" href="group__vars.html#gga132a10">STP_PARAMETER_TYPE_DOUBLE</a>, <a class="code" href="group__vars.html#gga133a18">STP_PARAMETER_CLASS_OUTPUT</a>,
01299       <a class="code" href="group__vars.html#gga134a22">STP_PARAMETER_LEVEL_ADVANCED</a>, 0, 1, 3, 1, 0
01300     }, 0.0, 2.0, 1.0, 1
01301   },
01302   {
01303     {
01304       <span class="stringliteral">"BlackDensity"</span>, <a class="code" href="group__intl__internal.html#ga6">N_</a>(<span class="stringliteral">"Black Balance"</span>), <a class="code" href="group__intl__internal.html#ga6">N_</a>(<span class="stringliteral">"Output Level Adjustment"</span>),
01305       <a class="code" href="group__intl__internal.html#ga6">N_</a>(<span class="stringliteral">"Adjust the black balance"</span>),
01306       <a class="code" href="group__vars.html#gga132a10">STP_PARAMETER_TYPE_DOUBLE</a>, <a class="code" href="group__vars.html#gga133a18">STP_PARAMETER_CLASS_OUTPUT</a>,
01307       <a class="code" href="group__vars.html#gga134a22">STP_PARAMETER_LEVEL_ADVANCED</a>, 0, 1, 0, 1, 0
01308     }, 0.0, 2.0, 1.0, 1
01309   },
01310   {
01311     {
01312       <span class="stringliteral">"LightCyanTransition"</span>, <a class="code" href="group__intl__internal.html#ga6">N_</a>(<span class="stringliteral">"Light Cyan Transition"</span>), <a class="code" href="group__intl__internal.html#ga6">N_</a>(<span class="stringliteral">"Advanced Ink Adjustment"</span>),
01313       <a class="code" href="group__intl__internal.html#ga6">N_</a>(<span class="stringliteral">"Light Cyan Transition"</span>),
01314       <a class="code" href="group__vars.html#gga132a10">STP_PARAMETER_TYPE_DOUBLE</a>, <a class="code" href="group__vars.html#gga133a18">STP_PARAMETER_CLASS_OUTPUT</a>,
01315       <a class="code" href="group__vars.html#gga134a26">STP_PARAMETER_LEVEL_ADVANCED4</a>, 0, 1, -1, 1, 0
01316     }, 0.0, 5.0, 1.0, 1
01317   },
01318   {
01319     {
01320       <span class="stringliteral">"LightMagentaTransition"</span>, <a class="code" href="group__intl__internal.html#ga6">N_</a>(<span class="stringliteral">"Light Magenta Transition"</span>), <a class="code" href="group__intl__internal.html#ga6">N_</a>(<span class="stringliteral">"Advanced Ink Adjustment"</span>),
01321       <a class="code" href="group__intl__internal.html#ga6">N_</a>(<span class="stringliteral">"Light Magenta Transition"</span>),
01322       <a class="code" href="group__vars.html#gga132a10">STP_PARAMETER_TYPE_DOUBLE</a>, <a class="code" href="group__vars.html#gga133a18">STP_PARAMETER_CLASS_OUTPUT</a>,
01323       <a class="code" href="group__vars.html#gga134a26">STP_PARAMETER_LEVEL_ADVANCED4</a>, 0, 1, -1, 1, 0
01324     }, 0.0, 5.0, 1.0, 1
01325   },
01326  {
01327     {
01328       <span class="stringliteral">"LightYellowTransition"</span>, <a class="code" href="group__intl__internal.html#ga6">N_</a>(<span class="stringliteral">"Light Yellow Transition"</span>), <a class="code" href="group__intl__internal.html#ga6">N_</a>(<span class="stringliteral">"Advanced Ink Adjustment"</span>),
01329       <a class="code" href="group__intl__internal.html#ga6">N_</a>(<span class="stringliteral">"Light Yellow Transition"</span>),
01330       <a class="code" href="group__vars.html#gga132a10">STP_PARAMETER_TYPE_DOUBLE</a>, <a class="code" href="group__vars.html#gga133a18">STP_PARAMETER_CLASS_OUTPUT</a>,
01331       <a class="code" href="group__vars.html#gga134a26">STP_PARAMETER_LEVEL_ADVANCED4</a>, 0, 1, -1, 1, 0
01332     }, 0.0, 5.0, 1.0, 1
01333   },
01334 };
01335 
01336 
01337 <span class="keyword">static</span> <span class="keyword">const</span> <span class="keywordtype">int</span> <a class="code" href="print-canon_8c.html#a88">float_parameter_count</a> =
01338 <span class="keyword">sizeof</span>(<a class="code" href="print-canon_8c.html#a87">float_parameters</a>) / <span class="keyword">sizeof</span>(<span class="keyword">const</span> <a class="code" href="structfloat__param__t.html">float_param_t</a>);
01339 
<a name="l01340"></a><a class="code" href="print-canon_8c.html#a88">01340</a> <span class="keyword">static</span> <span class="keyword">const</span> <a class="code" href="structpaper__t.html">paper_t</a> *
01341 <a class="code" href="print-lexmark_8c.html#a126">get_media_type</a>(<span class="keyword">const</span> <span class="keywordtype">char</span> *name)
01342 {
01343   <span class="keywordtype">int</span> i;
<a name="l01344"></a><a class="code" href="print-canon_8c.html#a106">01344</a>   <span class="keywordflow">if</span> (name)
01345     <span class="keywordflow">for</span> (i = 0; i &lt; <a class="code" href="print-canon_8c.html#a84">paper_type_count</a>; i++)
01346       {
01347         <span class="comment">/* translate paper_t.name */</span>
01348         <span class="keywordflow">if</span> (!strcmp(name, <a class="code" href="print-canon_8c.html#a83">canon_paper_list</a>[i].name))
01349           <span class="keywordflow">return</span> &amp;(<a class="code" href="print-canon_8c.html#a83">canon_paper_list</a>[i]);
01350       }
01351   <span class="keywordflow">return</span> NULL;
01352 }
01353 
01354 
01355 <span class="keyword">static</span> <span class="keyword">const</span> <a class="code" href="structcanon__caps.html">canon_cap_t</a> * <a class="code" href="print-canon_8c.html#a107">canon_get_model_capabilities</a>(<span class="keywordtype">int</span> model)
01356 {
01357   <span class="keywordtype">int</span> i;
<a name="l01358"></a><a class="code" href="print-canon_8c.html#a107">01358</a>   <span class="keywordtype">int</span> models= <span class="keyword">sizeof</span>(<a class="code" href="print-canon_8c.html#a80">canon_model_capabilities</a>) / <span class="keyword">sizeof</span>(<a class="code" href="structcanon__caps.html">canon_cap_t</a>);
01359   <span class="keywordflow">for</span> (i=0; i&lt;models; i++) {
01360     <span class="keywordflow">if</span> (<a class="code" href="print-canon_8c.html#a80">canon_model_capabilities</a>[i].<a class="code" href="structcanon__caps.html#o0">model</a> == model) {
01361       <span class="keywordflow">return</span> &amp;(<a class="code" href="print-canon_8c.html#a80">canon_model_capabilities</a>[i]);
01362     }
01363   }
01364   <a class="code" href="print-util_8c.html#a24">stp_deprintf</a>(STP_DBG_CANON,<span class="stringliteral">"canon: model %d not found in capabilities list.\n"</span>,model);
01365   <span class="keywordflow">return</span> &amp;(<a class="code" href="print-canon_8c.html#a80">canon_model_capabilities</a>[0]);
01366 }
01367 
01368 <span class="keyword">static</span> <span class="keywordtype">int</span>
01369 <a class="code" href="print-canon_8c.html#a108">canon_source_type</a>(<span class="keyword">const</span> <span class="keywordtype">char</span> *name, <span class="keyword">const</span> <a class="code" href="structcanon__caps.html">canon_cap_t</a> * caps)
01370 {
01371   <span class="comment">/* used internally: do not translate */</span>
<a name="l01372"></a><a class="code" href="print-canon_8c.html#a108">01372</a>   <span class="keywordflow">if</span> (name)
01373     {
01374       <span class="keywordflow">if</span> (!strcmp(name,<span class="stringliteral">"Auto"</span>))    <span class="keywordflow">return</span> 4;
01375       <span class="keywordflow">if</span> (!strcmp(name,<span class="stringliteral">"Manual"</span>))    <span class="keywordflow">return</span> 0;
01376       <span class="keywordflow">if</span> (!strcmp(name,<span class="stringliteral">"ManualNP"</span>)) <span class="keywordflow">return</span> 1;
01377     }
01378 
01379   <a class="code" href="print-util_8c.html#a24">stp_deprintf</a>(STP_DBG_CANON,<span class="stringliteral">"canon: Unknown source type '%s' - reverting to auto\n"</span>,name);
01380   <span class="keywordflow">return</span> 4;
01381 }
01382 
01383 <span class="keyword">static</span> <span class="keywordtype">int</span>
01384 <a class="code" href="print-canon_8c.html#a109">canon_printhead_type</a>(<span class="keyword">const</span> <span class="keywordtype">char</span> *name, <span class="keyword">const</span> <a class="code" href="structcanon__caps.html">canon_cap_t</a> * caps)
01385 {
01386   <span class="comment">/* used internally: do not translate */</span>
<a name="l01387"></a><a class="code" href="print-canon_8c.html#a109">01387</a>   <span class="keywordflow">if</span> (name)
01388     {
01389       <span class="keywordflow">if</span> (!strcmp(name,<span class="stringliteral">"Gray"</span>))             <span class="keywordflow">return</span> 0;
01390       <span class="keywordflow">if</span> (!strcmp(name,<span class="stringliteral">"RGB"</span>))             <span class="keywordflow">return</span> 1;
01391       <span class="keywordflow">if</span> (!strcmp(name,<span class="stringliteral">"CMYK"</span>))       <span class="keywordflow">return</span> 2;
01392       <span class="keywordflow">if</span> (!strcmp(name,<span class="stringliteral">"PhotoCMY"</span>))       <span class="keywordflow">return</span> 3;
01393       <span class="keywordflow">if</span> (!strcmp(name,<span class="stringliteral">"Photo"</span>))             <span class="keywordflow">return</span> 4;
01394       <span class="keywordflow">if</span> (!strcmp(name,<span class="stringliteral">"PhotoCMYK"</span>)) <span class="keywordflow">return</span> 5;
01395     }
01396   <span class="keywordflow">if</span> (name &amp;&amp; *name == 0) {
01397     <span class="keywordflow">if</span> (caps-&gt;<a class="code" href="structcanon__caps.html#o12">inks</a> &amp; <a class="code" href="print-canon_8c.html#a13">CANON_INK_CMYK</a>) <span class="keywordflow">return</span> 2;
01398     <span class="keywordflow">if</span> (caps-&gt;<a class="code" href="structcanon__caps.html#o12">inks</a> &amp; <a class="code" href="print-canon_8c.html#a12">CANON_INK_CMY</a>)  <span class="keywordflow">return</span> 1;
01399     <span class="keywordflow">if</span> (caps-&gt;<a class="code" href="structcanon__caps.html#o12">inks</a> &amp; <a class="code" href="print-canon_8c.html#a11">CANON_INK_K</a>)    <span class="keywordflow">return</span> 0;
01400   }
01401 
01402   <a class="code" href="print-util_8c.html#a24">stp_deprintf</a>(STP_DBG_CANON,<span class="stringliteral">"canon: Unknown head combo '%s' - reverting to black\n"</span>,name);
01403   <span class="keywordflow">return</span> 0;
01404 }
01405 
01406 <span class="keyword">static</span> <a class="code" href="print-canon_8c.html#a156">colormode_t</a>
01407 <a class="code" href="print-canon_8c.html#a110">canon_printhead_colors</a>(<span class="keyword">const</span> <span class="keywordtype">char</span> *name, <span class="keyword">const</span> <a class="code" href="structcanon__caps.html">canon_cap_t</a> * caps)
01408 {
01409   <span class="comment">/* used internally: do not translate */</span>
<a name="l01410"></a><a class="code" href="print-canon_8c.html#a110">01410</a>   <span class="keywordflow">if</span> (name)
01411     {
01412       <span class="keywordflow">if</span> (!strcmp(name,<span class="stringliteral">"Gray"</span>))             <span class="keywordflow">return</span> <a class="code" href="print-canon_8c.html#a156a94">COLOR_MONOCHROME</a>;
01413       <span class="keywordflow">if</span> (!strcmp(name,<span class="stringliteral">"RGB"</span>))             <span class="keywordflow">return</span> <a class="code" href="print-canon_8c.html#a156a95">COLOR_CMY</a>;
01414       <span class="keywordflow">if</span> (!strcmp(name,<span class="stringliteral">"CMYK"</span>))       <span class="keywordflow">return</span> <a class="code" href="print-canon_8c.html#a156a96">COLOR_CMYK</a>;
01415       <span class="keywordflow">if</span> (!strcmp(name,<span class="stringliteral">"PhotoCMY"</span>))       <span class="keywordflow">return</span> <a class="code" href="print-canon_8c.html#a156a97">COLOR_CCMMYK</a>;
01416       <span class="keywordflow">if</span> (!strcmp(name,<span class="stringliteral">"PhotoCMYK"</span>)) <span class="keywordflow">return</span> <a class="code" href="print-canon_8c.html#a156a98">COLOR_CCMMYYK</a>;
01417     }
01418 
01419   <span class="keywordflow">if</span> (name &amp;&amp; *name == 0) {
01420     <span class="keywordflow">if</span> (caps-&gt;<a class="code" href="structcanon__caps.html#o12">inks</a> &amp; <a class="code" href="print-canon_8c.html#a13">CANON_INK_CMYK</a>) <span class="keywordflow">return</span> <a class="code" href="print-canon_8c.html#a156a96">COLOR_CMYK</a>;
01421     <span class="keywordflow">if</span> (caps-&gt;<a class="code" href="structcanon__caps.html#o12">inks</a> &amp; <a class="code" href="print-canon_8c.html#a12">CANON_INK_CMY</a>)  <span class="keywordflow">return</span> <a class="code" href="print-canon_8c.html#a156a95">COLOR_CMY</a>;
01422     <span class="keywordflow">if</span> (caps-&gt;<a class="code" href="structcanon__caps.html#o12">inks</a> &amp; <a class="code" href="print-canon_8c.html#a11">CANON_INK_K</a>)    <span class="keywordflow">return</span> <a class="code" href="print-canon_8c.html#a156a94">COLOR_MONOCHROME</a>;
01423   }
01424 
01425   <a class="code" href="print-util_8c.html#a24">stp_deprintf</a>(STP_DBG_CANON,<span class="stringliteral">"canon: Unknown head combo '%s' - reverting to black\n"</span>,name);
01426   <span class="keywordflow">return</span> <a class="code" href="print-canon_8c.html#a156a94">COLOR_MONOCHROME</a>;
01427 }
01428 
01429 <span class="keyword">static</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">char</span>
01430 <a class="code" href="print-canon_8c.html#a111">canon_size_type</a>(<span class="keyword">const</span> <a class="code" href="structstp__vars.html">stp_vars_t</a> *v, <span class="keyword">const</span> <a class="code" href="structcanon__caps.html">canon_cap_t</a> * caps)
01431 {
01432   <span class="keyword">const</span> <a class="code" href="structstp__papersize__t.html">stp_papersize_t</a> *pp = <a class="code" href="group__papersize.html#ga12">stp_get_papersize_by_size</a>(<a class="code" href="group__vars.html#ga28">stp_get_page_height</a>(v),
<a name="l01433"></a><a class="code" href="print-canon_8c.html#a111">01433</a>                                                         <a class="code" href="group__vars.html#ga26">stp_get_page_width</a>(v));
01434   <span class="keywordflow">if</span> (pp)
01435     {
01436       <span class="keyword">const</span> <span class="keywordtype">char</span> *name = pp-&gt;<a class="code" href="structstp__papersize__t.html#o0">name</a>;
01437       <span class="comment">/* used internally: do not translate */</span>
01438       <span class="comment">/* built ins: */</span>
01439       <span class="keywordflow">if</span> (!strcmp(name,<span class="stringliteral">"A5"</span>))          <span class="keywordflow">return</span> 0x01;
01440       <span class="keywordflow">if</span> (!strcmp(name,<span class="stringliteral">"A4"</span>))          <span class="keywordflow">return</span> 0x03;
01441       <span class="keywordflow">if</span> (!strcmp(name,<span class="stringliteral">"B5"</span>))          <span class="keywordflow">return</span> 0x08;
01442       <span class="keywordflow">if</span> (!strcmp(name,<span class="stringliteral">"Letter"</span>))      <span class="keywordflow">return</span> 0x0d;
01443       <span class="keywordflow">if</span> (!strcmp(name,<span class="stringliteral">"Legal"</span>))       <span class="keywordflow">return</span> 0x0f;
01444       <span class="keywordflow">if</span> (!strcmp(name,<span class="stringliteral">"COM10"</span>)) <span class="keywordflow">return</span> 0x16;
01445       <span class="keywordflow">if</span> (!strcmp(name,<span class="stringliteral">"DL"</span>)) <span class="keywordflow">return</span> 0x17;
01446       <span class="keywordflow">if</span> (!strcmp(name,<span class="stringliteral">"LetterExtra"</span>))     <span class="keywordflow">return</span> 0x2a;
01447       <span class="keywordflow">if</span> (!strcmp(name,<span class="stringliteral">"A4Extra"</span>))         <span class="keywordflow">return</span> 0x2b;
01448       <span class="keywordflow">if</span> (!strcmp(name,<span class="stringliteral">"w288h144"</span>))   <span class="keywordflow">return</span> 0x2d;
01449       <span class="comment">/* custom */</span>
01450 
01451       <a class="code" href="print-util_8c.html#a24">stp_deprintf</a>(STP_DBG_CANON,<span class="stringliteral">"canon: Unknown paper size '%s' - using custom\n"</span>,name);
01452     } <span class="keywordflow">else</span> {
01453       <a class="code" href="print-util_8c.html#a24">stp_deprintf</a>(STP_DBG_CANON,<span class="stringliteral">"canon: Couldn't look up paper size %dx%d - "</span>
01454               <span class="stringliteral">"using custom\n"</span>,<a class="code" href="group__vars.html#ga28">stp_get_page_height</a>(v), <a class="code" href="group__vars.html#ga26">stp_get_page_width</a>(v));
01455     }
01456   <span class="keywordflow">return</span> 0;
01457 }
01458 
01459 <span class="preprocessor">#ifndef EXPERIMENTAL_STUFF</span>
01460 <span class="preprocessor"></span><span class="keyword">static</span> <span class="keywordtype">int</span> <a class="code" href="print-canon_8c.html#a112">canon_res_code</a>(<span class="keyword">const</span> <a class="code" href="structcanon__caps.html">canon_cap_t</a> * caps, <span class="keywordtype">int</span> xdpi, <span class="keywordtype">int</span> ydpi)
01461 {
01462   <span class="keywordtype">int</span> x, y, res= 0;
<a name="l01463"></a><a class="code" href="print-canon_8c.html#a112">01463</a> 
01464   <span class="keywordflow">for</span> (x=1; x&lt;6; x++) <span class="keywordflow">if</span> ((xdpi/caps-&gt;<a class="code" href="structcanon__caps.html#o4">base_res</a>) == (1&lt;&lt;(x-1))) res= (x&lt;&lt;4);
01465   <span class="keywordflow">for</span> (y=1; y&lt;6; y++) <span class="keywordflow">if</span> ((ydpi/caps-&gt;<a class="code" href="structcanon__caps.html#o4">base_res</a>) == (1&lt;&lt;(y-1))) res|= y;
01466 
01467   <span class="keywordflow">return</span> res;
01468 }
01469 <span class="preprocessor">#else</span>
01470 <span class="preprocessor"></span><span class="keyword">static</span> <span class="keyword">const</span> canon_variable_printmode_t *canon_printmode(<span class="keyword">const</span> <a class="code" href="structcanon__caps.html">canon_cap_t</a> * caps,
01471                                                          <span class="keywordtype">int</span> xdpi, <span class="keywordtype">int</span> ydpi,
01472                                                          <span class="keywordtype">int</span> bpp, <span class="keywordtype">int</span> head)
01473 {
01474   <span class="keyword">const</span> canon_variable_printmode_t *modes;
01475   <span class="keywordtype">int</span> modes_cnt;
01476   <span class="keywordtype">int</span> i;
01477   <span class="keywordflow">if</span> (!caps) <span class="keywordflow">return</span> 0;
01478   modes= caps-&gt;printmodes;
01479   modes_cnt= caps-&gt;printmodes_cnt;
01480   <span class="comment">/* search for the right printmode: */</span>
01481   <span class="keywordflow">for</span> (i=0; i&lt;modes_cnt; i++) {
01482     <span class="keywordflow">if</span> ((modes[i].xdpi== xdpi) &amp;&amp; (modes[i].ydpi== ydpi) &amp;&amp;
01483         (modes[i].bits== bpp) &amp;&amp; (modes[i].printhead== head))
01484       {
01485         <span class="keywordflow">return</span> &amp;(modes[i]);
01486       }
01487   }
01488   <span class="comment">/* nothing found -&gt; either return 0 or apply some policy to</span>
01489 <span class="comment">   * get a fallback printmode</span>
01490 <span class="comment">   */</span>
01491   <span class="keywordflow">if</span> (modes[0].xdpi) <span class="keywordflow">return</span> modes;
01492   <span class="keywordflow">return</span> 0;
01493 }
01494 <span class="preprocessor">#endif</span>
01495 <span class="preprocessor"></span>
01496 <span class="keyword">static</span> <span class="keywordtype">int</span>
01497 <a class="code" href="print-canon_8c.html#a113">canon_ink_type</a>(<span class="keyword">const</span> <a class="code" href="structcanon__caps.html">canon_cap_t</a> * caps, <span class="keywordtype">int</span> res_code)
01498 {
01499 <span class="preprocessor">#ifndef EXPERIMENTAL_STUFF</span>
<a name="l01500"></a><a class="code" href="print-canon_8c.html#a113">01500</a> <span class="preprocessor"></span>  <span class="keywordflow">switch</span> (res_code)
01501     {
01502     <span class="keywordflow">case</span> 0x11: <span class="keywordflow">return</span> caps-&gt;<a class="code" href="structcanon__caps.html#o16">dot_sizes</a>.<a class="code" href="structcanon__dot__sizes.html#o0">dot_r11</a>;
01503     <span class="keywordflow">case</span> 0x22: <span class="keywordflow">return</span> caps-&gt;<a class="code" href="structcanon__caps.html#o16">dot_sizes</a>.<a class="code" href="structcanon__dot__sizes.html#o1">dot_r22</a>;
01504     <span class="keywordflow">case</span> 0x33: <span class="keywordflow">return</span> caps-&gt;<a class="code" href="structcanon__caps.html#o16">dot_sizes</a>.<a class="code" href="structcanon__dot__sizes.html#o2">dot_r33</a>;
01505     <span class="keywordflow">case</span> 0x43: <span class="keywordflow">return</span> caps-&gt;<a class="code" href="structcanon__caps.html#o16">dot_sizes</a>.<a class="code" href="structcanon__dot__sizes.html#o3">dot_r43</a>;
01506     <span class="keywordflow">case</span> 0x44: <span class="keywordflow">return</span> caps-&gt;<a class="code" href="structcanon__caps.html#o16">dot_sizes</a>.<a class="code" href="structcanon__dot__sizes.html#o4">dot_r44</a>;
01507     <span class="keywordflow">case</span> 0x55: <span class="keywordflow">return</span> caps-&gt;<a class="code" href="structcanon__caps.html#o16">dot_sizes</a>.<a class="code" href="structcanon__dot__sizes.html#o5">dot_r55</a>;
01508     }
01509   <span class="keywordflow">return</span> -1;
01510 <span class="preprocessor">#else</span>
01511 <span class="preprocessor"></span>  <span class="keywordflow">return</span> -1;
01512 <span class="preprocessor">#endif</span>
01513 <span class="preprocessor"></span>}
01514 
01515 <span class="keyword">static</span> <span class="keyword">const</span> <span class="keywordtype">char</span> *
01516 <a class="code" href="print-canon_8c.html#a114">canon_lum_adjustment</a>(<span class="keywordtype">int</span> model)
01517 {
01518   <span class="keyword">const</span> <a class="code" href="structcanon__caps.html">canon_cap_t</a> * caps= <a class="code" href="print-canon_8c.html#a107">canon_get_model_capabilities</a>(model);
<a name="l01519"></a><a class="code" href="print-canon_8c.html#a114">01519</a>   <span class="keywordflow">return</span> (caps-&gt;<a class="code" href="structcanon__caps.html#o20">lum_adjustment</a>);
01520 }
01521 
01522 <span class="keyword">static</span> <span class="keyword">const</span> <span class="keywordtype">char</span> *
01523 <a class="code" href="print-canon_8c.html#a115">canon_hue_adjustment</a>(<span class="keywordtype">int</span> model)
01524 {
01525   <span class="keyword">const</span> <a class="code" href="structcanon__caps.html">canon_cap_t</a> * caps= <a class="code" href="print-canon_8c.html#a107">canon_get_model_capabilities</a>(model);
<a name="l01526"></a><a class="code" href="print-canon_8c.html#a115">01526</a>   <span class="keywordflow">return</span> (caps-&gt;<a class="code" href="structcanon__caps.html#o21">hue_adjustment</a>);
01527 }
01528 
01529 <span class="keyword">static</span> <span class="keyword">const</span> <span class="keywordtype">char</span> *
01530 <a class="code" href="print-canon_8c.html#a116">canon_sat_adjustment</a>(<span class="keywordtype">int</span> model)
01531 {
01532   <span class="keyword">const</span> <a class="code" href="structcanon__caps.html">canon_cap_t</a> * caps= <a class="code" href="print-canon_8c.html#a107">canon_get_model_capabilities</a>(model);
<a name="l01533"></a><a class="code" href="print-canon_8c.html#a116">01533</a>   <span class="keywordflow">return</span> (caps-&gt;<a class="code" href="structcanon__caps.html#o22">sat_adjustment</a>);
01534 }
01535 
01536 <span class="keyword">static</span> <span class="keywordtype">double</span>
01537 <a class="code" href="print-canon_8c.html#a117">canon_density</a>(<span class="keyword">const</span> <a class="code" href="structcanon__caps.html">canon_cap_t</a> * caps, <span class="keywordtype">int</span> res_code)
01538 {
01539 <span class="preprocessor">#ifndef EXPERIMENTAL_STUFF</span>
<a name="l01540"></a><a class="code" href="print-canon_8c.html#a117">01540</a> <span class="preprocessor"></span>  <span class="keywordflow">switch</span> (res_code)
01541     {
01542     <span class="keywordflow">case</span> 0x11: <span class="keywordflow">return</span> caps-&gt;<a class="code" href="structcanon__caps.html#o17">densities</a>.<a class="code" href="structcanon__densities.html#o0">d_r11</a>;
01543     <span class="keywordflow">case</span> 0x22: <span class="keywordflow">return</span> caps-&gt;<a class="code" href="structcanon__caps.html#o17">densities</a>.<a class="code" href="structcanon__densities.html#o1">d_r22</a>;
01544     <span class="keywordflow">case</span> 0x33: <span class="keywordflow">return</span> caps-&gt;<a class="code" href="structcanon__caps.html#o17">densities</a>.<a class="code" href="structcanon__densities.html#o2">d_r33</a>;
01545     <span class="keywordflow">case</span> 0x43: <span class="keywordflow">return</span> caps-&gt;<a class="code" href="structcanon__caps.html#o17">densities</a>.<a class="code" href="structcanon__densities.html#o3">d_r43</a>;
01546     <span class="keywordflow">case</span> 0x44: <span class="keywordflow">return</span> caps-&gt;<a class="code" href="structcanon__caps.html#o17">densities</a>.<a class="code" href="structcanon__densities.html#o4">d_r44</a>;
01547     <span class="keywordflow">case</span> 0x55: <span class="keywordflow">return</span> caps-&gt;<a class="code" href="structcanon__caps.html#o17">densities</a>.<a class="code" href="structcanon__densities.html#o5">d_r55</a>;
01548     <span class="keywordflow">default</span>:
01549       <a class="code" href="print-util_8c.html#a24">stp_deprintf</a>(<a class="code" href="group__util.html#ga37">STP_DBG_CANON</a>,<span class="stringliteral">"no such res_code 0x%x in density of model %d\n"</span>,
01550               res_code,caps-&gt;<a class="code" href="structcanon__caps.html#o0">model</a>);
01551       <span class="keywordflow">return</span> 0.2;
01552     }
01553 <span class="preprocessor">#else</span>
01554 <span class="preprocessor"></span>  <span class="keywordflow">return</span> 0.2;
01555 <span class="preprocessor">#endif</span>
01556 <span class="preprocessor"></span>}
01557 
01558 <span class="keyword">static</span> <span class="keyword">const</span> <a class="code" href="structcanon__variable__inkset.html">canon_variable_inkset_t</a> *
01559 <a class="code" href="print-canon_8c.html#a118">canon_inks</a>(<span class="keyword">const</span> <a class="code" href="structcanon__caps.html">canon_cap_t</a> * caps, <span class="keywordtype">int</span> res_code, <span class="keywordtype">int</span> colors, <span class="keywordtype">int</span> bits)
01560 {
01561 <span class="preprocessor">#ifndef EXPERIMENTAL_STUFF</span>
<a name="l01562"></a><a class="code" href="print-canon_8c.html#a118">01562</a> <span class="preprocessor"></span>  <span class="keyword">const</span> <a class="code" href="structcanon__variable__inklist.html">canon_variable_inklist_t</a> *inks = caps-&gt;<a class="code" href="structcanon__caps.html#o18">inxs</a>;
01563   <span class="keywordtype">int</span> i;
01564 
01565   <span class="keywordflow">if</span> (!inks)
01566     <span class="keywordflow">return</span> NULL;
01567 
01568   <span class="keywordflow">for</span> (i=0; i&lt;caps-&gt;<a class="code" href="structcanon__caps.html#o19">inxs_cnt</a>; i++) {
01569       <a class="code" href="print-util_8c.html#a24">stp_deprintf</a>(<a class="code" href="group__util.html#ga37">STP_DBG_CANON</a>,<span class="stringliteral">"hmm, trying ink for resolution code "</span>
01570               <span class="stringliteral">"%x, %d bits, %d colors\n"</span>,res_code,inks[i].bits,inks[i].colors);
01571     <span class="keywordflow">if</span> ((inks[i].<a class="code" href="structcanon__variable__inklist.html#o0">bits</a>==bits) &amp;&amp; (inks[i].<a class="code" href="structcanon__variable__inklist.html#o1">colors</a>==colors)) {
01572       <a class="code" href="print-util_8c.html#a24">stp_deprintf</a>(<a class="code" href="group__util.html#ga37">STP_DBG_CANON</a>,<span class="stringliteral">"wow, found ink for resolution code "</span>
01573               <span class="stringliteral">"%x, %d bits, %d colors\n"</span>,res_code,bits,colors);
01574       <span class="keywordflow">switch</span> (res_code)
01575         {
01576         <span class="keywordflow">case</span> 0x11: <span class="keywordflow">return</span> inks[i].<a class="code" href="structcanon__variable__inklist.html#o2">r11</a>;
01577         <span class="keywordflow">case</span> 0x22: <span class="keywordflow">return</span> inks[i].<a class="code" href="structcanon__variable__inklist.html#o3">r22</a>;
01578         <span class="keywordflow">case</span> 0x33: <span class="keywordflow">return</span> inks[i].<a class="code" href="structcanon__variable__inklist.html#o4">r33</a>;
01579         <span class="keywordflow">case</span> 0x43: <span class="keywordflow">return</span> inks[i].<a class="code" href="structcanon__variable__inklist.html#o5">r43</a>;
01580         <span class="keywordflow">case</span> 0x44: <span class="keywordflow">return</span> inks[i].<a class="code" href="structcanon__variable__inklist.html#o6">r44</a>;
01581         <span class="keywordflow">case</span> 0x55: <span class="keywordflow">return</span> inks[i].<a class="code" href="structcanon__variable__inklist.html#o7">r55</a>;
01582         }
01583     }
01584   }
01585   <a class="code" href="print-util_8c.html#a24">stp_deprintf</a>(STP_DBG_CANON,<span class="stringliteral">"ooo, found no ink for resolution code "</span>
01586           <span class="stringliteral">"%x, %d bits, %d colors in all %d defs!\n"</span>,
01587           res_code,bits,colors,caps-&gt;<a class="code" href="structcanon__caps.html#o19">inxs_cnt</a>);
01588   <span class="keywordflow">return</span> NULL;
01589 <span class="preprocessor">#else</span>
01590 <span class="preprocessor"></span>  <span class="keywordflow">return</span> NULL;
01591 <span class="preprocessor">#endif</span>
01592 <span class="preprocessor"></span>}
01593 
01594 <span class="keyword">static</span> <span class="keywordtype">void</span>
01595 <a class="code" href="print-canon_8c.html#a119">canon_describe_resolution</a>(<span class="keyword">const</span> <a class="code" href="structstp__vars.html">stp_vars_t</a> *v, <span class="keywordtype">int</span> *x, <span class="keywordtype">int</span> *y)
01596 {
01597   <span class="keyword">const</span> <span class="keywordtype">char</span> *resolution = <a class="code" href="group__vars.html#ga36">stp_get_string_parameter</a>(v, <span class="stringliteral">"Resolution"</span>);
<a name="l01598"></a><a class="code" href="print-canon_8c.html#a119">01598</a>   <span class="keyword">const</span> <a class="code" href="structcanon__res__t.html">canon_res_t</a> *res = <a class="code" href="print-canon_8c.html#a81">canon_resolutions</a>;
01599   <span class="keywordflow">while</span> (res-&gt;<a class="code" href="structcanon__res__t.html#o0">x</a> &gt; 0)
01600     {
01601       <span class="keywordflow">if</span> (strcmp(resolution, res-&gt;<a class="code" href="structcanon__res__t.html#o2">name</a>) == 0 ||
01602           strcmp(resolution, res-&gt;<a class="code" href="structcanon__res__t.html#o4">name_dmt</a>) == 0)
01603         {
01604           *x = res-&gt;<a class="code" href="structcanon__res__t.html#o0">x</a>;
01605           *y = res-&gt;<a class="code" href="structcanon__res__t.html#o1">y</a>;
01606           <span class="keywordflow">return</span>;
01607         }
01608       res++;
01609     }
01610   *x = -1;
01611   *y = -1;
01612 }
01613 
01614 <span class="keyword">static</span> <span class="keyword">const</span> <span class="keywordtype">char</span> *
01615 <a class="code" href="print-canon_8c.html#a120">canon_describe_output</a>(<span class="keyword">const</span> <a class="code" href="structstp__vars.html">stp_vars_t</a> *v)
01616 {
01617   <span class="keywordtype">int</span> model = <a class="code" href="group__printer.html#ga23">stp_get_model_id</a>(v);
<a name="l01618"></a><a class="code" href="print-canon_8c.html#a120">01618</a>   <span class="keyword">const</span> <a class="code" href="structcanon__caps.html">canon_cap_t</a> *caps = <a class="code" href="print-canon_8c.html#a107">canon_get_model_capabilities</a>(model);
01619   <span class="keyword">const</span> <span class="keywordtype">char</span> *print_mode = <a class="code" href="group__vars.html#ga36">stp_get_string_parameter</a>(v, <span class="stringliteral">"PrintingMode"</span>);
01620   <span class="keyword">const</span> <span class="keywordtype">char</span> *ink_type = <a class="code" href="group__vars.html#ga36">stp_get_string_parameter</a>(v, <span class="stringliteral">"InkType"</span>);
01621   <a class="code" href="print-canon_8c.html#a156">colormode_t</a> colormode = <a class="code" href="print-canon_8c.html#a110">canon_printhead_colors</a>(ink_type,caps);
01622   <span class="keywordtype">int</span> printhead= <a class="code" href="print-canon_8c.html#a109">canon_printhead_type</a>(ink_type,caps);
01623 
01624   <span class="keywordflow">if</span> ((print_mode &amp;&amp; strcmp(print_mode, <span class="stringliteral">"BW"</span>) == 0) ||
01625       printhead == 0 || caps-&gt;<a class="code" href="structcanon__caps.html#o12">inks</a> == <a class="code" href="print-canon_8c.html#a11">CANON_INK_K</a>)
01626     colormode = <a class="code" href="print-canon_8c.html#a156a94">COLOR_MONOCHROME</a>;
01627 
01628   <span class="keywordflow">switch</span> (colormode)
01629     {
01630     <span class="keywordflow">case</span> <a class="code" href="print-canon_8c.html#a156a95">COLOR_CMY</a>:
01631       <span class="keywordflow">return</span> <span class="stringliteral">"CMY"</span>;
01632     <span class="keywordflow">case</span> <a class="code" href="print-canon_8c.html#a156a96">COLOR_CMYK</a>:
01633       <span class="keywordflow">return</span> <span class="stringliteral">"CMYK"</span>;
01634     <span class="keywordflow">case</span> <a class="code" href="print-canon_8c.html#a156a94">COLOR_MONOCHROME</a>:
01635     <span class="keywordflow">default</span>:
01636       <span class="keywordflow">return</span> <span class="stringliteral">"Grayscale"</span>;
01637     }
01638 }
01639 
01640 <span class="keyword">static</span> <span class="keyword">const</span> <a class="code" href="structstp__param__string__t.html">stp_param_string_t</a> <a class="code" href="print-canon_8c.html#a89">media_sources</a>[] =
01641               {
01642                 { <span class="stringliteral">"Auto"</span>,       <a class="code" href="group__intl__internal.html#ga6">N_</a> (<span class="stringliteral">"Auto Sheet Feeder"</span>) },
<a name="l01643"></a><a class="code" href="print-canon_8c.html#a89">01643</a>                 { <span class="stringliteral">"Manual"</span>,     <a class="code" href="group__intl__internal.html#ga6">N_</a> (<span class="stringliteral">"Manual with Pause"</span>) },
01644                 { <span class="stringliteral">"ManualNP"</span>,   <a class="code" href="group__intl__internal.html#ga6">N_</a> (<span class="stringliteral">"Manual without Pause"</span>) }
01645               };
01646 
01647 
01648 <span class="comment">/*</span>
01649 <span class="comment"> * 'canon_parameters()' - Return the parameter values for the given parameter.</span>
01650 <span class="comment"> */</span>
01651 
01652 <span class="keyword">static</span> <a class="code" href="group__vars.html#ga1">stp_parameter_list_t</a>
01653 <a class="code" href="print-canon_8c.html#a121">canon_list_parameters</a>(<span class="keyword">const</span> <a class="code" href="structstp__vars.html">stp_vars_t</a> *v)
01654 {
01655   <a class="code" href="group__vars.html#ga1">stp_parameter_list_t</a> *ret = <a class="code" href="group__vars.html#ga43">stp_parameter_list_create</a>();
<a name="l01656"></a><a class="code" href="print-canon_8c.html#a121">01656</a>   <span class="keywordtype">int</span> i;
01657   <span class="keywordflow">for</span> (i = 0; i &lt; <a class="code" href="print-canon_8c.html#a86">the_parameter_count</a>; i++)
01658     <a class="code" href="group__vars.html#ga82">stp_parameter_list_add_param</a>(ret, &amp;(the_parameters[i]));
01659   <span class="keywordflow">for</span> (i = 0; i &lt; <a class="code" href="print-canon_8c.html#a88">float_parameter_count</a>; i++)
01660     <a class="code" href="group__vars.html#ga82">stp_parameter_list_add_param</a>(ret, &amp;(float_parameters[i].param));
01661   <span class="keywordflow">return</span> ret;
01662 }
01663 
01664 <span class="keyword">static</span> <span class="keywordtype">void</span>
01665 <a class="code" href="print-canon_8c.html#a122">canon_parameters</a>(<span class="keyword">const</span> <a class="code" href="structstp__vars.html">stp_vars_t</a> *v, <span class="keyword">const</span> <span class="keywordtype">char</span> *name,
01666                  <a class="code" href="structstp__parameter__t.html">stp_parameter_t</a> *description)
01667 {
<a name="l01668"></a><a class="code" href="print-canon_8c.html#a122">01668</a>   <span class="keywordtype">int</span>           i;
01669 
01670   <span class="keyword">const</span> <a class="code" href="structcanon__caps.html">canon_cap_t</a> * caps=
01671     <a class="code" href="print-canon_8c.html#a107">canon_get_model_capabilities</a>(<a class="code" href="group__printer.html#ga23">stp_get_model_id</a>(v));
01672   description-&gt;<a class="code" href="structstp__parameter__t.html#o4">p_type</a> = <a class="code" href="group__vars.html#gga132a16">STP_PARAMETER_TYPE_INVALID</a>;
01673 
01674   <span class="keywordflow">if</span> (name == NULL)
01675     <span class="keywordflow">return</span>;
01676 
01677   <span class="keywordflow">for</span> (i = 0; i &lt; <a class="code" href="print-canon_8c.html#a88">float_parameter_count</a>; i++)
01678     <span class="keywordflow">if</span> (strcmp(name, float_parameters[i].param.name) == 0)
01679       {
01680         <a class="code" href="group__vars.html#ga75">stp_fill_parameter_settings</a>(description,
01681                                      &amp;(float_parameters[i].param));
01682         description-&gt;<a class="code" href="structstp__parameter__t.html#o26">deflt</a>.dbl = <a class="code" href="print-canon_8c.html#a87">float_parameters</a>[i].<a class="code" href="structfloat__param__t.html#o3">defval</a>;
01683         description-&gt;<a class="code" href="structstp__parameter__t.html#o18">bounds</a>.dbl.upper = <a class="code" href="print-canon_8c.html#a87">float_parameters</a>[i].<a class="code" href="structfloat__param__t.html#o2">max</a>;
01684         description-&gt;<a class="code" href="structstp__parameter__t.html#o18">bounds</a>.dbl.lower = <a class="code" href="print-canon_8c.html#a87">float_parameters</a>[i].<a class="code" href="structfloat__param__t.html#o1">min</a>;
01685         <span class="keywordflow">return</span>;
01686       }
01687 
01688   <span class="keywordflow">for</span> (i = 0; i &lt; <a class="code" href="print-canon_8c.html#a86">the_parameter_count</a>; i++)
01689     <span class="keywordflow">if</span> (strcmp(name, the_parameters[i].name) == 0)
01690       {
01691         <a class="code" href="group__vars.html#ga75">stp_fill_parameter_settings</a>(description, &amp;(the_parameters[i]));
01692         <span class="keywordflow">break</span>;
01693       }
01694   <span class="keywordflow">if</span> (strcmp(name, <span class="stringliteral">"PageSize"</span>) == 0)
01695   {
01696     <span class="keywordtype">int</span> height_limit, width_limit;
01697     <span class="keywordtype">int</span> papersizes = <a class="code" href="group__papersize.html#ga0">stp_known_papersizes</a>();
01698     description-&gt;<a class="code" href="structstp__parameter__t.html#o18">bounds</a>.str = <a class="code" href="string-list_8h.html#a1">stp_string_list_create</a>();
01699 
01700     width_limit = caps-&gt;<a class="code" href="structcanon__caps.html#o2">max_width</a>;
01701     height_limit = caps-&gt;<a class="code" href="structcanon__caps.html#o3">max_height</a>;
01702 
01703     <span class="keywordflow">for</span> (i = 0; i &lt; papersizes; i++) {
01704       <span class="keyword">const</span> <a class="code" href="structstp__papersize__t.html">stp_papersize_t</a> *pt = <a class="code" href="group__papersize.html#ga10">stp_get_papersize_by_index</a>(i);
01705       <span class="keywordflow">if</span> (strlen(pt-&gt;<a class="code" href="structstp__papersize__t.html#o0">name</a>) &gt; 0 &amp;&amp;
01706           pt-&gt;<a class="code" href="structstp__papersize__t.html#o3">width</a> &lt;= width_limit &amp;&amp; pt-&gt;<a class="code" href="structstp__papersize__t.html#o4">height</a> &lt;= height_limit)
01707         {
01708           <span class="keywordflow">if</span> (<a class="code" href="string-list_8c.html#a8">stp_string_list_count</a>(description-&gt;<a class="code" href="structstp__parameter__t.html#o18">bounds</a>.str) == 0)
01709             description-&gt;<a class="code" href="structstp__parameter__t.html#o26">deflt</a>.str = pt-&gt;<a class="code" href="structstp__papersize__t.html#o0">name</a>;
01710           <a class="code" href="string-list_8c.html#a11">stp_string_list_add_string</a>(description-&gt;<a class="code" href="structstp__parameter__t.html#o18">bounds</a>.str,
01711                                      pt-&gt;<a class="code" href="structstp__papersize__t.html#o0">name</a>, pt-&gt;<a class="code" href="structstp__papersize__t.html#o1">text</a>);
01712         }
01713     }
01714   }
01715   <span class="keywordflow">else</span> <span class="keywordflow">if</span> (strcmp(name, <span class="stringliteral">"Resolution"</span>) == 0)
01716   {
01717     <span class="keywordtype">int</span> x,y;
01718     <span class="keywordtype">int</span> t;
01719     description-&gt;<a class="code" href="structstp__parameter__t.html#o18">bounds</a>.str= <a class="code" href="string-list_8h.html#a1">stp_string_list_create</a>();
01720     description-&gt;<a class="code" href="structstp__parameter__t.html#o26">deflt</a>.str = NULL;
01721 
01722     <span class="keywordflow">for</span> (x=1; x&lt;6; x++) {
01723       <span class="keywordflow">for</span> (y=x-1; y&lt;x+1; y++) {
01724         <span class="keywordflow">if</span> ((t= <a class="code" href="print-canon_8c.html#a113">canon_ink_type</a>(caps,(x&lt;&lt;4)|y)) &gt; -1) {
01725           <span class="keywordtype">int</span> xx = (1&lt;&lt;x)/2*caps-&gt;<a class="code" href="structcanon__caps.html#o4">base_res</a>;
01726           <span class="keywordtype">int</span> yy = (1&lt;&lt;y)/2*caps-&gt;<a class="code" href="structcanon__caps.html#o4">base_res</a>;
01727           <span class="keyword">const</span> <a class="code" href="structcanon__res__t.html">canon_res_t</a> *res = <a class="code" href="print-canon_8c.html#a81">canon_resolutions</a>;
01728           <span class="keywordflow">while</span> (res-&gt;<a class="code" href="structcanon__res__t.html#o0">x</a> &gt; 0) {
01729             <span class="keywordflow">if</span> (xx == res-&gt;<a class="code" href="structcanon__res__t.html#o0">x</a> &amp;&amp; yy == res-&gt;<a class="code" href="structcanon__res__t.html#o1">y</a>) {
01730               <a class="code" href="string-list_8c.html#a11">stp_string_list_add_string</a>(description-&gt;<a class="code" href="structstp__parameter__t.html#o18">bounds</a>.str,
01731                                         res-&gt;<a class="code" href="structcanon__res__t.html#o2">name</a>, <a class="code" href="group__intl__internal.html#ga5">_</a>(res-&gt;<a class="code" href="structcanon__res__t.html#o3">text</a>));
01732               <a class="code" href="print-util_8c.html#a24">stp_deprintf</a>(STP_DBG_CANON,<span class="stringliteral">"supports mode '%s'\n"</span>,
01733                            res-&gt;<a class="code" href="structcanon__res__t.html#o2">name</a>);
01734               <span class="keywordflow">if</span> (xx &gt;= 300 &amp;&amp; yy &gt;= 300 &amp;&amp; description-&gt;<a class="code" href="structstp__parameter__t.html#o26">deflt</a>.str == NULL)
01735                 description-&gt;<a class="code" href="structstp__parameter__t.html#o26">deflt</a>.str = res-&gt;<a class="code" href="structcanon__res__t.html#o2">name</a>;
01736               <span class="keywordflow">if</span> (t == 1) {
01737                 <a class="code" href="string-list_8c.html#a11">stp_string_list_add_string</a>(description-&gt;<a class="code" href="structstp__parameter__t.html#o18">bounds</a>.str,
01738                                           res-&gt;<a class="code" href="structcanon__res__t.html#o4">name_dmt</a>, <a class="code" href="group__intl__internal.html#ga5">_</a>(res-&gt;<a class="code" href="structcanon__res__t.html#o5">text_dmt</a>));
01739                 <a class="code" href="print-util_8c.html#a24">stp_deprintf</a>(STP_DBG_CANON,<span class="stringliteral">"supports mode '%s'\n"</span>,
01740                              res-&gt;<a class="code" href="structcanon__res__t.html#o4">name_dmt</a>);
01741               }
01742               <span class="keywordflow">break</span>;
01743             }
01744             res++;
01745           }
01746         }
01747       }
01748     }
01749   }
01750   <span class="keywordflow">else</span> <span class="keywordflow">if</span> (strcmp(name, <span class="stringliteral">"InkType"</span>) == 0)
01751   {
01752     description-&gt;<a class="code" href="structstp__parameter__t.html#o18">bounds</a>.str= <a class="code" href="string-list_8h.html#a1">stp_string_list_create</a>();
01753     <span class="comment">/* used internally: do not translate */</span>
01754     <span class="keywordflow">if</span> ((caps-&gt;<a class="code" href="structcanon__caps.html#o12">inks</a> &amp; <a class="code" href="print-canon_8c.html#a11">CANON_INK_K</a>))
01755       <a class="code" href="string-list_8c.html#a11">stp_string_list_add_string</a>(description-&gt;<a class="code" href="structstp__parameter__t.html#o18">bounds</a>.str,
01756                                <span class="stringliteral">"Gray"</span>, <a class="code" href="group__intl__internal.html#ga5">_</a>(<span class="stringliteral">"Black"</span>));
01757     <span class="keywordflow">if</span> ((caps-&gt;<a class="code" href="structcanon__caps.html#o12">inks</a> &amp; <a class="code" href="print-canon_8c.html#a12">CANON_INK_CMY</a>))
01758       <a class="code" href="string-list_8c.html#a11">stp_string_list_add_string</a>(description-&gt;<a class="code" href="structstp__parameter__t.html#o18">bounds</a>.str,
01759                                <span class="stringliteral">"RGB"</span>, <a class="code" href="group__intl__internal.html#ga5">_</a>(<span class="stringliteral">"CMY Color"</span>));
01760     <span class="keywordflow">if</span> ((caps-&gt;<a class="code" href="structcanon__caps.html#o12">inks</a> &amp; <a class="code" href="print-canon_8c.html#a13">CANON_INK_CMYK</a>))
01761       <a class="code" href="string-list_8c.html#a11">stp_string_list_add_string</a>(description-&gt;<a class="code" href="structstp__parameter__t.html#o18">bounds</a>.str,
01762                                <span class="stringliteral">"CMYK"</span>, <a class="code" href="group__intl__internal.html#ga5">_</a>(<span class="stringliteral">"CMYK Color"</span>));
01763     <span class="keywordflow">if</span> ((caps-&gt;<a class="code" href="structcanon__caps.html#o12">inks</a> &amp; <a class="code" href="print-canon_8c.html#a14">CANON_INK_CcMmYK</a>))
01764       <a class="code" href="string-list_8c.html#a11">stp_string_list_add_string</a>(description-&gt;<a class="code" href="structstp__parameter__t.html#o18">bounds</a>.str,
01765                                <span class="stringliteral">"PhotoCMY"</span>, <a class="code" href="group__intl__internal.html#ga5">_</a>(<span class="stringliteral">"Photo CcMmY Color"</span>));
01766     <span class="keywordflow">if</span> ((caps-&gt;<a class="code" href="structcanon__caps.html#o12">inks</a> &amp; <a class="code" href="print-canon_8c.html#a15">CANON_INK_CcMmYyK</a>))
01767       <a class="code" href="string-list_8c.html#a11">stp_string_list_add_string</a>(description-&gt;<a class="code" href="structstp__parameter__t.html#o18">bounds</a>.str,
01768                                <span class="stringliteral">"PhotoCMYK"</span>, <a class="code" href="group__intl__internal.html#ga5">_</a>(<span class="stringliteral">"Photo CcMmYK Color"</span>));
01769     description-&gt;<a class="code" href="structstp__parameter__t.html#o26">deflt</a>.str =
01770       <a class="code" href="string-list_8c.html#a6">stp_string_list_param</a>(description-&gt;<a class="code" href="structstp__parameter__t.html#o18">bounds</a>.str, 0)-&gt;<a class="code" href="structstp__param__string__t.html#o0">name</a>;
01771   }
01772   <span class="keywordflow">else</span> <span class="keywordflow">if</span> (strcmp(name, <span class="stringliteral">"InkChannels"</span>) == 0)
01773     {
01774       <span class="keywordflow">if</span> (caps-&gt;<a class="code" href="structcanon__caps.html#o12">inks</a> &amp; <a class="code" href="print-canon_8c.html#a15">CANON_INK_CcMmYyK</a>)
01775         description-&gt;<a class="code" href="structstp__parameter__t.html#o26">deflt</a>.integer = 7;
01776       <span class="keywordflow">else</span> <span class="keywordflow">if</span> (caps-&gt;<a class="code" href="structcanon__caps.html#o12">inks</a> &amp; <a class="code" href="print-canon_8c.html#a14">CANON_INK_CcMmYK</a>)
01777         description-&gt;<a class="code" href="structstp__parameter__t.html#o26">deflt</a>.integer = 6;
01778       <span class="keywordflow">else</span> <span class="keywordflow">if</span> (caps-&gt;<a class="code" href="structcanon__caps.html#o12">inks</a> &amp; <a class="code" href="print-canon_8c.html#a13">CANON_INK_CMYK</a>)
01779         description-&gt;<a class="code" href="structstp__parameter__t.html#o26">deflt</a>.integer = 4;
01780       <span class="keywordflow">else</span> <span class="keywordflow">if</span> (caps-&gt;<a class="code" href="structcanon__caps.html#o12">inks</a> &amp; <a class="code" href="print-canon_8c.html#a12">CANON_INK_CMY</a>)
01781         description-&gt;<a class="code" href="structstp__parameter__t.html#o26">deflt</a>.integer = 3;
01782       <span class="keywordflow">else</span>
01783         description-&gt;<a class="code" href="structstp__parameter__t.html#o26">deflt</a>.integer = 1;
01784       description-&gt;<a class="code" href="structstp__parameter__t.html#o18">bounds</a>.integer.lower = -1;
01785       description-&gt;<a class="code" href="structstp__parameter__t.html#o18">bounds</a>.integer.upper = -1;
01786     }
01787   <span class="keywordflow">else</span> <span class="keywordflow">if</span> (strcmp(name, <span class="stringliteral">"MediaType"</span>) == 0)
01788   {
01789     <span class="keywordtype">int</span> count = <span class="keyword">sizeof</span>(<a class="code" href="print-canon_8c.html#a83">canon_paper_list</a>) / <span class="keyword">sizeof</span>(<a class="code" href="print-canon_8c.html#a83">canon_paper_list</a>[0]);
01790     description-&gt;<a class="code" href="structstp__parameter__t.html#o18">bounds</a>.str= <a class="code" href="string-list_8h.html#a1">stp_string_list_create</a>();
01791     description-&gt;<a class="code" href="structstp__parameter__t.html#o26">deflt</a>.str= <a class="code" href="print-canon_8c.html#a83">canon_paper_list</a>[0].<a class="code" href="structpaper__t.html#o0">name</a>;
01792 
01793     <span class="keywordflow">for</span> (i = 0; i &lt; count; i ++)
01794       <a class="code" href="string-list_8c.html#a11">stp_string_list_add_string</a>(description-&gt;<a class="code" href="structstp__parameter__t.html#o18">bounds</a>.str,
01795                                 canon_paper_list[i].name,
01796                                 <a class="code" href="group__intl__internal.html#ga5">_</a>(canon_paper_list[i].text));
01797   }
01798   <span class="keywordflow">else</span> <span class="keywordflow">if</span> (strcmp(name, <span class="stringliteral">"InputSlot"</span>) == 0)
01799   {
01800     <span class="keywordtype">int</span> count = 3;
01801     description-&gt;<a class="code" href="structstp__parameter__t.html#o18">bounds</a>.str= <a class="code" href="string-list_8h.html#a1">stp_string_list_create</a>();
01802     description-&gt;<a class="code" href="structstp__parameter__t.html#o26">deflt</a>.str= <a class="code" href="print-canon_8c.html#a89">media_sources</a>[0].<a class="code" href="structstp__param__string__t.html#o0">name</a>;
01803     <span class="keywordflow">for</span> (i = 0; i &lt; count; i ++)
01804       <a class="code" href="string-list_8c.html#a11">stp_string_list_add_string</a>(description-&gt;<a class="code" href="structstp__parameter__t.html#o18">bounds</a>.str,
01805                                 media_sources[i].name,
01806                                 <a class="code" href="group__intl__internal.html#ga5">_</a>(media_sources[i].text));
01807   }
01808   <span class="keywordflow">else</span> <span class="keywordflow">if</span> (strcmp(name, <span class="stringliteral">"PrintingMode"</span>) == 0)
01809   {
01810     description-&gt;<a class="code" href="structstp__parameter__t.html#o18">bounds</a>.str = <a class="code" href="string-list_8h.html#a1">stp_string_list_create</a>();
01811     <a class="code" href="string-list_8h.html#a7">stp_string_list_add_string</a>
01812       (description-&gt;<a class="code" href="structstp__parameter__t.html#o18">bounds</a>.str, <span class="stringliteral">"Color"</span>, <a class="code" href="group__intl__internal.html#ga5">_</a>(<span class="stringliteral">"Color"</span>));
01813     <a class="code" href="string-list_8h.html#a7">stp_string_list_add_string</a>
01814       (description-&gt;<a class="code" href="structstp__parameter__t.html#o18">bounds</a>.str, <span class="stringliteral">"BW"</span>, <a class="code" href="group__intl__internal.html#ga5">_</a>(<span class="stringliteral">"Black and White"</span>));
01815     description-&gt;<a class="code" href="structstp__parameter__t.html#o26">deflt</a>.str =
01816       <a class="code" href="string-list_8c.html#a6">stp_string_list_param</a>(description-&gt;<a class="code" href="structstp__parameter__t.html#o18">bounds</a>.str, 0)-&gt;<a class="code" href="structstp__param__string__t.html#o0">name</a>;
01817   }
01818 }
01819 
01820 
01821 <span class="comment">/*</span>
01822 <span class="comment"> * 'canon_imageable_area()' - Return the imageable area of the page.</span>
01823 <span class="comment"> */</span>
01824 
01825 <span class="keyword">static</span> <span class="keywordtype">void</span>
01826 <a class="code" href="print-pcl_8c.html#a135">internal_imageable_area</a>(<span class="keyword">const</span> <a class="code" href="structstp__vars.html">stp_vars_t</a> *v,   <span class="comment">/* I */</span>
01827                         <span class="keywordtype">int</span>  use_paper_margins,
01828                         <span class="keywordtype">int</span>  *left,     <span class="comment">/* O - Left position in points */</span>
<a name="l01829"></a><a class="code" href="print-canon_8c.html#a123">01829</a>                         <span class="keywordtype">int</span>  *right,    <span class="comment">/* O - Right position in points */</span>
01830                         <span class="keywordtype">int</span>  *bottom,   <span class="comment">/* O - Bottom position in points */</span>
01831                         <span class="keywordtype">int</span>  *top)      <span class="comment">/* O - Top position in points */</span>
01832 {
01833   <span class="keywordtype">int</span>   width, length;                  <span class="comment">/* Size of page */</span>
01834   <span class="keywordtype">int</span> left_margin = 0;
01835   <span class="keywordtype">int</span> right_margin = 0;
01836   <span class="keywordtype">int</span> bottom_margin = 0;
01837   <span class="keywordtype">int</span> top_margin = 0;
01838 
01839   <span class="keyword">const</span> <a class="code" href="structcanon__caps.html">canon_cap_t</a> * caps= <a class="code" href="print-canon_8c.html#a107">canon_get_model_capabilities</a>(<a class="code" href="group__printer.html#ga23">stp_get_model_id</a>(v));
01840   <span class="keyword">const</span> <span class="keywordtype">char</span> *media_size = <a class="code" href="group__vars.html#ga36">stp_get_string_parameter</a>(v, <span class="stringliteral">"PageSize"</span>);
01841   <span class="keyword">const</span> <a class="code" href="structstp__papersize__t.html">stp_papersize_t</a> *pt = NULL;
01842 
01843   <span class="keywordflow">if</span> (media_size &amp;&amp; use_paper_margins)
01844     pt = <a class="code" href="group__papersize.html#ga9">stp_get_papersize_by_name</a>(media_size);
01845 
01846   <a class="code" href="group__papersize.html#ga13">stp_default_media_size</a>(v, &amp;width, &amp;length);
01847   <span class="keywordflow">if</span> (pt)
01848     {
01849       left_margin = pt-&gt;<a class="code" href="structstp__papersize__t.html#o6">left</a>;
01850       right_margin = pt-&gt;<a class="code" href="structstp__papersize__t.html#o8">right</a>;
01851       bottom_margin = pt-&gt;<a class="code" href="structstp__papersize__t.html#o7">bottom</a>;
01852       top_margin = pt-&gt;<a class="code" href="structstp__papersize__t.html#o5">top</a>;
01853     }
01854   left_margin = <a class="code" href="print-canon_8c.html#a7">MAX</a>(left_margin, caps-&gt;<a class="code" href="structcanon__caps.html#o8">border_left</a>);
01855   right_margin = <a class="code" href="print-canon_8c.html#a7">MAX</a>(right_margin, caps-&gt;<a class="code" href="structcanon__caps.html#o9">border_right</a>);
01856   top_margin = <a class="code" href="print-canon_8c.html#a7">MAX</a>(top_margin, caps-&gt;<a class="code" href="structcanon__caps.html#o10">border_top</a>);
01857   bottom_margin = <a class="code" href="print-canon_8c.html#a7">MAX</a>(bottom_margin, caps-&gt;<a class="code" href="structcanon__caps.html#o11">border_bottom</a>);
01858 
01859   *left =       left_margin;
01860   *right =      width - right_margin;
01861   *top =        top_margin;
01862   *bottom =     length - bottom_margin;
01863 }
01864 
01865 <span class="keyword">static</span> <span class="keywordtype">void</span>
01866 <a class="code" href="print-canon_8c.html#a124">canon_imageable_area</a>(<span class="keyword">const</span> <a class="code" href="structstp__vars.html">stp_vars_t</a> *v,   <span class="comment">/* I */</span>
01867                      <span class="keywordtype">int</span>  *left,        <span class="comment">/* O - Left position in points */</span>
01868                      <span class="keywordtype">int</span>  *right,       <span class="comment">/* O - Right position in points */</span>
<a name="l01869"></a><a class="code" href="print-canon_8c.html#a124">01869</a>                      <span class="keywordtype">int</span>  *bottom,      <span class="comment">/* O - Bottom position in points */</span>
01870                      <span class="keywordtype">int</span>  *top)         <span class="comment">/* O - Top position in points */</span>
01871 {
01872   <a class="code" href="print-pcl_8c.html#a135">internal_imageable_area</a>(v, 1, left, right, bottom, top);
01873 }
01874 
01875 <span class="keyword">static</span> <span class="keywordtype">void</span>
01876 <a class="code" href="print-canon_8c.html#a125">canon_limit</a>(<span class="keyword">const</span> <a class="code" href="structstp__vars.html">stp_vars_t</a> *v,                <span class="comment">/* I */</span>
01877             <span class="keywordtype">int</span> *width,
01878             <span class="keywordtype">int</span> *height,
<a name="l01879"></a><a class="code" href="print-canon_8c.html#a125">01879</a>             <span class="keywordtype">int</span> *min_width,
01880             <span class="keywordtype">int</span> *min_height)
01881 {
01882   <span class="keyword">const</span> <a class="code" href="structcanon__caps.html">canon_cap_t</a> * caps=
01883     <a class="code" href="print-canon_8c.html#a107">canon_get_model_capabilities</a>(<a class="code" href="group__printer.html#ga23">stp_get_model_id</a>(v));
01884   *width =      caps-&gt;<a class="code" href="structcanon__caps.html#o2">max_width</a>;
01885   *height =     caps-&gt;<a class="code" href="structcanon__caps.html#o3">max_height</a>;
01886   *min_width = 1;
01887   *min_height = 1;
01888 }
01889 
01890 <span class="comment">/*</span>
01891 <span class="comment"> * 'canon_cmd()' - Sends a command with variable args</span>
01892 <span class="comment"> */</span>
01893 <span class="keyword">static</span> <span class="keywordtype">void</span>
01894 <a class="code" href="print-canon_8c.html#a126">canon_cmd</a>(<span class="keyword">const</span> <a class="code" href="structstp__vars.html">stp_vars_t</a> *v, <span class="comment">/* I - the printer         */</span>
01895           <span class="keyword">const</span> <span class="keywordtype">char</span> *ini, <span class="comment">/* I - 2 bytes start code  */</span>
01896           <span class="keyword">const</span> <span class="keywordtype">char</span> cmd,  <span class="comment">/* I - command code        */</span>
<a name="l01897"></a><a class="code" href="print-canon_8c.html#a126">01897</a>           <span class="keywordtype">int</span>  num,  <span class="comment">/* I - number of arguments */</span>
01898           ...        <span class="comment">/* I - the args themselves */</span>
01899           )
01900 {
01901   <span class="keywordtype">unsigned</span> <span class="keywordtype">char</span> *buffer = <a class="code" href="group__util.html#ga29">stp_zalloc</a>(num + 1);
01902   <span class="keywordtype">int</span> i;
01903   va_list ap;
01904 
01905   <span class="keywordflow">if</span> (num)
01906     {
01907       va_start(ap, num);
01908       <span class="keywordflow">for</span> (i=0; i&lt;num; i++)
01909         buffer[i]= (<span class="keywordtype">unsigned</span> <span class="keywordtype">char</span>) va_arg(ap, <span class="keywordtype">int</span>);
01910       va_end(ap);
01911     }
01912 
01913   <a class="code" href="group__util.html#ga10">stp_zfwrite</a>(ini,2,1,v);
01914   <span class="keywordflow">if</span> (cmd)
01915     {
01916       <a class="code" href="group__util.html#ga11">stp_putc</a>(cmd,v);
01917       <a class="code" href="group__util.html#ga12">stp_put16_le</a>(num, v);
01918       <span class="keywordflow">if</span> (num)
01919         <a class="code" href="group__util.html#ga10">stp_zfwrite</a>((<span class="keyword">const</span> <span class="keywordtype">char</span> *)buffer,num,1,v);
01920     }
01921   <a class="code" href="group__util.html#ga31">stp_free</a>(buffer);
01922 }
01923 
01924 <span class="preprocessor">#define PUT(WHAT,VAL,RES) stp_deprintf(STP_DBG_CANON,"canon: "WHAT\</span>
01925 <span class="preprocessor">" is %04x =% 5d = %f\" = %f mm\n",(VAL),(VAL),(VAL)/(1.*RES),(VAL)/(RES/25.4))</span>
01926 <span class="preprocessor"></span>
<a name="l01927"></a><a class="code" href="print-canon_8c.html#a40">01927</a> <span class="preprocessor">#define ESC28 "\033\050"</span>
01928 <span class="preprocessor"></span><span class="preprocessor">#define ESC5b "\033\133"</span>
01929 <span class="preprocessor"></span><span class="preprocessor">#define ESC40 "\033\100"</span>
<a name="l01930"></a><a class="code" href="print-canon_8c.html#a41">01930</a> <span class="preprocessor"></span>
<a name="l01931"></a><a class="code" href="print-canon_8c.html#a42">01931</a> <span class="comment">/* ESC [K --  -- reset printer:</span>
<a name="l01932"></a><a class="code" href="print-canon_8c.html#a43">01932</a> <span class="comment"> */</span>
01933 <span class="keyword">static</span> <span class="keywordtype">void</span>
01934 <a class="code" href="print-canon_8c.html#a127">canon_init_resetPrinter</a>(<span class="keyword">const</span> <a class="code" href="structstp__vars.html">stp_vars_t</a> *v, <a class="code" href="structcanon__init__t.html">canon_init_t</a> *init)
01935 {
01936   <span class="keywordtype">unsigned</span> <span class="keywordtype">long</span> f=init-&gt;<a class="code" href="structcanon__init__t.html#o0">caps</a>-&gt;<a class="code" href="structcanon__caps.html#o14">features</a>;
<a name="l01937"></a><a class="code" href="print-canon_8c.html#a127">01937</a>   <span class="keywordflow">if</span> (f &amp; (<a class="code" href="print-canon_8c.html#a35">CANON_CAP_ACKSHORT</a>))
01938     {
01939       <a class="code" href="print-canon_8c.html#a126">canon_cmd</a>(v,<a class="code" href="print-canon_8c.html#a42">ESC5b</a>,0x4b, 2, 0x00,0x1f);
01940       <a class="code" href="group__util.html#ga16">stp_puts</a>(<span class="stringliteral">"BJLSTART\nControlMode=Common\n"</span>,v);
01941       <span class="keywordflow">if</span> (f &amp; <a class="code" href="print-canon_8c.html#a35">CANON_CAP_ACKSHORT</a>) <a class="code" href="group__util.html#ga16">stp_puts</a>(<span class="stringliteral">"AckTime=Short\n"</span>,v);
01942       <a class="code" href="group__util.html#ga16">stp_puts</a>(<span class="stringliteral">"BJLEND\n"</span>,v);
01943     }
01944   <a class="code" href="print-canon_8c.html#a126">canon_cmd</a>(v,ESC5b,0x4b, 2, 0x00,0x0f);
01945 }
01946 
01947 <span class="comment">/* ESC (a -- 0x61 -- cmdSetPageMode --:</span>
01948 <span class="comment"> */</span>
01949 <span class="keyword">static</span> <span class="keywordtype">void</span>
01950 <a class="code" href="print-canon_8c.html#a128">canon_init_setPageMode</a>(<span class="keyword">const</span> <a class="code" href="structstp__vars.html">stp_vars_t</a> *v, <a class="code" href="structcanon__init__t.html">canon_init_t</a> *init)
01951 {
01952   <span class="keywordflow">if</span> (!(init-&gt;<a class="code" href="structcanon__init__t.html#o0">caps</a>-&gt;<a class="code" href="structcanon__caps.html#o14">features</a> &amp; <a class="code" href="print-canon_8c.html#a24">CANON_CAP_a</a>))
<a name="l01953"></a><a class="code" href="print-canon_8c.html#a128">01953</a>     <span class="keywordflow">return</span>;
01954 
01955   <span class="keywordflow">if</span> (init-&gt;<a class="code" href="structcanon__init__t.html#o0">caps</a>-&gt;<a class="code" href="structcanon__caps.html#o14">features</a> &amp; <a class="code" href="print-canon_8c.html#a24">CANON_CAP_a</a>)
01956     <a class="code" href="print-canon_8c.html#a126">canon_cmd</a>(v,ESC28,0x61, 1, 0x01);
01957 }
01958 
01959 <span class="comment">/* ESC (b -- 0x62 -- -- set data compression:</span>
01960 <span class="comment"> */</span>
01961 <span class="keyword">static</span> <span class="keywordtype">void</span>
01962 <a class="code" href="print-canon_8c.html#a129">canon_init_setDataCompression</a>(<span class="keyword">const</span> <a class="code" href="structstp__vars.html">stp_vars_t</a> *v, <a class="code" href="structcanon__init__t.html">canon_init_t</a> *init)
01963 {
01964   <span class="keywordflow">if</span> (!(init-&gt;<a class="code" href="structcanon__init__t.html#o0">caps</a>-&gt;<a class="code" href="structcanon__caps.html#o14">features</a> &amp; <a class="code" href="print-canon_8c.html#a25">CANON_CAP_b</a>))
<a name="l01965"></a><a class="code" href="print-canon_8c.html#a129">01965</a>     <span class="keywordflow">return</span>;
01966 
01967   <a class="code" href="print-canon_8c.html#a126">canon_cmd</a>(v,ESC28,0x62, 1, 0x01);
01968 }
01969 
01970 <span class="comment">/* ESC (c -- 0x63 -- cmdSetColor --:</span>
01971 <span class="comment"> */</span>
01972 <span class="keyword">static</span> <span class="keywordtype">void</span>
01973 <a class="code" href="print-canon_8c.html#a130">canon_init_setColor</a>(<span class="keyword">const</span> <a class="code" href="structstp__vars.html">stp_vars_t</a> *v, <a class="code" href="structcanon__init__t.html">canon_init_t</a> *init)
01974 {
01975   <span class="keywordtype">unsigned</span> <span class="keywordtype">char</span>
<a name="l01976"></a><a class="code" href="print-canon_8c.html#a130">01976</a>     arg_63_1, arg_63_2, arg_63_3;
01977 
01978 
01979   <span class="keywordflow">if</span> (!(init-&gt;<a class="code" href="structcanon__init__t.html#o0">caps</a>-&gt;<a class="code" href="structcanon__caps.html#o14">features</a> &amp; <a class="code" href="print-canon_8c.html#a30">CANON_CAP_c</a>))
01980     <span class="keywordflow">return</span>;
01981 
01982   arg_63_1 = init-&gt;<a class="code" href="structcanon__init__t.html#o0">caps</a>-&gt;<a class="code" href="structcanon__caps.html#o1">model_id</a> &lt;&lt; 4;                                         <span class="comment">/* MODEL_ID */</span>
01983 
01984   <span class="keywordflow">switch</span> ( init-&gt;<a class="code" href="structcanon__init__t.html#o0">caps</a>-&gt;<a class="code" href="structcanon__caps.html#o1">model_id</a> ) {
01985 
01986         <span class="keywordflow">case</span> 0:                 <span class="comment">/* very old 360 dpi series: BJC-800/820 */</span>
01987                 <span class="keywordflow">break</span>;          <span class="comment">/*      tbd */</span>
01988 
01989         <span class="keywordflow">case</span> 1:                 <span class="comment">/* 360 dpi series - BJC-4000, BJC-210, BJC-70 and their descendants */</span>
01990                 <span class="keywordflow">if</span> (!init-&gt;<a class="code" href="structcanon__init__t.html#o1">printing_color</a>)
01991                         arg_63_1|= 0x01;                                        <span class="comment">/* PRINT_COLOUR */</span>
01992 
01993                 arg_63_2 = ((init-&gt;<a class="code" href="structcanon__init__t.html#o2">pt</a> ? init-&gt;<a class="code" href="structcanon__init__t.html#o2">pt</a>-&gt;<a class="code" href="structpaper__t.html#o2">media_code</a> : 0) &lt;&lt; 4)         <span class="comment">/* PRINT_MEDIA */</span>
01994                         + 1;    <span class="comment">/* hardcode to High quality for now */</span>          <span class="comment">/* PRINT_QUALITY */</span>
01995 
01996                 <a class="code" href="print-canon_8c.html#a126">canon_cmd</a>(v,<a class="code" href="print-canon_8c.html#a41">ESC28</a>,0x63, 2, arg_63_1, arg_63_2);
01997                 <span class="keywordflow">break</span>;
01998 
01999         <span class="keywordflow">case</span> 2:                 <span class="comment">/* are any models using this? */</span>
02000                 <span class="keywordflow">break</span>;
02001 
02002         <span class="keywordflow">case</span> 3:                 <span class="comment">/* 720 dpi series - BJC-3000 and descendants */</span>
02003                 <span class="keywordflow">if</span> (!init-&gt;<a class="code" href="structcanon__init__t.html#o1">printing_color</a>)
02004                         arg_63_1|= 0x01;                                        <span class="comment">/* colour mode */</span>
02005 
02006                 arg_63_2 = (init-&gt;<a class="code" href="structcanon__init__t.html#o2">pt</a>) ? init-&gt;<a class="code" href="structcanon__init__t.html#o2">pt</a>-&gt;<a class="code" href="structpaper__t.html#o2">media_code</a> : 0;               <span class="comment">/* print media type */</span>
02007 
02008                 arg_63_3 = 2;   <span class="comment">/* hardcode to whatever this means for now */</span>   <span class="comment">/* quality, apparently */</span>
02009 
02010                 <a class="code" href="print-canon_8c.html#a126">canon_cmd</a>(v,<a class="code" href="print-canon_8c.html#a41">ESC28</a>,0x63, 3, arg_63_1, arg_63_2, arg_63_3);
02011                 <span class="keywordflow">break</span>;
02012         }
02013 
02014   <span class="keywordflow">return</span>;
02015 }
02016 
02017 <span class="comment">/* ESC (d -- 0x64 -- -- set raster resolution:</span>
02018 <span class="comment"> */</span>
02019 <span class="keyword">static</span> <span class="keywordtype">void</span>
02020 <a class="code" href="print-canon_8c.html#a131">canon_init_setResolution</a>(<span class="keyword">const</span> <a class="code" href="structstp__vars.html">stp_vars_t</a> *v, <a class="code" href="structcanon__init__t.html">canon_init_t</a> *init)
02021 {
02022   <span class="keywordflow">if</span> (!(init-&gt;<a class="code" href="structcanon__init__t.html#o0">caps</a>-&gt;<a class="code" href="structcanon__caps.html#o14">features</a> &amp; <a class="code" href="print-canon_8c.html#a28">CANON_CAP_d</a>))
<a name="l02023"></a><a class="code" href="print-canon_8c.html#a131">02023</a>     <span class="keywordflow">return</span>;
02024 
02025   <a class="code" href="print-canon_8c.html#a126">canon_cmd</a>(v,ESC28,0x64, 4,
02026             (init-&gt;<a class="code" href="structcanon__init__t.html#o7">ydpi</a> &gt;&gt; 8 ), (init-&gt;<a class="code" href="structcanon__init__t.html#o7">ydpi</a> &amp; 255),
02027             (init-&gt;<a class="code" href="structcanon__init__t.html#o6">xdpi</a> &gt;&gt; 8 ), (init-&gt;<a class="code" href="structcanon__init__t.html#o6">xdpi</a> &amp; 255));
02028 }
02029 
02030 <span class="comment">/* ESC (g -- 0x67 -- cmdSetPageMargins --:</span>
02031 <span class="comment"> */</span>
02032 <span class="keyword">static</span> <span class="keywordtype">void</span>
02033 <a class="code" href="print-canon_8c.html#a132">canon_init_setPageMargins</a>(<span class="keyword">const</span> <a class="code" href="structstp__vars.html">stp_vars_t</a> *v, <a class="code" href="structcanon__init__t.html">canon_init_t</a> *init)
02034 {
02035   <span class="comment">/* TOFIX: what exactly is to be sent?</span>
<a name="l02036"></a><a class="code" href="print-canon_8c.html#a132">02036</a> <span class="comment">   * Is it the printable length or the bottom border?</span>
02037 <span class="comment">   * Is is the printable width or the right border?</span>
02038 <span class="comment">   */</span>
02039 
02040   <span class="keywordtype">int</span> minlength= 0;
02041   <span class="keywordtype">int</span> minwidth= 0;
02042   <span class="keywordtype">int</span> length= init-&gt;<a class="code" href="structcanon__init__t.html#o9">page_height</a>*5/36;
02043   <span class="keywordtype">int</span> width= init-&gt;<a class="code" href="structcanon__init__t.html#o8">page_width</a>*5/36;
02044 
02045   <span class="keywordflow">if</span> (!(init-&gt;<a class="code" href="structcanon__init__t.html#o0">caps</a>-&gt;<a class="code" href="structcanon__caps.html#o14">features</a> &amp; <a class="code" href="print-canon_8c.html#a34">CANON_CAP_g</a>))
02046     <span class="keywordflow">return</span>;
02047 
02048   <span class="keywordflow">if</span> (minlength&gt;length) length= minlength;
02049   <span class="keywordflow">if</span> (minwidth&gt;width) width= minwidth;
02050 
02051   <a class="code" href="print-canon_8c.html#a126">canon_cmd</a>(v,ESC28,0x67, 4, 0,
02052             (<span class="keywordtype">unsigned</span> <span class="keywordtype">char</span>)(length),1,
02053             (<span class="keywordtype">unsigned</span> <span class="keywordtype">char</span>)(width));
02054 
02055 }
02056 
02057 <span class="comment">/* ESC (l -- 0x6c -- cmdSetTray --:</span>
02058 <span class="comment"> */</span>
02059 <span class="keyword">static</span> <span class="keywordtype">void</span>
02060 <a class="code" href="print-canon_8c.html#a133">canon_init_setTray</a>(<span class="keyword">const</span> <a class="code" href="structstp__vars.html">stp_vars_t</a> *v, <a class="code" href="structcanon__init__t.html">canon_init_t</a> *init)
02061 {
02062   <span class="keywordtype">unsigned</span> <span class="keywordtype">char</span>
<a name="l02063"></a><a class="code" href="print-canon_8c.html#a133">02063</a>     arg_6c_1 = 0x00,
02064     arg_6c_2 = 0x00; <span class="comment">/* plain paper */</span>
02065 
02066   <span class="comment">/* int media= canon_media_type(media_str,caps); */</span>
02067   <span class="keywordtype">int</span> source= <a class="code" href="print-canon_8c.html#a108">canon_source_type</a>(init-&gt;<a class="code" href="structcanon__init__t.html#o5">source_str</a>,init-&gt;<a class="code" href="structcanon__init__t.html#o0">caps</a>);
02068 
02069   <span class="keywordflow">if</span> (!(init-&gt;<a class="code" href="structcanon__init__t.html#o0">caps</a>-&gt;<a class="code" href="structcanon__caps.html#o14">features</a> &amp; <a class="code" href="print-canon_8c.html#a32">CANON_CAP_l</a>))
02070     <span class="keywordflow">return</span>;
02071 
02072   arg_6c_1 = init-&gt;<a class="code" href="structcanon__init__t.html#o0">caps</a>-&gt;<a class="code" href="structcanon__caps.html#o1">model_id</a> &lt;&lt; 4;
02073 
02074   arg_6c_1|= (source &amp; 0x0f);
02075 
02076   <span class="keywordflow">if</span> (init-&gt;<a class="code" href="structcanon__init__t.html#o2">pt</a>) arg_6c_2= init-&gt;<a class="code" href="structcanon__init__t.html#o2">pt</a>-&gt;<a class="code" href="structpaper__t.html#o2">media_code</a>;
02077 
02078   <a class="code" href="print-canon_8c.html#a126">canon_cmd</a>(v,ESC28,0x6c, 2, arg_6c_1, arg_6c_2);
02079 }
02080 
02081 <span class="comment">/* ESC (m -- 0x6d --  -- :</span>
02082 <span class="comment"> */</span>
02083 <span class="keyword">static</span> <span class="keywordtype">void</span>
02084 <a class="code" href="print-canon_8c.html#a134">canon_init_setPrintMode</a>(<span class="keyword">const</span> <a class="code" href="structstp__vars.html">stp_vars_t</a> *v, <a class="code" href="structcanon__init__t.html">canon_init_t</a> *init)
02085 {
02086   <span class="keywordtype">unsigned</span> <span class="keywordtype">char</span>
<a name="l02087"></a><a class="code" href="print-canon_8c.html#a134">02087</a>     arg_6d_1 = 0x03, <span class="comment">/* color printhead? */</span>
02088     arg_6d_2 = 0x00, <span class="comment">/* 00=color  02=b/w */</span>
02089     arg_6d_3 = 0x00, <span class="comment">/* only 01 for bjc8200 */</span>
02090     arg_6d_a = 0x03, <span class="comment">/* A4 paper */</span>
02091     arg_6d_b = 0x00;
02092 
02093   <span class="keywordflow">if</span> (!(init-&gt;<a class="code" href="structcanon__init__t.html#o0">caps</a>-&gt;<a class="code" href="structcanon__caps.html#o14">features</a> &amp; <a class="code" href="print-canon_8c.html#a27">CANON_CAP_m</a>))
02094     <span class="keywordflow">return</span>;
02095 
02096   arg_6d_a= <a class="code" href="print-canon_8c.html#a111">canon_size_type</a>(v,init-&gt;<a class="code" href="structcanon__init__t.html#o0">caps</a>);
02097   <span class="keywordflow">if</span> (!arg_6d_a)
02098     arg_6d_b= 1;
02099 
02100   <span class="keywordflow">if</span> (init-&gt;<a class="code" href="structcanon__init__t.html#o3">print_head</a>==0)
02101     arg_6d_1= 0x03;
02102   <span class="keywordflow">else</span> <span class="keywordflow">if</span> (init-&gt;<a class="code" href="structcanon__init__t.html#o3">print_head</a>&lt;=2)
02103     arg_6d_1= 0x02;
02104   <span class="keywordflow">else</span> <span class="keywordflow">if</span> (init-&gt;<a class="code" href="structcanon__init__t.html#o3">print_head</a>&lt;=4)
02105     arg_6d_1= 0x04;
02106   <span class="keywordflow">if</span> (!init-&gt;<a class="code" href="structcanon__init__t.html#o1">printing_color</a>)
02107     arg_6d_2= 0x02;
02108 
02109   <span class="keywordflow">if</span> (init-&gt;<a class="code" href="structcanon__init__t.html#o0">caps</a>-&gt;<a class="code" href="structcanon__caps.html#o0">model</a>==8200)
02110     arg_6d_3= 0x01;
02111 
02112   <a class="code" href="print-canon_8c.html#a126">canon_cmd</a>(v,ESC28,0x6d,12, arg_6d_1,
02113             0xff,0xff,0x00,0x00,0x07,0x00,
02114             arg_6d_a,arg_6d_b,arg_6d_2,0x00,arg_6d_3);
02115 }
02116 
02117 <span class="comment">/* ESC (p -- 0x70 -- cmdSetPageMargins2 --:</span>
02118 <span class="comment"> */</span>
02119 <span class="keyword">static</span> <span class="keywordtype">void</span>
02120 <a class="code" href="print-canon_8c.html#a135">canon_init_setPageMargins2</a>(<span class="keyword">const</span> <a class="code" href="structstp__vars.html">stp_vars_t</a> *v, <a class="code" href="structcanon__init__t.html">canon_init_t</a> *init)
02121 {
02122   <span class="comment">/* TOFIX: what exactly is to be sent?</span>
<a name="l02123"></a><a class="code" href="print-canon_8c.html#a135">02123</a> <span class="comment">   * Is it the printable length or the bottom border?</span>
02124 <span class="comment">   * Is is the printable width or the right border?</span>
02125 <span class="comment">   */</span>
02126 
02127   <span class="keywordtype">int</span> printable_width=  init-&gt;<a class="code" href="structcanon__init__t.html#o8">page_width</a>*5/6;
02128   <span class="keywordtype">int</span> printable_length= init-&gt;<a class="code" href="structcanon__init__t.html#o9">page_height</a>*5/6;
02129 
02130   <span class="keywordtype">unsigned</span> <span class="keywordtype">char</span> arg_70_1= (printable_length &gt;&gt; 8) &amp; 0xff;
02131   <span class="keywordtype">unsigned</span> <span class="keywordtype">char</span> arg_70_2= (printable_length) &amp; 0xff;
02132   <span class="keywordtype">unsigned</span> <span class="keywordtype">char</span> arg_70_3= (printable_width &gt;&gt; 8) &amp; 0xff;
02133   <span class="keywordtype">unsigned</span> <span class="keywordtype">char</span> arg_70_4= (printable_width) &amp; 0xff;
02134 
02135   <span class="keywordflow">if</span> (!(init-&gt;<a class="code" href="structcanon__init__t.html#o0">caps</a>-&gt;<a class="code" href="structcanon__caps.html#o14">features</a> &amp; <a class="code" href="print-canon_8c.html#a31">CANON_CAP_p</a>))
02136     <span class="keywordflow">return</span>;
02137 
02138   <a class="code" href="print-canon_8c.html#a126">canon_cmd</a>(v,ESC28,0x70, 8,
02139             arg_70_1, arg_70_2, 0x00, 0x00,
02140             arg_70_3, arg_70_4, 0x00, 0x00);
02141 }
02142 
02143 <span class="comment">/* ESC (q -- 0x71 -- setPageID -- :</span>
02144 <span class="comment"> */</span>
02145 <span class="keyword">static</span> <span class="keywordtype">void</span>
02146 <a class="code" href="print-canon_8c.html#a136">canon_init_setPageID</a>(<span class="keyword">const</span> <a class="code" href="structstp__vars.html">stp_vars_t</a> *v, <a class="code" href="structcanon__init__t.html">canon_init_t</a> *init)
02147 {
02148   <span class="keywordflow">if</span> (!(init-&gt;<a class="code" href="structcanon__init__t.html#o0">caps</a>-&gt;<a class="code" href="structcanon__caps.html#o14">features</a> &amp; <a class="code" href="print-canon_8c.html#a26">CANON_CAP_q</a>))
<a name="l02149"></a><a class="code" href="print-canon_8c.html#a136">02149</a>     <span class="keywordflow">return</span>;
02150 
02151   <a class="code" href="print-canon_8c.html#a126">canon_cmd</a>(v,ESC28,0x71, 1, 0x01);
02152 }
02153 
02154 <span class="comment">/* ESC (r -- 0x72 --  -- :</span>
02155 <span class="comment"> */</span>
02156 <span class="keyword">static</span> <span class="keywordtype">void</span>
02157 <a class="code" href="print-canon_8c.html#a137">canon_init_setX72</a>(<span class="keyword">const</span> <a class="code" href="structstp__vars.html">stp_vars_t</a> *v, <a class="code" href="structcanon__init__t.html">canon_init_t</a> *init)
02158 {
02159   <span class="keywordflow">if</span> (!(init-&gt;<a class="code" href="structcanon__init__t.html#o0">caps</a>-&gt;<a class="code" href="structcanon__caps.html#o14">features</a> &amp; <a class="code" href="print-canon_8c.html#a33">CANON_CAP_r</a>))
<a name="l02160"></a><a class="code" href="print-canon_8c.html#a137">02160</a>     <span class="keywordflow">return</span>;
02161 
02162   <a class="code" href="print-canon_8c.html#a126">canon_cmd</a>(v,ESC28,0x72, 1, 0x61); <span class="comment">/* whatever for - 8200 needs it */</span>
02163 }
02164 
02165 <span class="comment">/* ESC (t -- 0x74 -- cmdSetImage --:</span>
02166 <span class="comment"> */</span>
02167 <span class="keyword">static</span> <span class="keywordtype">void</span>
02168 <a class="code" href="print-canon_8c.html#a138">canon_init_setImage</a>(<span class="keyword">const</span> <a class="code" href="structstp__vars.html">stp_vars_t</a> *v, <a class="code" href="structcanon__init__t.html">canon_init_t</a> *init)
02169 {
02170   <span class="keywordtype">unsigned</span> <span class="keywordtype">char</span>
<a name="l02171"></a><a class="code" href="print-canon_8c.html#a138">02171</a>     arg_74_1 = 0x01, <span class="comment">/* 1 bit per pixel */</span>
02172     arg_74_2 = 0x00, <span class="comment">/*  */</span>
02173     arg_74_3 = 0x01; <span class="comment">/* 01 &lt;= 360 dpi    09 &gt;= 720 dpi */</span>
02174 
02175   <span class="keywordflow">if</span> (!(init-&gt;<a class="code" href="structcanon__init__t.html#o0">caps</a>-&gt;<a class="code" href="structcanon__caps.html#o14">features</a> &amp; <a class="code" href="print-canon_8c.html#a29">CANON_CAP_t</a>))
02176     <span class="keywordflow">return</span>;
02177 
02178   <span class="keywordflow">if</span> (init-&gt;<a class="code" href="structcanon__init__t.html#o6">xdpi</a>==1440) arg_74_2= 0x04;
02179   <span class="keywordflow">if</span> (init-&gt;<a class="code" href="structcanon__init__t.html#o7">ydpi</a>&gt;=720)  arg_74_3= 0x09;
02180 
02181   <span class="keywordflow">if</span> (init-&gt;<a class="code" href="structcanon__init__t.html#o12">bits</a>&gt;1) {
02182     arg_74_1= 0x02;
02183     arg_74_2= 0x80;
02184     arg_74_3= 0x09;
02185     <span class="keywordflow">if</span> (init-&gt;<a class="code" href="structcanon__init__t.html#o4">colormode</a> == <a class="code" href="print-canon_8c.html#a156a95">COLOR_CMY</a>) arg_74_3= 0x02; <span class="comment">/* for BC-06 cartridge!!! */</span>
02186   }
02187 
02188   <span class="comment">/* workaround for the bjc8200 in 6color mode - not really understood */</span>
02189   <span class="keywordflow">if</span> (init-&gt;<a class="code" href="structcanon__init__t.html#o0">caps</a>-&gt;<a class="code" href="structcanon__caps.html#o0">model</a>==8200) {
02190     <span class="keywordflow">if</span> (init-&gt;<a class="code" href="structcanon__init__t.html#o4">colormode</a>==<a class="code" href="print-canon_8c.html#a156a97">COLOR_CCMMYK</a>) {
02191       arg_74_1= 0xff;
02192       arg_74_2= 0x90;
02193       arg_74_3= 0x04;
02194       init-&gt;<a class="code" href="structcanon__init__t.html#o12">bits</a>=3;
02195       <span class="keywordflow">if</span> (init-&gt;<a class="code" href="structcanon__init__t.html#o7">ydpi</a>&gt;600)  arg_74_3= 0x09;
02196     } <span class="keywordflow">else</span> {
02197       arg_74_1= 0x01;
02198       arg_74_2= 0x00;
02199       arg_74_3= 0x01;
02200       <span class="keywordflow">if</span> (init-&gt;<a class="code" href="structcanon__init__t.html#o7">ydpi</a>&gt;600)  arg_74_3= 0x09;
02201     }
02202   }
02203 
02204   <a class="code" href="print-canon_8c.html#a126">canon_cmd</a>(v,ESC28,0x74, 3, arg_74_1, arg_74_2, arg_74_3);
02205 }
02206 
02207 <span class="keyword">static</span> <span class="keywordtype">void</span>
02208 <a class="code" href="print-canon_8c.html#a139">canon_init_printer</a>(<span class="keyword">const</span> <a class="code" href="structstp__vars.html">stp_vars_t</a> *v, <a class="code" href="structcanon__init__t.html">canon_init_t</a> *init)
02209 {
02210   <span class="keywordtype">int</span> mytop;
<a name="l02211"></a><a class="code" href="print-canon_8c.html#a139">02211</a>   <span class="comment">/* init printer */</span>
02212 
02213   <a class="code" href="print-canon_8c.html#a127">canon_init_resetPrinter</a>(v,init);       <span class="comment">/* ESC [K */</span>
02214   <a class="code" href="print-canon_8c.html#a128">canon_init_setPageMode</a>(v,init);        <span class="comment">/* ESC (a */</span>
02215   <a class="code" href="print-canon_8c.html#a129">canon_init_setDataCompression</a>(v,init); <span class="comment">/* ESC (b */</span>
02216   <a class="code" href="print-canon_8c.html#a136">canon_init_setPageID</a>(v,init);          <span class="comment">/* ESC (q */</span>
02217   <a class="code" href="print-canon_8c.html#a134">canon_init_setPrintMode</a>(v,init);       <span class="comment">/* ESC (m */</span>
02218   <a class="code" href="print-canon_8c.html#a131">canon_init_setResolution</a>(v,init);      <span class="comment">/* ESC (d */</span>
02219   <a class="code" href="print-canon_8c.html#a138">canon_init_setImage</a>(v,init);           <span class="comment">/* ESC (t */</span>
02220   <a class="code" href="print-canon_8c.html#a130">canon_init_setColor</a>(v,init);           <span class="comment">/* ESC (c */</span>
02221   <a class="code" href="print-canon_8c.html#a132">canon_init_setPageMargins</a>(v,init);     <span class="comment">/* ESC (g */</span>
02222   <a class="code" href="print-canon_8c.html#a135">canon_init_setPageMargins2</a>(v,init);    <span class="comment">/* ESC (p */</span>
02223   <a class="code" href="print-canon_8c.html#a133">canon_init_setTray</a>(v,init);            <span class="comment">/* ESC (l */</span>
02224   <a class="code" href="print-canon_8c.html#a137">canon_init_setX72</a>(v,init);             <span class="comment">/* ESC (r */</span>
02225 
02226   <span class="comment">/* some linefeeds */</span>
02227 
02228   mytop= (init-&gt;<a class="code" href="structcanon__init__t.html#o10">top</a>*init-&gt;<a class="code" href="structcanon__init__t.html#o7">ydpi</a>)/72;
02229   <a class="code" href="print-canon_8c.html#a126">canon_cmd</a>(v,ESC28,0x65, 2, (mytop &gt;&gt; 8 ),(mytop &amp; 255));
02230 }
02231 
02232 <span class="keyword">static</span> <span class="keywordtype">void</span>
02233 <a class="code" href="print-canon_8c.html#a140">canon_deinit_printer</a>(<span class="keyword">const</span> <a class="code" href="structstp__vars.html">stp_vars_t</a> *v, <a class="code" href="structcanon__init__t.html">canon_init_t</a> *init)
02234 {
02235   <span class="comment">/* eject page */</span>
<a name="l02236"></a><a class="code" href="print-canon_8c.html#a140">02236</a>   <a class="code" href="group__util.html#ga11">stp_putc</a>(0x0c,v);
02237 
02238   <span class="comment">/* say goodbye */</span>
02239   <a class="code" href="print-canon_8c.html#a126">canon_cmd</a>(v,ESC28,0x62,1,0);
02240   <span class="keywordflow">if</span> (init-&gt;<a class="code" href="structcanon__init__t.html#o0">caps</a>-&gt;<a class="code" href="structcanon__caps.html#o14">features</a> &amp; <a class="code" href="print-canon_8c.html#a24">CANON_CAP_a</a>)
02241     <a class="code" href="print-canon_8c.html#a126">canon_cmd</a>(v,ESC28,0x61, 1, 0);
02242 }
02243 
02244 <span class="keyword">static</span> <span class="keywordtype">int</span>
02245 <a class="code" href="print-canon_8c.html#a141">canon_start_job</a>(<span class="keyword">const</span> <a class="code" href="structstp__vars.html">stp_vars_t</a> *v, <a class="code" href="structstp__image.html">stp_image_t</a> *image)
02246 {
02247   <span class="keywordflow">return</span> 1;
<a name="l02248"></a><a class="code" href="print-canon_8c.html#a141">02248</a> }
02249 
02250 <span class="keyword">static</span> <span class="keywordtype">int</span>
02251 <a class="code" href="print-canon_8c.html#a142">canon_end_job</a>(<span class="keyword">const</span> <a class="code" href="structstp__vars.html">stp_vars_t</a> *v, <a class="code" href="structstp__image.html">stp_image_t</a> *image)
02252 {
02253   <a class="code" href="print-canon_8c.html#a126">canon_cmd</a>(v,<a class="code" href="print-canon_8c.html#a43">ESC40</a>,0,0);
<a name="l02254"></a><a class="code" href="print-canon_8c.html#a142">02254</a>   <span class="keywordflow">return</span> 1;
02255 }
02256 
02257 <span class="comment">/*</span>
02258 <span class="comment"> * 'advance_buffer()' - Move (num) lines of length (len) down one line</span>
02259 <span class="comment"> *                      and sets first line to 0s</span>
02260 <span class="comment"> *                      accepts NULL pointers as buf</span>
02261 <span class="comment"> *                  !!! buf must contain more than (num) lines !!!</span>
02262 <span class="comment"> *                      also sets first line to 0s if num&lt;1</span>
02263 <span class="comment"> */</span>
02264 <span class="keyword">static</span> <span class="keywordtype">void</span>
02265 <a class="code" href="print-canon_8c.html#a143">canon_advance_buffer</a>(<span class="keywordtype">unsigned</span> <span class="keywordtype">char</span> *buf, <span class="keywordtype">int</span> len, <span class="keywordtype">int</span> num)
02266 {
02267   <span class="keywordflow">if</span> (!buf || !len) <span class="keywordflow">return</span>;
<a name="l02268"></a><a class="code" href="print-canon_8c.html#a143">02268</a>   <span class="keywordflow">if</span> (num&gt;0) memmove(buf+len,buf,len*num);
02269   memset(buf,0,len);
02270 }
02271 
02272 <span class="keyword">static</span> <span class="keywordtype">void</span>
02273 <a class="code" href="print-canon_8c.html#a144">setup_column</a>(<a class="code" href="structcanon__privdata__t.html">canon_privdata_t</a> *privdata, <span class="keywordtype">int</span> col, <span class="keywordtype">int</span> buf_length)
02274 {
02275   privdata-&gt;<a class="code" href="structcanon__privdata__t.html#o1">cols</a>[col] = <a class="code" href="group__util.html#ga29">stp_zalloc</a>(buf_length * (privdata-&gt;<a class="code" href="structcanon__privdata__t.html#o2">delay</a>[col] + 1));
<a name="l02276"></a><a class="code" href="print-canon_8c.html#a144">02276</a> }
02277 
02278 <span class="keyword">static</span> <span class="keywordtype">void</span>
02279 <a class="code" href="print-canon_8c.html#a145">canon_printfunc</a>(<a class="code" href="structstp__vars.html">stp_vars_t</a> *v)
02280 {
02281   <span class="keywordtype">int</span> i;
<a name="l02282"></a><a class="code" href="print-canon_8c.html#a145">02282</a>   <a class="code" href="structcanon__privdata__t.html">canon_privdata_t</a> *pd = (<a class="code" href="structcanon__privdata__t.html">canon_privdata_t</a> *) <a class="code" href="group__vars.html#ga20">stp_get_component_data</a>(v, <span class="stringliteral">"Driver"</span>);
02283   <a class="code" href="print-canon_8c.html#a105">canon_write_line</a>(v);
02284   <span class="keywordflow">for</span> (i = 0; i &lt; 7; i++)
02285     <a class="code" href="print-canon_8c.html#a143">canon_advance_buffer</a>(pd-&gt;<a class="code" href="structcanon__privdata__t.html#o1">cols</a>[i], pd-&gt;<a class="code" href="structcanon__privdata__t.html#o4">buf_length</a>, pd-&gt;<a class="code" href="structcanon__privdata__t.html#o2">delay</a>[i]);
02286 
02287 }
02288 
02289 <span class="keyword">static</span> <span class="keywordtype">double</span>
02290 <a class="code" href="print-pcl_8c.html#a140">get_double_param</a>(<a class="code" href="structstp__vars.html">stp_vars_t</a> *v, <span class="keyword">const</span> <span class="keywordtype">char</span> *param)
02291 {
02292   <span class="keywordflow">if</span> (param &amp;&amp; <a class="code" href="group__vars.html#ga102">stp_check_float_parameter</a>(v, param, STP_PARAMETER_ACTIVE))
<a name="l02293"></a><a class="code" href="print-canon_8c.html#a146">02293</a>     <span class="keywordflow">return</span> <a class="code" href="group__vars.html#ga70">stp_get_float_parameter</a>(v, param);
02294   <span class="keywordflow">else</span>
02295     <span class="keywordflow">return</span> 1.0;
02296 }
02297 
02298 <span class="keyword">static</span> <span class="keywordtype">void</span>
02299 <a class="code" href="print-canon_8c.html#a147">set_ink_ranges</a>(<a class="code" href="structstp__vars.html">stp_vars_t</a> *v, <span class="keyword">const</span> <a class="code" href="structcanon__variable__ink.html">canon_variable_ink_t</a> *ink, <span class="keywordtype">int</span> color,
02300                <span class="keyword">const</span> <span class="keywordtype">char</span> *channel_param, <span class="keyword">const</span> <span class="keywordtype">char</span> *subchannel_param)
02301 {
<a name="l02302"></a><a class="code" href="print-canon_8c.html#a147">02302</a>   <span class="keywordflow">if</span> (!ink)
02303     <span class="keywordflow">return</span>;
02304   <a class="code" href="dither-inks_8c.html#a11">stp_dither_set_inks_full</a>(v, color, ink-&gt;<a class="code" href="structcanon__variable__ink.html#o2">numshades</a>, ink-&gt;<a class="code" href="structcanon__variable__ink.html#o1">shades</a>, 1.0,
02305                            ink_darknesses[color]);
02306   <a class="code" href="channel_8h.html#a3">stp_channel_set_density_adjustment</a>
02307     (v, color, 1, (<a class="code" href="print-pcl_8c.html#a140">get_double_param</a>(v, channel_param) *
02308                    <a class="code" href="print-pcl_8c.html#a140">get_double_param</a>(v, subchannel_param) *
02309                    <a class="code" href="print-pcl_8c.html#a140">get_double_param</a>(v, <span class="stringliteral">"Density"</span>)));
02310 }
02311 
02312 <span class="comment">/*</span>
02313 <span class="comment"> * 'canon_print()' - Print an image to a CANON printer.</span>
02314 <span class="comment"> */</span>
02315 <span class="keyword">static</span> <span class="keywordtype">int</span>
02316 <a class="code" href="print-canon_8c.html#a148">canon_do_print</a>(<a class="code" href="structstp__vars.html">stp_vars_t</a> *v, <a class="code" href="structstp__image.html">stp_image_t</a> *image)
02317 {
02318   <span class="keywordtype">int</span> i;
<a name="l02319"></a><a class="code" href="print-canon_8c.html#a148">02319</a>   <span class="keywordtype">int</span>           status = 1;
02320   <span class="keywordtype">int</span>           model = <a class="code" href="group__printer.html#ga23">stp_get_model_id</a>(v);
02321   <span class="keyword">const</span> <span class="keywordtype">char</span>    *resolution = <a class="code" href="group__vars.html#ga36">stp_get_string_parameter</a>(v, <span class="stringliteral">"Resolution"</span>);
02322   <span class="keyword">const</span> <span class="keywordtype">char</span>    *media_source = <a class="code" href="group__vars.html#ga36">stp_get_string_parameter</a>(v, <span class="stringliteral">"InputSlot"</span>);
02323   <span class="keyword">const</span> <span class="keywordtype">char</span>    *print_mode = <a class="code" href="group__vars.html#ga36">stp_get_string_parameter</a>(v, <span class="stringliteral">"PrintingMode"</span>);
02324   <span class="keywordtype">int</span> printing_color = 0;
02325   <span class="keyword">const</span> <span class="keywordtype">char</span>    *ink_type = <a class="code" href="group__vars.html#ga36">stp_get_string_parameter</a>(v, <span class="stringliteral">"InkType"</span>);
02326   <span class="keywordtype">int</span>           top = <a class="code" href="group__vars.html#ga20">stp_get_top</a>(v);
02327   <span class="keywordtype">int</span>           left = <a class="code" href="group__vars.html#ga18">stp_get_left</a>(v);
02328   <span class="keywordtype">int</span>           y;              <span class="comment">/* Looping vars */</span>
02329   <span class="keywordtype">int</span>           xdpi, ydpi;     <span class="comment">/* Resolution */</span>
02330   <span class="keywordtype">int</span>           n;              <span class="comment">/* Output number */</span>
02331   <a class="code" href="structcanon__privdata__t.html">canon_privdata_t</a> privdata;
02332   <span class="keywordtype">int</span>           page_width,     <span class="comment">/* Width of page */</span>
02333                 page_height,    <span class="comment">/* Length of page */</span>
02334                 page_left,
02335                 page_top,
02336                 page_right,
02337                 page_bottom,
02338                 page_true_height,       <span class="comment">/* True length of page */</span>
02339                 out_width,      <span class="comment">/* Width of image on page */</span>
02340                 out_height,     <span class="comment">/* Length of image on page */</span>
02341                 out_channels,   <span class="comment">/* Output bytes per pixel */</span>
02342                 length,         <span class="comment">/* Length of raster data */</span>
02343                 errdiv,         <span class="comment">/* Error dividend */</span>
02344                 errmod,         <span class="comment">/* Error modulus */</span>
02345                 errval,         <span class="comment">/* Current error value */</span>
02346                 errline,        <span class="comment">/* Current raster line */</span>
02347                 errlast;        <span class="comment">/* Last raster line loaded */</span>
02348   <span class="keywordtype">unsigned</span>      zero_mask;
02349   <span class="keywordtype">int</span>           bits= 1;
02350   <span class="keywordtype">int</span>           image_height,
02351                 image_width;
02352   <span class="keywordtype">int</span>           res_code;
02353   <span class="keywordtype">int</span>           use_6color= 0;
02354   <span class="keywordtype">double</span>        k_upper, k_lower;
02355   <a class="code" href="structstp__curve.html">stp_curve_t</a> *lum_adjustment = NULL;
02356   <a class="code" href="structstp__curve.html">stp_curve_t</a> *hue_adjustment = NULL;
02357   <a class="code" href="structstp__curve.html">stp_curve_t</a> *sat_adjustment = NULL;
02358 
02359   <a class="code" href="structcanon__init__t.html">canon_init_t</a>  init;
02360   <span class="keyword">const</span> <a class="code" href="structcanon__caps.html">canon_cap_t</a> * caps= <a class="code" href="print-canon_8c.html#a107">canon_get_model_capabilities</a>(model);
02361   <span class="keywordtype">int</span> printhead= <a class="code" href="print-canon_8c.html#a109">canon_printhead_type</a>(ink_type,caps);
02362   <a class="code" href="print-canon_8c.html#a156">colormode_t</a> colormode = <a class="code" href="print-canon_8c.html#a110">canon_printhead_colors</a>(ink_type,caps);
02363   <span class="keyword">const</span> <a class="code" href="structpaper__t.html">paper_t</a> *pt;
02364   <span class="keyword">const</span> <a class="code" href="structcanon__variable__inkset.html">canon_variable_inkset_t</a> *inks;
02365   <span class="keyword">const</span> <a class="code" href="structcanon__res__t.html">canon_res_t</a> *res = <a class="code" href="print-canon_8c.html#a81">canon_resolutions</a>;
02366 
02367   <span class="keywordflow">if</span> (!<a class="code" href="group__vars.html#ga34">stp_verify</a>(v))
02368     {
02369       <a class="code" href="print-util_8c.html#a18">stp_eprintf</a>(v, <span class="stringliteral">"Print options not verified; cannot print.\n"</span>);
02370       <span class="keywordflow">return</span> 0;
02371     }
02372   <span class="keywordflow">if</span> (strcmp(print_mode, <span class="stringliteral">"Color"</span>) == 0)
02373     printing_color = 1;
02374 
02375   <a class="code" href="print-canon_8c.html#a40">PUT</a>(<span class="stringliteral">"top        "</span>,top,72);
02376   <a class="code" href="print-canon_8c.html#a40">PUT</a>(<span class="stringliteral">"left       "</span>,left,72);
02377 
02378   <span class="comment">/*</span>
02379 <span class="comment">  * Setup a read-only pixel region for the entire image...</span>
02380 <span class="comment">  */</span>
02381 
02382   <a class="code" href="group__image.html#ga0">stp_image_init</a>(image);
02383 
02384   <span class="comment">/* force grayscale if image is grayscale</span>
02385 <span class="comment">   *                 or single black cartridge installed</span>
02386 <span class="comment">   */</span>
02387 
02388   <span class="keywordflow">if</span> (printhead == 0 || caps-&gt;<a class="code" href="structcanon__caps.html#o12">inks</a> == <a class="code" href="print-canon_8c.html#a11">CANON_INK_K</a>)
02389     {
02390       printing_color = 0;
02391       <a class="code" href="group__vars.html#ga32">stp_set_string_parameter</a>(v, <span class="stringliteral">"PrintingMode"</span>, <span class="stringliteral">"BW"</span>);
02392     }
02393 
02394   <span class="keywordflow">if</span> (!printing_color)
02395     colormode = <a class="code" href="print-canon_8c.html#a156a94">COLOR_MONOCHROME</a>;
02396 
02397  <span class="comment">/*</span>
02398 <span class="comment">  * Figure out the output resolution...</span>
02399 <span class="comment">  */</span>
02400 
02401   xdpi = -1;
02402   ydpi = -1;
02403   <span class="keywordflow">while</span> (res-&gt;<a class="code" href="structcanon__res__t.html#o0">x</a> &gt; 0) {
02404     <span class="keywordflow">if</span> (strcmp(resolution, res-&gt;<a class="code" href="structcanon__res__t.html#o2">name</a>) == 0 ||
02405         strcmp(resolution, res-&gt;<a class="code" href="structcanon__res__t.html#o4">name_dmt</a>) == 0)
02406       {
02407         xdpi = res-&gt;<a class="code" href="structcanon__res__t.html#o0">x</a>;
02408         ydpi = res-&gt;<a class="code" href="structcanon__res__t.html#o1">y</a>;
02409         <span class="keywordflow">break</span>;
02410       }
02411     res++;
02412   }
02413 
02414   <a class="code" href="print-util_8c.html#a24">stp_deprintf</a>(STP_DBG_CANON,<span class="stringliteral">"canon: resolution=%dx%d\n"</span>,xdpi,ydpi);
02415   <a class="code" href="print-util_8c.html#a24">stp_deprintf</a>(STP_DBG_CANON,<span class="stringliteral">"       rescode   =0x%x\n"</span>,<a class="code" href="print-canon_8c.html#a112">canon_res_code</a>(caps,xdpi,ydpi));
02416   res_code= <a class="code" href="print-canon_8c.html#a112">canon_res_code</a>(caps,xdpi,ydpi);
02417 
02418   <span class="keywordflow">if</span> (strcmp(resolution, res-&gt;<a class="code" href="structcanon__res__t.html#o4">name_dmt</a>) == 0 &amp;&amp;
02419       (caps-&gt;<a class="code" href="structcanon__caps.html#o14">features</a> &amp; <a class="code" href="print-canon_8c.html#a22">CANON_CAP_DMT</a>)) {
02420     bits= 2;
02421     <a class="code" href="print-util_8c.html#a24">stp_deprintf</a>(STP_DBG_CANON,<span class="stringliteral">"canon: using drop modulation technology\n"</span>);
02422   }
02423 
02424  <span class="comment">/*</span>
02425 <span class="comment">  * Compute the output size...</span>
02426 <span class="comment">  */</span>
02427 
02428   out_width = <a class="code" href="group__vars.html#ga22">stp_get_width</a>(v);
02429   out_height = <a class="code" href="group__vars.html#ga24">stp_get_height</a>(v);
02430 
02431   <a class="code" href="print-pcl_8c.html#a135">internal_imageable_area</a>(v, 0, &amp;page_left, &amp;page_right,
02432                           &amp;page_bottom, &amp;page_top);
02433   left -= page_left;
02434   top -= page_top;
02435   page_width = page_right - page_left;
02436   page_height = page_bottom - page_top;
02437 
02438   image_height = <a class="code" href="group__image.html#ga3">stp_image_height</a>(image);
02439   image_width = <a class="code" href="group__image.html#ga2">stp_image_width</a>(image);
02440 
02441   <a class="code" href="group__papersize.html#ga13">stp_default_media_size</a>(v, &amp;n, &amp;page_true_height);
02442 
02443   <a class="code" href="print-canon_8c.html#a40">PUT</a>(<span class="stringliteral">"top        "</span>,top,72);
02444   <a class="code" href="print-canon_8c.html#a40">PUT</a>(<span class="stringliteral">"left       "</span>,left,72);
02445   <a class="code" href="print-canon_8c.html#a40">PUT</a>(<span class="stringliteral">"page_true_height"</span>,page_true_height,72);
02446   <a class="code" href="print-canon_8c.html#a40">PUT</a>(<span class="stringliteral">"out_width "</span>, out_width,xdpi);
02447   <a class="code" href="print-canon_8c.html#a40">PUT</a>(<span class="stringliteral">"out_height"</span>, out_height,ydpi);
02448 
02449   <a class="code" href="print-canon_8c.html#a40">PUT</a>(<span class="stringliteral">"top     "</span>,top,72);
02450   <a class="code" href="print-canon_8c.html#a40">PUT</a>(<span class="stringliteral">"left    "</span>,left,72);
02451 
02452   pt = <a class="code" href="print-lexmark_8c.html#a126">get_media_type</a>(<a class="code" href="group__vars.html#ga36">stp_get_string_parameter</a>(v, <span class="stringliteral">"MediaType"</span>));
02453 
02454   init.<a class="code" href="structcanon__init__t.html#o0">caps</a> = caps;
02455   init.<a class="code" href="structcanon__init__t.html#o1">printing_color</a> = printing_color;
02456   init.<a class="code" href="structcanon__init__t.html#o2">pt</a> = pt;
02457   init.<a class="code" href="structcanon__init__t.html#o3">print_head</a> = printhead;
02458   init.<a class="code" href="structcanon__init__t.html#o4">colormode</a> = colormode;
02459   init.<a class="code" href="structcanon__init__t.html#o5">source_str</a> = media_source;
02460   init.<a class="code" href="structcanon__init__t.html#o6">xdpi</a> = xdpi;
02461   init.<a class="code" href="structcanon__init__t.html#o7">ydpi</a> = ydpi;
02462   init.<a class="code" href="structcanon__init__t.html#o8">page_width</a> = page_width;
02463   init.<a class="code" href="structcanon__init__t.html#o9">page_height</a> = page_height;
02464   init.<a class="code" href="structcanon__init__t.html#o10">top</a> = top;
02465   init.<a class="code" href="structcanon__init__t.html#o11">left</a> = left;
02466   init.<a class="code" href="structcanon__init__t.html#o12">bits</a> = bits;
02467 
02468   <a class="code" href="print-canon_8c.html#a139">canon_init_printer</a>(v, &amp;init);
02469 
02470   <span class="comment">/* possibly changed during initialitation</span>
02471 <span class="comment">   * to enforce valid modes of operation:</span>
02472 <span class="comment">   */</span>
02473   bits= init.<a class="code" href="structcanon__init__t.html#o12">bits</a>;
02474   xdpi= init.<a class="code" href="structcanon__init__t.html#o6">xdpi</a>;
02475   ydpi= init.<a class="code" href="structcanon__init__t.html#o7">ydpi</a>;
02476 
02477  <span class="comment">/*</span>
02478 <span class="comment">  * Convert image size to printer resolution...</span>
02479 <span class="comment">  */</span>
02480 
02481   out_width  = xdpi * out_width / 72;
02482   out_height = ydpi * out_height / 72;
02483 
02484   <a class="code" href="print-canon_8c.html#a40">PUT</a>(<span class="stringliteral">"out_width "</span>, out_width,xdpi);
02485   <a class="code" href="print-canon_8c.html#a40">PUT</a>(<span class="stringliteral">"out_height"</span>, out_height,ydpi);
02486 
02487   left = xdpi * left / 72;
02488 
02489   <a class="code" href="print-canon_8c.html#a40">PUT</a>(<span class="stringliteral">"leftskip"</span>,left,xdpi);
02490 
02491   <span class="keywordflow">for</span> (i = 0; i &lt; 7; i++)
02492     privdata.<a class="code" href="structcanon__privdata__t.html#o1">cols</a>[i] = NULL;
02493 
02494   <span class="keywordflow">if</span>(xdpi==1440){
02495     privdata.<a class="code" href="structcanon__privdata__t.html#o2">delay</a>[0] = 0;
02496     privdata.<a class="code" href="structcanon__privdata__t.html#o2">delay</a>[1] = 112;
02497     privdata.<a class="code" href="structcanon__privdata__t.html#o2">delay</a>[2] = 224;
02498     privdata.<a class="code" href="structcanon__privdata__t.html#o2">delay</a>[3] = 336;
02499     privdata.<a class="code" href="structcanon__privdata__t.html#o2">delay</a>[4] = 112;
02500     privdata.<a class="code" href="structcanon__privdata__t.html#o2">delay</a>[5] = 224;
02501     privdata.<a class="code" href="structcanon__privdata__t.html#o2">delay</a>[6] = 336;
02502     privdata.<a class="code" href="structcanon__privdata__t.html#o3">delay_max</a> = 336;
02503     <a class="code" href="print-util_8c.html#a24">stp_deprintf</a>(STP_DBG_CANON,<span class="stringliteral">"canon: delay on!\n"</span>);
02504   } <span class="keywordflow">else</span> {
02505     <span class="keywordflow">for</span> (i = 0; i &lt; 7; i++)
02506       privdata.<a class="code" href="structcanon__privdata__t.html#o2">delay</a>[i] = 0;
02507     privdata.<a class="code" href="structcanon__privdata__t.html#o3">delay_max</a> = 0;
02508     <a class="code" href="print-util_8c.html#a24">stp_deprintf</a>(STP_DBG_CANON,<span class="stringliteral">"canon: delay off!\n"</span>);
02509   }
02510 
02511  <span class="comment">/*</span>
02512 <span class="comment">  * Allocate memory for the raster data...</span>
02513 <span class="comment">  */</span>
02514 
02515   length = (out_width + 7) / 8;
02516 
02517   privdata.<a class="code" href="structcanon__privdata__t.html#o4">buf_length</a>= length*bits;
02518   privdata.<a class="code" href="structcanon__privdata__t.html#o6">left</a> = left;
02519   privdata.<a class="code" href="structcanon__privdata__t.html#o8">bits</a> = bits;
02520   privdata.<a class="code" href="structcanon__privdata__t.html#o5">out_width</a> = out_width;
02521   privdata.<a class="code" href="structcanon__privdata__t.html#o0">caps</a> = caps;
02522   privdata.<a class="code" href="structcanon__privdata__t.html#o9">ydpi</a> = ydpi;
02523 
02524   <a class="code" href="print-util_8c.html#a24">stp_deprintf</a>(STP_DBG_CANON,<span class="stringliteral">"canon: buflength is %d!\n"</span>,privdata.<a class="code" href="structcanon__privdata__t.html#o4">buf_length</a>);
02525 
02526   <span class="keywordflow">if</span> (colormode==<a class="code" href="print-canon_8c.html#a156a94">COLOR_MONOCHROME</a>) {
02527     <a class="code" href="print-canon_8c.html#a144">setup_column</a>(&amp;privdata, 0, privdata.<a class="code" href="structcanon__privdata__t.html#o4">buf_length</a>);
02528   } <span class="keywordflow">else</span> {
02529     <a class="code" href="print-canon_8c.html#a144">setup_column</a>(&amp;privdata, 1, privdata.<a class="code" href="structcanon__privdata__t.html#o4">buf_length</a>);
02530     <a class="code" href="print-canon_8c.html#a144">setup_column</a>(&amp;privdata, 2, privdata.<a class="code" href="structcanon__privdata__t.html#o4">buf_length</a>);
02531     <a class="code" href="print-canon_8c.html#a144">setup_column</a>(&amp;privdata, 3, privdata.<a class="code" href="structcanon__privdata__t.html#o4">buf_length</a>);
02532 
02533     <span class="keywordflow">if</span> (colormode!=<a class="code" href="print-canon_8c.html#a156a95">COLOR_CMY</a>)
02534       <a class="code" href="print-canon_8c.html#a144">setup_column</a>(&amp;privdata, 0, privdata.<a class="code" href="structcanon__privdata__t.html#o4">buf_length</a>);
02535 
02536     <span class="keywordflow">if</span> (colormode==<a class="code" href="print-canon_8c.html#a156a97">COLOR_CCMMYK</a> || colormode==<a class="code" href="print-canon_8c.html#a156a98">COLOR_CCMMYYK</a>) {
02537       use_6color= 1;
02538       <a class="code" href="print-canon_8c.html#a144">setup_column</a>(&amp;privdata, 4, privdata.<a class="code" href="structcanon__privdata__t.html#o4">buf_length</a>);
02539       <a class="code" href="print-canon_8c.html#a144">setup_column</a>(&amp;privdata, 5, privdata.<a class="code" href="structcanon__privdata__t.html#o4">buf_length</a>);
02540       <span class="keywordflow">if</span> (colormode==<a class="code" href="print-canon_8c.html#a15">CANON_INK_CcMmYyK</a>)
02541         <a class="code" href="print-canon_8c.html#a144">setup_column</a>(&amp;privdata, 6, privdata.<a class="code" href="structcanon__privdata__t.html#o4">buf_length</a>);
02542     }
02543   }
02544 
02545   <span class="keywordflow">if</span> (privdata.<a class="code" href="structcanon__privdata__t.html#o1">cols</a>[0])
02546     {
02547       <span class="keywordflow">if</span> (privdata.<a class="code" href="structcanon__privdata__t.html#o1">cols</a>[1])
02548         <a class="code" href="group__vars.html#ga32">stp_set_string_parameter</a>(v, <span class="stringliteral">"STPIOutputType"</span>, <span class="stringliteral">"KCMY"</span>);
02549       <span class="keywordflow">else</span>
02550         <a class="code" href="group__vars.html#ga32">stp_set_string_parameter</a>(v, <span class="stringliteral">"STPIOutputType"</span>, <span class="stringliteral">"Grayscale"</span>);
02551     }
02552   <span class="keywordflow">else</span>
02553     <a class="code" href="group__vars.html#ga32">stp_set_string_parameter</a>(v, <span class="stringliteral">"STPIOutputType"</span>, <span class="stringliteral">"CMY"</span>);
02554 
02555   <a class="code" href="print-util_8c.html#a24">stp_deprintf</a>(STP_DBG_CANON,
02556                <span class="stringliteral">"canon: driver will use colors %s%s%s%s%s%s%s\n"</span>,
02557                privdata.<a class="code" href="structcanon__privdata__t.html#o1">cols</a>[0] ? <span class="stringliteral">"K"</span> : <span class="stringliteral">""</span>,
02558                privdata.<a class="code" href="structcanon__privdata__t.html#o1">cols</a>[1] ? <span class="stringliteral">"C"</span> : <span class="stringliteral">""</span>,
02559                privdata.<a class="code" href="structcanon__privdata__t.html#o1">cols</a>[2] ? <span class="stringliteral">"M"</span> : <span class="stringliteral">""</span>,
02560                privdata.<a class="code" href="structcanon__privdata__t.html#o1">cols</a>[3] ? <span class="stringliteral">"Y"</span> : <span class="stringliteral">""</span>,
02561                privdata.<a class="code" href="structcanon__privdata__t.html#o1">cols</a>[4] ? <span class="stringliteral">"c"</span> : <span class="stringliteral">""</span>,
02562                privdata.<a class="code" href="structcanon__privdata__t.html#o1">cols</a>[5] ? <span class="stringliteral">"m"</span> : <span class="stringliteral">""</span>,
02563                privdata.<a class="code" href="structcanon__privdata__t.html#o1">cols</a>[6] ? <span class="stringliteral">"y"</span> : <span class="stringliteral">""</span>);
02564 
02565   <a class="code" href="print-util_8c.html#a24">stp_deprintf</a>(STP_DBG_CANON,<span class="stringliteral">"density is %f\n"</span>,
02566                <a class="code" href="group__vars.html#ga70">stp_get_float_parameter</a>(v, <span class="stringliteral">"Density"</span>));
02567 
02568   <span class="comment">/*</span>
02569 <span class="comment">   * Compute the LUT.  For now, it's 8 bit, but that may eventually</span>
02570 <span class="comment">   * sometimes change.</span>
02571 <span class="comment">   */</span>
02572 
02573   <span class="keywordflow">if</span> (!<a class="code" href="group__vars.html#ga102">stp_check_float_parameter</a>(v, <span class="stringliteral">"Density"</span>, STP_PARAMETER_DEFAULTED))
02574     {
02575       <a class="code" href="group__vars.html#ga93">stp_set_float_parameter_active</a>(v, <span class="stringliteral">"Density"</span>, STP_PARAMETER_ACTIVE);
02576       <a class="code" href="group__vars.html#ga67">stp_set_float_parameter</a>(v, <span class="stringliteral">"Density"</span>, 1.0);
02577     }
02578   <span class="keywordflow">if</span> (pt)
02579     <a class="code" href="group__vars.html#ga71">stp_scale_float_parameter</a>(v, <span class="stringliteral">"Density"</span>, pt-&gt;<a class="code" href="structpaper__t.html#o3">base_density</a>);
02580   <span class="keywordflow">else</span>                  <span class="comment">/* Can't find paper type? Assume plain */</span>
02581     <a class="code" href="group__vars.html#ga71">stp_scale_float_parameter</a>(v, <span class="stringliteral">"Density"</span>, .5);
02582   <a class="code" href="group__vars.html#ga71">stp_scale_float_parameter</a>(v, <span class="stringliteral">"Density"</span>, <a class="code" href="print-canon_8c.html#a117">canon_density</a>(caps, res_code));
02583   <span class="keywordflow">if</span> (<a class="code" href="group__vars.html#ga70">stp_get_float_parameter</a>(v, <span class="stringliteral">"Density"</span>) &gt; 1.0)
02584     <a class="code" href="group__vars.html#ga67">stp_set_float_parameter</a>(v, <span class="stringliteral">"Density"</span>, 1.0);
02585   <span class="keywordflow">if</span> (colormode == <a class="code" href="print-canon_8c.html#a156a94">COLOR_MONOCHROME</a>)
02586     <a class="code" href="group__vars.html#ga71">stp_scale_float_parameter</a>(v, <span class="stringliteral">"Gamma"</span>, 1.25);
02587 
02588   <a class="code" href="print-util_8c.html#a24">stp_deprintf</a>(STP_DBG_CANON,<span class="stringliteral">"density is %f\n"</span>,
02589                <a class="code" href="group__vars.html#ga70">stp_get_float_parameter</a>(v, <span class="stringliteral">"Density"</span>));
02590 
02591  <span class="comment">/*</span>
02592 <span class="comment">  * Output the page...</span>
02593 <span class="comment">  */</span>
02594 
02595 
02596   <span class="keywordflow">if</span> (use_6color)
02597     k_lower = .4 / bits + .1;
02598   <span class="keywordflow">else</span>
02599     k_lower = .25 / bits;
02600   <span class="keywordflow">if</span> (pt)
02601     {
02602       k_lower *= pt-&gt;<a class="code" href="structpaper__t.html#o4">k_lower_scale</a>;
02603       k_upper = pt-&gt;<a class="code" href="structpaper__t.html#o5">k_upper</a>;
02604     }
02605   <span class="keywordflow">else</span>
02606     {
02607       k_lower *= .5;
02608       k_upper = .5;
02609     }
02610   <span class="keywordflow">if</span> (!<a class="code" href="group__vars.html#ga102">stp_check_float_parameter</a>(v, <span class="stringliteral">"GCRLower"</span>, STP_PARAMETER_ACTIVE))
02611     <a class="code" href="group__vars.html#ga68">stp_set_default_float_parameter</a>(v, <span class="stringliteral">"GCRLower"</span>, k_lower);
02612   <span class="keywordflow">if</span> (!<a class="code" href="group__vars.html#ga102">stp_check_float_parameter</a>(v, <span class="stringliteral">"GCRUpper"</span>, STP_PARAMETER_ACTIVE))
02613     <a class="code" href="group__vars.html#ga68">stp_set_default_float_parameter</a>(v, <span class="stringliteral">"GCRUpper"</span>, k_upper);
02614   <a class="code" href="dither-main_8c.html#a13">stp_dither_init</a>(v, image, out_width, xdpi, ydpi);
02615 
02616   <span class="keywordflow">for</span> (i = 0; i &lt; 7; i++)
02617     {
02618       <span class="keywordflow">if</span> (privdata.<a class="code" href="structcanon__privdata__t.html#o1">cols</a>[i])
02619         <a class="code" href="dither-inks_8c.html#a7">stp_dither_add_channel</a>(v, privdata.<a class="code" href="structcanon__privdata__t.html#o1">cols</a>[i], channel_color_map[i],
02620                                subchannel_color_map[i]);
02621     }
02622 
02623   <span class="keywordflow">if</span> ((inks = <a class="code" href="print-canon_8c.html#a118">canon_inks</a>(caps, res_code, colormode, bits))!=0)
02624     {
02625       <a class="code" href="print-canon_8c.html#a147">set_ink_ranges</a>(v, inks-&gt;<a class="code" href="structcanon__variable__inkset.html#o0">c</a>, STP_ECOLOR_C, <span class="stringliteral">"MagentaDensity"</span>,
02626                      <span class="stringliteral">"LightCyanTransition"</span>);
02627       <a class="code" href="print-canon_8c.html#a147">set_ink_ranges</a>(v, inks-&gt;<a class="code" href="structcanon__variable__inkset.html#o1">m</a>, STP_ECOLOR_M, <span class="stringliteral">"MagentaDensity"</span>,
02628                      <span class="stringliteral">"LightMagentaTransition"</span>);
02629       <a class="code" href="print-canon_8c.html#a147">set_ink_ranges</a>(v, inks-&gt;<a class="code" href="structcanon__variable__inkset.html#o2">y</a>, STP_ECOLOR_Y, <span class="stringliteral">"YellowDensity"</span>,
02630                      <span class="stringliteral">"LightYellowTransition"</span>);
02631       <a class="code" href="print-canon_8c.html#a147">set_ink_ranges</a>(v, inks-&gt;<a class="code" href="structcanon__variable__inkset.html#o3">k</a>, STP_ECOLOR_K, <span class="stringliteral">"BlackDensity"</span>, NULL);
02632     }
02633   <a class="code" href="channel_8h.html#a3">stp_channel_set_density_adjustment</a>
02634     (v, <a class="code" href="dither_8h.html#a1">STP_ECOLOR_C</a>, 0,
02635      <a class="code" href="print-pcl_8c.html#a140">get_double_param</a>(v, <span class="stringliteral">"CyanDensity"</span>) * <a class="code" href="print-pcl_8c.html#a140">get_double_param</a>(v, <span class="stringliteral">"Density"</span>));
02636   <a class="code" href="channel_8h.html#a3">stp_channel_set_density_adjustment</a>
02637     (v, <a class="code" href="dither_8h.html#a2">STP_ECOLOR_M</a>, 0,
02638      <a class="code" href="print-pcl_8c.html#a140">get_double_param</a>(v, <span class="stringliteral">"MagentaDensity"</span>) * <a class="code" href="print-pcl_8c.html#a140">get_double_param</a>(v, <span class="stringliteral">"Density"</span>));
02639   <a class="code" href="channel_8h.html#a3">stp_channel_set_density_adjustment</a>
02640     (v, <a class="code" href="dither_8h.html#a3">STP_ECOLOR_Y</a>, 0,
02641      <a class="code" href="print-pcl_8c.html#a140">get_double_param</a>(v, <span class="stringliteral">"YellowDensity"</span>) * <a class="code" href="print-pcl_8c.html#a140">get_double_param</a>(v, <span class="stringliteral">"Density"</span>));
02642   <a class="code" href="channel_8h.html#a3">stp_channel_set_density_adjustment</a>
02643     (v, <a class="code" href="dither_8h.html#a0">STP_ECOLOR_K</a>, 0,
02644      <a class="code" href="print-pcl_8c.html#a140">get_double_param</a>(v, <span class="stringliteral">"BlackDensity"</span>) * <a class="code" href="print-pcl_8c.html#a140">get_double_param</a>(v, <span class="stringliteral">"Density"</span>));
02645 
02646   errdiv  = image_height / out_height;
02647   errmod  = image_height % out_height;
02648   errval  = 0;
02649   errlast = -1;
02650   errline  = 0;
02651 
02652   <span class="keywordflow">if</span> (!<a class="code" href="group__vars.html#ga106">stp_check_curve_parameter</a>(v, <span class="stringliteral">"HueMap"</span>, STP_PARAMETER_ACTIVE) &amp;&amp;
02653       pt-&gt;<a class="code" href="structpaper__t.html#o6">hue_adjustment</a>)
02654     {
02655       hue_adjustment = <a class="code" href="group__util.html#ga2">stp_read_and_compose_curves</a>
02656         (<a class="code" href="print-canon_8c.html#a115">canon_hue_adjustment</a>(model),
02657          pt ? pt-&gt;<a class="code" href="structpaper__t.html#o6">hue_adjustment</a> : NULL, <a class="code" href="group__curve.html#gga49a5">STP_CURVE_COMPOSE_ADD</a>, 384);
02658       <a class="code" href="group__vars.html#ga47">stp_set_curve_parameter</a>(v, <span class="stringliteral">"HueMap"</span>, hue_adjustment);
02659       <a class="code" href="group__curve.html#ga22">stp_curve_destroy</a>(hue_adjustment);
02660     }
02661   <span class="keywordflow">if</span> (!<a class="code" href="group__vars.html#ga106">stp_check_curve_parameter</a>(v, <span class="stringliteral">"LumMap"</span>, STP_PARAMETER_ACTIVE) &amp;&amp;
02662       pt-&gt;<a class="code" href="structpaper__t.html#o7">lum_adjustment</a>)
02663     {
02664       lum_adjustment = <a class="code" href="group__util.html#ga2">stp_read_and_compose_curves</a>
02665         (<a class="code" href="print-canon_8c.html#a114">canon_lum_adjustment</a>(model),
02666          pt ? pt-&gt;<a class="code" href="structpaper__t.html#o7">lum_adjustment</a> : NULL, <a class="code" href="group__curve.html#gga49a6">STP_CURVE_COMPOSE_MULTIPLY</a>, 384);
02667       <a class="code" href="group__vars.html#ga47">stp_set_curve_parameter</a>(v, <span class="stringliteral">"LumMap"</span>, lum_adjustment);
02668       <a class="code" href="group__curve.html#ga22">stp_curve_destroy</a>(lum_adjustment);
02669     }
02670   <span class="keywordflow">if</span> (!<a class="code" href="group__vars.html#ga106">stp_check_curve_parameter</a>(v, <span class="stringliteral">"SatMap"</span>, STP_PARAMETER_ACTIVE) &amp;&amp;
02671       pt-&gt;<a class="code" href="structpaper__t.html#o8">sat_adjustment</a>)
02672     {
02673       sat_adjustment = <a class="code" href="group__util.html#ga2">stp_read_and_compose_curves</a>
02674         (<a class="code" href="print-canon_8c.html#a116">canon_sat_adjustment</a>(model),
02675          pt ? pt-&gt;<a class="code" href="structpaper__t.html#o8">sat_adjustment</a> : NULL, <a class="code" href="group__curve.html#gga49a6">STP_CURVE_COMPOSE_MULTIPLY</a>, 384);
02676       <a class="code" href="group__vars.html#ga47">stp_set_curve_parameter</a>(v, <span class="stringliteral">"SatMap"</span>, sat_adjustment);
02677       <a class="code" href="group__curve.html#ga22">stp_curve_destroy</a>(sat_adjustment);
02678     }
02679 
02680   out_channels = <a class="code" href="group__color.html#ga13">stp_color_init</a>(v, image, 65536);
02681   <a class="code" href="group__vars.html#ga18">stp_allocate_component_data</a>(v, <span class="stringliteral">"Driver"</span>, NULL, NULL, &amp;privdata);
02682 
02683   privdata.<a class="code" href="structcanon__privdata__t.html#o7">emptylines</a> = 0;
02684   <span class="keywordflow">for</span> (y = 0; y &lt; out_height; y ++)
02685   {
02686     <span class="keywordtype">int</span> duplicate_line = 1;
02687 
02688     <span class="keywordflow">if</span> (errline != errlast)
02689     {
02690       errlast = errline;
02691       duplicate_line = 0;
02692       <span class="keywordflow">if</span> (<a class="code" href="group__color.html#ga14">stp_color_get_row</a>(v, image, errline, &amp;zero_mask))
02693         {
02694           status = 2;
02695           <span class="keywordflow">break</span>;
02696         }
02697     }
02698 
02699     <a class="code" href="dither-main_8c.html#a19">stp_dither</a>(v, y, duplicate_line, zero_mask, NULL);
02700     <a class="code" href="print-canon_8c.html#a145">canon_printfunc</a>(v);
02701     errval += errmod;
02702     errline += errdiv;
02703     <span class="keywordflow">if</span> (errval &gt;= out_height)
02704     {
02705       errval -= out_height;
02706       errline ++;
02707     }
02708   }
02709 
02710   <span class="comment">/*</span>
02711 <span class="comment">   * Flush delayed buffers...</span>
02712 <span class="comment">   */</span>
02713 
02714   <span class="keywordflow">if</span> (privdata.<a class="code" href="structcanon__privdata__t.html#o3">delay_max</a>) {
02715     <a class="code" href="print-util_8c.html#a24">stp_deprintf</a>(STP_DBG_CANON,<span class="stringliteral">"\ncanon: flushing %d possibly delayed buffers\n"</span>,
02716                  privdata.<a class="code" href="structcanon__privdata__t.html#o3">delay_max</a>);
02717     <span class="keywordflow">for</span> (y= 0; y&lt;privdata.<a class="code" href="structcanon__privdata__t.html#o3">delay_max</a>; y++) {
02718 
02719       <a class="code" href="print-canon_8c.html#a105">canon_write_line</a>(v);
02720       <span class="keywordflow">for</span> (i = 0; i &lt; 7; i++)
02721         <a class="code" href="print-canon_8c.html#a143">canon_advance_buffer</a>(privdata.<a class="code" href="structcanon__privdata__t.html#o1">cols</a>[i], privdata.<a class="code" href="structcanon__privdata__t.html#o4">buf_length</a>,
02722                              privdata.<a class="code" href="structcanon__privdata__t.html#o2">delay</a>[i]);
02723     }
02724   }
02725 
02726   <a class="code" href="group__image.html#ga6">stp_image_conclude</a>(image);
02727 
02728  <span class="comment">/*</span>
02729 <span class="comment">  * Cleanup...</span>
02730 <span class="comment">  */</span>
02731 
02732   <span class="keywordflow">for</span> (i = 0; i &lt; 7; i++)
02733     <span class="keywordflow">if</span> (privdata.<a class="code" href="structcanon__privdata__t.html#o1">cols</a>[i])
02734       <a class="code" href="group__util.html#ga31">stp_free</a>(privdata.<a class="code" href="structcanon__privdata__t.html#o1">cols</a>[i]);
02735 
02736   <a class="code" href="print-canon_8c.html#a140">canon_deinit_printer</a>(v, &amp;init);
02737   <span class="keywordflow">return</span> status;
02738 }
02739 
02740 <span class="keyword">static</span> <span class="keywordtype">int</span>
02741 <a class="code" href="print-canon_8c.html#a149">canon_print</a>(<span class="keyword">const</span> <a class="code" href="structstp__vars.html">stp_vars_t</a> *v, <a class="code" href="structstp__image.html">stp_image_t</a> *image)
02742 {
02743   <span class="keywordtype">int</span> status;
<a name="l02744"></a><a class="code" href="print-canon_8c.html#a149">02744</a>   <a class="code" href="structstp__vars.html">stp_vars_t</a> *nv = <a class="code" href="group__vars.html#ga78">stp_vars_create_copy</a>(v);
02745   <a class="code" href="group__util.html#ga77">stp_prune_inactive_options</a>(nv);
02746   status = <a class="code" href="print-canon_8c.html#a148">canon_do_print</a>(nv, image);
02747   <a class="code" href="group__vars.html#ga26">stp_vars_destroy</a>(nv);
02748   <span class="keywordflow">return</span> status;
02749 }
02750 
02751 <span class="keyword">static</span> <span class="keyword">const</span> <a class="code" href="structstp__printfuncs__t.html">stp_printfuncs_t</a> <a class="code" href="print-canon_8c.html#a90">print_canon_printfuncs</a> =
02752 {
02753   <a class="code" href="print-canon_8c.html#a121">canon_list_parameters</a>,
<a name="l02754"></a><a class="code" href="print-canon_8c.html#a90">02754</a>   <a class="code" href="print-canon_8c.html#a122">canon_parameters</a>,
02755   <a class="code" href="group__papersize.html#ga4">stp_default_media_size</a>,
02756   <a class="code" href="print-canon_8c.html#a124">canon_imageable_area</a>,
02757   <a class="code" href="print-canon_8c.html#a125">canon_limit</a>,
02758   <a class="code" href="print-canon_8c.html#a149">canon_print</a>,
02759   <a class="code" href="print-canon_8c.html#a119">canon_describe_resolution</a>,
02760   <a class="code" href="print-canon_8c.html#a120">canon_describe_output</a>,
02761   <a class="code" href="group__printer.html#ga19">stp_verify_printer_params</a>,
02762   <a class="code" href="print-canon_8c.html#a141">canon_start_job</a>,
02763   <a class="code" href="print-canon_8c.html#a142">canon_end_job</a>
02764 };
02765 
02766 <span class="comment">/*</span>
02767 <span class="comment"> * 'canon_fold_lsb_msb()' fold 2 lines in order lsb/msb</span>
02768 <span class="comment"> */</span>
02769 
02770 <span class="keyword">static</span> <span class="keywordtype">void</span>
02771 <a class="code" href="print-canon_8c.html#a150">canon_fold_2bit</a>(<span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">char</span> *line,
02772                 <span class="keywordtype">int</span> single_length,
02773                 <span class="keywordtype">unsigned</span> <span class="keywordtype">char</span> *outbuf)
<a name="l02774"></a><a class="code" href="print-canon_8c.html#a150">02774</a> {
02775   <span class="keywordtype">int</span> i;
02776   <span class="keywordflow">for</span> (i = 0; i &lt; single_length; i++) {
02777     outbuf[0] =
02778       ((line[0] &amp; (1 &lt;&lt; 7)) &gt;&gt; 1) |
02779       ((line[0] &amp; (1 &lt;&lt; 6)) &gt;&gt; 2) |
02780       ((line[0] &amp; (1 &lt;&lt; 5)) &gt;&gt; 3) |
02781       ((line[0] &amp; (1 &lt;&lt; 4)) &gt;&gt; 4) |
02782       ((line[single_length] &amp; (1 &lt;&lt; 7)) &gt;&gt; 0) |
02783       ((line[single_length] &amp; (1 &lt;&lt; 6)) &gt;&gt; 1) |
02784       ((line[single_length] &amp; (1 &lt;&lt; 5)) &gt;&gt; 2) |
02785       ((line[single_length] &amp; (1 &lt;&lt; 4)) &gt;&gt; 3);
02786     outbuf[1] =
02787       ((line[0] &amp; (1 &lt;&lt; 3)) &lt;&lt; 3) |
02788       ((line[0] &amp; (1 &lt;&lt; 2)) &lt;&lt; 2) |
02789       ((line[0] &amp; (1 &lt;&lt; 1)) &lt;&lt; 1) |
02790       ((line[0] &amp; (1 &lt;&lt; 0)) &lt;&lt; 0) |
02791       ((line[single_length] &amp; (1 &lt;&lt; 3)) &lt;&lt; 4) |
02792       ((line[single_length] &amp; (1 &lt;&lt; 2)) &lt;&lt; 3) |
02793       ((line[single_length] &amp; (1 &lt;&lt; 1)) &lt;&lt; 2) |
02794       ((line[single_length] &amp; (1 &lt;&lt; 0)) &lt;&lt; 1);
02795     line++;
02796     outbuf += 2;
02797   }
02798 }
02799 
02800 <span class="preprocessor">#ifndef USE_3BIT_FOLD_TYPE</span>
02801 <span class="preprocessor"></span><span class="preprocessor">#error YOU MUST CHOOSE A VALUE FOR USE_3BIT_FOLD_TYPE</span>
02802 <span class="preprocessor"></span><span class="preprocessor">#endif</span>
02803 <span class="preprocessor"></span>
02804 <span class="preprocessor">#if USE_3BIT_FOLD_TYPE == 333</span>
02805 <span class="preprocessor"></span>
02806 <span class="keyword">static</span> <span class="keywordtype">void</span>
02807 <a class="code" href="print-canon_8c.html#a151">canon_fold_3bit</a>(<span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">char</span> *line,
02808                 <span class="keywordtype">int</span> single_length,
02809                 <span class="keywordtype">unsigned</span> <span class="keywordtype">char</span> *outbuf)
02810 {
02811   <span class="keywordtype">int</span> i;
02812   <span class="keywordflow">for</span> (i = 0; i &lt; single_length; i++) {
02813     outbuf[0] =
02814       ((line[0] &amp; (1 &lt;&lt; 7)) &gt;&gt; 2) |
02815       ((line[0] &amp; (1 &lt;&lt; 6)) &gt;&gt; 4) |
02816       ((line[single_length] &amp; (1 &lt;&lt; 7)) &gt;&gt; 1) |
02817       ((line[single_length] &amp; (1 &lt;&lt; 6)) &gt;&gt; 3) |
02818       ((line[single_length] &amp; (1 &lt;&lt; 5)) &gt;&gt; 5) |
02819       ((line[2*single_length] &amp; (1 &lt;&lt; 7)) &lt;&lt; 0) |
02820       ((line[2*single_length] &amp; (1 &lt;&lt; 6)) &gt;&gt; 2) |
02821       ((line[2*single_length] &amp; (1 &lt;&lt; 5)) &gt;&gt; 4);
02822     outbuf[1] =
02823       ((line[0] &amp; (1 &lt;&lt; 5)) &lt;&lt; 2) |
02824       ((line[0] &amp; (1 &lt;&lt; 4)) &lt;&lt; 0) |
02825       ((line[0] &amp; (1 &lt;&lt; 3)) &gt;&gt; 2) |
02826       ((line[single_length] &amp; (1 &lt;&lt; 4)) &lt;&lt; 1) |
02827       ((line[single_length] &amp; (1 &lt;&lt; 3)) &gt;&gt; 1) |
02828       ((line[2*single_length] &amp; (1 &lt;&lt; 4)) &lt;&lt; 2) |
02829       ((line[2*single_length] &amp; (1 &lt;&lt; 3)) &lt;&lt; 0) |
02830       ((line[2*single_length] &amp; (1 &lt;&lt; 2)) &gt;&gt; 2);
02831     outbuf[2] =
02832       ((line[0] &amp; (1 &lt;&lt; 2)) &lt;&lt; 4) |
02833       ((line[0] &amp; (1 &lt;&lt; 1)) &lt;&lt; 2) |
02834       ((line[0] &amp; (1 &lt;&lt; 0)) &lt;&lt; 0) |
02835       ((line[single_length] &amp; (1 &lt;&lt; 2)) &lt;&lt; 5) |
02836       ((line[single_length] &amp; (1 &lt;&lt; 1)) &lt;&lt; 3) |
02837       ((line[single_length] &amp; (1 &lt;&lt; 0)) &lt;&lt; 1) |
02838       ((line[2*single_length] &amp; (1 &lt;&lt; 1)) &lt;&lt; 4) |
02839       ((line[2*single_length] &amp; (1 &lt;&lt; 0)) &lt;&lt; 2);
02840     line++;
02841     outbuf += 3;
02842   }
02843 }
02844 
02845 <span class="preprocessor">#elif USE_3BIT_FOLD_TYPE == 323</span>
02846 <span class="preprocessor"></span>
02847 <span class="keyword">static</span> <span class="keywordtype">void</span>
02848 <a class="code" href="print-canon_8c.html#a151">canon_fold_3bit</a>(<span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">char</span> *line,
02849                 <span class="keywordtype">int</span> single_length,
02850                 <span class="keywordtype">unsigned</span> <span class="keywordtype">char</span> *outbuf)
<a name="l02851"></a><a class="code" href="print-canon_8c.html#a151">02851</a> {
02852   <span class="keywordtype">unsigned</span> <span class="keywordtype">char</span> A0,A1,A2,B0,B1,B2,C0,C1,C2;
02853   <span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">char</span> *last= line+single_length;
02854 
02855   <span class="keywordflow">for</span> (; line &lt; last; line+=3, outbuf+=8) {
02856 
02857     A0= line[0]; B0= line[single_length]; C0= line[2*single_length];
02858 
02859     <span class="keywordflow">if</span> (line&lt;last-2) {
02860       A1= line[1]; B1= line[single_length+1]; C1= line[2*single_length+1];
02861     } <span class="keywordflow">else</span> {
02862       A1= 0; B1= 0; C1= 0;
02863     }
02864     <span class="keywordflow">if</span> (line&lt;last-1) {
02865       A2= line[2]; B2= line[single_length+2]; C2= line[2*single_length+2];
02866     } <span class="keywordflow">else</span> {
02867       A2= 0; B2= 0; C2= 0;
02868     }
02869 
02870     outbuf[0] =
02871       ((C0 &amp; 0x80) &gt;&gt; 0) |
02872       ((B0 &amp; 0x80) &gt;&gt; 1) |
02873       ((A0 &amp; 0x80) &gt;&gt; 2) |
02874       ((B0 &amp; 0x40) &gt;&gt; 2) |
02875       ((A0 &amp; 0x40) &gt;&gt; 3) |
02876       ((C0 &amp; 0x20) &gt;&gt; 3) |
02877       ((B0 &amp; 0x20) &gt;&gt; 4) |
02878       ((A0 &amp; 0x20) &gt;&gt; 5);
02879     outbuf[1] =
02880       ((C0 &amp; 0x10) &lt;&lt; 3) |
02881       ((B0 &amp; 0x10) &lt;&lt; 2) |
02882       ((A0 &amp; 0x10) &lt;&lt; 1) |
02883       ((B0 &amp; 0x08) &lt;&lt; 1) |
02884       ((A0 &amp; 0x08) &lt;&lt; 0) |
02885       ((C0 &amp; 0x04) &gt;&gt; 0) |
02886       ((B0 &amp; 0x04) &gt;&gt; 1) |
02887       ((A0 &amp; 0x04) &gt;&gt; 2);
02888     outbuf[2] =
02889       ((C0 &amp; 0x02) &lt;&lt; 6) |
02890       ((B0 &amp; 0x02) &lt;&lt; 5) |
02891       ((A0 &amp; 0x02) &lt;&lt; 4) |
02892       ((B0 &amp; 0x01) &lt;&lt; 4) |
02893       ((A0 &amp; 0x01) &lt;&lt; 3) |
02894       ((C1 &amp; 0x80) &gt;&gt; 5) |
02895       ((B1 &amp; 0x80) &gt;&gt; 6) |
02896       ((A1 &amp; 0x80) &gt;&gt; 7);
02897     outbuf[3] =
02898       ((C1 &amp; 0x40) &lt;&lt; 1) |
02899       ((B1 &amp; 0x40) &lt;&lt; 0) |
02900       ((A1 &amp; 0x40) &gt;&gt; 1) |
02901       ((B1 &amp; 0x20) &gt;&gt; 1) |
02902       ((A1 &amp; 0x20) &gt;&gt; 2) |
02903       ((C1 &amp; 0x10) &gt;&gt; 2) |
02904       ((B1 &amp; 0x10) &gt;&gt; 3) |
02905       ((A1 &amp; 0x10) &gt;&gt; 4);
02906     outbuf[4] =
02907       ((C1 &amp; 0x08) &lt;&lt; 4) |
02908       ((B1 &amp; 0x08) &lt;&lt; 3) |
02909       ((A1 &amp; 0x08) &lt;&lt; 2) |
02910       ((B1 &amp; 0x04) &lt;&lt; 2) |
02911       ((A1 &amp; 0x04) &lt;&lt; 1) |
02912       ((C1 &amp; 0x02) &lt;&lt; 1) |
02913       ((B1 &amp; 0x02) &gt;&gt; 0) |
02914       ((A1 &amp; 0x02) &gt;&gt; 1);
02915     outbuf[5] =
02916       ((C1 &amp; 0x01) &lt;&lt; 7) |
02917       ((B1 &amp; 0x01) &lt;&lt; 6) |
02918       ((A1 &amp; 0x01) &lt;&lt; 5) |
02919       ((B2 &amp; 0x80) &gt;&gt; 3) |
02920       ((A2 &amp; 0x80) &gt;&gt; 4) |
02921       ((C2 &amp; 0x40) &gt;&gt; 4) |
02922       ((B2 &amp; 0x40) &gt;&gt; 5) |
02923       ((A2 &amp; 0x40) &gt;&gt; 6);
02924     outbuf[6] =
02925       ((C2 &amp; 0x20) &lt;&lt; 2) |
02926       ((B2 &amp; 0x20) &lt;&lt; 1) |
02927       ((A2 &amp; 0x20) &lt;&lt; 0) |
02928       ((B2 &amp; 0x10) &gt;&gt; 0) |
02929       ((A2 &amp; 0x10) &gt;&gt; 1) |
02930       ((C2 &amp; 0x08) &gt;&gt; 1) |
02931       ((B2 &amp; 0x08) &gt;&gt; 2) |
02932       ((A2 &amp; 0x08) &gt;&gt; 3);
02933     outbuf[7] =
02934       ((C2 &amp; 0x04) &lt;&lt; 5) |
02935       ((B2 &amp; 0x04) &lt;&lt; 4) |
02936       ((A2 &amp; 0x04) &lt;&lt; 3) |
02937       ((B2 &amp; 0x02) &lt;&lt; 3) |
02938       ((A2 &amp; 0x02) &lt;&lt; 2) |
02939       ((C2 &amp; 0x01) &lt;&lt; 2) |
02940       ((B2 &amp; 0x01) &lt;&lt; 1) |
02941       ((A2 &amp; 0x01) &lt;&lt; 0);
02942   }
02943 }
02944 
02945 <span class="preprocessor">#else</span>
02946 <span class="preprocessor"></span><span class="preprocessor">#error 3BIT FOLD TYPE NOT IMPLEMENTED</span>
02947 <span class="preprocessor"></span><span class="preprocessor">#endif</span>
02948 <span class="preprocessor"></span>
02949 <span class="keyword">static</span> <span class="keywordtype">void</span>
02950 <a class="code" href="print-canon_8c.html#a152">canon_shift_buffer</a>(<span class="keywordtype">unsigned</span> <span class="keywordtype">char</span> *line,<span class="keywordtype">int</span> length,<span class="keywordtype">int</span> bits)
02951 {
02952   <span class="keywordtype">int</span> i,j;
<a name="l02953"></a><a class="code" href="print-canon_8c.html#a152">02953</a>   <span class="keywordflow">for</span> (j=0; j&lt;bits; j++) {
02954     <span class="keywordflow">for</span> (i=length-1; i&gt;0; i--) {
02955       line[i]= (line[i] &gt;&gt; 1) | (line[i-1] &lt;&lt; 7);
02956     }
02957     line[0] = line[0] &gt;&gt; 1;
02958   }
02959 }
02960 
02961 <span class="preprocessor">#if 0</span>
02962 <span class="preprocessor"></span><span class="keyword">static</span> <span class="keywordtype">void</span>
02963 canon_shift_buffer2(<span class="keywordtype">unsigned</span> <span class="keywordtype">char</span> *line,<span class="keywordtype">int</span> length,<span class="keywordtype">int</span> bits)
02964 {
02965   <span class="keywordtype">int</span> i;
02966   <span class="keywordflow">for</span> (i=length-1; i&gt;0; i--) {
02967     line[i]= (line[i] &gt;&gt; bits) | (line[i-1] &lt;&lt; (8-bits));
02968   }
02969   line[0] = line[0] &gt;&gt; bits;
02970 }
02971 <span class="preprocessor">#endif</span>
02972 <span class="preprocessor"></span>
02973 <span class="comment">/*</span>
02974 <span class="comment"> * 'canon_write()' - Send graphics using TIFF packbits compression.</span>
02975 <span class="comment"> */</span>
02976 
02977 <span class="keyword">static</span> <span class="keywordtype">int</span>
02978 <a class="code" href="print-canon_8c.html#a153">canon_write</a>(<a class="code" href="structstp__vars.html">stp_vars_t</a> *v,              <span class="comment">/* I - Print file or command */</span>
02979             <span class="keyword">const</span> <a class="code" href="structcanon__caps.html">canon_cap_t</a> *   caps,         <span class="comment">/* I - Printer model */</span>
02980             <span class="keywordtype">unsigned</span> <span class="keywordtype">char</span> *line,        <span class="comment">/* I - Output bitmap data */</span>
<a name="l02981"></a><a class="code" href="print-canon_8c.html#a153">02981</a>             <span class="keywordtype">int</span>           length,       <span class="comment">/* I - Length of bitmap data */</span>
02982             <span class="keywordtype">int</span>           coloridx,     <span class="comment">/* I - Which color */</span>
02983             <span class="keywordtype">int</span>           ydpi,         <span class="comment">/* I - Vertical resolution */</span>
02984             <span class="keywordtype">int</span>           *empty,       <span class="comment">/* IO- Preceeding empty lines */</span>
02985             <span class="keywordtype">int</span>           width,        <span class="comment">/* I - Printed width */</span>
02986             <span class="keywordtype">int</span>           offset,       <span class="comment">/* I - Offset from left side */</span>
02987             <span class="keywordtype">int</span>           bits)
02988 {
02989   <span class="keywordtype">unsigned</span> <span class="keywordtype">char</span>
02990     comp_buf[<a class="code" href="print-canon_8c.html#a5">COMPBUFWIDTH</a> + <a class="code" href="print-canon_8c.html#a5">COMPBUFWIDTH</a> / 4],  <span class="comment">/* Compression buffer */</span>
02991     in_fold[<a class="code" href="print-canon_8c.html#a5">COMPBUFWIDTH</a>],
02992     *in_ptr= line,
02993     *comp_ptr, *comp_data;
02994   <span class="keywordtype">int</span> newlength;
02995   <span class="keywordtype">int</span> offset2,bitoffset;
02996   <span class="keywordtype">unsigned</span> <span class="keywordtype">char</span> color;
02997 
02998  <span class="comment">/* Don't send blank lines... */</span>
02999 
03000   <span class="keywordflow">if</span> (line[0] == 0 &amp;&amp; memcmp(line, line + 1, length - 1) == 0)
03001     <span class="keywordflow">return</span> 0;
03002 
03003   <span class="comment">/* fold lsb/msb pairs if drop modulation is active */</span>
03004 
03005 
03006 
03007   <span class="keywordflow">if</span> (bits==2) {
03008     memset(in_fold,0,length);
03009     <a class="code" href="print-canon_8c.html#a150">canon_fold_2bit</a>(line,length,in_fold);
03010     in_ptr= in_fold;
03011     length= (length*8/4); <span class="comment">/* 4 pixels in 8bit */</span>
03012     offset= (offset*8/4); <span class="comment">/* 4 pixels in 8bit  */</span>
03013   }
03014   <span class="keywordflow">if</span> (bits==3) {
03015     memset(in_fold,0,length);
03016     <a class="code" href="print-canon_8c.html#a151">canon_fold_3bit</a>(line,length,in_fold);
03017     in_ptr= in_fold;
03018     length= (length*8)/3;
03019     offset= (offset/3)*8;
03020 <span class="preprocessor">#if 0</span>
03021 <span class="preprocessor"></span>    <span class="keywordflow">switch</span>(offset%3){
03022     <span class="keywordflow">case</span> 0: offset= (offset/3)*8;   <span class="keywordflow">break</span>;
03023     <span class="keywordflow">case</span> 1: offset= (offset/3)*8<span class="comment">/*+3 CAREFUL! CANNOT SHIFT _AFTER_ RECODING!!*/</span>; <span class="keywordflow">break</span>;
03024     <span class="keywordflow">case</span> 2: offset= (offset/3)*8<span class="comment">/*+5 CAREFUL! CANNOT SHIFT _AFTER_ RECODING!!*/</span>; <span class="keywordflow">break</span>;
03025     }
03026 <span class="preprocessor">#endif</span>
03027 <span class="preprocessor"></span>  }
03028   <span class="comment">/* pack left border rounded to multiples of 8 dots */</span>
03029 
03030   comp_data= comp_buf;
03031   offset2= offset/8;
03032   bitoffset= offset%8;
03033   <span class="keywordflow">while</span> (offset2&gt;0) {
03034     <span class="keywordtype">unsigned</span> <span class="keywordtype">char</span> toffset = offset2 &gt; 128 ? 128 : offset2;
03035     comp_data[0] = 1 - toffset;
03036     comp_data[1] = 0;
03037     comp_data += 2;
03038     offset2-= toffset;
03039   }
03040   <span class="keywordflow">if</span> (bitoffset) {
03041     <span class="keywordflow">if</span> (bitoffset&lt;8)
03042       <a class="code" href="print-canon_8c.html#a152">canon_shift_buffer</a>(in_ptr,length,bitoffset);
03043     <span class="keywordflow">else</span>
03044       <a class="code" href="print-util_8c.html#a24">stp_deprintf</a>(<a class="code" href="group__util.html#ga37">STP_DBG_CANON</a>,<span class="stringliteral">"SEVERE BUG IN print-canon.c::canon_write() "</span>
03045               <span class="stringliteral">"bitoffset=%d!!\n"</span>,bitoffset);
03046   }
03047 
03048   <a class="code" href="bit-ops_8c.html#a24">stp_pack_tiff</a>(v, in_ptr, length, comp_data, &amp;comp_ptr, NULL, NULL);
03049   newlength= comp_ptr - comp_buf;
03050 
03051   <span class="comment">/* send packed empty lines if any */</span>
03052 
03053   <span class="keywordflow">if</span> (*empty) {
03054     <a class="code" href="group__util.html#ga10">stp_zfwrite</a>(<span class="stringliteral">"\033\050\145\002\000"</span>, 5, 1, v);
03055     <a class="code" href="group__util.html#ga13">stp_put16_be</a>(*empty, v);
03056     *empty= 0;
03057   }
03058 
03059  <span class="comment">/* Send a line of raster graphics... */</span>
03060 
03061   <a class="code" href="group__util.html#ga10">stp_zfwrite</a>(<span class="stringliteral">"\033\050\101"</span>, 3, 1, v);
03062   <a class="code" href="group__util.html#ga12">stp_put16_le</a>(newlength + 1, v);
03063   color= <span class="stringliteral">"CMYKcmy"</span>[coloridx];
03064   <span class="keywordflow">if</span> (!color) color= <span class="charliteral">'K'</span>;
03065   <a class="code" href="group__util.html#ga11">stp_putc</a>(color,v);
03066   <a class="code" href="group__util.html#ga10">stp_zfwrite</a>((<span class="keyword">const</span> <span class="keywordtype">char</span> *)comp_buf, newlength, 1, v);
03067   <a class="code" href="group__util.html#ga11">stp_putc</a>(<span class="charliteral">'\015'</span>, v);
03068   <span class="keywordflow">return</span> 1;
03069 }
03070 
03071 
03072 <span class="keyword">static</span> <span class="keywordtype">void</span>
03073 <a class="code" href="print-canon_8c.html#a105">canon_write_line</a>(<a class="code" href="structstp__vars.html">stp_vars_t</a> *v)
03074 {
03075   <a class="code" href="structcanon__privdata__t.html">canon_privdata_t</a> *pd =
<a name="l03076"></a><a class="code" href="print-canon_8c.html#a105">03076</a>     (<a class="code" href="structcanon__privdata__t.html">canon_privdata_t</a> *) <a class="code" href="group__vars.html#ga20">stp_get_component_data</a>(v, <span class="stringliteral">"Driver"</span>);
03077   <span class="keyword">static</span> <span class="keyword">const</span> <span class="keywordtype">int</span> write_sequence[] = { 0, 3, 2, 1, 6, 5, 4 };
03078   <span class="keyword">static</span> <span class="keyword">const</span> <span class="keywordtype">int</span> write_number[] = { 3, 2, 1, 0, 6, 5, 4 };
03079   <span class="keywordtype">int</span> i;
03080   <span class="keywordtype">int</span> written= 0;
03081 
03082   <span class="keywordflow">for</span> (i = 0; i &lt; 7; i++)
03083     {
03084       <span class="keywordtype">int</span> col = write_sequence[i];
03085       <span class="keywordtype">int</span> num = write_number[i];
03086       <span class="keywordflow">if</span> (pd-&gt;<a class="code" href="structcanon__privdata__t.html#o1">cols</a>[col])
03087         written += <a class="code" href="print-canon_8c.html#a153">canon_write</a>(v, pd-&gt;<a class="code" href="structcanon__privdata__t.html#o0">caps</a>,
03088                                pd-&gt;<a class="code" href="structcanon__privdata__t.html#o1">cols</a>[col] + pd-&gt;<a class="code" href="structcanon__privdata__t.html#o2">delay</a>[col] * pd-&gt;<a class="code" href="structcanon__privdata__t.html#o4">buf_length</a>,
03089                                pd-&gt;<a class="code" href="structcanon__privdata__t.html#o4">buf_length</a> / pd-&gt;<a class="code" href="structcanon__privdata__t.html#o8">bits</a>, num, pd-&gt;<a class="code" href="structcanon__privdata__t.html#o9">ydpi</a>,
03090                                &amp;(pd-&gt;<a class="code" href="structcanon__privdata__t.html#o7">emptylines</a>), pd-&gt;<a class="code" href="structcanon__privdata__t.html#o5">out_width</a>,
03091                                pd-&gt;<a class="code" href="structcanon__privdata__t.html#o6">left</a>, pd-&gt;<a class="code" href="structcanon__privdata__t.html#o8">bits</a>);
03092     }
03093   <span class="keywordflow">if</span> (written)
03094     <a class="code" href="group__util.html#ga10">stp_zfwrite</a>(<span class="stringliteral">"\033\050\145\002\000\000\001"</span>, 7, 1, v);
03095   <span class="keywordflow">else</span>
03096     pd-&gt;<a class="code" href="structcanon__privdata__t.html#o7">emptylines</a> += 1;
03097 }
03098 
03099 
03100 <span class="keyword">static</span> <a class="code" href="structstp__family.html">stp_family_t</a> <a class="code" href="print-canon_8c.html#a91">print_canon_module_data</a> =
03101   {
03102     &amp;<a class="code" href="print-canon_8c.html#a90">print_canon_printfuncs</a>,
<a name="l03103"></a><a class="code" href="print-canon_8c.html#a91">03103</a>     NULL
03104   };
03105 
03106 
03107 <span class="keyword">static</span> <span class="keywordtype">int</span>
03108 <a class="code" href="print-canon_8c.html#a154">print_canon_module_init</a>(<span class="keywordtype">void</span>)
03109 {
03110   <span class="keywordflow">return</span> <a class="code" href="group__printer.html#ga46">stp_family_register</a>(<a class="code" href="print-canon_8c.html#a91">print_canon_module_data</a>.<a class="code" href="structstp__family.html#o1">printer_list</a>);
<a name="l03111"></a><a class="code" href="print-canon_8c.html#a154">03111</a> }
03112 
03113 
03114 <span class="keyword">static</span> <span class="keywordtype">int</span>
03115 <a class="code" href="print-canon_8c.html#a155">print_canon_module_exit</a>(<span class="keywordtype">void</span>)
03116 {
03117   <span class="keywordflow">return</span> <a class="code" href="group__printer.html#ga47">stp_family_unregister</a>(<a class="code" href="print-canon_8c.html#a91">print_canon_module_data</a>.<a class="code" href="structstp__family.html#o1">printer_list</a>);
<a name="l03118"></a><a class="code" href="print-canon_8c.html#a155">03118</a> }
03119 
03120 
03121 <span class="comment">/* Module header */</span>
03122 <span class="preprocessor">#define stp_module_version print_canon_LTX_stp_module_version</span>
03123 <span class="preprocessor"></span><span class="preprocessor">#define stp_module_data print_canon_LTX_stp_module_data</span>
03124 <span class="preprocessor"></span>
<a name="l03125"></a><a class="code" href="print-canon_8c.html#a44">03125</a> <a class="code" href="structstp__module__version.html">stp_module_version_t</a> <a class="code" href="structstp__module__version.html">stp_module_version</a> = {0, 0};
<a name="l03126"></a><a class="code" href="print-canon_8c.html#a45">03126</a> 
03127 <a class="code" href="structstp__module.html">stp_module_t</a> <a class="code" href="print-canon_8c.html#a45">stp_module_data</a> =
<a name="l03128"></a><a class="code" href="print-canon_8c.html#a92">03128</a>   {
03129     <span class="stringliteral">"canon"</span>,
<a name="l03130"></a><a class="code" href="print-canon_8c.html#a93">03130</a>     VERSION,
03131     <span class="stringliteral">"Canon family driver"</span>,
03132     <a class="code" href="module_8h.html#a13a4">STP_MODULE_CLASS_FAMILY</a>,
03133     NULL,
03134     <a class="code" href="print-canon_8c.html#a154">print_canon_module_init</a>,
03135     <a class="code" href="print-canon_8c.html#a155">print_canon_module_exit</a>,
03136     (<span class="keywordtype">void</span> *) &amp;<a class="code" href="print-canon_8c.html#a91">print_canon_module_data</a>
03137   };
03138 
</pre></div><hr size="1"><address style="align: right;"><small>Generated on Wed Aug 25 07:56:14 2004 for libgimpprint API Reference by
<a href="http://www.doxygen.org/index.html">
<img src="doxygen.png" alt="doxygen" align="middle" border=0 > </a>1.3.6 </small></address>
</body>
</html>
