<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html><head><meta http-equiv="Content-Type" content="text/html;charset=iso-8859-1">
<title>libgimpprint API Reference: src/main/dither-inks.c Source File</title>
<link href="doxygen.css" rel="stylesheet" type="text/css">
</head><body>
<!-- Generated by Doxygen 1.3.6 -->
<div class="qindex"><a class="qindex" href="index.html">Main&nbsp;Page</a> | <a class="qindex" href="modules.html">Modules</a> | <a class="qindex" href="classes.html">Alphabetical&nbsp;List</a> | <a class="qindex" href="annotated.html">Data&nbsp;Structures</a> | <a class="qindex" href="files.html">File&nbsp;List</a> | <a class="qindex" href="functions.html">Data&nbsp;Fields</a> | <a class="qindex" href="globals.html">Globals</a> | <a class="qindex" href="pages.html">Related&nbsp;Pages</a></div>
<h1>src/main/dither-inks.c</h1><a href="dither-inks_8c.html">Go to the documentation of this file.</a><div class="fragment"><pre>00001 <span class="comment">/*</span>
00002 <span class="comment"> * "$Id: dither-inks_8c-source.html,v 1.1.1.2 2004/12/22 23:48:58 jlovell Exp $"</span>
00003 <span class="comment"> *</span>
00004 <span class="comment"> *   Print plug-in driver utility functions for the GIMP.</span>
00005 <span class="comment"> *</span>
00006 <span class="comment"> *   Copyright 1997-2000 Michael Sweet (mike@easysw.com) and</span>
00007 <span class="comment"> *      Robert Krawitz (rlk@alum.mit.edu)</span>
00008 <span class="comment"> *</span>
00009 <span class="comment"> *   This program is free software; you can redistribute it and/or modify it</span>
00010 <span class="comment"> *   under the terms of the GNU General Public License as published by the Free</span>
00011 <span class="comment"> *   Software Foundation; either version 2 of the License, or (at your option)</span>
00012 <span class="comment"> *   any later version.</span>
00013 <span class="comment"> *</span>
00014 <span class="comment"> *   This program is distributed in the hope that it will be useful, but</span>
00015 <span class="comment"> *   WITHOUT ANY WARRANTY; without even the implied warranty of MERCHANTABILITY</span>
00016 <span class="comment"> *   or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU General Public License</span>
00017 <span class="comment"> *   for more details.</span>
00018 <span class="comment"> *</span>
00019 <span class="comment"> *   You should have received a copy of the GNU General Public License</span>
00020 <span class="comment"> *   along with this program; if not, write to the Free Software</span>
00021 <span class="comment"> *   Foundation, Inc., 59 Temple Place - Suite 330, Boston, MA 02111-1307, USA.</span>
00022 <span class="comment"> *</span>
00023 <span class="comment"> * Revision History:</span>
00024 <span class="comment"> *</span>
00025 <span class="comment"> *   See ChangeLog</span>
00026 <span class="comment"> */</span>
00027 
00028 <span class="preprocessor">#ifdef HAVE_CONFIG_H</span>
00029 <span class="preprocessor"></span><span class="preprocessor">#include &lt;config.h&gt;</span>
00030 <span class="preprocessor">#endif</span>
00031 <span class="preprocessor"></span><span class="preprocessor">#include &lt;<a class="code" href="gimp-print_8h.html">gimp-print/gimp-print.h</a>&gt;</span>
00032 <span class="preprocessor">#include "<a class="code" href="gimp-print-internal_8h.html">gimp-print-internal.h</a>"</span>
00033 <span class="preprocessor">#include &lt;<a class="code" href="gimp-print-intl-internal_8h.html">gimp-print/gimp-print-intl-internal.h</a>&gt;</span>
00034 <span class="preprocessor">#ifdef HAVE_LIMITS_H</span>
00035 <span class="preprocessor"></span><span class="preprocessor">#include &lt;limits.h&gt;</span>
00036 <span class="preprocessor">#endif</span>
00037 <span class="preprocessor"></span><span class="preprocessor">#include &lt;math.h&gt;</span>
00038 <span class="preprocessor">#include &lt;assert.h&gt;</span>
00039 <span class="preprocessor">#include &lt;string.h&gt;</span>
00040 <span class="preprocessor">#include "<a class="code" href="dither-impl_8h.html">dither-impl.h</a>"</span>
00041 
00042 <span class="keywordtype">int</span>
<a name="l00043"></a><a class="code" href="dither-inks_8c.html#a0">00043</a> <a class="code" href="dither-inks_8c.html#a0">stpi_dither_translate_channel</a>(<a class="code" href="structstp__vars.html">stp_vars_t</a> *v, <span class="keywordtype">unsigned</span> channel,
00044                               <span class="keywordtype">unsigned</span> subchannel)
00045 {
00046   <a class="code" href="structdither.html">stpi_dither_t</a> *d = (<a class="code" href="structdither.html">stpi_dither_t</a> *) <a class="code" href="group__vars.html#ga20">stp_get_component_data</a>(v, <span class="stringliteral">"Dither"</span>);
00047   <span class="keywordtype">unsigned</span> chan_idx;
00048   <span class="keywordflow">if</span> (!d)
00049     <span class="keywordflow">return</span> -1;
00050   <span class="keywordflow">if</span> (channel &gt;= d-&gt;<a class="code" href="structdither.html#o19">channel_count</a>)
00051     <span class="keywordflow">return</span> -1;
00052   <span class="keywordflow">if</span> (subchannel &gt;= d-&gt;<a class="code" href="structdither.html#o22">subchannel_count</a>[channel])
00053     <span class="keywordflow">return</span> -1;
00054   chan_idx = d-&gt;<a class="code" href="structdither.html#o21">channel_index</a>[channel];
00055   <span class="keywordflow">return</span> chan_idx + subchannel;
00056 }
00057 
00058 <span class="keywordtype">unsigned</span> <span class="keywordtype">char</span> *
<a name="l00059"></a><a class="code" href="dither-inks_8c.html#a1">00059</a> <a class="code" href="dither-inks_8c.html#a1">stp_dither_get_channel</a>(<a class="code" href="structstp__vars.html">stp_vars_t</a> *v, <span class="keywordtype">unsigned</span> channel, <span class="keywordtype">unsigned</span> subchannel)
00060 {
00061   <a class="code" href="structdither.html">stpi_dither_t</a> *d = (<a class="code" href="structdither.html">stpi_dither_t</a> *) <a class="code" href="group__vars.html#ga20">stp_get_component_data</a>(v, <span class="stringliteral">"Dither"</span>);
00062   <span class="keywordtype">int</span> place = <a class="code" href="dither-inks_8c.html#a0">stpi_dither_translate_channel</a>(v, channel, subchannel);
00063   <span class="keywordflow">if</span> (place &gt;= 0)
00064     <span class="keywordflow">return</span> d-&gt;<a class="code" href="structdither.html#o18">channel</a>[place].<a class="code" href="structdither__channel.html#o17">ptr</a>;
00065   <span class="keywordflow">else</span>
00066     <span class="keywordflow">return</span> NULL;
00067 }
00068 
00069 <span class="keyword">static</span> <span class="keywordtype">void</span>
<a name="l00070"></a><a class="code" href="dither-inks_8c.html#a2">00070</a> <a class="code" href="dither-inks_8c.html#a2">insert_channel</a>(<a class="code" href="structstp__vars.html">stp_vars_t</a> *v, <a class="code" href="structdither.html">stpi_dither_t</a> *d, <span class="keywordtype">int</span> channel)
00071 {
00072   <span class="keywordtype">unsigned</span> oc = d-&gt;<a class="code" href="structdither.html#o19">channel_count</a>;
00073   <span class="keywordtype">int</span> i;
00074   d-&gt;<a class="code" href="structdither.html#o21">channel_index</a> =
00075     <a class="code" href="group__util.html#ga30">stp_realloc</a> (d-&gt;<a class="code" href="structdither.html#o21">channel_index</a>, <span class="keyword">sizeof</span>(<span class="keywordtype">unsigned</span>) * (channel + 1));
00076   d-&gt;<a class="code" href="structdither.html#o22">subchannel_count</a> =
00077     <a class="code" href="group__util.html#ga30">stp_realloc</a> (d-&gt;<a class="code" href="structdither.html#o22">subchannel_count</a>, <span class="keyword">sizeof</span>(<span class="keywordtype">unsigned</span>) * (channel + 1));
00078   <span class="keywordflow">for</span> (i = oc; i &lt; channel + 1; i++)
00079     {
00080       <span class="keywordflow">if</span> (oc == 0)
00081         d-&gt;<a class="code" href="structdither.html#o21">channel_index</a>[i] = 0;
00082       <span class="keywordflow">else</span>
00083         d-&gt;<a class="code" href="structdither.html#o21">channel_index</a>[i] =
00084           d-&gt;<a class="code" href="structdither.html#o21">channel_index</a>[oc - 1] + d-&gt;<a class="code" href="structdither.html#o22">subchannel_count</a>[oc - 1];
00085       d-&gt;<a class="code" href="structdither.html#o22">subchannel_count</a>[i] = 0;
00086     }
00087   d-&gt;<a class="code" href="structdither.html#o19">channel_count</a> = channel + 1;
00088 }
00089 
00090 <span class="keywordtype">void</span>
<a name="l00091"></a><a class="code" href="dither-inks_8c.html#a3">00091</a> <a class="code" href="dither-inks_8c.html#a3">stpi_dither_channel_destroy</a>(<a class="code" href="structdither__channel.html">stpi_dither_channel_t</a> *channel)
00092 {
00093   <span class="keywordtype">int</span> i;
00094   <a class="code" href="group__util.html#ga52">STP_SAFE_FREE</a>(channel-&gt;<a class="code" href="structdither__channel.html#o9">ink_list</a>);
00095   <span class="keywordflow">if</span> (channel-&gt;<a class="code" href="structdither__channel.html#o13">errs</a>)
00096     {
00097       <span class="keywordflow">for</span> (i = 0; i &lt; channel-&gt;<a class="code" href="structdither__channel.html#o12">error_rows</a>; i++)
00098         <a class="code" href="group__util.html#ga52">STP_SAFE_FREE</a>(channel-&gt;<a class="code" href="structdither__channel.html#o13">errs</a>[i]);
00099       <a class="code" href="group__util.html#ga52">STP_SAFE_FREE</a>(channel-&gt;<a class="code" href="structdither__channel.html#o13">errs</a>);
00100     }
00101   <a class="code" href="group__util.html#ga52">STP_SAFE_FREE</a>(channel-&gt;<a class="code" href="structdither__channel.html#o11">ranges</a>);
00102   <a class="code" href="print-dither-matrices_8c.html#a11">stp_dither_matrix_destroy</a>(&amp;(channel-&gt;<a class="code" href="structdither__channel.html#o14">pick</a>));
00103   <a class="code" href="print-dither-matrices_8c.html#a11">stp_dither_matrix_destroy</a>(&amp;(channel-&gt;<a class="code" href="structdither__channel.html#o15">dithermat</a>));
00104 }  
00105 
00106 <span class="keyword">static</span> <span class="keywordtype">void</span>
<a name="l00107"></a><a class="code" href="dither-inks_8c.html#a4">00107</a> <a class="code" href="dither-inks_8c.html#a4">initialize_channel</a>(<a class="code" href="structstp__vars.html">stp_vars_t</a> *v, <span class="keywordtype">int</span> channel, <span class="keywordtype">int</span> subchannel)
00108 {
00109   <a class="code" href="structdither.html">stpi_dither_t</a> *d = (<a class="code" href="structdither.html">stpi_dither_t</a> *) <a class="code" href="group__vars.html#ga20">stp_get_component_data</a>(v, <span class="stringliteral">"Dither"</span>);
00110   <span class="keywordtype">int</span> idx = <a class="code" href="dither-inks_8c.html#a0">stpi_dither_translate_channel</a>(v, channel, subchannel);
00111   <a class="code" href="structdither__channel.html">stpi_dither_channel_t</a> *dc = &amp;(<a class="code" href="dither-impl_8h.html#a16">CHANNEL</a>(d, idx));
00112   <a class="code" href="structstp__shade.html">stp_shade_t</a> shade;
00113   <a class="code" href="structstp__dotsize.html">stp_dotsize_t</a> dot;
00114   <a class="code" href="print-weave_8c.html#a1">assert</a>(idx &gt;= 0);
00115   memset(dc, 0, <span class="keyword">sizeof</span>(<a class="code" href="structdither__channel.html">stpi_dither_channel_t</a>));
00116   <a class="code" href="print-dither-matrices_8c.html#a12">stp_dither_matrix_clone</a>(&amp;(d-&gt;<a class="code" href="structdither.html#o16">dither_matrix</a>), &amp;(dc-&gt;<a class="code" href="structdither__channel.html#o15">dithermat</a>), 0, 0);
00117   <a class="code" href="print-dither-matrices_8c.html#a12">stp_dither_matrix_clone</a>(&amp;(d-&gt;<a class="code" href="structdither.html#o17">transition_matrix</a>), &amp;(dc-&gt;<a class="code" href="structdither__channel.html#o14">pick</a>), 0, 0);
00118   shade.<a class="code" href="structstp__shade.html#o2">dot_sizes</a> = &amp;dot;
00119   shade.<a class="code" href="structstp__shade.html#o0">value</a> = 1.0;
00120   shade.<a class="code" href="structstp__shade.html#o1">numsizes</a> = 1;
00121   dot.<a class="code" href="structstp__dotsize.html#o0">bit_pattern</a> = 1;
00122   dot.<a class="code" href="structstp__dotsize.html#o1">value</a> = 1.0;
00123   <a class="code" href="dither-inks_8c.html#a11">stp_dither_set_inks_full</a>(v, channel, 1, &amp;shade, 1.0, 1.0);
00124 }
00125 
00126 <span class="keyword">static</span> <span class="keywordtype">void</span>
<a name="l00127"></a><a class="code" href="dither-inks_8c.html#a5">00127</a> <a class="code" href="dither-inks_8c.html#a5">insert_subchannel</a>(<a class="code" href="structstp__vars.html">stp_vars_t</a> *v, <a class="code" href="structdither.html">stpi_dither_t</a> *d, <span class="keywordtype">int</span> channel, <span class="keywordtype">int</span> subchannel)
00128 {
00129   <span class="keywordtype">int</span> i;
00130   <span class="keywordtype">unsigned</span> oc = d-&gt;<a class="code" href="structdither.html#o22">subchannel_count</a>[channel];
00131   <span class="keywordtype">unsigned</span> increment = subchannel - oc + 1;
00132   <span class="keywordtype">unsigned</span> old_place = d-&gt;<a class="code" href="structdither.html#o21">channel_index</a>[channel] + oc;
00133   <a class="code" href="structdither__channel.html">stpi_dither_channel_t</a> *nc =
00134     <a class="code" href="group__util.html#ga28">stp_malloc</a>(<span class="keyword">sizeof</span>(<a class="code" href="structdither__channel.html">stpi_dither_channel_t</a>) *
00135                (d-&gt;<a class="code" href="structdither.html#o20">total_channel_count</a> + increment));
00136       
00137   <span class="keywordflow">if</span> (d-&gt;<a class="code" href="structdither.html#o18">channel</a>)
00138     {
00139       <span class="comment">/*</span>
00140 <span class="comment">       * Copy the old channels, including all subchannels of the current</span>
00141 <span class="comment">       * channel that already existed.</span>
00142 <span class="comment">       */</span>
00143       memcpy(nc, d-&gt;<a class="code" href="structdither.html#o18">channel</a>, <span class="keyword">sizeof</span>(<a class="code" href="dither-impl_8h.html#a25">stpi_dither_channel_t</a>) * old_place);
00144       <span class="keywordflow">if</span> (old_place &lt; d-&gt;<a class="code" href="structdither.html#o20">total_channel_count</a>)
00145         <span class="comment">/*</span>
00146 <span class="comment">         * If we're inserting a new subchannel in the middle somewhere,</span>
00147 <span class="comment">         * we need to move everything else up</span>
00148 <span class="comment">         */</span>
00149         memcpy(nc + old_place + increment, d-&gt;<a class="code" href="structdither.html#o18">channel</a> + old_place,
00150                (<span class="keyword">sizeof</span>(<a class="code" href="dither-impl_8h.html#a25">stpi_dither_channel_t</a>) *
00151                 (d-&gt;<a class="code" href="structdither.html#o20">total_channel_count</a> - old_place)));
00152       <a class="code" href="group__util.html#ga31">stp_free</a>(d-&gt;<a class="code" href="structdither.html#o18">channel</a>);
00153     }
00154   d-&gt;<a class="code" href="structdither.html#o18">channel</a> = nc;
00155   <span class="keywordflow">if</span> (channel &lt; d-&gt;<a class="code" href="structdither.html#o19">channel_count</a> - 1)
00156     <span class="comment">/* Now fix up the subchannel offsets */</span>
00157     <span class="keywordflow">for</span> (i = channel + 1; i &lt; d-&gt;<a class="code" href="structdither.html#o19">channel_count</a>; i++)
00158       d-&gt;<a class="code" href="structdither.html#o21">channel_index</a>[i] += increment;
00159   d-&gt;<a class="code" href="structdither.html#o22">subchannel_count</a>[channel] = subchannel + 1;
00160   d-&gt;<a class="code" href="structdither.html#o20">total_channel_count</a> += increment;
00161   <span class="keywordflow">for</span> (i = oc; i &lt; oc + increment; i++)
00162     <a class="code" href="dither-inks_8c.html#a4">initialize_channel</a>(v, channel, i);
00163 }
00164 
00165 <span class="keywordtype">void</span>
<a name="l00166"></a><a class="code" href="dither-inks_8c.html#a6">00166</a> <a class="code" href="dither-inks_8c.html#a6">stpi_dither_finalize</a>(<a class="code" href="structstp__vars.html">stp_vars_t</a> *v)
00167 {
00168   <a class="code" href="structdither.html">stpi_dither_t</a> *d = (<a class="code" href="structdither.html">stpi_dither_t</a> *) <a class="code" href="group__vars.html#ga20">stp_get_component_data</a>(v, <span class="stringliteral">"Dither"</span>);
00169   <span class="keywordflow">if</span> (!d-&gt;<a class="code" href="structdither.html#o15">finalized</a>)
00170     {
00171       <span class="keywordtype">int</span> i;
00172       <span class="keywordtype">unsigned</span> rc = 1 + (<span class="keywordtype">unsigned</span>) ceil(sqrt(<a class="code" href="dither-impl_8h.html#a17">CHANNEL_COUNT</a>(d)));
00173       <span class="keywordtype">unsigned</span> x_n = d-&gt;<a class="code" href="structdither.html#o16">dither_matrix</a>.<a class="code" href="structdither__matrix__impl.html#o2">x_size</a> / rc;
00174       <span class="keywordtype">unsigned</span> y_n = d-&gt;<a class="code" href="structdither.html#o16">dither_matrix</a>.<a class="code" href="structdither__matrix__impl.html#o3">y_size</a> / rc;
00175       <span class="keywordflow">for</span> (i = 0; i &lt; <a class="code" href="dither-impl_8h.html#a17">CHANNEL_COUNT</a>(d); i++)
00176         {
00177           <a class="code" href="structdither__channel.html">stpi_dither_channel_t</a> *dc = &amp;(<a class="code" href="dither-impl_8h.html#a16">CHANNEL</a>(d, i));
00178           <a class="code" href="print-dither-matrices_8c.html#a12">stp_dither_matrix_clone</a>(&amp;(d-&gt;<a class="code" href="structdither.html#o16">dither_matrix</a>), &amp;(dc-&gt;<a class="code" href="structdither__channel.html#o15">dithermat</a>),
00179                                    x_n * (i % rc), y_n * (i / rc));
00180           <a class="code" href="print-dither-matrices_8c.html#a12">stp_dither_matrix_clone</a>(&amp;(d-&gt;<a class="code" href="structdither.html#o16">dither_matrix</a>), &amp;(dc-&gt;<a class="code" href="structdither__channel.html#o14">pick</a>),
00181                                    x_n * (i % rc), y_n * (i / rc));
00182         }
00183       d-&gt;<a class="code" href="structdither.html#o15">finalized</a> = 1;
00184     }
00185 }
00186 
00187 <span class="keywordtype">void</span>
<a name="l00188"></a><a class="code" href="dither-inks_8c.html#a7">00188</a> <a class="code" href="dither-inks_8c.html#a7">stp_dither_add_channel</a>(<a class="code" href="structstp__vars.html">stp_vars_t</a> *v, <span class="keywordtype">unsigned</span> <span class="keywordtype">char</span> *data,
00189                        <span class="keywordtype">unsigned</span> channel, <span class="keywordtype">unsigned</span> subchannel)
00190 {
00191   <a class="code" href="structdither.html">stpi_dither_t</a> *d = (<a class="code" href="structdither.html">stpi_dither_t</a> *) <a class="code" href="group__vars.html#ga20">stp_get_component_data</a>(v, <span class="stringliteral">"Dither"</span>);
00192   <span class="keywordtype">int</span> idx;
00193   <span class="keywordflow">if</span> (channel &gt;= d-&gt;<a class="code" href="structdither.html#o19">channel_count</a>)
00194     <a class="code" href="dither-inks_8c.html#a2">insert_channel</a>(v, d, channel);
00195   <span class="keywordflow">if</span> (subchannel &gt;= d-&gt;<a class="code" href="structdither.html#o22">subchannel_count</a>[channel])
00196     <a class="code" href="dither-inks_8c.html#a5">insert_subchannel</a>(v, d, channel, subchannel);
00197   idx = <a class="code" href="dither-inks_8c.html#a0">stpi_dither_translate_channel</a>(v, channel, subchannel);
00198   <a class="code" href="print-weave_8c.html#a1">assert</a>(idx &gt;= 0);
00199   d-&gt;<a class="code" href="structdither.html#o18">channel</a>[idx].<a class="code" href="structdither__channel.html#o17">ptr</a> = data;
00200 }
00201 
00202 <span class="keyword">static</span> <span class="keywordtype">void</span>
<a name="l00203"></a><a class="code" href="dither-inks_8c.html#a8">00203</a> <a class="code" href="dither-inks_8c.html#a8">stpi_dither_finalize_ranges</a>(<a class="code" href="structstp__vars.html">stp_vars_t</a> *v, <a class="code" href="structdither__channel.html">stpi_dither_channel_t</a> *dc)
00204 {
00205   <a class="code" href="structdither.html">stpi_dither_t</a> *d = (<a class="code" href="structdither.html">stpi_dither_t</a> *) <a class="code" href="group__vars.html#ga20">stp_get_component_data</a>(v, <span class="stringliteral">"Dither"</span>);
00206   <span class="keywordtype">int</span> i;
00207   <span class="keywordtype">unsigned</span> lbit = dc-&gt;<a class="code" href="structdither__channel.html#o1">bit_max</a>;
00208   dc-&gt;<a class="code" href="structdither__channel.html#o2">signif_bits</a> = 0;
00209   <span class="keywordflow">while</span> (lbit &gt; 0)
00210     {
00211       dc-&gt;<a class="code" href="structdither__channel.html#o2">signif_bits</a>++;
00212       lbit &gt;&gt;= 1;
00213     }
00214 
00215   <span class="keywordflow">for</span> (i = 0; i &lt; dc-&gt;<a class="code" href="structdither__channel.html#o10">nlevels</a>; i++)
00216     {
00217       <span class="keywordflow">if</span> (dc-&gt;<a class="code" href="structdither__channel.html#o11">ranges</a>[i].<a class="code" href="structdither__segment.html#o0">lower</a>-&gt;<a class="code" href="structink__defn.html#o2">bits</a> == dc-&gt;<a class="code" href="structdither__channel.html#o11">ranges</a>[i].<a class="code" href="structdither__segment.html#o1">upper</a>-&gt;<a class="code" href="structink__defn.html#o2">bits</a>)
00218         dc-&gt;<a class="code" href="structdither__channel.html#o11">ranges</a>[i].<a class="code" href="structdither__segment.html#o4">is_same_ink</a> = 1;
00219       <span class="keywordflow">else</span>
00220         dc-&gt;<a class="code" href="structdither__channel.html#o11">ranges</a>[i].<a class="code" href="structdither__segment.html#o4">is_same_ink</a> = 0;
00221       <span class="keywordflow">if</span> (dc-&gt;<a class="code" href="structdither__channel.html#o11">ranges</a>[i].<a class="code" href="structdither__segment.html#o2">range_span</a> &gt; 0 &amp;&amp; dc-&gt;<a class="code" href="structdither__channel.html#o11">ranges</a>[i].<a class="code" href="structdither__segment.html#o3">value_span</a> &gt; 0)
00222         dc-&gt;<a class="code" href="structdither__channel.html#o11">ranges</a>[i].<a class="code" href="structdither__segment.html#o5">is_equal</a> = 0;
00223       <span class="keywordflow">else</span>
00224         dc-&gt;<a class="code" href="structdither__channel.html#o11">ranges</a>[i].<a class="code" href="structdither__segment.html#o5">is_equal</a> = 1;
00225 
00226       <a class="code" href="print-util_8c.html#a23">stp_dprintf</a>(<a class="code" href="group__util.html#ga33">STP_DBG_INK</a>, v,
00227                   <span class="stringliteral">"    level %d value[0] %d value[1] %d range[0] %d range[1] %d\n"</span>,
00228                   i, dc-&gt;<a class="code" href="structdither__channel.html#o11">ranges</a>[i].<a class="code" href="structdither__segment.html#o0">lower</a>-&gt;<a class="code" href="structink__defn.html#o1">value</a>, dc-&gt;<a class="code" href="structdither__channel.html#o11">ranges</a>[i].<a class="code" href="structdither__segment.html#o1">upper</a>-&gt;<a class="code" href="structink__defn.html#o1">value</a>,
00229                   dc-&gt;<a class="code" href="structdither__channel.html#o11">ranges</a>[i].<a class="code" href="structdither__segment.html#o0">lower</a>-&gt;<a class="code" href="structink__defn.html#o0">range</a>, dc-&gt;<a class="code" href="structdither__channel.html#o11">ranges</a>[i].<a class="code" href="structdither__segment.html#o1">upper</a>-&gt;<a class="code" href="structink__defn.html#o0">range</a>);
00230       <a class="code" href="print-util_8c.html#a23">stp_dprintf</a>(<a class="code" href="group__util.html#ga33">STP_DBG_INK</a>, v,
00231                   <span class="stringliteral">"       bits[0] %d bits[1] %d\n"</span>,
00232                   dc-&gt;<a class="code" href="structdither__channel.html#o11">ranges</a>[i].<a class="code" href="structdither__segment.html#o0">lower</a>-&gt;<a class="code" href="structink__defn.html#o2">bits</a>, dc-&gt;<a class="code" href="structdither__channel.html#o11">ranges</a>[i].<a class="code" href="structdither__segment.html#o1">upper</a>-&gt;<a class="code" href="structink__defn.html#o2">bits</a>);
00233       <a class="code" href="print-util_8c.html#a23">stp_dprintf</a>(<a class="code" href="group__util.html#ga33">STP_DBG_INK</a>, v,
00234                   <span class="stringliteral">"       rangespan %d valuespan %d same_ink %d equal %d\n"</span>,
00235                   dc-&gt;<a class="code" href="structdither__channel.html#o11">ranges</a>[i].<a class="code" href="structdither__segment.html#o2">range_span</a>, dc-&gt;<a class="code" href="structdither__channel.html#o11">ranges</a>[i].<a class="code" href="structdither__segment.html#o3">value_span</a>,
00236                   dc-&gt;<a class="code" href="structdither__channel.html#o11">ranges</a>[i].<a class="code" href="structdither__segment.html#o4">is_same_ink</a>, dc-&gt;<a class="code" href="structdither__channel.html#o11">ranges</a>[i].<a class="code" href="structdither__segment.html#o5">is_equal</a>);
00237       <span class="keywordflow">if</span> (i &gt; 0 &amp;&amp; dc-&gt;<a class="code" href="structdither__channel.html#o11">ranges</a>[i].<a class="code" href="structdither__segment.html#o0">lower</a>-&gt;<a class="code" href="structink__defn.html#o0">range</a> &gt;= d-&gt;<a class="code" href="structdither.html#o5">adaptive_limit</a>)
00238         {
00239           d-&gt;<a class="code" href="structdither.html#o5">adaptive_limit</a> = dc-&gt;<a class="code" href="structdither__channel.html#o11">ranges</a>[i].<a class="code" href="structdither__segment.html#o0">lower</a>-&gt;<a class="code" href="structink__defn.html#o0">range</a> + 1;
00240           <span class="keywordflow">if</span> (d-&gt;<a class="code" href="structdither.html#o5">adaptive_limit</a> &gt; 65535)
00241             d-&gt;<a class="code" href="structdither.html#o5">adaptive_limit</a> = 65535;
00242           <a class="code" href="print-util_8c.html#a23">stp_dprintf</a>(<a class="code" href="group__util.html#ga33">STP_DBG_INK</a>, v, <span class="stringliteral">"Setting adaptive limit to %d\n"</span>,
00243                       d-&gt;<a class="code" href="structdither.html#o5">adaptive_limit</a>);
00244         }
00245     }
00246   <span class="keywordflow">for</span> (i = 0; i &lt;= dc-&gt;<a class="code" href="structdither__channel.html#o10">nlevels</a>; i++)
00247     <a class="code" href="print-util_8c.html#a23">stp_dprintf</a>(<a class="code" href="group__util.html#ga33">STP_DBG_INK</a>, v,
00248                 <span class="stringliteral">"    ink_list[%d] range %d value %d bits %d\n"</span>,
00249                 i, dc-&gt;<a class="code" href="structdither__channel.html#o9">ink_list</a>[i].<a class="code" href="structink__defn.html#o0">range</a>,
00250                 dc-&gt;<a class="code" href="structdither__channel.html#o9">ink_list</a>[i].<a class="code" href="structink__defn.html#o1">value</a>, dc-&gt;<a class="code" href="structdither__channel.html#o9">ink_list</a>[i].<a class="code" href="structink__defn.html#o2">bits</a>);
00251   <span class="keywordflow">if</span> (dc-&gt;<a class="code" href="structdither__channel.html#o10">nlevels</a> == 1 &amp;&amp; dc-&gt;<a class="code" href="structdither__channel.html#o11">ranges</a>[0].<a class="code" href="structdither__segment.html#o1">upper</a>-&gt;<a class="code" href="structink__defn.html#o2">bits</a> == 1)
00252     dc-&gt;<a class="code" href="structdither__channel.html#o8">very_fast</a> = 1;
00253   <span class="keywordflow">else</span>
00254     dc-&gt;<a class="code" href="structdither__channel.html#o8">very_fast</a> = 0;
00255 
00256   <a class="code" href="print-util_8c.html#a23">stp_dprintf</a>(<a class="code" href="group__util.html#ga33">STP_DBG_INK</a>, v,
00257               <span class="stringliteral">"  bit_max %d signif_bits %d\n"</span>, dc-&gt;<a class="code" href="structdither__channel.html#o1">bit_max</a>, dc-&gt;<a class="code" href="structdither__channel.html#o2">signif_bits</a>);
00258 }
00259 
00260 <span class="keyword">static</span> <span class="keywordtype">void</span>
<a name="l00261"></a><a class="code" href="dither-inks_8c.html#a9">00261</a> <a class="code" href="dither-inks_8c.html#a9">stpi_dither_set_ranges</a>(<a class="code" href="structstp__vars.html">stp_vars_t</a> *v, <span class="keywordtype">int</span> color, <span class="keyword">const</span> <a class="code" href="structstp__shade.html">stp_shade_t</a> *shade,
00262                        <span class="keywordtype">double</span> density, <span class="keywordtype">double</span> darkness)
00263 {
00264   <a class="code" href="structdither.html">stpi_dither_t</a> *d = (<a class="code" href="structdither.html">stpi_dither_t</a> *) <a class="code" href="group__vars.html#ga20">stp_get_component_data</a>(v, <span class="stringliteral">"Dither"</span>);
00265   <a class="code" href="structdither__channel.html">stpi_dither_channel_t</a> *dc = &amp;(<a class="code" href="dither-impl_8h.html#a16">CHANNEL</a>(d, color));
00266   <span class="keyword">const</span> <a class="code" href="structstp__dotsize.html">stp_dotsize_t</a> *ranges = shade-&gt;<a class="code" href="structstp__shade.html#o2">dot_sizes</a>;
00267   <span class="keywordtype">int</span> nlevels = shade-&gt;<a class="code" href="structstp__shade.html#o1">numsizes</a>;
00268   <span class="keywordtype">int</span> i;
00269 
00270   <a class="code" href="group__util.html#ga52">STP_SAFE_FREE</a>(dc-&gt;<a class="code" href="structdither__channel.html#o11">ranges</a>);
00271   <a class="code" href="group__util.html#ga52">STP_SAFE_FREE</a>(dc-&gt;<a class="code" href="structdither__channel.html#o9">ink_list</a>);
00272 
00273   dc-&gt;<a class="code" href="structdither__channel.html#o10">nlevels</a> = nlevels &gt; 1 ? nlevels + 1 : nlevels;
00274   dc-&gt;<a class="code" href="structdither__channel.html#o11">ranges</a> = (<a class="code" href="structdither__segment.html">stpi_dither_segment_t</a> *)
00275     <a class="code" href="group__util.html#ga29">stp_zalloc</a>(dc-&gt;<a class="code" href="structdither__channel.html#o10">nlevels</a> * <span class="keyword">sizeof</span>(<a class="code" href="structdither__segment.html">stpi_dither_segment_t</a>));
00276   dc-&gt;<a class="code" href="structdither__channel.html#o9">ink_list</a> = (<a class="code" href="structink__defn.html">stpi_ink_defn_t</a> *)
00277     <a class="code" href="group__util.html#ga29">stp_zalloc</a>((dc-&gt;<a class="code" href="structdither__channel.html#o10">nlevels</a> + 1) * <span class="keyword">sizeof</span>(<a class="code" href="structink__defn.html">stpi_ink_defn_t</a>));
00278   dc-&gt;<a class="code" href="structdither__channel.html#o1">bit_max</a> = 0;
00279   dc-&gt;<a class="code" href="structdither__channel.html#o3">density</a> = density * 65535;
00280   dc-&gt;<a class="code" href="structdither__channel.html#o4">darkness</a> = darkness;
00281   <a class="code" href="group__util.html#ga26">stp_init_debug_messages</a>(v);
00282   <a class="code" href="print-util_8c.html#a23">stp_dprintf</a>(<a class="code" href="group__util.html#ga33">STP_DBG_INK</a>, v,
00283               <span class="stringliteral">"stpi_dither_set_ranges channel %d nlevels %d density %f darkness %f\n"</span>,
00284               color, nlevels, density, darkness);
00285   <span class="keywordflow">for</span> (i = 0; i &lt; nlevels; i++)
00286     <a class="code" href="print-util_8c.html#a23">stp_dprintf</a>(<a class="code" href="group__util.html#ga33">STP_DBG_INK</a>, v,
00287                 <span class="stringliteral">"  level %d value %f pattern %x\n"</span>, i,
00288                 ranges[i].value, ranges[i].bit_pattern);
00289   dc-&gt;<a class="code" href="structdither__channel.html#o11">ranges</a>[0].<a class="code" href="structdither__segment.html#o0">lower</a> = &amp;dc-&gt;<a class="code" href="structdither__channel.html#o9">ink_list</a>[0];
00290   dc-&gt;<a class="code" href="structdither__channel.html#o11">ranges</a>[0].<a class="code" href="structdither__segment.html#o1">upper</a> = &amp;dc-&gt;<a class="code" href="structdither__channel.html#o9">ink_list</a>[1];
00291   dc-&gt;<a class="code" href="structdither__channel.html#o9">ink_list</a>[0].<a class="code" href="structink__defn.html#o0">range</a> = 0;
00292   dc-&gt;<a class="code" href="structdither__channel.html#o9">ink_list</a>[0].<a class="code" href="structink__defn.html#o1">value</a> = 0;
00293   dc-&gt;<a class="code" href="structdither__channel.html#o9">ink_list</a>[0].<a class="code" href="structink__defn.html#o2">bits</a> = 0;
00294   <span class="keywordflow">if</span> (nlevels == 1)
00295     dc-&gt;<a class="code" href="structdither__channel.html#o9">ink_list</a>[1].<a class="code" href="structink__defn.html#o0">range</a> = 65535;
00296   <span class="keywordflow">else</span>
00297     dc-&gt;<a class="code" href="structdither__channel.html#o9">ink_list</a>[1].<a class="code" href="structink__defn.html#o0">range</a> = ranges[0].<a class="code" href="structstp__dotsize.html#o1">value</a> * 65535.0 * density;
00298   <span class="keywordflow">if</span> (dc-&gt;<a class="code" href="structdither__channel.html#o9">ink_list</a>[1].<a class="code" href="structink__defn.html#o0">range</a> &gt; 65535)
00299     dc-&gt;<a class="code" href="structdither__channel.html#o9">ink_list</a>[1].<a class="code" href="structink__defn.html#o0">range</a> = 65535;
00300   dc-&gt;<a class="code" href="structdither__channel.html#o9">ink_list</a>[1].<a class="code" href="structink__defn.html#o1">value</a> = ranges[0].<a class="code" href="structstp__dotsize.html#o1">value</a> * 65535.0;
00301   <span class="keywordflow">if</span> (dc-&gt;<a class="code" href="structdither__channel.html#o9">ink_list</a>[1].<a class="code" href="structink__defn.html#o1">value</a> &gt; 65535)
00302     dc-&gt;<a class="code" href="structdither__channel.html#o9">ink_list</a>[1].<a class="code" href="structink__defn.html#o1">value</a> = 65535;
00303   dc-&gt;<a class="code" href="structdither__channel.html#o9">ink_list</a>[1].<a class="code" href="structink__defn.html#o2">bits</a> = ranges[0].<a class="code" href="structstp__dotsize.html#o0">bit_pattern</a>;
00304   <span class="keywordflow">if</span> (ranges[0].<a class="code" href="structstp__dotsize.html#o0">bit_pattern</a> &gt; dc-&gt;<a class="code" href="structdither__channel.html#o1">bit_max</a>)
00305     dc-&gt;<a class="code" href="structdither__channel.html#o1">bit_max</a> = ranges[0].<a class="code" href="structstp__dotsize.html#o0">bit_pattern</a>;
00306   dc-&gt;<a class="code" href="structdither__channel.html#o11">ranges</a>[0].<a class="code" href="structdither__segment.html#o2">range_span</a> = dc-&gt;<a class="code" href="structdither__channel.html#o11">ranges</a>[0].<a class="code" href="structdither__segment.html#o1">upper</a>-&gt;<a class="code" href="structink__defn.html#o0">range</a>;
00307   dc-&gt;<a class="code" href="structdither__channel.html#o11">ranges</a>[0].<a class="code" href="structdither__segment.html#o3">value_span</a> = dc-&gt;<a class="code" href="structdither__channel.html#o11">ranges</a>[0].<a class="code" href="structdither__segment.html#o1">upper</a>-&gt;<a class="code" href="structink__defn.html#o1">value</a>;
00308   <span class="keywordflow">if</span> (dc-&gt;<a class="code" href="structdither__channel.html#o10">nlevels</a> &gt; 1)
00309     {
00310       <span class="keywordflow">for</span> (i = 1; i &lt; nlevels; i++)
00311         {
00312           <span class="keywordtype">int</span> l = i + 1;
00313           dc-&gt;<a class="code" href="structdither__channel.html#o11">ranges</a>[i].<a class="code" href="structdither__segment.html#o0">lower</a> = &amp;dc-&gt;<a class="code" href="structdither__channel.html#o9">ink_list</a>[i];
00314           dc-&gt;<a class="code" href="structdither__channel.html#o11">ranges</a>[i].<a class="code" href="structdither__segment.html#o1">upper</a> = &amp;dc-&gt;<a class="code" href="structdither__channel.html#o9">ink_list</a>[l];
00315 
00316           dc-&gt;<a class="code" href="structdither__channel.html#o9">ink_list</a>[l].<a class="code" href="structink__defn.html#o0">range</a> =
00317             (ranges[i].<a class="code" href="structstp__dotsize.html#o1">value</a> + ranges[i].<a class="code" href="structstp__dotsize.html#o1">value</a>) * 32768.0 * density;
00318           <span class="keywordflow">if</span> (dc-&gt;<a class="code" href="structdither__channel.html#o9">ink_list</a>[l].<a class="code" href="structink__defn.html#o0">range</a> &gt; 65535)
00319             dc-&gt;<a class="code" href="structdither__channel.html#o9">ink_list</a>[l].<a class="code" href="structink__defn.html#o0">range</a> = 65535;
00320           dc-&gt;<a class="code" href="structdither__channel.html#o9">ink_list</a>[l].<a class="code" href="structink__defn.html#o1">value</a> = ranges[i].<a class="code" href="structstp__dotsize.html#o1">value</a> * 65535.0;
00321           <span class="keywordflow">if</span> (dc-&gt;<a class="code" href="structdither__channel.html#o9">ink_list</a>[l].<a class="code" href="structink__defn.html#o1">value</a> &gt; 65535)
00322             dc-&gt;<a class="code" href="structdither__channel.html#o9">ink_list</a>[l].<a class="code" href="structink__defn.html#o1">value</a> = 65535;
00323           dc-&gt;<a class="code" href="structdither__channel.html#o9">ink_list</a>[l].<a class="code" href="structink__defn.html#o2">bits</a> = ranges[i].<a class="code" href="structstp__dotsize.html#o0">bit_pattern</a>;
00324           <span class="keywordflow">if</span> (ranges[i].<a class="code" href="structstp__dotsize.html#o0">bit_pattern</a> &gt; dc-&gt;<a class="code" href="structdither__channel.html#o1">bit_max</a>)
00325             dc-&gt;<a class="code" href="structdither__channel.html#o1">bit_max</a> = ranges[i].<a class="code" href="structstp__dotsize.html#o0">bit_pattern</a>;
00326           dc-&gt;<a class="code" href="structdither__channel.html#o11">ranges</a>[i].<a class="code" href="structdither__segment.html#o2">range_span</a> =
00327             dc-&gt;<a class="code" href="structdither__channel.html#o9">ink_list</a>[l].<a class="code" href="structink__defn.html#o0">range</a> - dc-&gt;<a class="code" href="structdither__channel.html#o9">ink_list</a>[i].<a class="code" href="structink__defn.html#o0">range</a>;
00328           dc-&gt;<a class="code" href="structdither__channel.html#o11">ranges</a>[i].<a class="code" href="structdither__segment.html#o3">value_span</a> =
00329             dc-&gt;<a class="code" href="structdither__channel.html#o9">ink_list</a>[l].<a class="code" href="structink__defn.html#o1">value</a> - dc-&gt;<a class="code" href="structdither__channel.html#o9">ink_list</a>[i].<a class="code" href="structink__defn.html#o1">value</a>;
00330         }
00331       dc-&gt;<a class="code" href="structdither__channel.html#o11">ranges</a>[i].<a class="code" href="structdither__segment.html#o0">lower</a> = &amp;dc-&gt;<a class="code" href="structdither__channel.html#o9">ink_list</a>[i];
00332       dc-&gt;<a class="code" href="structdither__channel.html#o11">ranges</a>[i].<a class="code" href="structdither__segment.html#o1">upper</a> = &amp;dc-&gt;<a class="code" href="structdither__channel.html#o9">ink_list</a>[i+1];
00333       dc-&gt;<a class="code" href="structdither__channel.html#o9">ink_list</a>[i+1] = dc-&gt;<a class="code" href="structdither__channel.html#o9">ink_list</a>[i];
00334       dc-&gt;<a class="code" href="structdither__channel.html#o9">ink_list</a>[i+1].<a class="code" href="structink__defn.html#o0">range</a> = 65535;
00335       dc-&gt;<a class="code" href="structdither__channel.html#o11">ranges</a>[i].<a class="code" href="structdither__segment.html#o2">range_span</a> =
00336         dc-&gt;<a class="code" href="structdither__channel.html#o9">ink_list</a>[i+1].<a class="code" href="structink__defn.html#o0">range</a> - dc-&gt;<a class="code" href="structdither__channel.html#o9">ink_list</a>[i].<a class="code" href="structink__defn.html#o0">range</a>;
00337       dc-&gt;<a class="code" href="structdither__channel.html#o11">ranges</a>[i].<a class="code" href="structdither__segment.html#o3">value_span</a> =
00338         dc-&gt;<a class="code" href="structdither__channel.html#o9">ink_list</a>[i+1].<a class="code" href="structink__defn.html#o1">value</a> - dc-&gt;<a class="code" href="structdither__channel.html#o9">ink_list</a>[i].<a class="code" href="structink__defn.html#o1">value</a>;
00339     }
00340   <a class="code" href="dither-inks_8c.html#a8">stpi_dither_finalize_ranges</a>(v, dc);
00341   <a class="code" href="group__util.html#ga27">stp_flush_debug_messages</a>(v);
00342 }
00343 
00344 <span class="keywordtype">void</span>
<a name="l00345"></a><a class="code" href="dither-inks_8c.html#a10">00345</a> <a class="code" href="dither-inks_8c.html#a10">stp_dither_set_inks_simple</a>(<a class="code" href="structstp__vars.html">stp_vars_t</a> *v, <span class="keywordtype">int</span> color, <span class="keywordtype">int</span> nlevels,
00346                            <span class="keyword">const</span> <span class="keywordtype">double</span> *levels, <span class="keywordtype">double</span> density,
00347                            <span class="keywordtype">double</span> darkness)
00348 {
00349   <a class="code" href="structstp__shade.html">stp_shade_t</a> s;
00350   <a class="code" href="structstp__dotsize.html">stp_dotsize_t</a> *d = <a class="code" href="group__util.html#ga28">stp_malloc</a>(nlevels * <span class="keyword">sizeof</span>(<a class="code" href="structstp__dotsize.html">stp_dotsize_t</a>));
00351   <span class="keywordtype">int</span> i;
00352   s.<a class="code" href="structstp__shade.html#o2">dot_sizes</a> = d;
00353   s.<a class="code" href="structstp__shade.html#o0">value</a> = 65535.0;
00354   s.<a class="code" href="structstp__shade.html#o1">numsizes</a> = nlevels;
00355 
00356   <span class="keywordflow">for</span> (i = 0; i &lt; nlevels; i++)
00357     {
00358       d[i].<a class="code" href="structstp__dotsize.html#o0">bit_pattern</a> = i + 1;
00359       d[i].<a class="code" href="structstp__dotsize.html#o1">value</a> = levels[i];
00360     }
00361   <a class="code" href="dither-inks_8c.html#a11">stp_dither_set_inks_full</a>(v, color, 1, &amp;s, density, darkness);
00362   <a class="code" href="group__util.html#ga31">stp_free</a>(d);
00363 }
00364 
00365 <span class="keywordtype">void</span>
<a name="l00366"></a><a class="code" href="dither-inks_8c.html#a11">00366</a> <a class="code" href="dither-inks_8c.html#a11">stp_dither_set_inks_full</a>(<a class="code" href="structstp__vars.html">stp_vars_t</a> *v, <span class="keywordtype">int</span> color, <span class="keywordtype">int</span> nshades,
00367                          <span class="keyword">const</span> <a class="code" href="structstp__shade.html">stp_shade_t</a> *shades, <span class="keywordtype">double</span> density,
00368                          <span class="keywordtype">double</span> darkness)
00369 {
00370   <span class="keywordtype">int</span> i;
00371   <span class="keywordtype">int</span> idx;
00372   <a class="code" href="structdither__channel.html">stpi_dither_channel_t</a> *dc;
00373 
00374   <a class="code" href="structdither.html">stpi_dither_t</a> *d = (<a class="code" href="structdither.html">stpi_dither_t</a> *) <a class="code" href="group__vars.html#ga20">stp_get_component_data</a>(v, <span class="stringliteral">"Dither"</span>);
00375 
00376   <a class="code" href="channel_8c.html#a3">stp_channel_reset_channel</a>(v, color);
00377 
00378   <span class="keywordflow">for</span> (i = nshades - 1; i &gt;= 0; i--)
00379     {
00380       <span class="keywordtype">int</span> subchannel = nshades - i - 1;
00381       idx = <a class="code" href="dither-inks_8c.html#a0">stpi_dither_translate_channel</a>(v, color, subchannel);
00382       <a class="code" href="print-weave_8c.html#a1">assert</a>(idx &gt;= 0);
00383       dc = &amp;(<a class="code" href="dither-impl_8h.html#a16">CHANNEL</a>(d, idx));
00384 
00385       <a class="code" href="channel_8c.html#a6">stp_channel_add</a>(v, color, subchannel, shades[i].value);
00386       <span class="keywordflow">if</span> (idx &gt;= 0)
00387         <a class="code" href="dither-inks_8c.html#a9">stpi_dither_set_ranges</a>(v, idx, &amp;shades[i], density,
00388                                shades[i].value * darkness);
00389       <a class="code" href="print-util_8c.html#a23">stp_dprintf</a>(<a class="code" href="group__util.html#ga33">STP_DBG_INK</a>, v,
00390                   <span class="stringliteral">"  shade %d value %f\n"</span>,
00391                   i, shades[i].value);
00392     }
00393 }
00394 
00395 <span class="keywordtype">void</span>
<a name="l00396"></a><a class="code" href="dither-inks_8c.html#a12">00396</a> <a class="code" href="dither-inks_8c.html#a12">stp_dither_set_inks</a>(<a class="code" href="structstp__vars.html">stp_vars_t</a> *v, <span class="keywordtype">int</span> color, <span class="keywordtype">double</span> density, <span class="keywordtype">double</span> darkness,
00397                     <span class="keywordtype">int</span> nshades, <span class="keyword">const</span> <span class="keywordtype">double</span> *svalues,
00398                     <span class="keywordtype">int</span> ndotsizes, <span class="keyword">const</span> <span class="keywordtype">double</span> *dvalues)
00399 {
00400   <span class="keywordtype">int</span> i, j;
00401   <a class="code" href="structstp__shade.html">stp_shade_t</a> *shades = <a class="code" href="group__util.html#ga28">stp_malloc</a>(<span class="keyword">sizeof</span>(<a class="code" href="structstp__shade.html">stp_shade_t</a>) * nshades);
00402   <a class="code" href="structstp__dotsize.html">stp_dotsize_t</a> *dotsizes = <a class="code" href="group__util.html#ga28">stp_malloc</a>(<span class="keyword">sizeof</span>(<a class="code" href="structstp__dotsize.html">stp_dotsize_t</a>) * ndotsizes);
00403   j = 0;
00404   <span class="keywordflow">for</span> (i = 0; i &lt; ndotsizes; i++)
00405     {
00406       <span class="comment">/* Skip over any zero-valued dot sizes */</span>
00407       <span class="keywordflow">if</span> (dvalues[i] &gt; 0)
00408         {
00409           dotsizes[j].<a class="code" href="structstp__dotsize.html#o1">value</a> = dvalues[i];
00410           dotsizes[j].<a class="code" href="structstp__dotsize.html#o0">bit_pattern</a> = i + 1;
00411           j++;
00412         }
00413     }
00414   <span class="keywordflow">for</span> (i = 0; i &lt; nshades; i++)
00415     {
00416       shades[i].<a class="code" href="structstp__shade.html#o0">value</a> = svalues[i];
00417       shades[i].<a class="code" href="structstp__shade.html#o1">numsizes</a> = j;
00418       shades[i].<a class="code" href="structstp__shade.html#o2">dot_sizes</a> = dotsizes;
00419     }
00420   <a class="code" href="dither-inks_8c.html#a11">stp_dither_set_inks_full</a>(v, color, nshades, shades, density, darkness);
00421   <a class="code" href="group__util.html#ga31">stp_free</a>(dotsizes);
00422   <a class="code" href="group__util.html#ga31">stp_free</a>(shades);
00423 }
</pre></div><hr size="1"><address style="align: right;"><small>Generated on Wed Aug 25 07:56:13 2004 for libgimpprint API Reference by
<a href="http://www.doxygen.org/index.html">
<img src="doxygen.png" alt="doxygen" align="middle" border=0 > </a>1.3.6 </small></address>
</body>
</html>
