<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html><head><meta http-equiv="Content-Type" content="text/html;charset=iso-8859-1">
<title>libgimpprint API Reference: src/main/print-color.c Source File</title>
<link href="doxygen.css" rel="stylesheet" type="text/css">
</head><body>
<!-- Generated by Doxygen 1.3.6 -->
<div class="qindex"><a class="qindex" href="index.html">Main&nbsp;Page</a> | <a class="qindex" href="modules.html">Modules</a> | <a class="qindex" href="classes.html">Alphabetical&nbsp;List</a> | <a class="qindex" href="annotated.html">Data&nbsp;Structures</a> | <a class="qindex" href="files.html">File&nbsp;List</a> | <a class="qindex" href="functions.html">Data&nbsp;Fields</a> | <a class="qindex" href="globals.html">Globals</a> | <a class="qindex" href="pages.html">Related&nbsp;Pages</a></div>
<h1>src/main/print-color.c</h1><a href="print-color_8c.html">Go to the documentation of this file.</a><div class="fragment"><pre>00001 <span class="comment">/*</span>
00002 <span class="comment"> * "$Id: print-color_8c-source.html,v 1.1.1.2 2004/12/22 23:49:06 jlovell Exp $"</span>
00003 <span class="comment"> *</span>
00004 <span class="comment"> *   Gimp-Print color management module - traditional Gimp-Print algorithm.</span>
00005 <span class="comment"> *</span>
00006 <span class="comment"> *   Copyright 1997-2000 Michael Sweet (mike@easysw.com) and</span>
00007 <span class="comment"> *      Robert Krawitz (rlk@alum.mit.edu)</span>
00008 <span class="comment"> *</span>
00009 <span class="comment"> *   This program is free software; you can redistribute it and/or modify it</span>
00010 <span class="comment"> *   under the terms of the GNU General Public License as published by the Free</span>
00011 <span class="comment"> *   Software Foundation; either version 2 of the License, or (at your option)</span>
00012 <span class="comment"> *   any later version.</span>
00013 <span class="comment"> *</span>
00014 <span class="comment"> *   This program is distributed in the hope that it will be useful, but</span>
00015 <span class="comment"> *   WITHOUT ANY WARRANTY; without even the implied warranty of MERCHANTABILITY</span>
00016 <span class="comment"> *   or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU General Public License</span>
00017 <span class="comment"> *   for more details.</span>
00018 <span class="comment"> *</span>
00019 <span class="comment"> *   You should have received a copy of the GNU General Public License</span>
00020 <span class="comment"> *   along with this program; if not, write to the Free Software</span>
00021 <span class="comment"> *   Foundation, Inc., 59 Temple Place - Suite 330, Boston, MA 02111-1307, USA.</span>
00022 <span class="comment"> */</span>
00023 
00024 <span class="comment">/*</span>
00025 <span class="comment"> * This file must include only standard C header files.  The core code must</span>
00026 <span class="comment"> * compile on generic platforms that don't support glib, gimp, gtk, etc.</span>
00027 <span class="comment"> */</span>
00028 
00029 <span class="preprocessor">#ifdef HAVE_CONFIG_H</span>
00030 <span class="preprocessor"></span><span class="preprocessor">#include &lt;config.h&gt;</span>
00031 <span class="preprocessor">#endif</span>
00032 <span class="preprocessor"></span><span class="preprocessor">#include &lt;<a class="code" href="gimp-print_8h.html">gimp-print/gimp-print.h</a>&gt;</span>
00033 <span class="preprocessor">#include "<a class="code" href="gimp-print-internal_8h.html">gimp-print-internal.h</a>"</span>
00034 <span class="preprocessor">#include &lt;<a class="code" href="gimp-print-intl-internal_8h.html">gimp-print/gimp-print-intl-internal.h</a>&gt;</span>
00035 <span class="preprocessor">#include &lt;<a class="code" href="curve-cache_8h.html">gimp-print/curve-cache.h</a>&gt;</span>
00036 <span class="preprocessor">#include &lt;math.h&gt;</span>
00037 <span class="preprocessor">#ifdef HAVE_LIMITS_H</span>
00038 <span class="preprocessor"></span><span class="preprocessor">#include &lt;limits.h&gt;</span>
00039 <span class="preprocessor">#endif</span>
00040 <span class="preprocessor"></span><span class="preprocessor">#include &lt;string.h&gt;</span>
00041 <span class="preprocessor">#include "<a class="code" href="color-conversion_8h.html">color-conversion.h</a>"</span>
00042 
00043 <span class="preprocessor">#ifdef __GNUC__</span>
00044 <span class="preprocessor"></span><span class="preprocessor">#define inline __inline__</span>
00045 <span class="preprocessor"></span><span class="preprocessor">#endif</span>
00046 <span class="preprocessor"></span>
<a name="l00047"></a><a class="code" href="print-color_8c.html#a4">00047</a> <span class="keyword">static</span> <span class="keyword">const</span> <a class="code" href="structcolor__correction__t.html">color_correction_t</a> <a class="code" href="print-color_8c.html#a4">color_corrections</a>[] =
00048 {
00049   { <span class="stringliteral">"None"</span>,        <a class="code" href="group__intl__internal.html#ga6">N_</a>(<span class="stringliteral">"Default"</span>),       <a class="code" href="color-conversion_8h.html#a51a26">COLOR_CORRECTION_DEFAULT</a>,     1 },
00050   { <span class="stringliteral">"Accurate"</span>,    <a class="code" href="group__intl__internal.html#ga6">N_</a>(<span class="stringliteral">"High Accuracy"</span>), <a class="code" href="color-conversion_8h.html#a51a29">COLOR_CORRECTION_ACCURATE</a>,    1 },
00051   { <span class="stringliteral">"Bright"</span>,      <a class="code" href="group__intl__internal.html#ga6">N_</a>(<span class="stringliteral">"Bright Colors"</span>), <a class="code" href="color-conversion_8h.html#a51a28">COLOR_CORRECTION_BRIGHT</a>,      1 },
00052   { <span class="stringliteral">"Uncorrected"</span>, <a class="code" href="group__intl__internal.html#ga6">N_</a>(<span class="stringliteral">"Uncorrected"</span>),   <a class="code" href="color-conversion_8h.html#a51a27">COLOR_CORRECTION_UNCORRECTED</a>, 0 },
00053   { <span class="stringliteral">"Desaturated"</span>, <a class="code" href="group__intl__internal.html#ga6">N_</a>(<span class="stringliteral">"Desaturated"</span>),   <a class="code" href="color-conversion_8h.html#a51a31">COLOR_CORRECTION_DESATURATED</a>, 0 },
00054   { <span class="stringliteral">"Threshold"</span>,   <a class="code" href="group__intl__internal.html#ga6">N_</a>(<span class="stringliteral">"Threshold"</span>),     <a class="code" href="color-conversion_8h.html#a51a30">COLOR_CORRECTION_THRESHOLD</a>,   0 },
00055   { <span class="stringliteral">"Density"</span>,     <a class="code" href="group__intl__internal.html#ga6">N_</a>(<span class="stringliteral">"Density"</span>),       <a class="code" href="color-conversion_8h.html#a51a32">COLOR_CORRECTION_DENSITY</a>,     0 },
00056   { <span class="stringliteral">"Raw"</span>,         <a class="code" href="group__intl__internal.html#ga6">N_</a>(<span class="stringliteral">"Raw"</span>),           <a class="code" href="color-conversion_8h.html#a51a33">COLOR_CORRECTION_RAW</a>,         0 },
00057   { <span class="stringliteral">"Predithered"</span>, <a class="code" href="group__intl__internal.html#ga6">N_</a>(<span class="stringliteral">"Pre-Dithered"</span>),  <a class="code" href="color-conversion_8h.html#a51a34">COLOR_CORRECTION_PREDITHERED</a>, 0 },
00058 };
00059 
<a name="l00060"></a><a class="code" href="print-color_8c.html#a5">00060</a> <span class="keyword">static</span> <span class="keyword">const</span> <span class="keywordtype">int</span> <a class="code" href="print-color_8c.html#a5">color_correction_count</a> =
00061 <span class="keyword">sizeof</span>(<a class="code" href="print-color_8c.html#a4">color_corrections</a>) / <span class="keyword">sizeof</span>(<a class="code" href="structcolor__correction__t.html">color_correction_t</a>);
00062 
00063 
<a name="l00064"></a><a class="code" href="print-color_8c.html#a6">00064</a> <span class="keyword">static</span> <span class="keyword">const</span> <a class="code" href="structchannel__param__t.html">channel_param_t</a> <a class="code" href="print-color_8c.html#a6">channel_params</a>[] =
00065 {
00066   { <a class="code" href="color-conversion_8h.html#a9">CMASK_K</a>, <span class="stringliteral">"BlackGamma"</span>,   <span class="stringliteral">"BlackCurve"</span>,   <span class="stringliteral">"WhiteGamma"</span>,   <span class="stringliteral">"WhiteCurve"</span>   },
00067   { <a class="code" href="color-conversion_8h.html#a10">CMASK_C</a>, <span class="stringliteral">"CyanGamma"</span>,    <span class="stringliteral">"CyanCurve"</span>,    <span class="stringliteral">"RedGamma"</span>,     <span class="stringliteral">"RedCurve"</span>     },
00068   { <a class="code" href="color-conversion_8h.html#a11">CMASK_M</a>, <span class="stringliteral">"MagentaGamma"</span>, <span class="stringliteral">"MagentaCurve"</span>, <span class="stringliteral">"GreenGamma"</span>,   <span class="stringliteral">"GreenCurve"</span>   },
00069   { <a class="code" href="color-conversion_8h.html#a12">CMASK_Y</a>, <span class="stringliteral">"YellowGamma"</span>,  <span class="stringliteral">"YellowCurve"</span>,  <span class="stringliteral">"BlueGamma"</span>,    <span class="stringliteral">"BlueCurve"</span>    },
00070   { <a class="code" href="color-conversion_8h.html#a13">CMASK_W</a>, <span class="stringliteral">"WhiteGamma"</span>,   <span class="stringliteral">"WhiteCurve"</span>,   <span class="stringliteral">"BlackGamma"</span>,   <span class="stringliteral">"BlackCurve"</span>   },
00071   { <a class="code" href="color-conversion_8h.html#a14">CMASK_R</a>, <span class="stringliteral">"RedGamma"</span>,     <span class="stringliteral">"RedCurve"</span>,     <span class="stringliteral">"CyanGamma"</span>,    <span class="stringliteral">"CyanCurve"</span>    },
00072   { <a class="code" href="color-conversion_8h.html#a15">CMASK_G</a>, <span class="stringliteral">"GreenGamma"</span>,   <span class="stringliteral">"GreenCurve"</span>,   <span class="stringliteral">"MagentaGamma"</span>, <span class="stringliteral">"MagentaCurve"</span> },
00073   { <a class="code" href="color-conversion_8h.html#a16">CMASK_B</a>, <span class="stringliteral">"BlueGamma"</span>,    <span class="stringliteral">"BlueCurve"</span>,    <span class="stringliteral">"YellowGamma"</span>,  <span class="stringliteral">"YellowCurve"</span>  },
00074 };
00075 
<a name="l00076"></a><a class="code" href="print-color_8c.html#a7">00076</a> <span class="keyword">static</span> <span class="keyword">const</span> <span class="keywordtype">int</span> <a class="code" href="print-color_8c.html#a7">channel_param_count</a> =
00077 <span class="keyword">sizeof</span>(<a class="code" href="print-color_8c.html#a6">channel_params</a>) / <span class="keyword">sizeof</span>(<a class="code" href="structchannel__param__t.html">channel_param_t</a>);
00078 
<a name="l00079"></a><a class="code" href="print-color_8c.html#a8">00079</a> <span class="keyword">static</span> <span class="keyword">const</span> <a class="code" href="structchannel__param__t.html">channel_param_t</a> <a class="code" href="print-color_8c.html#a8">raw_channel_params</a>[] =
00080 {
00081   { 0,  <span class="stringliteral">"GammaCh0"</span>,  <span class="stringliteral">"CurveCh0"</span>,  <span class="stringliteral">"GammaCh0"</span>,  <span class="stringliteral">"CurveCh0"</span>  },
00082   { 1,  <span class="stringliteral">"GammaCh1"</span>,  <span class="stringliteral">"CurveCh1"</span>,  <span class="stringliteral">"GammaCh1"</span>,  <span class="stringliteral">"CurveCh1"</span>  },
00083   { 2,  <span class="stringliteral">"GammaCh2"</span>,  <span class="stringliteral">"CurveCh2"</span>,  <span class="stringliteral">"GammaCh2"</span>,  <span class="stringliteral">"CurveCh2"</span>  },
00084   { 3,  <span class="stringliteral">"GammaCh3"</span>,  <span class="stringliteral">"CurveCh3"</span>,  <span class="stringliteral">"GammaCh3"</span>,  <span class="stringliteral">"CurveCh3"</span>  },
00085   { 4,  <span class="stringliteral">"GammaCh4"</span>,  <span class="stringliteral">"CurveCh4"</span>,  <span class="stringliteral">"GammaCh4"</span>,  <span class="stringliteral">"CurveCh4"</span>  },
00086   { 5,  <span class="stringliteral">"GammaCh5"</span>,  <span class="stringliteral">"CurveCh5"</span>,  <span class="stringliteral">"GammaCh5"</span>,  <span class="stringliteral">"CurveCh5"</span>  },
00087   { 6,  <span class="stringliteral">"GammaCh6"</span>,  <span class="stringliteral">"CurveCh6"</span>,  <span class="stringliteral">"GammaCh6"</span>,  <span class="stringliteral">"CurveCh6"</span>  },
00088   { 7,  <span class="stringliteral">"GammaCh7"</span>,  <span class="stringliteral">"CurveCh7"</span>,  <span class="stringliteral">"GammaCh7"</span>,  <span class="stringliteral">"CurveCh7"</span>  },
00089   { 8,  <span class="stringliteral">"GammaCh8"</span>,  <span class="stringliteral">"CurveCh8"</span>,  <span class="stringliteral">"GammaCh8"</span>,  <span class="stringliteral">"CurveCh8"</span>  },
00090   { 9,  <span class="stringliteral">"GammaCh9"</span>,  <span class="stringliteral">"CurveCh9"</span>,  <span class="stringliteral">"GammaCh9"</span>,  <span class="stringliteral">"CurveCh9"</span>  },
00091   { 10, <span class="stringliteral">"GammaCh10"</span>, <span class="stringliteral">"CurveCh10"</span>, <span class="stringliteral">"GammaCh10"</span>, <span class="stringliteral">"CurveCh10"</span> },
00092   { 11, <span class="stringliteral">"GammaCh11"</span>, <span class="stringliteral">"CurveCh11"</span>, <span class="stringliteral">"GammaCh11"</span>, <span class="stringliteral">"CurveCh11"</span> },
00093   { 12, <span class="stringliteral">"GammaCh12"</span>, <span class="stringliteral">"CurveCh12"</span>, <span class="stringliteral">"GammaCh12"</span>, <span class="stringliteral">"CurveCh12"</span> },
00094   { 13, <span class="stringliteral">"GammaCh13"</span>, <span class="stringliteral">"CurveCh13"</span>, <span class="stringliteral">"GammaCh13"</span>, <span class="stringliteral">"CurveCh13"</span> },
00095   { 14, <span class="stringliteral">"GammaCh14"</span>, <span class="stringliteral">"CurveCh14"</span>, <span class="stringliteral">"GammaCh14"</span>, <span class="stringliteral">"CurveCh14"</span> },
00096   { 15, <span class="stringliteral">"GammaCh15"</span>, <span class="stringliteral">"CurveCh15"</span>, <span class="stringliteral">"GammaCh15"</span>, <span class="stringliteral">"CurveCh15"</span> },
00097   { 16, <span class="stringliteral">"GammaCh16"</span>, <span class="stringliteral">"CurveCh16"</span>, <span class="stringliteral">"GammaCh16"</span>, <span class="stringliteral">"CurveCh16"</span> },
00098   { 17, <span class="stringliteral">"GammaCh17"</span>, <span class="stringliteral">"CurveCh17"</span>, <span class="stringliteral">"GammaCh17"</span>, <span class="stringliteral">"CurveCh17"</span> },
00099   { 18, <span class="stringliteral">"GammaCh18"</span>, <span class="stringliteral">"CurveCh18"</span>, <span class="stringliteral">"GammaCh18"</span>, <span class="stringliteral">"CurveCh18"</span> },
00100   { 19, <span class="stringliteral">"GammaCh19"</span>, <span class="stringliteral">"CurveCh19"</span>, <span class="stringliteral">"GammaCh19"</span>, <span class="stringliteral">"CurveCh19"</span> },
00101   { 20, <span class="stringliteral">"GammaCh20"</span>, <span class="stringliteral">"CurveCh20"</span>, <span class="stringliteral">"GammaCh20"</span>, <span class="stringliteral">"CurveCh20"</span> },
00102   { 21, <span class="stringliteral">"GammaCh21"</span>, <span class="stringliteral">"CurveCh21"</span>, <span class="stringliteral">"GammaCh21"</span>, <span class="stringliteral">"CurveCh21"</span> },
00103   { 22, <span class="stringliteral">"GammaCh22"</span>, <span class="stringliteral">"CurveCh22"</span>, <span class="stringliteral">"GammaCh22"</span>, <span class="stringliteral">"CurveCh22"</span> },
00104   { 23, <span class="stringliteral">"GammaCh23"</span>, <span class="stringliteral">"CurveCh23"</span>, <span class="stringliteral">"GammaCh23"</span>, <span class="stringliteral">"CurveCh23"</span> },
00105   { 24, <span class="stringliteral">"GammaCh24"</span>, <span class="stringliteral">"CurveCh24"</span>, <span class="stringliteral">"GammaCh24"</span>, <span class="stringliteral">"CurveCh24"</span> },
00106   { 25, <span class="stringliteral">"GammaCh25"</span>, <span class="stringliteral">"CurveCh25"</span>, <span class="stringliteral">"GammaCh25"</span>, <span class="stringliteral">"CurveCh25"</span> },
00107   { 26, <span class="stringliteral">"GammaCh26"</span>, <span class="stringliteral">"CurveCh26"</span>, <span class="stringliteral">"GammaCh26"</span>, <span class="stringliteral">"CurveCh26"</span> },
00108   { 27, <span class="stringliteral">"GammaCh27"</span>, <span class="stringliteral">"CurveCh27"</span>, <span class="stringliteral">"GammaCh27"</span>, <span class="stringliteral">"CurveCh27"</span> },
00109   { 28, <span class="stringliteral">"GammaCh28"</span>, <span class="stringliteral">"CurveCh28"</span>, <span class="stringliteral">"GammaCh28"</span>, <span class="stringliteral">"CurveCh28"</span> },
00110   { 29, <span class="stringliteral">"GammaCh29"</span>, <span class="stringliteral">"CurveCh29"</span>, <span class="stringliteral">"GammaCh29"</span>, <span class="stringliteral">"CurveCh29"</span> },
00111   { 30, <span class="stringliteral">"GammaCh30"</span>, <span class="stringliteral">"CurveCh30"</span>, <span class="stringliteral">"GammaCh30"</span>, <span class="stringliteral">"CurveCh30"</span> },
00112   { 31, <span class="stringliteral">"GammaCh31"</span>, <span class="stringliteral">"CurveCh31"</span>, <span class="stringliteral">"GammaCh31"</span>, <span class="stringliteral">"CurveCh31"</span> },
00113 };
00114 
<a name="l00115"></a><a class="code" href="print-color_8c.html#a9">00115</a> <span class="keyword">static</span> <span class="keyword">const</span> <span class="keywordtype">int</span> <a class="code" href="print-color_8c.html#a9">raw_channel_param_count</a> =
00116 <span class="keyword">sizeof</span>(<a class="code" href="print-color_8c.html#a8">raw_channel_params</a>) / <span class="keyword">sizeof</span>(<a class="code" href="structchannel__param__t.html">channel_param_t</a>);
00117 
00118 
<a name="l00119"></a><a class="code" href="print-color_8c.html#a10">00119</a> <span class="keyword">static</span> <span class="keyword">const</span> <a class="code" href="structcolor__description__t.html">color_description_t</a> <a class="code" href="print-color_8c.html#a10">color_descriptions</a>[] =
00120 {
00121   { <span class="stringliteral">"Grayscale"</span>,  1, 1, <a class="code" href="color-conversion_8h.html#a53a38">COLOR_ID_GRAY</a>,   <a class="code" href="color-conversion_8h.html#a52a36">COLOR_BLACK</a>,   <a class="code" href="color-conversion_8h.html#a9">CMASK_K</a>,      1,
00122     <a class="code" href="color-conversion_8h.html#a51a27">COLOR_CORRECTION_UNCORRECTED</a>, &amp;<a class="code" href="color-conversion_8h.html#a46">stpi_color_convert_to_gray</a>   },
00123   { <span class="stringliteral">"Whitescale"</span>, 1, 1, <a class="code" href="color-conversion_8h.html#a53a39">COLOR_ID_WHITE</a>,  <a class="code" href="color-conversion_8h.html#a52a35">COLOR_WHITE</a>,   <a class="code" href="color-conversion_8h.html#a9">CMASK_K</a>,      1,
00124     <a class="code" href="color-conversion_8h.html#a51a27">COLOR_CORRECTION_UNCORRECTED</a>, &amp;<a class="code" href="color-conversion_8h.html#a46">stpi_color_convert_to_gray</a>   },
00125   { <span class="stringliteral">"RGB"</span>,        1, 1, <a class="code" href="color-conversion_8h.html#a53a40">COLOR_ID_RGB</a>,    <a class="code" href="color-conversion_8h.html#a52a35">COLOR_WHITE</a>,   <a class="code" href="color-conversion_8h.html#a20">CMASK_CMY</a>,    3,
00126     <a class="code" href="color-conversion_8h.html#a51a29">COLOR_CORRECTION_ACCURATE</a>,    &amp;<a class="code" href="color-conversion_8h.html#a47">stpi_color_convert_to_color</a>  },
00127   { <span class="stringliteral">"CMY"</span>,        1, 1, <a class="code" href="color-conversion_8h.html#a53a41">COLOR_ID_CMY</a>,    <a class="code" href="color-conversion_8h.html#a52a36">COLOR_BLACK</a>,   <a class="code" href="color-conversion_8h.html#a20">CMASK_CMY</a>,    3,
00128     <a class="code" href="color-conversion_8h.html#a51a29">COLOR_CORRECTION_ACCURATE</a>,    &amp;<a class="code" href="color-conversion_8h.html#a47">stpi_color_convert_to_color</a>  },
00129   { <span class="stringliteral">"CMYK"</span>,       1, 0, <a class="code" href="color-conversion_8h.html#a53a42">COLOR_ID_CMYK</a>,   <a class="code" href="color-conversion_8h.html#a52a36">COLOR_BLACK</a>,   <a class="code" href="color-conversion_8h.html#a21">CMASK_CMYK</a>,   4,
00130     <a class="code" href="color-conversion_8h.html#a51a29">COLOR_CORRECTION_ACCURATE</a>,    &amp;<a class="code" href="color-conversion_8h.html#a48">stpi_color_convert_to_kcmy</a>   },
00131   { <span class="stringliteral">"KCMY"</span>,       1, 1, <a class="code" href="color-conversion_8h.html#a53a43">COLOR_ID_KCMY</a>,   <a class="code" href="color-conversion_8h.html#a52a36">COLOR_BLACK</a>,   <a class="code" href="color-conversion_8h.html#a21">CMASK_CMYK</a>,   4,
00132     <a class="code" href="color-conversion_8h.html#a51a29">COLOR_CORRECTION_ACCURATE</a>,    &amp;<a class="code" href="color-conversion_8h.html#a48">stpi_color_convert_to_kcmy</a>   },
00133   { <span class="stringliteral">"CMYKRB"</span>,     0, 1, <a class="code" href="color-conversion_8h.html#a53a44">COLOR_ID_CMYKRB</a>, <a class="code" href="color-conversion_8h.html#a52a36">COLOR_BLACK</a>,   <a class="code" href="color-conversion_8h.html#a22">CMASK_CMYKRB</a>, 6,
00134     <a class="code" href="color-conversion_8h.html#a51a29">COLOR_CORRECTION_ACCURATE</a>,    &amp;<a class="code" href="color-conversion_8h.html#a49">stpi_color_convert_to_cmykrb</a> },
00135   { <span class="stringliteral">"Raw"</span>,        1, 1, <a class="code" href="color-conversion_8h.html#a53a45">COLOR_ID_RAW</a>,    <a class="code" href="color-conversion_8h.html#a52a37">COLOR_UNKNOWN</a>, 0,           -1,
00136     <a class="code" href="color-conversion_8h.html#a51a33">COLOR_CORRECTION_RAW</a>,         &amp;<a class="code" href="color-conversion_8h.html#a50">stpi_color_convert_raw</a>       },
00137 };
00138 
<a name="l00139"></a><a class="code" href="print-color_8c.html#a11">00139</a> <span class="keyword">static</span> <span class="keyword">const</span> <span class="keywordtype">int</span> <a class="code" href="print-color_8c.html#a11">color_description_count</a> =
00140 <span class="keyword">sizeof</span>(<a class="code" href="print-color_8c.html#a10">color_descriptions</a>) / <span class="keyword">sizeof</span>(<a class="code" href="structcolor__description__t.html">color_description_t</a>);
00141 
00142 
<a name="l00143"></a><a class="code" href="print-color_8c.html#a12">00143</a> <span class="keyword">static</span> <span class="keyword">const</span> <a class="code" href="structchannel__depth__t.html">channel_depth_t</a> <a class="code" href="print-color_8c.html#a12">channel_depths</a>[] =
00144 {
00145   { <span class="stringliteral">"8"</span>,  8  },
00146   { <span class="stringliteral">"16"</span>, 16 }
00147 };
00148 
<a name="l00149"></a><a class="code" href="print-color_8c.html#a13">00149</a> <span class="keyword">static</span> <span class="keyword">const</span> <span class="keywordtype">int</span> <a class="code" href="print-color_8c.html#a13">channel_depth_count</a> =
00150 <span class="keyword">sizeof</span>(<a class="code" href="print-color_8c.html#a12">channel_depths</a>) / <span class="keyword">sizeof</span>(<a class="code" href="structchannel__depth__t.html">channel_depth_t</a>);
00151 
00152 
00153 <span class="keyword">typedef</span> <span class="keyword">struct</span>
00154 <span class="keyword"></span>{
00155   <span class="keyword">const</span> <a class="code" href="structstp__parameter__t.html">stp_parameter_t</a> param;
00156   <span class="keywordtype">double</span> min;
00157   <span class="keywordtype">double</span> <a class="code" href="print-lexmark_8c.html#a6">max</a>;
00158   <span class="keywordtype">double</span> defval;
<a name="l00159"></a><a class="code" href="structfloat__param__t.html#o5">00159</a>   <span class="keywordtype">unsigned</span> channel_mask;
00160   <span class="keywordtype">int</span> color_only;
00161 } <a class="code" href="structfloat__param__t.html">float_param_t</a>;
00162 
<a name="l00163"></a><a class="code" href="print-color_8c.html#a0">00163</a> <span class="preprocessor">#define RAW_GAMMA_CHANNEL(channel)                                       \</span>
00164 <span class="preprocessor">  {                                                                      \</span>
00165 <span class="preprocessor">    {                                                                    \</span>
00166 <span class="preprocessor">      "GammaCh" #channel, N_("Channel " #channel " Gamma"), N_("Gamma"), \</span>
00167 <span class="preprocessor">      N_("Gamma for raw channel " #channel),                             \</span>
00168 <span class="preprocessor">      STP_PARAMETER_TYPE_DOUBLE, STP_PARAMETER_CLASS_OUTPUT,             \</span>
00169 <span class="preprocessor">      STP_PARAMETER_LEVEL_INTERNAL, 0, 1, channel, 1, 0                  \</span>
00170 <span class="preprocessor">    }, 0.1, 4.0, 1.0, CMASK_RAW, 0                                       \</span>
00171 <span class="preprocessor">  }</span>
00172 <span class="preprocessor"></span>
<a name="l00173"></a><a class="code" href="print-color_8c.html#a14">00173</a> <span class="keyword">static</span> <span class="keyword">const</span> <a class="code" href="structfloat__param__t.html">float_param_t</a> <a class="code" href="print-color_8c.html#a14">float_parameters</a>[] =
00174 {
00175   {
00176     {
00177       <span class="stringliteral">"ColorCorrection"</span>, <a class="code" href="group__intl__internal.html#ga6">N_</a>(<span class="stringliteral">"Color Correction"</span>), <a class="code" href="group__intl__internal.html#ga6">N_</a>(<span class="stringliteral">"Basic Image Adjustment"</span>),
00178       <a class="code" href="group__intl__internal.html#ga6">N_</a>(<span class="stringliteral">"Color correction to be applied"</span>),
00179       <a class="code" href="group__vars.html#gga132a7">STP_PARAMETER_TYPE_STRING_LIST</a>, <a class="code" href="group__vars.html#gga133a18">STP_PARAMETER_CLASS_OUTPUT</a>,
00180       <a class="code" href="group__vars.html#gga134a22">STP_PARAMETER_LEVEL_ADVANCED</a>, 1, 1, -1, 1, 0
00181     }, 0.0, 0.0, 0.0, <a class="code" href="color-conversion_8h.html#a24">CMASK_EVERY</a>, 0
00182   },
00183   {
00184     {
00185       <span class="stringliteral">"ChannelBitDepth"</span>, <a class="code" href="group__intl__internal.html#ga6">N_</a>(<span class="stringliteral">"Channel Bit Depth"</span>), <a class="code" href="group__intl__internal.html#ga6">N_</a>(<span class="stringliteral">"Core Parameter"</span>),
00186       <a class="code" href="group__intl__internal.html#ga6">N_</a>(<span class="stringliteral">"Bit depth per channel"</span>),
00187       <a class="code" href="group__vars.html#gga132a7">STP_PARAMETER_TYPE_STRING_LIST</a>, <a class="code" href="group__vars.html#gga133a19">STP_PARAMETER_CLASS_CORE</a>,
00188       <a class="code" href="group__vars.html#gga134a21">STP_PARAMETER_LEVEL_BASIC</a>, 1, 1, -1, 1, 0
00189     }, 0.0, 0.0, 0.0, <a class="code" href="color-conversion_8h.html#a24">CMASK_EVERY</a>, 0
00190   },
00191   {
00192     {
00193       <span class="stringliteral">"InputImageType"</span>, <a class="code" href="group__intl__internal.html#ga6">N_</a>(<span class="stringliteral">"Input Image Type"</span>), <a class="code" href="group__intl__internal.html#ga6">N_</a>(<span class="stringliteral">"Core Parameter"</span>),
00194       <a class="code" href="group__intl__internal.html#ga6">N_</a>(<span class="stringliteral">"Input image type"</span>),
00195       <a class="code" href="group__vars.html#gga132a7">STP_PARAMETER_TYPE_STRING_LIST</a>, <a class="code" href="group__vars.html#gga133a19">STP_PARAMETER_CLASS_CORE</a>,
00196       <a class="code" href="group__vars.html#gga134a21">STP_PARAMETER_LEVEL_BASIC</a>, 1, 1, -1, 1, 0
00197     }, 0.0, 0.0, 0.0, <a class="code" href="color-conversion_8h.html#a24">CMASK_EVERY</a>, 0
00198   },
00199   {
00200     {
00201       <span class="stringliteral">"STPIOutputType"</span>, <a class="code" href="group__intl__internal.html#ga6">N_</a>(<span class="stringliteral">"Output Image Type"</span>), <a class="code" href="group__intl__internal.html#ga6">N_</a>(<span class="stringliteral">"Core Parameter"</span>),
00202       <a class="code" href="group__intl__internal.html#ga6">N_</a>(<span class="stringliteral">"Output image type"</span>),
00203       <a class="code" href="group__vars.html#gga132a7">STP_PARAMETER_TYPE_STRING_LIST</a>, <a class="code" href="group__vars.html#gga133a19">STP_PARAMETER_CLASS_CORE</a>,
00204       <a class="code" href="group__vars.html#gga134a27">STP_PARAMETER_LEVEL_INTERNAL</a>, 1, 1, -1, 1, 0
00205     }, 0.0, 0.0, 0.0, <a class="code" href="color-conversion_8h.html#a24">CMASK_EVERY</a>, 0
00206   },
00207   {
00208     {
00209       <span class="stringliteral">"STPIRawChannels"</span>, <a class="code" href="group__intl__internal.html#ga6">N_</a>(<span class="stringliteral">"Raw Channels"</span>), <a class="code" href="group__intl__internal.html#ga6">N_</a>(<span class="stringliteral">"Core Parameter"</span>),
00210       <a class="code" href="group__intl__internal.html#ga6">N_</a>(<span class="stringliteral">"Raw Channels"</span>),
00211       <a class="code" href="group__vars.html#gga132a8">STP_PARAMETER_TYPE_INT</a>, <a class="code" href="group__vars.html#gga133a19">STP_PARAMETER_CLASS_CORE</a>,
00212       <a class="code" href="group__vars.html#gga134a27">STP_PARAMETER_LEVEL_INTERNAL</a>, 1, 1, -1, 1, 0
00213     }, 1.0, <a class="code" href="group__image.html#ga8">STP_CHANNEL_LIMIT</a>, 1.0, <a class="code" href="color-conversion_8h.html#a24">CMASK_EVERY</a>, 0
00214   },
00215   {
00216     {
00217       <span class="stringliteral">"Brightness"</span>, <a class="code" href="group__intl__internal.html#ga6">N_</a>(<span class="stringliteral">"Brightness"</span>), <a class="code" href="group__intl__internal.html#ga6">N_</a>(<span class="stringliteral">"Basic Image Adjustment"</span>),
00218       <a class="code" href="group__intl__internal.html#ga6">N_</a>(<span class="stringliteral">"Brightness of the print"</span>),
00219       <a class="code" href="group__vars.html#gga132a10">STP_PARAMETER_TYPE_DOUBLE</a>, <a class="code" href="group__vars.html#gga133a18">STP_PARAMETER_CLASS_OUTPUT</a>,
00220       <a class="code" href="group__vars.html#gga134a21">STP_PARAMETER_LEVEL_BASIC</a>, 1, 1, -1, 1, 0
00221     }, 0.0, 2.0, 1.0, <a class="code" href="color-conversion_8h.html#a23">CMASK_ALL</a>, 0
00222   },
00223   {
00224     {
00225       <span class="stringliteral">"Contrast"</span>, <a class="code" href="group__intl__internal.html#ga6">N_</a>(<span class="stringliteral">"Contrast"</span>), <a class="code" href="group__intl__internal.html#ga6">N_</a>(<span class="stringliteral">"Basic Image Adjustment"</span>),
00226       <a class="code" href="group__intl__internal.html#ga6">N_</a>(<span class="stringliteral">"Contrast of the print (0 is solid gray)"</span>),
00227       <a class="code" href="group__vars.html#gga132a10">STP_PARAMETER_TYPE_DOUBLE</a>, <a class="code" href="group__vars.html#gga133a18">STP_PARAMETER_CLASS_OUTPUT</a>,
00228       <a class="code" href="group__vars.html#gga134a21">STP_PARAMETER_LEVEL_BASIC</a>, 1, 1, -1, 1, 0
00229     }, 0.0, 4.0, 1.0, <a class="code" href="color-conversion_8h.html#a23">CMASK_ALL</a>, 0
00230   },
00231   {
00232     {
00233       <span class="stringliteral">"LinearContrast"</span>, <a class="code" href="group__intl__internal.html#ga6">N_</a>(<span class="stringliteral">"Linear Contrast Adjustment"</span>), <a class="code" href="group__intl__internal.html#ga6">N_</a>(<span class="stringliteral">"Advanced Image Control"</span>),
00234       <a class="code" href="group__intl__internal.html#ga6">N_</a>(<span class="stringliteral">"Use linear vs. fixed end point contrast adjustment"</span>),
00235       <a class="code" href="group__vars.html#gga132a9">STP_PARAMETER_TYPE_BOOLEAN</a>, <a class="code" href="group__vars.html#gga133a18">STP_PARAMETER_CLASS_OUTPUT</a>,
00236       <a class="code" href="group__vars.html#gga134a25">STP_PARAMETER_LEVEL_ADVANCED3</a>, 1, 1, -1, 1, 0
00237     }, 0.0, 0.0, 0.0, <a class="code" href="color-conversion_8h.html#a23">CMASK_ALL</a>, 0
00238   },
00239   {
00240     {
00241       <span class="stringliteral">"Gamma"</span>, <a class="code" href="group__intl__internal.html#ga6">N_</a>(<span class="stringliteral">"Composite Gamma"</span>), <a class="code" href="group__intl__internal.html#ga6">N_</a>(<span class="stringliteral">"Gamma"</span>),
00242       <a class="code" href="group__intl__internal.html#ga6">N_</a>(<span class="stringliteral">"Adjust the gamma of the print. Larger values will "</span>
00243          <span class="stringliteral">"produce a generally brighter print, while smaller "</span>
00244          <span class="stringliteral">"values will produce a generally darker print. "</span>),
00245       <a class="code" href="group__vars.html#gga132a10">STP_PARAMETER_TYPE_DOUBLE</a>, <a class="code" href="group__vars.html#gga133a18">STP_PARAMETER_CLASS_OUTPUT</a>,
00246       <a class="code" href="group__vars.html#gga134a23">STP_PARAMETER_LEVEL_ADVANCED1</a>, 0, 1, -1, 1, 0
00247     }, 0.1, 4.0, 1.0, <a class="code" href="color-conversion_8h.html#a24">CMASK_EVERY</a>, 0
00248   },
00249   {
00250     {
00251       <span class="stringliteral">"AppGamma"</span>, <a class="code" href="group__intl__internal.html#ga6">N_</a>(<span class="stringliteral">"AppGamma"</span>), <a class="code" href="group__intl__internal.html#ga6">N_</a>(<span class="stringliteral">"Gamma"</span>),
00252       <a class="code" href="group__intl__internal.html#ga6">N_</a>(<span class="stringliteral">"Gamma value assumed by application"</span>),
00253       <a class="code" href="group__vars.html#gga132a10">STP_PARAMETER_TYPE_DOUBLE</a>, <a class="code" href="group__vars.html#gga133a18">STP_PARAMETER_CLASS_OUTPUT</a>,
00254       <a class="code" href="group__vars.html#gga134a27">STP_PARAMETER_LEVEL_INTERNAL</a>, 0, 1, -1, 1, 0
00255     }, 0.1, 4.0, 1.0, <a class="code" href="color-conversion_8h.html#a24">CMASK_EVERY</a>, 0
00256   },
00257   {
00258     {
00259       <span class="stringliteral">"CyanGamma"</span>, <a class="code" href="group__intl__internal.html#ga6">N_</a>(<span class="stringliteral">"Cyan"</span>), <a class="code" href="group__intl__internal.html#ga6">N_</a>(<span class="stringliteral">"Gamma"</span>),
00260       <a class="code" href="group__intl__internal.html#ga6">N_</a>(<span class="stringliteral">"Adjust the cyan gamma"</span>),
00261       <a class="code" href="group__vars.html#gga132a10">STP_PARAMETER_TYPE_DOUBLE</a>, <a class="code" href="group__vars.html#gga133a18">STP_PARAMETER_CLASS_OUTPUT</a>,
00262       <a class="code" href="group__vars.html#gga134a23">STP_PARAMETER_LEVEL_ADVANCED1</a>, 0, 1, 1, 1, 0
00263     }, 0.0, 4.0, 1.0, <a class="code" href="color-conversion_8h.html#a10">CMASK_C</a>, 1
00264   },
00265   {
00266     {
00267       <span class="stringliteral">"MagentaGamma"</span>, <a class="code" href="group__intl__internal.html#ga6">N_</a>(<span class="stringliteral">"Magenta"</span>), <a class="code" href="group__intl__internal.html#ga6">N_</a>(<span class="stringliteral">"Gamma"</span>),
00268       <a class="code" href="group__intl__internal.html#ga6">N_</a>(<span class="stringliteral">"Adjust the magenta gamma"</span>),
00269       <a class="code" href="group__vars.html#gga132a10">STP_PARAMETER_TYPE_DOUBLE</a>, <a class="code" href="group__vars.html#gga133a18">STP_PARAMETER_CLASS_OUTPUT</a>,
00270       <a class="code" href="group__vars.html#gga134a23">STP_PARAMETER_LEVEL_ADVANCED1</a>, 0, 1, 2, 1, 0
00271     }, 0.0, 4.0, 1.0, <a class="code" href="color-conversion_8h.html#a11">CMASK_M</a>, 1
00272   },
00273   {
00274     {
00275       <span class="stringliteral">"YellowGamma"</span>, <a class="code" href="group__intl__internal.html#ga6">N_</a>(<span class="stringliteral">"Yellow"</span>), <a class="code" href="group__intl__internal.html#ga6">N_</a>(<span class="stringliteral">"Gamma"</span>),
00276       <a class="code" href="group__intl__internal.html#ga6">N_</a>(<span class="stringliteral">"Adjust the yellow gamma"</span>),
00277       <a class="code" href="group__vars.html#gga132a10">STP_PARAMETER_TYPE_DOUBLE</a>, <a class="code" href="group__vars.html#gga133a18">STP_PARAMETER_CLASS_OUTPUT</a>,
00278       <a class="code" href="group__vars.html#gga134a23">STP_PARAMETER_LEVEL_ADVANCED1</a>, 0, 1, 3, 1, 0
00279     }, 0.0, 4.0, 1.0, <a class="code" href="color-conversion_8h.html#a12">CMASK_Y</a>, 1
00280   },
00281   {
00282     {
00283       <span class="stringliteral">"RedGamma"</span>, <a class="code" href="group__intl__internal.html#ga6">N_</a>(<span class="stringliteral">"Red"</span>), <a class="code" href="group__intl__internal.html#ga6">N_</a>(<span class="stringliteral">"Gamma"</span>),
00284       <a class="code" href="group__intl__internal.html#ga6">N_</a>(<span class="stringliteral">"Adjust the red gamma"</span>),
00285       <a class="code" href="group__vars.html#gga132a10">STP_PARAMETER_TYPE_DOUBLE</a>, <a class="code" href="group__vars.html#gga133a18">STP_PARAMETER_CLASS_OUTPUT</a>,
00286       <a class="code" href="group__vars.html#gga134a23">STP_PARAMETER_LEVEL_ADVANCED1</a>, 0, 1, 1, 1, 0
00287     }, 0.0, 4.0, 1.0, <a class="code" href="color-conversion_8h.html#a14">CMASK_R</a>, 1
00288   },
00289   {
00290     {
00291       <span class="stringliteral">"GreenGamma"</span>, <a class="code" href="group__intl__internal.html#ga6">N_</a>(<span class="stringliteral">"Green"</span>), <a class="code" href="group__intl__internal.html#ga6">N_</a>(<span class="stringliteral">"Gamma"</span>),
00292       <a class="code" href="group__intl__internal.html#ga6">N_</a>(<span class="stringliteral">"Adjust the green gamma"</span>),
00293       <a class="code" href="group__vars.html#gga132a10">STP_PARAMETER_TYPE_DOUBLE</a>, <a class="code" href="group__vars.html#gga133a18">STP_PARAMETER_CLASS_OUTPUT</a>,
00294       <a class="code" href="group__vars.html#gga134a23">STP_PARAMETER_LEVEL_ADVANCED1</a>, 0, 1, 2, 1, 0
00295     }, 0.0, 4.0, 1.0, <a class="code" href="color-conversion_8h.html#a15">CMASK_G</a>, 1
00296   },
00297   {
00298     {
00299       <span class="stringliteral">"BlueGamma"</span>, <a class="code" href="group__intl__internal.html#ga6">N_</a>(<span class="stringliteral">"Blue"</span>), <a class="code" href="group__intl__internal.html#ga6">N_</a>(<span class="stringliteral">"Gamma"</span>),
00300       <a class="code" href="group__intl__internal.html#ga6">N_</a>(<span class="stringliteral">"Adjust the blue gamma"</span>),
00301       <a class="code" href="group__vars.html#gga132a10">STP_PARAMETER_TYPE_DOUBLE</a>, <a class="code" href="group__vars.html#gga133a18">STP_PARAMETER_CLASS_OUTPUT</a>,
00302       <a class="code" href="group__vars.html#gga134a23">STP_PARAMETER_LEVEL_ADVANCED1</a>, 0, 1, 3, 1, 0
00303     }, 0.0, 4.0, 1.0, <a class="code" href="color-conversion_8h.html#a16">CMASK_B</a>, 1
00304   },
00305   {
00306     {
00307       <span class="stringliteral">"Saturation"</span>, <a class="code" href="group__intl__internal.html#ga6">N_</a>(<span class="stringliteral">"Saturation"</span>), <a class="code" href="group__intl__internal.html#ga6">N_</a>(<span class="stringliteral">"Basic Image Adjustment"</span>),
00308       <a class="code" href="group__intl__internal.html#ga6">N_</a>(<span class="stringliteral">"Adjust the saturation (color balance) of the print\n"</span>
00309          <span class="stringliteral">"Use zero saturation to produce grayscale output "</span>
00310          <span class="stringliteral">"using color and black inks"</span>),
00311       <a class="code" href="group__vars.html#gga132a10">STP_PARAMETER_TYPE_DOUBLE</a>, <a class="code" href="group__vars.html#gga133a18">STP_PARAMETER_CLASS_OUTPUT</a>,
00312       <a class="code" href="group__vars.html#gga134a21">STP_PARAMETER_LEVEL_BASIC</a>, 1, 1, -1, 1, 0
00313     }, 0.0, 9.0, 1.0, <a class="code" href="color-conversion_8h.html#a20">CMASK_CMY</a> | <a class="code" href="color-conversion_8h.html#a19">CMASK_RGB</a>, 1
00314   },
00315   <span class="comment">/* Need to think this through a bit more -- rlk 20030712 */</span>
00316   {
00317     {
00318       <span class="stringliteral">"InkLimit"</span>, <a class="code" href="group__intl__internal.html#ga6">N_</a>(<span class="stringliteral">"Ink Limit"</span>), <a class="code" href="group__intl__internal.html#ga6">N_</a>(<span class="stringliteral">"Advanced Output Control"</span>),
00319       <a class="code" href="group__intl__internal.html#ga6">N_</a>(<span class="stringliteral">"Limit the total ink printed to the page"</span>),
00320       <a class="code" href="group__vars.html#gga132a10">STP_PARAMETER_TYPE_DOUBLE</a>, <a class="code" href="group__vars.html#gga133a18">STP_PARAMETER_CLASS_OUTPUT</a>,
00321       <a class="code" href="group__vars.html#gga134a26">STP_PARAMETER_LEVEL_ADVANCED4</a>, 0, 1, -1, 0, 0
00322     }, 0.0, <a class="code" href="group__image.html#ga8">STP_CHANNEL_LIMIT</a>, <a class="code" href="group__image.html#ga8">STP_CHANNEL_LIMIT</a>, <a class="code" href="color-conversion_8h.html#a20">CMASK_CMY</a>, 0
00323   },
00324   {
00325     {
00326       <span class="stringliteral">"BlackGamma"</span>, <a class="code" href="group__intl__internal.html#ga6">N_</a>(<span class="stringliteral">"GCR Transition"</span>), <a class="code" href="group__intl__internal.html#ga6">N_</a>(<span class="stringliteral">"Advanced Output Control"</span>),
00327       <a class="code" href="group__intl__internal.html#ga6">N_</a>(<span class="stringliteral">"Adjust the gray component transition rate"</span>),
00328       <a class="code" href="group__vars.html#gga132a10">STP_PARAMETER_TYPE_DOUBLE</a>, <a class="code" href="group__vars.html#gga133a18">STP_PARAMETER_CLASS_OUTPUT</a>,
00329       <a class="code" href="group__vars.html#gga134a26">STP_PARAMETER_LEVEL_ADVANCED4</a>, 0, 1, 0, 1, 0
00330     }, 0.0, 1.0, 1.0, <a class="code" href="color-conversion_8h.html#a9">CMASK_K</a>, 1
00331   },
00332   {
00333     {
00334       <span class="stringliteral">"GCRLower"</span>, <a class="code" href="group__intl__internal.html#ga6">N_</a>(<span class="stringliteral">"GCR Lower Bound"</span>), <a class="code" href="group__intl__internal.html#ga6">N_</a>(<span class="stringliteral">"Advanced Output Control"</span>),
00335       <a class="code" href="group__intl__internal.html#ga6">N_</a>(<span class="stringliteral">"Lower bound of gray component reduction"</span>),
00336       <a class="code" href="group__vars.html#gga132a10">STP_PARAMETER_TYPE_DOUBLE</a>, <a class="code" href="group__vars.html#gga133a18">STP_PARAMETER_CLASS_OUTPUT</a>,
00337       <a class="code" href="group__vars.html#gga134a26">STP_PARAMETER_LEVEL_ADVANCED4</a>, 0, 1, 0, 1, 0
00338     }, 0.0, 1.0, 0.2, <a class="code" href="color-conversion_8h.html#a9">CMASK_K</a>, 1
00339   },
00340   {
00341     {
00342       <span class="stringliteral">"GCRUpper"</span>, <a class="code" href="group__intl__internal.html#ga6">N_</a>(<span class="stringliteral">"GCR Upper Bound"</span>), <a class="code" href="group__intl__internal.html#ga6">N_</a>(<span class="stringliteral">"Advanced Output Control"</span>),
00343       <a class="code" href="group__intl__internal.html#ga6">N_</a>(<span class="stringliteral">"Upper bound of gray component reduction"</span>),
00344       <a class="code" href="group__vars.html#gga132a10">STP_PARAMETER_TYPE_DOUBLE</a>, <a class="code" href="group__vars.html#gga133a18">STP_PARAMETER_CLASS_OUTPUT</a>,
00345       <a class="code" href="group__vars.html#gga134a26">STP_PARAMETER_LEVEL_ADVANCED4</a>, 0, 1, 0, 1, 0
00346     }, 0.0, 5.0, 0.5, <a class="code" href="color-conversion_8h.html#a9">CMASK_K</a>, 1
00347   },
00348   <a class="code" href="print-color_8c.html#a0">RAW_GAMMA_CHANNEL</a>(0),
00349   <a class="code" href="print-color_8c.html#a0">RAW_GAMMA_CHANNEL</a>(1),
00350   <a class="code" href="print-color_8c.html#a0">RAW_GAMMA_CHANNEL</a>(2),
00351   <a class="code" href="print-color_8c.html#a0">RAW_GAMMA_CHANNEL</a>(3),
00352   <a class="code" href="print-color_8c.html#a0">RAW_GAMMA_CHANNEL</a>(4),
00353   <a class="code" href="print-color_8c.html#a0">RAW_GAMMA_CHANNEL</a>(5),
00354   <a class="code" href="print-color_8c.html#a0">RAW_GAMMA_CHANNEL</a>(6),
00355   <a class="code" href="print-color_8c.html#a0">RAW_GAMMA_CHANNEL</a>(7),
00356   <a class="code" href="print-color_8c.html#a0">RAW_GAMMA_CHANNEL</a>(8),
00357   <a class="code" href="print-color_8c.html#a0">RAW_GAMMA_CHANNEL</a>(9),
00358   <a class="code" href="print-color_8c.html#a0">RAW_GAMMA_CHANNEL</a>(10),
00359   <a class="code" href="print-color_8c.html#a0">RAW_GAMMA_CHANNEL</a>(11),
00360   <a class="code" href="print-color_8c.html#a0">RAW_GAMMA_CHANNEL</a>(12),
00361   <a class="code" href="print-color_8c.html#a0">RAW_GAMMA_CHANNEL</a>(13),
00362   <a class="code" href="print-color_8c.html#a0">RAW_GAMMA_CHANNEL</a>(14),
00363   <a class="code" href="print-color_8c.html#a0">RAW_GAMMA_CHANNEL</a>(15),
00364   <a class="code" href="print-color_8c.html#a0">RAW_GAMMA_CHANNEL</a>(16),
00365   <a class="code" href="print-color_8c.html#a0">RAW_GAMMA_CHANNEL</a>(17),
00366   <a class="code" href="print-color_8c.html#a0">RAW_GAMMA_CHANNEL</a>(18),
00367   <a class="code" href="print-color_8c.html#a0">RAW_GAMMA_CHANNEL</a>(19),
00368   <a class="code" href="print-color_8c.html#a0">RAW_GAMMA_CHANNEL</a>(20),
00369   <a class="code" href="print-color_8c.html#a0">RAW_GAMMA_CHANNEL</a>(21),
00370   <a class="code" href="print-color_8c.html#a0">RAW_GAMMA_CHANNEL</a>(22),
00371   <a class="code" href="print-color_8c.html#a0">RAW_GAMMA_CHANNEL</a>(23),
00372   <a class="code" href="print-color_8c.html#a0">RAW_GAMMA_CHANNEL</a>(24),
00373   <a class="code" href="print-color_8c.html#a0">RAW_GAMMA_CHANNEL</a>(25),
00374   <a class="code" href="print-color_8c.html#a0">RAW_GAMMA_CHANNEL</a>(26),
00375   <a class="code" href="print-color_8c.html#a0">RAW_GAMMA_CHANNEL</a>(27),
00376   <a class="code" href="print-color_8c.html#a0">RAW_GAMMA_CHANNEL</a>(28),
00377   <a class="code" href="print-color_8c.html#a0">RAW_GAMMA_CHANNEL</a>(29),
00378   <a class="code" href="print-color_8c.html#a0">RAW_GAMMA_CHANNEL</a>(30),
00379   <a class="code" href="print-color_8c.html#a0">RAW_GAMMA_CHANNEL</a>(31),
00380 };
00381 
<a name="l00382"></a><a class="code" href="print-color_8c.html#a15">00382</a> <span class="keyword">static</span> <span class="keyword">const</span> <span class="keywordtype">int</span> <a class="code" href="print-color_8c.html#a15">float_parameter_count</a> =
00383 <span class="keyword">sizeof</span>(<a class="code" href="print-color_8c.html#a14">float_parameters</a>) / <span class="keyword">sizeof</span>(<a class="code" href="structfloat__param__t.html">float_param_t</a>);
00384 
<a name="l00385"></a><a class="code" href="structcurve__param__t.html">00385</a> <span class="keyword">typedef</span> <span class="keyword">struct</span>
00386 <span class="keyword"></span>{
<a name="l00387"></a><a class="code" href="structcurve__param__t.html#o0">00387</a>   <a class="code" href="structstp__parameter__t.html">stp_parameter_t</a> param;
<a name="l00388"></a><a class="code" href="structcurve__param__t.html#o1">00388</a>   <a class="code" href="structstp__curve.html">stp_curve_t</a> **defval;
<a name="l00389"></a><a class="code" href="structcurve__param__t.html#o2">00389</a>   <span class="keywordtype">unsigned</span> channel_mask;
<a name="l00390"></a><a class="code" href="structcurve__param__t.html#o3">00390</a>   <span class="keywordtype">int</span> hsl_only;
<a name="l00391"></a><a class="code" href="structcurve__param__t.html#o4">00391</a>   <span class="keywordtype">int</span> color_only;
00392 } <a class="code" href="structcurve__param__t.html">curve_param_t</a>;
00393 
<a name="l00394"></a><a class="code" href="print-color_8c.html#a16">00394</a> <span class="keyword">static</span> <span class="keywordtype">int</span> <a class="code" href="print-color_8c.html#a16">standard_curves_initialized</a> = 0;
00395 
<a name="l00396"></a><a class="code" href="print-color_8c.html#a17">00396</a> <span class="keyword">static</span> <a class="code" href="structstp__curve.html">stp_curve_t</a> *<a class="code" href="print-color_8c.html#a17">hue_map_bounds</a> = NULL;
<a name="l00397"></a><a class="code" href="print-color_8c.html#a18">00397</a> <span class="keyword">static</span> <a class="code" href="structstp__curve.html">stp_curve_t</a> *<a class="code" href="print-color_8c.html#a18">lum_map_bounds</a> = NULL;
<a name="l00398"></a><a class="code" href="print-color_8c.html#a19">00398</a> <span class="keyword">static</span> <a class="code" href="structstp__curve.html">stp_curve_t</a> *<a class="code" href="print-color_8c.html#a19">sat_map_bounds</a> = NULL;
<a name="l00399"></a><a class="code" href="print-color_8c.html#a20">00399</a> <span class="keyword">static</span> <a class="code" href="structstp__curve.html">stp_curve_t</a> *<a class="code" href="print-color_8c.html#a20">color_curve_bounds</a> = NULL;
<a name="l00400"></a><a class="code" href="print-color_8c.html#a21">00400</a> <span class="keyword">static</span> <a class="code" href="structstp__curve.html">stp_curve_t</a> *<a class="code" href="print-color_8c.html#a21">gcr_curve_bounds</a> = NULL;
00401 
00402 
<a name="l00403"></a><a class="code" href="print-color_8c.html#a1">00403</a> <span class="preprocessor">#define RAW_CURVE_CHANNEL(channel)                                      \</span>
00404 <span class="preprocessor">  {                                                                     \</span>
00405 <span class="preprocessor">    {                                                                   \</span>
00406 <span class="preprocessor">      "CurveCh" #channel, N_("Channel " #channel " Curve"),             \</span>
00407 <span class="preprocessor">      N_("Output Curves"), N_("Curve for raw channel " #channel),       \</span>
00408 <span class="preprocessor">      STP_PARAMETER_TYPE_CURVE, STP_PARAMETER_CLASS_OUTPUT,             \</span>
00409 <span class="preprocessor">      STP_PARAMETER_LEVEL_INTERNAL, 0, 1, channel, 1, 0                 \</span>
00410 <span class="preprocessor">    }, &amp;color_curve_bounds, CMASK_RAW, 0, 0                             \</span>
00411 <span class="preprocessor">  }</span>
00412 <span class="preprocessor"></span>
<a name="l00413"></a><a class="code" href="print-color_8c.html#a22">00413</a> <span class="keyword">static</span> <a class="code" href="structcurve__param__t.html">curve_param_t</a> <a class="code" href="print-color_8c.html#a22">curve_parameters</a>[] =
00414 {
00415   {
00416     {
00417       <span class="stringliteral">"CyanCurve"</span>, <a class="code" href="group__intl__internal.html#ga6">N_</a>(<span class="stringliteral">"Cyan Curve"</span>), <a class="code" href="group__intl__internal.html#ga6">N_</a>(<span class="stringliteral">"Output Curves"</span>),
00418       <a class="code" href="group__intl__internal.html#ga6">N_</a>(<span class="stringliteral">"Cyan curve"</span>),
00419       <a class="code" href="group__vars.html#gga132a11">STP_PARAMETER_TYPE_CURVE</a>, <a class="code" href="group__vars.html#gga133a18">STP_PARAMETER_CLASS_OUTPUT</a>,
00420       <a class="code" href="group__vars.html#gga134a24">STP_PARAMETER_LEVEL_ADVANCED2</a>, 0, 1, 1, 1, 0
00421     }, &amp;<a class="code" href="print-color_8c.html#a20">color_curve_bounds</a>, <a class="code" href="color-conversion_8h.html#a10">CMASK_C</a>, 0, 1
00422   },
00423   {
00424     {
00425       <span class="stringliteral">"MagentaCurve"</span>, <a class="code" href="group__intl__internal.html#ga6">N_</a>(<span class="stringliteral">"Magenta Curve"</span>), <a class="code" href="group__intl__internal.html#ga6">N_</a>(<span class="stringliteral">"Output Curves"</span>),
00426       <a class="code" href="group__intl__internal.html#ga6">N_</a>(<span class="stringliteral">"Magenta curve"</span>),
00427       <a class="code" href="group__vars.html#gga132a11">STP_PARAMETER_TYPE_CURVE</a>, <a class="code" href="group__vars.html#gga133a18">STP_PARAMETER_CLASS_OUTPUT</a>,
00428       <a class="code" href="group__vars.html#gga134a24">STP_PARAMETER_LEVEL_ADVANCED2</a>, 0, 1, 2, 1, 0
00429     }, &amp;<a class="code" href="print-color_8c.html#a20">color_curve_bounds</a>, <a class="code" href="color-conversion_8h.html#a11">CMASK_M</a>, 0, 1
00430   },
00431   {
00432     {
00433       <span class="stringliteral">"YellowCurve"</span>, <a class="code" href="group__intl__internal.html#ga6">N_</a>(<span class="stringliteral">"Yellow Curve"</span>), <a class="code" href="group__intl__internal.html#ga6">N_</a>(<span class="stringliteral">"Output Curves"</span>),
00434       <a class="code" href="group__intl__internal.html#ga6">N_</a>(<span class="stringliteral">"Yellow curve"</span>),
00435       <a class="code" href="group__vars.html#gga132a11">STP_PARAMETER_TYPE_CURVE</a>, <a class="code" href="group__vars.html#gga133a18">STP_PARAMETER_CLASS_OUTPUT</a>,
00436       <a class="code" href="group__vars.html#gga134a24">STP_PARAMETER_LEVEL_ADVANCED2</a>, 0, 1, 3, 1, 0
00437     }, &amp;<a class="code" href="print-color_8c.html#a20">color_curve_bounds</a>, <a class="code" href="color-conversion_8h.html#a12">CMASK_Y</a>, 0, 1
00438   },
00439   {
00440     {
00441       <span class="stringliteral">"BlackCurve"</span>, <a class="code" href="group__intl__internal.html#ga6">N_</a>(<span class="stringliteral">"Black Curve"</span>), <a class="code" href="group__intl__internal.html#ga6">N_</a>(<span class="stringliteral">"Output Curves"</span>),
00442       <a class="code" href="group__intl__internal.html#ga6">N_</a>(<span class="stringliteral">"Black curve"</span>),
00443       <a class="code" href="group__vars.html#gga132a11">STP_PARAMETER_TYPE_CURVE</a>, <a class="code" href="group__vars.html#gga133a18">STP_PARAMETER_CLASS_OUTPUT</a>,
00444       <a class="code" href="group__vars.html#gga134a24">STP_PARAMETER_LEVEL_ADVANCED2</a>, 0, 1, 0, 1, 0
00445     }, &amp;<a class="code" href="print-color_8c.html#a20">color_curve_bounds</a>, <a class="code" href="color-conversion_8h.html#a9">CMASK_K</a>, 0, 0
00446   },
00447   {
00448     {
00449       <span class="stringliteral">"RedCurve"</span>, <a class="code" href="group__intl__internal.html#ga6">N_</a>(<span class="stringliteral">"Red Curve"</span>), <a class="code" href="group__intl__internal.html#ga6">N_</a>(<span class="stringliteral">"Output Curves"</span>),
00450       <a class="code" href="group__intl__internal.html#ga6">N_</a>(<span class="stringliteral">"Red curve"</span>),
00451       <a class="code" href="group__vars.html#gga132a11">STP_PARAMETER_TYPE_CURVE</a>, <a class="code" href="group__vars.html#gga133a18">STP_PARAMETER_CLASS_OUTPUT</a>,
00452       <a class="code" href="group__vars.html#gga134a24">STP_PARAMETER_LEVEL_ADVANCED2</a>, 0, 1, 1, 1, 0
00453     }, &amp;<a class="code" href="print-color_8c.html#a20">color_curve_bounds</a>, <a class="code" href="color-conversion_8h.html#a14">CMASK_R</a>, 0, 1
00454   },
00455   {
00456     {
00457       <span class="stringliteral">"GreenCurve"</span>, <a class="code" href="group__intl__internal.html#ga6">N_</a>(<span class="stringliteral">"Green Curve"</span>), <a class="code" href="group__intl__internal.html#ga6">N_</a>(<span class="stringliteral">"Output Curves"</span>),
00458       <a class="code" href="group__intl__internal.html#ga6">N_</a>(<span class="stringliteral">"Green curve"</span>),
00459       <a class="code" href="group__vars.html#gga132a11">STP_PARAMETER_TYPE_CURVE</a>, <a class="code" href="group__vars.html#gga133a18">STP_PARAMETER_CLASS_OUTPUT</a>,
00460       <a class="code" href="group__vars.html#gga134a24">STP_PARAMETER_LEVEL_ADVANCED2</a>, 0, 1, 1, 1, 0
00461     }, &amp;<a class="code" href="print-color_8c.html#a20">color_curve_bounds</a>, <a class="code" href="color-conversion_8h.html#a15">CMASK_G</a>, 0, 1
00462   },
00463   {
00464     {
00465       <span class="stringliteral">"BlueCurve"</span>, <a class="code" href="group__intl__internal.html#ga6">N_</a>(<span class="stringliteral">"Blue Curve"</span>), <a class="code" href="group__intl__internal.html#ga6">N_</a>(<span class="stringliteral">"Output Curves"</span>),
00466       <a class="code" href="group__intl__internal.html#ga6">N_</a>(<span class="stringliteral">"Blue curve"</span>),
00467       <a class="code" href="group__vars.html#gga132a11">STP_PARAMETER_TYPE_CURVE</a>, <a class="code" href="group__vars.html#gga133a18">STP_PARAMETER_CLASS_OUTPUT</a>,
00468       <a class="code" href="group__vars.html#gga134a24">STP_PARAMETER_LEVEL_ADVANCED2</a>, 0, 1, 1, 1, 0
00469     }, &amp;<a class="code" href="print-color_8c.html#a20">color_curve_bounds</a>, <a class="code" href="color-conversion_8h.html#a16">CMASK_B</a>, 0, 1
00470   },
00471   {
00472     {
00473       <span class="stringliteral">"WhiteCurve"</span>, <a class="code" href="group__intl__internal.html#ga6">N_</a>(<span class="stringliteral">"White Curve"</span>), <a class="code" href="group__intl__internal.html#ga6">N_</a>(<span class="stringliteral">"Output Curves"</span>),
00474       <a class="code" href="group__intl__internal.html#ga6">N_</a>(<span class="stringliteral">"White curve"</span>),
00475       <a class="code" href="group__vars.html#gga132a11">STP_PARAMETER_TYPE_CURVE</a>, <a class="code" href="group__vars.html#gga133a18">STP_PARAMETER_CLASS_OUTPUT</a>,
00476       <a class="code" href="group__vars.html#gga134a24">STP_PARAMETER_LEVEL_ADVANCED2</a>, 0, 1, 1, 1, 0
00477     }, &amp;<a class="code" href="print-color_8c.html#a20">color_curve_bounds</a>, <a class="code" href="color-conversion_8h.html#a13">CMASK_W</a>, 0, 0
00478   },
00479   {
00480     {
00481       <span class="stringliteral">"HueMap"</span>, <a class="code" href="group__intl__internal.html#ga6">N_</a>(<span class="stringliteral">"Hue Map"</span>), <a class="code" href="group__intl__internal.html#ga6">N_</a>(<span class="stringliteral">"Advanced HSL Curves"</span>),
00482       <a class="code" href="group__intl__internal.html#ga6">N_</a>(<span class="stringliteral">"Hue adjustment curve"</span>),
00483       <a class="code" href="group__vars.html#gga132a11">STP_PARAMETER_TYPE_CURVE</a>, <a class="code" href="group__vars.html#gga133a18">STP_PARAMETER_CLASS_OUTPUT</a>,
00484       <a class="code" href="group__vars.html#gga134a25">STP_PARAMETER_LEVEL_ADVANCED3</a>, 0, 1, -1, 1, 0
00485     }, &amp;<a class="code" href="print-color_8c.html#a17">hue_map_bounds</a>, <a class="code" href="color-conversion_8h.html#a20">CMASK_CMY</a> | <a class="code" href="color-conversion_8h.html#a19">CMASK_RGB</a>, 1, 1
00486   },
00487   {
00488     {
00489       <span class="stringliteral">"SatMap"</span>, <a class="code" href="group__intl__internal.html#ga6">N_</a>(<span class="stringliteral">"Saturation Map"</span>), <a class="code" href="group__intl__internal.html#ga6">N_</a>(<span class="stringliteral">"Advanced HSL Curves"</span>),
00490       <a class="code" href="group__intl__internal.html#ga6">N_</a>(<span class="stringliteral">"Saturation adjustment curve"</span>),
00491       <a class="code" href="group__vars.html#gga132a11">STP_PARAMETER_TYPE_CURVE</a>, <a class="code" href="group__vars.html#gga133a18">STP_PARAMETER_CLASS_OUTPUT</a>,
00492       <a class="code" href="group__vars.html#gga134a25">STP_PARAMETER_LEVEL_ADVANCED3</a>, 0, 1, -1, 1, 0
00493     }, &amp;<a class="code" href="print-color_8c.html#a19">sat_map_bounds</a>, <a class="code" href="color-conversion_8h.html#a20">CMASK_CMY</a> | <a class="code" href="color-conversion_8h.html#a19">CMASK_RGB</a>, 1, 1
00494   },
00495   {
00496     {
00497       <span class="stringliteral">"LumMap"</span>, <a class="code" href="group__intl__internal.html#ga6">N_</a>(<span class="stringliteral">"Luminosity Map"</span>), <a class="code" href="group__intl__internal.html#ga6">N_</a>(<span class="stringliteral">"Advanced HSL Curves"</span>),
00498       <a class="code" href="group__intl__internal.html#ga6">N_</a>(<span class="stringliteral">"Luminosity adjustment curve"</span>),
00499       <a class="code" href="group__vars.html#gga132a11">STP_PARAMETER_TYPE_CURVE</a>, <a class="code" href="group__vars.html#gga133a18">STP_PARAMETER_CLASS_OUTPUT</a>,
00500       <a class="code" href="group__vars.html#gga134a25">STP_PARAMETER_LEVEL_ADVANCED3</a>, 0, 1, -1, 1, 0
00501     }, &amp;<a class="code" href="print-color_8c.html#a18">lum_map_bounds</a>, <a class="code" href="color-conversion_8h.html#a20">CMASK_CMY</a> | <a class="code" href="color-conversion_8h.html#a19">CMASK_RGB</a>, 1, 1
00502   },
00503   {
00504     {
00505       <span class="stringliteral">"GCRCurve"</span>, <a class="code" href="group__intl__internal.html#ga6">N_</a>(<span class="stringliteral">"Gray Component Reduction"</span>), <a class="code" href="group__intl__internal.html#ga6">N_</a>(<span class="stringliteral">"Advanced Output Control"</span>),
00506       <a class="code" href="group__intl__internal.html#ga6">N_</a>(<span class="stringliteral">"Gray component reduction curve"</span>),
00507       <a class="code" href="group__vars.html#gga132a11">STP_PARAMETER_TYPE_CURVE</a>, <a class="code" href="group__vars.html#gga133a18">STP_PARAMETER_CLASS_OUTPUT</a>,
00508       <a class="code" href="group__vars.html#gga134a25">STP_PARAMETER_LEVEL_ADVANCED3</a>, 0, 1, 0, 1, 0
00509     }, &amp;<a class="code" href="print-color_8c.html#a21">gcr_curve_bounds</a>, <a class="code" href="color-conversion_8h.html#a9">CMASK_K</a>, 0, 1
00510   },
00511   <a class="code" href="print-color_8c.html#a1">RAW_CURVE_CHANNEL</a>(0),
00512   <a class="code" href="print-color_8c.html#a1">RAW_CURVE_CHANNEL</a>(1),
00513   <a class="code" href="print-color_8c.html#a1">RAW_CURVE_CHANNEL</a>(2),
00514   <a class="code" href="print-color_8c.html#a1">RAW_CURVE_CHANNEL</a>(3),
00515   <a class="code" href="print-color_8c.html#a1">RAW_CURVE_CHANNEL</a>(4),
00516   <a class="code" href="print-color_8c.html#a1">RAW_CURVE_CHANNEL</a>(5),
00517   <a class="code" href="print-color_8c.html#a1">RAW_CURVE_CHANNEL</a>(6),
00518   <a class="code" href="print-color_8c.html#a1">RAW_CURVE_CHANNEL</a>(7),
00519   <a class="code" href="print-color_8c.html#a1">RAW_CURVE_CHANNEL</a>(8),
00520   <a class="code" href="print-color_8c.html#a1">RAW_CURVE_CHANNEL</a>(9),
00521   <a class="code" href="print-color_8c.html#a1">RAW_CURVE_CHANNEL</a>(10),
00522   <a class="code" href="print-color_8c.html#a1">RAW_CURVE_CHANNEL</a>(11),
00523   <a class="code" href="print-color_8c.html#a1">RAW_CURVE_CHANNEL</a>(12),
00524   <a class="code" href="print-color_8c.html#a1">RAW_CURVE_CHANNEL</a>(13),
00525   <a class="code" href="print-color_8c.html#a1">RAW_CURVE_CHANNEL</a>(14),
00526   <a class="code" href="print-color_8c.html#a1">RAW_CURVE_CHANNEL</a>(15),
00527   <a class="code" href="print-color_8c.html#a1">RAW_CURVE_CHANNEL</a>(16),
00528   <a class="code" href="print-color_8c.html#a1">RAW_CURVE_CHANNEL</a>(17),
00529   <a class="code" href="print-color_8c.html#a1">RAW_CURVE_CHANNEL</a>(18),
00530   <a class="code" href="print-color_8c.html#a1">RAW_CURVE_CHANNEL</a>(19),
00531   <a class="code" href="print-color_8c.html#a1">RAW_CURVE_CHANNEL</a>(20),
00532   <a class="code" href="print-color_8c.html#a1">RAW_CURVE_CHANNEL</a>(21),
00533   <a class="code" href="print-color_8c.html#a1">RAW_CURVE_CHANNEL</a>(22),
00534   <a class="code" href="print-color_8c.html#a1">RAW_CURVE_CHANNEL</a>(23),
00535   <a class="code" href="print-color_8c.html#a1">RAW_CURVE_CHANNEL</a>(24),
00536   <a class="code" href="print-color_8c.html#a1">RAW_CURVE_CHANNEL</a>(25),
00537   <a class="code" href="print-color_8c.html#a1">RAW_CURVE_CHANNEL</a>(26),
00538   <a class="code" href="print-color_8c.html#a1">RAW_CURVE_CHANNEL</a>(27),
00539   <a class="code" href="print-color_8c.html#a1">RAW_CURVE_CHANNEL</a>(28),
00540   <a class="code" href="print-color_8c.html#a1">RAW_CURVE_CHANNEL</a>(29),
00541   <a class="code" href="print-color_8c.html#a1">RAW_CURVE_CHANNEL</a>(30),
00542   <a class="code" href="print-color_8c.html#a1">RAW_CURVE_CHANNEL</a>(31),
00543 };
00544 
<a name="l00545"></a><a class="code" href="print-color_8c.html#a23">00545</a> <span class="keyword">static</span> <span class="keyword">const</span> <span class="keywordtype">int</span> <a class="code" href="print-color_8c.html#a23">curve_parameter_count</a> =
00546 <span class="keyword">sizeof</span>(<a class="code" href="print-color_8c.html#a22">curve_parameters</a>) / <span class="keyword">sizeof</span>(<a class="code" href="structcurve__param__t.html">curve_param_t</a>);
00547 
00548 
00549 <span class="keyword">static</span> <span class="keyword">const</span> <a class="code" href="structcolor__description__t.html">color_description_t</a> *
<a name="l00550"></a><a class="code" href="print-color_8c.html#a28">00550</a> <a class="code" href="print-color_8c.html#a28">get_color_description</a>(<span class="keyword">const</span> <span class="keywordtype">char</span> *name)
00551 {
00552   <span class="keywordtype">int</span> i;
00553   <span class="keywordflow">if</span> (name)
00554     <span class="keywordflow">for</span> (i = 0; i &lt; <a class="code" href="print-color_8c.html#a11">color_description_count</a>; i++)
00555       {
00556         <span class="keywordflow">if</span> (strcmp(name, <a class="code" href="print-color_8c.html#a10">color_descriptions</a>[i].name) == 0)
00557           <span class="keywordflow">return</span> &amp;(<a class="code" href="print-color_8c.html#a10">color_descriptions</a>[i]);
00558       }
00559   <span class="keywordflow">return</span> NULL;
00560 }
00561 
00562 <span class="keyword">static</span> <span class="keyword">const</span> <a class="code" href="structchannel__depth__t.html">channel_depth_t</a> *
<a name="l00563"></a><a class="code" href="print-color_8c.html#a29">00563</a> <a class="code" href="print-color_8c.html#a29">get_channel_depth</a>(<span class="keyword">const</span> <span class="keywordtype">char</span> *name)
00564 {
00565   <span class="keywordtype">int</span> i;
00566   <span class="keywordflow">if</span> (name)
00567     <span class="keywordflow">for</span> (i = 0; i &lt; <a class="code" href="print-color_8c.html#a13">channel_depth_count</a>; i++)
00568       {
00569         <span class="keywordflow">if</span> (strcmp(name, <a class="code" href="print-color_8c.html#a12">channel_depths</a>[i].name) == 0)
00570           <span class="keywordflow">return</span> &amp;(<a class="code" href="print-color_8c.html#a12">channel_depths</a>[i]);
00571       }
00572   <span class="keywordflow">return</span> NULL;
00573 }
00574 
00575 <span class="keyword">static</span> <span class="keyword">const</span> <a class="code" href="structcolor__correction__t.html">color_correction_t</a> *
<a name="l00576"></a><a class="code" href="print-color_8c.html#a30">00576</a> <a class="code" href="print-color_8c.html#a30">get_color_correction</a>(<span class="keyword">const</span> <span class="keywordtype">char</span> *name)
00577 {
00578   <span class="keywordtype">int</span> i;
00579   <span class="keywordflow">if</span> (name)
00580     <span class="keywordflow">for</span> (i = 0; i &lt; <a class="code" href="print-color_8c.html#a5">color_correction_count</a>; i++)
00581       {
00582         <span class="keywordflow">if</span> (strcmp(name, <a class="code" href="print-color_8c.html#a4">color_corrections</a>[i].name) == 0)
00583           <span class="keywordflow">return</span> &amp;(<a class="code" href="print-color_8c.html#a4">color_corrections</a>[i]);
00584       }
00585   <span class="keywordflow">return</span> NULL;
00586 }
00587 
00588 <span class="keyword">static</span> <span class="keyword">const</span> <a class="code" href="structcolor__correction__t.html">color_correction_t</a> *
<a name="l00589"></a><a class="code" href="print-color_8c.html#a31">00589</a> <a class="code" href="print-color_8c.html#a31">get_color_correction_by_tag</a>(color_correction_enum_t correction)
00590 {
00591   <span class="keywordtype">int</span> i;
00592   <span class="keywordflow">for</span> (i = 0; i &lt; <a class="code" href="print-color_8c.html#a5">color_correction_count</a>; i++)
00593     {
00594       <span class="keywordflow">if</span> (correction == <a class="code" href="print-color_8c.html#a4">color_corrections</a>[i].<a class="code" href="structcolor__correction__t.html#o2">correction</a>)
00595         <span class="keywordflow">return</span> &amp;(<a class="code" href="print-color_8c.html#a4">color_corrections</a>[i]);
00596     }
00597   <span class="keywordflow">return</span> NULL;
00598 }
00599 
00600 
00601 <span class="keyword">static</span> <span class="keywordtype">void</span>
<a name="l00602"></a><a class="code" href="print-color_8c.html#a32">00602</a> <a class="code" href="print-color_8c.html#a32">initialize_channels</a>(<a class="code" href="structstp__vars.html">stp_vars_t</a> *v, <a class="code" href="structstp__image.html">stp_image_t</a> *image)
00603 {
00604   <a class="code" href="structlut__t.html">lut_t</a> *lut = (<a class="code" href="structlut__t.html">lut_t</a> *)(<a class="code" href="group__vars.html#ga20">stp_get_component_data</a>(v, <span class="stringliteral">"Color"</span>));
00605   <span class="keywordflow">if</span> (<a class="code" href="group__vars.html#ga102">stp_check_float_parameter</a>(v, <span class="stringliteral">"InkLimit"</span>, <a class="code" href="group__vars.html#gga135a32">STP_PARAMETER_ACTIVE</a>))
00606     <a class="code" href="channel_8c.html#a8">stp_channel_set_ink_limit</a>(v, <a class="code" href="group__vars.html#ga70">stp_get_float_parameter</a>(v, <span class="stringliteral">"InkLimit"</span>));
00607   <a class="code" href="channel_8c.html#a12">stp_channel_initialize</a>(v, image, lut-&gt;<a class="code" href="structlut__t.html#o4">out_channels</a>);
00608   lut-&gt;<a class="code" href="structlut__t.html#o5">channels_are_initialized</a> = 1;
00609 }
00610 
00611 <span class="keyword">static</span> <span class="keywordtype">int</span>
<a name="l00612"></a><a class="code" href="print-color_8c.html#a33">00612</a> <a class="code" href="print-color_8c.html#a33">stpi_color_traditional_get_row</a>(<a class="code" href="structstp__vars.html">stp_vars_t</a> *v,
00613                                <a class="code" href="structstp__image.html">stp_image_t</a> *image,
00614                                <span class="keywordtype">int</span> row,
00615                                <span class="keywordtype">unsigned</span> *zero_mask)
00616 {
00617   <span class="keyword">const</span> <a class="code" href="structlut__t.html">lut_t</a> *lut = (<span class="keyword">const</span> <a class="code" href="structlut__t.html">lut_t</a> *)(<a class="code" href="group__vars.html#ga20">stp_get_component_data</a>(v, <span class="stringliteral">"Color"</span>));
00618   <span class="keywordtype">unsigned</span> zero;
00619   <span class="keywordflow">if</span> (<a class="code" href="group__image.html#ga4">stp_image_get_row</a>(image, lut-&gt;<a class="code" href="structlut__t.html#o29">in_data</a>,
00620                         lut-&gt;<a class="code" href="structlut__t.html#o2">image_width</a> * lut-&gt;<a class="code" href="structlut__t.html#o3">in_channels</a>, row)
00621       != <a class="code" href="group__image.html#gga9a2">STP_IMAGE_STATUS_OK</a>)
00622     <span class="keywordflow">return</span> 2;
00623   <span class="keywordflow">if</span> (!lut-&gt;<a class="code" href="structlut__t.html#o5">channels_are_initialized</a>)
00624     <a class="code" href="print-color_8c.html#a32">initialize_channels</a>(v, image);
00625   zero = (lut-&gt;<a class="code" href="structlut__t.html#o8">output_color_description</a>-&gt;<a class="code" href="structcolor__description__t.html#o8">conversion_function</a>)
00626     (v, lut-&gt;<a class="code" href="structlut__t.html#o29">in_data</a>, <a class="code" href="channel_8c.html#a20">stp_channel_get_input</a>(v));
00627   <span class="keywordflow">if</span> (zero_mask)
00628     *zero_mask = zero;
00629   <a class="code" href="channel_8c.html#a19">stp_channel_convert</a>(v, zero_mask);
00630   <span class="keywordflow">return</span> 0;
00631 }
00632 
00633 <span class="keyword">static</span> <span class="keywordtype">void</span>
<a name="l00634"></a><a class="code" href="print-color_8c.html#a34">00634</a> <a class="code" href="print-color_8c.html#a34">free_channels</a>(<a class="code" href="structlut__t.html">lut_t</a> *lut)
00635 {
00636   <span class="keywordtype">int</span> i;
00637   <span class="keywordflow">for</span> (i = 0; i &lt; <a class="code" href="group__image.html#ga8">STP_CHANNEL_LIMIT</a>; i++)
00638     <a class="code" href="curve-cache_8c.html#a0">stp_curve_free_curve_cache</a>(&amp;(lut-&gt;<a class="code" href="structlut__t.html#o13">channel_curves</a>[i]));
00639 }
00640 
00641 <span class="keyword">static</span> <a class="code" href="structlut__t.html">lut_t</a> *
<a name="l00642"></a><a class="code" href="print-color_8c.html#a35">00642</a> <a class="code" href="print-color_8c.html#a35">allocate_lut</a>(<span class="keywordtype">void</span>)
00643 {
00644   <span class="keywordtype">int</span> i;
00645   <a class="code" href="structlut__t.html">lut_t</a> *ret = <a class="code" href="group__util.html#ga29">stp_zalloc</a>(<span class="keyword">sizeof</span>(<a class="code" href="structlut__t.html">lut_t</a>));
00646   <span class="keywordflow">for</span> (i = 0; i &lt; <a class="code" href="group__image.html#ga8">STP_CHANNEL_LIMIT</a>; i++)
00647     {
00648       ret-&gt;<a class="code" href="structlut__t.html#o14">gamma_values</a>[i] = 1.0;
00649     }
00650   ret-&gt;<a class="code" href="structlut__t.html#o15">print_gamma</a> = 1.0;
00651   ret-&gt;<a class="code" href="structlut__t.html#o16">app_gamma</a> = 1.0;
00652   ret-&gt;<a class="code" href="structlut__t.html#o18">contrast</a> = 1.0;
00653   ret-&gt;<a class="code" href="structlut__t.html#o19">brightness</a> = 1.0;
00654   <span class="keywordflow">return</span> ret;
00655 }
00656 
00657 <span class="keyword">static</span> <span class="keywordtype">void</span> *
<a name="l00658"></a><a class="code" href="print-color_8c.html#a36">00658</a> <a class="code" href="print-color_8c.html#a36">copy_lut</a>(<span class="keywordtype">void</span> *vlut)
00659 {
00660   <span class="keyword">const</span> <a class="code" href="structlut__t.html">lut_t</a> *src = (<span class="keyword">const</span> <a class="code" href="structlut__t.html">lut_t</a> *)vlut;
00661   <span class="keywordtype">int</span> i;
00662   <a class="code" href="structlut__t.html">lut_t</a> *dest;
00663   <span class="keywordflow">if</span> (!src)
00664     <span class="keywordflow">return</span> NULL;
00665   dest = <a class="code" href="print-color_8c.html#a35">allocate_lut</a>();
00666   <a class="code" href="print-color_8c.html#a34">free_channels</a>(dest);
00667 
00668   dest-&gt;<a class="code" href="structlut__t.html#o0">steps</a> = src-&gt;<a class="code" href="structlut__t.html#o0">steps</a>;
00669   dest-&gt;<a class="code" href="structlut__t.html#o1">channel_depth</a> = src-&gt;<a class="code" href="structlut__t.html#o1">channel_depth</a>;
00670   dest-&gt;<a class="code" href="structlut__t.html#o2">image_width</a> = src-&gt;<a class="code" href="structlut__t.html#o2">image_width</a>;
00671   dest-&gt;<a class="code" href="structlut__t.html#o3">in_channels</a> = src-&gt;<a class="code" href="structlut__t.html#o3">in_channels</a>;
00672   dest-&gt;<a class="code" href="structlut__t.html#o4">out_channels</a> = src-&gt;<a class="code" href="structlut__t.html#o4">out_channels</a>;
00673   <span class="comment">/* Don't copy channels_are_initialized */</span>
00674   dest-&gt;<a class="code" href="structlut__t.html#o6">invert_output</a> = src-&gt;<a class="code" href="structlut__t.html#o6">invert_output</a>;
00675   dest-&gt;<a class="code" href="structlut__t.html#o7">input_color_description</a> = src-&gt;<a class="code" href="structlut__t.html#o7">input_color_description</a>;
00676   dest-&gt;<a class="code" href="structlut__t.html#o8">output_color_description</a> = src-&gt;<a class="code" href="structlut__t.html#o8">output_color_description</a>;
00677   dest-&gt;<a class="code" href="structlut__t.html#o9">color_correction</a> = src-&gt;<a class="code" href="structlut__t.html#o9">color_correction</a>;
00678   <span class="keywordflow">for</span> (i = 0; i &lt; <a class="code" href="group__image.html#ga8">STP_CHANNEL_LIMIT</a>; i++)
00679     {
00680       <a class="code" href="curve-cache_8c.html#a9">stp_curve_cache_copy</a>(&amp;(dest-&gt;<a class="code" href="structlut__t.html#o13">channel_curves</a>[i]), &amp;(src-&gt;<a class="code" href="structlut__t.html#o13">channel_curves</a>[i]));
00681       dest-&gt;<a class="code" href="structlut__t.html#o14">gamma_values</a>[i] = src-&gt;<a class="code" href="structlut__t.html#o14">gamma_values</a>[i];
00682     }
00683   <a class="code" href="curve-cache_8c.html#a9">stp_curve_cache_copy</a>(&amp;(dest-&gt;<a class="code" href="structlut__t.html#o10">brightness_correction</a>),
00684                        &amp;(src-&gt;<a class="code" href="structlut__t.html#o10">brightness_correction</a>));
00685   <a class="code" href="curve-cache_8c.html#a9">stp_curve_cache_copy</a>(&amp;(dest-&gt;<a class="code" href="structlut__t.html#o11">contrast_correction</a>),
00686                        &amp;(src-&gt;<a class="code" href="structlut__t.html#o11">contrast_correction</a>));
00687   <a class="code" href="curve-cache_8c.html#a9">stp_curve_cache_copy</a>(&amp;(dest-&gt;<a class="code" href="structlut__t.html#o12">user_color_correction</a>),
00688                        &amp;(src-&gt;<a class="code" href="structlut__t.html#o12">user_color_correction</a>));
00689   dest-&gt;<a class="code" href="structlut__t.html#o15">print_gamma</a> = src-&gt;<a class="code" href="structlut__t.html#o15">print_gamma</a>;
00690   dest-&gt;<a class="code" href="structlut__t.html#o16">app_gamma</a> = src-&gt;<a class="code" href="structlut__t.html#o16">app_gamma</a>;
00691   dest-&gt;<a class="code" href="structlut__t.html#o17">screen_gamma</a> = src-&gt;<a class="code" href="structlut__t.html#o17">screen_gamma</a>;
00692   dest-&gt;<a class="code" href="structlut__t.html#o18">contrast</a> = src-&gt;<a class="code" href="structlut__t.html#o18">contrast</a>;
00693   dest-&gt;<a class="code" href="structlut__t.html#o19">brightness</a> = src-&gt;<a class="code" href="structlut__t.html#o19">brightness</a>;
00694   dest-&gt;<a class="code" href="structlut__t.html#o20">linear_contrast_adjustment</a> = src-&gt;<a class="code" href="structlut__t.html#o20">linear_contrast_adjustment</a>;
00695   <a class="code" href="curve-cache_8c.html#a9">stp_curve_cache_copy</a>(&amp;(dest-&gt;<a class="code" href="structlut__t.html#o22">hue_map</a>), &amp;(src-&gt;<a class="code" href="structlut__t.html#o22">hue_map</a>));
00696   <a class="code" href="curve-cache_8c.html#a9">stp_curve_cache_copy</a>(&amp;(dest-&gt;<a class="code" href="structlut__t.html#o23">lum_map</a>), &amp;(src-&gt;<a class="code" href="structlut__t.html#o23">lum_map</a>));
00697   <a class="code" href="curve-cache_8c.html#a9">stp_curve_cache_copy</a>(&amp;(dest-&gt;<a class="code" href="structlut__t.html#o24">sat_map</a>), &amp;(src-&gt;<a class="code" href="structlut__t.html#o24">sat_map</a>));
00698   <a class="code" href="curve-cache_8c.html#a9">stp_curve_cache_copy</a>(&amp;(dest-&gt;<a class="code" href="structlut__t.html#o25">gcr_curve</a>), &amp;(src-&gt;<a class="code" href="structlut__t.html#o25">gcr_curve</a>));
00699   <span class="comment">/* Don't copy gray_tmp */</span>
00700   <span class="comment">/* Don't copy cmy_tmp */</span>
00701   <span class="comment">/* Don't copy cmyk_tmp */</span>
00702   <span class="keywordflow">if</span> (src-&gt;<a class="code" href="structlut__t.html#o29">in_data</a>)
00703     {
00704       dest-&gt;<a class="code" href="structlut__t.html#o29">in_data</a> = <a class="code" href="group__util.html#ga28">stp_malloc</a>(src-&gt;<a class="code" href="structlut__t.html#o2">image_width</a> * src-&gt;<a class="code" href="structlut__t.html#o3">in_channels</a>);
00705       memset(dest-&gt;<a class="code" href="structlut__t.html#o29">in_data</a>, 0, src-&gt;<a class="code" href="structlut__t.html#o2">image_width</a> * src-&gt;<a class="code" href="structlut__t.html#o3">in_channels</a>);
00706     }
00707   <span class="keywordflow">return</span> dest;
00708 }
00709 
00710 <span class="keyword">static</span> <span class="keywordtype">void</span>
<a name="l00711"></a><a class="code" href="print-color_8c.html#a37">00711</a> <a class="code" href="print-color_8c.html#a37">free_lut</a>(<span class="keywordtype">void</span> *vlut)
00712 {
00713   <a class="code" href="structlut__t.html">lut_t</a> *lut = (<a class="code" href="structlut__t.html">lut_t</a> *)vlut;
00714   <a class="code" href="print-color_8c.html#a34">free_channels</a>(lut);
00715   <a class="code" href="curve-cache_8c.html#a0">stp_curve_free_curve_cache</a>(&amp;(lut-&gt;<a class="code" href="structlut__t.html#o10">brightness_correction</a>));
00716   <a class="code" href="curve-cache_8c.html#a0">stp_curve_free_curve_cache</a>(&amp;(lut-&gt;<a class="code" href="structlut__t.html#o11">contrast_correction</a>));
00717   <a class="code" href="curve-cache_8c.html#a0">stp_curve_free_curve_cache</a>(&amp;(lut-&gt;<a class="code" href="structlut__t.html#o12">user_color_correction</a>));
00718   <a class="code" href="curve-cache_8c.html#a0">stp_curve_free_curve_cache</a>(&amp;(lut-&gt;<a class="code" href="structlut__t.html#o22">hue_map</a>));
00719   <a class="code" href="curve-cache_8c.html#a0">stp_curve_free_curve_cache</a>(&amp;(lut-&gt;<a class="code" href="structlut__t.html#o23">lum_map</a>));
00720   <a class="code" href="curve-cache_8c.html#a0">stp_curve_free_curve_cache</a>(&amp;(lut-&gt;<a class="code" href="structlut__t.html#o24">sat_map</a>));
00721   <a class="code" href="curve-cache_8c.html#a0">stp_curve_free_curve_cache</a>(&amp;(lut-&gt;<a class="code" href="structlut__t.html#o25">gcr_curve</a>));
00722   <a class="code" href="group__util.html#ga52">STP_SAFE_FREE</a>(lut-&gt;<a class="code" href="structlut__t.html#o26">gray_tmp</a>);
00723   <a class="code" href="group__util.html#ga52">STP_SAFE_FREE</a>(lut-&gt;<a class="code" href="structlut__t.html#o27">cmy_tmp</a>);
00724   <a class="code" href="group__util.html#ga52">STP_SAFE_FREE</a>(lut-&gt;<a class="code" href="structlut__t.html#o28">cmyk_tmp</a>);
00725   <a class="code" href="group__util.html#ga52">STP_SAFE_FREE</a>(lut-&gt;<a class="code" href="structlut__t.html#o29">in_data</a>);
00726   memset(lut, 0, <span class="keyword">sizeof</span>(<a class="code" href="structlut__t.html">lut_t</a>));
00727   <a class="code" href="group__util.html#ga31">stp_free</a>(lut);
00728 }
00729 
00730 <span class="keyword">static</span> <a class="code" href="structstp__curve.html">stp_curve_t</a> *
<a name="l00731"></a><a class="code" href="print-color_8c.html#a38">00731</a> <a class="code" href="print-color_8c.html#a38">compute_gcr_curve</a>(<span class="keyword">const</span> <a class="code" href="structstp__vars.html">stp_vars_t</a> *vars)
00732 {
00733   <a class="code" href="structstp__curve.html">stp_curve_t</a> *curve;
00734   <a class="code" href="structlut__t.html">lut_t</a> *lut = (<a class="code" href="structlut__t.html">lut_t</a> *)(<a class="code" href="group__vars.html#ga20">stp_get_component_data</a>(vars, <span class="stringliteral">"Color"</span>));
00735   <span class="keywordtype">double</span> k_lower = 0.0;
00736   <span class="keywordtype">double</span> k_upper = 1.0;
00737   <span class="keywordtype">double</span> k_gamma = 1.0;
00738   <span class="keywordtype">double</span> i_k_gamma = 1.0;
00739   <span class="keywordtype">double</span> *tmp_data = <a class="code" href="group__util.html#ga28">stp_malloc</a>(<span class="keyword">sizeof</span>(<span class="keywordtype">double</span>) * lut-&gt;<a class="code" href="structlut__t.html#o0">steps</a>);
00740   <span class="keywordtype">int</span> i;
00741 
00742   <span class="keywordflow">if</span> (<a class="code" href="group__vars.html#ga102">stp_check_float_parameter</a>(vars, <span class="stringliteral">"GCRUpper"</span>, <a class="code" href="group__vars.html#gga135a31">STP_PARAMETER_DEFAULTED</a>))
00743     k_upper = <a class="code" href="group__vars.html#ga70">stp_get_float_parameter</a>(vars, <span class="stringliteral">"GCRUpper"</span>);
00744   <span class="keywordflow">if</span> (<a class="code" href="group__vars.html#ga102">stp_check_float_parameter</a>(vars, <span class="stringliteral">"GCRLower"</span>, <a class="code" href="group__vars.html#gga135a31">STP_PARAMETER_DEFAULTED</a>))
00745     k_lower = <a class="code" href="group__vars.html#ga70">stp_get_float_parameter</a>(vars, <span class="stringliteral">"GCRLower"</span>);
00746   <span class="keywordflow">if</span> (<a class="code" href="group__vars.html#ga102">stp_check_float_parameter</a>(vars, <span class="stringliteral">"BlackGamma"</span>, <a class="code" href="group__vars.html#gga135a31">STP_PARAMETER_DEFAULTED</a>))
00747     k_gamma = <a class="code" href="group__vars.html#ga70">stp_get_float_parameter</a>(vars, <span class="stringliteral">"BlackGamma"</span>);
00748   k_upper *= lut-&gt;<a class="code" href="structlut__t.html#o0">steps</a>;
00749   k_lower *= lut-&gt;<a class="code" href="structlut__t.html#o0">steps</a>;
00750 
00751   <span class="keywordflow">if</span> (k_lower &gt; lut-&gt;<a class="code" href="structlut__t.html#o0">steps</a>)
00752     k_lower = lut-&gt;<a class="code" href="structlut__t.html#o0">steps</a>;
00753   <span class="keywordflow">if</span> (k_upper &lt; k_lower)
00754     k_upper = k_lower + 1;
00755   i_k_gamma = 1.0 / k_gamma;
00756 
00757   <span class="keywordflow">for</span> (i = 0; i &lt; k_lower; i ++)
00758     tmp_data[i] = 0;
00759   <span class="keywordflow">if</span> (k_upper &lt; lut-&gt;<a class="code" href="structlut__t.html#o0">steps</a>)
00760     {
00761       <span class="keywordflow">for</span> (i = ceil(k_lower); i &lt; k_upper; i ++)
00762         {
00763           <span class="keywordtype">double</span> where = (i - k_lower) / (k_upper - k_lower);
00764           <span class="keywordtype">double</span> g1 = pow(where, i_k_gamma);
00765           <span class="keywordtype">double</span> g2 = 1.0 - pow(1.0 - where, k_gamma);
00766           <span class="keywordtype">double</span> value = (g1 &gt; g2 ? g1 : g2);
00767           tmp_data[i] = 65535.0 * k_upper * value / (<span class="keywordtype">double</span>) (lut-&gt;<a class="code" href="structlut__t.html#o0">steps</a> - 1);
00768           tmp_data[i] = floor(tmp_data[i] + .5);
00769         }
00770       <span class="keywordflow">for</span> (i = ceil(k_upper); i &lt; lut-&gt;<a class="code" href="structlut__t.html#o0">steps</a>; i ++)
00771         tmp_data[i] = 65535.0 * i / (<span class="keywordtype">double</span>) (lut-&gt;<a class="code" href="structlut__t.html#o0">steps</a> - 1);
00772     }
00773   <span class="keywordflow">else</span> <span class="keywordflow">if</span> (k_lower &lt; lut-&gt;<a class="code" href="structlut__t.html#o0">steps</a>)
00774     <span class="keywordflow">for</span> (i = ceil(k_lower); i &lt; lut-&gt;<a class="code" href="structlut__t.html#o0">steps</a>; i ++)
00775       {
00776         <span class="keywordtype">double</span> where = (i - k_lower) / (k_upper - k_lower);
00777         <span class="keywordtype">double</span> g1 = pow(where, i_k_gamma);
00778         <span class="keywordtype">double</span> g2 = 1.0 - pow(1.0 - where, k_gamma);
00779         <span class="keywordtype">double</span> value = (g1 &gt; g2 ? g1 : g2);
00780         tmp_data[i] = 65535.0 * lut-&gt;<a class="code" href="structlut__t.html#o0">steps</a> * value / (<span class="keywordtype">double</span>) (lut-&gt;<a class="code" href="structlut__t.html#o0">steps</a> - 1);
00781         tmp_data[i] = floor(tmp_data[i] + .5);
00782       }
00783   curve = <a class="code" href="group__curve.html#ga20">stp_curve_create</a>(<a class="code" href="group__curve.html#gga48a3">STP_CURVE_WRAP_NONE</a>);
00784   <a class="code" href="group__curve.html#ga25">stp_curve_set_bounds</a>(curve, 0, 65535);
00785   <span class="keywordflow">if</span> (! <a class="code" href="group__curve.html#ga35">stp_curve_set_data</a>(curve, lut-&gt;<a class="code" href="structlut__t.html#o0">steps</a>, tmp_data))
00786     {
00787       <a class="code" href="print-util_8c.html#a18">stp_eprintf</a>(vars, <span class="stringliteral">"set curve data failed!\n"</span>);
00788       <a class="code" href="group__util.html#ga3">stp_abort</a>();
00789     }
00790   <a class="code" href="group__util.html#ga31">stp_free</a>(tmp_data);
00791   <span class="keywordflow">return</span> curve;
00792 }
00793 
00794 <span class="keyword">static</span> <span class="keywordtype">void</span>
<a name="l00795"></a><a class="code" href="print-color_8c.html#a39">00795</a> <a class="code" href="print-color_8c.html#a39">initialize_gcr_curve</a>(<span class="keyword">const</span> <a class="code" href="structstp__vars.html">stp_vars_t</a> *vars)
00796 {
00797   <a class="code" href="structlut__t.html">lut_t</a> *lut = (<a class="code" href="structlut__t.html">lut_t</a> *)(<a class="code" href="group__vars.html#ga20">stp_get_component_data</a>(vars, <span class="stringliteral">"Color"</span>));
00798   <span class="keywordflow">if</span> (!<a class="code" href="curve-cache_8c.html#a2">stp_curve_cache_get_curve</a>(&amp;(lut-&gt;<a class="code" href="structlut__t.html#o25">gcr_curve</a>)))
00799     {
00800       <span class="keywordflow">if</span> (<a class="code" href="group__vars.html#ga106">stp_check_curve_parameter</a>(vars, <span class="stringliteral">"GCRCurve"</span>, <a class="code" href="group__vars.html#gga135a31">STP_PARAMETER_DEFAULTED</a>))
00801         {
00802           <span class="keywordtype">double</span> data;
00803           size_t count;
00804           <span class="keywordtype">int</span> i;
00805           <a class="code" href="structstp__curve.html">stp_curve_t</a> *curve =
00806             <a class="code" href="group__curve.html#ga24">stp_curve_create_copy</a>(<a class="code" href="group__vars.html#ga50">stp_get_curve_parameter</a>(vars, <span class="stringliteral">"GCRCurve"</span>));
00807           <a class="code" href="group__curve.html#ga51">stp_curve_resample</a>(curve, lut-&gt;<a class="code" href="structlut__t.html#o0">steps</a>);
00808           count = <a class="code" href="group__curve.html#ga28">stp_curve_count_points</a>(curve);
00809           <a class="code" href="group__curve.html#ga25">stp_curve_set_bounds</a>(curve, 0.0, 65535.0);
00810           <span class="keywordflow">for</span> (i = 0; i &lt; count; i++)
00811             {
00812               <a class="code" href="group__curve.html#ga43">stp_curve_get_point</a>(curve, i, &amp;data);
00813               data = 65535.0 * data * (<span class="keywordtype">double</span>) i / (count - 1);
00814               <a class="code" href="group__curve.html#ga42">stp_curve_set_point</a>(curve, i, data);
00815             }
00816           <a class="code" href="curve-cache_8c.html#a4">stp_curve_cache_set_curve</a>(&amp;(lut-&gt;<a class="code" href="structlut__t.html#o25">gcr_curve</a>), curve);
00817         }
00818       <span class="keywordflow">else</span>
00819         <a class="code" href="curve-cache_8c.html#a4">stp_curve_cache_set_curve</a>(&amp;(lut-&gt;<a class="code" href="structlut__t.html#o25">gcr_curve</a>), <a class="code" href="print-color_8c.html#a38">compute_gcr_curve</a>(vars));
00820     }
00821 }
00822 
00823 <span class="comment">/*</span>
00824 <span class="comment"> * Channels that are synthesized (e. g. the black channel in CMY -&gt; CMYK</span>
00825 <span class="comment"> * conversion) need to be computed differently from channels that are</span>
00826 <span class="comment"> * mapped 1-1 from input to output.  Channels that are simply mapped need</span>
00827 <span class="comment"> * to be inverted if necessary, and in addition the contrast, brightness,</span>
00828 <span class="comment"> * and other gamma factors are factored in.  Channels that are synthesized</span>
00829 <span class="comment"> * are never inverted, since they're computed from the output of other</span>
00830 <span class="comment"> * channels that have already been inverted.</span>
00831 <span class="comment"> *</span>
00832 <span class="comment"> * This isn't simply a matter of comparing the input channels to the output</span>
00833 <span class="comment"> * channels, since some of the conversions (K -&gt; CMYK) work by means</span>
00834 <span class="comment"> * of a chain of conversions (K-&gt;CMY-&gt;CMYK).  In this case, we need to</span>
00835 <span class="comment"> * fully compute the CMY channels, but the K channel in the output is</span>
00836 <span class="comment"> * not inverted.</span>
00837 <span class="comment"> *</span>
00838 <span class="comment"> * The rules that are implemented by the logic below are:</span>
00839 <span class="comment"> *</span>
00840 <span class="comment"> * 1) If the input is raw, we always perform the normal computation (without</span>
00841 <span class="comment"> *    synthesizing channels).</span>
00842 <span class="comment"> *</span>
00843 <span class="comment"> * 2) If the output is CMY or K only, we never synthesize channels.  We've</span>
00844 <span class="comment"> *    now covered raw, black, and CMY/RGB outputs, leaving CMYK and CMYKRB.</span>
00845 <span class="comment"> *</span>
00846 <span class="comment"> * 3) Output channels above CMYK are synthesized (e. g. RB in CMYKRB).</span>
00847 <span class="comment"> *</span>
00848 <span class="comment"> * 4) If the input is CMYK, we do not synthesize channels.</span>
00849 <span class="comment"> *</span>
00850 <span class="comment"> * 5) The black channel (in CMYK) is synthesized.</span>
00851 <span class="comment"> *</span>
00852 <span class="comment"> * 6) All other channels (CMY/RGB) are not synthesized.</span>
00853 <span class="comment"> */</span>
00854 
00855 <span class="keyword">static</span> <span class="keywordtype">int</span>
<a name="l00856"></a><a class="code" href="print-color_8c.html#a40">00856</a> <a class="code" href="print-color_8c.html#a40">channel_is_synthesized</a>(<a class="code" href="structlut__t.html">lut_t</a> *lut, <span class="keywordtype">int</span> channel)
00857 {
00858   <span class="keywordflow">if</span> (lut-&gt;<a class="code" href="structlut__t.html#o8">output_color_description</a>-&gt;<a class="code" href="structcolor__description__t.html#o3">color_id</a> == <a class="code" href="color-conversion_8h.html#a53a45">COLOR_ID_RAW</a>)
00859     <span class="keywordflow">return</span> 1;                   <span class="comment">/* Case 1 */</span>
00860   <span class="keywordflow">else</span> <span class="keywordflow">if</span> (lut-&gt;<a class="code" href="structlut__t.html#o8">output_color_description</a>-&gt;<a class="code" href="structcolor__description__t.html#o5">channels</a> == <a class="code" href="color-conversion_8h.html#a20">CMASK_CMY</a> ||
00861            lut-&gt;<a class="code" href="structlut__t.html#o8">output_color_description</a>-&gt;<a class="code" href="structcolor__description__t.html#o5">channels</a> == <a class="code" href="color-conversion_8h.html#a9">CMASK_K</a>)
00862     <span class="keywordflow">return</span> 0;                   <span class="comment">/* Case 2 */</span>
00863   <span class="keywordflow">else</span> <span class="keywordflow">if</span> (channel &gt;= <a class="code" href="color-conversion_8h.html#a4">CHANNEL_W</a>)
00864     <span class="keywordflow">return</span> 1;                   <span class="comment">/* Case 3 */</span>
00865   <span class="keywordflow">else</span> <span class="keywordflow">if</span> (lut-&gt;<a class="code" href="structlut__t.html#o7">input_color_description</a>-&gt;<a class="code" href="structcolor__description__t.html#o5">channels</a> == <a class="code" href="color-conversion_8h.html#a21">CMASK_CMYK</a>)
00866     <span class="keywordflow">return</span> 0;                   <span class="comment">/* Case 4 */</span>
00867   <span class="keywordflow">else</span> <span class="keywordflow">if</span> (channel == <a class="code" href="color-conversion_8h.html#a0">CHANNEL_K</a>)
00868     <span class="keywordflow">return</span> 1;                   <span class="comment">/* Case 5 */</span>
00869   <span class="keywordflow">else</span>
00870     <span class="keywordflow">return</span> 0;                   <span class="comment">/* Case 6 */</span>
00871 }
00872 
00873 <span class="keyword">static</span> <span class="keywordtype">void</span>
<a name="l00874"></a><a class="code" href="print-color_8c.html#a41">00874</a> <a class="code" href="print-color_8c.html#a41">compute_user_correction</a>(<a class="code" href="structlut__t.html">lut_t</a> *lut)
00875 {
00876   <span class="keywordtype">double</span> *tmp;
00877   <span class="keywordtype">double</span> *tmp_brightness;
00878   <span class="keywordtype">double</span> *tmp_contrast;
00879   <span class="keywordtype">double</span> xcontrast = lut-&gt;<a class="code" href="structlut__t.html#o18">contrast</a>;
00880   <a class="code" href="structstp__curve.html">stp_curve_t</a> *curve =
00881     <a class="code" href="curve-cache_8c.html#a2">stp_curve_cache_get_curve</a>(&amp;(lut-&gt;<a class="code" href="structlut__t.html#o12">user_color_correction</a>));
00882   <a class="code" href="structstp__curve.html">stp_curve_t</a> *brightness_curve =
00883     <a class="code" href="curve-cache_8c.html#a2">stp_curve_cache_get_curve</a>(&amp;(lut-&gt;<a class="code" href="structlut__t.html#o10">brightness_correction</a>));
00884   <a class="code" href="structstp__curve.html">stp_curve_t</a> *contrast_curve =
00885     <a class="code" href="curve-cache_8c.html#a2">stp_curve_cache_get_curve</a>(&amp;(lut-&gt;<a class="code" href="structlut__t.html#o11">contrast_correction</a>));
00886   <span class="keywordtype">double</span> brightness = lut-&gt;<a class="code" href="structlut__t.html#o19">brightness</a>;
00887   <span class="keywordtype">int</span> i;
00888   <span class="keywordtype">int</span> isteps = lut-&gt;<a class="code" href="structlut__t.html#o0">steps</a>;
00889   <span class="keywordflow">if</span> (isteps &gt; 256)
00890     isteps = 256;
00891   tmp = <a class="code" href="group__util.html#ga28">stp_malloc</a>(<span class="keyword">sizeof</span>(<span class="keywordtype">double</span>) * lut-&gt;<a class="code" href="structlut__t.html#o0">steps</a>);
00892   tmp_brightness = <a class="code" href="group__util.html#ga28">stp_malloc</a>(<span class="keyword">sizeof</span>(<span class="keywordtype">double</span>) * lut-&gt;<a class="code" href="structlut__t.html#o0">steps</a>);
00893   tmp_contrast = <a class="code" href="group__util.html#ga28">stp_malloc</a>(<span class="keyword">sizeof</span>(<span class="keywordtype">double</span>) * lut-&gt;<a class="code" href="structlut__t.html#o0">steps</a>);
00894   <span class="keywordflow">if</span> (brightness &lt; .001)
00895     brightness = 1000;
00896   <span class="keywordflow">else</span> <span class="keywordflow">if</span> (brightness &gt; 1.999)
00897     brightness = .001;
00898   <span class="keywordflow">else</span> <span class="keywordflow">if</span> (brightness &gt; 1)
00899     brightness = 2.0 - brightness;
00900   <span class="keywordflow">else</span>
00901     brightness = 1.0 / brightness;
00902   <span class="keywordflow">for</span> (i = 0; i &lt; isteps; i ++)
00903     {
00904       <span class="keywordtype">double</span> temp_pixel, pixel;
00905       pixel = (<span class="keywordtype">double</span>) i / (<span class="keywordtype">double</span>) (isteps - 1);
00906       <span class="comment">/*</span>
00907 <span class="comment">       * First, correct contrast</span>
00908 <span class="comment">       */</span>
00909       <span class="keywordflow">if</span> (pixel &gt;= .5)
00910         temp_pixel = 1.0 - pixel;
00911       <span class="keywordflow">else</span>
00912         temp_pixel = pixel;
00913       <span class="keywordflow">if</span> (lut-&gt;<a class="code" href="structlut__t.html#o18">contrast</a> &gt; 3.99999)
00914         {
00915           <span class="keywordflow">if</span> (temp_pixel &lt; .5)
00916             temp_pixel = 0;
00917           <span class="keywordflow">else</span>
00918             temp_pixel = 1;
00919         }
00920       <span class="keywordflow">if</span> (temp_pixel &lt;= .000001 &amp;&amp; lut-&gt;<a class="code" href="structlut__t.html#o18">contrast</a> &lt;= .0001)
00921         temp_pixel = .5;
00922       <span class="keywordflow">else</span> <span class="keywordflow">if</span> (temp_pixel &gt; 1)
00923         temp_pixel = .5 * pow(2 * temp_pixel, xcontrast);
00924       <span class="keywordflow">else</span> <span class="keywordflow">if</span> (temp_pixel &lt; 1)
00925         {
00926           <span class="keywordflow">if</span> (lut-&gt;<a class="code" href="structlut__t.html#o20">linear_contrast_adjustment</a>)
00927             temp_pixel = 0.5 -
00928               ((0.5 - .5 * pow(2 * temp_pixel, lut-&gt;<a class="code" href="structlut__t.html#o18">contrast</a>)) *
00929                lut-&gt;<a class="code" href="structlut__t.html#o18">contrast</a>);
00930           <span class="keywordflow">else</span>
00931             temp_pixel = 0.5 -
00932               ((0.5 - .5 * pow(2 * temp_pixel, lut-&gt;<a class="code" href="structlut__t.html#o18">contrast</a>)));
00933         }
00934       <span class="keywordflow">if</span> (temp_pixel &gt; .5)
00935         temp_pixel = .5;
00936       <span class="keywordflow">else</span> <span class="keywordflow">if</span> (temp_pixel &lt; 0)
00937         temp_pixel = 0;
00938       <span class="keywordflow">if</span> (pixel &lt; .5)
00939         pixel = temp_pixel;
00940       <span class="keywordflow">else</span>
00941         pixel = 1 - temp_pixel;
00942       tmp_contrast[i] = floor((pixel * 65535) + .5);
00943 
00944       <span class="comment">/*</span>
00945 <span class="comment">       * Second, do brightness</span>
00946 <span class="comment">       */</span>
00947       <span class="keywordflow">if</span> (brightness &lt; 1)
00948         pixel = pow(pixel, brightness);
00949       <span class="keywordflow">else</span>
00950         pixel = 1.0 - pow(1.0 - pixel, 1.0 / brightness);
00951       tmp[i] = floor((pixel * 65535) + .5);
00952       
00953       pixel = (<span class="keywordtype">double</span>) i / (<span class="keywordtype">double</span>) (isteps - 1);
00954       <span class="keywordflow">if</span> (brightness &lt; 1)
00955         pixel = pow(pixel, brightness);
00956       <span class="keywordflow">else</span>
00957         pixel = 1.0 - pow(1.0 - pixel, 1.0 / brightness);
00958       tmp_brightness[i] = floor((pixel * 65535) + .5);
00959     }  
00960   <a class="code" href="group__curve.html#ga35">stp_curve_set_data</a>(curve, isteps, tmp);
00961   <span class="keywordflow">if</span> (isteps != lut-&gt;<a class="code" href="structlut__t.html#o0">steps</a>)
00962     <a class="code" href="group__curve.html#ga51">stp_curve_resample</a>(curve, lut-&gt;<a class="code" href="structlut__t.html#o0">steps</a>);
00963   <a class="code" href="group__curve.html#ga35">stp_curve_set_data</a>(brightness_curve, isteps, tmp_brightness);
00964   <span class="keywordflow">if</span> (isteps != lut-&gt;<a class="code" href="structlut__t.html#o0">steps</a>)
00965     <a class="code" href="group__curve.html#ga51">stp_curve_resample</a>(brightness_curve, lut-&gt;<a class="code" href="structlut__t.html#o0">steps</a>);
00966   <a class="code" href="group__curve.html#ga35">stp_curve_set_data</a>(contrast_curve, isteps, tmp_contrast);
00967   <span class="keywordflow">if</span> (isteps != lut-&gt;<a class="code" href="structlut__t.html#o0">steps</a>)
00968     <a class="code" href="group__curve.html#ga51">stp_curve_resample</a>(contrast_curve, lut-&gt;<a class="code" href="structlut__t.html#o0">steps</a>);
00969   <a class="code" href="group__util.html#ga31">stp_free</a>(tmp);
00970   <a class="code" href="group__util.html#ga31">stp_free</a>(tmp_brightness);
00971   <a class="code" href="group__util.html#ga31">stp_free</a>(tmp_contrast);
00972 }
00973 
00974 <span class="keyword">static</span> <span class="keywordtype">void</span>
<a name="l00975"></a><a class="code" href="print-color_8c.html#a42">00975</a> <a class="code" href="print-color_8c.html#a42">compute_a_curve_full</a>(<a class="code" href="structlut__t.html">lut_t</a> *lut, <span class="keywordtype">int</span> channel)
00976 {
00977   <span class="keywordtype">double</span> *tmp;
00978   <span class="keywordtype">double</span> pivot = .25;
00979   <span class="keywordtype">double</span> ipivot = 1.0 - pivot;
00980   <span class="keywordtype">double</span> xgamma = pow(pivot, lut-&gt;<a class="code" href="structlut__t.html#o17">screen_gamma</a>);
00981   <span class="keywordtype">double</span> print_gamma=1.0+9.0*(lut-&gt;<a class="code" href="structlut__t.html#o15">print_gamma</a>-1.0);
00982   <span class="keywordtype">double</span> pivot2 = .75;
00983   <span class="keywordtype">double</span> ipivot2 = 1.0 - pivot2;
00984   <span class="keywordtype">double</span> xgamma2 = pow(pivot2, print_gamma);
00985   <a class="code" href="structstp__curve.html">stp_curve_t</a> *curve = <a class="code" href="curve-cache_8c.html#a2">stp_curve_cache_get_curve</a>(&amp;(lut-&gt;<a class="code" href="structlut__t.html#o13">channel_curves</a>[channel]));
00986   <span class="keywordtype">int</span> i;
00987   <span class="keywordtype">int</span> isteps = lut-&gt;<a class="code" href="structlut__t.html#o0">steps</a>;
00988   <span class="keywordflow">if</span> (isteps &gt; 256)
00989     isteps = 256;
00990   tmp = <a class="code" href="group__util.html#ga28">stp_malloc</a>(<span class="keyword">sizeof</span>(<span class="keywordtype">double</span>) * lut-&gt;<a class="code" href="structlut__t.html#o0">steps</a>);
00991   <span class="keywordflow">for</span> (i = 0; i &lt; isteps; i ++)
00992     {
00993       <span class="keywordtype">double</span> pixel = (<span class="keywordtype">double</span>) i / (<span class="keywordtype">double</span>) (isteps - 1);
00994 
00995       <span class="keywordflow">if</span> (lut-&gt;<a class="code" href="structlut__t.html#o7">input_color_description</a>-&gt;<a class="code" href="structcolor__description__t.html#o4">color_model</a> == <a class="code" href="color-conversion_8h.html#a52a36">COLOR_BLACK</a>)
00996         pixel = 1.0 - pixel;
00997 
00998       pixel = 1.0 -
00999         (1.0 / (1.0 - xgamma)) *
01000         (pow(pivot + ipivot * pixel, lut-&gt;<a class="code" href="structlut__t.html#o17">screen_gamma</a>) - xgamma);
01001 
01002       <span class="comment">/*</span>
01003 <span class="comment">       * Fourth, fix up cyan, magenta, yellow values</span>
01004 <span class="comment">       */</span>
01005       <span class="keywordflow">if</span> (pixel &lt; 0.0)
01006         pixel = 0.0;
01007       <span class="keywordflow">else</span> <span class="keywordflow">if</span> (pixel &gt; 1.0)
01008         pixel = 1.0;
01009 
01010       <span class="keywordflow">if</span> (pixel &gt; .9999 &amp;&amp; lut-&gt;<a class="code" href="structlut__t.html#o14">gamma_values</a>[channel] &lt; .00001)
01011         pixel = 0;
01012       <span class="keywordflow">else</span>
01013         pixel = 1 - pow(1 - pixel, lut-&gt;<a class="code" href="structlut__t.html#o14">gamma_values</a>[channel]);
01014       <span class="comment">/*</span>
01015 <span class="comment">       * Finally, fix up print gamma and scale</span>
01016 <span class="comment">       */</span>
01017 
01018       <span class="comment">/*</span>
01019 <span class="comment">       * Change to this function suggested by Alastair Robinson</span>
01020 <span class="comment">       * blackfive@fakenhamweb.co.uk</span>
01021 <span class="comment">       */</span>
01022       pixel = 65535 * (1.0 / (1.0 - xgamma2)) *
01023         (pow(pivot2 + ipivot2 * pixel, print_gamma) - xgamma2);
01024       <span class="keywordflow">if</span> (lut-&gt;<a class="code" href="structlut__t.html#o8">output_color_description</a>-&gt;<a class="code" href="structcolor__description__t.html#o4">color_model</a> == <a class="code" href="color-conversion_8h.html#a52a35">COLOR_WHITE</a>)
01025         pixel = 65535 - pixel;
01026 
01027       <span class="keywordflow">if</span> (pixel &lt;= 0.0)
01028         tmp[i] = 0;
01029       <span class="keywordflow">else</span> <span class="keywordflow">if</span> (pixel &gt;= 65535.0)
01030         tmp[i] = 65535;
01031       <span class="keywordflow">else</span>
01032         tmp[i] = (pixel);
01033       tmp[i] = floor(tmp[i] + 0.5);             <span class="comment">/* rounding is done here */</span>
01034     }
01035   <a class="code" href="group__curve.html#ga35">stp_curve_set_data</a>(curve, isteps, tmp);
01036   <span class="keywordflow">if</span> (isteps != lut-&gt;<a class="code" href="structlut__t.html#o0">steps</a>)
01037     <a class="code" href="group__curve.html#ga51">stp_curve_resample</a>(curve, lut-&gt;<a class="code" href="structlut__t.html#o0">steps</a>);
01038   <a class="code" href="group__util.html#ga31">stp_free</a>(tmp);
01039 }
01040 
01041 <span class="keyword">static</span> <span class="keywordtype">void</span>
<a name="l01042"></a><a class="code" href="print-color_8c.html#a43">01042</a> <a class="code" href="print-color_8c.html#a43">compute_a_curve_fast</a>(<a class="code" href="structlut__t.html">lut_t</a> *lut, <span class="keywordtype">int</span> channel)
01043 {
01044   <span class="keywordtype">double</span> *tmp;
01045   <a class="code" href="structstp__curve.html">stp_curve_t</a> *curve = <a class="code" href="curve-cache_8c.html#a2">stp_curve_cache_get_curve</a>(&amp;(lut-&gt;<a class="code" href="structlut__t.html#o13">channel_curves</a>[channel]));
01046   <span class="keywordtype">int</span> i;
01047   <span class="keywordtype">int</span> isteps = lut-&gt;<a class="code" href="structlut__t.html#o0">steps</a>;
01048   <span class="keywordflow">if</span> (isteps &gt; 256)
01049     isteps = 256;
01050   tmp = <a class="code" href="group__util.html#ga28">stp_malloc</a>(<span class="keyword">sizeof</span>(<span class="keywordtype">double</span>) * lut-&gt;<a class="code" href="structlut__t.html#o0">steps</a>);
01051   <span class="keywordflow">for</span> (i = 0; i &lt; isteps; i++)
01052     {
01053       <span class="keywordtype">double</span> pixel = (<span class="keywordtype">double</span>) i / (<span class="keywordtype">double</span>) (isteps - 1);
01054       pixel = 1 - pow(1 - pixel, lut-&gt;<a class="code" href="structlut__t.html#o14">gamma_values</a>[channel]);
01055       tmp[i] = floor((65535.0 * pixel) + 0.5);
01056     }
01057   <a class="code" href="group__curve.html#ga35">stp_curve_set_data</a>(curve, isteps, tmp);
01058   <span class="keywordflow">if</span> (isteps != lut-&gt;<a class="code" href="structlut__t.html#o0">steps</a>)
01059     <a class="code" href="group__curve.html#ga51">stp_curve_resample</a>(curve, lut-&gt;<a class="code" href="structlut__t.html#o0">steps</a>);
01060   <a class="code" href="group__util.html#ga31">stp_free</a>(tmp);
01061 }
01062 
01063 <span class="comment">/*</span>
01064 <span class="comment"> * If the input and output color spaces both have a particular channel,</span>
01065 <span class="comment"> * we want to use the general algorithm.  If not (i. e. we have to</span>
01066 <span class="comment"> * synthesize the channel), use a simple gamma curve.</span>
01067 <span class="comment"> */</span>
01068 <span class="keyword">static</span> <span class="keywordtype">void</span>
<a name="l01069"></a><a class="code" href="print-color_8c.html#a44">01069</a> <a class="code" href="print-color_8c.html#a44">compute_a_curve</a>(<a class="code" href="structlut__t.html">lut_t</a> *lut, <span class="keywordtype">int</span> channel)
01070 {
01071   <span class="keywordflow">if</span> (<a class="code" href="print-color_8c.html#a40">channel_is_synthesized</a>(lut, channel))
01072     <a class="code" href="print-color_8c.html#a43">compute_a_curve_fast</a>(lut, channel);
01073   <span class="keywordflow">else</span>
01074     <a class="code" href="print-color_8c.html#a42">compute_a_curve_full</a>(lut, channel);
01075 }
01076 
01077 <span class="keyword">static</span> <span class="keywordtype">void</span>
<a name="l01078"></a><a class="code" href="print-color_8c.html#a45">01078</a> <a class="code" href="print-color_8c.html#a45">invert_curve</a>(<a class="code" href="structstp__curve.html">stp_curve_t</a> *curve, <span class="keywordtype">int</span> invert_output)
01079 {
01080   <span class="keywordtype">double</span> lo, hi;
01081   <span class="keywordtype">int</span> i;
01082   size_t count;
01083   <span class="keyword">const</span> <span class="keywordtype">double</span> *data = <a class="code" href="group__curve.html#ga37">stp_curve_get_data</a>(curve, &amp;count);
01084   <span class="keywordtype">double</span> f_gamma = <a class="code" href="group__curve.html#ga34">stp_curve_get_gamma</a>(curve);
01085   <span class="keywordtype">double</span> *tmp_data;
01086 
01087   <a class="code" href="group__curve.html#ga26">stp_curve_get_bounds</a>(curve, &amp;lo, &amp;hi);
01088 
01089   <span class="keywordflow">if</span> (f_gamma)
01090     <a class="code" href="group__curve.html#ga33">stp_curve_set_gamma</a>(curve, -f_gamma);
01091   <span class="keywordflow">else</span>
01092     {
01093       tmp_data = <a class="code" href="group__util.html#ga28">stp_malloc</a>(<span class="keyword">sizeof</span>(<span class="keywordtype">double</span>) * count);
01094       <span class="keywordflow">for</span> (i = 0; i &lt; count; i++)
01095         tmp_data[i] = data[count - i - 1];
01096       <a class="code" href="group__curve.html#ga35">stp_curve_set_data</a>(curve, count, tmp_data);
01097       <a class="code" href="group__util.html#ga31">stp_free</a>(tmp_data);
01098     }
01099   <span class="keywordflow">if</span> (!invert_output)
01100     {
01101       <a class="code" href="group__curve.html#ga45">stp_curve_rescale</a>(curve, -1, <a class="code" href="group__curve.html#gga49a6">STP_CURVE_COMPOSE_MULTIPLY</a>,
01102                         <a class="code" href="group__curve.html#gga50a8">STP_CURVE_BOUNDS_RESCALE</a>);
01103       <a class="code" href="group__curve.html#ga45">stp_curve_rescale</a>(curve, lo + hi, <a class="code" href="group__curve.html#gga49a5">STP_CURVE_COMPOSE_ADD</a>,
01104                         <a class="code" href="group__curve.html#gga50a8">STP_CURVE_BOUNDS_RESCALE</a>);
01105     }
01106 }
01107 
01108 <span class="keyword">static</span> <span class="keywordtype">void</span>
<a name="l01109"></a><a class="code" href="print-color_8c.html#a46">01109</a> <a class="code" href="print-color_8c.html#a46">compute_one_lut</a>(<a class="code" href="structlut__t.html">lut_t</a> *lut, <span class="keywordtype">int</span> i)
01110 {
01111   <a class="code" href="structstp__curve.html">stp_curve_t</a> *curve =
01112     <a class="code" href="curve-cache_8c.html#a2">stp_curve_cache_get_curve</a>(&amp;(lut-&gt;<a class="code" href="structlut__t.html#o13">channel_curves</a>[i]));
01113   <span class="keywordflow">if</span> (curve)
01114     {
01115       <span class="keywordtype">int</span> invert_output =
01116         !<a class="code" href="print-color_8c.html#a40">channel_is_synthesized</a>(lut, i) &amp;&amp; lut-&gt;<a class="code" href="structlut__t.html#o6">invert_output</a>;
01117       <a class="code" href="group__curve.html#ga45">stp_curve_rescale</a>(curve, 65535.0, <a class="code" href="group__curve.html#gga49a6">STP_CURVE_COMPOSE_MULTIPLY</a>,
01118                         <a class="code" href="group__curve.html#gga50a8">STP_CURVE_BOUNDS_RESCALE</a>);
01119       <span class="keywordflow">if</span> (<a class="code" href="group__curve.html#ga30">stp_curve_is_piecewise</a>(curve))
01120         <a class="code" href="group__curve.html#ga51">stp_curve_resample</a>(curve, lut-&gt;<a class="code" href="structlut__t.html#o0">steps</a>);
01121       <a class="code" href="print-color_8c.html#a45">invert_curve</a>(curve, invert_output);
01122       <a class="code" href="group__curve.html#ga51">stp_curve_resample</a>(curve, lut-&gt;<a class="code" href="structlut__t.html#o0">steps</a>);
01123     }
01124   <span class="keywordflow">else</span>
01125     {
01126       curve = <a class="code" href="group__curve.html#ga24">stp_curve_create_copy</a>(<a class="code" href="print-color_8c.html#a20">color_curve_bounds</a>);
01127       <a class="code" href="group__curve.html#ga45">stp_curve_rescale</a>(curve, 65535.0, <a class="code" href="group__curve.html#gga49a6">STP_CURVE_COMPOSE_MULTIPLY</a>,
01128                         <a class="code" href="group__curve.html#gga50a8">STP_CURVE_BOUNDS_RESCALE</a>);
01129       <a class="code" href="curve-cache_8c.html#a4">stp_curve_cache_set_curve</a>(&amp;(lut-&gt;<a class="code" href="structlut__t.html#o13">channel_curves</a>[i]), curve);
01130       <a class="code" href="print-color_8c.html#a44">compute_a_curve</a>(lut, i);
01131     }
01132 }
01133 
01134 <span class="keyword">static</span> <span class="keywordtype">void</span>
<a name="l01135"></a><a class="code" href="print-color_8c.html#a47">01135</a> <a class="code" href="print-color_8c.html#a47">setup_channel</a>(<a class="code" href="structstp__vars.html">stp_vars_t</a> *v, <span class="keywordtype">int</span> i, <span class="keyword">const</span> <a class="code" href="structchannel__param__t.html">channel_param_t</a> *p)
01136 {
01137   <a class="code" href="structlut__t.html">lut_t</a> *lut = (<a class="code" href="structlut__t.html">lut_t</a> *)(<a class="code" href="group__vars.html#ga20">stp_get_component_data</a>(v, <span class="stringliteral">"Color"</span>));
01138   <span class="keyword">const</span> <span class="keywordtype">char</span> *gamma_name =
01139     (lut-&gt;<a class="code" href="structlut__t.html#o8">output_color_description</a>-&gt;<a class="code" href="structcolor__description__t.html#o4">color_model</a> == <a class="code" href="color-conversion_8h.html#a52a36">COLOR_BLACK</a> ?
01140      p-&gt;<a class="code" href="structchannel__param__t.html#o1">gamma_name</a> : p-&gt;<a class="code" href="structchannel__param__t.html#o3">rgb_gamma_name</a>);
01141   <span class="keyword">const</span> <span class="keywordtype">char</span> *curve_name =
01142     (lut-&gt;<a class="code" href="structlut__t.html#o8">output_color_description</a>-&gt;<a class="code" href="structcolor__description__t.html#o4">color_model</a> == <a class="code" href="color-conversion_8h.html#a52a36">COLOR_BLACK</a> ?
01143      p-&gt;<a class="code" href="structchannel__param__t.html#o2">curve_name</a> : p-&gt;<a class="code" href="structchannel__param__t.html#o4">rgb_curve_name</a>);
01144   <span class="keywordflow">if</span> (<a class="code" href="group__vars.html#ga102">stp_check_float_parameter</a>(v, p-&gt;<a class="code" href="structchannel__param__t.html#o1">gamma_name</a>, <a class="code" href="group__vars.html#gga135a31">STP_PARAMETER_DEFAULTED</a>))
01145     lut-&gt;<a class="code" href="structlut__t.html#o14">gamma_values</a>[i] = <a class="code" href="group__vars.html#ga70">stp_get_float_parameter</a>(v, gamma_name);
01146 
01147   <span class="keywordflow">if</span> (<a class="code" href="group__vars.html#ga115">stp_get_curve_parameter_active</a>(v, curve_name) &gt; 0 &amp;&amp;
01148       <a class="code" href="group__vars.html#ga115">stp_get_curve_parameter_active</a>(v, curve_name) &gt;=
01149       <a class="code" href="group__vars.html#ga111">stp_get_float_parameter_active</a>(v, gamma_name))
01150     <a class="code" href="curve-cache_8h.html#a8">stp_curve_cache_set_curve_copy</a>
01151       (&amp;(lut-&gt;<a class="code" href="structlut__t.html#o13">channel_curves</a>[i]), <a class="code" href="group__vars.html#ga50">stp_get_curve_parameter</a>(v, curve_name));
01152 
01153   <a class="code" href="print-util_8c.html#a23">stp_dprintf</a>(<a class="code" href="group__util.html#ga31">STP_DBG_LUT</a>, v, <span class="stringliteral">" %s %.3f\n"</span>, gamma_name, lut-&gt;<a class="code" href="structlut__t.html#o14">gamma_values</a>[i]);
01154   <a class="code" href="print-color_8c.html#a46">compute_one_lut</a>(lut, i);
01155 }
01156 
01157 
01158 <span class="keyword">static</span> <span class="keywordtype">void</span>
<a name="l01159"></a><a class="code" href="print-color_8c.html#a48">01159</a> <a class="code" href="print-color_8c.html#a48">stpi_compute_lut</a>(<a class="code" href="structstp__vars.html">stp_vars_t</a> *v)
01160 {
01161   <span class="keywordtype">int</span> i;
01162   <a class="code" href="structlut__t.html">lut_t</a> *lut = (<a class="code" href="structlut__t.html">lut_t</a> *)(<a class="code" href="group__vars.html#ga20">stp_get_component_data</a>(v, <span class="stringliteral">"Color"</span>));
01163   <a class="code" href="structstp__curve.html">stp_curve_t</a> *curve;
01164   <a class="code" href="print-util_8c.html#a23">stp_dprintf</a>(<a class="code" href="group__util.html#ga31">STP_DBG_LUT</a>, v, <span class="stringliteral">"stpi_compute_lut\n"</span>);
01165 
01166   <span class="keywordflow">if</span> (lut-&gt;<a class="code" href="structlut__t.html#o7">input_color_description</a>-&gt;<a class="code" href="structcolor__description__t.html#o4">color_model</a> == <a class="code" href="color-conversion_8h.html#a52a37">COLOR_UNKNOWN</a> ||
01167       lut-&gt;<a class="code" href="structlut__t.html#o8">output_color_description</a>-&gt;<a class="code" href="structcolor__description__t.html#o4">color_model</a> == <a class="code" href="color-conversion_8h.html#a52a37">COLOR_UNKNOWN</a> ||
01168       lut-&gt;<a class="code" href="structlut__t.html#o7">input_color_description</a>-&gt;<a class="code" href="structcolor__description__t.html#o4">color_model</a> ==
01169       lut-&gt;<a class="code" href="structlut__t.html#o8">output_color_description</a>-&gt;<a class="code" href="structcolor__description__t.html#o4">color_model</a>)
01170     lut-&gt;<a class="code" href="structlut__t.html#o6">invert_output</a> = 0;
01171   <span class="keywordflow">else</span>
01172     lut-&gt;<a class="code" href="structlut__t.html#o6">invert_output</a> = 1;
01173 
01174   lut-&gt;<a class="code" href="structlut__t.html#o20">linear_contrast_adjustment</a> = 0;
01175   lut-&gt;<a class="code" href="structlut__t.html#o15">print_gamma</a> = 1.0;
01176   lut-&gt;<a class="code" href="structlut__t.html#o16">app_gamma</a> = 1.0;
01177   lut-&gt;<a class="code" href="structlut__t.html#o18">contrast</a> = 1.0;
01178   lut-&gt;<a class="code" href="structlut__t.html#o19">brightness</a> = 1.0;
01179 
01180   <span class="keywordflow">if</span> (<a class="code" href="group__vars.html#ga105">stp_check_boolean_parameter</a>(v, <span class="stringliteral">"LinearContrast"</span>, <a class="code" href="group__vars.html#gga135a31">STP_PARAMETER_DEFAULTED</a>))
01181     lut-&gt;<a class="code" href="structlut__t.html#o20">linear_contrast_adjustment</a> =
01182       <a class="code" href="group__vars.html#ga62">stp_get_boolean_parameter</a>(v, <span class="stringliteral">"LinearContrast"</span>);
01183   <span class="keywordflow">if</span> (<a class="code" href="group__vars.html#ga102">stp_check_float_parameter</a>(v, <span class="stringliteral">"Gamma"</span>, <a class="code" href="group__vars.html#gga135a31">STP_PARAMETER_DEFAULTED</a>))
01184     lut-&gt;<a class="code" href="structlut__t.html#o15">print_gamma</a> = <a class="code" href="group__vars.html#ga70">stp_get_float_parameter</a>(v, <span class="stringliteral">"Gamma"</span>);
01185   <span class="keywordflow">if</span> (<a class="code" href="group__vars.html#ga102">stp_check_float_parameter</a>(v, <span class="stringliteral">"Contrast"</span>, <a class="code" href="group__vars.html#gga135a31">STP_PARAMETER_DEFAULTED</a>))
01186     lut-&gt;<a class="code" href="structlut__t.html#o18">contrast</a> = <a class="code" href="group__vars.html#ga70">stp_get_float_parameter</a>(v, <span class="stringliteral">"Contrast"</span>);
01187   <span class="keywordflow">if</span> (<a class="code" href="group__vars.html#ga102">stp_check_float_parameter</a>(v, <span class="stringliteral">"Brightness"</span>, <a class="code" href="group__vars.html#gga135a31">STP_PARAMETER_DEFAULTED</a>))
01188     lut-&gt;<a class="code" href="structlut__t.html#o19">brightness</a> = <a class="code" href="group__vars.html#ga70">stp_get_float_parameter</a>(v, <span class="stringliteral">"Brightness"</span>);
01189 
01190   <span class="keywordflow">if</span> (<a class="code" href="group__vars.html#ga102">stp_check_float_parameter</a>(v, <span class="stringliteral">"AppGamma"</span>, <a class="code" href="group__vars.html#gga135a32">STP_PARAMETER_ACTIVE</a>))
01191     lut-&gt;<a class="code" href="structlut__t.html#o16">app_gamma</a> = <a class="code" href="group__vars.html#ga70">stp_get_float_parameter</a>(v, <span class="stringliteral">"AppGamma"</span>);
01192   lut-&gt;<a class="code" href="structlut__t.html#o17">screen_gamma</a> = lut-&gt;<a class="code" href="structlut__t.html#o16">app_gamma</a> / 4.0; <span class="comment">/* "Empirical" */</span>
01193   curve = <a class="code" href="group__curve.html#ga24">stp_curve_create_copy</a>(<a class="code" href="print-color_8c.html#a20">color_curve_bounds</a>);
01194   <a class="code" href="group__curve.html#ga45">stp_curve_rescale</a>(curve, 65535.0, <a class="code" href="group__curve.html#gga49a6">STP_CURVE_COMPOSE_MULTIPLY</a>,
01195                     <a class="code" href="group__curve.html#gga50a8">STP_CURVE_BOUNDS_RESCALE</a>);
01196   <a class="code" href="curve-cache_8c.html#a4">stp_curve_cache_set_curve</a>(&amp;(lut-&gt;<a class="code" href="structlut__t.html#o12">user_color_correction</a>), curve);
01197   curve = <a class="code" href="group__curve.html#ga24">stp_curve_create_copy</a>(<a class="code" href="print-color_8c.html#a20">color_curve_bounds</a>);
01198   <a class="code" href="group__curve.html#ga45">stp_curve_rescale</a>(curve, 65535.0, <a class="code" href="group__curve.html#gga49a6">STP_CURVE_COMPOSE_MULTIPLY</a>,
01199                     <a class="code" href="group__curve.html#gga50a8">STP_CURVE_BOUNDS_RESCALE</a>);
01200   <a class="code" href="curve-cache_8c.html#a4">stp_curve_cache_set_curve</a>(&amp;(lut-&gt;<a class="code" href="structlut__t.html#o10">brightness_correction</a>), curve);
01201   curve = <a class="code" href="group__curve.html#ga24">stp_curve_create_copy</a>(<a class="code" href="print-color_8c.html#a20">color_curve_bounds</a>);
01202   <a class="code" href="group__curve.html#ga45">stp_curve_rescale</a>(curve, 65535.0, <a class="code" href="group__curve.html#gga49a6">STP_CURVE_COMPOSE_MULTIPLY</a>,
01203                     <a class="code" href="group__curve.html#gga50a8">STP_CURVE_BOUNDS_RESCALE</a>);
01204   <a class="code" href="curve-cache_8c.html#a4">stp_curve_cache_set_curve</a>(&amp;(lut-&gt;<a class="code" href="structlut__t.html#o11">contrast_correction</a>), curve);
01205   <a class="code" href="print-color_8c.html#a41">compute_user_correction</a>(lut);
01206 
01207   <span class="comment">/*</span>
01208 <span class="comment">   * TODO check that these are wraparound curves and all that</span>
01209 <span class="comment">   */</span>
01210 
01211   <span class="keywordflow">if</span> (lut-&gt;<a class="code" href="structlut__t.html#o9">color_correction</a>-&gt;<a class="code" href="structcolor__correction__t.html#o3">correct_hsl</a>)
01212     {
01213       <span class="keywordflow">if</span> (<a class="code" href="group__vars.html#ga106">stp_check_curve_parameter</a>(v, <span class="stringliteral">"HueMap"</span>, <a class="code" href="group__vars.html#gga135a31">STP_PARAMETER_DEFAULTED</a>))
01214         {
01215           lut-&gt;<a class="code" href="structlut__t.html#o22">hue_map</a>.<a class="code" href="structstp__cached__curve__t.html#o0">curve</a> =
01216             <a class="code" href="group__curve.html#ga24">stp_curve_create_copy</a>(<a class="code" href="group__vars.html#ga50">stp_get_curve_parameter</a>(v, <span class="stringliteral">"HueMap"</span>));
01217           <span class="keywordflow">if</span> (<a class="code" href="group__curve.html#ga30">stp_curve_is_piecewise</a>(lut-&gt;<a class="code" href="structlut__t.html#o22">hue_map</a>.<a class="code" href="structstp__cached__curve__t.html#o0">curve</a>))
01218             <a class="code" href="group__curve.html#ga51">stp_curve_resample</a>(lut-&gt;<a class="code" href="structlut__t.html#o22">hue_map</a>.<a class="code" href="structstp__cached__curve__t.html#o0">curve</a>, 384);
01219         }
01220       <span class="keywordflow">if</span> (<a class="code" href="group__vars.html#ga106">stp_check_curve_parameter</a>(v, <span class="stringliteral">"LumMap"</span>, <a class="code" href="group__vars.html#gga135a31">STP_PARAMETER_DEFAULTED</a>))
01221         {
01222           lut-&gt;<a class="code" href="structlut__t.html#o23">lum_map</a>.<a class="code" href="structstp__cached__curve__t.html#o0">curve</a> =
01223             <a class="code" href="group__curve.html#ga24">stp_curve_create_copy</a>(<a class="code" href="group__vars.html#ga50">stp_get_curve_parameter</a>(v, <span class="stringliteral">"LumMap"</span>));
01224           <span class="keywordflow">if</span> (<a class="code" href="group__curve.html#ga30">stp_curve_is_piecewise</a>(lut-&gt;<a class="code" href="structlut__t.html#o23">lum_map</a>.<a class="code" href="structstp__cached__curve__t.html#o0">curve</a>))
01225             <a class="code" href="group__curve.html#ga51">stp_curve_resample</a>(lut-&gt;<a class="code" href="structlut__t.html#o23">lum_map</a>.<a class="code" href="structstp__cached__curve__t.html#o0">curve</a>, 384);
01226         }
01227       <span class="keywordflow">if</span> (<a class="code" href="group__vars.html#ga106">stp_check_curve_parameter</a>(v, <span class="stringliteral">"SatMap"</span>, <a class="code" href="group__vars.html#gga135a31">STP_PARAMETER_DEFAULTED</a>))
01228         {
01229           lut-&gt;<a class="code" href="structlut__t.html#o24">sat_map</a>.<a class="code" href="structstp__cached__curve__t.html#o0">curve</a> =
01230             <a class="code" href="group__curve.html#ga24">stp_curve_create_copy</a>(<a class="code" href="group__vars.html#ga50">stp_get_curve_parameter</a>(v, <span class="stringliteral">"SatMap"</span>));
01231           <span class="keywordflow">if</span> (<a class="code" href="group__curve.html#ga30">stp_curve_is_piecewise</a>(lut-&gt;<a class="code" href="structlut__t.html#o24">sat_map</a>.<a class="code" href="structstp__cached__curve__t.html#o0">curve</a>))
01232             <a class="code" href="group__curve.html#ga51">stp_curve_resample</a>(lut-&gt;<a class="code" href="structlut__t.html#o24">sat_map</a>.<a class="code" href="structstp__cached__curve__t.html#o0">curve</a>, 384);
01233         }
01234     }
01235 
01236   <a class="code" href="print-util_8c.html#a23">stp_dprintf</a>(<a class="code" href="group__util.html#ga31">STP_DBG_LUT</a>, v, <span class="stringliteral">" print_gamma %.3f\n"</span>, lut-&gt;<a class="code" href="structlut__t.html#o15">print_gamma</a>);
01237   <a class="code" href="print-util_8c.html#a23">stp_dprintf</a>(<a class="code" href="group__util.html#ga31">STP_DBG_LUT</a>, v, <span class="stringliteral">" contrast %.3f\n"</span>, lut-&gt;<a class="code" href="structlut__t.html#o18">contrast</a>);
01238   <a class="code" href="print-util_8c.html#a23">stp_dprintf</a>(<a class="code" href="group__util.html#ga31">STP_DBG_LUT</a>, v, <span class="stringliteral">" brightness %.3f\n"</span>, lut-&gt;<a class="code" href="structlut__t.html#o19">brightness</a>);
01239   <a class="code" href="print-util_8c.html#a23">stp_dprintf</a>(<a class="code" href="group__util.html#ga31">STP_DBG_LUT</a>, v, <span class="stringliteral">" screen_gamma %.3f\n"</span>, lut-&gt;<a class="code" href="structlut__t.html#o17">screen_gamma</a>);
01240 
01241   <span class="keywordflow">for</span> (i = 0; i &lt; <a class="code" href="group__image.html#ga8">STP_CHANNEL_LIMIT</a>; i++)
01242     {
01243       <span class="keywordflow">if</span> (lut-&gt;<a class="code" href="structlut__t.html#o8">output_color_description</a>-&gt;<a class="code" href="structcolor__description__t.html#o6">channel_count</a> &lt; 1 &amp;&amp;
01244           i &lt; lut-&gt;<a class="code" href="structlut__t.html#o4">out_channels</a>)
01245         <a class="code" href="print-color_8c.html#a47">setup_channel</a>(v, i, &amp;(<a class="code" href="print-color_8c.html#a8">raw_channel_params</a>[i]));
01246       <span class="keywordflow">else</span> <span class="keywordflow">if</span> (i &lt; <a class="code" href="print-color_8c.html#a7">channel_param_count</a> &amp;&amp;
01247                lut-&gt;<a class="code" href="structlut__t.html#o8">output_color_description</a>-&gt;<a class="code" href="structcolor__description__t.html#o5">channels</a> &amp; (1 &lt;&lt; i))
01248         <a class="code" href="print-color_8c.html#a47">setup_channel</a>(v, i, &amp;(<a class="code" href="print-color_8c.html#a6">channel_params</a>[i]));
01249     }
01250   <span class="keywordflow">if</span> (((lut-&gt;<a class="code" href="structlut__t.html#o8">output_color_description</a>-&gt;<a class="code" href="structcolor__description__t.html#o5">channels</a> &amp; <a class="code" href="color-conversion_8h.html#a21">CMASK_CMYK</a>) == <a class="code" href="color-conversion_8h.html#a21">CMASK_CMYK</a>) &amp;&amp;
01251       (lut-&gt;<a class="code" href="structlut__t.html#o9">color_correction</a>-&gt;<a class="code" href="structcolor__correction__t.html#o2">correction</a> == <a class="code" href="color-conversion_8h.html#a51a31">COLOR_CORRECTION_DESATURATED</a> ||
01252        lut-&gt;<a class="code" href="structlut__t.html#o7">input_color_description</a>-&gt;<a class="code" href="structcolor__description__t.html#o3">color_id</a> == <a class="code" href="color-conversion_8h.html#a53a38">COLOR_ID_GRAY</a> ||
01253        lut-&gt;<a class="code" href="structlut__t.html#o7">input_color_description</a>-&gt;<a class="code" href="structcolor__description__t.html#o3">color_id</a> == <a class="code" href="color-conversion_8h.html#a53a39">COLOR_ID_WHITE</a> ||
01254        lut-&gt;<a class="code" href="structlut__t.html#o7">input_color_description</a>-&gt;<a class="code" href="structcolor__description__t.html#o3">color_id</a> == <a class="code" href="color-conversion_8h.html#a53a40">COLOR_ID_RGB</a> ||
01255        lut-&gt;<a class="code" href="structlut__t.html#o7">input_color_description</a>-&gt;<a class="code" href="structcolor__description__t.html#o3">color_id</a> == <a class="code" href="color-conversion_8h.html#a53a41">COLOR_ID_CMY</a>))
01256     <a class="code" href="print-color_8c.html#a39">initialize_gcr_curve</a>(v);
01257 }
01258 
01259 <span class="keyword">static</span> <span class="keywordtype">int</span>
<a name="l01260"></a><a class="code" href="print-color_8c.html#a49">01260</a> <a class="code" href="print-color_8c.html#a49">stpi_color_traditional_init</a>(<a class="code" href="structstp__vars.html">stp_vars_t</a> *v,
01261                             <a class="code" href="structstp__image.html">stp_image_t</a> *image,
01262                             size_t steps)
01263 {
01264   <a class="code" href="structlut__t.html">lut_t</a> *lut;
01265   <span class="keyword">const</span> <span class="keywordtype">char</span> *image_type = <a class="code" href="group__vars.html#ga36">stp_get_string_parameter</a>(v, <span class="stringliteral">"ImageType"</span>);
01266   <span class="keyword">const</span> <span class="keywordtype">char</span> *color_correction = <a class="code" href="group__vars.html#ga36">stp_get_string_parameter</a>(v, <span class="stringliteral">"ColorCorrection"</span>);
01267   <span class="keyword">const</span> <a class="code" href="structchannel__depth__t.html">channel_depth_t</a> *channel_depth =
01268     <a class="code" href="print-color_8c.html#a29">get_channel_depth</a>(<a class="code" href="group__vars.html#ga36">stp_get_string_parameter</a>(v, <span class="stringliteral">"ChannelBitDepth"</span>));
01269   size_t total_channel_bits;
01270 
01271   <span class="keywordflow">if</span> (steps != 256 &amp;&amp; steps != 65536)
01272     <span class="keywordflow">return</span> -1;
01273   <span class="keywordflow">if</span> (!channel_depth)
01274     <span class="keywordflow">return</span> -1;
01275 
01276   lut = <a class="code" href="print-color_8c.html#a35">allocate_lut</a>();
01277   lut-&gt;<a class="code" href="structlut__t.html#o7">input_color_description</a> =
01278     <a class="code" href="print-color_8c.html#a28">get_color_description</a>(<a class="code" href="group__vars.html#ga36">stp_get_string_parameter</a>(v, <span class="stringliteral">"InputImageType"</span>));
01279   lut-&gt;<a class="code" href="structlut__t.html#o8">output_color_description</a> =
01280     <a class="code" href="print-color_8c.html#a28">get_color_description</a>(<a class="code" href="group__vars.html#ga36">stp_get_string_parameter</a>(v, <span class="stringliteral">"STPIOutputType"</span>));
01281 
01282   <span class="keywordflow">if</span> (!lut-&gt;<a class="code" href="structlut__t.html#o7">input_color_description</a> || !lut-&gt;<a class="code" href="structlut__t.html#o8">output_color_description</a>)
01283     {
01284       <a class="code" href="print-color_8c.html#a37">free_lut</a>(lut);
01285       <span class="keywordflow">return</span> -1;
01286     }
01287 
01288   <span class="keywordflow">if</span> (lut-&gt;<a class="code" href="structlut__t.html#o7">input_color_description</a>-&gt;<a class="code" href="structcolor__description__t.html#o3">color_id</a> == <a class="code" href="color-conversion_8h.html#a53a45">COLOR_ID_RAW</a>)
01289     {
01290       <span class="keywordflow">if</span> (<a class="code" href="group__vars.html#ga43">stp_verify_parameter</a>(v, <span class="stringliteral">"STPIRawChannels"</span>, 1) != <a class="code" href="group__vars.html#gga136a34">PARAMETER_OK</a>)
01291         {
01292           <a class="code" href="print-color_8c.html#a37">free_lut</a>(lut);
01293           <span class="keywordflow">return</span> -1;
01294         }
01295       lut-&gt;<a class="code" href="structlut__t.html#o4">out_channels</a> = <a class="code" href="group__vars.html#ga58">stp_get_int_parameter</a>(v, <span class="stringliteral">"STPIRawChannels"</span>);
01296       lut-&gt;<a class="code" href="structlut__t.html#o3">in_channels</a> = lut-&gt;<a class="code" href="structlut__t.html#o4">out_channels</a>;
01297     }
01298   <span class="keywordflow">else</span>
01299     {
01300       lut-&gt;<a class="code" href="structlut__t.html#o4">out_channels</a> = lut-&gt;<a class="code" href="structlut__t.html#o8">output_color_description</a>-&gt;<a class="code" href="structcolor__description__t.html#o6">channel_count</a>;
01301       lut-&gt;<a class="code" href="structlut__t.html#o3">in_channels</a> = lut-&gt;<a class="code" href="structlut__t.html#o7">input_color_description</a>-&gt;<a class="code" href="structcolor__description__t.html#o6">channel_count</a>;
01302     }
01303 
01304   <a class="code" href="group__vars.html#ga18">stp_allocate_component_data</a>(v, <span class="stringliteral">"Color"</span>, <a class="code" href="print-color_8c.html#a36">copy_lut</a>, <a class="code" href="print-color_8c.html#a37">free_lut</a>, lut);
01305   lut-&gt;<a class="code" href="structlut__t.html#o0">steps</a> = steps;
01306   lut-&gt;<a class="code" href="structlut__t.html#o1">channel_depth</a> = channel_depth-&gt;<a class="code" href="structchannel__depth__t.html#o1">bits</a>;
01307 
01308   <span class="keywordflow">if</span> (image_type &amp;&amp; strcmp(image_type, <span class="stringliteral">"None"</span>) != 0)
01309     {
01310       <span class="keywordflow">if</span> (strcmp(image_type, <span class="stringliteral">"Text"</span>) == 0)
01311         lut-&gt;<a class="code" href="structlut__t.html#o9">color_correction</a> = <a class="code" href="print-color_8c.html#a30">get_color_correction</a>(<span class="stringliteral">"Threshold"</span>);
01312       <span class="keywordflow">else</span>
01313         lut-&gt;<a class="code" href="structlut__t.html#o9">color_correction</a> = <a class="code" href="print-color_8c.html#a30">get_color_correction</a>(<span class="stringliteral">"None"</span>);
01314     }
01315   <span class="keywordflow">else</span> <span class="keywordflow">if</span> (color_correction)
01316     lut-&gt;<a class="code" href="structlut__t.html#o9">color_correction</a> = <a class="code" href="print-color_8c.html#a30">get_color_correction</a>(color_correction);
01317   <span class="keywordflow">else</span>
01318     lut-&gt;<a class="code" href="structlut__t.html#o9">color_correction</a> = <a class="code" href="print-color_8c.html#a30">get_color_correction</a>(<span class="stringliteral">"None"</span>);
01319   <span class="keywordflow">if</span> (lut-&gt;<a class="code" href="structlut__t.html#o9">color_correction</a>-&gt;<a class="code" href="structcolor__correction__t.html#o2">correction</a> == <a class="code" href="color-conversion_8h.html#a51a26">COLOR_CORRECTION_DEFAULT</a>)
01320     lut-&gt;<a class="code" href="structlut__t.html#o9">color_correction</a> =
01321       (<a class="code" href="print-color_8c.html#a31">get_color_correction_by_tag</a>
01322        (lut-&gt;<a class="code" href="structlut__t.html#o8">output_color_description</a>-&gt;<a class="code" href="structcolor__description__t.html#o7">default_correction</a>));
01323 
01324   <a class="code" href="print-color_8c.html#a48">stpi_compute_lut</a>(v);
01325 
01326   lut-&gt;<a class="code" href="structlut__t.html#o2">image_width</a> = <a class="code" href="group__image.html#ga2">stp_image_width</a>(image);
01327   total_channel_bits = lut-&gt;<a class="code" href="structlut__t.html#o3">in_channels</a> * lut-&gt;<a class="code" href="structlut__t.html#o1">channel_depth</a>;
01328   lut-&gt;<a class="code" href="structlut__t.html#o29">in_data</a> = <a class="code" href="group__util.html#ga28">stp_malloc</a>(((lut-&gt;<a class="code" href="structlut__t.html#o2">image_width</a> * total_channel_bits) + 7)/8);
01329   memset(lut-&gt;<a class="code" href="structlut__t.html#o29">in_data</a>, 0, ((lut-&gt;<a class="code" href="structlut__t.html#o2">image_width</a> * total_channel_bits) + 7) / 8);
01330   <span class="keywordflow">return</span> lut-&gt;<a class="code" href="structlut__t.html#o4">out_channels</a>;
01331 }
01332 
01333 <span class="keyword">static</span> <span class="keywordtype">void</span>
<a name="l01334"></a><a class="code" href="print-color_8c.html#a50">01334</a> <a class="code" href="print-color_8c.html#a50">initialize_standard_curves</a>(<span class="keywordtype">void</span>)
01335 {
01336   <span class="keywordflow">if</span> (!<a class="code" href="print-color_8c.html#a16">standard_curves_initialized</a>)
01337     {
01338       <span class="keywordtype">int</span> i;
01339       <a class="code" href="print-color_8c.html#a17">hue_map_bounds</a> = <a class="code" href="group__curve.html#ga45">stp_curve_create_from_string</a>
01340         (<span class="stringliteral">"&lt;?xml version=\"1.0\" encoding=\"UTF-8\"?&gt;\n"</span>
01341          <span class="stringliteral">"&lt;gimp-print&gt;\n"</span>
01342          <span class="stringliteral">"&lt;curve wrap=\"wrap\" type=\"linear\" gamma=\"0\"&gt;\n"</span>
01343          <span class="stringliteral">"&lt;sequence count=\"2\" lower-bound=\"-6\" upper-bound=\"6\"&gt;\n"</span>
01344          <span class="stringliteral">"0 0\n"</span>
01345          <span class="stringliteral">"&lt;/sequence&gt;\n"</span>
01346          <span class="stringliteral">"&lt;/curve&gt;\n"</span>
01347          <span class="stringliteral">"&lt;/gimp-print&gt;"</span>);
01348       <a class="code" href="print-color_8c.html#a18">lum_map_bounds</a> = <a class="code" href="group__curve.html#ga45">stp_curve_create_from_string</a>
01349         (<span class="stringliteral">"&lt;?xml version=\"1.0\" encoding=\"UTF-8\"?&gt;\n"</span>
01350          <span class="stringliteral">"&lt;gimp-print&gt;\n"</span>
01351          <span class="stringliteral">"&lt;curve wrap=\"wrap\" type=\"linear\" gamma=\"0\"&gt;\n"</span>
01352          <span class="stringliteral">"&lt;sequence count=\"2\" lower-bound=\"0\" upper-bound=\"4\"&gt;\n"</span>
01353          <span class="stringliteral">"1 1\n"</span>
01354          <span class="stringliteral">"&lt;/sequence&gt;\n"</span>
01355          <span class="stringliteral">"&lt;/curve&gt;\n"</span>
01356          <span class="stringliteral">"&lt;/gimp-print&gt;"</span>);
01357       <a class="code" href="print-color_8c.html#a19">sat_map_bounds</a> = <a class="code" href="group__curve.html#ga45">stp_curve_create_from_string</a>
01358         (<span class="stringliteral">"&lt;?xml version=\"1.0\" encoding=\"UTF-8\"?&gt;\n"</span>
01359          <span class="stringliteral">"&lt;gimp-print&gt;\n"</span>
01360          <span class="stringliteral">"&lt;curve wrap=\"wrap\" type=\"linear\" gamma=\"0\"&gt;\n"</span>
01361          <span class="stringliteral">"&lt;sequence count=\"2\" lower-bound=\"0\" upper-bound=\"4\"&gt;\n"</span>
01362          <span class="stringliteral">"1 1\n"</span>
01363          <span class="stringliteral">"&lt;/sequence&gt;\n"</span>
01364          <span class="stringliteral">"&lt;/curve&gt;\n"</span>
01365          <span class="stringliteral">"&lt;/gimp-print&gt;"</span>);
01366       <a class="code" href="print-color_8c.html#a20">color_curve_bounds</a> = <a class="code" href="group__curve.html#ga45">stp_curve_create_from_string</a>
01367         (<span class="stringliteral">"&lt;?xml version=\"1.0\" encoding=\"UTF-8\"?&gt;\n"</span>
01368          <span class="stringliteral">"&lt;gimp-print&gt;\n"</span>
01369          <span class="stringliteral">"&lt;curve wrap=\"nowrap\" type=\"linear\" gamma=\"1.0\"&gt;\n"</span>
01370          <span class="stringliteral">"&lt;sequence count=\"0\" lower-bound=\"0\" upper-bound=\"1\"&gt;\n"</span>
01371          <span class="stringliteral">"&lt;/sequence&gt;\n"</span>
01372          <span class="stringliteral">"&lt;/curve&gt;\n"</span>
01373          <span class="stringliteral">"&lt;/gimp-print&gt;"</span>);
01374       <a class="code" href="print-color_8c.html#a21">gcr_curve_bounds</a> = <a class="code" href="group__curve.html#ga45">stp_curve_create_from_string</a>
01375         (<span class="stringliteral">"&lt;?xml version=\"1.0\" encoding=\"UTF-8\"?&gt;\n"</span>
01376          <span class="stringliteral">"&lt;gimp-print&gt;\n"</span>
01377          <span class="stringliteral">"&lt;curve wrap=\"nowrap\" type=\"linear\" gamma=\"0.0\"&gt;\n"</span>
01378          <span class="stringliteral">"&lt;sequence count=\"2\" lower-bound=\"0\" upper-bound=\"1\"&gt;\n"</span>
01379          <span class="stringliteral">"1 1\n"</span>
01380          <span class="stringliteral">"&lt;/sequence&gt;\n"</span>
01381          <span class="stringliteral">"&lt;/curve&gt;\n"</span>
01382          <span class="stringliteral">"&lt;/gimp-print&gt;"</span>);
01383       <span class="keywordflow">for</span> (i = 0; i &lt; <a class="code" href="print-color_8c.html#a23">curve_parameter_count</a>; i++)
01384         <a class="code" href="print-color_8c.html#a22">curve_parameters</a>[i].<a class="code" href="structcurve__param__t.html#o0">param</a>.<a class="code" href="structstp__parameter__t.html#o26">deflt</a>.curve =
01385          *(<a class="code" href="print-color_8c.html#a22">curve_parameters</a>[i].<a class="code" href="structcurve__param__t.html#o1">defval</a>);
01386       <a class="code" href="print-color_8c.html#a16">standard_curves_initialized</a> = 1;
01387     }
01388 }
01389 
01390 <span class="keyword">static</span> <a class="code" href="group__vars.html#ga1">stp_parameter_list_t</a>
<a name="l01391"></a><a class="code" href="print-color_8c.html#a51">01391</a> <a class="code" href="print-color_8c.html#a51">stpi_color_traditional_list_parameters</a>(<span class="keyword">const</span> <a class="code" href="structstp__vars.html">stp_vars_t</a> *v)
01392 {
01393   <a class="code" href="structstp__list.html">stp_list_t</a> *ret = <a class="code" href="group__vars.html#ga43">stp_parameter_list_create</a>();
01394   <span class="keywordtype">int</span> i;
01395   <a class="code" href="print-color_8c.html#a50">initialize_standard_curves</a>();
01396   <span class="keywordflow">for</span> (i = 0; i &lt; <a class="code" href="print-color_8c.html#a15">float_parameter_count</a>; i++)
01397     <a class="code" href="group__vars.html#ga82">stp_parameter_list_add_param</a>(ret, &amp;(<a class="code" href="print-color_8c.html#a14">float_parameters</a>[i].param));
01398   <span class="keywordflow">for</span> (i = 0; i &lt; <a class="code" href="print-color_8c.html#a23">curve_parameter_count</a>; i++)
01399     <a class="code" href="group__vars.html#ga82">stp_parameter_list_add_param</a>(ret, &amp;(<a class="code" href="print-color_8c.html#a22">curve_parameters</a>[i].param));
01400   <span class="keywordflow">return</span> ret;
01401 }
01402 
01403 <span class="keyword">static</span> <span class="keywordtype">void</span>
<a name="l01404"></a><a class="code" href="print-color_8c.html#a52">01404</a> <a class="code" href="print-color_8c.html#a52">stpi_color_traditional_describe_parameter</a>(<span class="keyword">const</span> <a class="code" href="structstp__vars.html">stp_vars_t</a> *v,
01405                                           <span class="keyword">const</span> <span class="keywordtype">char</span> *name,
01406                                           <a class="code" href="structstp__parameter__t.html">stp_parameter_t</a> *description)
01407 {
01408   <span class="keywordtype">int</span> i, j;
01409   description-&gt;<a class="code" href="structstp__parameter__t.html#o4">p_type</a> = <a class="code" href="group__vars.html#gga132a16">STP_PARAMETER_TYPE_INVALID</a>;
01410   <a class="code" href="print-color_8c.html#a50">initialize_standard_curves</a>();
01411   <span class="keywordflow">if</span> (name == NULL)
01412     <span class="keywordflow">return</span>;
01413 
01414   <span class="keywordflow">for</span> (i = 0; i &lt; <a class="code" href="print-color_8c.html#a15">float_parameter_count</a>; i++)
01415     {
01416       <span class="keyword">const</span> <a class="code" href="structfloat__param__t.html">float_param_t</a> *param = &amp;(<a class="code" href="print-color_8c.html#a14">float_parameters</a>[i]);
01417       <span class="keywordflow">if</span> (strcmp(name, param-&gt;<a class="code" href="structfloat__param__t.html#o0">param</a>.<a class="code" href="structstp__parameter__t.html#o0">name</a>) == 0)
01418         {
01419           <a class="code" href="group__vars.html#ga75">stp_fill_parameter_settings</a>(description, &amp;(param-&gt;<a class="code" href="structfloat__param__t.html#o0">param</a>));
01420           <span class="keywordflow">if</span> (param-&gt;<a class="code" href="structfloat__param__t.html#o5">channel_mask</a> != <a class="code" href="color-conversion_8h.html#a24">CMASK_EVERY</a>)
01421             {
01422               <span class="keyword">const</span> <a class="code" href="structcolor__description__t.html">color_description_t</a> *color_description =
01423                 <a class="code" href="print-color_8c.html#a28">get_color_description</a>(<a class="code" href="group__printer.html#ga33">stp_describe_output</a>(v));
01424               <span class="keywordflow">if</span> (color_description &amp;&amp;
01425                   (param-&gt;<a class="code" href="structfloat__param__t.html#o5">channel_mask</a> &amp; color_description-&gt;<a class="code" href="structcolor__description__t.html#o5">channels</a>) &amp;&amp;
01426                   param-&gt;<a class="code" href="structfloat__param__t.html#o5">channel_mask</a> != <a class="code" href="color-conversion_8h.html#a17">CMASK_RAW</a>)
01427                 description-&gt;<a class="code" href="structstp__parameter__t.html#o8">is_active</a> = 1;
01428               <span class="keywordflow">else</span>
01429                 description-&gt;<a class="code" href="structstp__parameter__t.html#o8">is_active</a> = 0;
01430               <span class="keywordflow">if</span> (param-&gt;<a class="code" href="structfloat__param__t.html#o4">color_only</a> &amp;&amp;
01431                   !(color_description-&gt;<a class="code" href="structcolor__description__t.html#o5">channels</a> &amp; ~<a class="code" href="color-conversion_8h.html#a9">CMASK_K</a>))
01432                 description-&gt;<a class="code" href="structstp__parameter__t.html#o8">is_active</a> = 0;
01433             }
01434           <span class="keywordflow">if</span> (<a class="code" href="group__vars.html#ga100">stp_check_string_parameter</a>(v, <span class="stringliteral">"ImageType"</span>, <a class="code" href="group__vars.html#gga135a32">STP_PARAMETER_ACTIVE</a>) &amp;&amp;
01435               strcmp(<a class="code" href="group__vars.html#ga36">stp_get_string_parameter</a>(v, <span class="stringliteral">"ImageType"</span>), <span class="stringliteral">"None"</span>) != 0 &amp;&amp;
01436               description-&gt;<a class="code" href="structstp__parameter__t.html#o6">p_level</a> &gt; <a class="code" href="group__vars.html#gga134a21">STP_PARAMETER_LEVEL_BASIC</a>)
01437             description-&gt;<a class="code" href="structstp__parameter__t.html#o8">is_active</a> = 0;
01438           <span class="keywordflow">switch</span> (param-&gt;<a class="code" href="structfloat__param__t.html#o0">param</a>.<a class="code" href="structstp__parameter__t.html#o4">p_type</a>)
01439             {
01440             <span class="keywordflow">case</span> <a class="code" href="group__vars.html#gga132a9">STP_PARAMETER_TYPE_BOOLEAN</a>:
01441               description-&gt;<a class="code" href="structstp__parameter__t.html#o26">deflt</a>.boolean = (<span class="keywordtype">int</span>) param-&gt;<a class="code" href="structfloat__param__t.html#o3">defval</a>;
01442               <span class="keywordflow">break</span>;
01443             <span class="keywordflow">case</span> <a class="code" href="group__vars.html#gga132a8">STP_PARAMETER_TYPE_INT</a>:
01444               description-&gt;<a class="code" href="structstp__parameter__t.html#o18">bounds</a>.integer.upper = (<span class="keywordtype">int</span>) param-&gt;<a class="code" href="structfloat__param__t.html#o2">max</a>;
01445               description-&gt;<a class="code" href="structstp__parameter__t.html#o18">bounds</a>.integer.lower = (<span class="keywordtype">int</span>) param-&gt;<a class="code" href="structfloat__param__t.html#o1">min</a>;
01446               description-&gt;<a class="code" href="structstp__parameter__t.html#o26">deflt</a>.integer = (<span class="keywordtype">int</span>) param-&gt;<a class="code" href="structfloat__param__t.html#o3">defval</a>;
01447               <span class="keywordflow">break</span>;
01448             <span class="keywordflow">case</span> <a class="code" href="group__vars.html#gga132a10">STP_PARAMETER_TYPE_DOUBLE</a>:
01449               description-&gt;<a class="code" href="structstp__parameter__t.html#o18">bounds</a>.dbl.upper = param-&gt;<a class="code" href="structfloat__param__t.html#o2">max</a>;
01450               description-&gt;<a class="code" href="structstp__parameter__t.html#o18">bounds</a>.dbl.lower = param-&gt;<a class="code" href="structfloat__param__t.html#o1">min</a>;
01451               description-&gt;<a class="code" href="structstp__parameter__t.html#o26">deflt</a>.dbl = param-&gt;<a class="code" href="structfloat__param__t.html#o3">defval</a>;
01452               <span class="keywordflow">if</span> (strcmp(name, <span class="stringliteral">"InkLimit"</span>) == 0)
01453                 {
01454                   <a class="code" href="structstp__parameter__t.html">stp_parameter_t</a> ink_limit_desc;
01455                   <a class="code" href="group__vars.html#ga83">stp_describe_parameter</a>(v, <span class="stringliteral">"InkChannels"</span>, &amp;ink_limit_desc);
01456                   <span class="keywordflow">if</span> (ink_limit_desc.<a class="code" href="structstp__parameter__t.html#o4">p_type</a> == <a class="code" href="group__vars.html#gga132a8">STP_PARAMETER_TYPE_INT</a>)
01457                     {
01458                       <span class="keywordflow">if</span> (ink_limit_desc.<a class="code" href="structstp__parameter__t.html#o26">deflt</a>.integer &gt; 1)
01459                         {
01460                           description-&gt;<a class="code" href="structstp__parameter__t.html#o18">bounds</a>.dbl.upper =
01461                             ink_limit_desc.<a class="code" href="structstp__parameter__t.html#o26">deflt</a>.integer;
01462                           description-&gt;<a class="code" href="structstp__parameter__t.html#o26">deflt</a>.dbl =
01463                             ink_limit_desc.<a class="code" href="structstp__parameter__t.html#o26">deflt</a>.integer;
01464                         }
01465                       <span class="keywordflow">else</span>
01466                         description-&gt;<a class="code" href="structstp__parameter__t.html#o8">is_active</a> = 0;
01467                     }
01468                   <a class="code" href="group__vars.html#ga84">stp_parameter_description_destroy</a>(&amp;ink_limit_desc);
01469                 }
01470               <span class="keywordflow">break</span>;
01471             <span class="keywordflow">case</span> <a class="code" href="group__vars.html#gga132a7">STP_PARAMETER_TYPE_STRING_LIST</a>:
01472               <span class="keywordflow">if</span> (!strcmp(param-&gt;<a class="code" href="structfloat__param__t.html#o0">param</a>.<a class="code" href="structstp__parameter__t.html#o0">name</a>, <span class="stringliteral">"ColorCorrection"</span>))
01473                 {
01474                   description-&gt;<a class="code" href="structstp__parameter__t.html#o18">bounds</a>.str = <a class="code" href="string-list_8h.html#a1">stp_string_list_create</a>();
01475                   <span class="keywordflow">for</span> (j = 0; j &lt; <a class="code" href="print-color_8c.html#a5">color_correction_count</a>; j++)
01476                     <a class="code" href="string-list_8h.html#a7">stp_string_list_add_string</a>
01477                       (description-&gt;<a class="code" href="structstp__parameter__t.html#o18">bounds</a>.str, <a class="code" href="print-color_8c.html#a4">color_corrections</a>[j].<a class="code" href="structcolor__correction__t.html#o0">name</a>,
01478                        <a class="code" href="group__intl__internal.html#ga5">_</a>(<a class="code" href="print-color_8c.html#a4">color_corrections</a>[j].text));
01479                   description-&gt;<a class="code" href="structstp__parameter__t.html#o26">deflt</a>.str =
01480                     <a class="code" href="string-list_8c.html#a6">stp_string_list_param</a>(description-&gt;<a class="code" href="structstp__parameter__t.html#o18">bounds</a>.str, 0)-&gt;<a class="code" href="structstp__param__string__t.html#o0">name</a>;
01481                 }
01482               <span class="keywordflow">else</span> <span class="keywordflow">if</span> (strcmp(name, <span class="stringliteral">"ChannelBitDepth"</span>) == 0)
01483                 {
01484                   description-&gt;<a class="code" href="structstp__parameter__t.html#o18">bounds</a>.str = <a class="code" href="string-list_8h.html#a1">stp_string_list_create</a>();
01485                   <span class="keywordflow">for</span> (j = 0; j &lt; <a class="code" href="print-color_8c.html#a13">channel_depth_count</a>; j++)
01486                     <a class="code" href="string-list_8h.html#a7">stp_string_list_add_string</a>
01487                       (description-&gt;<a class="code" href="structstp__parameter__t.html#o18">bounds</a>.str, <a class="code" href="print-color_8c.html#a12">channel_depths</a>[j].<a class="code" href="structchannel__depth__t.html#o0">name</a>,
01488                        <a class="code" href="print-color_8c.html#a12">channel_depths</a>[j].<a class="code" href="structchannel__depth__t.html#o0">name</a>);
01489                   description-&gt;<a class="code" href="structstp__parameter__t.html#o26">deflt</a>.str =
01490                     <a class="code" href="string-list_8c.html#a6">stp_string_list_param</a>(description-&gt;<a class="code" href="structstp__parameter__t.html#o18">bounds</a>.str, 0)-&gt;<a class="code" href="structstp__param__string__t.html#o0">name</a>;
01491                 }
01492               <span class="keywordflow">else</span> <span class="keywordflow">if</span> (strcmp(name, <span class="stringliteral">"InputImageType"</span>) == 0)
01493                 {
01494                   description-&gt;<a class="code" href="structstp__parameter__t.html#o18">bounds</a>.str = <a class="code" href="string-list_8h.html#a1">stp_string_list_create</a>();
01495                   <span class="keywordflow">for</span> (j = 0; j &lt; <a class="code" href="print-color_8c.html#a11">color_description_count</a>; j++)
01496                     <span class="keywordflow">if</span> (<a class="code" href="print-color_8c.html#a10">color_descriptions</a>[j].<a class="code" href="structcolor__description__t.html#o1">input</a>)
01497                       {
01498                         <span class="keywordflow">if</span> (<a class="code" href="print-color_8c.html#a10">color_descriptions</a>[j].<a class="code" href="structcolor__description__t.html#o3">color_id</a> == <a class="code" href="color-conversion_8h.html#a53a45">COLOR_ID_RAW</a>)
01499                           {
01500                             <a class="code" href="structstp__parameter__t.html">stp_parameter_t</a> desc;
01501                             <a class="code" href="group__vars.html#ga83">stp_describe_parameter</a>(v, <span class="stringliteral">"RawChannels"</span>, &amp;desc);
01502                             <span class="keywordflow">if</span> (desc.<a class="code" href="structstp__parameter__t.html#o4">p_type</a> == <a class="code" href="group__vars.html#gga132a7">STP_PARAMETER_TYPE_STRING_LIST</a>)
01503                               <a class="code" href="string-list_8h.html#a7">stp_string_list_add_string</a>
01504                                 (description-&gt;<a class="code" href="structstp__parameter__t.html#o18">bounds</a>.str,
01505                                  <a class="code" href="print-color_8c.html#a10">color_descriptions</a>[j].<a class="code" href="structcolor__description__t.html#o0">name</a>,
01506                                  <a class="code" href="print-color_8c.html#a10">color_descriptions</a>[j].<a class="code" href="structcolor__description__t.html#o0">name</a>);
01507                             <a class="code" href="group__vars.html#ga84">stp_parameter_description_destroy</a>(&amp;desc);
01508                           }
01509                         <span class="keywordflow">else</span>
01510                           <a class="code" href="string-list_8h.html#a7">stp_string_list_add_string</a>
01511                             (description-&gt;<a class="code" href="structstp__parameter__t.html#o18">bounds</a>.str,
01512                              <a class="code" href="print-color_8c.html#a10">color_descriptions</a>[j].<a class="code" href="structcolor__description__t.html#o0">name</a>,
01513                              <a class="code" href="print-color_8c.html#a10">color_descriptions</a>[j].<a class="code" href="structcolor__description__t.html#o0">name</a>);
01514                       }
01515                   description-&gt;<a class="code" href="structstp__parameter__t.html#o26">deflt</a>.str =
01516                     <a class="code" href="string-list_8c.html#a6">stp_string_list_param</a>(description-&gt;<a class="code" href="structstp__parameter__t.html#o18">bounds</a>.str, 0)-&gt;<a class="code" href="structstp__param__string__t.html#o0">name</a>;
01517                 }
01518               <span class="keywordflow">else</span> <span class="keywordflow">if</span> (strcmp(name, <span class="stringliteral">"OutputImageType"</span>) == 0)
01519                 {
01520                   description-&gt;<a class="code" href="structstp__parameter__t.html#o18">bounds</a>.str = <a class="code" href="string-list_8h.html#a1">stp_string_list_create</a>();
01521                   <span class="keywordflow">for</span> (j = 0; j &lt; <a class="code" href="print-color_8c.html#a11">color_description_count</a>; j++)
01522                     <span class="keywordflow">if</span> (<a class="code" href="print-color_8c.html#a10">color_descriptions</a>[j].<a class="code" href="structcolor__description__t.html#o2">output</a>)
01523                       <a class="code" href="string-list_8h.html#a7">stp_string_list_add_string</a>
01524                         (description-&gt;<a class="code" href="structstp__parameter__t.html#o18">bounds</a>.str, <a class="code" href="print-color_8c.html#a10">color_descriptions</a>[j].<a class="code" href="structcolor__description__t.html#o0">name</a>,
01525                          <a class="code" href="print-color_8c.html#a10">color_descriptions</a>[j].<a class="code" href="structcolor__description__t.html#o0">name</a>);
01526                   description-&gt;<a class="code" href="structstp__parameter__t.html#o26">deflt</a>.str =
01527                     <a class="code" href="string-list_8c.html#a6">stp_string_list_param</a>(description-&gt;<a class="code" href="structstp__parameter__t.html#o18">bounds</a>.str, 0)-&gt;<a class="code" href="structstp__param__string__t.html#o0">name</a>;
01528                 }
01529               <span class="keywordflow">break</span>;
01530             <span class="keywordflow">default</span>:
01531               <span class="keywordflow">break</span>;
01532             }
01533           <span class="keywordflow">return</span>;
01534         }
01535     }
01536   <span class="keywordflow">for</span> (i = 0; i &lt; <a class="code" href="print-color_8c.html#a23">curve_parameter_count</a>; i++)
01537     {
01538       <a class="code" href="structcurve__param__t.html">curve_param_t</a> *param = &amp;(<a class="code" href="print-color_8c.html#a22">curve_parameters</a>[i]);
01539       <span class="keywordflow">if</span> (strcmp(name, param-&gt;<a class="code" href="structcurve__param__t.html#o0">param</a>.<a class="code" href="structstp__parameter__t.html#o0">name</a>) == 0)
01540         {
01541           description-&gt;<a class="code" href="structstp__parameter__t.html#o8">is_active</a> = 1;
01542           <a class="code" href="group__vars.html#ga75">stp_fill_parameter_settings</a>(description, &amp;(param-&gt;<a class="code" href="structcurve__param__t.html#o0">param</a>));
01543           <span class="keywordflow">if</span> (param-&gt;<a class="code" href="structcurve__param__t.html#o2">channel_mask</a> != <a class="code" href="color-conversion_8h.html#a24">CMASK_EVERY</a>)
01544             {
01545               <span class="keyword">const</span> <a class="code" href="structcolor__description__t.html">color_description_t</a> *color_description =
01546                 <a class="code" href="print-color_8c.html#a28">get_color_description</a>(<a class="code" href="group__printer.html#ga33">stp_describe_output</a>(v));
01547               <span class="keywordflow">if</span> (color_description &amp;&amp;
01548                   (param-&gt;<a class="code" href="structcurve__param__t.html#o2">channel_mask</a> &amp; color_description-&gt;<a class="code" href="structcolor__description__t.html#o5">channels</a>))
01549                 description-&gt;<a class="code" href="structstp__parameter__t.html#o8">is_active</a> = 1;
01550               <span class="keywordflow">else</span>
01551                 description-&gt;<a class="code" href="structstp__parameter__t.html#o8">is_active</a> = 0;
01552               <span class="keywordflow">if</span> (param-&gt;<a class="code" href="structcurve__param__t.html#o4">color_only</a> &amp;&amp;
01553                   !(color_description-&gt;<a class="code" href="structcolor__description__t.html#o5">channels</a> &amp; ~<a class="code" href="color-conversion_8h.html#a9">CMASK_K</a>))
01554                 description-&gt;<a class="code" href="structstp__parameter__t.html#o8">is_active</a> = 0;
01555             }
01556           <span class="keywordflow">if</span> (<a class="code" href="group__vars.html#ga100">stp_check_string_parameter</a>(v, <span class="stringliteral">"ImageType"</span>, <a class="code" href="group__vars.html#gga135a32">STP_PARAMETER_ACTIVE</a>) &amp;&amp;
01557               strcmp(<a class="code" href="group__vars.html#ga36">stp_get_string_parameter</a>(v, <span class="stringliteral">"ImageType"</span>), <span class="stringliteral">"None"</span>) != 0 &amp;&amp;
01558               description-&gt;<a class="code" href="structstp__parameter__t.html#o6">p_level</a> &gt; <a class="code" href="group__vars.html#gga134a21">STP_PARAMETER_LEVEL_BASIC</a>)
01559             description-&gt;<a class="code" href="structstp__parameter__t.html#o8">is_active</a> = 0;
01560           <span class="keywordflow">else</span> <span class="keywordflow">if</span> (param-&gt;<a class="code" href="structcurve__param__t.html#o3">hsl_only</a>)
01561             {
01562               <span class="keyword">const</span> <a class="code" href="structcolor__correction__t.html">color_correction_t</a> *correction =
01563                 (<a class="code" href="print-color_8c.html#a30">get_color_correction</a>
01564                  (<a class="code" href="group__vars.html#ga36">stp_get_string_parameter</a> (v, <span class="stringliteral">"ColorCorrection"</span>)));
01565               <span class="keywordflow">if</span> (correction &amp;&amp; !correction-&gt;<a class="code" href="structcolor__correction__t.html#o3">correct_hsl</a>)
01566                 description-&gt;<a class="code" href="structstp__parameter__t.html#o8">is_active</a> = 0;
01567             }
01568           <span class="keywordflow">switch</span> (param-&gt;<a class="code" href="structcurve__param__t.html#o0">param</a>.<a class="code" href="structstp__parameter__t.html#o4">p_type</a>)
01569             {
01570             <span class="keywordflow">case</span> <a class="code" href="group__vars.html#gga132a11">STP_PARAMETER_TYPE_CURVE</a>:
01571               description-&gt;<a class="code" href="structstp__parameter__t.html#o26">deflt</a>.curve = *(param-&gt;<a class="code" href="structcurve__param__t.html#o1">defval</a>);
01572               description-&gt;<a class="code" href="structstp__parameter__t.html#o18">bounds</a>.curve =
01573                 <a class="code" href="group__curve.html#ga24">stp_curve_create_copy</a>(*(param-&gt;<a class="code" href="structcurve__param__t.html#o1">defval</a>));
01574               <span class="keywordflow">break</span>;
01575             <span class="keywordflow">default</span>:
01576               <span class="keywordflow">break</span>;
01577             }
01578           <span class="keywordflow">return</span>;
01579         }
01580     }
01581 }
01582 
01583 
<a name="l01584"></a><a class="code" href="print-color_8c.html#a24">01584</a> <span class="keyword">static</span> <span class="keyword">const</span> <a class="code" href="structstp__colorfuncs__t.html">stp_colorfuncs_t</a> <a class="code" href="print-color_8c.html#a24">stpi_color_traditional_colorfuncs</a> =
01585 {
01586   &amp;<a class="code" href="print-color_8c.html#a49">stpi_color_traditional_init</a>,
01587   &amp;<a class="code" href="print-color_8c.html#a33">stpi_color_traditional_get_row</a>,
01588   &amp;<a class="code" href="print-color_8c.html#a51">stpi_color_traditional_list_parameters</a>,
01589   &amp;<a class="code" href="print-color_8c.html#a52">stpi_color_traditional_describe_parameter</a>
01590 };
01591 
<a name="l01592"></a><a class="code" href="print-color_8c.html#a25">01592</a> <span class="keyword">static</span> <span class="keyword">const</span> <a class="code" href="structstp__color.html">stp_color_t</a> <a class="code" href="print-color_8c.html#a25">stpi_color_traditional_module_data</a> =
01593   {
01594     <span class="stringliteral">"traditional"</span>,
01595     <a class="code" href="group__intl__internal.html#ga6">N_</a>(<span class="stringliteral">"Traditional Gimp-Print color conversion"</span>),
01596     &amp;<a class="code" href="print-color_8c.html#a24">stpi_color_traditional_colorfuncs</a>
01597   };
01598 
01599 
01600 <span class="keyword">static</span> <span class="keywordtype">int</span>
<a name="l01601"></a><a class="code" href="print-color_8c.html#a53">01601</a> <a class="code" href="print-color_8c.html#a53">color_traditional_module_init</a>(<span class="keywordtype">void</span>)
01602 {
01603   <span class="keywordflow">return</span> <a class="code" href="group__color.html#ga17">stp_color_register</a>(&amp;<a class="code" href="print-color_8c.html#a25">stpi_color_traditional_module_data</a>);
01604 }
01605 
01606 
01607 <span class="keyword">static</span> <span class="keywordtype">int</span>
<a name="l01608"></a><a class="code" href="print-color_8c.html#a54">01608</a> <a class="code" href="print-color_8c.html#a54">color_traditional_module_exit</a>(<span class="keywordtype">void</span>)
01609 {
01610   <span class="keywordflow">return</span> <a class="code" href="group__color.html#ga18">stp_color_unregister</a>(&amp;<a class="code" href="print-color_8c.html#a25">stpi_color_traditional_module_data</a>);
01611 }
01612 
01613 
01614 <span class="comment">/* Module header */</span>
<a name="l01615"></a><a class="code" href="print-color_8c.html#a2">01615</a> <span class="preprocessor">#define stp_module_version color_traditional_LTX_stp_module_version</span>
<a name="l01616"></a><a class="code" href="print-color_8c.html#a3">01616</a> <span class="preprocessor"></span><span class="preprocessor">#define stp_module_data color_traditional_LTX_stp_module_data</span>
01617 <span class="preprocessor"></span>
<a name="l01618"></a><a class="code" href="print-color_8c.html#a26">01618</a> <a class="code" href="structstp__module__version.html">stp_module_version_t</a> <a class="code" href="structstp__module__version.html">stp_module_version</a> = {0, 0};
01619 
<a name="l01620"></a><a class="code" href="print-color_8c.html#a27">01620</a> <a class="code" href="structstp__module.html">stp_module_t</a> <a class="code" href="print-canon_8c.html#a45">stp_module_data</a> =
01621   {
01622     <span class="stringliteral">"traditional"</span>,
01623     VERSION,
01624     <span class="stringliteral">"Traditional Gimp-Print color conversion"</span>,
01625     <a class="code" href="module_8h.html#a13a5">STP_MODULE_CLASS_COLOR</a>,
01626     NULL,
01627     <a class="code" href="print-color_8c.html#a53">color_traditional_module_init</a>,
01628     <a class="code" href="print-color_8c.html#a54">color_traditional_module_exit</a>,
01629     (<span class="keywordtype">void</span> *) &amp;<a class="code" href="print-color_8c.html#a25">stpi_color_traditional_module_data</a>
01630   };
</pre></div><hr size="1"><address style="align: right;"><small>Generated on Wed Aug 25 07:56:14 2004 for libgimpprint API Reference by
<a href="http://www.doxygen.org/index.html">
<img src="doxygen.png" alt="doxygen" align="middle" border=0 > </a>1.3.6 </small></address>
</body>
</html>
