<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html><head><meta http-equiv="Content-Type" content="text/html;charset=iso-8859-1">
<title>libgimpprint API Reference: src/main/print-papers.c Source File</title>
<link href="doxygen.css" rel="stylesheet" type="text/css">
</head><body>
<!-- Generated by Doxygen 1.3.6 -->
<div class="qindex"><a class="qindex" href="index.html">Main&nbsp;Page</a> | <a class="qindex" href="modules.html">Modules</a> | <a class="qindex" href="classes.html">Alphabetical&nbsp;List</a> | <a class="qindex" href="annotated.html">Data&nbsp;Structures</a> | <a class="qindex" href="files.html">File&nbsp;List</a> | <a class="qindex" href="functions.html">Data&nbsp;Fields</a> | <a class="qindex" href="globals.html">Globals</a> | <a class="qindex" href="pages.html">Related&nbsp;Pages</a></div>
<h1>src/main/print-papers.c</h1><a href="print-papers_8c.html">Go to the documentation of this file.</a><div class="fragment"><pre>00001 <span class="comment">/*</span>
00002 <span class="comment"> * "$Id: print-papers_8c-source.html,v 1.1.1.2 2004/12/22 23:49:09 jlovell Exp $"</span>
00003 <span class="comment"> *</span>
00004 <span class="comment"> *   Print plug-in driver utility functions for the GIMP.</span>
00005 <span class="comment"> *</span>
00006 <span class="comment"> *   Copyright 1997-2000 Michael Sweet (mike@easysw.com) and</span>
00007 <span class="comment"> *      Robert Krawitz (rlk@alum.mit.edu)</span>
00008 <span class="comment"> *</span>
00009 <span class="comment"> *   This program is free software; you can redistribute it and/or modify it</span>
00010 <span class="comment"> *   under the terms of the GNU General Public License as published by the Free</span>
00011 <span class="comment"> *   Software Foundation; either version 2 of the License, or (at your option)</span>
00012 <span class="comment"> *   any later version.</span>
00013 <span class="comment"> *</span>
00014 <span class="comment"> *   This program is distributed in the hope that it will be useful, but</span>
00015 <span class="comment"> *   WITHOUT ANY WARRANTY; without even the implied warranty of MERCHANTABILITY</span>
00016 <span class="comment"> *   or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU General Public License</span>
00017 <span class="comment"> *   for more details.</span>
00018 <span class="comment"> *</span>
00019 <span class="comment"> *   You should have received a copy of the GNU General Public License</span>
00020 <span class="comment"> *   along with this program; if not, write to the Free Software</span>
00021 <span class="comment"> *   Foundation, Inc., 59 Temple Place - Suite 330, Boston, MA 02111-1307, USA.</span>
00022 <span class="comment"> */</span>
00023 
00024 <span class="comment">/*</span>
00025 <span class="comment"> * This file must include only standard C header files.  The core code must</span>
00026 <span class="comment"> * compile on generic platforms that don't support glib, gimp, gtk, etc.</span>
00027 <span class="comment"> */</span>
00028 
00029 <span class="preprocessor">#ifdef HAVE_CONFIG_H</span>
00030 <span class="preprocessor"></span><span class="preprocessor">#include &lt;config.h&gt;</span>
00031 <span class="preprocessor">#endif</span>
00032 <span class="preprocessor"></span><span class="preprocessor">#include &lt;<a class="code" href="gimp-print_8h.html">gimp-print/gimp-print.h</a>&gt;</span>
00033 <span class="preprocessor">#include "<a class="code" href="gimp-print-internal_8h.html">gimp-print-internal.h</a>"</span>
00034 <span class="preprocessor">#include &lt;<a class="code" href="gimp-print-intl-internal_8h.html">gimp-print/gimp-print-intl-internal.h</a>&gt;</span>
00035 <span class="preprocessor">#include &lt;math.h&gt;</span>
00036 <span class="preprocessor">#ifdef HAVE_LIMITS_H</span>
00037 <span class="preprocessor"></span><span class="preprocessor">#include &lt;limits.h&gt;</span>
00038 <span class="preprocessor">#endif</span>
00039 <span class="preprocessor"></span><span class="preprocessor">#include &lt;string.h&gt;</span>
00040 <span class="preprocessor">#include &lt;stdlib.h&gt;</span>
00041 
<a name="l00042"></a><a class="code" href="print-papers_8c.html#a0">00042</a> <span class="keyword">static</span> <a class="code" href="structstp__list.html">stp_list_t</a> *<a class="code" href="print-papers_8c.html#a0">paper_list</a> = NULL;
00043 
00044 <span class="keyword">static</span> <span class="keywordtype">void</span>
<a name="l00045"></a><a class="code" href="print-papers_8c.html#a1">00045</a> <a class="code" href="print-papers_8c.html#a1">stpi_paper_freefunc</a>(<span class="keywordtype">void</span> *item)
00046 {
00047   <a class="code" href="structstp__papersize__t.html">stp_papersize_t</a> *paper = (<a class="code" href="structstp__papersize__t.html">stp_papersize_t</a> *) (item);
00048   <a class="code" href="group__util.html#ga52">STP_SAFE_FREE</a>(paper-&gt;<a class="code" href="structstp__papersize__t.html#o0">name</a>);
00049   <a class="code" href="group__util.html#ga52">STP_SAFE_FREE</a>(paper-&gt;<a class="code" href="structstp__papersize__t.html#o1">text</a>);
00050   <a class="code" href="group__util.html#ga52">STP_SAFE_FREE</a>(paper-&gt;<a class="code" href="structstp__papersize__t.html#o2">comment</a>);
00051   <a class="code" href="group__util.html#ga52">STP_SAFE_FREE</a>(paper);
00052 }
00053 
00054 <span class="keyword">static</span> <span class="keyword">const</span> <span class="keywordtype">char</span> *
<a name="l00055"></a><a class="code" href="print-papers_8c.html#a2">00055</a> <a class="code" href="print-papers_8c.html#a2">stpi_paper_namefunc</a>(<span class="keyword">const</span> <span class="keywordtype">void</span> *item)
00056 {
00057   <span class="keyword">const</span> <a class="code" href="structstp__papersize__t.html">stp_papersize_t</a> *paper = (<span class="keyword">const</span> <a class="code" href="structstp__papersize__t.html">stp_papersize_t</a> *) (item);
00058   <span class="keywordflow">return</span> paper-&gt;<a class="code" href="structstp__papersize__t.html#o0">name</a>;
00059 }
00060 
00061 <span class="keyword">static</span> <span class="keyword">const</span> <span class="keywordtype">char</span> *
<a name="l00062"></a><a class="code" href="print-papers_8c.html#a3">00062</a> <a class="code" href="print-papers_8c.html#a3">stpi_paper_long_namefunc</a>(<span class="keyword">const</span> <span class="keywordtype">void</span> *item)
00063 {
00064   <span class="keyword">const</span> <a class="code" href="structstp__papersize__t.html">stp_papersize_t</a> *paper = (<span class="keyword">const</span> <a class="code" href="structstp__papersize__t.html">stp_papersize_t</a> *) (item);
00065   <span class="keywordflow">return</span> paper-&gt;<a class="code" href="structstp__papersize__t.html#o1">text</a>;
00066 }
00067 
00068 <span class="keyword">static</span> <span class="keywordtype">int</span>
<a name="l00069"></a><a class="code" href="print-papers_8c.html#a4">00069</a> <a class="code" href="print-papers_8c.html#a4">stpi_paper_list_init</a>(<span class="keywordtype">void</span>)
00070 {
00071   <span class="keywordflow">if</span> (<a class="code" href="print-papers_8c.html#a0">paper_list</a>)
00072     <a class="code" href="print-list_8c.html#a10">stp_list_destroy</a>(<a class="code" href="print-papers_8c.html#a0">paper_list</a>);
00073   <a class="code" href="print-papers_8c.html#a0">paper_list</a> = <a class="code" href="list_8h.html#a7">stp_list_create</a>();
00074   <a class="code" href="print-list_8c.html#a19">stp_list_set_freefunc</a>(<a class="code" href="print-papers_8c.html#a0">paper_list</a>, <a class="code" href="print-papers_8c.html#a1">stpi_paper_freefunc</a>);
00075   <a class="code" href="print-list_8c.html#a23">stp_list_set_namefunc</a>(<a class="code" href="print-papers_8c.html#a0">paper_list</a>, <a class="code" href="print-papers_8c.html#a2">stpi_paper_namefunc</a>);
00076   <a class="code" href="print-list_8c.html#a25">stp_list_set_long_namefunc</a>(<a class="code" href="print-papers_8c.html#a0">paper_list</a>, <a class="code" href="print-papers_8c.html#a3">stpi_paper_long_namefunc</a>);
00077   <span class="comment">/* stp_list_set_sortfunc(stpi_paper_sortfunc); */</span>
00078 
00079   <span class="keywordflow">return</span> 0;
00080 }
00081 
00082 <span class="keyword">static</span> <span class="keyword">inline</span> <span class="keywordtype">void</span>
<a name="l00083"></a><a class="code" href="print-papers_8c.html#a5">00083</a> <a class="code" href="print-papers_8c.html#a5">check_paperlist</a>(<span class="keywordtype">void</span>)
00084 {
00085   <span class="keywordflow">if</span> (<a class="code" href="print-papers_8c.html#a0">paper_list</a> == NULL)
00086     {
00087       <a class="code" href="xml_8c.html#a18">stp_xml_parse_file_named</a>(<span class="stringliteral">"papers.xml"</span>);
00088       <span class="keywordflow">if</span> (<a class="code" href="print-papers_8c.html#a0">paper_list</a> == NULL)
00089         {
00090           <a class="code" href="print-util_8c.html#a20">stp_erprintf</a>(<span class="stringliteral">"No papers found: is STP_MODULE_PATH correct?\n"</span>);
00091           <a class="code" href="print-papers_8c.html#a4">stpi_paper_list_init</a>();
00092         }
00093     }
00094 }
00095 
00096 <span class="keyword">static</span> <span class="keywordtype">int</span>
<a name="l00097"></a><a class="code" href="print-papers_8c.html#a6">00097</a> <a class="code" href="print-papers_8c.html#a6">stpi_paper_create</a>(<a class="code" href="structstp__papersize__t.html">stp_papersize_t</a> *p)
00098 {
00099   <a class="code" href="structstp__list__item.html">stp_list_item_t</a> *paper_item;
00100 
00101   <span class="keywordflow">if</span> (<a class="code" href="print-papers_8c.html#a0">paper_list</a> == NULL)
00102     {
00103       <a class="code" href="print-papers_8c.html#a4">stpi_paper_list_init</a>();
00104       <a class="code" href="print-util_8c.html#a24">stp_deprintf</a>(<a class="code" href="group__util.html#ga45">STP_DBG_PAPER</a>,
00105                    <span class="stringliteral">"stpi_paper_create(): initialising paper_list...\n"</span>);
00106     }
00107 
00108   <span class="comment">/* Check the paper does not already exist */</span>
00109   paper_item = <a class="code" href="print-list_8c.html#a12">stp_list_get_start</a>(<a class="code" href="print-papers_8c.html#a0">paper_list</a>);
00110   <span class="keywordflow">while</span> (paper_item)
00111     {
00112       <span class="keyword">const</span> <a class="code" href="structstp__papersize__t.html">stp_papersize_t</a> *ep =
00113         (<span class="keyword">const</span> <a class="code" href="structstp__papersize__t.html">stp_papersize_t</a> *) <a class="code" href="print-list_8c.html#a33">stp_list_item_get_data</a>(paper_item);
00114       <span class="keywordflow">if</span> (ep &amp;&amp; !strcmp(p-&gt;<a class="code" href="structstp__papersize__t.html#o0">name</a>, ep-&gt;<a class="code" href="structstp__papersize__t.html#o0">name</a>))
00115         {
00116           <a class="code" href="print-papers_8c.html#a1">stpi_paper_freefunc</a>(p);
00117           <span class="keywordflow">return</span> 1;
00118         }
00119       paper_item = <a class="code" href="print-list_8c.html#a32">stp_list_item_next</a>(paper_item);
00120     }
00121 
00122   <span class="comment">/* Add paper to list */</span>
00123   <a class="code" href="print-list_8c.html#a29">stp_list_item_create</a>(<a class="code" href="print-papers_8c.html#a0">paper_list</a>, NULL, (<span class="keywordtype">void</span> *) p);
00124 
00125   <span class="keywordflow">return</span> 0;
00126 }
00127 
00128 <span class="keyword">static</span> <span class="keywordtype">int</span>
<a name="l00129"></a><a class="code" href="print-papers_8c.html#a7">00129</a> <a class="code" href="print-papers_8c.html#a7">stpi_paper_destroy</a>(<a class="code" href="structstp__papersize__t.html">stp_papersize_t</a> *p)
00130 {
00131   <a class="code" href="structstp__list__item.html">stp_list_item_t</a> *paper_item;
00132   <a class="code" href="print-papers_8c.html#a5">check_paperlist</a>();
00133 
00134   <span class="comment">/* Check if paper exists */</span>
00135   paper_item = <a class="code" href="print-list_8c.html#a12">stp_list_get_start</a>(<a class="code" href="print-papers_8c.html#a0">paper_list</a>);
00136   <span class="keywordflow">while</span> (paper_item)
00137     {
00138       <span class="keyword">const</span> <a class="code" href="structstp__papersize__t.html">stp_papersize_t</a> *ep = (<span class="keyword">const</span> <a class="code" href="structstp__papersize__t.html">stp_papersize_t</a> *)
00139         <a class="code" href="print-list_8c.html#a33">stp_list_item_get_data</a>(paper_item);
00140       <span class="keywordflow">if</span> (ep &amp;&amp; !strcmp(p-&gt;<a class="code" href="structstp__papersize__t.html#o0">name</a>, ep-&gt;<a class="code" href="structstp__papersize__t.html#o0">name</a>))
00141         {
00142           <a class="code" href="print-list_8c.html#a30">stp_list_item_destroy</a> (<a class="code" href="print-papers_8c.html#a0">paper_list</a>, paper_item);
00143           <span class="keywordflow">return</span> 0;
00144         }
00145       paper_item = <a class="code" href="print-list_8c.html#a32">stp_list_item_next</a>(paper_item);
00146     }
00147   <span class="comment">/* Paper did not exist */</span>
00148   <span class="keywordflow">return</span> 1;
00149 }
00150 
00151 
00152 <span class="keywordtype">int</span>
<a name="l00153"></a><a class="code" href="group__papersize.html#ga8">00153</a> <a class="code" href="group__papersize.html#ga0">stp_known_papersizes</a>(<span class="keywordtype">void</span>)
00154 {
00155   <a class="code" href="print-papers_8c.html#a5">check_paperlist</a>();
00156   <span class="keywordflow">return</span> <a class="code" href="print-list_8c.html#a11">stp_list_get_length</a>(<a class="code" href="print-papers_8c.html#a0">paper_list</a>);
00157 }
00158 
00159 <span class="keyword">const</span> <a class="code" href="structstp__papersize__t.html">stp_papersize_t</a> *
<a name="l00160"></a><a class="code" href="group__papersize.html#ga9">00160</a> <a class="code" href="group__papersize.html#ga9">stp_get_papersize_by_name</a>(<span class="keyword">const</span> <span class="keywordtype">char</span> *name)
00161 {
00162   <a class="code" href="structstp__list__item.html">stp_list_item_t</a> *paper;
00163 
00164   <a class="code" href="print-papers_8c.html#a5">check_paperlist</a>();
00165   paper = <a class="code" href="print-list_8c.html#a16">stp_list_get_item_by_name</a>(<a class="code" href="print-papers_8c.html#a0">paper_list</a>, name);
00166   <span class="keywordflow">if</span> (!paper)
00167     <span class="keywordflow">return</span> NULL;
00168   <span class="keywordflow">else</span>
00169     <span class="keywordflow">return</span> (<span class="keyword">const</span> <a class="code" href="structstp__papersize__t.html">stp_papersize_t</a> *) <a class="code" href="print-list_8c.html#a33">stp_list_item_get_data</a>(paper);
00170 }
00171 
00172 <span class="keyword">const</span> <a class="code" href="structstp__papersize__t.html">stp_papersize_t</a> *
<a name="l00173"></a><a class="code" href="group__papersize.html#ga10">00173</a> <a class="code" href="group__papersize.html#ga10">stp_get_papersize_by_index</a>(<span class="keywordtype">int</span> idx)
00174 {
00175   <a class="code" href="structstp__list__item.html">stp_list_item_t</a> *paper;
00176 
00177   <a class="code" href="print-papers_8c.html#a5">check_paperlist</a>();
00178   paper = <a class="code" href="print-list_8c.html#a14">stp_list_get_item_by_index</a>(<a class="code" href="print-papers_8c.html#a0">paper_list</a>, idx);
00179   <span class="keywordflow">if</span> (!paper)
00180     <span class="keywordflow">return</span> NULL;
00181   <span class="keywordflow">else</span>
00182     <span class="keywordflow">return</span> (<span class="keyword">const</span> <a class="code" href="structstp__papersize__t.html">stp_papersize_t</a> *) <a class="code" href="print-list_8c.html#a33">stp_list_item_get_data</a>(paper);
00183 }
00184 
00185 <span class="keyword">static</span> <span class="keywordtype">int</span>
<a name="l00186"></a><a class="code" href="print-papers_8c.html#a11">00186</a> <a class="code" href="print-papers_8c.html#a11">paper_size_mismatch</a>(<span class="keywordtype">int</span> l, <span class="keywordtype">int</span> w, <span class="keyword">const</span> <a class="code" href="structstp__papersize__t.html">stp_papersize_t</a> *val)
00187 {
00188   <span class="keywordtype">int</span> hdiff = abs(l - (<span class="keywordtype">int</span>) val-&gt;<a class="code" href="structstp__papersize__t.html#o4">height</a>);
00189   <span class="keywordtype">int</span> vdiff = abs(w - (<span class="keywordtype">int</span>) val-&gt;<a class="code" href="structstp__papersize__t.html#o3">width</a>);
00190   <span class="keywordflow">return</span> hdiff + vdiff;
00191 }
00192 
00193 <span class="keyword">const</span> <a class="code" href="structstp__papersize__t.html">stp_papersize_t</a> *
<a name="l00194"></a><a class="code" href="group__papersize.html#ga12">00194</a> <a class="code" href="group__papersize.html#ga12">stp_get_papersize_by_size</a>(<span class="keywordtype">int</span> l, <span class="keywordtype">int</span> w)
00195 {
00196   <span class="keywordtype">int</span> score = INT_MAX;
00197   <span class="keyword">const</span> <a class="code" href="structstp__papersize__t.html">stp_papersize_t</a> *ref = NULL;
00198   <span class="keyword">const</span> <a class="code" href="structstp__papersize__t.html">stp_papersize_t</a> *val = NULL;
00199   <span class="keywordtype">int</span> i;
00200   <span class="keywordtype">int</span> sizes = <a class="code" href="group__papersize.html#ga0">stp_known_papersizes</a>();
00201   <span class="keywordflow">for</span> (i = 0; i &lt; sizes; i++)
00202     {
00203       val = <a class="code" href="group__papersize.html#ga10">stp_get_papersize_by_index</a>(i);
00204 
00205       <span class="keywordflow">if</span> (val-&gt;<a class="code" href="structstp__papersize__t.html#o3">width</a> == w &amp;&amp; val-&gt;<a class="code" href="structstp__papersize__t.html#o4">height</a> == l)
00206         <span class="keywordflow">return</span> val;
00207       <span class="keywordflow">else</span>
00208         {
00209           <span class="keywordtype">int</span> myscore = <a class="code" href="print-papers_8c.html#a11">paper_size_mismatch</a>(l, w, val);
00210           <span class="keywordflow">if</span> (myscore &lt; score &amp;&amp; myscore &lt; 20)
00211             {
00212               ref = val;
00213               score = myscore;
00214             }
00215         }
00216     }
00217   <span class="keywordflow">return</span> ref;
00218 }
00219 
00220 <span class="keywordtype">void</span>
<a name="l00221"></a><a class="code" href="group__papersize.html#ga13">00221</a> <a class="code" href="group__papersize.html#ga13">stp_default_media_size</a>(<span class="keyword">const</span> <a class="code" href="structstp__vars.html">stp_vars_t</a> *v,     <span class="comment">/* I */</span>
00222                        <span class="keywordtype">int</span>  *width,             <span class="comment">/* O - Width in points */</span>
00223                        <span class="keywordtype">int</span>  *height)            <span class="comment">/* O - Height in points */</span>
00224 {
00225   <span class="keywordflow">if</span> (<a class="code" href="group__vars.html#ga26">stp_get_page_width</a>(v) &gt; 0 &amp;&amp; <a class="code" href="group__vars.html#ga28">stp_get_page_height</a>(v) &gt; 0)
00226     {
00227       *width = <a class="code" href="group__vars.html#ga26">stp_get_page_width</a>(v);
00228       *height = <a class="code" href="group__vars.html#ga28">stp_get_page_height</a>(v);
00229     }
00230   <span class="keywordflow">else</span>
00231     {
00232       <span class="keyword">const</span> <span class="keywordtype">char</span> *page_size = <a class="code" href="group__vars.html#ga36">stp_get_string_parameter</a>(v, <span class="stringliteral">"PageSize"</span>);
00233       <span class="keyword">const</span> <a class="code" href="structstp__papersize__t.html">stp_papersize_t</a> *papersize = NULL;
00234       <span class="keywordflow">if</span> (page_size)
00235         papersize = <a class="code" href="group__papersize.html#ga9">stp_get_papersize_by_name</a>(page_size);
00236       <span class="keywordflow">if</span> (!papersize)
00237         {
00238           *width = 1;
00239           *height = 1;
00240         }
00241       <span class="keywordflow">else</span>
00242         {
00243           *width = papersize-&gt;<a class="code" href="structstp__papersize__t.html#o3">width</a>;
00244           *height = papersize-&gt;<a class="code" href="structstp__papersize__t.html#o4">height</a>;
00245         }
00246       <span class="keywordflow">if</span> (*width == 0)
00247         *width = 612;
00248       <span class="keywordflow">if</span> (*height == 0)
00249         *height = 792;
00250     }
00251 }
00252 
00253 <span class="comment">/*</span>
00254 <span class="comment"> * Process the &lt;paper&gt; node.</span>
00255 <span class="comment"> */</span>
00256 <span class="keyword">static</span> <a class="code" href="structstp__papersize__t.html">stp_papersize_t</a> *
<a name="l00257"></a><a class="code" href="print-papers_8c.html#a14">00257</a> <a class="code" href="print-papers_8c.html#a14">stp_xml_process_paper</a>(<a class="code" href="structstp__mxml__node__s.html">stp_mxml_node_t</a> *paper) <span class="comment">/* The paper node */</span>
00258 {
00259   <a class="code" href="structstp__mxml__node__s.html">stp_mxml_node_t</a> *prop;                              <span class="comment">/* Temporary node pointer */</span>
00260   <span class="keyword">const</span> <span class="keywordtype">char</span> *stmp;                                <span class="comment">/* Temporary string */</span>
00261   <span class="comment">/* props[] (unused) is the correct tag sequence */</span>
00262   <span class="comment">/*  const char *props[] =</span>
00263 <span class="comment">    {</span>
00264 <span class="comment">      "name",</span>
00265 <span class="comment">      "description",</span>
00266 <span class="comment">      "width",</span>
00267 <span class="comment">      "height",</span>
00268 <span class="comment">      "left",</span>
00269 <span class="comment">      "right",</span>
00270 <span class="comment">      "bottom",</span>
00271 <span class="comment">      "top",</span>
00272 <span class="comment">      "unit",</span>
00273 <span class="comment">      NULL</span>
00274 <span class="comment">      };*/</span>
00275   <a class="code" href="structstp__papersize__t.html">stp_papersize_t</a> *outpaper;   <span class="comment">/* Generated paper */</span>
00276   <span class="keywordtype">int</span>
00277     <span class="keywordtype">id</span> = 0,                     <span class="comment">/* Check id is present */</span>
00278     name = 0,                   <span class="comment">/* Check name is present */</span>
00279     height = 0,                 <span class="comment">/* Check height is present */</span>
00280     width = 0,                  <span class="comment">/* Check width is present */</span>
00281     left = 0,                   <span class="comment">/* Check left is present */</span>
00282     right = 0,                  <span class="comment">/* Check right is present */</span>
00283     bottom = 0,                 <span class="comment">/* Check bottom is present */</span>
00284     top = 0,                    <span class="comment">/* Check top is present */</span>
00285     unit = 0;                   <span class="comment">/* Check unit is present */</span>
00286 
00287   <span class="keywordflow">if</span> (<a class="code" href="group__util.html#ga19">stp_get_debug_level</a>() &amp; <a class="code" href="group__util.html#ga47">STP_DBG_XML</a>)
00288     {
00289       stmp = <a class="code" href="mxml-attr_8c.html#a0">stp_mxmlElementGetAttr</a>(paper, (<span class="keyword">const</span> <span class="keywordtype">char</span>*) <span class="stringliteral">"name"</span>);
00290       <a class="code" href="print-util_8c.html#a20">stp_erprintf</a>(<span class="stringliteral">"stp_xml_process_paper: name: %s\n"</span>, stmp);
00291     }
00292 
00293   outpaper = <a class="code" href="group__util.html#ga29">stp_zalloc</a>(<span class="keyword">sizeof</span>(<a class="code" href="structstp__papersize__t.html">stp_papersize_t</a>));
00294   <span class="keywordflow">if</span> (!outpaper)
00295     <span class="keywordflow">return</span> NULL;
00296 
00297   outpaper-&gt;<a class="code" href="structstp__papersize__t.html#o0">name</a> = <a class="code" href="group__util.html#ga35">stp_strdup</a>(<a class="code" href="mxml-attr_8c.html#a0">stp_mxmlElementGetAttr</a>(paper, <span class="stringliteral">"name"</span>));
00298 
00299   outpaper-&gt;<a class="code" href="structstp__papersize__t.html#o5">top</a> = 0;
00300   outpaper-&gt;<a class="code" href="structstp__papersize__t.html#o6">left</a> = 0;
00301   outpaper-&gt;<a class="code" href="structstp__papersize__t.html#o7">bottom</a> = 0;
00302   outpaper-&gt;<a class="code" href="structstp__papersize__t.html#o8">right</a> = 0;
00303   <span class="keywordflow">if</span> (outpaper-&gt;<a class="code" href="structstp__papersize__t.html#o0">name</a>)
00304     <span class="keywordtype">id</span> = 1;
00305 
00306   prop = paper-&gt;<a class="code" href="structstp__mxml__node__s.html#o4">child</a>;
00307   <span class="keywordflow">while</span>(prop)
00308     {
00309       <span class="keywordflow">if</span> (prop-&gt;<a class="code" href="structstp__mxml__node__s.html#o0">type</a> == <a class="code" href="mxml_8h.html#a43a20">STP_MXML_ELEMENT</a>)
00310         {
00311           <span class="keyword">const</span> <span class="keywordtype">char</span> *prop_name = prop-&gt;<a class="code" href="structstp__mxml__node__s.html#o6">value</a>.<a class="code" href="unionstp__mxml__value__u.html#o0">element</a>.<a class="code" href="structstp__mxml__value__s.html#o0">name</a>;
00312       
00313           <span class="keywordflow">if</span> (!strcmp(prop_name, <span class="stringliteral">"description"</span>))
00314             {
00315               outpaper-&gt;<a class="code" href="structstp__papersize__t.html#o1">text</a> = <a class="code" href="group__util.html#ga35">stp_strdup</a>(<a class="code" href="mxml-attr_8c.html#a0">stp_mxmlElementGetAttr</a>(prop, <span class="stringliteral">"value"</span>));
00316               name = 1;
00317             }
00318           <span class="keywordflow">if</span> (!strcmp(prop_name, <span class="stringliteral">"comment"</span>))
00319             outpaper-&gt;<a class="code" href="structstp__papersize__t.html#o2">comment</a> = <a class="code" href="group__util.html#ga35">stp_strdup</a>(<a class="code" href="mxml-attr_8c.html#a0">stp_mxmlElementGetAttr</a>(prop, <span class="stringliteral">"value"</span>));
00320           <span class="keywordflow">if</span> (!strcmp(prop_name, <span class="stringliteral">"width"</span>))
00321             {
00322               stmp = <a class="code" href="mxml-attr_8c.html#a0">stp_mxmlElementGetAttr</a>(prop, <span class="stringliteral">"value"</span>);
00323               <span class="keywordflow">if</span> (stmp)
00324                 {
00325                   outpaper-&gt;<a class="code" href="structstp__papersize__t.html#o3">width</a> = <a class="code" href="xml_8c.html#a22">stp_xmlstrtoul</a>(stmp);
00326                   width = 1;
00327                 }
00328             }
00329           <span class="keywordflow">if</span> (!strcmp(prop_name, <span class="stringliteral">"height"</span>))
00330             {
00331               stmp = <a class="code" href="mxml-attr_8c.html#a0">stp_mxmlElementGetAttr</a>(prop, <span class="stringliteral">"value"</span>);
00332               <span class="keywordflow">if</span> (stmp)
00333                 {
00334                   outpaper-&gt;<a class="code" href="structstp__papersize__t.html#o4">height</a> = <a class="code" href="xml_8c.html#a22">stp_xmlstrtoul</a>(stmp);
00335                   height = 1;
00336                 }
00337             }
00338           <span class="keywordflow">if</span> (!strcmp(prop_name, <span class="stringliteral">"left"</span>))
00339             {
00340               stmp = <a class="code" href="mxml-attr_8c.html#a0">stp_mxmlElementGetAttr</a>(prop, <span class="stringliteral">"value"</span>);
00341               outpaper-&gt;<a class="code" href="structstp__papersize__t.html#o6">left</a> = <a class="code" href="xml_8c.html#a22">stp_xmlstrtoul</a>(stmp);
00342               left = 1;
00343             }
00344           <span class="keywordflow">if</span> (!strcmp(prop_name, <span class="stringliteral">"right"</span>))
00345             {
00346               stmp = <a class="code" href="mxml-attr_8c.html#a0">stp_mxmlElementGetAttr</a>(prop, <span class="stringliteral">"value"</span>);
00347               outpaper-&gt;<a class="code" href="structstp__papersize__t.html#o8">right</a> = <a class="code" href="xml_8c.html#a22">stp_xmlstrtoul</a>(stmp);
00348               right = 1;
00349             }
00350           <span class="keywordflow">if</span> (!strcmp(prop_name, <span class="stringliteral">"bottom"</span>))
00351             {
00352               stmp = <a class="code" href="mxml-attr_8c.html#a0">stp_mxmlElementGetAttr</a>(prop, <span class="stringliteral">"value"</span>);
00353               outpaper-&gt;<a class="code" href="structstp__papersize__t.html#o7">bottom</a> = <a class="code" href="xml_8c.html#a22">stp_xmlstrtoul</a>(stmp);
00354               bottom = 1;
00355             }
00356           <span class="keywordflow">if</span> (!strcmp(prop_name, <span class="stringliteral">"top"</span>))
00357             {
00358               stmp = <a class="code" href="mxml-attr_8c.html#a0">stp_mxmlElementGetAttr</a>(prop, <span class="stringliteral">"value"</span>);
00359               outpaper-&gt;<a class="code" href="structstp__papersize__t.html#o5">top</a> = <a class="code" href="xml_8c.html#a22">stp_xmlstrtoul</a>(stmp);
00360               top = 1;
00361             }
00362           <span class="keywordflow">if</span> (!strcmp(prop_name, <span class="stringliteral">"unit"</span>))
00363             {
00364               stmp = <a class="code" href="mxml-attr_8c.html#a0">stp_mxmlElementGetAttr</a>(prop, <span class="stringliteral">"value"</span>);
00365               <span class="keywordflow">if</span> (stmp)
00366                 {
00367                   <span class="keywordflow">if</span> (!strcmp(stmp, <span class="stringliteral">"english"</span>))
00368                     outpaper-&gt;<a class="code" href="structstp__papersize__t.html#o9">paper_unit</a> = <a class="code" href="group__papersize.html#gga5a0">PAPERSIZE_ENGLISH_STANDARD</a>;
00369                   <span class="keywordflow">else</span> <span class="keywordflow">if</span> (!strcmp(stmp, <span class="stringliteral">"english-extended"</span>))
00370                     outpaper-&gt;<a class="code" href="structstp__papersize__t.html#o9">paper_unit</a> = <a class="code" href="group__papersize.html#gga5a2">PAPERSIZE_ENGLISH_EXTENDED</a>;
00371                   <span class="keywordflow">else</span> <span class="keywordflow">if</span> (!strcmp(stmp, <span class="stringliteral">"metric"</span>))
00372                     outpaper-&gt;<a class="code" href="structstp__papersize__t.html#o9">paper_unit</a> = <a class="code" href="group__papersize.html#gga5a1">PAPERSIZE_METRIC_STANDARD</a>;
00373                   <span class="keywordflow">else</span> <span class="keywordflow">if</span> (!strcmp(stmp, <span class="stringliteral">"metric-extended"</span>))
00374                     outpaper-&gt;<a class="code" href="structstp__papersize__t.html#o9">paper_unit</a> = <a class="code" href="group__papersize.html#gga5a3">PAPERSIZE_METRIC_EXTENDED</a>;
00375                   <span class="comment">/* Default unit */</span>
00376                   <span class="keywordflow">else</span>
00377                     outpaper-&gt;<a class="code" href="structstp__papersize__t.html#o9">paper_unit</a> = <a class="code" href="group__papersize.html#gga5a3">PAPERSIZE_METRIC_EXTENDED</a>;
00378                   unit = 1;
00379                 }
00380             }
00381         }
00382       prop = prop-&gt;<a class="code" href="structstp__mxml__node__s.html#o1">next</a>;
00383     }
00384   <span class="keywordflow">if</span> (<span class="keywordtype">id</span> &amp;&amp; name &amp;&amp; width &amp;&amp; height &amp;&amp; unit) <span class="comment">/* Margins are optional */</span>
00385     <span class="keywordflow">return</span> outpaper;
00386   <a class="code" href="group__util.html#ga31">stp_free</a>(outpaper);
00387   outpaper = NULL;
00388   <span class="keywordflow">return</span> NULL;
00389 }
00390 
00391 <span class="comment">/*</span>
00392 <span class="comment"> * Parse the &lt;paperdef&gt; node.</span>
00393 <span class="comment"> */</span>
00394 <span class="keyword">static</span> <span class="keywordtype">int</span>
<a name="l00395"></a><a class="code" href="print-papers_8c.html#a15">00395</a> <a class="code" href="print-papers_8c.html#a15">stp_xml_process_paperdef</a>(<a class="code" href="structstp__mxml__node__s.html">stp_mxml_node_t</a> *paperdef, <span class="keyword">const</span> <span class="keywordtype">char</span> *file) <span class="comment">/* The paperdef node */</span>
00396 {
00397   <a class="code" href="structstp__mxml__node__s.html">stp_mxml_node_t</a> *paper;                           <span class="comment">/* paper node pointer */</span>
00398   <a class="code" href="structstp__papersize__t.html">stp_papersize_t</a> *outpaper;         <span class="comment">/* Generated paper */</span>
00399 
00400   paper = paperdef-&gt;<a class="code" href="structstp__mxml__node__s.html#o4">child</a>;
00401   <span class="keywordflow">while</span> (paper)
00402     {
00403       <span class="keywordflow">if</span> (paper-&gt;<a class="code" href="structstp__mxml__node__s.html#o0">type</a> == <a class="code" href="mxml_8h.html#a43a20">STP_MXML_ELEMENT</a>)
00404         {
00405           <span class="keyword">const</span> <span class="keywordtype">char</span> *paper_name = paper-&gt;<a class="code" href="structstp__mxml__node__s.html#o6">value</a>.<a class="code" href="unionstp__mxml__value__u.html#o0">element</a>.<a class="code" href="structstp__mxml__value__s.html#o0">name</a>;
00406           <span class="keywordflow">if</span> (!strcmp(paper_name, <span class="stringliteral">"paper"</span>))
00407             {
00408               outpaper = <a class="code" href="print-papers_8c.html#a14">stp_xml_process_paper</a>(paper);
00409               <span class="keywordflow">if</span> (outpaper)
00410                 <a class="code" href="print-papers_8c.html#a6">stpi_paper_create</a>(outpaper);
00411             }
00412         }
00413       paper = paper-&gt;<a class="code" href="structstp__mxml__node__s.html#o1">next</a>;
00414     }
00415   <span class="keywordflow">return</span> 1;
00416 }
00417 
00418 <span class="keywordtype">void</span>
<a name="l00419"></a><a class="code" href="group__util__internal.html#ga0">00419</a> <a class="code" href="group__util__internal.html#ga16">stpi_init_paper</a>(<span class="keywordtype">void</span>)
00420 {
00421   <a class="code" href="xml_8c.html#a10">stp_register_xml_parser</a>(<span class="stringliteral">"paperdef"</span>, <a class="code" href="print-papers_8c.html#a15">stp_xml_process_paperdef</a>);
00422 }
</pre></div><hr size="1"><address style="align: right;"><small>Generated on Wed Aug 25 07:56:14 2004 for libgimpprint API Reference by
<a href="http://www.doxygen.org/index.html">
<img src="doxygen.png" alt="doxygen" align="middle" border=0 > </a>1.3.6 </small></address>
</body>
</html>
