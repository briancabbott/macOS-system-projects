<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html><head><meta http-equiv="Content-Type" content="text/html;charset=iso-8859-1">
<title>libgimpprint API Reference: src/main/print-list.c Source File</title>
<link href="doxygen.css" rel="stylesheet" type="text/css">
</head><body>
<!-- Generated by Doxygen 1.3.6 -->
<div class="qindex"><a class="qindex" href="index.html">Main&nbsp;Page</a> | <a class="qindex" href="modules.html">Modules</a> | <a class="qindex" href="classes.html">Alphabetical&nbsp;List</a> | <a class="qindex" href="annotated.html">Data&nbsp;Structures</a> | <a class="qindex" href="files.html">File&nbsp;List</a> | <a class="qindex" href="functions.html">Data&nbsp;Fields</a> | <a class="qindex" href="globals.html">Globals</a> | <a class="qindex" href="pages.html">Related&nbsp;Pages</a></div>
<h1>src/main/print-list.c</h1><a href="print-list_8c.html">Go to the documentation of this file.</a><div class="fragment"><pre>00001 <span class="comment">/*</span>
00002 <span class="comment"> * "$Id: print-list_8c-source.html,v 1.1.1.2 2004/12/22 23:49:08 jlovell Exp $"</span>
00003 <span class="comment"> *</span>
00004 <span class="comment"> *   libgimpprint list functions.  A doubly-linked list</span>
00005 <span class="comment"> *   implementation, with callbacks for freeing, sorting, and</span>
00006 <span class="comment"> *   retrieving nodes by name or long name.</span>
00007 <span class="comment"> *</span>
00008 <span class="comment"> *   Copyright 2002 Roger Leigh (rleigh@debian.org)</span>
00009 <span class="comment"> *</span>
00010 <span class="comment"> *   This program is free software; you can redistribute it and/or modify it</span>
00011 <span class="comment"> *   under the terms of the GNU General Public License as published by the Free</span>
00012 <span class="comment"> *   Software Foundation; either version 2 of the License, or (at your option)</span>
00013 <span class="comment"> *   any later version.</span>
00014 <span class="comment"> *</span>
00015 <span class="comment"> *   This program is distributed in the hope that it will be useful, but</span>
00016 <span class="comment"> *   WITHOUT ANY WARRANTY; without even the implied warranty of MERCHANTABILITY</span>
00017 <span class="comment"> *   or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU General Public License</span>
00018 <span class="comment"> *   for more details.</span>
00019 <span class="comment"> *</span>
00020 <span class="comment"> *   You should have received a copy of the GNU General Public License</span>
00021 <span class="comment"> *   along with this program; if not, write to the Free Software</span>
00022 <span class="comment"> *   Foundation, Inc., 59 Temple Place - Suite 330, Boston, MA 02111-1307, USA.</span>
00023 <span class="comment"> */</span>
00024 
00025 <span class="comment">/*</span>
00026 <span class="comment"> * This file must include only standard C header files.  The core code must</span>
00027 <span class="comment"> * compile on generic platforms that don't support glib, gimp, gimpprint, etc.</span>
00028 <span class="comment"> */</span>
00029 
00030 
00031 <span class="preprocessor">#ifdef HAVE_CONFIG_H</span>
00032 <span class="preprocessor"></span><span class="preprocessor">#include &lt;config.h&gt;</span>
00033 <span class="preprocessor">#endif</span>
00034 <span class="preprocessor"></span><span class="preprocessor">#include &lt;<a class="code" href="gimp-print_8h.html">gimp-print/gimp-print.h</a>&gt;</span>
00035 <span class="preprocessor">#include "<a class="code" href="gimp-print-internal_8h.html">gimp-print-internal.h</a>"</span>
00036 <span class="preprocessor">#include &lt;<a class="code" href="gimp-print-intl-internal_8h.html">gimp-print/gimp-print-intl-internal.h</a>&gt;</span>
00037 <span class="preprocessor">#include &lt;stdlib.h&gt;</span>
00038 <span class="preprocessor">#include &lt;stdio.h&gt;</span>
00039 <span class="preprocessor">#include &lt;string.h&gt;</span>
00040 
<a name="l00041"></a><a class="code" href="structstp__list__item.html">00041</a> <span class="keyword">struct </span><a class="code" href="structstp__list__item.html">stp_list_item</a>
00042 {
<a name="l00043"></a><a class="code" href="structstp__list__item.html#o0">00043</a>   <span class="keywordtype">void</span> *data;                 <span class="comment">/* data */</span>
<a name="l00044"></a><a class="code" href="structstp__list__item.html#o1">00044</a>   <span class="keyword">struct </span><a class="code" href="structstp__list__item.html">stp_list_item</a> *prev; <span class="comment">/* previous node */</span>
<a name="l00045"></a><a class="code" href="structstp__list__item.html#o2">00045</a>   <span class="keyword">struct </span><a class="code" href="structstp__list__item.html">stp_list_item</a> *next; <span class="comment">/* next node */</span>
00046 };
00047 
<a name="l00048"></a><a class="code" href="structstp__list.html">00048</a> <span class="keyword">struct </span><a class="code" href="structstp__list.html">stp_list</a>
00049 {
<a name="l00050"></a><a class="code" href="structstp__list.html#o0">00050</a>   <span class="keywordtype">int</span> <a class="code" href="structstp__list.html#o0">icache</a>;                               <span class="comment">/* index no of cached node */</span>
<a name="l00051"></a><a class="code" href="structstp__list.html#o1">00051</a>   <span class="keywordtype">int</span> <a class="code" href="structstp__list.html#o1">length</a>;                               <span class="comment">/* number of nodes */</span>
<a name="l00052"></a><a class="code" href="structstp__list.html#o2">00052</a>   <span class="keyword">struct </span><a class="code" href="structstp__list__item.html">stp_list_item</a> *<a class="code" href="structstp__list.html#o2">start</a>;     <span class="comment">/* start node */</span>
<a name="l00053"></a><a class="code" href="structstp__list.html#o3">00053</a>   <span class="keyword">struct </span><a class="code" href="structstp__list__item.html">stp_list_item</a> *<a class="code" href="structstp__list.html#o3">end</a>;       <span class="comment">/* end node */</span>
<a name="l00054"></a><a class="code" href="structstp__list.html#o4">00054</a>   <span class="keyword">struct </span><a class="code" href="structstp__list__item.html">stp_list_item</a> *<a class="code" href="structstp__list.html#o4">cache</a>;     <span class="comment">/* cached node */</span>
<a name="l00055"></a><a class="code" href="structstp__list.html#o5">00055</a>   <a class="code" href="list_8h.html#a2">stp_node_freefunc</a> <a class="code" href="structstp__list.html#o5">freefunc</a>;   <span class="comment">/* callback: free node data */</span>
<a name="l00056"></a><a class="code" href="structstp__list.html#o6">00056</a>   <a class="code" href="list_8h.html#a3">stp_node_copyfunc</a> <a class="code" href="structstp__list.html#o6">copyfunc</a>;   <span class="comment">/* callback: copy node */</span>
<a name="l00057"></a><a class="code" href="structstp__list.html#o7">00057</a>   <a class="code" href="list_8h.html#a4">stp_node_namefunc</a> <a class="code" href="structstp__list.html#o7">namefunc</a>;   <span class="comment">/* callback: get node name */</span>
<a name="l00058"></a><a class="code" href="structstp__list.html#o8">00058</a>   <a class="code" href="list_8h.html#a4">stp_node_namefunc</a> <a class="code" href="structstp__list.html#o8">long_namefunc</a>;      <span class="comment">/* callback: get node long name */</span>
<a name="l00059"></a><a class="code" href="structstp__list.html#o9">00059</a>   <a class="code" href="list_8h.html#a5">stp_node_sortfunc</a> <a class="code" href="structstp__list.html#o9">sortfunc</a>;   <span class="comment">/* callback: compare (sort) nodes */</span>
<a name="l00060"></a><a class="code" href="structstp__list.html#o10">00060</a>   <span class="keywordtype">char</span> *<a class="code" href="structstp__list.html#o10">name_cache</a>;
<a name="l00061"></a><a class="code" href="structstp__list.html#o11">00061</a>   <span class="keyword">struct </span><a class="code" href="structstp__list__item.html">stp_list_item</a> *<a class="code" href="structstp__list.html#o11">name_cache_node</a>;
<a name="l00062"></a><a class="code" href="structstp__list.html#o12">00062</a>   <span class="keywordtype">char</span> *<a class="code" href="structstp__list.html#o12">long_name_cache</a>;
<a name="l00063"></a><a class="code" href="structstp__list.html#o13">00063</a>   <span class="keyword">struct </span><a class="code" href="structstp__list__item.html">stp_list_item</a> *<a class="code" href="structstp__list.html#o13">long_name_cache_node</a>;
00064 };
00065 
00066 <span class="keyword">static</span> <span class="keywordtype">void</span>
<a name="l00067"></a><a class="code" href="print-list_8c.html#a0">00067</a> <a class="code" href="print-list_8c.html#a0">set_name_cache</a>(<a class="code" href="structstp__list.html">stp_list_t</a> *list,
00068                <span class="keyword">const</span> <span class="keywordtype">char</span> *name,
00069                <a class="code" href="structstp__list__item.html">stp_list_item_t</a> *cache)
00070 {
00071   <span class="keywordflow">if</span> (list-&gt;<a class="code" href="structstp__list.html#o10">name_cache</a>)
00072     <a class="code" href="group__util.html#ga31">stp_free</a>(list-&gt;<a class="code" href="structstp__list.html#o10">name_cache</a>);
00073   list-&gt;<a class="code" href="structstp__list.html#o10">name_cache</a> = NULL;
00074   <span class="keywordflow">if</span> (name)
00075     list-&gt;<a class="code" href="structstp__list.html#o10">name_cache</a> = <a class="code" href="group__util.html#ga35">stp_strdup</a>(name);
00076   list-&gt;<a class="code" href="structstp__list.html#o11">name_cache_node</a> = cache;
00077 }
00078 
00079 <span class="keyword">static</span> <span class="keywordtype">void</span>
<a name="l00080"></a><a class="code" href="print-list_8c.html#a1">00080</a> <a class="code" href="print-list_8c.html#a1">set_long_name_cache</a>(<a class="code" href="structstp__list.html">stp_list_t</a> *list,
00081                     <span class="keyword">const</span> <span class="keywordtype">char</span> *long_name,
00082                     <a class="code" href="structstp__list__item.html">stp_list_item_t</a> *cache)
00083 {
00084   <span class="keywordflow">if</span> (list-&gt;<a class="code" href="structstp__list.html#o12">long_name_cache</a>)
00085     <a class="code" href="group__util.html#ga31">stp_free</a>(list-&gt;<a class="code" href="structstp__list.html#o12">long_name_cache</a>);
00086   list-&gt;<a class="code" href="structstp__list.html#o12">long_name_cache</a> = NULL;
00087   <span class="keywordflow">if</span> (long_name)
00088     list-&gt;<a class="code" href="structstp__list.html#o12">long_name_cache</a> = <a class="code" href="group__util.html#ga35">stp_strdup</a>(long_name);
00089   list-&gt;<a class="code" href="structstp__list.html#o13">long_name_cache_node</a> = cache;
00090 }
00091 
00092 <span class="keyword">static</span> <span class="keyword">inline</span> <span class="keywordtype">void</span>
<a name="l00093"></a><a class="code" href="print-list_8c.html#a2">00093</a> <a class="code" href="print-list_8c.html#a2">clear_cache</a>(<a class="code" href="structstp__list.html">stp_list_t</a> *list)
00094 {
00095   <a class="code" href="print-list_8c.html#a0">set_name_cache</a>(list, NULL, NULL);
00096   <a class="code" href="print-list_8c.html#a1">set_long_name_cache</a>(list, NULL, NULL);
00097 }
00098 
00099 <span class="comment">/* node free callback for node data allocated with stp_malloc() (not</span>
00100 <span class="comment">   used by default) */</span>
00101 <span class="keywordtype">void</span>
<a name="l00102"></a><a class="code" href="print-list_8c.html#a3">00102</a> <a class="code" href="print-list_8c.html#a3">stp_list_node_free_data</a> (<span class="keywordtype">void</span> *item)
00103 {
00104   <a class="code" href="group__util.html#ga31">stp_free</a>(item);
00105   <a class="code" href="print-util_8c.html#a24">stp_deprintf</a>(<a class="code" href="group__util.html#ga42">STP_DBG_LIST</a>, <span class="stringliteral">"stp_list_node_free_data destructor\n"</span>);
00106 }
00107 
00108 <span class="keyword">static</span> <span class="keywordtype">void</span>
<a name="l00109"></a><a class="code" href="print-list_8c.html#a4">00109</a> <a class="code" href="print-list_8c.html#a4">null_list</a>(<span class="keywordtype">void</span>)
00110 {
00111   <a class="code" href="print-util_8c.html#a20">stp_erprintf</a>(<span class="stringliteral">"Null stp_list_t! Please report this bug.\n"</span>);
00112   <a class="code" href="group__util.html#ga3">stp_abort</a>();
00113 }
00114 
00115 <span class="keyword">static</span> <span class="keyword">inline</span> <span class="keywordtype">void</span>
<a name="l00116"></a><a class="code" href="print-list_8c.html#a5">00116</a> <a class="code" href="color_8c.html#a4">check_list</a>(<span class="keyword">const</span> <a class="code" href="structstp__list.html">stp_list_t</a> *list)
00117 {
00118   <span class="keywordflow">if</span> (list == NULL)
00119     <a class="code" href="print-list_8c.html#a4">null_list</a>();
00120 }
00121 
00122 <span class="keyword">static</span> <span class="keyword">inline</span> <a class="code" href="structstp__list__item.html">stp_list_item_t</a> *
<a name="l00123"></a><a class="code" href="print-list_8c.html#a6">00123</a> <a class="code" href="print-list_8c.html#a6">get_start_internal</a>(<span class="keyword">const</span> <a class="code" href="structstp__list.html">stp_list_t</a> *list)
00124 {
00125   <a class="code" href="color_8c.html#a4">check_list</a>(list);
00126   <span class="keywordflow">return</span> list-&gt;<a class="code" href="structstp__list.html#o2">start</a>;
00127 }
00128 
00129 <span class="keyword">static</span> <span class="keyword">inline</span> <a class="code" href="structstp__list__item.html">stp_list_item_t</a> *
<a name="l00130"></a><a class="code" href="print-list_8c.html#a7">00130</a> <a class="code" href="print-list_8c.html#a7">get_end_internal</a>(<span class="keyword">const</span> <a class="code" href="structstp__list.html">stp_list_t</a> *list)
00131 {
00132   <a class="code" href="color_8c.html#a4">check_list</a>(list);
00133   <span class="keywordflow">return</span> list-&gt;<a class="code" href="structstp__list.html#o3">end</a>;
00134 }
00135 
00136 <span class="comment">/* list head functions */</span>
00137 
00138 <span class="comment">/* these functions operate on the list as a whole, and not the</span>
00139 <span class="comment">   individual nodes in a list */</span>
00140 
00141 <span class="comment">/* create a new list */</span>
00142 <a class="code" href="structstp__list.html">stp_list_t</a> *
<a name="l00143"></a><a class="code" href="print-list_8c.html#a8">00143</a> <a class="code" href="list_8h.html#a7">stp_list_create</a>(<span class="keywordtype">void</span>)
00144 {
00145   <a class="code" href="structstp__list.html">stp_list_t</a> *list =
00146     <a class="code" href="group__util.html#ga28">stp_malloc</a>(<span class="keyword">sizeof</span>(<a class="code" href="structstp__list.html">stp_list_t</a>));
00147 
00148   <span class="comment">/* initialise an empty list */</span>
00149   list-&gt;<a class="code" href="structstp__list.html#o0">icache</a> = 0;
00150   list-&gt;<a class="code" href="structstp__list.html#o1">length</a> = 0;
00151   list-&gt;<a class="code" href="structstp__list.html#o2">start</a> = NULL;
00152   list-&gt;<a class="code" href="structstp__list.html#o3">end</a> = NULL;
00153   list-&gt;<a class="code" href="structstp__list.html#o4">cache</a> = NULL;
00154   list-&gt;<a class="code" href="structstp__list.html#o5">freefunc</a> = NULL;
00155   list-&gt;<a class="code" href="structstp__list.html#o7">namefunc</a> = NULL;
00156   list-&gt;<a class="code" href="structstp__list.html#o8">long_namefunc</a> = NULL;
00157   list-&gt;<a class="code" href="structstp__list.html#o9">sortfunc</a> = NULL;
00158   list-&gt;<a class="code" href="structstp__list.html#o6">copyfunc</a> = NULL;
00159   list-&gt;<a class="code" href="structstp__list.html#o10">name_cache</a> = NULL;
00160   list-&gt;<a class="code" href="structstp__list.html#o11">name_cache_node</a> = NULL;
00161   list-&gt;<a class="code" href="structstp__list.html#o12">long_name_cache</a> = NULL;
00162   list-&gt;<a class="code" href="structstp__list.html#o13">long_name_cache_node</a> = NULL;
00163 
00164   <a class="code" href="print-util_8c.html#a24">stp_deprintf</a>(<a class="code" href="group__util.html#ga42">STP_DBG_LIST</a>, <span class="stringliteral">"stp_list_head constructor\n"</span>);
00165   <span class="keywordflow">return</span> list;
00166 }
00167 
00168 <a class="code" href="structstp__list.html">stp_list_t</a> *
<a name="l00169"></a><a class="code" href="print-list_8c.html#a9">00169</a> <a class="code" href="print-list_8c.html#a9">stp_list_copy</a>(<span class="keyword">const</span> <a class="code" href="structstp__list.html">stp_list_t</a> *list)
00170 {
00171   <a class="code" href="structstp__list.html">stp_list_t</a> *ret;
00172   <a class="code" href="list_8h.html#a3">stp_node_copyfunc</a> copyfunc = <a class="code" href="print-list_8c.html#a22">stp_list_get_copyfunc</a>(list);
00173   <a class="code" href="structstp__list__item.html">stp_list_item_t</a> *item = <a class="code" href="print-list_8c.html#a6">get_start_internal</a>(list);
00174 
00175   <a class="code" href="color_8c.html#a4">check_list</a>(list);
00176 
00177   ret = <a class="code" href="list_8h.html#a7">stp_list_create</a>();
00178   <a class="code" href="print-list_8c.html#a21">stp_list_set_copyfunc</a>(ret, <a class="code" href="print-list_8c.html#a22">stp_list_get_copyfunc</a>(list));
00179   <span class="comment">/* If we use default (shallow) copy, we can't free the elements of it */</span>
00180   <span class="keywordflow">if</span> (<a class="code" href="print-list_8c.html#a22">stp_list_get_copyfunc</a>(list))
00181     <a class="code" href="print-list_8c.html#a19">stp_list_set_freefunc</a>(ret, <a class="code" href="print-list_8c.html#a20">stp_list_get_freefunc</a>(list));
00182   <a class="code" href="print-list_8c.html#a23">stp_list_set_namefunc</a>(ret, <a class="code" href="print-list_8c.html#a24">stp_list_get_namefunc</a>(list));
00183   <a class="code" href="print-list_8c.html#a25">stp_list_set_long_namefunc</a>(ret, <a class="code" href="print-list_8c.html#a26">stp_list_get_long_namefunc</a>(list));
00184   <a class="code" href="print-list_8c.html#a27">stp_list_set_sortfunc</a>(ret, <a class="code" href="print-list_8c.html#a28">stp_list_get_sortfunc</a>(list));
00185   <span class="keywordflow">while</span> (item)
00186     {
00187       <span class="keywordtype">void</span> *data = item-&gt;<a class="code" href="structstp__list__item.html#o0">data</a>;
00188       <span class="keywordflow">if</span> (copyfunc)
00189         <a class="code" href="print-list_8c.html#a29">stp_list_item_create</a> (ret, NULL, (*copyfunc)(data));
00190       <span class="keywordflow">else</span>
00191         <a class="code" href="print-list_8c.html#a29">stp_list_item_create</a>(ret, NULL, data);
00192       item = <a class="code" href="print-list_8c.html#a32">stp_list_item_next</a>(item);
00193     }
00194   <span class="keywordflow">return</span> ret;
00195 }
00196 
00197 <span class="comment">/* free a list, freeing all child nodes first */</span>
00198 <span class="keywordtype">int</span>
<a name="l00199"></a><a class="code" href="print-list_8c.html#a10">00199</a> <a class="code" href="print-list_8c.html#a10">stp_list_destroy</a>(<a class="code" href="structstp__list.html">stp_list_t</a> *list)
00200 {
00201   <a class="code" href="structstp__list__item.html">stp_list_item_t</a> *cur;
00202   <a class="code" href="structstp__list__item.html">stp_list_item_t</a> *next;
00203 
00204   <a class="code" href="color_8c.html#a4">check_list</a>(list);
00205   <a class="code" href="print-list_8c.html#a2">clear_cache</a>(list);
00206   cur = <a class="code" href="print-list_8c.html#a6">get_start_internal</a>(list);
00207   <span class="keywordflow">while</span>(cur)
00208     {
00209       next = cur-&gt;<a class="code" href="structstp__list__item.html#o2">next</a>;
00210       <a class="code" href="print-list_8c.html#a30">stp_list_item_destroy</a>(list, cur);
00211       cur = next;
00212     }
00213   <a class="code" href="print-util_8c.html#a24">stp_deprintf</a>(<a class="code" href="group__util.html#ga42">STP_DBG_LIST</a>, <span class="stringliteral">"stp_list_head destructor\n"</span>);
00214   <a class="code" href="group__util.html#ga31">stp_free</a>(list);
00215 
00216   <span class="keywordflow">return</span> 0;
00217 }
00218 
00219 <span class="keywordtype">int</span>
<a name="l00220"></a><a class="code" href="print-list_8c.html#a11">00220</a> <a class="code" href="print-list_8c.html#a11">stp_list_get_length</a>(<span class="keyword">const</span> <a class="code" href="structstp__list.html">stp_list_t</a> *list)
00221 {
00222   <a class="code" href="color_8c.html#a4">check_list</a>(list);
00223   <span class="keywordflow">return</span> list-&gt;<a class="code" href="structstp__list.html#o1">length</a>;
00224 }
00225 
00226 <span class="comment">/* find a node */</span>
00227 
00228 <span class="comment">/* get the first node in the list */</span>
00229 
00230 <a class="code" href="structstp__list__item.html">stp_list_item_t</a> *
<a name="l00231"></a><a class="code" href="print-list_8c.html#a12">00231</a> <a class="code" href="print-list_8c.html#a12">stp_list_get_start</a>(<span class="keyword">const</span> <a class="code" href="structstp__list.html">stp_list_t</a> *list)
00232 {
00233   <span class="keywordflow">return</span> <a class="code" href="print-list_8c.html#a6">get_start_internal</a>(list);
00234 }
00235 
00236 <span class="comment">/* get the last node in the list */</span>
00237 
00238 <a class="code" href="structstp__list__item.html">stp_list_item_t</a> *
<a name="l00239"></a><a class="code" href="print-list_8c.html#a13">00239</a> <a class="code" href="print-list_8c.html#a13">stp_list_get_end</a>(<span class="keyword">const</span> <a class="code" href="structstp__list.html">stp_list_t</a> *list)
00240 {
00241   <span class="keywordflow">return</span> <a class="code" href="print-list_8c.html#a7">get_end_internal</a>(list);
00242 }
00243 
00244 <span class="comment">/* get the node by its place in the list */</span>
00245 <a class="code" href="structstp__list__item.html">stp_list_item_t</a> *
<a name="l00246"></a><a class="code" href="print-list_8c.html#a14">00246</a> <a class="code" href="print-list_8c.html#a14">stp_list_get_item_by_index</a>(<span class="keyword">const</span> <a class="code" href="structstp__list.html">stp_list_t</a> *list, <span class="keywordtype">int</span> idx)
00247 {
00248   <a class="code" href="structstp__list__item.html">stp_list_item_t</a> *node = NULL;
00249   <span class="keywordtype">int</span> i; <span class="comment">/* current index */</span>
00250   <span class="keywordtype">int</span> d = 0; <span class="comment">/* direction of list traversal, 0=forward */</span>
00251   <span class="keywordtype">int</span> c = 0; <span class="comment">/* use cache? */</span>
00252   <a class="code" href="color_8c.html#a4">check_list</a>(list);
00253 
00254   <span class="keywordflow">if</span> (idx &gt;= list-&gt;<a class="code" href="structstp__list.html#o1">length</a>)
00255     <span class="keywordflow">return</span> NULL;
00256 
00257   <span class="comment">/* see if using the cache is worthwhile */</span>
00258   <span class="keywordflow">if</span> (list-&gt;<a class="code" href="structstp__list.html#o0">icache</a>)
00259     {
00260       <span class="keywordflow">if</span> (idx &lt; (list-&gt;<a class="code" href="structstp__list.html#o1">length</a>/2))
00261         {
00262           <span class="keywordflow">if</span> (idx &gt; abs(idx - list-&gt;<a class="code" href="structstp__list.html#o0">icache</a>))
00263             c = 1;
00264           <span class="keywordflow">else</span>
00265             d = 0;
00266         }
00267       <span class="keywordflow">else</span>
00268         {
00269           <span class="keywordflow">if</span> (list-&gt;<a class="code" href="structstp__list.html#o1">length</a> - 1 - idx &gt;
00270               abs (list-&gt;<a class="code" href="structstp__list.html#o1">length</a> - 1 - idx - list-&gt;<a class="code" href="structstp__list.html#o0">icache</a>))
00271             c = 1;
00272           <span class="keywordflow">else</span>
00273             d = 1;
00274         }
00275     }
00276 
00277 
00278   <span class="keywordflow">if</span> (c) <span class="comment">/* use the cached index and node */</span>
00279     {
00280       <span class="keywordflow">if</span> (idx &gt; list-&gt;<a class="code" href="structstp__list.html#o0">icache</a>) <span class="comment">/* forward */</span>
00281         d = 0;
00282       <span class="keywordflow">else</span> <span class="comment">/* backward */</span>
00283         d = 1;
00284       i = list-&gt;<a class="code" href="structstp__list.html#o0">icache</a>;
00285       node = list-&gt;<a class="code" href="structstp__list.html#o4">cache</a>;
00286     }
00287   <span class="keywordflow">else</span> <span class="comment">/* start from one end of the list */</span>
00288     {
00289       <span class="keywordflow">if</span> (d)
00290         {
00291           i = list-&gt;<a class="code" href="structstp__list.html#o1">length</a> - 1;
00292           node = <a class="code" href="print-list_8c.html#a7">get_end_internal</a>(list);
00293         }
00294       <span class="keywordflow">else</span>
00295         {
00296           i = 0;
00297           node = <a class="code" href="print-list_8c.html#a6">get_start_internal</a>(list);
00298         }
00299     }
00300 
00301   <span class="keywordflow">while</span> (node &amp;&amp; i != idx)
00302     {
00303       <span class="keywordflow">if</span> (d)
00304         {
00305           i--;
00306           node = node-&gt;<a class="code" href="structstp__list__item.html#o1">prev</a>;
00307         }
00308       <span class="keywordflow">else</span>
00309         {
00310           i++;
00311           node = node-&gt;<a class="code" href="structstp__list__item.html#o2">next</a>;
00312         }
00313     }
00314 
00315   <span class="comment">/* update cache */</span>
00316   ((<a class="code" href="structstp__list.html">stp_list_t</a> *)list)-&gt;icache = i;
00317   ((<a class="code" href="structstp__list.html">stp_list_t</a> *)list)-&gt;cache = node;
00318 
00319   <span class="keywordflow">return</span> node;
00320 }
00321 
00322 <span class="keyword">static</span> <a class="code" href="structstp__list__item.html">stp_list_item_t</a> *
<a name="l00323"></a><a class="code" href="print-list_8c.html#a15">00323</a> <a class="code" href="print-list_8c.html#a15">stp_list_get_item_by_name_internal</a>(<span class="keyword">const</span> <a class="code" href="structstp__list.html">stp_list_t</a> *list, <span class="keyword">const</span> <span class="keywordtype">char</span> *name)
00324 {
00325   <a class="code" href="structstp__list__item.html">stp_list_item_t</a> *node = <a class="code" href="print-list_8c.html#a6">get_start_internal</a>(list);
00326   <span class="keywordflow">while</span> (node &amp;&amp; strcmp(name, list-&gt;<a class="code" href="structstp__list.html#o7">namefunc</a>(node-&gt;<a class="code" href="structstp__list__item.html#o0">data</a>)))
00327     {
00328       node = node-&gt;<a class="code" href="structstp__list__item.html#o2">next</a>;
00329     }
00330   <span class="keywordflow">return</span> node;
00331 }
00332 
00333 <span class="comment">/* get the first node with name; requires a callback function to</span>
00334 <span class="comment">   read data */</span>
00335 <a class="code" href="structstp__list__item.html">stp_list_item_t</a> *
<a name="l00336"></a><a class="code" href="print-list_8c.html#a16">00336</a> <a class="code" href="print-list_8c.html#a16">stp_list_get_item_by_name</a>(<span class="keyword">const</span> <a class="code" href="structstp__list.html">stp_list_t</a> *list, <span class="keyword">const</span> <span class="keywordtype">char</span> *name)
00337 {
00338   <a class="code" href="structstp__list__item.html">stp_list_item_t</a> *node = NULL;
00339   <a class="code" href="color_8c.html#a4">check_list</a>(list);
00340 
00341   <span class="keywordflow">if</span> (!list-&gt;<a class="code" href="structstp__list.html#o7">namefunc</a>)
00342     <span class="keywordflow">return</span> NULL;
00343 
00344   <span class="keywordflow">if</span> (list-&gt;<a class="code" href="structstp__list.html#o10">name_cache</a> &amp;&amp; name &amp;&amp; list-&gt;<a class="code" href="structstp__list.html#o11">name_cache_node</a>)
00345     {
00346       <span class="keyword">const</span> <span class="keywordtype">char</span> *new_name;
00347       node = list-&gt;<a class="code" href="structstp__list.html#o11">name_cache_node</a>;
00348       <span class="comment">/* Is this the item we've cached? */</span>
00349       <span class="keywordflow">if</span> (strcmp(name, list-&gt;<a class="code" href="structstp__list.html#o10">name_cache</a>) == 0 &amp;&amp;
00350           strcmp(name, list-&gt;<a class="code" href="structstp__list.html#o7">namefunc</a>(node-&gt;<a class="code" href="structstp__list__item.html#o0">data</a>)) == 0)
00351         <span class="keywordflow">return</span> node;
00352 
00353       <span class="comment">/* If not, check the next item in case we're searching the list */</span>
00354       node = node-&gt;<a class="code" href="structstp__list__item.html#o2">next</a>;
00355       <span class="keywordflow">if</span> (node)
00356         {
00357           new_name = list-&gt;<a class="code" href="structstp__list.html#o7">namefunc</a>(node-&gt;<a class="code" href="structstp__list__item.html#o0">data</a>);
00358           <span class="keywordflow">if</span> (strcmp(name, new_name) == 0)
00359             {
00360               <a class="code" href="print-list_8c.html#a0">set_name_cache</a>((<a class="code" href="structstp__list.html">stp_list_t</a> *) list, new_name, node);
00361               <span class="keywordflow">return</span> node;
00362             }
00363         }
00364       <span class="comment">/* If not, check the index cache */</span>
00365       node = list-&gt;<a class="code" href="structstp__list.html#o4">cache</a>;
00366       <span class="keywordflow">if</span> (node)
00367         {
00368           new_name = list-&gt;<a class="code" href="structstp__list.html#o7">namefunc</a>(node-&gt;<a class="code" href="structstp__list__item.html#o0">data</a>);
00369           <span class="keywordflow">if</span> (strcmp(name, new_name) == 0)
00370             {
00371               <a class="code" href="print-list_8c.html#a0">set_name_cache</a>((<a class="code" href="structstp__list.html">stp_list_t</a> *) list, new_name, node);
00372               <span class="keywordflow">return</span> node;
00373             }
00374         }
00375     }
00376 
00377   node = <a class="code" href="print-list_8c.html#a15">stp_list_get_item_by_name_internal</a>(list, name);
00378 
00379   <span class="keywordflow">if</span> (node)
00380     <a class="code" href="print-list_8c.html#a0">set_name_cache</a>((<a class="code" href="structstp__list.html">stp_list_t</a> *) list, name, node);
00381 
00382   <span class="keywordflow">return</span> node;
00383 }
00384 
00385 
00386 <span class="keyword">static</span> <a class="code" href="structstp__list__item.html">stp_list_item_t</a> *
<a name="l00387"></a><a class="code" href="print-list_8c.html#a17">00387</a> <a class="code" href="print-list_8c.html#a17">stp_list_get_item_by_long_name_internal</a>(<span class="keyword">const</span> <a class="code" href="structstp__list.html">stp_list_t</a> *list,
00388                                          <span class="keyword">const</span> <span class="keywordtype">char</span> *long_name)
00389 {
00390   <a class="code" href="structstp__list__item.html">stp_list_item_t</a> *node = <a class="code" href="print-list_8c.html#a6">get_start_internal</a>(list);
00391   <span class="keywordflow">while</span> (node &amp;&amp; strcmp(long_name, list-&gt;<a class="code" href="structstp__list.html#o8">long_namefunc</a>(node-&gt;<a class="code" href="structstp__list__item.html#o0">data</a>)))
00392     {
00393       node = node-&gt;<a class="code" href="structstp__list__item.html#o2">next</a>;
00394     }
00395   <span class="keywordflow">return</span> node;
00396 }
00397 
00398 <span class="comment">/* get the first node with long_name; requires a callack function to</span>
00399 <span class="comment">   read data */</span>
00400 <a class="code" href="structstp__list__item.html">stp_list_item_t</a> *
<a name="l00401"></a><a class="code" href="print-list_8c.html#a18">00401</a> <a class="code" href="print-list_8c.html#a18">stp_list_get_item_by_long_name</a>(<span class="keyword">const</span> <a class="code" href="structstp__list.html">stp_list_t</a> *list, <span class="keyword">const</span> <span class="keywordtype">char</span> *long_name)
00402 {
00403   <a class="code" href="structstp__list__item.html">stp_list_item_t</a> *node = NULL;
00404   <a class="code" href="color_8c.html#a4">check_list</a>(list);
00405 
00406   <span class="keywordflow">if</span> (!list-&gt;<a class="code" href="structstp__list.html#o8">long_namefunc</a>)
00407     <span class="keywordflow">return</span> NULL;
00408 
00409   <span class="keywordflow">if</span> (list-&gt;<a class="code" href="structstp__list.html#o12">long_name_cache</a> &amp;&amp; long_name &amp;&amp; list-&gt;<a class="code" href="structstp__list.html#o13">long_name_cache_node</a>)
00410     {
00411       <span class="keyword">const</span> <span class="keywordtype">char</span> *new_long_name;
00412       node = list-&gt;<a class="code" href="structstp__list.html#o13">long_name_cache_node</a>;
00413       <span class="comment">/* Is this the item we've cached? */</span>
00414       <span class="keywordflow">if</span> (strcmp(long_name, list-&gt;<a class="code" href="structstp__list.html#o12">long_name_cache</a>) == 0 &amp;&amp;
00415           strcmp(long_name, list-&gt;<a class="code" href="structstp__list.html#o8">long_namefunc</a>(node-&gt;<a class="code" href="structstp__list__item.html#o0">data</a>)) == 0)
00416         <span class="keywordflow">return</span> node;
00417 
00418       <span class="comment">/* If not, check the next item in case we're searching the list */</span>
00419       node = node-&gt;<a class="code" href="structstp__list__item.html#o2">next</a>;
00420       <span class="keywordflow">if</span> (node)
00421         {
00422           new_long_name = list-&gt;<a class="code" href="structstp__list.html#o8">long_namefunc</a>(node-&gt;<a class="code" href="structstp__list__item.html#o0">data</a>);
00423           <span class="keywordflow">if</span> (strcmp(long_name, new_long_name) == 0)
00424             {
00425               <a class="code" href="print-list_8c.html#a1">set_long_name_cache</a>((<a class="code" href="structstp__list.html">stp_list_t</a>*) list, new_long_name, node);
00426               <span class="keywordflow">return</span> node;
00427             }
00428         }
00429       <span class="comment">/* If not, check the index cache */</span>
00430       node = list-&gt;<a class="code" href="structstp__list.html#o4">cache</a>;
00431       <span class="keywordflow">if</span> (node)
00432         {
00433           new_long_name = list-&gt;<a class="code" href="structstp__list.html#o8">long_namefunc</a>(node-&gt;<a class="code" href="structstp__list__item.html#o0">data</a>);
00434           <span class="keywordflow">if</span> (strcmp(long_name, new_long_name) == 0)
00435             {
00436               <a class="code" href="print-list_8c.html#a1">set_long_name_cache</a>((<a class="code" href="structstp__list.html">stp_list_t</a> *) list, new_long_name, node);
00437               <span class="keywordflow">return</span> node;
00438             }
00439         }
00440     }
00441 
00442   node = <a class="code" href="print-list_8c.html#a17">stp_list_get_item_by_long_name_internal</a>(list, long_name);
00443 
00444   <span class="keywordflow">if</span> (node)
00445     <a class="code" href="print-list_8c.html#a1">set_long_name_cache</a>((<a class="code" href="structstp__list.html">stp_list_t</a> *) list, long_name, node);
00446 
00447   <span class="keywordflow">return</span> node;
00448 }
00449 
00450 
00451 <span class="comment">/* callback for freeing data */</span>
00452 <span class="keywordtype">void</span>
<a name="l00453"></a><a class="code" href="print-list_8c.html#a19">00453</a> <a class="code" href="print-list_8c.html#a19">stp_list_set_freefunc</a>(<a class="code" href="structstp__list.html">stp_list_t</a> *list, <a class="code" href="list_8h.html#a2">stp_node_freefunc</a> freefunc)
00454 {
00455   <a class="code" href="color_8c.html#a4">check_list</a>(list);
00456   list-&gt;<a class="code" href="structstp__list.html#o5">freefunc</a> = freefunc;
00457 }
00458 
00459 <a class="code" href="list_8h.html#a2">stp_node_freefunc</a>
<a name="l00460"></a><a class="code" href="print-list_8c.html#a20">00460</a> <a class="code" href="print-list_8c.html#a20">stp_list_get_freefunc</a>(<span class="keyword">const</span> <a class="code" href="structstp__list.html">stp_list_t</a> *list)
00461 {
00462   <a class="code" href="color_8c.html#a4">check_list</a>(list);
00463   <span class="keywordflow">return</span> list-&gt;<a class="code" href="structstp__list.html#o5">freefunc</a>;
00464 }
00465 
00466 <span class="comment">/* callback for copying data */</span>
00467 <span class="keywordtype">void</span>
<a name="l00468"></a><a class="code" href="print-list_8c.html#a21">00468</a> <a class="code" href="print-list_8c.html#a21">stp_list_set_copyfunc</a>(<a class="code" href="structstp__list.html">stp_list_t</a> *list, <a class="code" href="list_8h.html#a3">stp_node_copyfunc</a> copyfunc)
00469 {
00470   <a class="code" href="color_8c.html#a4">check_list</a>(list);
00471   list-&gt;<a class="code" href="structstp__list.html#o6">copyfunc</a> = copyfunc;
00472 }
00473 
00474 <a class="code" href="list_8h.html#a3">stp_node_copyfunc</a>
<a name="l00475"></a><a class="code" href="print-list_8c.html#a22">00475</a> <a class="code" href="print-list_8c.html#a22">stp_list_get_copyfunc</a>(<span class="keyword">const</span> <a class="code" href="structstp__list.html">stp_list_t</a> *list)
00476 {
00477   <a class="code" href="color_8c.html#a4">check_list</a>(list);
00478   <span class="keywordflow">return</span> list-&gt;<a class="code" href="structstp__list.html#o6">copyfunc</a>;
00479 }
00480 
00481 <span class="comment">/* callback for getting data name */</span>
00482 <span class="keywordtype">void</span>
<a name="l00483"></a><a class="code" href="print-list_8c.html#a23">00483</a> <a class="code" href="print-list_8c.html#a23">stp_list_set_namefunc</a>(<a class="code" href="structstp__list.html">stp_list_t</a> *list, <a class="code" href="list_8h.html#a4">stp_node_namefunc</a> namefunc)
00484 {
00485   <a class="code" href="color_8c.html#a4">check_list</a>(list);
00486   list-&gt;<a class="code" href="structstp__list.html#o7">namefunc</a> = namefunc;
00487 }
00488 
00489 <a class="code" href="list_8h.html#a4">stp_node_namefunc</a>
<a name="l00490"></a><a class="code" href="print-list_8c.html#a24">00490</a> <a class="code" href="print-list_8c.html#a24">stp_list_get_namefunc</a>(<span class="keyword">const</span> <a class="code" href="structstp__list.html">stp_list_t</a> *list)
00491 {
00492   <a class="code" href="color_8c.html#a4">check_list</a>(list);
00493   <span class="keywordflow">return</span> list-&gt;<a class="code" href="structstp__list.html#o7">namefunc</a>;
00494 }
00495 
00496 <span class="comment">/* callback for getting data long_name */</span>
00497 <span class="keywordtype">void</span>
<a name="l00498"></a><a class="code" href="print-list_8c.html#a25">00498</a> <a class="code" href="print-list_8c.html#a25">stp_list_set_long_namefunc</a>(<a class="code" href="structstp__list.html">stp_list_t</a> *list, <a class="code" href="list_8h.html#a4">stp_node_namefunc</a> long_namefunc)
00499 {
00500   <a class="code" href="color_8c.html#a4">check_list</a>(list);
00501   list-&gt;<a class="code" href="structstp__list.html#o8">long_namefunc</a> = long_namefunc;
00502 }
00503 
00504 <a class="code" href="list_8h.html#a4">stp_node_namefunc</a>
<a name="l00505"></a><a class="code" href="print-list_8c.html#a26">00505</a> <a class="code" href="print-list_8c.html#a26">stp_list_get_long_namefunc</a>(<span class="keyword">const</span> <a class="code" href="structstp__list.html">stp_list_t</a> *list)
00506 {
00507   <a class="code" href="color_8c.html#a4">check_list</a>(list);
00508   <span class="keywordflow">return</span> list-&gt;<a class="code" href="structstp__list.html#o8">long_namefunc</a>;
00509 }
00510 
00511 <span class="comment">/* callback for sorting nodes */</span>
00512 <span class="keywordtype">void</span>
<a name="l00513"></a><a class="code" href="print-list_8c.html#a27">00513</a> <a class="code" href="print-list_8c.html#a27">stp_list_set_sortfunc</a>(<a class="code" href="structstp__list.html">stp_list_t</a> *list, <a class="code" href="list_8h.html#a5">stp_node_sortfunc</a> sortfunc)
00514 {
00515   <a class="code" href="color_8c.html#a4">check_list</a>(list);
00516   list-&gt;<a class="code" href="structstp__list.html#o9">sortfunc</a> = sortfunc;
00517 }
00518 
00519 <a class="code" href="list_8h.html#a5">stp_node_sortfunc</a>
<a name="l00520"></a><a class="code" href="print-list_8c.html#a28">00520</a> <a class="code" href="print-list_8c.html#a28">stp_list_get_sortfunc</a>(<span class="keyword">const</span> <a class="code" href="structstp__list.html">stp_list_t</a> *list)
00521 {
00522   <a class="code" href="color_8c.html#a4">check_list</a>(list);
00523   <span class="keywordflow">return</span> list-&gt;<a class="code" href="structstp__list.html#o9">sortfunc</a>;
00524 }
00525 
00526 
00527 <span class="comment">/* list item functions */</span>
00528 
00529 <span class="comment">/* these functions operate on individual nodes in a list */</span>
00530 
00531 <span class="comment">/*</span>
00532 <span class="comment"> * create a new node in list, before next (may be null e.g. if sorting</span>
00533 <span class="comment"> * next is calculated automatically, else defaults to end).  Must be</span>
00534 <span class="comment"> * initialised with data (null nodes are disallowed).  The</span>
00535 <span class="comment"> * stp_list_item_t type can not exist unless it is associated with an</span>
00536 <span class="comment"> * stp_list_t list head.</span>
00537 <span class="comment"> */</span>
00538 <span class="keywordtype">int</span>
<a name="l00539"></a><a class="code" href="print-list_8c.html#a29">00539</a> <a class="code" href="print-list_8c.html#a29">stp_list_item_create</a>(<a class="code" href="structstp__list.html">stp_list_t</a> *list,
00540                      <a class="code" href="structstp__list__item.html">stp_list_item_t</a> *next,
00541                      <span class="keyword">const</span> <span class="keywordtype">void</span> *data)
00542 {
00543   <a class="code" href="structstp__list__item.html">stp_list_item_t</a> *ln; <span class="comment">/* list node to add */</span>
00544   <a class="code" href="structstp__list__item.html">stp_list_item_t</a> *lnn; <span class="comment">/* list node next */</span>
00545 
00546   <a class="code" href="color_8c.html#a4">check_list</a>(list);
00547 
00548   <a class="code" href="print-list_8c.html#a2">clear_cache</a>(list);
00549 
00550   ln = <a class="code" href="group__util.html#ga28">stp_malloc</a>(<span class="keyword">sizeof</span>(<a class="code" href="structstp__list__item.html">stp_list_item_t</a>));
00551   ln-&gt;<a class="code" href="structstp__list__item.html#o1">prev</a> = ln-&gt;<a class="code" href="structstp__list__item.html#o2">next</a> = NULL;
00552 
00553   <span class="keywordflow">if</span> (data)
00554     ln-&gt;<a class="code" href="structstp__list__item.html#o0">data</a> = (<span class="keywordtype">void</span> *) data;
00555   <span class="keywordflow">else</span>
00556     {
00557       <a class="code" href="group__util.html#ga31">stp_free</a>(ln);
00558       <span class="keywordflow">return</span> 1;
00559     }
00560 
00561   <span class="keywordflow">if</span> (list-&gt;<a class="code" href="structstp__list.html#o9">sortfunc</a>)
00562     {
00563       <span class="comment">/* set np to the previous node (before the insertion */</span>
00564       lnn = <a class="code" href="print-list_8c.html#a7">get_end_internal</a>(list);
00565       <span class="keywordflow">while</span> (lnn)
00566         {
00567           <span class="keywordflow">if</span> (list-&gt;<a class="code" href="structstp__list.html#o9">sortfunc</a>(lnn-&gt;<a class="code" href="structstp__list__item.html#o0">data</a>, ln-&gt;<a class="code" href="structstp__list__item.html#o0">data</a>) &lt;= 0)
00568             <span class="keywordflow">break</span>;
00569           lnn = lnn-&gt;<a class="code" href="structstp__list__item.html#o1">prev</a>;
00570         }
00571     }
00572 <span class="preprocessor">#if 0</span>
00573 <span class="preprocessor"></span>  <span class="comment">/*</span>
00574 <span class="comment">   * This code #ifdef'ed out by Robert Krawitz on April 3, 2004.</span>
00575 <span class="comment">   * Setting a debug variable should not result in taking a materially</span>
00576 <span class="comment">   * different code path.</span>
00577 <span class="comment">   */</span>
00578   <span class="keywordflow">else</span> <span class="keywordflow">if</span> (stpi_get_debug_level() &amp; STPI_DBG_LIST)
00579     {
00580       <span class="keywordflow">if</span> (next)
00581         {
00582           lnn = <a class="code" href="print-list_8c.html#a6">get_start_internal</a>(list);
00583           <span class="keywordflow">while</span> (lnn)
00584             {
00585               <span class="keywordflow">if</span> (lnn == next)
00586                 <span class="keywordflow">break</span>;
00587               lnn = lnn-&gt;<a class="code" href="structstp__list__item.html#o1">prev</a>;
00588             }
00589         }
00590       <span class="keywordflow">else</span>
00591         lnn = NULL;
00592     }
00593 <span class="preprocessor">#endif</span>
00594 <span class="preprocessor"></span>  <span class="keywordflow">else</span>
00595     lnn = next;
00596 
00597   <span class="comment">/* got lnp; now insert the new ln */</span>
00598 
00599   <span class="comment">/* set next */</span>
00600   ln-&gt;<a class="code" href="structstp__list__item.html#o2">next</a> = lnn;
00601 
00602   <span class="keywordflow">if</span> (!ln-&gt;<a class="code" href="structstp__list__item.html#o1">prev</a>) <span class="comment">/* insert at start of list */</span>
00603     {
00604       <span class="keywordflow">if</span> (list-&gt;<a class="code" href="structstp__list.html#o2">start</a>) <span class="comment">/* list not empty */</span>
00605         ln-&gt;<a class="code" href="structstp__list__item.html#o1">prev</a> = list-&gt;<a class="code" href="structstp__list.html#o3">end</a>;
00606       <span class="keywordflow">else</span>
00607         list-&gt;<a class="code" href="structstp__list.html#o2">start</a> = ln;
00608       list-&gt;<a class="code" href="structstp__list.html#o3">end</a> = ln;
00609     }
00610 
00611   <span class="comment">/* set prev (already set if at start of list) */</span>
00612 
00613   <span class="keywordflow">if</span> (!ln-&gt;<a class="code" href="structstp__list__item.html#o1">prev</a> &amp;&amp; ln-&gt;<a class="code" href="structstp__list__item.html#o2">next</a>) <span class="comment">/* insert at end of list */</span>
00614     ln-&gt;<a class="code" href="structstp__list__item.html#o1">prev</a> = ln-&gt;<a class="code" href="structstp__list__item.html#o2">next</a>-&gt;<a class="code" href="structstp__list__item.html#o1">prev</a>;
00615 
00616   <span class="keywordflow">if</span> (list-&gt;<a class="code" href="structstp__list.html#o2">start</a> == ln-&gt;<a class="code" href="structstp__list__item.html#o2">next</a>) <span class="comment">/* prev was old end */</span>
00617     {
00618       list-&gt;<a class="code" href="structstp__list.html#o2">start</a> = ln;
00619     }
00620 
00621   <span class="comment">/* set next-&gt;prev */</span>
00622   <span class="keywordflow">if</span> (ln-&gt;<a class="code" href="structstp__list__item.html#o2">next</a>)
00623     ln-&gt;<a class="code" href="structstp__list__item.html#o2">next</a>-&gt;<a class="code" href="structstp__list__item.html#o1">prev</a> = ln;
00624 
00625   <span class="comment">/* set prev-&gt;next */</span>
00626   <span class="keywordflow">if</span> (ln-&gt;<a class="code" href="structstp__list__item.html#o1">prev</a>)
00627     ln-&gt;<a class="code" href="structstp__list__item.html#o1">prev</a>-&gt;<a class="code" href="structstp__list__item.html#o2">next</a> = ln;
00628 
00629   <span class="comment">/* increment reference count */</span>
00630   list-&gt;<a class="code" href="structstp__list.html#o1">length</a>++;
00631 
00632   <a class="code" href="print-util_8c.html#a24">stp_deprintf</a>(<a class="code" href="group__util.html#ga42">STP_DBG_LIST</a>, <span class="stringliteral">"stp_list_node constructor\n"</span>);
00633   <span class="keywordflow">return</span> 0;
00634 }
00635 
00636 <span class="comment">/* remove a node from list */</span>
00637 <span class="keywordtype">int</span>
<a name="l00638"></a><a class="code" href="print-list_8c.html#a30">00638</a> <a class="code" href="print-list_8c.html#a30">stp_list_item_destroy</a>(<a class="code" href="structstp__list.html">stp_list_t</a> *list, <a class="code" href="structstp__list__item.html">stp_list_item_t</a> *item)
00639 {
00640   <a class="code" href="color_8c.html#a4">check_list</a>(list);
00641 
00642   <a class="code" href="print-list_8c.html#a2">clear_cache</a>(list);
00643   <span class="comment">/* decrement reference count */</span>
00644   list-&gt;<a class="code" href="structstp__list.html#o1">length</a>--;
00645 
00646   <span class="keywordflow">if</span> (list-&gt;<a class="code" href="structstp__list.html#o5">freefunc</a>)
00647     list-&gt;<a class="code" href="structstp__list.html#o5">freefunc</a>((<span class="keywordtype">void</span> *) item-&gt;<a class="code" href="structstp__list__item.html#o0">data</a>);
00648   <span class="keywordflow">if</span> (item-&gt;<a class="code" href="structstp__list__item.html#o1">prev</a>)
00649     item-&gt;<a class="code" href="structstp__list__item.html#o1">prev</a>-&gt;<a class="code" href="structstp__list__item.html#o2">next</a> = item-&gt;<a class="code" href="structstp__list__item.html#o2">next</a>;
00650   <span class="keywordflow">else</span>
00651     list-&gt;<a class="code" href="structstp__list.html#o2">start</a> = item-&gt;<a class="code" href="structstp__list__item.html#o2">next</a>;
00652   <span class="keywordflow">if</span> (item-&gt;<a class="code" href="structstp__list__item.html#o2">next</a>)
00653     item-&gt;<a class="code" href="structstp__list__item.html#o2">next</a>-&gt;<a class="code" href="structstp__list__item.html#o1">prev</a> = item-&gt;<a class="code" href="structstp__list__item.html#o1">prev</a>;
00654   <span class="keywordflow">else</span>
00655     list-&gt;<a class="code" href="structstp__list.html#o3">end</a> = item-&gt;<a class="code" href="structstp__list__item.html#o1">prev</a>;
00656   <a class="code" href="group__util.html#ga31">stp_free</a>(item);
00657 
00658   <a class="code" href="print-util_8c.html#a24">stp_deprintf</a>(<a class="code" href="group__util.html#ga42">STP_DBG_LIST</a>, <span class="stringliteral">"stp_list_node destructor\n"</span>);
00659   <span class="keywordflow">return</span> 0;
00660 }
00661 
00662 <span class="comment">/* get previous node */</span>
00663 <a class="code" href="structstp__list__item.html">stp_list_item_t</a> *
<a name="l00664"></a><a class="code" href="print-list_8c.html#a31">00664</a> <a class="code" href="print-list_8c.html#a31">stp_list_item_prev</a>(<span class="keyword">const</span> <a class="code" href="structstp__list__item.html">stp_list_item_t</a> *item)
00665 {
00666   <span class="keywordflow">return</span> item-&gt;<a class="code" href="structstp__list__item.html#o1">prev</a>;
00667 }
00668 
00669 <span class="comment">/* get next node */</span>
00670 <a class="code" href="structstp__list__item.html">stp_list_item_t</a> *
<a name="l00671"></a><a class="code" href="print-list_8c.html#a32">00671</a> <a class="code" href="print-list_8c.html#a32">stp_list_item_next</a>(<span class="keyword">const</span> <a class="code" href="structstp__list__item.html">stp_list_item_t</a> *item)
00672 {
00673   <span class="keywordflow">return</span> item-&gt;<a class="code" href="structstp__list__item.html#o2">next</a>;
00674 }
00675 
00676 <span class="comment">/* get data for node */</span>
00677 <span class="keywordtype">void</span> *
<a name="l00678"></a><a class="code" href="print-list_8c.html#a33">00678</a> <a class="code" href="print-list_8c.html#a33">stp_list_item_get_data</a>(<span class="keyword">const</span> <a class="code" href="structstp__list__item.html">stp_list_item_t</a> *item)
00679 {
00680   <span class="keywordflow">return</span> item-&gt;<a class="code" href="structstp__list__item.html#o0">data</a>;
00681 }
00682 
00683 <span class="comment">/* set data for node */</span>
00684 <span class="keywordtype">int</span>
<a name="l00685"></a><a class="code" href="print-list_8c.html#a34">00685</a> <a class="code" href="print-list_8c.html#a34">stp_list_item_set_data</a>(<a class="code" href="structstp__list__item.html">stp_list_item_t</a> *item, <span class="keywordtype">void</span> *data)
00686 {
00687   <span class="keywordflow">if</span> (data)
00688     {
00689       item-&gt;<a class="code" href="structstp__list__item.html#o0">data</a> = data;
00690       <span class="keywordflow">return</span> 0;
00691     }
00692   <span class="keywordflow">return</span> 1; <span class="comment">/* return error if data was NULL */</span>
00693 }
</pre></div><hr size="1"><address style="align: right;"><small>Generated on Wed Aug 25 07:56:14 2004 for libgimpprint API Reference by
<a href="http://www.doxygen.org/index.html">
<img src="doxygen.png" alt="doxygen" align="middle" border=0 > </a>1.3.6 </small></address>
</body>
</html>
