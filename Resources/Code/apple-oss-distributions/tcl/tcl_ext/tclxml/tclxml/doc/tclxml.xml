<?xml version='1.0'?>

<!DOCTYPE refentry SYSTEM "tcldoc-1.0.dtd">

<refentry xmlns:xlink='http://www.w3.org/1999/xlink'>

  <docinfo>
    <author xlink:href='http://www.zveno.com/staff/Steve.Ball/'>
      <firstname>Steve</firstname>
      <surname>Ball</surname>
    </author>
    <copyright>
      <year>2000</year>
      <holder xlink:href='http://www.zveno.com/'>Zveno Pty Ltd</holder>
    </copyright>
    <legalnotice>
      <para>Zveno makes this software and all associated data and documentation ('Software') available free of charge for any purpose.  Copies may be made of this Software but all of this notice must be included on any copy.</para>
      <para>The Software was developed for research purposes and Zveno does not warrant that it is error free or fit for any purpose.  Zveno disclaims any liability for all claims, expenses, losses, damages and costs any user may incur as a result of using, copying or modifying the Software.</para>
    </legalnotice>
  </docinfo>

  <refmeta>
    <refentrytitle>TclXML</refentrytitle>
    <manvolnum>n</manvolnum>
  </refmeta>

  <refnamediv>
    <refname>::xml::parser</refname>
    <refname>::xml::parserclass</refname>
    <refpurpose>XML parser support for Tcl</refpurpose>
  </refnamediv>

  <refsynopsisdiv>

    <tclcmdsynopsis>
      <command>package require xml</command>
    </tclcmdsynopsis>
    <tclcmdsynopsis>
      <command>package require <replaceable>parserclass</replaceable></command>
    </tclcmdsynopsis>

    <tclpkgsynopsis>
      <package>xml</package>
      <version>2.6</version>
    </tclpkgsynopsis>

    <tclnamespacesynopsis>
      <tclnamespace>::xml</tclnamespace>
      <tclnamespace>::sgml</tclnamespace>
      <tclnamespace>::xml::tclparser</tclnamespace>
    </tclnamespacesynopsis>

    <tclcmdsynopsis>
      <command>::xml::parserclass</command>
      <option>option</option>
      <group choice='opt' rep='repeat'><arg>arg</arg><arg>arg</arg></group>
    </tclcmdsynopsis>

    <tclcmdsynopsis>
      <command>::xml::parser</command>
      <group choice='opt'>
        <arg><replaceable>name</replaceable></arg>
      </group>
      <group choice='opt' rep='repeat'>
        <option>-option</option>
	<arg><replaceable>value</replaceable></arg>
      </group>
    </tclcmdsynopsis>

    <tclcmdsynopsis>
      <command><replaceable>parser</replaceable></command>
      <arg><replaceable>option</replaceable></arg>
      <arg rep='repeat' choice='opt'><replaceable>arg</replaceable></arg>
    </tclcmdsynopsis>

  </refsynopsisdiv>

  <refsect1>
    <title>Description</title>
    <para>TclXML provides event-based parsing of <acronym xlink:href='http://www.w3.org/XML/'>XML</acronym> documents.  The application may register callback scripts for certain document features, and when the parser encounters those features while parsing the document the callback is evaluated.</para>
    <para>The parser may also perform other functions, such as normalisation, validation and/or entity expansion.  Generally, these functions are under the control of configuration options.  Whether these functions can be performed at all depends on the parser implementation.</para>
    <para>The TclXML package provides a generic interface for use by a Tcl application, along with a low-level interface for use by a parser implementation.  Each implementation provides a class of XML parser, and these register themselves using the <tclcommand>::xml::parserclass create</tclcommand> command.  One of the registered parser classes will be the default parser class.</para>
    <para>Loading the package with the generic <tclcommand>package require xml</tclcommand> command allows the package to automatically determine the default parser class.  In order to select a particular parser class as the default, that class' package may be loaded directly, eg. <tclcommand>package require expat</tclcommand>.  In all cases, all available parser classes are registered with the TclXML package, the difference is simply in which one becomes the default.</para>
  </refsect1>

  <refsect1>
    <title>Commands</title>

    <refsect2>
      <title><tclcommand>::xml::parserclass</tclcommand></title>
      <para>The <tclcommand>::xml::parserclass</tclcommand> command is used to manage XML parser classes.</para>

      <refsect3>
        <title>Command Options</title>
        <para>The following command options may be used:</para>
        <variablelist>
	  <varlistentry>
            <term><methodname>create</methodname></term>
	    <listitem>
	      <tclcmdsynopsis>
		<arg>create</arg>
		<arg><replaceable class='parameter'>name</replaceable></arg>
		<group choice='opt'>
		  <option>-createcommand</option>
		  <arg><replaceable>script</replaceable></arg>
		</group>
		<group choice='opt'>
		  <option>-createentityparsercommand</option>
		  <arg><replaceable>script</replaceable></arg>
		</group>
		<group choice='opt'>
		  <option>-parsecommand</option>
		  <arg><replaceable>script</replaceable></arg>
		</group>
		<group choice='opt'>
		  <option>-configurecommand</option>
		  <arg><replaceable>script</replaceable></arg>
		</group>
		<group choice='opt'>
		  <option>-getcommand</option>
		  <arg><replaceable>script</replaceable></arg>
		</group>
		<group choice='opt'>
		  <option>-deletecommand</option>
		  <arg><replaceable>script</replaceable></arg>
		</group>
              </tclcmdsynopsis>
	      <para>Creates an XML parser class with the given name.</para>
	    </listitem>
	  </varlistentry>
	  <varlistentry>
	    <term><methodname>destroy</methodname></term>
	    <listitem>
	      <tclcmdsynopsis>
		<arg>destroy</arg>
		<arg><replaceable>name</replaceable></arg>
	      </tclcmdsynopsis>
	      <para>Destroys an XML parser class.</para>
	    </listitem>
	  </varlistentry>
	  <varlistentry>
	    <term><methodname>info</methodname></term>
	    <listitem>
	      <tclcmdsynopsis>
		<option>info</option>
		<group choice='req'>
		  <arg>names</arg>
		</group>
	      </tclcmdsynopsis>
	      <para>Returns information about registered XML parser classes.</para>
	    </listitem>
	  </varlistentry>
	</variablelist>
      </refsect3>
    </refsect2>

    <refsect2>
      <title><tclcommand>::xml::parser</tclcommand></title>
      <para>The <tclcommand>::xml::parser</tclcommand> command creates an <acronym>XML</acronym> parser object.  The return value of the command is the name of the newly created parser.</para>
      <para>The parser scans an XML document's syntactical structure, evaluating callback scripts for each feature found.  At the very least the parser will normalise the document and check the document for well-formedness.  If the document is not well-formed then the <option>-errorcommand</option> option will be evaluated.  Some parser classes may perform additional functions, such as validation.  Additional features provided by the various parser classes are described in the section Parser Classes</para>
      <para>Parsing is performed synchronously.  The command blocks until the entire document has been parsed.  Parsing may be terminated by an application callback, see the section Callback Return Codes.  Incremental parsing is also supported by using the <option>-final</option> configuration option.</para>

      <refsect3>
        <title>Configuration Options</title>
	<para>The <tclcommand>::xml::parser</tclcommand> command accepts the following configuration options:</para>

	<variablelist>
	  <varlistentry>
	    <term><option>-attlistdeclcommand</option></term>
	    <listitem>
	      <tcloptionsynopsis>
		<option>-attlistdeclcommand</option>
		<arg><replaceable>script</replaceable></arg>
	      </tcloptionsynopsis>
	      <para>Specifies the prefix of a Tcl command to be evaluated whenever an attribute list declaration is encountered in the DTD subset of an XML document.  The command evaluated is:</para>
	      <tclcmdsynopsis>
		<command><replaceable>script</replaceable></command>
		<arg><replaceable>name</replaceable></arg>
		<arg><replaceable>attrname</replaceable></arg>
		<arg><replaceable>type</replaceable></arg>
		<arg><replaceable>default</replaceable></arg>
		<arg><replaceable>value</replaceable></arg>
	      </tclcmdsynopsis>
	      <para>where:</para>
	      <segmentedlist>
		<seglistitem>
		  <seg><arg><replaceable>name</replaceable></arg></seg>
		  <seg>Element type name</seg>
		</seglistitem>
		<seglistitem>
		  <seg><arg><replaceable>attrname</replaceable></arg></seg>
		  <seg>Attribute name being declared</seg>
		</seglistitem>
		<seglistitem>
		  <seg><arg><replaceable>type</replaceable></arg></seg>
		  <seg>Attribute type</seg>
		</seglistitem>
		<seglistitem>
		  <seg><arg><replaceable>default</replaceable></arg></seg>
		  <seg>Attribute default, such as #IMPLIED</seg>
		</seglistitem>
		<seglistitem>
		  <seg><arg><replaceable>value</replaceable></arg></seg>
		  <seg>Default attribute value.  Empty string if none given.</seg>
		</seglistitem>
	      </segmentedlist>
	    </listitem>
	  </varlistentry>
	  <varlistentry>
	    <term><option>-baseurl</option></term>
	    <listitem>
	      <tcloptionsynopsis>
		<option>-baseurl</option>
		<arg><replaceable>URI</replaceable></arg>
	      </tcloptionsynopsis>
	      <para>Specifies the base URI for resolving relative URIs that may be used in the XML document to refer to external entities.</para>
	    </listitem>
	  </varlistentry>
	  <varlistentry>
	    <term><option>-characterdatacommand</option></term>
	    <listitem>
	      <tcloptionsynopsis>
		<option>-characterdatacommand</option>
		<arg><replaceable>script</replaceable></arg>
	      </tcloptionsynopsis>
	      <para>Specifies the prefix of a Tcl command to be evaluated whenever character data is encountered in the XML document being parsed.  The command evaluated is:</para>
	      <tclcmdsynopsis>
		<command><replaceable>script</replaceable></command>
		<arg><replaceable>data</replaceable></arg>
	      </tclcmdsynopsis>
	      <para>where:</para>
	      <segmentedlist>
		<seglistitem>
		  <seg><arg><replaceable>data</replaceable></arg></seg>
		  <seg>Character data in the document</seg>
		</seglistitem>
	      </segmentedlist>
	    </listitem>
	  </varlistentry>
	  <varlistentry>
	    <term><option>-commentcommand</option></term>
	    <listitem>
	      <tcloptionsynopsis>
		<option>-commentcommand</option>
		<arg><replaceable>script</replaceable></arg>
	      </tcloptionsynopsis>
	      <para>Specifies the prefix of a Tcl command to be evaluated whenever a comment is encountered in the XML document being parsed.  The command evaluated is:</para>
	      <tclcmdsynopsis>
		<command><replaceable>script</replaceable></command>
		<arg><replaceable>data</replaceable></arg>
	      </tclcmdsynopsis>
	      <para>where:</para>
	      <segmentedlist>
		<seglistitem>
		  <seg><arg><replaceable>data</replaceable></arg></seg>
		  <seg>Comment data</seg>
		</seglistitem>
	      </segmentedlist>
	    </listitem>
	  </varlistentry>
	  <varlistentry>
	    <term><option>-defaultcommand</option></term>
	    <listitem>
	      <tcloptionsynopsis>
		<option>-defaultcommand</option>
		<arg><replaceable>script</replaceable></arg>
	      </tcloptionsynopsis>
	      <para>Specifies the prefix of a Tcl command to be evaluated when no other callback has been defined for a document feature which has been encountered.  The command evaluated is:</para>
	      <tclcmdsynopsis>
		<command><replaceable>script</replaceable></command>
		<arg><replaceable>data</replaceable></arg>
	      </tclcmdsynopsis>
	      <para>where:</para>
	      <segmentedlist>
		<seglistitem>
		  <seg><arg><replaceable>data</replaceable></arg></seg>
		  <seg>Document data</seg>
		</seglistitem>
	      </segmentedlist>
	    </listitem>
	  </varlistentry>
	  <varlistentry>
	    <term><option>-defaultexpandinternalentities</option></term>
	    <listitem>
	      <tcloptionsynopsis>
		<option>-defaultexpandinternalentities</option>
		<arg><replaceable>boolean</replaceable></arg>
	      </tcloptionsynopsis>
	      <para>Specifies whether entities declared in the internal DTD subset are expanded with their replacement text.  If entities are not expanded then the entity references will be reported with no expansion.</para>
	    </listitem>
	  </varlistentry>
	  <varlistentry>
	    <term><option>-doctypecommand</option></term>
	    <listitem>
	      <tcloptionsynopsis>
		<option>-doctypecommand</option>
		<arg><replaceable>script</replaceable></arg>
	      </tcloptionsynopsis>
	      <para>Specifies the prefix of a Tcl command to be evaluated when the document type declaration is encountered.  The command evaluated is:</para>
	      <tclcmdsynopsis>
		<command><replaceable>script</replaceable></command>
		<arg><replaceable>name</replaceable></arg>
		<arg><replaceable>public</replaceable></arg>
		<arg><replaceable>system</replaceable></arg>
		<arg><replaceable>dtd</replaceable></arg>
	      </tclcmdsynopsis>
	      <para>where:</para>
	      <segmentedlist>
		<seglistitem>
		  <seg><arg><replaceable>name</replaceable></arg></seg>
		  <seg>The name of the document element</seg>
		</seglistitem>
		<seglistitem>
		  <seg><arg><replaceable>public</replaceable></arg></seg>
		  <seg>Public identifier for the external DTD subset</seg>
		</seglistitem>
		<seglistitem>
		  <seg><arg><replaceable>system</replaceable></arg></seg>
		  <seg>System identifier for the external DTD subset.  Usually a URI.</seg>
		</seglistitem>
		<seglistitem>
		  <seg><arg><replaceable>dtd</replaceable></arg></seg>
		  <seg>The internal DTD subset</seg>
		</seglistitem>
	      </segmentedlist>
	      <para>See also <option>-startdoctypedeclcommand</option> and <option>-enddoctypedeclcommand</option>.</para>
	    </listitem>
	  </varlistentry>
	  <varlistentry>
	    <term><option>-elementdeclcommand</option></term>
	    <listitem>
	      <tcloptionsynopsis>
		<option>-elementdeclcommand</option>
		<arg><replaceable>script</replaceable></arg>
	      </tcloptionsynopsis>
	      <para>Specifies the prefix of a Tcl command to be evaluated when an element markup declaration is encountered.  The command evaluated is:</para>
	      <tclcmdsynopsis>
		<command><replaceable>script</replaceable></command>
		<arg><replaceable>name</replaceable></arg>
		<arg><replaceable>model</replaceable></arg>
	      </tclcmdsynopsis>
	      <para>where:</para>
	      <segmentedlist>
		<seglistitem>
		  <seg><arg><replaceable>name</replaceable></arg></seg>
		  <seg>The element type name</seg>
		</seglistitem>
		<seglistitem>
		  <seg><arg><replaceable>model</replaceable></arg></seg>
		  <seg>Content model specification</seg>
		</seglistitem>
	      </segmentedlist>
	    </listitem>
	  </varlistentry>
	  <varlistentry>
	    <term><option>-elementendcommand</option></term>
	    <listitem>
	      <tcloptionsynopsis>
		<option>-elementendcommand</option>
		<arg><replaceable>script</replaceable></arg>
	      </tcloptionsynopsis>
	      <para>Specifies the prefix of a Tcl command to be evaluated when an element end tag is encountered.  The command evaluated is:</para>
	      <tclcmdsynopsis>
		<command><replaceable>script</replaceable></command>
		<arg><replaceable>name</replaceable></arg>
		<arg choice='opt'><replaceable>args</replaceable></arg>
	      </tclcmdsynopsis>
	      <para>where:</para>
	      <segmentedlist>
		<seglistitem>
		  <seg><arg><replaceable>name</replaceable></arg></seg>
		  <seg>The element type name that has ended</seg>
		</seglistitem>
		<seglistitem>
		  <seg><arg><replaceable>args</replaceable></arg></seg>
		  <seg>Additional information about this element</seg>
		</seglistitem>
	      </segmentedlist>
	      <para>Additional information about the element takes the form of configuration options.  Possible options are:</para>
	      <segmentedlist>
		<seglistitem>
		  <seg><option>-empty</option> <arg><replaceable>boolean</replaceable></arg></seg>
		  <seg>The empty element syntax was used for this element</seg>
		</seglistitem>
		<seglistitem>
		  <seg><option>-namespace</option> <arg><replaceable>uri</replaceable></arg></seg>
		  <seg>The element is in the XML namespace associated with the given URI</seg>
		</seglistitem>
	      </segmentedlist>
	    </listitem>
	  </varlistentry>
	  <varlistentry>
	    <term><option>-elementstartcommand</option></term>
	    <listitem>
	      <tcloptionsynopsis>
		<option>-elementstartcommand</option>
		<arg><replaceable>script</replaceable></arg>
	      </tcloptionsynopsis>
	      <para>Specifies the prefix of a Tcl command to be evaluated when an element start tag is encountered.  The command evaluated is:</para>
	      <tclcmdsynopsis>
		<command><replaceable>script</replaceable></command>
		<arg><replaceable>name</replaceable></arg>
		<arg><replaceable>attlist</replaceable></arg>
		<arg choice='opt'><replaceable>args</replaceable></arg>
	      </tclcmdsynopsis>
	      <para>where:</para>
	      <segmentedlist>
		<seglistitem>
		  <seg><arg><replaceable>name</replaceable></arg></seg>
		  <seg>The element type name that has started</seg>
		</seglistitem>
		<seglistitem>
		  <seg><arg><replaceable>attlist</replaceable></arg></seg>
		  <seg>A Tcl list containing the attributes for this element.  The list of attributes is formatted as pairs of attribute names and their values.  </seg>
		</seglistitem>
		<seglistitem>
		  <seg><arg><replaceable>args</replaceable></arg></seg>
		  <seg>Additional information about this element</seg>
		</seglistitem>
	      </segmentedlist>
	      <para>Additional information about the element takes the form of configuration options.  Possible options are:</para>
	      <segmentedlist>
		<seglistitem>
		  <seg><option>-empty</option> <arg><replaceable>boolean</replaceable></arg></seg>
		  <seg>The empty element syntax was used for this element</seg>
		</seglistitem>
		<seglistitem>
		  <seg><option>-namespace</option> <arg><replaceable>uri</replaceable></arg></seg>
		  <seg>The element is in the XML namespace associated with the given URI</seg>
		</seglistitem>
		<seglistitem>
		  <seg><option>-namespacedecls</option> <arg><replaceable>list</replaceable></arg></seg>
		  <seg>The start tag included one or more XML Namespace declarations.  <arg><replaceable>list</replaceable></arg> is a Tcl list giving the namespaces declared.  The list is formatted as pairs of values, the first value is the namespace URI and the second value is the prefix used for the namespace in this document.  A default XML namespace declaration will have an empty string for the prefix.</seg>
		</seglistitem>
	      </segmentedlist>
	    </listitem>
	  </varlistentry>
	  <varlistentry>
	    <term><option>-endcdatasectioncommand</option></term>
	    <listitem>
	      <tcloptionsynopsis>
		<option>-endcdatasectioncommand</option>
		<arg><replaceable>script</replaceable></arg>
	      </tcloptionsynopsis>
	      <para>Specifies the prefix of a Tcl command to be evaluated when end of a CDATA section is encountered.  The command is evaluated with no further arguments.</para>
	    </listitem>
	  </varlistentry>
	  <varlistentry>
	    <term><option>-enddoctypedeclcommand</option></term>
	    <listitem>
	      <tcloptionsynopsis>
		<option>-enddoctypedeclcommand</option>
		<arg><replaceable>script</replaceable></arg>
	      </tcloptionsynopsis>
	      <para>Specifies the prefix of a Tcl command to be evaluated when end of the document type declaration is encountered.  The command is evaluated with no further arguments.</para>
	    </listitem>
	  </varlistentry>
	  <varlistentry>
	    <term><option>-entitydeclcommand</option></term>
	    <listitem>
	      <tcloptionsynopsis>
		<option>-entitydeclcommand</option>
		<arg><replaceable>script</replaceable></arg>
	      </tcloptionsynopsis>
	      <para>Specifies the prefix of a Tcl command to be evaluated when an entity declaration is encountered.  The command evaluated is:</para>
	      <tclcmdsynopsis>
		<command><replaceable>script</replaceable></command>
		<arg><replaceable>name</replaceable></arg>
		<arg choice='opt' repeat='rep'><replaceable>args</replaceable></arg>
	      </tclcmdsynopsis>
	      <para>where:</para>
	      <segmentedlist>
		<seglistitem>
		  <seg><arg><replaceable>name</replaceable></arg></seg>
		  <seg>The name of the entity being declared</seg>
		</seglistitem>
		<seglistitem>
		  <seg><arg><replaceable>args</replaceable></arg></seg>
		  <seg>Additional information about the entity declaration.  An internal entity shall have a single argument, the replacement text.  An external parsed entity shall have two additional arguments, the public and system indentifiers of the external resource.  An external unparsed entity shall have three additional arguments, the public and system identifiers followed by the notation name.</seg>
		</seglistitem>
	      </segmentedlist>
	    </listitem>
	  </varlistentry>
	  <varlistentry>
	    <term><option>-entityreferencecommand</option></term>
	    <listitem>
	      <tcloptionsynopsis>
		<option>-entityreferencecommand</option>
		<arg><replaceable>script</replaceable></arg>
	      </tcloptionsynopsis>
	      <para>Specifies the prefix of a Tcl command to be evaluated when an entity reference is encountered.  The command evaluated is:</para>
	      <tclcmdsynopsis>
		<command><replaceable>script</replaceable></command>
		<arg><replaceable>name</replaceable></arg>
	      </tclcmdsynopsis>
	      <para>where:</para>
	      <segmentedlist>
		<seglistitem>
		  <seg><arg><replaceable>name</replaceable></arg></seg>
		  <seg>The name of the entity being referenced</seg>
		</seglistitem>
	      </segmentedlist>
	    </listitem>
	  </varlistentry>
	  <varlistentry>
	    <term><option>-errrocommand</option></term>
	    <listitem>
	      <tcloptionsynopsis>
		<option>-errorcommand</option>
		<arg><replaceable>script</replaceable></arg>
	      </tcloptionsynopsis>
	      <para>Specifies the prefix of a Tcl command to be evaluated when a fatal error is detected.  The error may be due to the XML document not being well-formed.  In the case of a validating parser class, the error may also be due to the XML document not obeying validity constraints.  By default, a callback script is provided which causes an error return code, but an application may supply a script which attempts to continue parsing.  The command evaluated is:</para>
	      <tclcmdsynopsis>
		<command><replaceable>script</replaceable></command>
		<arg><replaceable>errorcode</replaceable></arg>
		<arg><replaceable>errormsg</replaceable></arg>
	      </tclcmdsynopsis>
	      <para>where:</para>
	      <segmentedlist>
		<seglistitem>
		  <seg><arg><replaceable>errorcode</replaceable></arg></seg>
		  <seg>A single word description of the error, intended for use by an application</seg>
		</seglistitem>
		<seglistitem>
		  <seg><arg><replaceable>errormsg</replaceable></arg></seg>
		  <seg>A human-readable description of the error</seg>
		</seglistitem>
	      </segmentedlist>
	    </listitem>
	  </varlistentry>
	  <varlistentry>
	    <term><option>-externalentitycommand</option></term>
	    <listitem>
	      <tcloptionsynopsis>
		<option>-externalentitycommand</option>
		<arg><replaceable>script</replaceable></arg>
	      </tcloptionsynopsis>
	      <para>Specifies the prefix of a Tcl command to be evaluated to resolve an external entity reference.  If the parser has been configured to validate the XML document, a default script is supplied that resolves the URI given as the system identifier of the external entity and recursively parses the entity's data.  If the parser has been configured as a non-validating parser, then by default external entities are not resolved.  This option can be used to override the default behaviour.  The command evaluated is:</para>
	      <tclcmdsynopsis>
		<command><replaceable>script</replaceable></command>
		<arg><replaceable>name</replaceable></arg>
		<arg><replaceable>baseuri</replaceable></arg>
		<arg><replaceable>uri</replaceable></arg>
		<arg><replaceable>id</replaceable></arg>
	      </tclcmdsynopsis>
	      <para>where:</para>
	      <segmentedlist>
		<seglistitem>
		  <seg><arg><replaceable>name</replaceable></arg></seg>
		  <seg>The Tcl command name of the current parser</seg>
		</seglistitem>
		<seglistitem>
		  <seg><arg><replaceable>baseuri</replaceable></arg></seg>
		  <seg>An absolute URI for the current entity which is to be used to resolve relative URIs</seg>
		</seglistitem>
		<seglistitem>
		  <seg><arg><replaceable>uri</replaceable></arg></seg>
		  <seg>The system identifier of the external entity, usually a URI</seg>
		</seglistitem>
		<seglistitem>
		  <seg><arg><replaceable>id</replaceable></arg></seg>
		  <seg>The public identifier of the external entity.  If no public identifier was given in the entity declaration then <arg><replaceable>id</replaceable></arg> will be an empty string.</seg>
		</seglistitem>
	      </segmentedlist>
	    </listitem>
	  </varlistentry>
	  <varlistentry>
	    <term><option>-final</option></term>
	    <listitem>
	      <tcloptionsynopsis>
		<option>-final</option>
		<arg><replaceable>boolean</replaceable></arg>
	      </tcloptionsynopsis>
	      <para>Specifies whether the XML document being parsed is complete.  If the document is to be incrementally parsed then this option will be set to false, and when the last fragment of document is parsed it is set to true.  For example,</para>
	      <informalexample>
		<programlisting>
set parser [::xml::parser -final 0]
$parser parse $data1
.
.
.
$parser parse $data2
.
.
.
$parser configure -final 1
$parser parse $finaldata
		</programlisting>
	      </informalexample>
	    </listitem>
	  </varlistentry>
	  <varlistentry>
	    <term><option>-ignorewhitespace</option></term>
	    <listitem>
	      <tcloptionsynopsis>
		<option>-ignorewhitespace</option>
		<arg><replaceable>boolean</replaceable></arg>
	      </tcloptionsynopsis>
	      <para>If this option is set to true then spans of character data in the XML document which are composed only of white-space (CR, LF, space, tab) will not be reported to the application.  In other words, the data passed to every invocation of the <option>-characterdatacommand</option> script will contain at least one non-white-space character.</para>
	    </listitem>
	  </varlistentry>
	  <varlistentry>
	    <term><option>-notationdeclcommand</option></term>
	    <listitem>
	      <tcloptionsynopsis>
		<option>-notationdeclcommand</option>
		<arg><replaceable>script</replaceable></arg>
	      </tcloptionsynopsis>
	      <para>Specifies the prefix of a Tcl command to be evaluated when a notation declaration is encountered.  The command evaluated is:</para>
	      <tclcmdsynopsis>
		<command><replaceable>script</replaceable></command>
		<arg><replaceable>name</replaceable></arg>
		<arg><replaceable>uri</replaceable></arg>
	      </tclcmdsynopsis>
	      <para>where:</para>
	      <segmentedlist>
		<seglistitem>
		  <seg><arg><replaceable>name</replaceable></arg></seg>
		  <seg>The name of the notation</seg>
		</seglistitem>
		<seglistitem>
		  <seg><arg><replaceable>uri</replaceable></arg></seg>
		  <seg>An external identifier for the notation, usually a URI.</seg>
		</seglistitem>
	      </segmentedlist>
	    </listitem>
	  </varlistentry>
	  <varlistentry>
	    <term><option>-notstandalonecommand</option></term>
	    <listitem>
	      <tcloptionsynopsis>
		<option>-notstandalonecommand</option>
		<arg><replaceable>script</replaceable></arg>
	      </tcloptionsynopsis>
	      <para>Specifies the prefix of a Tcl command to be evaluated when the parser determines that the XML document being parsed is not a standalone document.</para>
	    </listitem>
	  </varlistentry>
	  <varlistentry>
	    <term><option>-paramentityparsing</option></term>
	    <listitem>
	      <tcloptionsynopsis>
		<option>-paramentityparsing</option>
		<arg><replaceable>boolean</replaceable></arg>
	      </tcloptionsynopsis>
	      <para>Controls whether external parameter entities are parsed.</para>
	    </listitem>
	  </varlistentry>
	  <varlistentry>
	    <term><option>-parameterentitydeclcommand</option></term>
	    <listitem>
	      <tcloptionsynopsis>
		<option>-parameterentitydeclcommand</option>
		<arg><replaceable>script</replaceable></arg>
	      </tcloptionsynopsis>
	      <para>Specifies the prefix of a Tcl command to be evaluated when a parameter entity declaration is encountered.  The command evaluated is:</para>
	      <tclcmdsynopsis>
		<command><replaceable>script</replaceable></command>
		<arg><replaceable>name</replaceable></arg>
		<arg choice='opt'><replaceable>args</replaceable></arg>
	      </tclcmdsynopsis>
	      <para>where:</para>
	      <segmentedlist>
		<seglistitem>
		  <seg><arg><replaceable>name</replaceable></arg></seg>
		  <seg>The name of the parameter entity</seg>
		</seglistitem>
		<seglistitem>
		  <seg><arg choice='opt'><replaceable>args</replaceable></arg></seg>
		  <seg>For an internal parameter entity there is only one additional argument, the replacement text.  For external parameter entities there are two additional arguments, the system and public identifiers respectively.</seg>
		</seglistitem>
	      </segmentedlist>
	    </listitem>
	  </varlistentry>
	  <varlistentry>
	    <term><option>-parser</option></term>
	    <listitem>
	      <tcloptionsynopsis>
		<option>-parser</option>
		<arg><replaceable>name</replaceable></arg>
	      </tcloptionsynopsis>
	      <para>The name of the parser class to instantiate for this parser object.  This option may only be specified when the parser instance is created.</para>
	    </listitem>
	  </varlistentry>
	  <varlistentry>
	    <term><option>-processinginstructioncommand</option></term>
	    <listitem>
	      <tcloptionsynopsis>
		<option>-processinginstructioncommand</option>
		<arg><replaceable>script</replaceable></arg>
	      </tcloptionsynopsis>
	      <para>Specifies the prefix of a Tcl command to be evaluated when a processing instruction is encountered.  The command evaluated is:</para>
	      <tclcmdsynopsis>
		<command><replaceable>script</replaceable></command>
		<arg><replaceable>target</replaceable></arg>
		<arg><replaceable>data</replaceable></arg>
	      </tclcmdsynopsis>
	      <para>where:</para>
	      <segmentedlist>
		<seglistitem>
		  <seg><arg><replaceable>target</replaceable></arg></seg>
		  <seg>The name of the processing instruction target</seg>
		</seglistitem>
		<seglistitem>
		  <seg><arg><replaceable>data</replaceable></arg></seg>
		  <seg>Remaining data from the processing instruction</seg>
		</seglistitem>
	      </segmentedlist>
	    </listitem>
	  </varlistentry>
	  <varlistentry>
	    <term><option>-reportempty</option></term>
	    <listitem>
	      <tcloptionsynopsis>
		<option>-reportempty</option>
		<arg><replaceable>boolean</replaceable></arg>
	      </tcloptionsynopsis>
	      <para>If this option is enabled then when an element is encountered that uses the special empty element syntax, additional arguments are appended to the <option>-elementstartcommand</option> and <option>-elementendcommand</option> callbacks.  The arguments <arg>-empty 1</arg> are appended.  For example:</para>
	      <tclcmdsynopsis>
		<command><replaceable>script</replaceable></command>
		<option>-empty</option>
		<arg>1</arg>
	      </tclcmdsynopsis>
	    </listitem>
	  </varlistentry>
	  <varlistentry>
	    <term><option>-startcdatasectioncommand</option></term>
	    <listitem>
	      <tcloptionsynopsis>
		<option>-startcdatasectioncommand</option>
		<arg><replaceable>script</replaceable></arg>
	      </tcloptionsynopsis>
	      <para>Specifies the prefix of a Tcl command to be evaluated when the start of a CDATA section section is encountered.  No arguments are appended to the script.</para>
	    </listitem>
	  </varlistentry>
	  <varlistentry>
	    <term><option>-startdoctypedeclcommand</option></term>
	    <listitem>
	      <tcloptionsynopsis>
		<option>-startdoctypedeclcommand</option>
		<arg><replaceable>script</replaceable></arg>
	      </tcloptionsynopsis>
	      <para>Specifies the prefix of a Tcl command to be evaluated at the start of a document type declaration.  No arguments are appended to the script.</para>
	    </listitem>
	  </varlistentry>
	  <varlistentry>
	    <term><option>-unknownencodingcommand</option></term>
	    <listitem>
	      <tcloptionsynopsis>
		<option>-unknownencodingcommand</option>
		<arg><replaceable>script</replaceable></arg>
	      </tcloptionsynopsis>
	      <para>Specifies the prefix of a Tcl command to be evaluated when a character is encountered with an unknown encoding.  This option has not been implemented.</para>
	    </listitem>
	  </varlistentry>
	  <varlistentry>
	    <term><option>-unparsedentitydeclcommand</option></term>
	    <listitem>
	      <tcloptionsynopsis>
		<option>-unparsedentitydeclcommand</option>
		<arg><replaceable>script</replaceable></arg>
	      </tcloptionsynopsis>
	      <para>Specifies the prefix of a Tcl command to be evaluated when a declaration is encountered for an unparsed entity.  The command evaluated is:</para>
	      <tclcmdsynopsis>
		<command><replaceable>script</replaceable></command>
		<arg><replaceable>system</replaceable></arg>
		<arg><replaceable>public</replaceable></arg>
		<arg><replaceable>notation</replaceable></arg>
	      </tclcmdsynopsis>
	      <para>where:</para>
	      <segmentedlist>
		<seglistitem>
		  <seg><arg><replaceable>system</replaceable></arg></seg>
		  <seg>The system identifier of the external entity, usually a URI</seg>
		</seglistitem>
		<seglistitem>
		  <seg><arg><replaceable>public</replaceable></arg></seg>
		  <seg>The public identifier of the external entity</seg>
		</seglistitem>
		<seglistitem>
		  <seg><arg><replaceable>notation</replaceable></arg></seg>
		  <seg>The name of the notation for the external entity</seg>
		</seglistitem>
	      </segmentedlist>
	    </listitem>
	  </varlistentry>
	  <varlistentry>
	    <term><option>-validate</option></term>
	    <listitem>
	      <tcloptionsynopsis>
		<option>-validate</option>
		<arg><replaceable>boolean</replaceable></arg>
	      </tcloptionsynopsis>
	      <para>Enables validation of the XML document to be parsed.  Any changes to this option are ignored after an XML document has started to be parsed, but the option may be changed after a reset.</para>
	    </listitem>
	  </varlistentry>
	  <varlistentry>
	    <term><option>-warningcommand</option></term>
	    <listitem>
	      <tcloptionsynopsis>
		<option>-warningcommand</option>
		<arg><replaceable>script</replaceable></arg>
	      </tcloptionsynopsis>
	      <para>Specifies the prefix of a Tcl command to be evaluated when a warning condition is detected.  A warning condition is where the XML document has not been authored correctly, but is still well-formed and may be valid.  For example, the special empty element syntax may be used for an element which has not been declared to have empty content.  By default, a callback script is provided which silently ignores the warning.  The command evaluated is:</para>
	      <tclcmdsynopsis>
		<command><replaceable>script</replaceable></command>
		<arg><replaceable>warningcode</replaceable></arg>
		<arg><replaceable>warningmsg</replaceable></arg>
	      </tclcmdsynopsis>
	      <para>where:</para>
	      <segmentedlist>
		<seglistitem>
		  <seg><arg><replaceable>warningcode</replaceable></arg></seg>
		  <seg>A single word description of the warning, intended for use by an application</seg>
		</seglistitem>
		<seglistitem>
		  <seg><arg><replaceable>wanringmsg</replaceable></arg></seg>
		  <seg>A human-readable description of the warning</seg>
		</seglistitem>
	      </segmentedlist>
	    </listitem>
	  </varlistentry>
	  <varlistentry>
	    <term><option>-xmldeclcommand</option></term>
	    <listitem>
	      <tcloptionsynopsis>
		<option>-xmldeclcommand</option>
		<arg><replaceable>script</replaceable></arg>
	      </tcloptionsynopsis>
	      <para>Specifies the prefix of a Tcl command to be evaluated when the XML declaration is encountered.  The command evaluated is:</para>
	      <tclcmdsynopsis>
		<command><replaceable>script</replaceable></command>
		<arg><replaceable>version</replaceable></arg>
		<arg><replaceable>encoding</replaceable></arg>
		<arg><replaceable>standalone</replaceable></arg>
	      </tclcmdsynopsis>
	      <para>where:</para>
	      <segmentedlist>
		<seglistitem>
		  <seg><arg><replaceable>version</replaceable></arg></seg>
		  <seg>The version number of the XML specification to which this document purports to conform</seg>
		</seglistitem>
		<seglistitem>
		  <seg><arg><replaceable>encoding</replaceable></arg></seg>
		  <seg>The character encoding of the document</seg>
		</seglistitem>
		<seglistitem>
		  <seg><arg><replaceable>standalone</replaceable></arg></seg>
		  <seg>A boolean declaring whether the document is standalone</seg>
		</seglistitem>
	      </segmentedlist>
	    </listitem>
	  </varlistentry>
	</variablelist>
      </refsect3>

      <refsect3>
	<title>Parser Command</title>
	<para>The <tclcommand>::xml::parser</tclcommand> command creates a new Tcl command with the same name as the parser.  This command may be used to invoke various operations on the parser object.  It has the following general form:</para>
	<tclcmdsynopsis>
	  <command role="subject"><replaceable>name</replaceable></command>
	  <option><replaceable>option</replaceable></option>
	  <arg rep='repeat'><replaceable>arg</replaceable></arg>
	</tclcmdsynopsis>
	<para><option><replaceable>option</replaceable></option> and the <arg rep='repeat'><replaceable>arg</replaceable></arg> determine the exact behaviour of the command.  The following commands are possible for parser objects:</para>
	<variablelist>
	  <varlistentry>
	    <term><option>cget</option></term>
	    <listitem>
	      <tclcmdsynopsis>
		<option>cget</option>
		<arg><replaceable>-option</replaceable></arg>
	      </tclcmdsynopsis>
	      <para>Returns the current value of the configuration option given by <option><replaceable>option</replaceable></option>.  <option><replaceable>Option</replaceable></option> may have any of the values accepted by the parser object.</para>
	    </listitem>
	  </varlistentry>
	  <varlistentry>
	    <term><option>configure</option></term>
	    <listitem>
	      <tclcmdsynopsis>
		<option>configure</option>
		<group rep="repeat">
		  <arg><replaceable>-option</replaceable></arg>
		  <arg><replaceable>value</replaceable></arg>
		</group>
	      </tclcmdsynopsis>
	      <para>Modify the configuration options of the parser object.  <option><replaceable>Option</replaceable></option> may have any of the values accepted by the parser object.</para>
	    </listitem>
	  </varlistentry>
	  <varlistentry>
	    <term><option>entityparser</option></term>
	    <listitem>
	      <tclcmdsynopsis>
		<option>entityparser</option>
		<group rep="repeat">
		  <arg><replaceable>option</replaceable></arg>
		  <arg><replaceable>value</replaceable></arg>
		</group>
	      </tclcmdsynopsis>
	      <para>Creates a new parser object.  The new object inherits the same configuration options as the parent parser object, but is able to parse XML data in a parsed entity.  The option <option>-dtdsubset</option> allows markup declarations to be treated as being in the internal or external DTD subset.</para>
	    </listitem>
	  </varlistentry>
	  <varlistentry>
	    <term><option>free</option></term>
	    <listitem>
	      <tclcmdsynopsis>
		<option>free</option>
		<arg><replaceable>name</replaceable></arg>
	      </tclcmdsynopsis>
	      <para>Frees all resources associated with the parser object.  The object is not usable after this command has been invoked.</para>
	    </listitem>
	  </varlistentry>
	  <varlistentry>
	    <term><option>get</option></term>
	    <listitem>
	      <tclcmdsynopsis>
		<option>get</option>
		<arg><replaceable>name</replaceable></arg>
		<arg rep='repeat' choice='opt'>args</arg>
	      </tclcmdsynopsis>
	      <para>Returns information about the XML document being parsed.  Each parser class provides different information, see the documentation for the parser class.</para>
	    </listitem>
	  </varlistentry>
	  <varlistentry>
	    <term><option>parse</option></term>
	    <listitem>
	      <tclcmdsynopsis>
		<option>parse</option>
		<arg><replaceable>xml</replaceable></arg>
		<arg rep='repeat' choice='opt'>args</arg>
	      </tclcmdsynopsis>
	      <para>Parses the XML document.  The usual desired effect is for various application callbacks to be evaluated.  Other functions will also be performed by the parser class, at the very least this includes checking the XML document for well-formedness.</para>
	    </listitem>
	  </varlistentry>
	  <varlistentry>
	    <term><option>reset</option></term>
	    <listitem>
	      <tclcmdsynopsis>
		<option>reset</option>
	      </tclcmdsynopsis>
	      <para>Initialises the parser object in preparation for parsing a new XML document.</para>
	    </listitem>
	  </varlistentry>
	</variablelist>
      </refsect3>

    </refsect2>

  </refsect1>

  <refsect1>
    <title>Callback Return Codes</title>
    <para>Every callback script evaluated by a parser may return a return code other than <arg>TCL_OK</arg>.  Return codes are interpreted as follows:</para>
    <segmentedlist>
      <seglistitem>
        <seg>break</seg>
        <seg>Suppresses invocation of all further callback scripts.  The <option>parse</option> method returns the <arg>TCL_OK</arg> return code.</seg>
      </seglistitem>
      <seglistitem>
        <seg>continue</seg>
        <seg>Suppresses invocation of further callback scripts until the current element has finished.</seg>
      </seglistitem>
      <seglistitem>
        <seg>error</seg>
        <seg>Suppresses invocation of all further callback scripts.  The <option>parse</option> method also returns the <arg>TCL_ERROR</arg> return code.</seg>
      </seglistitem>
      <seglistitem>
        <seg>default</seg>
        <seg>Any other return code suppresses invocation of all further callback scripts.  The <option>parse</option> method returns the same return code.</seg>
      </seglistitem>
    </segmentedlist>
  </refsect1>

  <refsect1>
    <title>Application Examples</title>
    <para>This script outputs the character data of an XML document read from stdin.</para>
    <informalexample>
      <programlisting>
package require xml

proc cdata {data args} {
    puts -nonewline $data
}

set parser [::xml::parser -characterdatacommand cdata]
$parser parse [read stdin]
      </programlisting>
    </informalexample>
    <para>This script counts the number of elements in an XML document read from stdin.</para>
    <informalexample>
      <programlisting>
package require xml

proc EStart {varName name attlist args} {
    upvar #0 $varName var
    incr var
}

set count 0
set parser [::xml::parser -elementstartcommand [list EStart count]]
$parser parse [read stdin]
puts "The XML document contains $count elements"
      </programlisting>
    </informalexample>
  </refsect1>

  <refsect1>
    <title>Parser Classes</title>
    <para>This section will discuss how a parser class is implemented.</para>

    <refsect2>
      <title>Tcl Parser Class</title>

      <para>The pure-Tcl parser class requires no compilation - it is a collection of Tcl scripts.  This parser implementation is non-validating, ie. it can only check well-formedness in a document.  However, by enabling the <option>-validate</option> option it will read the document's DTD and resolve external entities.</para>

      <para>This parser implementation aims to implement XML v1.0 and supports XML Namespaces.</para>

      <para>Generally the parser produces XML Infoset information items.  That is, it gives the application a slightly higher-level view than the raw XML syntax.  For example, it does not report CDATA Sections.</para>
    </refsect2>

    <refsect2>
      <title>Expat Parser Class</title>
      <para>This section will discuss the Expat parser class.</para>
    </refsect2>

  </refsect1>

  <refsect1>
    <title>See Also</title>

    <para>TclDOM, a Tcl interface for the W3C Document Object Model.</para>
  </refsect1>

  <refsect1>
    <title>Keywords</title>
    <keywordset>
      <keyword>XML</keyword>
      <keyword>parse</keyword>
    </keywordset>
  </refsect1>

</refentry>
